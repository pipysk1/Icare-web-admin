(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{0:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(4),s=a.n(n);s.a.methodFactory=function(e,t,a){return function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];this.prefix&&a.unshift(this.prefix);const s="error"===e||"warn"===e||"trace"===e||"info"===e;return s?console[e](...a):console.log(...a)}};const i=s.a.getLogger("matrix");function o(e){e.withPrefix=function(e){return function(e){const t=s.a.getLogger("matrix-"+e);t.prefix!==e&&(o(t),t.prefix=e,t.setLevel(s.a.levels.DEBUG));return t}((this.prefix||"")+e)}}i.setLevel(s.a.levels.DEBUG),o(i)},1:function(e,t,a){"use strict";a.d(t,"f",(function(){return i})),a.d(t,"g",(function(){return o})),a.d(t,"u",(function(){return r})),a.d(t,"n",(function(){return l})),a.d(t,"a",(function(){return c})),a.d(t,"d",(function(){return d})),a.d(t,"c",(function(){return m})),a.d(t,"j",(function(){return u})),a.d(t,"m",(function(){return h})),a.d(t,"r",(function(){return p})),a.d(t,"p",(function(){return g})),a.d(t,"v",(function(){return f})),a.d(t,"q",(function(){return v})),a.d(t,"i",(function(){return y})),a.d(t,"l",(function(){return E})),a.d(t,"h",(function(){return _})),a.d(t,"w",(function(){return S})),a.d(t,"o",(function(){return C})),a.d(t,"e",(function(){return w})),a.d(t,"s",(function(){return O})),a.d(t,"t",(function(){return x})),a.d(t,"b",(function(){return R})),a.d(t,"k",(function(){return I}));var n=a(24),s=a.n(n);function i(e){let t="";for(const a in e)e.hasOwnProperty(a)&&(t+="&"+encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.substring(1)}function o(e,t){for(const a in t)t.hasOwnProperty(a)&&(e=e.replace(a,encodeURIComponent(t[a])));return e}function r(e,t,a){let n,s;if(a){for(n=e.length-1;n>=0;n--)if(t(e[n],n,e))return s=e[n],e.splice(n,1),s}else for(n=0;n<e.length;n++)if(t(e[n],n,e))return s=e[n],e.splice(n,1),s;return!1}function l(e){return"[object Function]"===Object.prototype.toString.call(e)}function c(e,t){for(let a=0;a<t.length;a++)if(!e.hasOwnProperty(t[a]))throw new Error("Missing required key: "+t[a])}function d(e){return JSON.parse(JSON.stringify(e))}function m(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("number"==typeof e&&isNaN(e)&&isNaN(t))return!0;if(null===e||null===t)return e===t;if(!(e instanceof Object))return!1;if(e.constructor!==t.constructor||e.prototype!==t.prototype)return!1;if(e instanceof RegExp||e instanceof Date)return e.toString()===t.toString();if(e instanceof Array){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!m(e[a],t[a]))return!1}else{let a;for(a in t)if(t.hasOwnProperty(a)!==e.hasOwnProperty(a))return!1;for(a in t){if(t.hasOwnProperty(a)!==e.hasOwnProperty(a))return!1;if(!m(e[a],t[a]))return!1}}return!0}function u(){const e=(arguments.length<=0?void 0:arguments[0])||{};for(let t=1;t<arguments.length;t++){const a=t<0||arguments.length<=t?void 0:arguments[t];if(a)for(const t in a)e[t]=a[t]}return e}function h(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function p(e,t){for(var a=arguments.length,n=new Array(a>2?a-2:0),s=2;s<a;s++)n[s-2]=arguments[s];try{t.call(e,...n)}catch(a){const s=new t(...n);Object.assign(e,s)}}function g(e){return"number"==typeof e&&isFinite(e)}function f(e){return"string"==typeof e?s()(e.normalize("NFD").replace(b,"")):""}function v(e){return f(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()}const b=/[\u2000-\u200F\u202A-\u202F\u0300-\u036f\uFEFF\s]/g;function y(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function E(e,t){t="boolean"!=typeof t||t;let a=y(e);return a=a.replace(/\\\*/g,".*"),a=a.replace(/\?/g,"."),t&&(a=a.replace(/\\\[(!|)(.*)\\]/g,(function(e,t,a,n,s){return"["+(t?"^":"")+a.replace(/\\-/,"-")+"]"}))),a}function _(e){return e&&e.endsWith("/")?e.substr(0,e.length-1):e}function S(e,t){return new Promise(a=>{setTimeout(a,e,t)})}function C(e){return null==e}function w(){let e,t;const a=new Promise((a,n)=>{e=a,t=n});return{resolve:e,reject:t,promise:a}}async function O(e,t){for(const a of await e)await t(await a)}function x(e){return new Promise(t=>t(e()))}async function R(e,t){const a=[];for(let n=0;n<e.length;n+=t)a.push(...await Promise.all(e.slice(n,n+t).map(e=>e())));return a}let k;function I(){return k}},100:function(e,t,a){"use strict";(function(e){var n=a(2265),s=a(739);class i extends n.Dispatcher{dispatch(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e instanceof s.a?e.fn(e=>{this.dispatch(e,t)}):t?super.dispatch(e):setTimeout(super.dispatch.bind(this,e),0)}fire(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.dispatch({action:e},t)}}const o=new i,r=e;r.mxDispatcher||(r.mxDispatcher=o),t.a=o}).call(this,a(7))},103:function(e,t,a){"use strict";a.d(t,"a",(function(){return P})),a.d(t,"b",(function(){return N}));var n=a(19),s=a.n(n),i=a(385),o=a(99),r=a(123),l=a(245);class c extends i.a{constructor(e,t){super(),this.featureNames=e,this.watchers=t}getValue(e,t){if(this.featureNames.includes(e))return this.readFeature(e);if("notificationsEnabled"===e){const e=localStorage.getItem("notifications_enabled");return"string"==typeof e?"true"===e:null}if("notificationBodyEnabled"===e){const e=localStorage.getItem("notifications_body_enabled");return"string"==typeof e?"true"===e:null}if("audioNotificationsEnabled"===e){const e=localStorage.getItem("audio_notifications_enabled");return"string"==typeof e?"true"===e:null}if(["showRightPanelInRoom","showRightPanelInGroup","lastRightPanelPhaseForRoom","lastRightPanelPhaseForGroup"].includes(e)){return JSON.parse(localStorage.getItem("mx_"+e)||"{}").value}if("layout"===e){const t=this.getSettings()||{};return t.useIRCLayout?l.a.IRC:t[e]}return(this.getSettings()||{})[e]}setValue(e,t,a){if(this.featureNames.includes(e))return this.writeFeature(e,a),Promise.resolve();if("notificationsEnabled"===e)return localStorage.setItem("notifications_enabled",a),this.watchers.notifyUpdate(e,null,r.a.DEVICE,a),Promise.resolve();if("notificationBodyEnabled"===e)return localStorage.setItem("notifications_body_enabled",a),this.watchers.notifyUpdate(e,null,r.a.DEVICE,a),Promise.resolve();if("audioNotificationsEnabled"===e)return localStorage.setItem("audio_notifications_enabled",a),this.watchers.notifyUpdate(e,null,r.a.DEVICE,a),Promise.resolve();if(["showRightPanelInRoom","showRightPanelInGroup","lastRightPanelPhaseForRoom","lastRightPanelPhaseForGroup"].includes(e))return localStorage.setItem("mx_"+e,JSON.stringify({value:a})),this.watchers.notifyUpdate(e,null,r.a.DEVICE,a),Promise.resolve();if("layout"===e){const t=this.getSettings()||{};return delete t.useIRCLayout,t.layout=a,localStorage.setItem("mx_local_settings",JSON.stringify(t)),this.watchers.notifyUpdate(e,null,r.a.DEVICE,a),Promise.resolve()}const n=this.getSettings()||{};return n[e]=a,localStorage.setItem("mx_local_settings",JSON.stringify(n)),this.watchers.notifyUpdate(e,null,r.a.DEVICE,a),Promise.resolve()}canSetValue(e,t){return!0}isSupported(){return void 0!==localStorage&&null!==localStorage}watchSetting(e,t,a){this.watchers.watchSetting(e,t,a)}unwatchSetting(e){this.watchers.unwatchSetting(e)}getSettings(){const e=localStorage.getItem("mx_local_settings");return e?JSON.parse(e):null}readFeature(e){if(o.a.get()&&o.a.get().isGuest())return!1;const t=localStorage.getItem("mx_labs_feature_"+e);return"true"===t||"false"!==t&&null}writeFeature(e,t){localStorage.setItem("mx_labs_feature_"+e,""+t),this.watchers.notifyUpdate(e,null,r.a.DEVICE,t)}}class d extends i.a{constructor(e){super(),this.watchers=e}getValue(e,t){if("blacklistUnverifiedDevices"===e){const e=this.read("mx_local_settings");if(e&&e.blacklistUnverifiedDevicesPerRoom)return e.blacklistUnverifiedDevicesPerRoom[t]}const a=this.read(this.getKey(e,t));return a?a.value:null}setValue(e,t,a){if("blacklistUnverifiedDevices"===e){let n=this.read("mx_local_settings");return n||(n={}),n.blacklistUnverifiedDevicesPerRoom||(n.blacklistUnverifiedDevicesPerRoom={}),n.blacklistUnverifiedDevicesPerRoom[t]=a,localStorage.setItem("mx_local_settings",JSON.stringify(n)),this.watchers.notifyUpdate(e,t,r.a.ROOM_DEVICE,a),Promise.resolve()}return null===a?localStorage.removeItem(this.getKey(e,t)):(a=JSON.stringify({value:a}),localStorage.setItem(this.getKey(e,t),a)),this.watchers.notifyUpdate(e,t,r.a.ROOM_DEVICE,a),Promise.resolve()}canSetValue(e,t){return!0}isSupported(){return void 0!==localStorage&&null!==localStorage}read(e){const t=localStorage.getItem(e);return t?JSON.parse(t):null}getKey(e,t){return"mx_setting_"+e+"_"+t}}class m extends i.a{constructor(e,t){super(),this.defaults=e,this.invertedDefaults=t}getValue(e,t){let a=this.defaults[e];return void 0===a&&(a=this.invertedDefaults[e]),a}async setValue(e,t,a){throw new Error("Cannot set values on the default level handler")}canSetValue(e,t){return!1}isSupported(){return!0}}var u=a(627),h=a(166);class p extends u.a{constructor(e){super(),this.watchers=e,s()(this,"onAccountData",(e,t,a)=>{const n=t.roomId;if("org.matrix.room.preview_urls"===e.getType()){let t=e.getContent().disable;t="boolean"!=typeof t?null:!t,this.watchers.notifyUpdate("urlPreviewsEnabled",n,r.a.ROOM_ACCOUNT,t)}else if("org.matrix.room.color_scheme"===e.getType())this.watchers.notifyUpdate("roomColor",n,r.a.ROOM_ACCOUNT,e.getContent());else if("im.vector.web.settings"===e.getType()){const t=a?a.getContent():{},s=Object(h.d)(t,e.getContent());for(const t of s){const a=e.getContent()[t];this.watchers.notifyUpdate(t,n,r.a.ROOM_ACCOUNT,a)}}else"im.vector.setting.allowed_widgets"===e.getType()&&this.watchers.notifyUpdate("allowedWidgets",n,r.a.ROOM_ACCOUNT,e.getContent())})}initMatrixClient(e,t){e&&e.removeListener("Room.accountData",this.onAccountData),t.on("Room.accountData",this.onAccountData)}getValue(e,t){if("urlPreviewsEnabled"===e){const e=this.getSettings(t,"org.matrix.room.preview_urls")||{};return"boolean"!=typeof e.disable?null:!e.disable}if("roomColor"===e)return this.getSettings(t,"org.matrix.room.color_scheme");if("allowedWidgets"===e)return this.getSettings(t,"im.vector.setting.allowed_widgets");return(this.getSettings(t)||{})[e]}setValue(e,t,a){if("urlPreviewsEnabled"===e){const e=this.getSettings(t,"org.matrix.room.preview_urls")||{};return e.disable=!a,o.a.get().setRoomAccountData(t,"org.matrix.room.preview_urls",e)}if("roomColor"===e)return o.a.get().setRoomAccountData(t,"org.matrix.room.color_scheme",a);if("allowedWidgets"===e)return o.a.get().setRoomAccountData(t,"im.vector.setting.allowed_widgets",a);const n=this.getSettings(t)||{};return n[e]=a,o.a.get().setRoomAccountData(t,"im.vector.web.settings",n)}canSetValue(e,t){const a=o.a.get().getRoom(t);return null!=a}isSupported(){const e=o.a.get();return null!=e&&!e.isGuest()}getSettings(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"im.vector.web.settings";const a=o.a.get().getRoom(e);if(!a)return null;const n=a.getAccountData(t);return n&&n.getContent()?Object(h.a)(n.getContent()):null}}const g=["im.vector.riot.breadcrumb_rooms","im.vector.setting.breadcrumbs"];class f extends u.a{constructor(e){super(),this.watchers=e,s()(this,"onAccountData",(e,t)=>{if("org.matrix.preview_urls"===e.getType()){let t=e.getContent().disable;t="boolean"!=typeof t?null:!t,this.watchers.notifyUpdate("urlPreviewsEnabled",null,r.a.ACCOUNT,t)}else if("im.vector.web.settings"===e.getType()){const a=t?t.getContent():{},n=Object(h.d)(a,e.getContent());for(const t of n){const a=e.getContent()[t];this.watchers.notifyUpdate(t,null,r.a.ACCOUNT,a)}}else if(g.includes(e.getType()))this.notifyBreadcrumbsUpdate(e);else if("im.vector.setting.integration_provisioning"===e.getType()){const t=e.getContent().enabled;this.watchers.notifyUpdate("integrationProvisioning",null,r.a.ACCOUNT,t)}else if("io.element.recent_emoji"===e.getType()){const t=e.getContent().enabled;this.watchers.notifyUpdate("recent_emoji",null,r.a.ACCOUNT,t)}})}initMatrixClient(e,t){e&&e.removeListener("accountData",this.onAccountData),t.on("accountData",this.onAccountData)}getValue(e,t){if("urlPreviewsEnabled"===e){const e=this.getSettings("org.matrix.preview_urls")||{};return"boolean"!=typeof e.disable?null:!e.disable}if("breadcrumb_rooms"===e){let e=this.getSettings("im.vector.setting.breadcrumbs");return e&&e.recent_rooms||(e=this.getSettings("im.vector.riot.breadcrumb_rooms"),e&&(e.recent_rooms=e.rooms)),e&&e.recent_rooms?e.recent_rooms:[]}if("recent_emoji"===e){const e=this.getSettings("io.element.recent_emoji");return e?e.recent_emoji:null}if("integrationProvisioning"===e){const e=this.getSettings("im.vector.setting.integration_provisioning");return e?e.enabled:null}const a=this.getSettings()||{};let n=a[e];return null==n&&("hideAvatarChanges"!==e&&"hideDisplaynameChanges"!==e||(n=a.hideAvatarDisplaynameChanges)),n}setValue(e,t,a){if("urlPreviewsEnabled"===e){const e=this.getSettings("org.matrix.preview_urls")||{};return e.disable=!a,o.a.get().setAccountData("org.matrix.preview_urls",e)}if("breadcrumb_rooms"===e){let e=this.getSettings("im.vector.setting.breadcrumbs");return e&&e.recent_rooms||(e=this.getSettings("im.vector.riot.breadcrumb_rooms")),e||(e={}),e.recent_rooms=a,o.a.get().setAccountData("im.vector.setting.breadcrumbs",e)}if("recent_emoji"===e){const e=this.getSettings("io.element.recent_emoji")||{};return e.recent_emoji=a,o.a.get().setAccountData("io.element.recent_emoji",e)}if("integrationProvisioning"===e){const e=this.getSettings("im.vector.setting.integration_provisioning")||{};return e.enabled=a,o.a.get().setAccountData("im.vector.setting.integration_provisioning",e)}const n=this.getSettings()||{};return n[e]=a,o.a.get().setAccountData("im.vector.web.settings",n)}canSetValue(e,t){return!0}isSupported(){const e=o.a.get();return null!=e&&!e.isGuest()}getSettings(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"im.vector.web.settings";const t=o.a.get();if(!t)return null;const a=t.getAccountData(e);return a&&a.getContent()?Object(h.a)(a.getContent()):null}notifyBreadcrumbsUpdate(e){let t=[];if("im.vector.riot.breadcrumb_rooms"===e.getType()){const a=this.getSettings("im.vector.setting.breadcrumbs");t=a?a.recent_rooms:e.getContent().rooms}else{if("im.vector.setting.breadcrumbs"!==e.getType())return;t=e.getContent().recent_rooms}this.watchers.notifyUpdate("breadcrumb_rooms",null,r.a.ACCOUNT,t||[])}}class v extends u.a{constructor(e){super(),this.watchers=e,s()(this,"onEvent",(e,t,a)=>{const n=e.getRoomId(),s=this.client.getRoom(n);if(s&&(!s||t===s.currentState))if("org.matrix.room.preview_urls"===e.getType()){let t=e.getContent().disable;t="boolean"!=typeof t?null:!t,this.watchers.notifyUpdate("urlPreviewsEnabled",n,r.a.ROOM,t)}else if("im.vector.web.settings"===e.getType()){const t=a?a.getContent():{},s=Object(h.d)(t,e.getContent());for(const t of s)this.watchers.notifyUpdate(t,n,r.a.ROOM,e.getContent()[t])}})}initMatrixClient(e,t){e&&e.removeListener("RoomState.events",this.onEvent),t.on("RoomState.events",this.onEvent)}getValue(e,t){if("urlPreviewsEnabled"===e){const e=this.getSettings(t,"org.matrix.room.preview_urls")||{};return"boolean"!=typeof e.disable?null:!e.disable}return(this.getSettings(t)||{})[e]}setValue(e,t,a){if("urlPreviewsEnabled"===e){const e=this.getSettings(t,"org.matrix.room.preview_urls")||{};return e.disable=!a,o.a.get().sendStateEvent(t,"org.matrix.room.preview_urls",e)}const n=this.getSettings(t)||{};return n[e]=a,o.a.get().sendStateEvent(t,"im.vector.web.settings",n,"")}canSetValue(e,t){const a=o.a.get(),n=a.getRoom(t);let s="im.vector.web.settings";return"urlPreviewsEnabled"===e&&(s="org.matrix.room.preview_urls"),!!n&&n.currentState.maySendStateEvent(s,a.getUserId())}isSupported(){const e=o.a.get();return null!=e}getSettings(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"im.vector.web.settings";const a=o.a.get().getRoom(e);if(!a)return null;const n=a.currentState.getStateEvents(t,"");return n&&n.getContent()?Object(h.a)(n.getContent()):null}}var b=a(110),y=a(1);class E extends i.a{constructor(e){super(),this.featureNames=e}getValue(e,t){const a=b.a.get()||{};if(this.featureNames.includes(e)){const t=(a.features||{})[e];return Object(y.o)(t)?null:!0===t||!1===t?t:"enable"===t||"disable"!==t&&null}if("theme"===e)return a.default_theme;const n=a.settingDefaults;return!n||Object(y.o)(n[e])?null:n[e]}async setValue(e,t,a){throw new Error("Cannot change settings at the config level")}canSetValue(e,t){return!1}isSupported(){return!0}}var _=a(93),S=a(100),C=a(1540);class w extends i.a{constructor(e){super(),this.handler=e,s()(this,"cache",{})}getValue(e,t){const a=t||"UNDEFINED",n=this.cache[e];return n&&n.hasOwnProperty(a)?n[a]:this.handler.getValue(e,t)}setValue(e,t,a){this.cache[e]||(this.cache[e]={});const n=this.cache[e],s=t||"UNDEFINED";n[s]=a;const i=this.handler.setValue(e,t,a);return Promise.resolve(i).finally(()=>{delete n[s]})}canSetValue(e,t){return this.handler.canSetValue(e,t)}isSupported(){return this.handler.isSupported()}}const O=Symbol("irrelevant-room");const x=new class{constructor(){s()(this,"watchers",new Map)}watchSetting(e,t,a){this.watchers.has(e)||this.watchers.set(e,new Map),this.watchers.get(e).has(t)||this.watchers.get(e).set(t,[]),this.watchers.get(e).get(t).push(a)}unwatchSetting(e){this.watchers.forEach(t=>{t.forEach(t=>{let a;for(;-1!==(a=t.indexOf(e));)t.splice(a,1)})})}notifyUpdate(e,t,a,n){if(!this.watchers.has(e))return;const s=this.watchers.get(e),i=[];if(null!==t&&s.has(t)&&i.push(...s.get(t)),t)s.has(O)&&i.push(...s.get(O));else{const e=Array.from(s.values()).flat(1);e.push(...e)}for(const e of i)e(t,a,n)}},R={},k={},I=[];for(const e of Object.keys(C.a))R[e]=C.a[e].default,C.a[e].isFeature&&I.push(e),C.a[e].invertedSettingName&&(k[C.a[e].invertedSettingName]=!C.a[e].default);const T={[r.a.DEVICE]:new c(I,x),[r.a.ROOM_DEVICE]:new d(x),[r.a.ROOM_ACCOUNT]:new p(x),[r.a.ACCOUNT]:new f(x),[r.a.ROOM]:new v(x),[r.a.CONFIG]:new E(I),[r.a.DEFAULT]:new m(R,k)};for(const e of Object.keys(T))T[e]=new w(T[e]);const P=[r.a.DEVICE,r.a.ROOM_DEVICE,r.a.ROOM_ACCOUNT,r.a.ACCOUNT,r.a.ROOM,r.a.CONFIG,r.a.DEFAULT];class N{static getFeatureSettingNames(){return Object.keys(C.a).filter(e=>N.isFeature(e))}static watchSetting(e,t,a){const n=C.a[e],s=e;if(!n)throw new Error(e+" is not a setting");n.invertedSettingName&&(e=n.invertedSettingName);const i=`${(new Date).getTime()}_${N.watcherCount++}_${e}_${t}`,o=(e,t,n)=>{const i=N.getValue(s);a(s,e,t,n,i)};return N.watchers.set(i,o),x.watchSetting(e,t,o),i}static unwatchSetting(e){N.watchers.has(e)?(x.unwatchSetting(N.watchers.get(e)),N.watchers.delete(e)):console.warn("Ending non-existent watcher ID "+e)}static monitorSetting(e,t){t=t||null,this.monitors.has(e)||this.monitors.set(e,new Map);const a=()=>{this.monitors.get(e).set(t,N.watchSetting(e,t,(e,t,a,n,s)=>{S.a.dispatch({action:"setting_updated",settingName:e,roomId:t,level:a,newValueAtLevel:n,newValue:s})}))},n=Array.from(this.monitors.get(e).keys());n.find(e=>e===t||null===e)?null===t&&(n.forEach(t=>{N.unwatchSetting(this.monitors.get(e).get(t))}),this.monitors.get(e).clear(),a()):a()}static getDisplayName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.a.DEFAULT;if(!C.a[e]||!C.a[e].displayName)return null;let a=C.a[e].displayName;return a instanceof Object&&(a=a[t]?a[t]:a.default),Object(_.a)(a)}static isFeature(e){return!!C.a[e]&&C.a[e].isFeature}static getBetaInfo(e){var t;if(N.isFeature(e)&&!1!==N.getValueAt(r.a.CONFIG,e,null,!0,!0))return null===(t=C.a[e])||void 0===t?void 0:t.betaInfo}static isEnabled(e){return!!C.a[e]&&(!C.a[e].controller||!C.a[e].controller.settingDisabled)}static getValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!C.a[e])throw new Error("Setting '"+e+"' does not appear to be a setting.");const n=C.a[e],s=n.supportedLevelsAreOrdered?n.supportedLevels:P;return N.getValueAt(s[0],e,t,!1,a)}static getValueAt(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i=C.a[t];if(!i)throw new Error("Setting '"+t+"' does not appear to be a setting.");const o=i.supportedLevelsAreOrdered?i.supportedLevels:P;o.includes(r.a.DEFAULT)||o.push(r.a.DEFAULT);const l=o.indexOf(e);if(-1===l)throw new Error("Level "+e+" is not prioritized");const c=N.getHandlers(t);if(i.invertedSettingName&&(t=i.invertedSettingName),n){const n=c[e];if(!n)return N.getFinalValue(i,e,a,null,null);const s=n.getValue(t,a);return N.getFinalValue(i,e,a,s,e)}for(let n=l;n<o.length;n++){const r=c[o[n]];if(!r)continue;if(s&&"default"===o[n])continue;const l=r.getValue(t,a);if(null!=l)return N.getFinalValue(i,e,a,l,o[n])}return N.getFinalValue(i,e,a,null,null)}static getDefaultValue(e){if(!C.a[e])throw new Error("Setting '"+e+"' does not appear to be a setting.");return C.a[e].default}static getFinalValue(e,t,a,n,s){let i=n;if(e.controller){const o=e.controller.getValueOverride(t,a,n,s);null!=o&&(i=o)}return e.invertedSettingName&&(i=!i),i}static async setValue(e,t,a,n){const s=C.a[e];if(!s)throw new Error("Setting '"+e+"' does not appear to be a setting.");const i=N.getHandler(e,a);if(!i)throw new Error("Setting "+e+" does not have a handler for "+a);if(s.invertedSettingName&&(e=s.invertedSettingName,n=!n),!i.canSetValue(e,t))throw new Error("User cannot set "+e+" at "+a+" in "+t);await i.setValue(e,t,n);const o=s.controller;o&&o.onChange(a,t,n)}static canSetValue(e,t,a){var n;if(!C.a[e])throw new Error("Setting '"+e+"' does not appear to be a setting.");if(N.isFeature(e)&&(null===(n=C.a[e])||void 0===n||!n.betaInfo)){const a=N.getValueAt(r.a.CONFIG,e,t,!0,!0);if(!0===a||!1===a)return!1}const s=N.getHandler(e,a);return!!s&&s.canSetValue(e,t)}static isLevelSupported(e){return!!T[e]&&T[e].isSupported()}static firstSupportedLevel(e){const t=C.a[e];if(!t)throw new Error("Setting '"+e+"' does not appear to be a setting.");const a=t.supportedLevelsAreOrdered?t.supportedLevels:P;a.includes(r.a.DEFAULT)||a.push(r.a.DEFAULT);const n=N.getHandlers(e);for(const e of a){if(n[e])return e}return null}static debugSetting(e,t){console.log("--- DEBUG "+e);const a=C.a[e];console.log("--- definition: "+(a?JSON.stringify(a):"<NOT_FOUND>")),console.log("--- default level order: "+JSON.stringify(P)),console.log("--- registered handlers: "+JSON.stringify(Object.keys(T)));const n=e=>{for(const a of Object.keys(T)){const n=T[a];try{const s=n.getValue(e,t);console.log(`---     ${a}@${t||"<no_room>"} = ${JSON.stringify(s)}`)}catch(e){console.log(`---     ${n}@${t||"<no_room>"} THREW ERROR: ${e.message}`),console.error(e)}if(t)try{const t=n.getValue(e,null);console.log(`---     ${a}@<no_room> = ${JSON.stringify(t)}`)}catch(e){console.log(`---     ${n}@<no_room> THREW ERROR: ${e.message}`),console.error(e)}}console.log("--- calculating as returned by SettingsStore"),console.log("--- these might not match if the setting uses a controller - be warned!");try{const a=N.getValue(e,t);console.log(`---     SettingsStore#generic@${t||"<no_room>"}  = ${JSON.stringify(a)}`)}catch(e){console.log(`---     SettingsStore#generic@${t||"<no_room>"} THREW ERROR: ${e.message}`),console.error(e)}if(t)try{const t=N.getValue(e,null);console.log("---     SettingsStore#generic@<no_room>  = "+JSON.stringify(t))}catch(e){console.log("---     SettingsStore#generic@$<no_room> THREW ERROR: "+e.message),console.error(e)}for(const a of P){try{const n=N.getValueAt(a,e,t);console.log(`---     SettingsStore#${a}@${t||"<no_room>"} = ${JSON.stringify(n)}`)}catch(e){console.log(`---     SettingsStore#${a}@${t||"<no_room>"} THREW ERROR: ${e.message}`),console.error(e)}if(t)try{const t=N.getValueAt(a,e,null);console.log(`---     SettingsStore#${a}@<no_room> = ${JSON.stringify(t)}`)}catch(e){console.log(`---     SettingsStore#${a}@$<no_room> THREW ERROR: ${e.message}`),console.error(e)}}};n(e),a.invertedSettingName&&(console.log("--- TESTING INVERTED SETTING NAME"),console.log("--- inverted: "+a.invertedSettingName),n(a.invertedSettingName)),console.log("--- END DEBUG")}static getHandler(e,t){const a=N.getHandlers(e);return a[t]?a[t]:null}static getHandlers(e){if(!C.a[e])return{};const t={};for(const a of C.a[e].supportedLevels){if(!T[a])throw new Error("Unexpected level "+a);N.isLevelSupported(a)&&(t[a]=T[a])}return t.default||(t.default=T.default),t}}s()(N,"watchers",new Map),s()(N,"monitors",new Map),s()(N,"watcherCount",1),window.mxSettingsStore=N},105:function(e,t){e.exports=Object.freeze({DOCTOR_NOTE:[{field:"parts",html:"<p>\n                  - sinh dục: chú ý phát hiện và ghi nhận: vết loét, sẩn, sưng, sùi mào gà, chảy mủ quy đầu, khí hư, .....\n                </p>\n                <p>\n                    - tiết niệu: Tiểu buốt/ tiểu rát? Lượng nước tiểu/24h? TÍnh chất/màu sắc nước tiểu ? Đau vùng thắt lưng?\n    \n                </p>\n                <p>\n                    - ngực: Có khó thở (khi sinh hoạt bình thường và lao động gắng sức? Có đau vùng ngực? Tính chất đau?\n    \n                </p>\n                <p>\n                    - Bụng: Có đau? U cục bất thường?\n                </p>\n                <p>\n                    - Cơ xương khớp: Có hạn chế vận động?\n                </p>",title:"2 các bộ phận :"}],HEALTH_ORGANIZATION_TYPE:[{name:"Phòng khám",value:1},{name:"Phòng xét nghiệm",value:2},{name:"Nhà thuốc",value:3},{name:"Nhà thuốc liên kết",value:4},{name:"Phòng xét nghiệm liên kết",value:5}],NEXT_TIME_ENCOUNTER:[{label:"T0",value:1},{label:"T1",value:2},{label:"T3",value:3},{label:"T6",value:3},{label:"T9",value:3},{label:"T12",value:3}],ENCOUNTER_STATUS:[{value:1,name:"Nháp",color:"#c92525"},{value:2,name:"Chờ xác nhận xét nghiệm",color:"#c92525"},{value:3,name:"Chờ kết quả xét nghiệm",color:"#74d3f6"},{value:4,name:"Đã cập nhật kết quả chờ đặt lịch",color:"#67d097"},{value:5,name:"Đã đặt lịch chờ khám",color:"#3f51b5"},{value:6,name:"Đã khám – chờ tái khám",color:"#2a80c8"}],ADMINISTRATIVE_UNIT_LEVEL:[{value:3,name:"Tỉnh"},{value:4,name:"Quận/Huyện"},{value:5,name:"Phường/Xã"}],GENDER:[{value:"M",name:"Nam"},{value:"F",name:"Nữ"},{value:"U",name:"Không rõ"}],ROLE:[{id:1,name:"ROLE_ADMIN",description:null,authority:"ROLE_ADMIN"},{id:4,name:"ROLE_CLINIC",description:null,authority:"ROLE_CLINIC"}],STATUS:[{value:0,name:"Thất bại"},{value:1,name:"Thành công"}],SERVICE_TYPE:[{key:"HAS_FEE",value:1,name:"Trả phí"},{key:"FREE",value:2,name:"Miễn phí"}],CLIENT_RESOURCE_TYPE:[{value:0,name:"Khách hàng tự đến"},{value:1,name:"Được cơ sở y tế giới thiệu"},{value:2,name:"Nhóm cộng đồng giới thiệu"},{value:3,name:"Khác"}],ANSWER_SCORE:[{value:0,name:"0*",display:"Không cần sử dụng"},{value:1,name:"*",display:"Xem xét chỉ định thuốc"},{value:2,name:"**",display:"Đánh giá PEP"},{value:3,name:"***",display:"Theo dõi tình trạng nguy cấp"},{value:4,name:"#",display:"Xem xét sử dụng thuốc theo tình huống"}],QUESTION_TYPE:[{value:1,name:"Mức 1"},{value:2,name:"Mức 2"},{value:3,name:"Mức 3"}],LABTEST_TYPE:[{value:"1",name:"Xét nghiệm máu"},{value:"2",name:"Xét nghiệm nước tiểu"}],LABTEST_RESULT_TYPE:[{value:"1",name:"Giá trị số"},{value:"2",name:"Giá trị chữ"}],REGIMENT_TYPE:[{value:"1",name:"Daily"},{value:"2",name:"Theo đợt"},{value:"3",name:"Kết hợp cả 2"}],TREATMENT_PERIOD_STATUS:[{value:0,name:"Chưa đăng ký điều trị"},{value:7,name:"Chờ PK xác nhận hồ sơ"},{value:1,name:"Chờ chỉ định xét nghiệm"},{value:2,name:"Chờ KH chọn dịch vụ XN"},{value:3,name:"Chờ kết quả xét nghiệm"},{value:4,name:"Chờ đặt lịch"},{value:5,name:"Đã đặt lịch chờ khám"},{value:6,name:"Chờ tái khám"},{value:-1,name:"Đã kết thúc điều trị"}],TREATMENT_PERIOD_STATUS_FINISHED:-1,APPOINTMENT_PLACE:[{value:1,name:"Khám từ xa"},{value:2,name:"Tại phòng khám"}],DEGREE_OF_ADHERENCE_TREATMENT:[{value:1,name:"Tốt"},{value:2,name:"Trung bình"},{value:3,name:"Kém"},{value:4,name:"Không xác định"}],MOTOR_FUNCTION:[{value:1,name:"Làm việc bình thường(L)"},{value:2,name:"Nằm tại giường(N)"},{value:3,name:"Đi lại được(Đ)"}],VALUE_CODE_DATA_TYPE:[{value:1,name:"Integer"},{value:2,name:"Text"},{value:3,name:"Double"},{value:4,name:"Boolean"},{value:5,name:"UUID"}],DRUG_ORDER_TYPE:[{value:1,name:"Theo phác đồ"},{value:2,name:"Thuốc khác"}],DRUG_ORDER_TYPE_REGIMEN:1,DRUG_ORDER_TYPE_OTHER:2,PAYMENT_STATUS:[{value:null,name:"Tất cả"},{value:1,name:"Mới lập"},{value:2,name:"Phòng khám xác nhận"},{value:3,name:"Đã chuyển tiền"},{value:4,name:"Đã nhận được"}],PAYMENT_STATUS_SELECT:[{value:1,name:"Mới lập"},{value:2,name:"Phòng khám xác nhận"},{value:3,name:"Đã chuyển tiền"},{value:4,name:"Đã nhận được"}],BILL_TYPE:[{value:1,name:"Dịch vụ xét nghiệm"},{value:2,name:"Dịch vụ khám bệnh"},{value:3,name:"Hóa đơn thuốc"}],PAYMENT_METHOD:[{value:1,name:"Tiền mặt"},{value:2,name:"Chuyển khoản"}],TYPE_OF_SERVICE:[{value:1,name:"Tại phòng khám"},{value:2,name:"Tại đơn vị liên kết"},{value:3,name:"Khác"}],PATIENT_STATUS:[{value:0,name:"Chưa từng điều trị"},{value:1,name:"Đang điều trị"},{value:2,name:"Đã dừng điều trị"}],MAX_IMAGE_FILE:2097152,TEST_STATUS:[{value:1,name:"Đã nhận chỉ định xét nghiệm từ phòng khám"},{value:2,name:"Khách hàng chọn dịch vụ và đặt lịch"},{value:3,name:"Đã có kết quả"}],CLINIC_INFORMATION_TYPE:[{value:1,name:"Thông tin chuyển khoản thanh toán"},{value:2,name:"Thông tin liên hệ tiếp đón"},{value:3,name:"Thông tin liên hệ thanh toán"},{value:4,name:"Thông tin liên hệ nhà thuốc"}],BIRTH_GENDER:[{value:"M",name:"Nam"},{value:"F",name:"Nữ"}],PRACTITIONER_MEDICAL_RECORD_FILE:{MEDICAL_RECORD:1,TRANSIT_PAPER_FILES:2},PRACTITIONER_MEDICAL_RECORD_ATTACK_IMAGE:{IDCARD_FRONT:1,IDCARD_BACK:2,HAND_SIGN:3,IDENTITY_DOCUMENTS:4},PRESCRIPTION_STATUS:[{value:1,name:"Mới tiếp nhận",color:"#c92525"},{value:2,name:"Đang xử lý",color:"#74d3f6"},{value:3,name:"Đã gửi đi",color:"#67d097"},{value:4,name:"Đã nhận",color:"#232f32"}],PRESCRIPTION_STATUS_DRUG:[{value:1,name:"Mới tiếp nhận",color:"#c92525"},{value:2,name:"Đang xử lý",color:"#74d3f6"},{value:3,name:"Đã gửi đi",color:"#67d097"},{value:4,name:"Đã nhận",color:"#232f32"}],PRESCRIPTION_STATUS_NEW:1,PRESCRIPTION_STATUS_DRUG_STORE:2,PRESCRIPTION_STATUS_USER:3,PRESCRIPTION_RECEIVE_TYPE:[{value:1,name:"Tại nhà"},{value:2,name:"Tại phòng khám"},{value:3,name:"Tại nhà thuốc"}],DRUG_MANAGEMENT_INPUT_UNIT:[{value:1,name:"Hộp"},{value:2,name:"Viên"},{value:3,name:"Lọ"},{value:4,name:"Chai (ml)"}],DRUG_MANAGEMENT_INPUT_UNIT_BOX:1,DRUG_MANAGEMENT_INPUT_UNIT_JAR:3,APPOINTMENT_STATUS:[{value:-1,name:"Hủy"},{value:0,name:"Mới đặt lịch"},{value:1,name:"Đã xác nhận lịch"},{value:2,name:"Đã khám"}],REASON_ENDING_TREATMENT:[{value:1,name:"Dừng sử dụng thuốc do tác dụng phụ"},{value:2,name:"Dừng sử dụng do độc tính của thuốc"},{value:3,name:"Dừng sử dụng do khách hàng khỏi bệnh"},{value:4,name:"Dừng do nguyên nhân khác (di chuyển nơi ở …)"},{value:5,name:"Mất dấu khách hàng (trong vòng 30 ngày kể từ ngày hẹn tái khám)"}],TOAST_CONFIGURE:{autoClose:1500,draggable:!1,closeOnClick:!0},NEVERBEENTREATED:{name:"Lần đầu sử dụng",value:0},BEINGTREATED:{name:"Đang sử dụng",value:1},TREATMENTSTOPPED:{name:"Dừng sử dụng",value:2},CUSTOMER_REPORT_TYPE:[{name:"Lần đầu sử dụng",value:0},{name:"Đang sử dụng",value:1},{name:"Dừng sử dụng",value:2}],NOTIFICATION_TYPE:[{value:1,name:"BN gửi kết quả sàng lọc"},{value:2,name:"PK chỉ định xét nghiệm"},{value:3,name:"Khách hàng lựa chọn dịch vụ"},{value:4,name:"Bệnh đã nhân đính kèm file"},{value:5,name:"PXN đã nhập kết quả"},{value:6,name:"BN đã đặt lịch"},{value:7,name:"Phòng khám đã chỉ định bác sĩ"},{value:8,name:"Kết thúc thăm khám"},{value:9,name:"Khác"}],NOTIFICATION_TYPE_CONST:{SEND_SCREENING:1,SEND_TEST:2,SERVICE_SELECTION:3,FILE_ATTACKED:4,RESULT_UPDATE:5,BOOKING:6,APPOINT_DOCTOR:7,END_ENCOUNTER:8},PATIENT_CURRENT_TREATMENT_STATUS_TYPE:[{value:1,name:"Chưa sử dụng hoặc đã ngừng sử dụng"},{value:2,name:"Khách hàng đang điều trị tại phòng khám"},{value:3,name:"Khách hàng từ phòng khám khác"}],DAY_IN_WEEK:[{value:0,name:"Chủ Nhật"},{value:1,name:"Thứ 2"},{value:2,name:"Thứ 3"},{value:3,name:"Thứ 4"},{value:4,name:"Thứ 5"},{value:5,name:"Thứ 6"},{value:6,name:"Thứ 7"}],PATIENT_PROFILE_STATUS:[{value:1,name:"Chưa có hồ sơ"},{value:2,name:"Đã tải lên hồ sơ"},{value:3,name:"Cần bổ sung hồ sơ"},{value:4,name:"Đã xác nhận"},{value:5,name:"KH yêu cầu cập nhật thông tin"}],RECEIVE_TYPE_AT_HOME:1,RECEIVE_TYPE_AT_PHARMACY:3,RECEIVE_TYPE:[{value:1,name:"Tại nhà"},{value:3,name:"Tại nhà thuốc"}],REPORT_BY_PATIENT_STATUS_TYPE_DATE:{name:"Theo ngày",value:1},REPORT_BY_PATIENT_STATUS_TYPE_MONTH:{name:"Theo tháng",value:2},REPORT_BY_PATIENT_STATUS_TYPE_YEAR:{name:"Theo năm",value:3},REPORT_BY_PATIENT_STATUS_TYPE_QUARTER:{name:"Theo quý",value:4},REPORT_BY_PATIENT_STATUS_TYPE_HAFT_YEAR:{name:"Nửa năm",value:5},REPORT_BY_PATIENT_STATUS_TYPE:[{name:"Theo ngày",value:1},{name:"Theo tháng",value:2},{name:"Theo năm",value:3},{name:"Theo quý",value:4},{name:"Nửa năm",value:5}],DRUG_MANAGEMENT_TYPE:[{name:"Nhập",value:1},{name:"Xuất",value:2}],DRUG_MANAGEMENT_TYPE_IMPORT:1,DRUG_MANAGEMENT_TYPE_EXPORT:2,DRUG_BUY_FOR_MYSELF:[{label:"Nhận thuốc của phòng khám",value:!1},{label:"Khách hàng tự mua thuốc",value:!0}],PATIENT_MEDICAL_RECORD_ATTACK_IMAGE:{IDCARD_FRONT:1,IDCARD_BACK:2,HAND_SIGN:3},REQUEST_TYPE:[{name:"Dạng lựa chọn",value:"TRUE_OR_FALSE"},{name:"Dạng lựa chọn và kèm ghi chú",value:"TRUE_OR_FALSE_AND_TEXT"},{name:"Dạng ghi chú",value:"TEXT"}],PATIENT_TYPE:[{name:"Trên 18 tuổi",value:"OVER_18"},{name:"Dưới 18 tuổi",value:"UNDER_18"}]})},106:function(e,t,a){"use strict";var n=a(95),s=a.n(n),i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(129),d=a.n(c),m=a(102),u=a.n(m),h=a(181),p=a(100),g=a(211),f=a(97),v=a(92),b=a.n(v),y=a(93);class E extends l.a.Component{constructor(){super(...arguments),o()(this,"state",{component:null,error:null}),o()(this,"_onWrapperCancelClick",()=>{this.props.onFinished(!1)})}componentDidMount(){this._unmounted=!1,console.log("Starting load of AsyncWrapper for modal"),this.props.prom.then(e=>{if(this._unmounted)return;const t=e.default?e.default:e;this.setState({component:t})}).catch(e=>{console.warn("AsyncWrapper promise failed",e),this.setState({error:e})})}componentWillUnmount(){this._unmounted=!0}render(){if(this.state.component){const e=this.state.component;return l.a.createElement(e,this.props)}if(this.state.error){const e=f.getComponent("views.dialogs.BaseDialog"),t=f.getComponent("views.elements.DialogButtons");return l.a.createElement(e,{onFinished:this.props.onFinished,title:Object(y.a)("Error")},Object(y.a)("Unable to load! Check your network connectivity and try again."),l.a.createElement(t,{primaryButton:Object(y.a)("Dismiss"),onPrimaryButtonClick:this._onWrapperCancelClick,hasCancel:!1}))}{const e=f.getComponent("elements.Spinner");return l.a.createElement(e,null)}}}o()(E,"propTypes",{prom:b.a.object.isRequired});class _{constructor(){o()(this,"counter",0),o()(this,"priorityModal",null),o()(this,"staticModal",null),o()(this,"modals",[]),o()(this,"onBackgroundClick",()=>{const e=this.getCurrentModal();e&&(e.closeReason="backgroundClick",e.close(),e.closeReason=null)})}static getOrCreateContainer(){let e=document.getElementById("mx_Dialog_Container");return e||(e=document.createElement("div"),e.id="mx_Dialog_Container",document.body.appendChild(e)),e}static getOrCreateStaticContainer(){let e=document.getElementById("mx_Dialog_StaticContainer");return e||(e=document.createElement("div"),e.id="mx_Dialog_StaticContainer",document.body.appendChild(e)),e}toggleCurrentDialogVisibility(){const e=this.getCurrentModal();e&&(e.hidden=!e.hidden)}hasDialogs(){return this.priorityModal||this.staticModal||this.modals.length>0}createTrackedDialog(e,t){h.a.trackEvent("Modal",e,t);for(var a=arguments.length,n=new Array(a>2?a-2:0),s=2;s<a;s++)n[s-2]=arguments[s];return this.createDialog(...n)}appendTrackedDialog(e,t){h.a.trackEvent("Modal",e,t);for(var a=arguments.length,n=new Array(a>2?a-2:0),s=2;s<a;s++)n[s-2]=arguments[s];return this.appendDialog(...n)}createDialog(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];return this.createDialogAsync(Promise.resolve(e),...a)}appendDialog(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];return this.appendDialogAsync(Promise.resolve(e),...a)}createTrackedDialogAsync(e,t){h.a.trackEvent("Modal",e,t);for(var a=arguments.length,n=new Array(a>2?a-2:0),s=2;s<a;s++)n[s-2]=arguments[s];return this.createDialogAsync(...n)}appendTrackedDialogAsync(e,t){h.a.trackEvent("Modal",e,t);for(var a=arguments.length,n=new Array(a>2?a-2:0),s=2;s<a;s++)n[s-2]=arguments[s];return this.appendDialogAsync(...n)}closeCurrentModal(e){const t=this.getCurrentModal();t&&(t.closeReason=e,t.close())}buildModal(e,t,a,n){const i={onFinished:t?t.onFinished:null,onBeforeClose:n.onBeforeClose,beforeClosePromise:null,closeReason:null,className:a,elem:null,close:null},[o,r]=this.getCloseFn(i,t),c=this.counter++;return i.elem=l.a.createElement(E,s()({key:c,prom:e},t,{onFinished:o})),i.close=o,{modal:i,closeDialog:o,onFinishedProm:r}}getCloseFn(e,t){var a=this;const n=Object(g.a)();return[async function(){if(e.beforeClosePromise)await e.beforeClosePromise;else if(e.onBeforeClose){e.beforeClosePromise=e.onBeforeClose(e.closeReason);const t=await e.beforeClosePromise;if(e.beforeClosePromise=null,!t)return}for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];n.resolve(i),t&&t.onFinished&&t.onFinished.apply(null,i);const r=a.modals.indexOf(e);r>=0&&a.modals.splice(r,1),a.priorityModal===e&&(a.priorityModal=null,a.modals=[]),a.staticModal===e&&(a.staticModal=null,a.modals=[]),a.reRender()},n.promise]}createDialogAsync(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const{modal:o,closeDialog:r,onFinishedProm:l}=this.buildModal(e,t,a,i);return n?this.priorityModal=o:s?this.staticModal=o:this.modals.unshift(o),this.reRender(),{close:r,finished:l}}appendDialogAsync(e,t,a){const{modal:n,closeDialog:s,onFinishedProm:i}=this.buildModal(e,t,a,{});return this.modals.push(n),this.reRender(),{close:s,finished:i}}getCurrentModal(){return this.priorityModal?this.priorityModal:this.modals[0]||this.staticModal}reRender(){if(0===this.modals.length&&!this.priorityModal&&!this.staticModal)return p.a.dispatch({action:"aria_unhide_main_app"}),d.a.unmountComponentAtNode(_.getOrCreateContainer()),void d.a.unmountComponentAtNode(_.getOrCreateStaticContainer());if(p.a.dispatch({action:"aria_hide_main_app"}),this.staticModal){const e=u()("mx_Dialog_wrapper mx_Dialog_staticWrapper",this.staticModal.className),t=l.a.createElement("div",{className:e},l.a.createElement("div",{className:"mx_Dialog"},this.staticModal.elem),l.a.createElement("div",{className:"mx_Dialog_background mx_Dialog_staticBackground",onClick:this.onBackgroundClick}));d.a.render(t,_.getOrCreateStaticContainer())}else d.a.unmountComponentAtNode(_.getOrCreateStaticContainer());const e=this.getCurrentModal();if(e===this.staticModal||e.hidden)d.a.unmountComponentAtNode(_.getOrCreateContainer());else{const t=u()("mx_Dialog_wrapper",e.className,{mx_Dialog_wrapperWithStaticUnder:this.staticModal}),a=l.a.createElement("div",{className:t},l.a.createElement("div",{className:"mx_Dialog"},e.elem),l.a.createElement("div",{className:"mx_Dialog_background",onClick:this.onBackgroundClick}));d.a.render(a,_.getOrCreateContainer())}}}window.singletonModalManager||(window.singletonModalManager=new _);t.a=window.singletonModalManager},108:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(98),s=a.n(n),i=a(88),o=a.n(i),r=a(131),l=a(102),c=a.n(l);const d=["element","onClick","children","kind","disabled","inputRef","className"];function m(e){let{element:t,onClick:a,children:n,kind:i,disabled:l,inputRef:m,className:u}=e,h=s()(e,d);const p=h;return l||(p.onClick=a,p.onKeyDown=e=>{if(e.key===r.a.ENTER)return e.stopPropagation(),e.preventDefault(),a(e);e.key===r.a.SPACE&&(e.stopPropagation(),e.preventDefault())},p.onKeyUp=e=>{if(e.key===r.a.SPACE)return e.stopPropagation(),e.preventDefault(),a(e);e.key===r.a.ENTER&&(e.stopPropagation(),e.preventDefault())}),p.ref=m,p.className=c()("mx_AccessibleButton",u,{mx_AccessibleButton_hasKind:i,["mx_AccessibleButton_kind_"+i]:i,mx_AccessibleButton_disabled:l}),o.a.createElement(t,h,n)}m.defaultProps={element:"div",role:"button",tabIndex:0},m.displayName="AccessibleButton"},110:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(19),s=a.n(n);const i={brand:"Element",integrations_ui_url:"https://scalar.vector.im/",integrations_rest_url:"https://scalar.vector.im/api",bug_report_endpoint_url:null,jitsi:{preferredDomain:"jitsi.riot.im"},desktopBuilds:{available:!0,logo:a(2285),url:"https://element.io/get-started"}};class o{static setInstance(e){o.instance=e,window.mxReactSdkConfig=e}static get(){return o.instance||{}}static put(e){const t=Object.keys(i);for(let a=0;a<t.length;++a)void 0===e[t[a]]&&(e[t[a]]=i[t[a]]);o.setInstance(e)}static unset(){o.setInstance({})}static add(e){const t=o.get(),a=Object.assign({},t,e);o.put(a)}}s()(o,"instance",void 0)},112:function(e,t){e.exports=Object.freeze({ROOT_PATH:"/",ACTIVE_LAYOUT:"layout1",API_ENPOINT:"http://api.oceantech.vn/patient",ADMINISTRATIVE_UNIT_LEVEL:[{value:3,name:"Tỉnh"},{value:4,name:"Quận/Huyện"},{value:5,name:"Phường/Xã"}],GENDER:[{value:"M",name:"Nam"},{value:"F",name:"Nữ"},{value:"U",name:"Không rõ"}]})},115:function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),function(e){e.ViewUser="view_user",e.ViewUserSettings="view_user_settings",e.ViewRoomDirectory="view_room_directory",e.RecheckTheme="recheck_theme",e.CheckUpdates="check_updates",e.FocusComposer="focus_composer",e.ToggleUserMenu="toggle_user_menu",e.UpdateFontSize="update_font_size",e.UpdateSystemFont="update_system_font",e.ViewRoomDelta="view_room_delta",e.SetRightPanelPhase="set_right_panel_phase",e.ToggleRightPanel="toggle_right_panel",e.AfterRightPanelPhaseChange="after_right_panel_phase_change",e.OpenDialPad="open_dial_pad",e.DialNumber="dial_number",e.PstnSupportUpdated="pstn_support_updated",e.VirtualRoomSupportUpdated="virtual_room_support_updated",e.UploadStarted="upload_started",e.UploadProgress="upload_progress",e.UploadFinished="upload_finished",e.UploadFailed="upload_failed",e.UploadCanceled="upload_canceled",e.JoinRoom="join_room",e.JoinRoomReady="join_room_ready",e.JoinRoomError="join_room_error"}(n||(n={}))},119:function(e,t,a){"use strict";var n=a(88);const s=Object(n.createContext)(void 0);s.displayName="MatrixClientContext",t.a=s},1226:function(e,t,a){},123:function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),function(e){e.DEVICE="device",e.ROOM_DEVICE="room-device",e.ROOM_ACCOUNT="room-account",e.ACCOUNT="account",e.ROOM="room",e.CONFIG="config",e.DEFAULT="default"}(n||(n={}))},1245:function(e,t,a){"use strict";function n(e,t){const a=t.getUserId();for(const t of Object.keys(e.getContent())){if(Object.keys(e.getContent()[t]["m.read"]||{}).includes(a))return!0}}a.d(t,"a",(function(){return n}))},1246:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return r}));var n=a(99),s=a(1247),i=a(295);const o=e=>{let t="";n.a.get()&&(t=n.a.get().getUserId());const a={},o=e=>{if(a[e.roomId])return a[e.roomId];const n=(()=>{if(!e||!e.timeline)return Number.MAX_SAFE_INTEGER;if(Object(i.b)(e.getMyMembership())!==i.a.Join){const a=e.currentState.getStateEvents("m.room.member",t);if(a&&!Array.isArray(a))return a.getTs()}for(let a=e.timeline.length-1;a>=0;--a){const n=e.timeline[a];if(n.getTs()&&(n.getSender()===t||s.b(n)))return n.getTs()}return e.timeline.length&&e.timeline[0].getTs()?e.timeline[0].getTs():Number.MAX_SAFE_INTEGER})();return a[e.roomId]=n,n};return e.sort((e,t)=>o(t)-o(e))};class r{async sortRooms(e,t){return o(e)}}},1247:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return r}));var n=a(99),s=a(360),i=a(296);function o(e){return(!e.sender||e.sender.userId!=n.a.get().credentials.userId)&&("m.room.member"!=e.getType()&&("m.room.third_party_invite"!=e.getType()&&("m.call.answer"!=e.getType()&&"m.call.hangup"!=e.getType()&&(("m.room.message"!=e.getType()||"m.notify"!=e.getContent().msgtype)&&("m.room.aliases"!=e.getType()&&"m.room.canonical_alias"!=e.getType()&&("m.room.server_acl"!=e.getType()&&(!e.isRedacted()&&Object(i.b)(e))))))))}function r(e){const t=n.a.get().getUserId(),a=e.getEventReadUpTo(t);if(e.timeline.length&&e.timeline[e.timeline.length-1].sender&&e.timeline[e.timeline.length-1].sender.userId===t)return!1;for(let t=e.timeline.length-1;t>=0;--t){const n=e.timeline[t];if(n.getId()==a)return!1;if(!Object(s.a)(n)&&o(n))return!0}return!0}},1248:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i}));var n=a(1249);const s="https://matrix.to";class i extends n.b{constructor(){super()}forEvent(e,t,a){return`${s}/#/${e}/${t}${this.encodeServerCandidates(a)}`}forRoom(e,t){return`${s}/#/${e}${this.encodeServerCandidates(t)}`}forUser(e){return`${s}/#/${e}`}forGroup(e){return`${s}/#/${e}`}forEntity(e){return`${s}/#/${e}`}isPermalinkHost(e){return"matrix.to"===e}encodeServerCandidates(e){return e&&0!==e.length?"?via="+e.map(e=>encodeURIComponent(e)).join("&via="):""}parsePermalink(e){if(!e||!e.startsWith(s))throw new Error("Does not appear to be a permalink");const t=e.substring((s+"/#/").length).split("/"),a=t[0];if("@"===a[0])return n.a.forUser(a);if("+"===a[0])return n.a.forGroup(a);if("#"===a[0]||"!"===a[0]){if(1===t.length){const[e,t=""]=a.split("?"),s=t.split(/&?via=/g).filter(e=>!!e);return n.a.forRoom(e,s)}const e=t.length>1?t.slice(1).join("/"):"",[s,i=""]=e.split("?"),o=i.split(/&?via=/g).filter(e=>!!e);return n.a.forEvent(a,s,o)}throw new Error("Unknown entity type in permalink")}}},1249:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o}));var n=a(19),s=a.n(n);class i{forEvent(e,t,a){throw new Error("Not implemented")}forRoom(e,t){throw new Error("Not implemented")}forGroup(e){throw new Error("Not implemented")}forUser(e){throw new Error("Not implemented")}forEntity(e){throw new Error("Not implemented")}isPermalinkHost(e){throw new Error("Not implemented")}parsePermalink(e){throw new Error("Not implemented")}}class o{constructor(e,t,a,n,i){s()(this,"roomIdOrAlias",void 0),s()(this,"eventId",void 0),s()(this,"userId",void 0),s()(this,"groupId",void 0),s()(this,"viaServers",void 0),this.roomIdOrAlias=e,this.eventId=t,this.groupId=n,this.userId=a,this.viaServers=i}static forUser(e){return new o(null,null,e,null,null)}static forGroup(e){return new o(null,null,null,e,null)}static forRoom(e,t){return new o(e,null,null,null,t||[])}static forEvent(e,t,a){return new o(e,t,null,null,a||[])}get primaryEntityId(){return this.roomIdOrAlias||this.userId||this.groupId}get sigil(){return this.primaryEntityId[0]}}},126:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return l}));var n=a(19),s=a.n(n),i=a(99);class o{constructor(e,t){if(this.prepared=e,s()(this,"client",void 0),this.client=null!=t?t:i.a.get(),!this.client)throw new Error("No possible MatrixClient for media resolution. Please provide one or log in.")}get isEncrypted(){return!!this.prepared.file}get srcMxc(){return this.prepared.mxc}get thumbnailMxc(){var e;return null===(e=this.prepared.thumbnail)||void 0===e?void 0:e.mxc}get hasThumbnail(){return!!this.thumbnailMxc}get srcHttp(){return this.client.mxcUrlToHttp(this.srcMxc)}get thumbnailHttp(){return this.hasThumbnail?this.client.mxcUrlToHttp(this.thumbnailMxc):null}getThumbnailHttp(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"scale";return this.hasThumbnail?(e=Math.floor(e*window.devicePixelRatio),t=Math.floor(t*window.devicePixelRatio),this.client.mxcUrlToHttp(this.thumbnailMxc,e,t,a)):null}getThumbnailOfSourceHttp(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"scale";return e=Math.floor(e*window.devicePixelRatio),t=Math.floor(t*window.devicePixelRatio),this.client.mxcUrlToHttp(this.srcMxc,e,t,a)}getSquareThumbnailHttp(e){return e=Math.floor(e*window.devicePixelRatio),this.hasThumbnail?this.getThumbnailHttp(e,e,"crop"):this.getThumbnailOfSourceHttp(e,e,"crop")}downloadSource(){return fetch(this.srcHttp)}}function r(e,t){return new o(function(e){var t,a,n,s;let i=null;if(null!=e&&null!==(t=e.info)&&void 0!==t&&t.thumbnail_url?i={mxc:e.info.thumbnail_url,file:e.info.thumbnail_file}:null!=e&&null!==(a=e.info)&&void 0!==a&&null!==(n=a.thumbnail_file)&&void 0!==n&&n.url&&(i={mxc:e.info.thumbnail_file.url,file:e.info.thumbnail_file}),null!=e&&e.url)return{thumbnail:i,mxc:e.url,file:e.file};if(null!=e&&null!==(s=e.file)&&void 0!==s&&s.url)return{thumbnail:i,mxc:e.file.url,file:e.file};throw new Error("Invalid file provided: cannot determine MXC URI. Has it been redacted?")}(e),t)}function l(e,t){return r({url:e},t)}},127:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return P})),a.d(t,"b",(function(){return N})),a.d(t,"p",(function(){return D})),a.d(t,"k",(function(){return j})),a.d(t,"l",(function(){return A})),a.d(t,"m",(function(){return M})),a.d(t,"q",(function(){return U})),a.d(t,"o",(function(){return L})),a.d(t,"n",(function(){return F}));var n=a(95),s=a.n(n),i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(129),d=a.n(c),m=a(102),u=a.n(m),h=a(131),p=a(94),g=a(200),f=a(1331);a.d(t,"c",(function(){return f.a}));var v=a(497);a.d(t,"d",(function(){return v.a}));var b=a(1332);a.d(t,"e",(function(){return b.a}));var y=a(1333);a.d(t,"f",(function(){return y.a}));var E=a(1334);a.d(t,"g",(function(){return E.a}));var _=a(1335);a.d(t,"h",(function(){return _.a}));var S=a(1336);a.d(t,"i",(function(){return S.a}));var C,w,O,x=a(1337);function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function k(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}a.d(t,"j",(function(){return x.a}));function I(){let e=document.getElementById("mx_ContextualMenu_Container");return e||(e=document.createElement("div"),e.id="mx_ContextualMenu_Container",document.body.appendChild(e)),e}const T=new Set(["menuitem","menuitemcheckbox","menuitemradio"]);let P;!function(e){e.Top="top",e.Bottom="bottom",e.Left="left",e.Right="right",e.None="none"}(P||(P={}));let N=Object(p.a)("structures.ContextMenu")((w=class extends l.a.PureComponent{constructor(t,a){super(t,a),o()(this,"initialFocus",void 0),o()(this,"collectContextMenuRect",e=>{if(!e)return;let t=e.querySelector('[role^="menuitem"]');t||(t=e.querySelector("[tab-index]")),t&&t.focus(),this.setState({contextMenuElem:e})}),o()(this,"onContextMenu",t=>{if(this.props.onFinished){this.props.onFinished(),t.preventDefault(),t.stopPropagation();const a=t.clientX,n=t.clientY;e(()=>{const e=document.createEvent("MouseEvents");e.initMouseEvent("contextmenu",!0,!0,window,0,0,0,a,n,!1,!1,!1,!1,0,null),document.elementFromPoint(a,n).dispatchEvent(e)})}}),o()(this,"onContextMenuPreventBubbling",e=>{e.stopPropagation()}),o()(this,"onFinished",e=>{e.stopPropagation(),e.preventDefault(),this.props.onFinished&&this.props.onFinished()}),o()(this,"onMoveFocus",(e,t)=>{let a=!1;do{const n=t?e.lastElementChild:e.firstElementChild,s=t?e.previousElementSibling:e.nextElementSibling;a?n?e=n:s?e=s:(a=!1,e=e.parentElement):s?(e=s,a=!0):e=e.parentElement,e&&e.classList.contains("mx_ContextualMenu")&&(e=t?e.lastElementChild:e.firstElementChild,a=!0)}while(e&&!T.has(e.getAttribute("role")));e&&e.focus()}),o()(this,"onMoveFocusHomeEnd",(e,t)=>{let a=e.querySelectorAll('[role^="menuitem"]');a||(a=e.querySelectorAll("[tab-index]")),a&&a.length&&(t?a[0].focus():a[a.length-1].focus())}),o()(this,"onKeyDown",e=>{if(e.stopPropagation(),!this.props.managed)return void(e.key===h.a.ESCAPE&&(this.props.onFinished(),e.preventDefault()));let t=!0;switch(e.key){case h.a.TAB:case h.a.ESCAPE:case h.a.ARROW_LEFT:case h.a.ARROW_RIGHT:this.props.onFinished();break;case h.a.ARROW_UP:this.onMoveFocus(e.target,!0);break;case h.a.ARROW_DOWN:this.onMoveFocus(e.target,!1);break;case h.a.HOME:this.onMoveFocusHomeEnd(this.state.contextMenuElem,!0);break;case h.a.END:this.onMoveFocusHomeEnd(this.state.contextMenuElem,!1);break;default:t=!1}t&&e.preventDefault()}),this.state={contextMenuElem:null},this.initialFocus=document.activeElement}componentWillUnmount(){this.initialFocus.focus()}renderMenu(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.hasBackground;const t={},a=this.props;let n;a.top?t.top=a.top:t.bottom=a.bottom,a.left?(t.left=a.left,n=P.Left):(t.right=a.right,n=P.Right);const s=this.state.contextMenuElem?this.state.contextMenuElem.getBoundingClientRect():null,i={};a.chevronFace&&(n=a.chevronFace);const o=n&&n!==P.None;if(n===P.Top||n===P.Bottom)i.left=a.chevronOffset;else if(void 0!==t.top){const e=t.top;let n=e;if(s){const e=10;n=Math.min(t.top,document.body.clientHeight-s.height-e)}t.top=n,i.top=Math.max(a.chevronOffset,a.chevronOffset+e-n)}let r;o&&(r=l.a.createElement("div",{style:i,className:"mx_ContextualMenu_chevron_"+n}));const c=u()({mx_ContextualMenu:!0,mx_ContextualMenu_left:!o&&t.left,mx_ContextualMenu_right:!o&&t.right,mx_ContextualMenu_top:!o&&t.top,mx_ContextualMenu_bottom:!o&&t.bottom,mx_ContextualMenu_withChevron_left:n===P.Left,mx_ContextualMenu_withChevron_right:n===P.Right,mx_ContextualMenu_withChevron_top:n===P.Top,mx_ContextualMenu_withChevron_bottom:n===P.Bottom}),d={};a.menuWidth&&(d.width=a.menuWidth),a.menuHeight&&(d.height=a.menuHeight),isNaN(Number(a.menuPaddingTop))||(d.paddingTop=a.menuPaddingTop),isNaN(Number(a.menuPaddingLeft))||(d.paddingLeft=a.menuPaddingLeft),isNaN(Number(a.menuPaddingBottom))||(d.paddingBottom=a.menuPaddingBottom),isNaN(Number(a.menuPaddingRight))||(d.paddingRight=a.menuPaddingRight);const m={};let h;return isNaN(Number(a.zIndex))||(d.zIndex=a.zIndex+1,m.zIndex=a.zIndex),e&&(h=l.a.createElement("div",{className:"mx_ContextualMenu_background",style:m,onClick:this.onFinished,onContextMenu:this.onContextMenu})),l.a.createElement("div",{className:u()("mx_ContextualMenu_wrapper",this.props.wrapperClassName),style:k(k({},t),m),onKeyDown:this.onKeyDown,onContextMenu:this.onContextMenuPreventBubbling},l.a.createElement("div",{className:c,style:d,ref:this.collectContextMenuRect,role:this.props.managed?"menu":void 0},r,a.children),h)}render(){return d.a.createPortal(this.renderMenu(),I())}},o()(w,"defaultProps",{hasBackground:!0,managed:!0}),C=w))||C;const D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;const a=e.right+window.pageXOffset+3;let n=e.top+e.height/2+window.pageYOffset;return n-=t+8,{left:a,top:n,chevronOffset:t}},j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.None,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n={chevronFace:t},s=e.right+window.pageXOffset,i=e.bottom+window.pageYOffset,o=e.top+window.pageYOffset;return n.right=g.b.instance.windowWidth-s,i<g.b.instance.windowHeight/2?n.top=i+a:n.bottom=g.b.instance.windowHeight-o+a,n},A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.None,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n={chevronFace:t},s=e.right+window.pageXOffset,i=e.bottom+window.pageYOffset,o=e.top+window.pageYOffset;return n.right=g.b.instance.windowWidth-s,i<g.b.instance.windowHeight/2?n.top=i+a:n.bottom=g.b.instance.windowHeight-o+a,n},M=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.None,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n={chevronFace:t},s=e.left+window.pageXOffset,i=e.top+window.pageYOffset;return n.left=s,n.bottom=g.b.instance.windowHeight-i+a,n},U=()=>{const e=Object(r.useRef)(null),[t,a]=Object(r.useState)(!1);return[t,e,()=>{a(!0)},()=>{a(!1)},a]};let L=Object(p.a)("structures.LegacyContextMenu")(O=class extends N{render(){return this.renderMenu(!1)}})||O;function F(e,t){const a=function(){if(d.a.unmountComponentAtNode(I()),t&&t.onFinished){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];t.onFinished.apply(null,a)}},n=l.a.createElement(L,s()({},t,{onFinished:a,windowResize:a}),l.a.createElement(e,s()({},t,{onFinished:a})));return d.a.render(n,I()),{close:a}}}).call(this,a(212).setImmediate)},1289:function(e,t){},1293:function(e,t){},1298:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(0),s=a(484);function i(e){return"crypto.sessions/"+e}function o(e){return"crypto.session.problems/"+e}function r(e,t){return"crypto.inboundgroupsessions/"+e+"/"+t}function l(e,t){return"crypto.inboundgroupsessions.withheld/"+e+"/"+t}function c(e){return"crypto.rooms/"+e}class d extends s.a{constructor(e){super(),this.store=e}static exists(e){const t=e.length;for(let a=0;a<t;a++)if(e.key(a).startsWith("crypto."))return!0;return!1}countEndToEndSessions(e,t){let a=0;for(let e=0;e<this.store.length;++e)this.store.key(e).startsWith(i(""))&&++a;t(a)}_getEndToEndSessions(e,t,a){const n=m(this.store,i(e)),s={};for(const[e,t]of Object.entries(n||{}))s[e]="string"==typeof t?{session:t}:t;return s}getEndToEndSession(e,t,a,n){n(this._getEndToEndSessions(e)[t]||{})}getEndToEndSessions(e,t,a){a(this._getEndToEndSessions(e)||{})}getAllEndToEndSessions(e,t){for(let e=0;e<this.store.length;++e)if(this.store.key(e).startsWith(i(""))){const a=this.store.key(e).split("/")[1];for(const e of Object.values(this._getEndToEndSessions(a)))t(e)}}storeEndToEndSession(e,t,a,n){const s=this._getEndToEndSessions(e)||{};s[t]=a,u(this.store,i(e),s)}async storeEndToEndSessionProblem(e,t,a){const n=o(e),s=m(this.store,n)||[];s.push({type:t,fixed:a,time:Date.now()}),s.sort((e,t)=>e.time-t.time),u(this.store,n,s)}async getEndToEndSessionProblem(e,t){const a=o(e),n=m(this.store,a)||[];if(!n.length)return null;const s=n[n.length-1];for(const e of n)if(e.time>t)return Object.assign({},e,{fixed:s.fixed});return s.fixed?null:s}async filterOutNotifiedErrorDevices(e){const t=m(this.store,"crypto.notified_error_devices")||{},a=[];for(const n of e){const{userId:e,deviceInfo:s}=n;e in t?s.deviceId in t[e]||(a.push(n),t[e][s.deviceId]=!0):(a.push(n),t[e]={[s.deviceId]:!0})}return u(this.store,"crypto.notified_error_devices",t),a}getEndToEndInboundGroupSession(e,t,a,n){n(m(this.store,r(e,t)),m(this.store,l(e,t)))}getAllEndToEndInboundGroupSessions(e,t){for(let e=0;e<this.store.length;++e){const a=this.store.key(e);a.startsWith("crypto.inboundgroupsessions/")&&t({senderKey:a.substr("crypto.inboundgroupsessions/".length,43),sessionId:a.substr("crypto.inboundgroupsessions/".length+44),sessionData:m(this.store,a)})}t(null)}addEndToEndInboundGroupSession(e,t,a,n){m(this.store,r(e,t))||this.storeEndToEndInboundGroupSession(e,t,a,n)}storeEndToEndInboundGroupSession(e,t,a,n){u(this.store,r(e,t),a)}storeEndToEndInboundGroupSessionWithheld(e,t,a,n){u(this.store,l(e,t),a)}getEndToEndDeviceData(e,t){t(m(this.store,"crypto.device_data"))}storeEndToEndDeviceData(e,t){u(this.store,"crypto.device_data",e)}storeEndToEndRoom(e,t,a){u(this.store,c(e),t)}getEndToEndRooms(e,t){const a={},n=c("");for(let e=0;e<this.store.length;++e){const t=this.store.key(e);if(t.startsWith(n)){a[t.substr(n.length)]=m(this.store,t)}}t(a)}getSessionsNeedingBackup(e){const t=m(this.store,"crypto.sessionsneedingbackup")||{},a=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const t=n.substr(0,43),s=n.substr(44);if(this.getEndToEndInboundGroupSession(t,s,null,e=>{a.push({senderKey:t,sessionId:s,sessionData:e})}),e&&n.length>=e)break}return Promise.resolve(a)}countSessionsNeedingBackup(){const e=m(this.store,"crypto.sessionsneedingbackup")||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){const t=m(this.store,"crypto.sessionsneedingbackup")||{};for(const a of e)delete t[a.senderKey+"/"+a.sessionId];return u(this.store,"crypto.sessionsneedingbackup",t),Promise.resolve()}markSessionsNeedingBackup(e){const t=m(this.store,"crypto.sessionsneedingbackup")||{};for(const a of e)t[a.senderKey+"/"+a.sessionId]=!0;return u(this.store,"crypto.sessionsneedingbackup",t),Promise.resolve()}deleteAllData(){return this.store.removeItem("crypto.account"),Promise.resolve()}getAccount(e,t){t(m(this.store,"crypto.account"))}storeAccount(e,t){u(this.store,"crypto.account",t)}getCrossSigningKeys(e,t){t(m(this.store,"crypto.cross_signing_keys"))}getSecretStorePrivateKey(e,t,a){t(m(this.store,"crypto.ssss_cache."+a))}storeCrossSigningKeys(e,t){u(this.store,"crypto.cross_signing_keys",t)}storeSecretStorePrivateKey(e,t,a){u(this.store,"crypto.ssss_cache."+t,a)}doTxn(e,t,a){return Promise.resolve(a(null))}}function m(e,t){try{return JSON.parse(e.getItem(t))}catch(e){n.a.log("Error: Failed to get key %s: %s",t,e.stack||e),n.a.log(e.stack)}return null}function u(e,t,a){e.setItem(t,JSON.stringify(a))}},1299:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return d}));var n=a(0),s=a(246),i=a(1541);function o(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>49152){const t=new Error("Message too long ("+e.length+" bytes). The maximum for an encrypted message is 49152 bytes.");throw t.data={errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"},t}}function r(e){this._cryptoStore=e,this._pickleKey="DEFAULT_KEY",this.deviceCurve25519Key=null,this.deviceEd25519Key=null,this._maxOneTimeKeys=null,this._outboundGroupSessionStore={},this._inboundGroupSessionMessageIndexes={},this._sessionsInProgress={},this._olmPrekeyPromise=Promise.resolve()}async function l(e,t,a,n){await t.doTxn("readwrite",[s.a.STORE_ACCOUNT,s.a.STORE_SESSIONS],a=>{t.storeAccount(a,e.pickledAccount),e.sessions.forEach(e=>{const{deviceKey:n,sessionId:s}=e,i={session:e.session,lastReceivedMessageTs:e.lastReceivedMessageTs};t.storeEndToEndSession(n,s,i,a)})}),n.unpickle(a,e.pickledAccount)}async function c(e,t,a){await e.doTxn("readwrite",[s.a.STORE_ACCOUNT],n=>{e.getAccount(n,s=>{null!==s?a.unpickle(t,s):(a.create(),s=a.pickle(t),e.storeAccount(n,s))})})}r.prototype.init=async function(){let t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=new e.Olm.Account,{pickleKey:i,fromExportedDevice:o}=a;try{o?(i&&n.a.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this._pickleKey=o.pickleKey,await l(o,this._cryptoStore,this._pickleKey,s)):(i&&(this._pickleKey=i),await c(this._cryptoStore,this._pickleKey,s)),t=JSON.parse(s.identity_keys()),this._maxOneTimeKeys=s.max_number_of_one_time_keys()}finally{s.free()}this.deviceCurve25519Key=t.curve25519,this.deviceEd25519Key=t.ed25519},r.getOlmVersion=function(){return e.Olm.get_library_version()},r.prototype._getAccount=function(t,a){this._cryptoStore.getAccount(t,t=>{const n=new e.Olm.Account;try{n.unpickle(this._pickleKey,t),a(n)}finally{n.free()}})},r.prototype._storeAccount=function(e,t){this._cryptoStore.storeAccount(e,t.pickle(this._pickleKey))},r.prototype.export=async function(){const e={pickleKey:this._pickleKey};return await this._cryptoStore.doTxn("readonly",[s.a.STORE_ACCOUNT,s.a.STORE_SESSIONS],t=>{this._cryptoStore.getAccount(t,t=>{e.pickledAccount=t}),e.sessions=[],this._cryptoStore.getAllEndToEndSessions(t,t=>{e.sessions.push(t)})}),e},r.prototype._getSession=function(e,t,a,n){this._cryptoStore.getEndToEndSession(e,t,a,e=>{this._unpickleSession(e,n)})},r.prototype._unpickleSession=function(t,a){const n=new e.Olm.Session;try{n.unpickle(this._pickleKey,t.session);a(Object.assign({},t,{session:n}))}finally{n.free()}},r.prototype._saveSession=function(e,t,a){const n=t.session.session_id(),s=Object.assign(t,{session:t.session.pickle(this._pickleKey)});this._cryptoStore.storeEndToEndSession(e,n,s,a)},r.prototype._getUtility=function(t){const a=new e.Olm.Utility;try{return t(a)}finally{a.free()}},r.prototype.sign=async function(e){let t;return await this._cryptoStore.doTxn("readonly",[s.a.STORE_ACCOUNT],a=>{this._getAccount(a,a=>{t=a.sign(e)})}),t},r.prototype.getOneTimeKeys=async function(){let e;return await this._cryptoStore.doTxn("readonly",[s.a.STORE_ACCOUNT],t=>{this._getAccount(t,t=>{e=JSON.parse(t.one_time_keys())})}),e},r.prototype.maxNumberOfOneTimeKeys=function(){return this._maxOneTimeKeys},r.prototype.markKeysAsPublished=async function(){await this._cryptoStore.doTxn("readwrite",[s.a.STORE_ACCOUNT],e=>{this._getAccount(e,t=>{t.mark_keys_as_published(),this._storeAccount(e,t)})})},r.prototype.generateOneTimeKeys=function(e){return this._cryptoStore.doTxn("readwrite",[s.a.STORE_ACCOUNT],t=>{this._getAccount(t,a=>{a.generate_one_time_keys(e),this._storeAccount(t,a)})})},r.prototype.generateFallbackKey=async function(){await this._cryptoStore.doTxn("readwrite",[s.a.STORE_ACCOUNT],e=>{this._getAccount(e,t=>{t.generate_fallback_key(),this._storeAccount(e,t)})})},r.prototype.getFallbackKey=async function(){let e;return await this._cryptoStore.doTxn("readonly",[s.a.STORE_ACCOUNT],t=>{this._getAccount(t,t=>{e=JSON.parse(t.fallback_key())})}),e},r.prototype.createOutboundSession=async function(t,a){let i;return await this._cryptoStore.doTxn("readwrite",[s.a.STORE_ACCOUNT,s.a.STORE_SESSIONS],n=>{this._getAccount(n,s=>{const o=new e.Olm.Session;try{o.create_outbound(s,t,a),i=o.session_id(),this._storeAccount(n,s);const e={session:o,lastReceivedMessageTs:Date.now()};this._saveSession(t,e,n)}finally{o.free()}})},n.a.withPrefix("[createOutboundSession]")),i},r.prototype.createInboundSession=async function(t,a,i){if(0!==a)throw new Error("Need messageType == 0 to create inbound session");let o;return await this._cryptoStore.doTxn("readwrite",[s.a.STORE_ACCOUNT,s.a.STORE_SESSIONS],n=>{this._getAccount(n,s=>{const r=new e.Olm.Session;try{r.create_inbound_from(s,t,i),s.remove_one_time_keys(r),this._storeAccount(n,s);const e=r.decrypt(a,i),l={session:r,lastReceivedMessageTs:Date.now()};this._saveSession(t,l,n),o={payload:e,session_id:r.session_id()}}finally{r.free()}})},n.a.withPrefix("[createInboundSession]")),o},r.prototype.getSessionIdsForDevice=async function(e){const t=n.a.withPrefix("[getSessionIdsForDevice]");if(this._sessionsInProgress[e]){t.debug(`Waiting for Olm session for ${e} to be created`);try{await this._sessionsInProgress[e]}catch(e){}}let a;return await this._cryptoStore.doTxn("readonly",[s.a.STORE_SESSIONS],t=>{this._cryptoStore.getEndToEndSessions(e,t,e=>{a=Object.keys(e)})},t),a},r.prototype.getSessionIdForDevice=async function(e,t,a){const n=await this.getSessionInfoForDevice(e,t,a);if(0===n.length)return null;let s=0;for(let e=1;e<n.length;e++){const t=n[e],a=void 0===t.lastReceivedMessageTs?0:t.lastReceivedMessageTs,i=n[s],o=void 0===i.lastReceivedMessageTs?0:i.lastReceivedMessageTs;(a>o||a===o&&t.sessionId<i.sessionId)&&(s=e)}return n[s].sessionId},r.prototype.getSessionInfoForDevice=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.a;if(a=a.withPrefix("[getSessionInfoForDevice]"),this._sessionsInProgress[e]&&!t){a.debug(`Waiting for Olm session for ${e} to be created`);try{await this._sessionsInProgress[e]}catch(e){}}const i=[];return await this._cryptoStore.doTxn("readonly",[s.a.STORE_SESSIONS],t=>{this._cryptoStore.getEndToEndSessions(e,t,e=>{const t=Object.keys(e).sort();for(const a of t)this._unpickleSession(e[a],e=>{i.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:a})})})},a),i},r.prototype.encryptMessage=async function(e,t,a){let i;return o(a),await this._cryptoStore.doTxn("readwrite",[s.a.STORE_SESSIONS],s=>{this._getSession(e,t,s,o=>{const r=o.session.describe();n.a.log("encryptMessage: Olm Session ID "+t+" to "+e+": "+r),i=o.session.encrypt(a),this._saveSession(e,o,s)})},n.a.withPrefix("[encryptMessage]")),i},r.prototype.decryptMessage=async function(e,t,a,i){let o;return await this._cryptoStore.doTxn("readwrite",[s.a.STORE_SESSIONS],s=>{this._getSession(e,t,s,r=>{const l=r.session.describe();n.a.log("decryptMessage: Olm Session ID "+t+" from "+e+": "+l),o=r.session.decrypt(a,i),r.lastReceivedMessageTs=Date.now(),this._saveSession(e,r,s)})},n.a.withPrefix("[decryptMessage]")),o},r.prototype.matchesSession=async function(e,t,a,i){if(0!==a)return!1;let o;return await this._cryptoStore.doTxn("readonly",[s.a.STORE_SESSIONS],a=>{this._getSession(e,t,a,e=>{o=e.session.matches_inbound(i)})},n.a.withPrefix("[matchesSession]")),o},r.prototype.recordSessionProblem=async function(e,t,a){await this._cryptoStore.storeEndToEndSessionProblem(e,t,a)},r.prototype.sessionMayHaveProblems=async function(e,t){return await this._cryptoStore.getEndToEndSessionProblem(e,t)},r.prototype.filterOutNotifiedErrorDevices=async function(e){return await this._cryptoStore.filterOutNotifiedErrorDevices(e)},r.prototype._saveOutboundGroupSession=function(e){const t=e.pickle(this._pickleKey);this._outboundGroupSessionStore[e.session_id()]=t},r.prototype._getOutboundGroupSession=function(t,a){const n=this._outboundGroupSessionStore[t];if(void 0===n)throw new Error("Unknown outbound group session "+t);const s=new e.Olm.OutboundGroupSession;try{return s.unpickle(this._pickleKey,n),a(s)}finally{s.free()}},r.prototype.createOutboundGroupSession=function(){const t=new e.Olm.OutboundGroupSession;try{return t.create(),this._saveOutboundGroupSession(t),t.session_id()}finally{t.free()}},r.prototype.encryptGroupMessage=function(e,t){const a=this;return n.a.log("encrypting msg with megolm session "+e),o(t),this._getOutboundGroupSession(e,(function(e){const n=e.encrypt(t);return a._saveOutboundGroupSession(e),n}))},r.prototype.getOutboundGroupSessionKey=function(e){return this._getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))},r.prototype._unpickleInboundGroupSession=function(t,a){const n=new e.Olm.InboundGroupSession;try{return n.unpickle(this._pickleKey,t.session),a(n)}finally{n.free()}},r.prototype._getInboundGroupSession=function(e,t,a,n,s){this._cryptoStore.getEndToEndInboundGroupSession(t,a,n,(t,a)=>{if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");this._unpickleInboundGroupSession(t,e=>{s(e,t,a)})}else s(null,null,a)})},r.prototype.addInboundGroupSession=async function(t,a,i,o,r,l,c){let d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};await this._cryptoStore.doTxn("readwrite",[s.a.STORE_INBOUND_GROUP_SESSIONS,s.a.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,s.a.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],s=>{this._getInboundGroupSession(t,a,o,s,(m,u)=>{const h=new e.Olm.InboundGroupSession;try{if(c?h.import_session(r):h.create(r),o!=h.session_id())throw new Error("Mismatched group session ID from senderKey: "+a);if(m&&(n.a.log("Update for megolm session "+a+"/"+o),m.first_known_index()<=h.first_known_index()&&(m.first_known_index()!=h.first_known_index()||d.untrusted||!u.untrusted)))return void n.a.log("Keeping existing megolm session "+o);n.a.info("Storing megolm session "+a+"/"+o+" with first index "+h.first_known_index());const e=Object.assign({},d,{room_id:t,session:h.pickle(this._pickleKey),keysClaimed:l,forwardingCurve25519KeyChain:i});this._cryptoStore.storeEndToEndInboundGroupSession(a,o,e,s),!m&&d.sharedHistory&&this._cryptoStore.addSharedHistoryInboundGroupSession(t,a,o,s)}finally{h.free()}})},n.a.withPrefix("[addInboundGroupSession]"))},r.prototype.addInboundGroupSessionWithheld=async function(e,t,a,n,i){await this._cryptoStore.doTxn("readwrite",[s.a.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],s=>{this._cryptoStore.storeEndToEndInboundGroupSessionWithheld(t,a,{room_id:e,code:n,reason:i},s)})};const d={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function m(e){return e.code&&e.code in d?d[e.code]:e.reason?e.reason:"decryption key withheld"}r.prototype.decryptGroupMessage=async function(e,t,a,o,r,l){let c,d;if(await this._cryptoStore.doTxn("readwrite",[s.a.STORE_INBOUND_GROUP_SESSIONS,s.a.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],n=>{this._getInboundGroupSession(e,t,a,n,(e,s,u)=>{if(null===e)return u&&(d=new i.b("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",m(u),{session:t+"|"+a})),void(c=null);let h;try{h=e.decrypt(o)}catch(e){return void(d=e&&"OLM.UNKNOWN_MESSAGE_INDEX"===e.message&&u?new i.b("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",m(u),{session:t+"|"+a}):e)}let p=h.plaintext;if(void 0===p)p=h;else{const e=t+"|"+a+"|"+h.message_index;if(e in this._inboundGroupSessionMessageIndexes){const t=this._inboundGroupSessionMessageIndexes[e];if(t.id!==r||t.timestamp!==l)return void(d=new Error("Duplicate message index, possible replay attack: "+e))}this._inboundGroupSessionMessageIndexes[e]={id:r,timestamp:l}}s.session=e.pickle(this._pickleKey),this._cryptoStore.storeEndToEndInboundGroupSession(t,a,s,n),c={result:p,keysClaimed:s.keysClaimed||{},senderKey:t,forwardingCurve25519KeyChain:s.forwardingCurve25519KeyChain||[],untrusted:s.untrusted}})},n.a.withPrefix("[decryptGroupMessage]")),d)throw d;return c},r.prototype.hasInboundSessionKeys=async function(e,t,a){let i;return await this._cryptoStore.doTxn("readonly",[s.a.STORE_INBOUND_GROUP_SESSIONS,s.a.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],s=>{this._cryptoStore.getEndToEndInboundGroupSession(t,a,s,s=>{null!==s?e!==s.room_id?(n.a.warn(`requested keys for inbound group session ${t}|`+a+", with incorrect room_id "+`(expected ${s.room_id}, `+`was ${e})`),i=!1):i=!0:i=!1})},n.a.withPrefix("[hasInboundSessionKeys]")),i},r.prototype.getInboundGroupSessionKey=async function(e,t,a,i){let o;return await this._cryptoStore.doTxn("readonly",[s.a.STORE_INBOUND_GROUP_SESSIONS,s.a.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],n=>{this._getInboundGroupSession(e,t,a,n,(e,t)=>{if(null===e)return void(o=null);void 0===i&&(i=e.first_known_index());const a=e.export_session(i),n=(t.keysClaimed||{}).ed25519||null;o={chain_index:i,key:a,forwarding_curve25519_key_chain:t.forwardingCurve25519KeyChain||[],sender_claimed_ed25519_key:n,shared_history:t.sharedHistory||!1}})},n.a.withPrefix("[getInboundGroupSessionKey]")),o},r.prototype.exportInboundGroupSession=function(e,t,a){return this._unpickleInboundGroupSession(a,n=>{const s=n.first_known_index();return{sender_key:e,sender_claimed_keys:a.keysClaimed,room_id:a.room_id,session_id:t,session_key:n.export_session(s),forwarding_curve25519_key_chain:n.forwardingCurve25519KeyChain||[],first_known_index:n.first_known_index(),"org.matrix.msc3061.shared_history":a.sharedHistory||!1}})},r.prototype.getSharedHistoryInboundGroupSessions=async function(e){let t;return await this._cryptoStore.doTxn("readonly",[s.a.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],a=>{t=this._cryptoStore.getSharedHistoryInboundGroupSessions(e,a)},n.a.withPrefix("[getSharedHistoryInboundGroupSessionsForRoom]")),t},r.prototype.verifySignature=function(e,t,a){this._getUtility((function(n){n.ed25519_verify(e,t,a)}))}}).call(this,a(7))},1300:function(e,t,a){"use strict";(function(e,n){a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return h}));var s=a(258),i=a.n(s),o=a(213),r=a(246),l=a(486),c=a(583),d=a.n(c),m=a(0);const u="org.matrix.msc2697.v1.olm.libolm_pickle";class h{constructor(e){this.crypto=e,i()(this,"inProgress",!1),i()(this,"timeoutId",void 0),i()(this,"key",void 0),i()(this,"keyInfo",void 0),i()(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}async getDehydrationKeyFromCache(){return await this.crypto._cryptoStore.doTxn("readonly",[r.a.STORE_ACCOUNT],t=>{this.crypto._cryptoStore.getSecretStorePrivateKey(t,async t=>{if(t){const{key:a,keyInfo:s,deviceDisplayName:i,time:r}=t,c=e.from(this.crypto._olmDevice._pickleKey),d=await Object(l.a)(a,c,u);this.key=Object(o.decodeBase64)(d),this.keyInfo=s,this.deviceDisplayName=i;const m=Date.now(),h=Math.max(1,r+6048e5-m);this.timeoutId=n.setTimeout(this.dehydrateDevice.bind(this),h)}},"dehydration")})}async setKeyAndQueueDehydration(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;await this.setKey(e,t,a)||this.dehydrateDevice()}async setKey(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!e)return this.timeoutId&&(n.clearTimeout(this.timeoutId),this.timeoutId=void 0),await this.crypto._cryptoStore.doTxn("readwrite",[r.a.STORE_ACCOUNT],e=>{this.crypto._cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)}),this.key=void 0,void(this.keyInfo=void 0);let s=this.key&&e.length==this.key.length;for(let t=0;s&&t<e.length;t++)e[t]!=this.key[t]&&(s=!1);return s||(this.key=e,this.keyInfo=t,this.deviceDisplayName=a),s}async dehydrateDevice(){if(this.inProgress)m.a.log("Dehydration already in progress -- not starting new dehydration");else{this.inProgress=!0,this.timeoutId&&(n.clearTimeout(this.timeoutId),this.timeoutId=void 0);try{const t=e.from(this.crypto._olmDevice._pickleKey),a=await Object(l.b)(Object(o.encodeBase64)(this.key),t,u);await this.crypto._cryptoStore.doTxn("readwrite",[r.a.STORE_ACCOUNT],e=>{this.crypto._cryptoStore.storeSecretStorePrivateKey(e,"dehydration",{keyInfo:this.keyInfo,key:a,deviceDisplayName:this.deviceDisplayName,time:Date.now()})}),m.a.log("Attempting to dehydrate device"),m.a.log("Creating account");const s=new n.Olm.Account;s.create();const i=JSON.parse(s.identity_keys()),c=s.max_number_of_one_time_keys();s.generate_one_time_keys(c/2),s.generate_fallback_key();const h=JSON.parse(s.one_time_keys()),p=JSON.parse(s.fallback_key());s.mark_keys_as_published();const g=s.pickle(new Uint8Array(this.key)),f={algorithm:u,account:g};this.keyInfo.passphrase&&(f.passphrase=this.keyInfo.passphrase),m.a.log("Uploading account to server");const v=(await this.crypto._baseApis.http.authedRequest(void 0,"PUT","/dehydrated_device",void 0,{device_data:f,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).device_id;m.a.log("Preparing device keys",v);const b={algorithms:this.crypto._supportedAlgorithms,device_id:v,user_id:this.crypto._userId,keys:{["ed25519:"+v]:i.ed25519,["curve25519:"+v]:i.curve25519}},y=s.sign(d.a.stringify(b));b.signatures={[this.crypto._userId]:{["ed25519:"+v]:y}},this.crypto._crossSigningInfo.getId("self_signing")&&await this.crypto._crossSigningInfo.signObject(b,"self_signing"),m.a.log("Preparing one-time keys");const E={};for(const[e,t]of Object.entries(h.curve25519)){const a={key:t},n=s.sign(d.a.stringify(a));a.signatures={[this.crypto._userId]:{["ed25519:"+v]:n}},E["signed_curve25519:"+e]=a}m.a.log("Preparing fallback keys");const _={};for(const[e,t]of Object.entries(p.curve25519)){const a={key:t,fallback:!0},n=s.sign(d.a.stringify(a));a.signatures={[this.crypto._userId]:{["ed25519:"+v]:n}},_["signed_curve25519:"+e]=a}return m.a.log("Uploading keys to server"),await this.crypto._baseApis.http.authedRequest(void 0,"POST","/keys/upload/"+encodeURI(v),void 0,{device_keys:b,one_time_keys:E,"org.matrix.msc2732.fallback_keys":_}),m.a.log("Done dehydrating"),this.timeoutId=n.setTimeout(this.dehydrateDevice.bind(this),6048e5),v}finally{this.inProgress=!1}}}stop(){this.timeoutId&&(n.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}}).call(this,a(36).Buffer,a(7))},1301:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return u}));var n=a(258),s=a.n(n),i=a(266),o=a(0),r=a(213),l=a(587),c=a(1),d=a(246),m=a(588);class u{constructor(e,t){this.baseApis=e,this.getKey=t,s()(this,"algorithm",void 0),s()(this,"backupInfo",void 0),s()(this,"checkedForBackup",void 0),s()(this,"sendingBackups",void 0),this.checkedForBackup=!1,this.sendingBackups=!1}get version(){return this.backupInfo&&this.backupInfo.version}static async makeAlgorithm(e,t){const a=p[e.algorithm];if(!a)throw new Error("Unknown backup algorithm");return await a.init(e.auth_data,t)}async enableKeyBackup(e){this.backupInfo=e,this.algorithm&&this.algorithm.free(),this.algorithm=await u.makeAlgorithm(e,this.getKey),this.baseApis.emit("crypto.keyBackupStatus",!0),this.scheduleKeyBackupSend()}disableKeyBackup(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit("crypto.keyBackupStatus",!1)}getKeyBackupEnabled(){return this.checkedForBackup?Boolean(this.algorithm):null}async prepareKeyBackupVersion(e,t){const a=t?p[t]:g;if(!a)throw new Error("Unknown backup algorithm");const[n,s]=await a.prepare(e),i=Object(m.b)(n);return{algorithm:a.algorithmName,auth_data:s,recovery_key:i,privateKey:n}}async createKeyBackupVersion(e){this.algorithm=await u.makeAlgorithm(e,this.getKey)}async checkAndStart(){if(o.a.log("Checking key backup status..."),this.baseApis.isGuest())return o.a.log("Skipping key backup check since user is guest"),this.checkedForBackup=!0,null;let e;try{e=await this.baseApis.getKeyBackupVersion()}catch(e){return o.a.log("Error checking for active key backup",e),404===e.httpStatus&&(this.checkedForBackup=!0),null}this.checkedForBackup=!0;const t=await this.isKeyBackupTrusted(e);return t.usable&&!this.backupInfo?(o.a.log("Found usable key backup v"+e.version+": enabling key backups"),await this.enableKeyBackup(e)):!t.usable&&this.backupInfo?(o.a.log("No usable key backup: disabling key backup"),this.disableKeyBackup()):t.usable||this.backupInfo?t.usable&&this.backupInfo&&(e.version!==this.backupInfo.version?(o.a.log("On backup version "+this.backupInfo.version+" but found version "+e.version+": switching."),this.disableKeyBackup(),await this.enableKeyBackup(e),await this.scheduleAllGroupSessionsForBackup()):o.a.log("Backup version "+e.version+" still current")):o.a.log("No usable key backup: not enabling key backup"),{backupInfo:e,trustInfo:t}}async checkKeyBackup(){return this.checkedForBackup=!1,this.checkAndStart()}async isKeyBackupTrusted(e){const t={usable:!1,trusted_locally:!1,sigs:[]};if(!(e&&e.algorithm&&e.auth_data&&e.auth_data.public_key&&e.auth_data.signatures))return o.a.info("Key backup is absent or missing required data"),t;const a=this.baseApis.crypto._sessionStore.getLocalTrustedBackupPubKey();e.auth_data.public_key===a&&(o.a.info("Backup public key "+a+" is trusted locally"),t.trusted_locally=!0);const n=e.auth_data.signatures[this.baseApis.getUserId()]||[];for(const a of Object.keys(n)){const n=a.split(":");if("ed25519"!==n[0]){o.a.log("Ignoring unknown signature type: "+n[0]);continue}const s={deviceId:n[1]},i=this.baseApis.crypto._crossSigningInfo.getId();if(i===s.deviceId){s.crossSigningId=!0;try{await Object(r.verifySignature)(this.baseApis.crypto._olmDevice,e.auth_data,this.baseApis.getUserId(),s.deviceId,i),s.valid=!0}catch(e){o.a.warn("Bad signature from cross signing key "+i,e),s.valid=!1}t.sigs.push(s);continue}const l=this.baseApis.crypto._deviceList.getStoredDevice(this.baseApis.getUserId(),s.deviceId);if(l){s.device=l,s.deviceTrust=await this.baseApis.checkDeviceTrust(this.baseApis.getUserId(),s.deviceId);try{await Object(r.verifySignature)(this.baseApis.crypto._olmDevice,e.auth_data,this.baseApis.getUserId(),l.deviceId,l.getFingerprint()),s.valid=!0}catch(t){o.a.info("Bad signature from key ID "+a+" userID "+this.baseApis.getUserId()+" device ID "+l.deviceId+" fingerprint: "+l.getFingerprint(),e.auth_data,t),s.valid=!1}}else s.valid=null,o.a.info("Ignoring signature from unknown key "+a);t.sigs.push(s)}return t.usable=t.sigs.some(e=>e.valid&&(e.device&&e.deviceTrust.isVerified()||e.crossSigningId)),t.usable=t.usable||t.trusted_locally,t}async scheduleKeyBackupSend(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;if(!this.sendingBackups){this.sendingBackups=!0;try{const t=Math.random()*e;await Object(c.w)(t,void 0);let a=0;for(;;){if(!this.algorithm)return;try{if(0===await this.backupPendingKeys(200))return;a=0}catch(e){if(a++,o.a.log("Key backup request failed",e),e.data&&("M_NOT_FOUND"==e.data.errcode||"M_WRONG_ROOM_KEYS_VERSION"==e.data.errcode))throw await this.checkKeyBackup(),this.baseApis.crypto.emit("crypto.keyBackupFailed",e.data.errcode),e}a&&await Object(c.w)(1e3*Math.pow(2,Math.min(a-1,4)),void 0)}}finally{this.sendingBackups=!1}}}async backupPendingKeys(e){const t=await this.baseApis.crypto._cryptoStore.getSessionsNeedingBackup(e);if(!t.length)return 0;let a=await this.baseApis.crypto._cryptoStore.countSessionsNeedingBackup();this.baseApis.crypto.emit("crypto.keyBackupSessionsRemaining",a);const n={};for(const e of t){const t=e.sessionData.room_id;void 0===n[t]&&(n[t]={sessions:{}});const a=await this.baseApis.crypto._olmDevice.exportInboundGroupSession(e.senderKey,e.sessionId,e.sessionData);a.algorithm=r.MEGOLM_ALGORITHM;const s=(a.forwarding_curve25519_key_chain||[]).length,i=this.baseApis.crypto._deviceList.getUserByIdentityKey(r.MEGOLM_ALGORITHM,e.senderKey),o=this.baseApis.crypto._deviceList.getDeviceByIdentityKey(r.MEGOLM_ALGORITHM,e.senderKey),l=this.baseApis.crypto._checkDeviceInfoTrust(i,o).isVerified();n[t].sessions[e.sessionId]={first_message_index:a.first_known_index,forwarded_count:s,is_verified:l,session_data:await this.algorithm.encryptSession(a)}}return await this.baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:n}),await this.baseApis.crypto._cryptoStore.unmarkSessionsNeedingBackup(t),a=await this.baseApis.crypto._cryptoStore.countSessionsNeedingBackup(),this.baseApis.crypto.emit("crypto.keyBackupSessionsRemaining",a),t.length}async backupGroupSession(e,t){await this.baseApis.crypto._cryptoStore.markSessionsNeedingBackup([{senderKey:e,sessionId:t}]),this.backupInfo&&this.scheduleKeyBackupSend()}async scheduleAllGroupSessionsForBackup(){await this.flagAllGroupSessionsForBackup(),this.scheduleKeyBackupSend(0)}async flagAllGroupSessionsForBackup(){await this.baseApis.crypto._cryptoStore.doTxn("readwrite",[d.a.STORE_INBOUND_GROUP_SESSIONS,d.a.STORE_BACKUP],e=>{this.baseApis.crypto._cryptoStore.getAllEndToEndInboundGroupSessions(e,t=>{null!==t&&this.baseApis.crypto._cryptoStore.markSessionsNeedingBackup([t],e)})});const e=await this.baseApis.crypto._cryptoStore.countSessionsNeedingBackup();return this.baseApis.emit("crypto.keyBackupSessionsRemaining",e),e}countSessionsNeedingBackup(){return this.baseApis.crypto._cryptoStore.countSessionsNeedingBackup()}}class h{constructor(e,t,a){this.authData=e,this.publicKey=t,this.getKey=a}static async init(t,a){if(!t||!t.public_key)throw new Error("auth_data missing required information");const n=new e.Olm.PkEncryption;return n.set_recipient_key(t.public_key),new h(t,n,a)}static async prepare(t){const a=new e.Olm.PkDecryption;try{const n={};if(t)if(t instanceof Uint8Array)n.public_key=a.init_with_private_key(t);else{const e=await Object(l.c)(t);n.private_key_salt=e.salt,n.private_key_iterations=e.iterations,n.public_key=a.init_with_private_key(e.key)}else n.public_key=a.generate_key();return(new e.Olm.PkEncryption).set_recipient_key(n.public_key),[a.get_private_key(),n]}finally{a.free()}}async encryptSession(e){const t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,this.publicKey.encrypt(JSON.stringify(t))}async decryptSessions(t){const a=await this.getKey(),n=new e.Olm.PkDecryption;try{if(n.init_with_private_key(a)!==this.authData.public_key)throw{errcode:i.b.RESTORE_BACKUP_ERROR_BAD_KEY};const e=[];for(const[a,s]of Object.entries(t))try{const t=JSON.parse(n.decrypt(s.session_data.ephemeral,s.session_data.mac,s.session_data.ciphertext));t.session_id=a,e.push(t)}catch(e){o.a.log("Failed to decrypt megolm session from backup",e,s)}return e}finally{n.free()}}async keyMatches(t){const a=new e.Olm.PkDecryption;let n;try{n=a.init_with_private_key(t)}finally{a.free()}return n===this.authData.public_key}free(){this.publicKey.free()}}s()(h,"algorithmName","m.megolm_backup.v1.curve25519-aes-sha2");const p={[h.algorithmName]:h},g=h}).call(this,a(7))},1302:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(97),u=a(93),h=a(100),p=a(131),g=a(94);let f=Object(g.a)("views.settings.IntegrationManager")((s=class extends l.a.Component{constructor(e){super(e),o()(this,"onKeyDown",e=>{e.key===p.a.ESCAPE&&(e.stopPropagation(),e.preventDefault(),this.props.onFinished())}),o()(this,"onAction",e=>{"close_scalar"===e.action&&this.props.onFinished()}),o()(this,"onError",()=>{this.setState({errored:!0})}),this.state={errored:!1}}componentDidMount(){this.dispatcherRef=h.a.register(this.onAction),document.addEventListener("keydown",this.onKeyDown)}componentWillUnmount(){h.a.unregister(this.dispatcherRef),document.removeEventListener("keydown",this.onKeyDown)}render(){if(this.props.loading){const e=m.getComponent("elements.Spinner");return l.a.createElement("div",{className:"mx_IntegrationManager_loading"},l.a.createElement("h3",null,Object(u.a)("Connecting to integration manager...")),l.a.createElement(e,null))}return!this.props.connected||this.state.errored?l.a.createElement("div",{className:"mx_IntegrationManager_error"},l.a.createElement("h3",null,Object(u.a)("Cannot connect to integration manager")),l.a.createElement("p",null,Object(u.a)("The integration manager is offline or it cannot reach your homeserver."))):l.a.createElement("iframe",{src:this.props.url,onError:this.onError})}},o()(s,"propTypes",{connected:d.a.bool.isRequired,loading:d.a.bool.isRequired,url:d.a.string,onFinished:d.a.func.isRequired}),o()(s,"defaultProps",{connected:!0,loading:!1}),n=s))||n},1303:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(110),h=a(97),p=a(94);let g=Object(p.a)("views.dialogs.IntegrationsImpossibleDialog")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"_onAcknowledgeClick",()=>{this.props.onFinished()})}render(){const e=u.a.get().brand,t=h.getComponent("views.dialogs.BaseDialog"),a=h.getComponent("views.elements.DialogButtons");return l.a.createElement(t,{className:"mx_IntegrationsImpossibleDialog",hasCancel:!1,onFinished:this.props.onFinished,title:Object(m.a)("Integrations not allowed")},l.a.createElement("div",{className:"mx_IntegrationsImpossibleDialog_content"},l.a.createElement("p",null,Object(m.a)("Your %(brand)s doesn't allow you to use an Integration Manager to do this. Please contact an admin.",{brand:e}))),l.a.createElement(a,{primaryButton:Object(m.a)("OK"),onPrimaryButtonClick:this._onAcknowledgeClick,hasCancel:!1}))}},o()(s,"propTypes",{onFinished:d.a.func.isRequired}),n=s))||n},1304:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(283),u=a(439),h=a(97),p=a(489),g=a(102),f=a.n(g),v=a(1305),b=a(94);let y=Object(b.a)("views.dialogs.TabbedIntegrationManagerDialog")((s=class extends l.a.Component{constructor(e){var t;super(e),t=this,o()(this,"openManager",(async function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e===t.state.currentIndex&&!a)return;const n=t.state.managers[e],s=n.getScalarClient();t.setState({busy:!0,currentIndex:e,currentLoading:!0,currentConnected:!1,currentScalarClient:s}),v.a(n.uiUrl),s.setTermsInteractionCallback((e,t)=>Object(p.c)(e,t,"mx_TermsDialog_forIntegrationManager"));try{await s.connect(),s.hasCredentials()?t.setState({busy:!1,currentLoading:!1,currentConnected:!0}):t.setState({busy:!1,currentLoading:!1,currentConnected:!1})}catch(e){if(e instanceof p.b)return;console.error(e),t.setState({busy:!1,currentLoading:!1,currentConnected:!1})}})),this.state={managers:m.a.sharedInstance().getOrderedManagers(),busy:!0,currentIndex:0,currentConnected:!1,currentLoading:!0,currentScalarClient:null}}componentDidMount(){this.openManager(0,!0)}_renderTabs(){const e=h.getComponent("views.elements.AccessibleButton");return this.state.managers.map((t,a)=>{const n=f()({mx_TabbedIntegrationManagerDialog_tab:!0,mx_TabbedIntegrationManagerDialog_currentTab:this.state.currentIndex===a});return l.a.createElement(e,{className:n,onClick:()=>this.openManager(a),key:"tab_"+a,disabled:this.state.busy},t.name)})}_renderTab(){const e=h.getComponent("views.settings.IntegrationManager");let t=null;return this.state.currentScalarClient&&(t=this.state.currentScalarClient.getScalarInterfaceUrlForRoom(this.props.room,this.props.screen,this.props.integrationId)),l.a.createElement(e,{configured:!0,loading:this.state.currentLoading,connected:this.state.currentConnected,url:t,onFinished:()=>{}})}render(){return l.a.createElement("div",{className:"mx_TabbedIntegrationManagerDialog_container"},l.a.createElement("div",{className:"mx_TabbedIntegrationManagerDialog_tabs"},this._renderTabs()),l.a.createElement("div",{className:"mx_TabbedIntegrationManagerDialog_currentManager"},this._renderTab()))}},o()(s,"propTypes",{onFinished:d.a.func.isRequired,room:d.a.instanceOf(u.a),screen:d.a.string,integrationId:d.a.string}),n=s))||n},1305:function(e,t,a){"use strict";a.d(t,"b",(function(){return E})),a.d(t,"c",(function(){return _})),a.d(t,"a",(function(){return S}));var n=a(99),s=a(146),i=a(100),o=a(215),r=a(165),l=a(93),c=a(283),d=a(247),m=a(166);function u(e,t){const a=Object(m.a)(e.data);a.response=t,e.source.postMessage(a,e.origin)}function h(e,t,a){console.error("Action:"+e.data.action+" failed with message: "+t);const n=Object(m.a)(e.data);n.response={error:{message:t}},a&&(n.response.error._error=a),e.source.postMessage(n,e.origin)}function p(e,t){const a=e.data.widget_id;let n=e.data.type;const s=e.data.url,r=e.data.name,c=e.data.data,m=e.data.userWidget;if(a&&void 0!==s){if(null!==s){if(void 0!==r&&"string"!=typeof r)return void h(e,Object(l.a)("Unable to create widget."),new Error("Optional field 'name' must be a string."));if(void 0!==c&&!(c instanceof Object))return void h(e,Object(l.a)("Unable to create widget."),new Error("Optional field 'data' must be an Object."));if("string"!=typeof n)return void h(e,Object(l.a)("Unable to create widget."),new Error("Field 'type' must be a string."));if("string"!=typeof s)return void h(e,Object(l.a)("Unable to create widget."),new Error("Field 'url' must be a string or null."))}n=d.a.fromString(n),m?o.a.setUserWidget(a,n,s,r,c).then(()=>{u(e,{success:!0}),i.a.dispatch({action:"user_widget_updated"})}).catch(t=>{h(e,Object(l.a)("Unable to create widget."),t)}):(t||h(e,Object(l.a)("Missing roomId."),null),o.a.setRoomWidget(t,a,n,s,r,c).then(()=>{u(e,{success:!0})},t=>{h(e,Object(l.a)("Failed to send request."),t)}))}else h(e,Object(l.a)("Unable to create widget."),new Error("Missing required widget fields."))}function g(e,t){const a=n.a.get();if(!a)return void h(e,Object(l.a)("You need to be logged in."));let s=[];if(t){const n=a.getRoom(t);if(!n)return void h(e,Object(l.a)("This room is not recognised."));s=o.a.getRoomWidgets(n).map(e=>e.event)}const i=o.a.getUserWidgetsArray();s=s.concat(i),u(e,s)}function f(e,t,a,s){const i=n.a.get();if(!i)return void h(e,Object(l.a)("You need to be logged in."));const o=i.getRoom(t);if(!o)return void h(e,Object(l.a)("This room is not recognised."));const r=o.currentState.getStateEvents(a,s);u(e,r?r.getContent():null)}const v=function(e){let t,a;e.origin||(e.origin=e.originalEvent.origin);try{y||(y=c.a.sharedInstance().getPrimaryManager().uiUrl),t=new URL(y)}catch(e){return}try{a=new URL(e.origin)}catch(e){return}if(t.origin!==a.origin||!e.data.action||e.data.api)return;if("close_scalar"===e.data.action)return i.a.dispatch({action:"close_scalar"}),void u(e,null);const o=e.data.room_id,d=e.data.user_id;if(!o)return"get_widgets"===e.data.action?void g(e,null):"set_widget"===e.data.action?void p(e,null):void h(e,Object(l.a)("Missing room_id in request"));if(o===r.a.getRoomId())if("get_widgets"!==e.data.action)if("set_widget"!==e.data.action)if("join_rules_state"!==e.data.action)if("set_plumbing_state"!==e.data.action)if("get_membership_count"!==e.data.action)if("get_room_enc_state"!==e.data.action)if("can_send_event"!==e.data.action)if(d)switch(e.data.action){case"membership_state":!function(e,t,a){console.log(`membership_state of ${a} in room ${t} requested.`),f(e,t,"m.room.member",a)}(e,o,d);break;case"invite":!function(e,t,a){console.log(`Received request to invite ${a} into room ${t}`);const s=n.a.get();if(!s)return void h(e,Object(l.a)("You need to be logged in."));const i=s.getRoom(t);if(i){const t=i.getMember(a);if(t&&"invite"===t.membership)return void u(e,{success:!0})}s.invite(t,a).then((function(){u(e,{success:!0})}),(function(t){h(e,Object(l.a)("You need to be able to invite users to do that."),t)}))}(e,o,d);break;case"bot_options":!function(e,t,a){console.log(`bot_options of ${a} in room ${t} requested.`),f(e,t,"m.room.bot.options","_"+a)}(e,o,d);break;case"set_bot_options":!function(e,t,a){console.log(`Received request to set options for bot ${a} in room ${t}`);const s=n.a.get();s?s.sendStateEvent(t,"m.room.bot.options",e.data.content,"_"+a).then(()=>{u(e,{success:!0})},t=>{h(e,t.message?t.message:Object(l.a)("Failed to send request."),t)}):h(e,Object(l.a)("You need to be logged in."))}(e,o,d);break;case"set_bot_power":!function(e,t,a,i){if(!(Number.isInteger(i)&&i>=0))return void h(e,Object(l.a)("Power level must be positive integer."));console.log(`Received request to set power level to ${i} for bot ${a} in room ${t}.`);const o=n.a.get();o?o.getStateEvent(t,"m.room.power_levels","").then(n=>{const r=new s.b({type:"m.room.power_levels",content:n});o.setPowerLevel(t,a,i,r).then(()=>{u(e,{success:!0})},t=>{h(e,t.message?t.message:Object(l.a)("Failed to send request."),t)})}):h(e,Object(l.a)("You need to be logged in."))}(e,o,d,e.data.level);break;default:console.warn("Unhandled postMessage event with action '"+e.data.action+"'")}else h(e,Object(l.a)("Missing user_id in request"));else!function(e,t){const a=""+e.data.event_type,s=Boolean(e.data.is_state),i=n.a.get();if(!i)return void h(e,Object(l.a)("You need to be logged in."));const o=i.getRoom(t);if(!o)return void h(e,Object(l.a)("This room is not recognised."));if("join"!==o.getMyMembership())return void h(e,Object(l.a)("You are not in this room."));const r=i.credentials.userId;let c=!1;c=s?o.currentState.maySendStateEvent(a,r):o.currentState.maySendEvent(a,r),c?u(e,!0):h(e,Object(l.a)("You do not have permission to do that in this room."))}(e,o);else!function(e,t){const a=n.a.get();if(!a)return void h(e,Object(l.a)("You need to be logged in."));if(!a.getRoom(t))return void h(e,Object(l.a)("This room is not recognised."));u(e,n.a.get().isRoomEncrypted(t))}(e,o);else!function(e,t){const a=n.a.get();if(!a)return void h(e,Object(l.a)("You need to be logged in."));const s=a.getRoom(t);if(!s)return void h(e,Object(l.a)("This room is not recognised."));u(e,s.getJoinedMemberCount())}(e,o);else!function(e,t,a){if("string"!=typeof a)throw new Error("Plumbing state status should be a string");console.log(`Received request to set plumbing state to status "${a}" in room ${t}`);const s=n.a.get();s?s.sendStateEvent(t,"m.room.plumbing",{status:a}).then(()=>{u(e,{success:!0})},t=>{h(e,t.message?t.message:Object(l.a)("Failed to send request."),t)}):h(e,Object(l.a)("You need to be logged in."))}(e,o,e.data.status);else!function(e,t){console.log(`join_rules of ${t} requested.`),f(e,t,"m.room.join_rules","")}(e,o);else p(e,o);else g(e,o);else h(e,Object(l.a)("Room %(roomId)s not visible",{roomId:o}))};let b=0,y=null;function E(){0===b&&window.addEventListener("message",v,!1),b+=1}function _(){if(b-=1,0===b&&window.removeEventListener("message",v),b<0){const e=new Error("ScalarMessaging: mismatched startListening / stopListening detected. Negative count");console.error(e)}}function S(e){y=e}},1306:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(97),h=a(100),p=a(115),g=a(94);let f=Object(g.a)("views.dialogs.IntegrationsDisabledDialog")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"_onAcknowledgeClick",()=>{this.props.onFinished()}),o()(this,"_onOpenSettingsClick",()=>{this.props.onFinished(),h.a.fire(p.a.ViewUserSettings)})}render(){const e=u.getComponent("views.dialogs.BaseDialog"),t=u.getComponent("views.elements.DialogButtons");return l.a.createElement(e,{className:"mx_IntegrationsDisabledDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(m.a)("Integrations are disabled")},l.a.createElement("div",{className:"mx_IntegrationsDisabledDialog_content"},l.a.createElement("p",null,Object(m.a)("Enable 'Manage Integrations' in Settings to do this."))),l.a.createElement(t,{primaryButton:Object(m.a)("Settings"),onPrimaryButtonClick:this._onOpenSettingsClick,cancelButton:Object(m.a)("OK"),onCancel:this._onAcknowledgeClick}))}},o()(s,"propTypes",{onFinished:d.a.func.isRequired}),n=s))||n},131:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return s})),a.d(t,"d",(function(){return i})),a.d(t,"c",(function(){return o}));const n={HOME:"Home",END:"End",PAGE_UP:"PageUp",PAGE_DOWN:"PageDown",BACKSPACE:"Backspace",DELETE:"Delete",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",TAB:"Tab",ESCAPE:"Escape",ENTER:"Enter",ALT:"Alt",CONTROL:"Control",META:"Meta",SHIFT:"Shift",CONTEXT_MENU:"ContextMenu",COMMA:",",PERIOD:".",LESS_THAN:"<",GREATER_THAN:">",BACKTICK:"`",SPACE:" ",SLASH:"/",SQUARE_BRACKET_LEFT:"[",SQUARE_BRACKET_RIGHT:"]",A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z"},s=navigator.platform.toUpperCase().indexOf("MAC")>=0;function i(e){return s?e.metaKey&&!e.altKey&&!e.ctrlKey&&!e.shiftKey:e.ctrlKey&&!e.altKey&&!e.metaKey&&!e.shiftKey}function o(e){return s?e.metaKey&&!e.altKey&&!e.ctrlKey:e.ctrlKey&&!e.altKey&&!e.metaKey}},1316:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(99),o=a(8);class r extends o.EventEmitter{constructor(e){super(),this.dispatcher=e,s()(this,"matrixClient",void 0),s()(this,"dispatcherRef",void 0),s()(this,"onAction",async e=>{if("MatrixActions.sync"===e.action){if("PREPARED"!==e.prevState||"PREPARED"===e.state)return;this.matrixClient!==e.matrixClient&&(this.matrixClient&&await this.onNotReady(),this.matrixClient=e.matrixClient,await this.onReady())}else"on_client_not_viable"!==e.action&&"on_logged_out"!==e.action||this.matrixClient&&(await this.onNotReady(),this.matrixClient=null)}),this.dispatcherRef=this.dispatcher.register(this.onAction),i.a.get()&&(this.matrixClient=i.a.get(),this.onReady())}get mxClient(){return this.matrixClient}useUnitTestClient(e){this.matrixClient=e}destroy(){this.dispatcher.unregister(this.dispatcherRef)}async onReady(){}async onNotReady(){}}},1317:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(182),d=a(108),m=a(238),u=a(94);let h;!function(e){e.Screens="screens",e.Windows="windows"}(h||(h={}));class p extends r.a.Component{constructor(e){super(e),i()(this,"onClick",e=>{this.props.onSelect(this.props.source)})}render(){return r.a.createElement(d.a,{className:"mx_desktopCapturerSourcePicker_stream_button",title:this.props.source.name,onClick:this.onClick},r.a.createElement("img",{className:"mx_desktopCapturerSourcePicker_stream_thumbnail",src:this.props.source.thumbnailURL}),r.a.createElement("span",{className:"mx_desktopCapturerSourcePicker_stream_name"},this.props.source.name))}}let g=Object(u.a)("views.elements.DesktopCapturerSourcePicker")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"interval",void 0),i()(this,"onSelect",e=>{this.props.onFinished(e)}),i()(this,"onScreensClick",e=>{this.setState({selectedTab:h.Screens})}),i()(this,"onWindowsClick",e=>{this.setState({selectedTab:h.Windows})}),i()(this,"onCloseClick",e=>{this.props.onFinished(null)}),this.state={selectedTab:h.Screens,sources:[]}}async componentDidMount(){this.setState({sources:await Object(m.h)()}),this.interval=setInterval(async()=>{this.setState({sources:await Object(m.h)()})},500)}componentWillUnmount(){clearInterval(this.interval)}render(){let e;e=this.state.selectedTab===h.Screens?this.state.sources.filter(e=>e.id.startsWith("screen")).map(e=>r.a.createElement(p,{source:e,onSelect:this.onSelect,key:e.id})):this.state.sources.filter(e=>e.id.startsWith("window")).map(e=>r.a.createElement(p,{source:e,onSelect:this.onSelect,key:e.id}));const t="mx_desktopCapturerSourcePicker_tabLabel",a=t+(this.state.selectedTab===h.Screens?"_selected":""),n=t+(this.state.selectedTab===h.Windows?"_selected":"");return r.a.createElement(c.a,{className:"mx_desktopCapturerSourcePicker",onFinished:this.onCloseClick,title:Object(l.a)("Share your screen")},r.a.createElement("div",{className:"mx_desktopCapturerSourcePicker_tabLabels"},r.a.createElement(d.a,{className:a,onClick:this.onScreensClick},Object(l.a)("Screens")),r.a.createElement(d.a,{className:n,onClick:this.onWindowsClick},Object(l.a)("Windows"))),r.a.createElement("div",{className:"mx_desktopCapturerSourcePicker_panel"},e))}})||n},1326:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(19),s=a.n(n),i=a(214),o=a(99),r=a(185),l=a(158);class c{constructor(){s()(this,"virtualRoomIdCache",new Set)}static sharedInstance(){return void 0===window.mxVoipUserMapper&&(window.mxVoipUserMapper=new c),window.mxVoipUserMapper}async userToVirtualUser(e){const t=await l.d.sharedInstance().sipVirtualLookup(e);return 0!==t.length&&t[0].fields.lookup_success?t[0].userid:null}async getOrCreateVirtualRoomForRoom(e){const t=r.a.shared().getUserIdForRoomId(e);if(!t)return null;const a=await this.userToVirtualUser(t);if(!a)return null;const n=await Object(i.f)(o.a.get(),a,e);return o.a.get().setRoomAccountData(n,l.c,{native_room:e}),n}nativeRoomForVirtualRoom(e){const t=o.a.get().getRoom(e);if(!t)return null;const a=t.getAccountData(l.c);if(!a||!a.getContent())return null;const n=a.getContent().native_room,s=o.a.get().getRoom(n);return s&&"join"===s.getMyMembership()?n:null}isVirtualRoom(e){if(this.nativeRoomForVirtualRoom(e.roomId))return!0;if(this.virtualRoomIdCache.has(e.roomId))return!0;const t=e.currentState.getStateEvents("m.room.create","");if(!t||!t.getContent())return!1;if(t.getSender()!==o.a.get().getUserId())return!1;const a=t.getContent()[l.c];return Boolean(a)}async onNewInvitedRoom(e){if(!l.d.sharedInstance().getSupportsVirtualRooms())return;const t=e.getDMInviter();console.log(`Checking virtual-ness of room ID ${e.roomId}, invited by ${t}`);const a=await l.d.sharedInstance().sipNativeLookup(t);if(0!==a.length&&a[0].fields.is_virtual){const t=a[0].userid,n=Object(i.g)(o.a.get(),t);n&&(o.a.get().setRoomAccountData(e.roomId,l.c,{native_room:n.roomId}),o.a.get().joinRoom(e.roomId)),this.virtualRoomIdCache.add(e.roomId)}}}},1327:function(e,t,a){"use strict";var n=a(98),s=a.n(n),i=a(88),o=a.n(i),r=a(140),l=a(93),c=a(182),d=a(793),m=a(797),u=a(495),h=a(368),p=a(496),g=a(108),f=a(106),v=a(100),b=a(1330),y=a(384);const E=["action"];t.a=e=>{let{matrixClient:t,space:a,onFinished:n}=e;Object(b.a)(v.a,e=>{let{action:t}=e,i=s()(e,E);"after_leave_room"===t&&i.room_id===a.roomId&&n(!1)});const[_,S]=Object(i.useState)(!1),[C,w]=Object(i.useState)(""),O=t.getUserId(),[x,R]=Object(i.useState)(null),k=a.currentState.maySendStateEvent(r.a.RoomAvatar,O),I=null!==x,[T,P]=Object(i.useState)(a.name),N=a.currentState.maySendStateEvent(r.a.RoomName,O),D=T!==a.name,j=Object(u.b)(a),[A,M]=Object(i.useState)(j),U=a.currentState.maySendStateEvent(r.a.RoomTopic,O),L=A!==j,F=a.getJoinRule(),[B,V]=Object(i.useState)(F),G=a.currentState.maySendStateEvent(r.a.RoomJoinRules,O),z=B!==F;return o.a.createElement(c.a,{title:Object(l.a)("Space settings"),className:"mx_SpaceSettingsDialog",contentId:"mx_SpaceSettingsDialog",onFinished:n,fixedWidth:!1},o.a.createElement("div",{className:"mx_SpaceSettingsDialog_content",id:"mx_SpaceSettingsDialog"},o.a.createElement("div",null,Object(l.a)("Edit settings relating to your space.")),C&&o.a.createElement("div",{className:"mx_SpaceRoomView_errorText"},C),o.a.createElement(y.a,{onClick:()=>n(!1)}),o.a.createElement(m.b,{avatarUrl:Object(h.b)(a,80,80,"crop"),avatarDisabled:_||!k,setAvatar:R,name:T,nameDisabled:_||!N,setName:P,topic:A,topicDisabled:_||!U,setTopic:M}),o.a.createElement("div",null,Object(l.a)("Make this space private"),o.a.createElement(p.a,{checked:"public"!==B,onChange:e=>V(e?"invite":"public"),disabled:!G,"aria-label":Object(l.a)("Make this space private")})),o.a.createElement(g.a,{kind:"danger",onClick:()=>{v.a.dispatch({action:"leave_room",room_id:a.roomId})}},Object(l.a)("Leave Space")),o.a.createElement("div",{className:"mx_SpaceSettingsDialog_buttons"},o.a.createElement(g.a,{onClick:()=>f.a.createDialog(d.b,{roomId:a.roomId})},Object(l.a)("View dev tools")),o.a.createElement(g.a,{onClick:n,disabled:_,kind:"link"},Object(l.a)("Cancel")),o.a.createElement(g.a,{onClick:async()=>{S(!0);const e=[];I&&(x?e.push(t.sendStateEvent(a.roomId,r.a.RoomAvatar,{url:await t.uploadContent(x)},"")):e.push(t.sendStateEvent(a.roomId,r.a.RoomAvatar,{},""))),D&&e.push(t.setRoomName(a.roomId,T)),L&&e.push(t.setRoomTopic(a.roomId,A)),z&&e.push(t.sendStateEvent(a.roomId,r.a.RoomJoinRules,{join_rule:B},""));const n=await Promise.allSettled(e);S(!1);const s=n.filter(e=>"rejected"===e.status);s.length>0&&(console.error("Failed to save space settings: ",s),w(Object(l.a)("Failed to save space settings.")))},disabled:_,kind:"primary"},_?Object(l.a)("Saving..."):Object(l.a)("Save Changes")))))}},1329:function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c}));var n=a(248),s=a(99),i=a(475);function o(){const e=new i.a(s.a.get()).getPushRuleById(".m.rule.master");return e?e.enabled&&!e.actions.includes("notify"):(console.warn("No master push rule! Notifications are disabled for this user."),!0)}function r(){let e=a(301);return e.default&&(e=e.default),e}class l extends n.a{getValueOverride(e,t,a,n){return!!r().isPossible()&&(null===a||"default"===n?!o():a)}onChange(e,t,a){r().supportsDesktopNotifications()&&r().setEnabled(a)}}class c extends n.a{getValueOverride(e,t,a){return!!r().isPossible()&&(null===a?!o():a)}}},1330:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(88);const s=(e,t)=>{const a=Object(n.useRef)(e=>{});Object(n.useEffect)(()=>{a.current=t},[t]),Object(n.useEffect)(()=>{const t=e.register(e=>a.current(e));return()=>{e.unregister(t)}},[e])}},1331:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(108);const d=["label","isExpanded","children","onClick","onContextMenu"],m=e=>{let{label:t,isExpanded:a,children:n,onClick:i,onContextMenu:r}=e,m=o()(e,d);return l.a.createElement(c.a,s()({},m,{onClick:i,onContextMenu:r||i,title:t,"aria-label":t,"aria-haspopup":!0,"aria-expanded":a}),n)}},1332:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r);const c=["children","label"],d=e=>{let{children:t,label:a}=e,n=o()(e,c);return l.a.createElement("div",s()({},n,{role:"group","aria-label":a}),t)}},1333:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(108),d=a(135);const m=["children","label","tooltip"],u=e=>{let{children:t,label:a,tooltip:n}=e,i=o()(e,m);const r=i["aria-label"]||a;return n?l.a.createElement(d.a,s()({},i,{role:"menuitem",tabIndex:-1,"aria-label":r,title:n}),t):l.a.createElement(c.a,s()({},i,{role:"menuitem",tabIndex:-1,"aria-label":r}),t)}},1334:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(108);const d=["children","label","active","disabled"],m=e=>{let{children:t,label:a,active:n,disabled:i}=e,r=o()(e,d);return l.a.createElement(c.a,s()({},r,{role:"menuitemcheckbox","aria-checked":n,"aria-disabled":i,disabled:i,tabIndex:-1,"aria-label":a}),t)}},1335:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(108);const d=["children","label","active","disabled"],m=e=>{let{children:t,label:a,active:n,disabled:i}=e,r=o()(e,d);return l.a.createElement(c.a,s()({},r,{role:"menuitemradio","aria-checked":n,"aria-disabled":i,disabled:i,tabIndex:-1,"aria-label":a}),t)}},1336:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(131),d=a(228);const m=["children","label","onChange","onClose"],u=e=>{let{children:t,label:a,onChange:n,onClose:i}=e,r=o()(e,m);return l.a.createElement(d.a,s()({},r,{role:"menuitemcheckbox",tabIndex:-1,"aria-label":a,onChange:n,onKeyDown:e=>{e.key!==c.a.ENTER&&e.key!==c.a.SPACE||(e.stopPropagation(),e.preventDefault(),n(),e.key===c.a.ENTER&&i())},onKeyUp:e=>{e.key!==c.a.SPACE&&e.key!==c.a.ENTER||(e.stopPropagation(),e.preventDefault())}}),t)}},1337:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(131),d=a(498);const m=["children","label","onChange","onClose"],u=e=>{let{children:t,label:a,onChange:n,onClose:i}=e,r=o()(e,m);return l.a.createElement(d.a,s()({},r,{role:"menuitemradio",tabIndex:-1,"aria-label":a,onChange:n,onKeyDown:e=>{e.key!==c.a.ENTER&&e.key!==c.a.SPACE||(e.stopPropagation(),e.preventDefault(),n(),e.key===c.a.ENTER&&i())},onKeyUp:e=>{e.key!==c.a.SPACE&&e.key!==c.a.ENTER||(e.stopPropagation(),e.preventDefault())}}),t)}},1338:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(100),d=a(108),m=a(1339),u=a(278),h=a(93),p=a(222),g=a(94),f=a(119),v=a(249),b=a(135);let y=Object(g.a)("views.rooms.PinnedEventTile")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"onTileClicked",()=>{c.a.dispatch({action:"view_room",event_id:this.props.event.getId(),highlighted:!0,room_id:this.props.event.getRoomId()})})}render(){const e=this.props.event.getSender(),t=this.props.room.getMember(e);let a=null;return this.props.onUnpinClicked&&(a=l.a.createElement(b.a,{onClick:this.props.onUnpinClicked,className:"mx_PinnedEventTile_unpinButton",title:Object(h.a)("Unpin")})),l.a.createElement("div",{className:"mx_PinnedEventTile"},l.a.createElement(u.a,{className:"mx_PinnedEventTile_senderAvatar",member:t,width:24,height:24,fallbackUserId:e}),l.a.createElement("span",{className:"mx_PinnedEventTile_sender "+Object(v.f)(e)},(null==t?void 0:t.name)||e),a,l.a.createElement("div",{className:"mx_PinnedEventTile_message"},l.a.createElement(m.a,{mxEvent:this.props.event,className:"mx_PinnedEventTile_body",maxImageHeight:150,onHeightChanged:()=>{}})),l.a.createElement("div",{className:"mx_PinnedEventTile_footer"},l.a.createElement("span",{className:"mx_PinnedEventTile_timestamp"},Object(p.a)(new Date(this.props.event.getTs()))),l.a.createElement(d.a,{onClick:this.onTileClicked,kind:"link"},Object(h.a)("View message"))))}},o()(s,"contextType",f.a),n=s))||n},1339:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(97),u=a(103),h=a(801),p=a(802),g=a(1340),f=a(94);let v=Object(f.a)("views.messages.MessageEvent")((s=class extends l.a.Component{constructor(e){super(e),o()(this,"getEventTileOps",()=>this._body.current&&this._body.current.getEventTileOps?this._body.current.getEventTileOps():null),o()(this,"onTileUpdate",()=>{this.forceUpdate()}),this._body=Object(r.createRef)()}render(){const e={"m.text":m.getComponent("messages.TextualBody"),"m.notice":m.getComponent("messages.TextualBody"),"m.emote":m.getComponent("messages.TextualBody"),"m.image":m.getComponent("messages.MImageBody"),"m.file":m.getComponent("messages.MFileBody"),"m.audio":m.getComponent("messages.MVoiceOrAudioBody"),"m.video":m.getComponent("messages.MVideoBody")},t={"m.sticker":m.getComponent("messages.MStickerBody")},a=this.props.mxEvent.getContent(),n=this.props.mxEvent.getType(),s=a.msgtype;let i=p.a;if(this.props.mxEvent.isRedacted()||(i=n&&t[n]?t[n]:s&&e[s]?e[s]:a.url?e["m.file"]:g.a),u.b.getValue("feature_mjolnir")){const e=`mx_mjolnir_render_${this.props.mxEvent.getRoomId()}__${this.props.mxEvent.getId()}`;if(!("true"===localStorage.getItem(e))){const e=this.props.mxEvent.getSender().split(":").slice(1).join(":"),t=h.a.sharedInstance().isUserBanned(this.props.mxEvent.getSender()),a=h.a.sharedInstance().isServerBanned(e);(t||a)&&(i=m.getComponent("messages.MjolnirBody"))}}return l.a.createElement(i,{ref:this._body,mxEvent:this.props.mxEvent,highlights:this.props.highlights,highlightLink:this.props.highlightLink,showUrlPreview:this.props.showUrlPreview,tileShape:this.props.tileShape,maxImageHeight:this.props.maxImageHeight,replacingEventId:this.props.replacingEventId,editState:this.props.editState,onHeightChanged:this.props.onHeightChanged,onMessageAllowed:this.onTileUpdate,permalinkCreator:this.props.permalinkCreator})}},o()(s,"propTypes",{mxEvent:d.a.object.isRequired,highlights:d.a.array,highlightLink:d.a.string,showUrlPreview:d.a.bool,onHeightChanged:d.a.func,tileShape:d.a.string,maxImageHeight:d.a.number,permalinkCreator:d.a.object}),n=s))||n},1340:function(e,t,a){"use strict";var n=a(88),s=a.n(n);t.a=Object(n.forwardRef)((e,t)=>{let{mxEvent:a}=e;const n=a.getContent().body;return s.a.createElement("span",{className:"mx_UnknownBody",ref:t},n)})},1341:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(222),u=a(94);let h=Object(u.a)("views.messages.MessageTimestamp")((s=class extends l.a.Component{render(){const e=new Date(this.props.ts);let t;return t=this.props.showFullDate?Object(m.b)(e,this.props.showTwelveHour,this.props.showSeconds):this.props.showSeconds?Object(m.d)(e,this.props.showTwelveHour):Object(m.e)(e,this.props.showTwelveHour),l.a.createElement("span",{className:"mx_MessageTimestamp",title:Object(m.b)(e,this.props.showTwelveHour),"aria-hidden":!0},t)}},o()(s,"propTypes",{ts:d.a.number.isRequired,showTwelveHour:d.a.bool,showFullDate:d.a.bool,showSeconds:d.a.bool}),n=s))||n},1342:function(e,t,a){"use strict";a.d(t,"c",(function(){return p})),a.d(t,"a",(function(){return g})),a.d(t,"d",(function(){return f})),a.d(t,"b",(function(){return v}));var n=a(99),s=a(100),i=a(106),o=a(97),r=a(183),l=a(214),c=a(279),d=a(584),m=a(115),u=a(1344);async function h(){const e=n.a.get();if(!e.isCryptoEnabled())return!1;return!!e.getCrossSigningId("user_signing")||(await Object(c.b)(),!1)}async function p(e,t){const a=n.a.get();a.isGuest()?s.a.dispatch({action:"require_registration"}):a.getCryptoTrustCrossSignedDevices()&&!await h()||i.a.createTrackedDialog("Verification warning","unverified session",u.a,{user:e,device:t,onFinished:async n=>{if("sas"===n){const n=a.legacyDeviceVerification(e.userId,t.deviceId,d.d.SAS);s.a.dispatch({action:m.a.SetRightPanelPhase,phase:r.c.EncryptionPanel,refireParams:{member:e,verificationRequestPromise:n}})}else if("legacy"===n){const a=o.getComponent("dialogs.ManualDeviceKeyVerificationDialog");i.a.createTrackedDialog("Legacy verify session","legacy verify session",a,{userId:e.userId,device:t})}}})}async function g(e){const t=n.a.get();if(t.isGuest())return void s.a.dispatch({action:"require_registration"});if(t.getCryptoTrustCrossSignedDevices()&&!await h())return;const a=t.requestVerification(e.userId);s.a.dispatch({action:m.a.SetRightPanelPhase,phase:r.c.EncryptionPanel,refireParams:{member:e,verificationRequestPromise:a}})}async function f(e){if(n.a.get().isGuest())return void s.a.dispatch({action:"require_registration"});if(!await h())return;const t=v(e);s.a.dispatch({action:m.a.SetRightPanelPhase,phase:r.c.EncryptionPanel,refireParams:{member:e,verificationRequest:t}})}function v(e){const t=n.a.get(),a=Object(l.g)(t,e.userId);if(a)return t.findVerificationRequestDMInProgress(a.roomId)}},1343:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n=a(19),s=a.n(n),i=a(150),o=a(102),r=a.n(o),l=a(88),c=a.n(l),d=a(97),m=a(99),u=a(144),h=a(108),p=a(93),g=a(279),f=a(106);class v extends c.a.PureComponent{constructor(e){super(e),s()(this,"fileUpload",c.a.createRef()),s()(this,"onCancel",()=>{this.state.resetting&&this.setState({resetting:!1}),this.props.onFinished(!1)}),s()(this,"onUseRecoveryKeyClick",()=>{this.setState({forceRecoveryKey:!0})}),s()(this,"validateRecoveryKeyOnChange",Object(i.debounce)(async()=>{await this.validateRecoveryKey()},200)),s()(this,"onRecoveryKeyChange",e=>{this.setState({recoveryKey:e.target.value,recoveryKeyFileError:null}),this.fileUpload.current&&(this.fileUpload.current.value=null),this.validateRecoveryKeyOnChange()}),s()(this,"onRecoveryKeyFileChange",async e=>{if(0===e.target.files.length)return;const t=e.target.files[0];if(t.size>128)this.setState({recoveryKeyFileError:!0,recoveryKeyCorrect:!1,recoveryKeyValid:!1});else{const e=await t.text();/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz\s]+$/.test(e)?(this.setState({recoveryKeyFileError:null,recoveryKey:e.trim()}),await this.validateRecoveryKey()):this.setState({recoveryKeyFileError:!0,recoveryKeyCorrect:!1,recoveryKeyValid:!1,recoveryKey:""})}}),s()(this,"onRecoveryKeyFileUploadClick",()=>{this.fileUpload.current.click()}),s()(this,"onPassPhraseNext",async e=>{if(e.preventDefault(),this.state.passPhrase.length<=0)return;this.setState({keyMatches:null});const t={passphrase:this.state.passPhrase},a=await this.props.checkPrivateKey(t);a?this.props.onFinished(t):this.setState({keyMatches:a})}),s()(this,"onRecoveryKeyNext",async e=>{if(e.preventDefault(),!this.state.recoveryKeyValid)return;this.setState({keyMatches:null});const t={recoveryKey:this.state.recoveryKey},a=await this.props.checkPrivateKey(t);a?this.props.onFinished(t):this.setState({keyMatches:a})}),s()(this,"onPassPhraseChange",e=>{this.setState({passPhrase:e.target.value,keyMatches:null})}),s()(this,"onResetAllClick",e=>{e.preventDefault(),this.setState({resetting:!0})}),s()(this,"onConfirmResetAllClick",async()=>{f.a.toggleCurrentDialogVisibility();try{await Object(g.b)(async()=>{const e=m.a.get();await e.bootstrapCrossSigning({authUploadDeviceSigningKeys:async t=>{const a=d.getComponent("views.dialogs.InteractiveAuthDialog"),{finished:n}=f.a.createTrackedDialog("Cross-signing keys dialog","",a,{title:Object(p.a)("Setting up keys"),matrixClient:e,makeRequest:t}),[s]=await n;if(!s)throw new Error("Cross-signing key upload auth canceled")},setupNewCrossSigning:!0}),this.props.onFinished(!0)},!0)}catch(e){console.error(e),this.props.onFinished(!1)}}),this.state={recoveryKey:"",recoveryKeyValid:null,recoveryKeyCorrect:null,recoveryKeyFileError:null,forceRecoveryKey:!1,passPhrase:"",keyMatches:null,resetting:!1}}async validateRecoveryKey(){if(""!==this.state.recoveryKey)try{const e=m.a.get(),t=e.keyBackupKeyFromRecoveryKey(this.state.recoveryKey),a=await e.checkSecretStorageKey(t,this.props.keyInfo);this.setState({recoveryKeyValid:!0,recoveryKeyCorrect:a})}catch(e){this.setState({recoveryKeyValid:!1,recoveryKeyCorrect:!1})}else this.setState({recoveryKeyValid:null,recoveryKeyCorrect:null})}getKeyValidationText(){return this.state.recoveryKeyFileError?Object(p.a)("Wrong file type"):this.state.recoveryKeyCorrect?Object(p.a)("Looks good!"):this.state.recoveryKeyValid?Object(p.a)("Wrong Security Key"):null===this.state.recoveryKeyValid?"":Object(p.a)("Invalid Security Key")}render(){const e=d.getComponent("views.dialogs.BaseDialog"),t=d.getComponent("views.elements.DialogButtons"),a=this.props.keyInfo&&this.props.keyInfo.passphrase&&this.props.keyInfo.passphrase.salt&&this.props.keyInfo.passphrase.iterations,n=c.a.createElement("div",{className:"mx_AccessSecretStorageDialog_reset"},Object(p.a)("Forgotten or lost all recovery methods? <a>Reset all</a>",null,{a:e=>c.a.createElement("a",{href:"",onClick:this.onResetAllClick,className:"mx_AccessSecretStorageDialog_reset_link"},e)}));let s,i,o;if(this.state.resetting)i=Object(p.a)("Reset everything"),o=["mx_AccessSecretStorageDialog_titleWithIcon mx_AccessSecretStorageDialog_resetBadge"],s=c.a.createElement("div",null,c.a.createElement("p",null,Object(p.a)("Only do this if you have no other device to complete verification with.")),c.a.createElement("p",null,Object(p.a)("If you reset everything, you will restart with no trusted sessions, no trusted users, and might not be able to see past messages.")),c.a.createElement(t,{primaryButton:Object(p.a)("Reset"),onPrimaryButtonClick:this.onConfirmResetAllClick,hasCancel:!0,onCancel:this.onCancel,focus:!1,primaryButtonClass:"danger"}));else if(a&&!this.state.forceRecoveryKey){const e=d.getComponent("elements.AccessibleButton");let a;i=Object(p.a)("Security Phrase"),o=["mx_AccessSecretStorageDialog_titleWithIcon mx_AccessSecretStorageDialog_securePhraseTitle"],a=!1===this.state.keyMatches?c.a.createElement("div",{className:"mx_AccessSecretStorageDialog_keyStatus"},"👎 ",Object(p.a)("Unable to access secret storage. Please verify that you entered the correct Security Phrase.")):c.a.createElement("div",{className:"mx_AccessSecretStorageDialog_keyStatus"}),s=c.a.createElement("div",null,c.a.createElement("p",null,Object(p.a)("Enter your Security Phrase or <button>Use your Security Key</button> to continue.",{},{button:t=>c.a.createElement(e,{className:"mx_linkButton",element:"span",onClick:this.onUseRecoveryKeyClick},t)})),c.a.createElement("form",{className:"mx_AccessSecretStorageDialog_primaryContainer",onSubmit:this.onPassPhraseNext},c.a.createElement("input",{type:"password",id:"mx_passPhraseInput",className:"mx_AccessSecretStorageDialog_passPhraseInput",onChange:this.onPassPhraseChange,value:this.state.passPhrase,autoFocus:!0,autoComplete:"new-password",placeholder:Object(p.a)("Security Phrase")}),a,c.a.createElement(t,{primaryButton:Object(p.a)("Continue"),onPrimaryButtonClick:this.onPassPhraseNext,hasCancel:!0,onCancel:this.onCancel,focus:!1,primaryDisabled:0===this.state.passPhrase.length,additive:n})))}else{i=Object(p.a)("Security Key"),o=["mx_AccessSecretStorageDialog_titleWithIcon mx_AccessSecretStorageDialog_secureBackupTitle"];const e=r()({mx_AccessSecretStorageDialog_recoveryKeyFeedback:!0,mx_AccessSecretStorageDialog_recoveryKeyFeedback_valid:!0===this.state.recoveryKeyCorrect,mx_AccessSecretStorageDialog_recoveryKeyFeedback_invalid:!1===this.state.recoveryKeyCorrect}),a=c.a.createElement("div",{className:e},this.getKeyValidationText());s=c.a.createElement("div",null,c.a.createElement("p",null,Object(p.a)("Use your Security Key to continue.")),c.a.createElement("form",{className:"mx_AccessSecretStorageDialog_primaryContainer",onSubmit:this.onRecoveryKeyNext,spellCheck:!1,autoComplete:"off"},c.a.createElement("div",{className:"mx_AccessSecretStorageDialog_recoveryKeyEntry"},c.a.createElement("div",{className:"mx_AccessSecretStorageDialog_recoveryKeyEntry_textInput"},c.a.createElement(u.a,{type:"password",label:Object(p.a)("Security Key"),value:this.state.recoveryKey,onChange:this.onRecoveryKeyChange,forceValidity:this.state.recoveryKeyCorrect,autoComplete:"off"})),c.a.createElement("span",{className:"mx_AccessSecretStorageDialog_recoveryKeyEntry_entryControlSeparatorText"},Object(p.a)("or")),c.a.createElement("div",null,c.a.createElement("input",{type:"file",className:"mx_AccessSecretStorageDialog_recoveryKeyEntry_fileInput",ref:this.fileUpload,onChange:this.onRecoveryKeyFileChange}),c.a.createElement(h.a,{kind:"primary",onClick:this.onRecoveryKeyFileUploadClick},Object(p.a)("Upload")))),a,c.a.createElement(t,{primaryButton:Object(p.a)("Continue"),onPrimaryButtonClick:this.onRecoveryKeyNext,hasCancel:!0,cancelButton:Object(p.a)("Go Back"),cancelButtonClass:"danger",onCancel:this.onCancel,focus:!1,primaryDisabled:!this.state.recoveryKeyValid,additive:n})))}return c.a.createElement(e,{className:"mx_AccessSecretStorageDialog",onFinished:this.props.onFinished,title:i,titleClass:o},c.a.createElement("div",null,s))}}},1344:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(93),o=a(99),r=a(280),l=a(108),c=a(182);t.a=e=>{let t,a,{device:n,user:d,onFinished:m}=e;return o.a.get().getUserId()===d.userId?(a=Object(i.a)("You signed in to a new session without verifying it:"),t=Object(i.a)("Verify your other session using one of the options below.")):(a=Object(i.a)("%(name)s (%(userId)s) signed in to a new session without verifying it:",{name:d.displayName,userId:d.userId}),t=Object(i.a)("Ask this user to verify their session, or manually verify it below.")),s.a.createElement(c.a,{onFinished:m,className:"mx_UntrustedDeviceDialog",title:s.a.createElement(s.a.Fragment,null,s.a.createElement(r.b,{status:"warning",size:24,hideTooltip:!0}),Object(i.a)("Not Trusted"))},s.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},s.a.createElement("p",null,a),s.a.createElement("p",null,n.getDisplayName()," (",n.deviceId,")"),s.a.createElement("p",null,t)),s.a.createElement("div",{className:"mx_Dialog_buttons"},s.a.createElement(l.a,{element:"button",kind:"secondary",onClick:()=>m("legacy")},Object(i.a)("Manually Verify by Text")),s.a.createElement(l.a,{element:"button",kind:"secondary",onClick:()=>m("sas")},Object(i.a)("Interactively verify by Emoji")),s.a.createElement(l.a,{kind:"primary",onClick:()=>m(!1)},Object(i.a)("Done"))))}},1345:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(88),s=a(193);function i(e,t){const[a,i]=Object(n.useState)(t?e.isRoomEncrypted(t.roomId):void 0),o=Object(n.useCallback)(a=>{t&&"m.room.encryption"===a.getType()&&i(e.isRoomEncrypted(t.roomId))},[e,t]);return Object(s.a)(t?t.currentState:void 0,"RoomState.events",o),a}},135:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(19),l=a.n(r),c=a(88),d=a.n(c),m=a(102),u=a.n(m),h=a(108),p=a(293),g=a(94);const f=["title","tooltip","children","tooltipClassName","forceHide","yOffset"];var v;let b=Object(g.a)("views.elements.AccessibleTooltipButton")(v=class extends d.a.PureComponent{constructor(e){super(e),l()(this,"onMouseOver",()=>{this.props.forceHide||this.setState({hover:!0})}),l()(this,"onMouseLeave",()=>{this.setState({hover:!1})}),this.state={hover:!1}}componentDidUpdate(e){!e.forceHide&&this.props.forceHide&&this.state.hover&&this.setState({hover:!1})}render(){const e=this.props,{title:t,tooltip:a,children:n,tooltipClassName:i,forceHide:r,yOffset:l}=e,c=o()(e,f),m=this.state.hover?d.a.createElement(p.b,{className:"mx_AccessibleTooltipButton_container",tooltipClassName:u()("mx_AccessibleTooltipButton_tooltip",i),label:a||t,yOffset:l}):null;return d.a.createElement(h.a,s()({},c,{onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave,"aria-label":t}),n,m)}})||v},1350:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(119),o=a(336),r=a(215),l=a(501),c=a(93),d=a(804),m=a(183),u=a(100),h=a(115),p=a(127),g=a(636),f=a(267),v=a(200);t.a=e=>{let{room:t,widgetId:a,onClose:b}=e;const y=Object(n.useContext)(i.a),E=Object(d.b)(t).find(e=>e.id===a),_=E&&f.d.instance.isInContainer(t,E,f.a.Top),[S,C,w,O]=Object(p.q)();if(Object(n.useEffect)(()=>{E&&!_||u.a.dispatch({action:h.a.SetRightPanelPhase,phase:m.c.RoomSummary})},[E,_]),!E||_)return null;let x;if(S){const e=C.current.getBoundingClientRect();x=s.a.createElement(g.a,{chevronFace:p.a.None,right:v.b.instance.windowWidth-e.right-12,top:e.bottom+12,onFinished:O,app:E})}const R=s.a.createElement(s.a.Fragment,null,s.a.createElement("h2",null,r.a.getWidgetName(E)),s.a.createElement(p.c,{kind:"secondary",className:"mx_WidgetCard_optionsButton",inputRef:C,onClick:w,isExpanded:S,label:Object(c.a)("Options")}),x);return s.a.createElement(o.b,{header:R,className:"mx_WidgetCard",onClose:b,previousPhase:m.c.RoomSummary,withoutScrollContainer:!0},s.a.createElement(l.a,{app:E,fullWidth:!0,show:!0,showMenubar:!1,room:t,userId:y.getUserId(),creatorUserId:E.creatorUserId,widgetPageTitle:r.a.getWidgetDataTitle(E),waitForIframeLoad:E.waitForIframeLoad}))}},1351:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(223),u=a.n(m),h=a(97),p=a(93),g=a(110),f=a(215),v=a(99),b=a(94);function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function E(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let _=Object(b.a)("views.elements.AppPermission")((s=class extends l.a.Component{constructor(e){super(e);const t=this.parseWidgetUrl(),a=v.a.get().getRoom(this.props.roomId);let n;a&&(n=a.getMember(this.props.creatorUserId)),this.state=E(E({},t),{},{roomMember:n})}parseWidgetUrl(){const e=u.a.parse(this.props.url),t=new URLSearchParams(e.search);if(f.a.isScalarUrl(e)&&t&&t.get("url")){const e=u.a.parse(t.get("url"));return{widgetDomain:e.host||e.hostname,isWrapped:!0}}return{widgetDomain:e.host||e.hostname,isWrapped:!1}}render(){const e=g.a.get().brand,t=h.getComponent("views.elements.AccessibleButton"),a=h.getComponent("views.avatars.MemberAvatar"),n=h.getComponent("views.avatars.BaseAvatar"),s=h.getComponent("views.elements.TextWithTooltip"),i=this.state.roomMember?this.state.roomMember.name:this.props.creatorUserId,o=i===this.props.creatorUserId?null:this.props.creatorUserId,r=this.state.roomMember?l.a.createElement(a,{member:this.state.roomMember,width:38,height:38}):l.a.createElement(n,{name:this.props.creatorUserId,width:38,height:38}),c=l.a.createElement("div",null,Object(p.a)("Any of the following data may be shared:"),l.a.createElement("ul",null,l.a.createElement("li",null,Object(p.a)("Your display name")),l.a.createElement("li",null,Object(p.a)("Your avatar URL")),l.a.createElement("li",null,Object(p.a)("Your user ID")),l.a.createElement("li",null,Object(p.a)("Your theme")),l.a.createElement("li",null,Object(p.a)("%(brand)s URL",{brand:e})),l.a.createElement("li",null,Object(p.a)("Room ID")),l.a.createElement("li",null,Object(p.a)("Widget ID")))),d=l.a.createElement(s,{tooltip:c,tooltipClass:"mx_AppPermissionWarning_tooltip mx_Tooltip_dark"},l.a.createElement("span",{className:"mx_AppPermissionWarning_helpIcon"})),m=this.state.isWrapped?Object(p.a)("Using this widget may share data <helpIcon /> with %(widgetDomain)s & your Integration Manager.",{widgetDomain:this.state.widgetDomain},{helpIcon:()=>d}):Object(p.a)("Using this widget may share data <helpIcon /> with %(widgetDomain)s.",{widgetDomain:this.state.widgetDomain},{helpIcon:()=>d}),u=this.props.isRoomEncrypted?Object(p.a)("Widgets do not use message encryption."):null;return l.a.createElement("div",{className:"mx_AppPermissionWarning"},l.a.createElement("div",{className:"mx_AppPermissionWarning_row mx_AppPermissionWarning_bolder mx_AppPermissionWarning_smallText"},Object(p.a)("Widget added by")),l.a.createElement("div",{className:"mx_AppPermissionWarning_row"},r,l.a.createElement("h4",{className:"mx_AppPermissionWarning_bolder"},i),l.a.createElement("div",{className:"mx_AppPermissionWarning_smallText"},o)),l.a.createElement("div",{className:"mx_AppPermissionWarning_row mx_AppPermissionWarning_smallText"},m),l.a.createElement("div",{className:"mx_AppPermissionWarning_row mx_AppPermissionWarning_smallText"},Object(p.a)("This widget may use cookies.")," ",u),l.a.createElement("div",{className:"mx_AppPermissionWarning_row"},l.a.createElement(t,{kind:"primary_sm",onClick:this.props.onPermissionGranted},Object(p.a)("Continue"))))}},o()(s,"propTypes",{url:d.a.string.isRequired,creatorUserId:d.a.string.isRequired,roomId:d.a.string.isRequired,onPermissionGranted:d.a.func.isRequired,isRoomEncrypted:d.a.bool}),o()(s,"defaultProps",{onPermissionGranted:()=>{}}),n=s))||n},1352:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(92);const o=e=>s.a.createElement("div",{className:"mx_AppPermissionWarning"},s.a.createElement("div",{className:"mx_AppPermissionWarningImage"},s.a.createElement("img",{src:a(373),alt:""})),s.a.createElement("div",{className:"mx_AppPermissionWarningText"},s.a.createElement("span",{className:"mx_AppPermissionWarningTextLabel"},e.errorMsg)));o.propTypes={errorMsg:a.n(i).a.string},o.defaultProps={errorMsg:"Error"},t.a=o},1353:function(e,t,a){"use strict";var n=a(19),s=a.n(n),i=a(165);class o{constructor(){s()(this,"listeners",{}),s()(this,"_activeRoomId",i.a.getRoomId()),s()(this,"roomStoreToken",void 0),s()(this,"onRoomViewStoreUpdate",()=>{this._activeRoomId&&this.emit(this._activeRoomId,!1),this._activeRoomId=i.a.getRoomId(),this._activeRoomId&&this.emit(this._activeRoomId,!0)}),this.roomStoreToken=i.a.addListener(this.onRoomViewStoreUpdate)}get activeRoomId(){return this._activeRoomId}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}removeListener(e,t){if(this.listeners[e]){const a=this.listeners[e].indexOf(t);a>-1&&this.listeners[e].splice(a,1)}else console.warn("Unregistering unrecognised listener (roomId="+e+")")}emit(e,t){if(this.listeners[e])for(const a of this.listeners[e])a.call(null,t)}}void 0===window.mxActiveRoomObserver&&(window.mxActiveRoomObserver=new o),t.a=window.mxActiveRoomObserver},1354:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(97),h=a(281),p=a(206),g=a(1355),f=a(94);let v=Object(f.a)("views.dialogs.WidgetOpenIDPermissionsDialog")((s=class extends l.a.Component{constructor(){super(),o()(this,"_onAllow",()=>{this._onPermissionSelection(!0)}),o()(this,"_onDeny",()=>{this._onPermissionSelection(!1)}),o()(this,"_onRememberSelectionChange",e=>{this.setState({rememberSelection:e})}),this.state={rememberSelection:!1}}_onPermissionSelection(e){this.state.rememberSelection&&(console.log(`Remembering ${this.props.widgetId} as allowed=${e} for OpenID`),g.b.instance.setOIDCState(this.props.widget,this.props.widgetKind,this.props.inRoomId,e?g.a.Allowed:g.a.Denied)),this.props.onFinished(e)}render(){const e=u.getComponent("views.dialogs.BaseDialog"),t=u.getComponent("views.elements.DialogButtons");return l.a.createElement(e,{className:"mx_WidgetOpenIDPermissionsDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(m.a)("Allow this widget to verify your identity")},l.a.createElement("div",{className:"mx_WidgetOpenIDPermissionsDialog_content"},l.a.createElement("p",null,Object(m.a)("The widget will verify your user ID, but won't be able to perform actions for you:")),l.a.createElement("p",{className:"text-muted"},this.props.widget.templateUrl.split("?")[0].split("#")[0])),l.a.createElement(t,{primaryButton:Object(m.a)("Continue"),onPrimaryButtonClick:this._onAllow,onCancel:this._onDeny,additive:l.a.createElement(h.a,{value:this.state.rememberSelection,toggleInFront:!0,onChange:this._onRememberSelectionChange,label:Object(m.a)("Remember this")})}))}},o()(s,"propTypes",{onFinished:d.a.func.isRequired,widget:d.a.objectOf(p.Widget).isRequired,widgetKind:d.a.string.isRequired,inRoomId:d.a.string}),n=s))||n},1355:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return d}));var n=a(19),s=a.n(n),i=a(103),o=a(206),r=a(99),l=a(123);let c;!function(e){e[e.Allowed=0]="Allowed",e[e.Denied=1]="Denied",e[e.Unknown=2]="Unknown"}(c||(c={}));class d{constructor(){}static get instance(){return d.internalInstance||(d.internalInstance=new d),d.internalInstance}packSettingKey(e,t,a){let n=a;if(t!==o.WidgetKind.Room&&(n=r.a.get().getUserId()),t===o.WidgetKind.Modal&&(n="*MODAL*-"+n),!n)throw new Error("Failed to determine a location to check the widget's OIDC state with");return encodeURIComponent(`${n}::${e.templateUrl}`)}getOIDCState(e,t,a){var n,s;const o=this.packSettingKey(e,t,a),r=i.b.getValue("widgetOpenIDPermissions");return null!=r&&null!==(n=r.deny)&&void 0!==n&&n.includes(o)?c.Denied:null!=r&&null!==(s=r.allow)&&void 0!==s&&s.includes(o)?c.Allowed:c.Unknown}setOIDCState(e,t,a,n){const s=this.packSettingKey(e,t,a),o=i.b.getValue("widgetOpenIDPermissions");o.allow||(o.allow=[]),o.deny||(o.deny=[]),n===c.Allowed?o.allow.push(s):n===c.Denied?o.deny.push(s):(o.allow=o.allow.filter(e=>e!==s),o.deny=o.deny.filter(e=>e!==s)),i.b.setValue("widgetOpenIDPermissions",null,l.a.DEVICE,o)}}s()(d,"internalInstance",void 0)},1356:function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),function(e){e.CanChangeViewedRoom="io.element.view_room"}(n||(n={}))},1357:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n,s=a(19),i=a.n(s),o=a(88),r=a(182),l=a(93),c=a(108),d=a(206),m=a(1542),u=a(99),h=a(253),p=a(153),g=a(1545),f=a(94),v=a(1358),b=a(103);function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function E(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let _=Object(f.a)("views.dialogs.ModalWidgetDialog")(n=class extends o.PureComponent{constructor(e){super(e),i()(this,"widget",void 0),i()(this,"possibleButtons",void 0),i()(this,"appFrame",o.createRef()),i()(this,"state",{disabledButtonIds:[]}),i()(this,"onReady",()=>{this.state.messaging.sendWidgetConfig(this.props.widgetDefinition)}),i()(this,"onLoad",()=>{this.state.messaging.once("ready",this.onReady),this.state.messaging.on("action:"+d.WidgetApiFromWidgetAction.CloseModalWidget,this.onWidgetClose),this.state.messaging.on("action:"+d.WidgetApiFromWidgetAction.SetModalButtonEnabled,this.onButtonEnableToggle)}),i()(this,"onWidgetClose",e=>{this.props.onFinished(!0,e.detail.data)}),i()(this,"onButtonEnableToggle",e=>{e.preventDefault();if(e.detail.data.button===d.BuiltInModalButtonID.Close||!this.possibleButtons.includes(e.detail.data.button))return this.state.messaging.transport.reply(e.detail,{error:{message:"Invalid button"}});let t;if(e.detail.data.enabled)t=Object(p.b)(this.state.disabledButtonIds).filter(t=>t!==e.detail.data.button);else{const a=new Set(this.state.disabledButtonIds);a.add(e.detail.data.button),t=Array.from(a)}this.setState({disabledButtonIds:t}),this.state.messaging.transport.reply(e.detail,{})}),this.widget=new g.a(E(E({},this.props.widgetDefinition),{},{creatorUserId:u.a.get().getUserId(),id:"modal_"+this.props.sourceWidgetId})),this.possibleButtons=(this.props.widgetDefinition.buttons||[]).map(e=>e.id)}componentDidMount(){const e=new m.a([],this.widget,d.WidgetKind.Modal),t=new d.ClientWidgetApi(this.widget,this.appFrame.current,e);this.setState({messaging:t})}componentWillUnmount(){this.state.messaging.off("ready",this.onReady),this.state.messaging.off("action:"+d.WidgetApiFromWidgetAction.CloseModalWidget,this.onWidgetClose),this.state.messaging.stop()}render(){const e=this.widget.getCompleteUrl({widgetRoomId:this.props.widgetRoomId,currentUserId:u.a.get().getUserId(),userDisplayName:h.a.instance.displayName,userHttpAvatarUrl:h.a.instance.getHttpAvatarUrl(),clientId:v.a,clientTheme:b.b.getValue("theme"),clientLanguage:Object(l.g)()}),t=new URL(e);t.searchParams.set("widgetId",this.widget.id),t.searchParams.set("parentUrl",window.location.href.split("#",2)[0]);const n=t.toString().replace(/%24/g,"$");let s;return this.props.widgetDefinition.buttons&&(s=this.props.widgetDefinition.buttons.slice(0,3).reverse().map(e=>{let t="secondary";switch(e.kind){case d.ModalButtonKind.Primary:t="primary";break;case d.ModalButtonKind.Secondary:t="primary_outline";break;case d.ModalButtonKind.Danger:t="danger"}const a=this.state.disabledButtonIds.includes(e.id);return o.createElement(c.a,{key:e.id,kind:t,onClick:()=>{this.state.messaging.notifyModalWidgetButtonClicked(e.id)},disabled:a},e.label)})),o.createElement(r.a,{title:this.props.widgetDefinition.name||Object(l.a)("Modal Widget"),className:"mx_ModalWidgetDialog",contentId:"mx_Dialog_content",onFinished:this.props.onFinished},o.createElement("div",{className:"mx_ModalWidgetDialog_warning"},o.createElement("img",{src:a(1359),height:"16",width:"16",alt:""}),Object(l.a)("Data on this screen is shared with %(widgetDomain)s",{widgetDomain:t.hostname})),o.createElement("div",null,o.createElement("iframe",{ref:this.appFrame,sandbox:"allow-forms allow-scripts allow-same-origin",src:n,onLoad:this.onLoad})),o.createElement("div",{className:"mx_ModalWidgetDialog_buttons"},s))}})||n},1358:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n="io.element.web"},1359:function(e,t){e.exports="img/element-icons/warning-badge.61b5c9e.svg"},1360:function(e,t,a){"use strict";a.d(t,"a",(function(){return C}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(110),d=a(100),m=a(205),u=a(302),h=a(99),p=a(97),g=a(203),f=a(336),v=a(183),b=a(167),y=a(250),E=a(94),_=a(103);const S=/[\x21-\x2F\x3A-\x40\x5B-\x60\x7B-\x7E]+/g;let C=Object(E.a)("views.rooms.MemberList")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"onUserPresenceChange",(e,t)=>{this.refs[t.userId]&&this._updateList()}),i()(this,"onRoom",e=>{e.roomId===this.props.roomId&&this._showMembersAccordingToMembershipWithLL()}),i()(this,"onMyMembership",(e,t,a)=>{e.roomId===this.props.roomId&&"join"===t&&this._showMembersAccordingToMembershipWithLL()}),i()(this,"onRoomStateMember",(e,t,a)=>{a.roomId===this.props.roomId&&this._updateList()}),i()(this,"onRoomMemberName",(e,t)=>{t.roomId===this.props.roomId&&this._updateList()}),i()(this,"onRoomStateEvent",(e,t)=>{e.getRoomId()===this.props.roomId&&"m.room.third_party_invite"===e.getType()&&this._updateList(),this.canInvite!==this.state.canInvite&&this.setState({canInvite:this.canInvite})}),i()(this,"_updateList",Object(u.a)(()=>{this._updateListNow()},500)),i()(this,"_createOverflowTileJoined",(e,t)=>this._createOverflowTile(e,t,this._showMoreJoinedMemberList)),i()(this,"_createOverflowTileInvited",(e,t)=>this._createOverflowTile(e,t,this._showMoreInvitedMemberList)),i()(this,"_createOverflowTile",(e,t,n)=>{const s=p.getComponent("rooms.EntityTile"),i=p.getComponent("avatars.BaseAvatar"),o=Object(l.a)("and %(count)s others...",{count:e});return r.a.createElement(s,{className:"mx_EntityTile_ellipsis",avatarJsx:r.a.createElement(i,{url:a(809),name:"...",width:36,height:36}),name:o,presenceState:"online",suppressOnHover:!0,onClick:n})}),i()(this,"_showMoreJoinedMemberList",()=>{this.setState({truncateAtJoined:this.state.truncateAtJoined+100})}),i()(this,"_showMoreInvitedMemberList",()=>{this.setState({truncateAtInvited:this.state.truncateAtInvited+100})}),i()(this,"memberSort",(e,t)=>{const a=e.user,n=t.user;if(!a&&!n)return 0;if(a&&!n)return-1;if(!a&&n)return 1;if(this._showPresence){const e=e=>"unavailable"===e?"online":e,t=t=>{const a=["active","online","offline"],n=a.indexOf(e(t));return-1===n?a.length:n},s=t(a.currentlyActive?"active":a.presence),i=t(n.currentlyActive?"active":n.presence);if(s!==i)return s-i}return e.powerLevel!==t.powerLevel?t.powerLevel-e.powerLevel:this._showPresence&&a.getLastActiveTs()!==n.getLastActiveTs()?n.getLastActiveTs()-a.getLastActiveTs():this.collator.compare(e.sortName,t.sortName)}),i()(this,"onSearchQueryChanged",e=>{this.setState({searchQuery:e,filteredJoinedMembers:this._filterMembers(this.state.members,"join",e),filteredInvitedMembers:this._filterMembers(this.state.members,"invite",e)})}),i()(this,"_onPending3pidInviteClick",e=>{d.a.dispatch({action:"view_3pid_invite",event:e})}),i()(this,"_getChildrenJoined",(e,t)=>this._makeMemberTiles(this.state.filteredJoinedMembers.slice(e,t))),i()(this,"_getChildCountJoined",()=>this.state.filteredJoinedMembers.length),i()(this,"_getChildrenInvited",(e,t)=>{let a=this.state.filteredInvitedMembers;return t>this.state.filteredInvitedMembers.length&&(a=a.concat(this._getPending3PidInvites())),this._makeMemberTiles(a.slice(e,t))}),i()(this,"_getChildCountInvited",()=>this.state.filteredInvitedMembers.length+(this._getPending3PidInvites()||[]).length),i()(this,"onInviteButtonClick",()=>{h.a.get().isGuest()?d.a.dispatch({action:"require_registration"}):d.a.dispatch({action:"view_invite",roomId:this.props.roomId})});const t=h.a.get();t.hasLazyLoadMembersEnabled()?this.state=this._getMembersState([]):this.state=this._getMembersState(this.roomMembers()),t.on("Room",this.onRoom);const n=c.a.get().enable_presence_by_hs_url,s=h.a.get().baseUrl;this._showPresence=!0,n&&void 0!==n[s]&&(this._showPresence=n[s])}UNSAFE_componentWillMount(){const e=h.a.get();this._mounted=!0,e.hasLazyLoadMembersEnabled()?(this._showMembersAccordingToMembershipWithLL(),e.on("Room.myMembership",this.onMyMembership)):this._listenForMembersChanges()}_listenForMembersChanges(){const e=h.a.get();e.on("RoomState.members",this.onRoomStateMember),e.on("RoomMember.name",this.onRoomMemberName),e.on("RoomState.events",this.onRoomStateEvent),e.on("User.lastPresenceTs",this.onUserPresenceChange),e.on("User.presence",this.onUserPresenceChange),e.on("User.currentlyActive",this.onUserPresenceChange)}componentWillUnmount(){this._mounted=!1;const e=h.a.get();e&&(e.removeListener("RoomState.members",this.onRoomStateMember),e.removeListener("RoomMember.name",this.onRoomMemberName),e.removeListener("Room.myMembership",this.onMyMembership),e.removeListener("RoomState.events",this.onRoomStateEvent),e.removeListener("Room",this.onRoom),e.removeListener("User.lastPresenceTs",this.onUserPresenceChange),e.removeListener("User.presence",this.onUserPresenceChange),e.removeListener("User.currentlyActive",this.onUserPresenceChange)),this._updateList.cancelPendingCall()}async _showMembersAccordingToMembershipWithLL(){if(h.a.get().hasLazyLoadMembersEnabled()){const e=h.a.get().getRoom(this.props.roomId);if("join"===(e&&e.getMyMembership())){this.setState({loading:!0});try{await e.loadMembersIfNeeded()}catch(e){}this._mounted&&(this.setState(this._getMembersState(this.roomMembers())),this._listenForMembersChanges())}else this.setState(this._getMembersState(this.roomMembers()))}}get canInvite(){const e=h.a.get(),t=e.getRoom(this.props.roomId);return t&&t.canInvite(e.getUserId())}_getMembersState(e){return{loading:!1,members:e,filteredJoinedMembers:this._filterMembers(e,"join"),filteredInvitedMembers:this._filterMembers(e,"invite"),canInvite:this.canInvite,truncateAtJoined:30,truncateAtInvited:5,searchQuery:""}}_updateListNow(){const e={loading:!1,members:this.roomMembers()};e.filteredJoinedMembers=this._filterMembers(e.members,"join",this.state.searchQuery),e.filteredInvitedMembers=this._filterMembers(e.members,"invite",this.state.searchQuery),this.setState(e)}getMembersWithUser(){if(!this.props.roomId)return[];const e=h.a.get(),t=e.getRoom(this.props.roomId);if(!t)return[];const a=Object.values(t.currentState.members);return a.forEach((function(t){null===t.user&&(t.user=e.getUser(t.userId)),t.sortName=("@"===t.name[0]?t.name.substr(1):t.name).replace(S,"")})),a}roomMembers(){const e=this.getMembersWithUser().filter(e=>"join"===e.membership||"invite"===e.membership),t=_.b.getValue("language");return this.collator=new Intl.Collator(t,{sensitivity:"base",usePunctuation:!0}),e.sort(this.memberSort),e}memberString(e){if(e){const t=e.user;return"("+e.name+", "+e.powerLevel+", "+(t?t.lastActiveAgo:"<null>")+", "+(t?t.getLastActiveTs():"<null>")+", "+(t?t.currentlyActive:"<null>")+", "+(t?t.presence:"<null>")+")"}return"(null)"}_filterMembers(e,t,a){return e.filter(e=>{if(a){a=a.toLowerCase();const t=-1!==e.name.toLowerCase().indexOf(a),n=-1!==e.userId.toLowerCase().indexOf(a);if(!t&&!n)return!1}return e.membership===t})}_getPending3PidInvites(){const e=h.a.get().getRoom(this.props.roomId);if(e)return e.currentState.getStateEvents("m.room.third_party_invite").filter((function(t){if(!Object(m.c)(t))return!1;return!e.currentState.getInviteForThreePidToken(t.getStateKey())}))}_makeMemberTiles(e){const t=p.getComponent("rooms.MemberTile"),a=p.getComponent("rooms.EntityTile");return e.map(e=>e.userId?r.a.createElement(t,{key:e.userId,member:e,ref:e.userId,showPresence:this._showPresence}):r.a.createElement(a,{key:e.getStateKey(),name:e.getContent().display_name,suppressOnHover:!0,onClick:()=>this._onPending3pidInviteClick(e)}))}render(){if(this.state.loading){const e=p.getComponent("elements.Spinner");return r.a.createElement(f.b,{className:"mx_MemberList",onClose:this.props.onClose,previousPhase:v.c.RoomSummary},r.a.createElement(e,null))}const e=p.getComponent("structures.SearchBox"),t=p.getComponent("elements.TruncatedList"),a=h.a.get().getRoom(this.props.roomId);let n,s,i;if(a&&"join"===a.getMyMembership()){let e=Object(l.a)("Invite to this room");const t=g.a.instance.getSelectedCommunityGeneralChat();t&&t.roomId===this.props.roomId?e=Object(l.a)("Invite to this community"):_.b.getValue("feature_spaces")&&a.isSpaceRoom()&&(e=Object(l.a)("Invite to this space"));const s=p.getComponent("elements.AccessibleButton");n=r.a.createElement(s,{className:"mx_MemberList_invite",onClick:this.onInviteButtonClick,disabled:!this.state.canInvite},r.a.createElement("span",null,e))}this._getChildCountInvited()>0&&(s=r.a.createElement("h2",null,Object(l.a)("Invited")),i=r.a.createElement(t,{className:"mx_MemberList_section mx_MemberList_invited",truncateAt:this.state.truncateAtInvited,createOverflowElement:this._createOverflowTileInvited,getChildren:this._getChildrenInvited,getChildCount:this._getChildCountInvited}));const o=r.a.createElement(e,{className:"mx_MemberList_query mx_textinput_icon mx_textinput_search",placeholder:Object(l.a)("Filter room members"),onSearch:this.onSearchQueryChanged});let c,d=v.c.RoomSummary;return _.b.getValue("feature_spaces")&&null!=a&&a.isSpaceRoom()&&(d=void 0,c=r.a.createElement("div",{className:"mx_RightPanel_scopeHeader"},r.a.createElement(b.a,{room:a,height:32,width:32}),r.a.createElement(y.a,{room:a}))),r.a.createElement(f.b,{className:"mx_MemberList",header:r.a.createElement(r.a.Fragment,null,c,n),footer:o,onClose:this.props.onClose,previousPhase:d},r.a.createElement("div",{className:"mx_MemberList_wrapper"},r.a.createElement(t,{className:"mx_MemberList_section mx_MemberList_joined",truncateAt:this.state.truncateAtJoined,createOverflowElement:this._createOverflowTileJoined,getChildren:this._getChildrenJoined,getChildCount:this._getChildCountJoined}),s,i))}})||n},1361:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(93),d=a(97),m=a(100),u=a(192),h=a(92),p=a.n(h),g=a(810),f=a(108),v=a(183),b=a(138),y=a(115),E=a(94);let _=Object(E.a)("views.groups.GroupMemberList")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"state",{members:null,membersError:null,invitedMembers:null,invitedMembersError:null,truncateAt:30}),o()(this,"_createOverflowTile",(e,t)=>{const n=d.getComponent("rooms.EntityTile"),s=d.getComponent("avatars.BaseAvatar"),i=Object(c.a)("and %(count)s others...",{count:e});return l.a.createElement(n,{className:"mx_EntityTile_ellipsis",avatarJsx:l.a.createElement(s,{url:a(809),name:"...",width:36,height:36}),name:i,presenceState:"online",suppressOnHover:!0,onClick:this._showFullMemberList})}),o()(this,"_showFullMemberList",()=>{this.setState({truncateAt:-1})}),o()(this,"onSearchQueryChanged",e=>{this.setState({searchQuery:e.target.value})}),o()(this,"onInviteToGroupButtonClick",()=>{Object(g.b)(this.props.groupId).then(()=>{m.a.dispatch({action:y.a.SetRightPanelPhase,phase:v.c.GroupMemberList,refireParams:{groupId:this.props.groupId}})})})}componentDidMount(){this._unmounted=!1,this._initGroupStore(this.props.groupId)}componentWillUnmount(){this._unmounted=!0}_initGroupStore(e){u.a.registerListener(e,()=>{this._fetchMembers()}),u.a.on("error",(t,a,n)=>{this._unmounted||e!==a||(n===u.a.STATE_KEY.GroupMembers&&this.setState({membersError:t}),n===u.a.STATE_KEY.GroupInvitedMembers&&this.setState({invitedMembersError:t}))})}_fetchMembers(){this._unmounted||this.setState({members:u.a.getGroupMembers(this.props.groupId),invitedMembers:u.a.getGroupInvitedMembers(this.props.groupId)})}makeGroupMemberTiles(e,t,a){if(a)return l.a.createElement("div",{className:"warning"},Object(c.a)("Failed to load group members"));const n=d.getComponent("groups.GroupMemberTile"),s=d.getComponent("elements.TruncatedList");(e=(e||"").toLowerCase())&&(t=t.filter(t=>{const a=(t.displayname||"").toLowerCase().includes(e),n=t.userId.toLowerCase().includes(e);return!(!a&&!n)}));const i={};t.forEach(e=>{i[e.userId]||(i[e.userId]=e)}),(t=Object.keys(i).map(e=>i[e])).sort((e,t)=>{if(e.isPrivileged===t.isPrivileged){const a=e.displayname||e.userId,n=t.displayname||t.userId;return a<n?-1:a>n?1:0}return e.isPrivileged?-1:1});const o=t.map(e=>l.a.createElement(n,{key:e.userId,groupId:this.props.groupId,member:e}));return l.a.createElement(s,{className:"mx_MemberList_wrapper",truncateAt:this.state.truncateAt,createOverflowElement:this._createOverflowTile},o)}render(){if(this.state.fetching||this.state.fetchingInvitedMembers){const e=d.getComponent("elements.Spinner");return l.a.createElement("div",{className:"mx_MemberList"},l.a.createElement(e,null))}const e=l.a.createElement("input",{className:"mx_GroupMemberList_query mx_textinput",id:"mx_GroupMemberList_query",type:"text",onChange:this.onSearchQueryChanged,value:this.state.searchQuery,placeholder:Object(c.a)("Filter community members"),autoComplete:"off"}),t=this.state.members?l.a.createElement("div",{className:"mx_MemberList_joined"},this.makeGroupMemberTiles(this.state.searchQuery,this.state.members,this.state.membersError)):l.a.createElement("div",null),a=this.state.invitedMembers&&this.state.invitedMembers.length>0?l.a.createElement("div",{className:"mx_MemberList_invited"},l.a.createElement("h2",null,Object(c.a)("Invited")),this.makeGroupMemberTiles(this.state.searchQuery,this.state.invitedMembers,this.state.invitedMembersError)):l.a.createElement("div",null);let n;return u.a.isUserPrivileged(this.props.groupId)&&(n=l.a.createElement(f.a,{className:"mx_MemberList_invite mx_MemberList_inviteCommunity",onClick:this.onInviteToGroupButtonClick},l.a.createElement("span",null,Object(c.a)("Invite to this community")))),l.a.createElement("div",{className:"mx_MemberList",role:"tabpanel"},n,l.a.createElement(b.a,null,t,a),e)}},o()(s,"propTypes",{groupId:p.a.string.isRequired}),n=s))||n},1362:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(93),d=a(97),m=a(192),u=a(92),h=a.n(u),p=a(810),g=a(108),f=a(138),v=a(94);let b=Object(v.a)("views.groups.GroupRoomList")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"state",{rooms:null,truncateAt:30,searchQuery:""}),o()(this,"onGroupStoreUpdated",()=>{this._unmounted||this.setState({rooms:m.a.getGroupRooms(this.props.groupId)})}),o()(this,"_createOverflowTile",(e,t)=>{const n=d.getComponent("rooms.EntityTile"),s=d.getComponent("avatars.BaseAvatar"),i=Object(c.a)("and %(count)s others...",{count:e});return l.a.createElement(n,{className:"mx_EntityTile_ellipsis",avatarJsx:l.a.createElement(s,{url:a(809),name:"...",width:36,height:36}),name:i,presenceState:"online",suppressOnHover:!0,onClick:this._showFullRoomList})}),o()(this,"_showFullRoomList",()=>{this.setState({truncateAt:-1})}),o()(this,"onSearchQueryChanged",e=>{this.setState({searchQuery:e.target.value})}),o()(this,"onAddRoomToGroupButtonClick",()=>{Object(p.a)(this.props.groupId).then(()=>{this.forceUpdate()})})}componentDidMount(){this._unmounted=!1,this._initGroupStore(this.props.groupId)}componentWillUnmount(){this._unmounted=!0,this._unregisterGroupStore()}_unregisterGroupStore(){m.a.unregisterListener(this.onGroupStoreUpdated)}_initGroupStore(e){m.a.registerListener(e,this.onGroupStoreUpdated),m.a.on("error",(t,a)=>{a===e&&this.setState({rooms:null})})}makeGroupRoomTiles(e){const t=d.getComponent("groups.GroupRoomTile");e=(e||"").toLowerCase();let a=this.state.rooms;return e&&(a=a.filter(t=>{const a=(t.name||"").toLowerCase().includes(e),n=(t.canonicalAlias||"").toLowerCase().includes(e);return a||n})),a=a.map((e,a)=>l.a.createElement(t,{key:a,groupId:this.props.groupId,groupRoom:e})),a}render(){if(null===this.state.rooms)return null;let e;m.a.isUserPrivileged(this.props.groupId)&&(e=l.a.createElement(g.a,{className:"mx_MemberList_invite mx_MemberList_addRoomToCommunity",onClick:this.onAddRoomToGroupButtonClick},l.a.createElement("span",null,Object(c.a)("Add rooms to this community"))));const t=l.a.createElement("input",{className:"mx_GroupRoomList_query mx_textinput",id:"mx_GroupRoomList_query",type:"text",onChange:this.onSearchQueryChanged,value:this.state.searchQuery,placeholder:Object(c.a)("Filter community rooms"),autoComplete:"off"}),a=d.getComponent("elements.TruncatedList");return l.a.createElement("div",{className:"mx_GroupRoomList",role:"tabpanel"},e,l.a.createElement(f.a,{className:"mx_GroupRoomList_joined mx_GroupRoomList_outerWrapper"},l.a.createElement(a,{className:"mx_GroupRoomList_wrapper",truncateAt:this.state.truncateAt,createOverflowElement:this._createOverflowTile},this.makeGroupRoomTiles(this.state.searchQuery))),t)}},o()(s,"propTypes",{groupId:h.a.string.isRequired}),n=s))||n},1363:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(100),u=a(106),h=a(97),p=a(93),g=a(192),f=a(119),v=a(138),b=a(94),y=a(126);let E=Object(b.a)("views.groups.GroupRoomInfo")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"state",{isUserPrivilegedInGroup:null,groupRoom:null,groupRoomPublicityLoading:!1,groupRoomRemoveLoading:!1}),o()(this,"onGroupStoreUpdated",()=>{this.setState({isUserPrivilegedInGroup:g.a.isUserPrivileged(this.props.groupId)}),this._updateGroupRoom()}),o()(this,"_onRemove",e=>{const t=this.props.groupId,a=this.state.groupRoom.displayname;e.preventDefault(),e.stopPropagation();const n=h.getComponent("dialogs.QuestionDialog");u.a.createTrackedDialog("Confirm removal of group from room","",n,{title:Object(p.a)("Are you sure you want to remove '%(roomName)s' from %(groupId)s?",{roomName:a,groupId:t}),description:Object(p.a)("Removing a room from the community will also remove it from the community page."),button:Object(p.a)("Remove"),onFinished:e=>{if(!e)return;this.setState({groupRoomRemoveLoading:!0});const t=this.props.groupId,n=this.props.groupRoomId;g.a.removeRoomFromGroup(this.props.groupId,n).then(()=>{m.a.dispatch({action:"view_group_room_list"})}).catch(e=>{console.error(`Error whilst removing ${n} from ${t}`,e);const s=h.getComponent("dialogs.ErrorDialog");u.a.createTrackedDialog("Failed to remove room from group","",s,{title:Object(p.a)("Failed to remove room from community"),description:Object(p.a)("Failed to remove '%(roomName)s' from %(groupId)s",{groupId:t,roomName:a})})}).finally(()=>{this.setState({groupRoomRemoveLoading:!1})})}})}),o()(this,"_onCancel",e=>{m.a.dispatch({action:"view_group_room_list"})}),o()(this,"_changeGroupRoomPublicity",e=>{const t="public"===e.target.value;this.setState({groupRoomPublicityLoading:!0});const a=this.props.groupId,n=this.props.groupRoomId,s=this.state.groupRoom.displayname;g.a.updateGroupRoomVisibility(this.props.groupId,n,t).catch(e=>{console.error(`Error whilst changing visibility of ${n} in ${a} to ${t}`,e);const i=h.getComponent("dialogs.ErrorDialog");u.a.createTrackedDialog("Failed to remove room from group","",i,{title:Object(p.a)("Something went wrong!"),description:Object(p.a)("The visibility of '%(roomName)s' in %(groupId)s could not be updated.",{roomName:s,groupId:a})})}).finally(()=>{this.setState({groupRoomPublicityLoading:!1})})})}componentDidMount(){this._initGroupStore(this.props.groupId)}UNSAFE_componentWillReceiveProps(e){e.groupId!==this.props.groupId&&(this._unregisterGroupStore(this.props.groupId),this._initGroupStore(e.groupId))}componentWillUnmount(){this._unregisterGroupStore(this.props.groupId)}_initGroupStore(e){g.a.registerListener(e,this.onGroupStoreUpdated)}_unregisterGroupStore(e){g.a.unregisterListener(this.onGroupStoreUpdated)}_updateGroupRoom(){this.setState({groupRoom:g.a.getGroupRooms(this.props.groupId).find(e=>e.roomId===this.props.groupRoomId)})}render(){const e=h.getComponent("elements.AccessibleButton"),t=h.getComponent("elements.InlineSpinner");if(this.state.groupRoomRemoveLoading||!this.state.groupRoom){const e=h.getComponent("elements.Spinner");return l.a.createElement("div",{className:"mx_MemberInfo"},l.a.createElement(e,null))}let n;this.state.isUserPrivilegedInGroup&&(n=l.a.createElement("div",{className:"mx_MemberInfo_adminTools"},l.a.createElement("h3",null,Object(p.a)("Admin Tools")),l.a.createElement("div",{className:"mx_MemberInfo_buttons"},l.a.createElement(e,{className:"mx_MemberInfo_field",onClick:this._onRemove},Object(p.a)("Remove from community"))),l.a.createElement("h3",null,Object(p.a)("Visibility in Room List"),this.state.groupRoomPublicityLoading?l.a.createElement(t,null):l.a.createElement("div",null)),l.a.createElement("div",null,l.a.createElement("label",null,l.a.createElement("input",{type:"radio",value:"public",checked:this.state.groupRoom.isPublic,onChange:this._changeGroupRoomPublicity}),l.a.createElement("div",{className:"mx_MemberInfo_label_text"},Object(p.a)("Visible to everyone")))),l.a.createElement("div",null,l.a.createElement("label",null,l.a.createElement("input",{type:"radio",value:"private",checked:!this.state.groupRoom.isPublic,onChange:this._changeGroupRoomPublicity}),l.a.createElement("div",{className:"mx_MemberInfo_label_text"},Object(p.a)("Only visible to community members"))))));const s=this.state.groupRoom.avatarUrl;let i;if(s){const e=Object(y.b)(s).getSquareThumbnailHttp(800);i=l.a.createElement("div",{className:"mx_MemberInfo_avatar"},l.a.createElement("img",{src:e}))}const o=this.state.groupRoom.displayname;return l.a.createElement("div",{className:"mx_MemberInfo",role:"tabpanel"},l.a.createElement(v.a,null,l.a.createElement(e,{className:"mx_MemberInfo_cancel",onClick:this._onCancel},l.a.createElement("img",{src:a(502),width:"18",height:"18",className:"mx_filterFlipColor"})),i,l.a.createElement("h2",null,o),l.a.createElement("div",{className:"mx_MemberInfo_profile"},l.a.createElement("div",{className:"mx_MemberInfo_profileField"},this.state.groupRoom.canonicalAlias)),n))}},o()(s,"contextType",f.a),o()(s,"propTypes",{groupId:d.a.string,groupRoomId:d.a.string}),n=s))||n},1364:function(e,t,a){"use strict";var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(257),u=a(256),h=a(100),p=a(106),g=a(93),f=a(214),v=a(185),b=a(108),y=a(110),E=a(103),_=a(165),S=a(582),C=a(192),w=a(99),O=a(280),x=a(193),R=a(773),k=a(119),I=a(183),T=a(1365),P=a(800),N=a(1342),D=a(115),j=a(341),A=a(1345),M=a(336),U=a(500),L=a(906),F=a(168),B=a(1412),V=a(278),G=a(1413),z=a(805),W=a(186),H=a(216),K=a(1414),q=a(377),Y=a(140),$=a(167),J=a(250),Q=a(126),X=a(200);const Z=["user","groupId","room","onClose","phase"];function ee(e){var t;let{userId:a,device:n}=e;const s=Object(r.useContext)(k.a),i=a===s.getUserId(),o=s.checkDeviceTrust(a,n.deviceId),c=s.checkUserTrust(a),m=i?o.isCrossSigningVerified():o.isVerified(),u=d()("mx_UserInfo_device",{mx_UserInfo_device_verified:m,mx_UserInfo_device_unverified:!m}),h=d()("mx_E2EIcon",{mx_E2EIcon_normal:!c.isVerified(),mx_E2EIcon_verified:m,mx_E2EIcon_warning:c.isVerified()&&!m}),p=()=>{Object(N.c)(s.getUser(a),n)};let f;f=null!==(t=n.getDisplayName())&&void 0!==t&&t.trim()?n.ambiguous?n.getDisplayName()+" ("+n.deviceId+")":n.getDisplayName():n.deviceId;let v=null;return c.isVerified()&&(v=m?Object(g.a)("Trusted"):Object(g.a)("Not trusted")),m?l.a.createElement("div",{className:u,title:n.deviceId},l.a.createElement("div",{className:h}),l.a.createElement("div",{className:"mx_UserInfo_device_name"},f),l.a.createElement("div",{className:"mx_UserInfo_device_trusted"},v)):l.a.createElement(b.a,{className:u,title:n.deviceId,onClick:p},l.a.createElement("div",{className:h}),l.a.createElement("div",{className:"mx_UserInfo_device_name"},f),l.a.createElement("div",{className:"mx_UserInfo_device_trusted"},v))}function te(e){let{devices:t,userId:a,loading:n}=e;const s=Object(r.useContext)(k.a),i=s.checkUserTrust(a),[o,c]=Object(r.useState)(!1);if(n)return l.a.createElement(F.a,null);if(null===t)return l.a.createElement(l.a.Fragment,null,Object(g.a)("Unable to load session list"));const d=a===s.getUserId(),m=t.map(e=>s.checkDeviceTrust(a,e.deviceId));let u=[];const h=[];let p,f,v,y="mx_E2EIcon";if(i.isVerified()){for(let e=0;e<t.length;++e){const a=t[e],n=m[e];(d?n.isCrossSigningVerified():n.isVerified())?u.push(a):h.push(a)}p=Object(g.a)("%(count)s verified sessions",{count:u.length}),f=Object(g.a)("Hide verified sessions"),y+=" mx_E2EIcon_verified"}else u=t,p=Object(g.a)("%(count)s sessions",{count:t.length}),f=Object(g.a)("Hide sessions"),y+=" mx_E2EIcon_normal";u.length&&(v=o?l.a.createElement(b.a,{className:"mx_UserInfo_expand mx_linkButton",onClick:()=>c(!1)},l.a.createElement("div",null,f)):l.a.createElement(b.a,{className:"mx_UserInfo_expand mx_linkButton",onClick:()=>c(!0)},l.a.createElement("div",{className:y}),l.a.createElement("div",null,p)));let E=h.map((e,t)=>l.a.createElement(ee,{key:t,userId:a,device:e}));if(o){const e=h.length;E=E.concat(u.map((t,n)=>l.a.createElement(ee,{key:n+e,userId:a,device:t})))}return l.a.createElement("div",{className:"mx_UserInfo_devices"},l.a.createElement("div",null,E),l.a.createElement("div",null,v))}const ae=e=>{let{member:t,isIgnored:a,canInvite:n,isSpace:s}=e;const i=Object(r.useContext)(k.a);let o=null,c=null,m=null,u=null;const v=t.userId===i.getUserId();if(!v){const e=()=>{const e=i.getIgnoredUsers();if(a){const a=e.indexOf(t.userId);-1!==a&&e.splice(a,1)}else e.push(t.userId);i.setIgnoredUsers(e)};if(o=l.a.createElement(b.a,{onClick:e,className:d()("mx_UserInfo_field",{mx_UserInfo_destructive:!a})},a?Object(g.a)("Unignore"):Object(g.a)("Ignore")),t.roomId&&!s){const e=function(){const e=i.getRoom(t.roomId);h.a.dispatch({action:"view_room",highlighted:!0,event_id:e.getEventReadUpTo(t.userId),room_id:t.roomId})},a=function(){h.a.dispatch({action:"insert_mention",user_id:t.userId})},n=i.getRoom(t.roomId);null!=n&&n.getEventReadUpTo(t.userId)&&(u=l.a.createElement(b.a,{onClick:e,className:"mx_UserInfo_field"},Object(g.a)("Jump to read receipt"))),c=l.a.createElement(b.a,{onClick:a,className:"mx_UserInfo_field"},Object(g.a)("Mention"))}if(n&&(!t||!t.membership||"leave"===t.membership)){const e=t&&t.roomId?t.roomId:_.a.getRoomId(),a=async()=>{try{const a=new S.a(e);await a.invite([t.userId]).then(()=>{if("invited"!==a.getCompletionState(t.userId))throw new Error(a.getErrorText(t.userId))})}catch(e){p.a.createTrackedDialog("Failed to invite","",W.a,{title:Object(g.a)("Failed to invite"),description:e&&e.message?e.message:Object(g.a)("Operation failed")})}};m=l.a.createElement(b.a,{onClick:a,className:"mx_UserInfo_field"},Object(g.a)("Invite"))}}const y=l.a.createElement(b.a,{onClick:()=>{p.a.createTrackedDialog("share room member dialog","",z.a,{target:t})},className:"mx_UserInfo_field"},Object(g.a)("Share Link to User"));let E;return v||(E=l.a.createElement(b.a,{onClick:()=>async function(e,t){const a=Object(f.g)(e,t);if(a)return void h.a.dispatch({action:"view_room",room_id:a.roomId});const n={dmUserId:t,encryption:void 0};if(Object(f.h)()){const a=await e.downloadKeys([t]);Object.values(a).every(e=>Object.keys(e).length>0)&&(n.encryption=!0)}return Object(f.d)(n)}(i,t.userId),className:"mx_UserInfo_field"},Object(g.a)("Direct message"))),l.a.createElement("div",{className:"mx_UserInfo_container"},l.a.createElement("h3",null,Object(g.a)("Options")),l.a.createElement("div",null,E,u,y,c,m,o))},ne=async e=>{const{finished:t}=p.a.createTrackedDialog("Demoting Self","",H.a,{title:Object(g.a)("Demote yourself?"),description:l.a.createElement("div",null,e?Object(g.a)("You will not be able to undo this change as you are demoting yourself, if you are the last privileged user in the space it will be impossible to regain privileges."):Object(g.a)("You will not be able to undo this change as you are demoting yourself, if you are the last privileged user in the room it will be impossible to regain privileges.")),button:Object(g.a)("Demote")}),[a]=await t;return a},se=e=>{let{children:t}=e;return l.a.createElement("div",{className:"mx_UserInfo_container"},l.a.createElement("h3",null,Object(g.a)("Admin Tools")),l.a.createElement("div",{className:"mx_UserInfo_buttons"},t))},ie=e=>{let{member:t,startUpdating:a,stopUpdating:n}=e;const s=Object(r.useContext)(k.a);if("invite"!==t.membership&&"join"!==t.membership)return null;const i="invite"===t.membership?Object(g.a)("Disinvite"):Object(g.a)("Kick");return l.a.createElement(b.a,{className:"mx_UserInfo_field mx_UserInfo_destructive",onClick:async()=>{const{finished:e}=p.a.createTrackedDialog("Confirm User Action Dialog","onKick",K.a,{member:t,action:"invite"===t.membership?Object(g.a)("Disinvite"):Object(g.a)("Kick"),title:"invite"===t.membership?Object(g.a)("Disinvite this user?"):Object(g.a)("Kick this user?"),askReason:"join"===t.membership,danger:!0}),[i,o]=await e;i&&(a(),s.kick(t.roomId,t.userId,o||void 0).then(()=>{console.log("Kick success")},(function(e){console.error("Kick error: "+e),p.a.createTrackedDialog("Failed to kick","",W.a,{title:Object(g.a)("Failed to kick"),description:e&&e.message?e.message:"Operation failed"})})).finally(()=>{n()}))}},i)},oe=e=>{let{member:t}=e;const a=Object(r.useContext)(k.a);return l.a.createElement(b.a,{className:"mx_UserInfo_field mx_UserInfo_destructive",onClick:async()=>{const{roomId:e,userId:n}=t,s=a.getRoom(e);if(!s)return;let i=s.getLiveTimeline(),o=[];for(;i;)o=i.getEvents().reduce((e,t)=>t.getSender()!==n||t.isRedacted()||t.isRedaction()||t.getType()===Y.a.RoomCreate||t.getType()===Y.a.RoomServerAcl?e:e.concat(t),o),i=i.getNeighbouringTimeline(u.a.BACKWARDS);const r=o.length,c=t.name;if(0===r)p.a.createTrackedDialog("No user messages found to remove","",q.a,{title:Object(g.a)("No recent messages by %(user)s found",{user:c}),description:l.a.createElement("div",null,l.a.createElement("p",null,Object(g.a)("Try scrolling up in the timeline to see if there are any earlier ones.")))});else{const{finished:t}=p.a.createTrackedDialog("Remove recent messages by user","",H.a,{title:Object(g.a)("Remove recent messages by %(user)s",{user:c}),description:l.a.createElement("div",null,l.a.createElement("p",null,Object(g.a)("You are about to remove %(count)s messages by %(user)s. This cannot be undone. Do you wish to continue?",{count:r,user:c})),l.a.createElement("p",null,Object(g.a)("For a large amount of messages, this might take some time. Please don't refresh your client in the meantime."))),button:Object(g.a)("Remove %(count)s messages",{count:r})}),[n]=await t;if(!n)return;await Promise.resolve(),console.info(`Started redacting recent ${r} messages for ${c} in ${e}`),await Promise.all(o.map(async t=>{try{await a.redactEvent(e,t.getId())}catch(e){console.error("Could not redact",t.getId()),console.error(e)}})),console.info(`Finished redacting recent ${r} messages for ${c} in ${e}`)}}},Object(g.a)("Remove recent messages"))},re=e=>{let{member:t,startUpdating:a,stopUpdating:n}=e;const s=Object(r.useContext)(k.a);let i=Object(g.a)("Ban");"ban"===t.membership&&(i=Object(g.a)("Unban"));const o=d()("mx_UserInfo_field",{mx_UserInfo_destructive:"ban"!==t.membership});return l.a.createElement(b.a,{className:o,onClick:async()=>{const{finished:e}=p.a.createTrackedDialog("Confirm User Action Dialog","onBanOrUnban",K.a,{member:t,action:"ban"===t.membership?Object(g.a)("Unban"):Object(g.a)("Ban"),title:"ban"===t.membership?Object(g.a)("Unban this user?"):Object(g.a)("Ban this user?"),askReason:"ban"!==t.membership,danger:"ban"!==t.membership}),[i,o]=await e;if(!i)return;let r;a(),r="ban"===t.membership?s.unban(t.roomId,t.userId):s.ban(t.roomId,t.userId,o||void 0),r.then(()=>{console.log("Ban success")},(function(e){console.error("Ban error: "+e),p.a.createTrackedDialog("Failed to ban user","",W.a,{title:Object(g.a)("Error"),description:Object(g.a)("Failed to ban user")})})).finally(()=>{n()})}},i)},le=e=>{let{member:t,room:a,powerLevels:n,startUpdating:s,stopUpdating:i}=e;const o=Object(r.useContext)(k.a);if("join"!==t.membership)return null;const c=((e,t)=>{if(!t||!e)return!1;const a=(t.events?t.events["m.room.message"]:null)||t.events_default;return e.powerLevel<a})(t,n),m=d()("mx_UserInfo_field",{mx_UserInfo_destructive:!c}),u=c?Object(g.a)("Unmute"):Object(g.a)("Mute");return l.a.createElement(b.a,{className:m,onClick:async()=>{const e=t.roomId,n=t.userId;if(n===o.getUserId())try{if(!await ne(E.b.getValue("feature_spaces")&&(null==a?void 0:a.isSpaceRoom())))return}catch(e){return void console.error("Failed to warn about self demotion: ",e)}const r=a.currentState.getStateEvents("m.room.power_levels","");if(!r)return;const l=r.getContent(),d=(l.events?l.events["m.room.message"]:null)||l.events_default;let m;m=c?d:d-1,m=parseInt(m),isNaN(m)||(s(),o.setPowerLevel(e,n,m,r).then(()=>{console.log("Mute toggle success")},(function(e){console.error("Mute error: "+e),p.a.createTrackedDialog("Failed to mute user","",W.a,{title:Object(g.a)("Error"),description:Object(g.a)("Failed to mute user")})})).finally(()=>{i()}))}},u)},ce=e=>{let{room:t,children:a,member:n,startUpdating:s,stopUpdating:i,powerLevels:o}=e;const c=Object(r.useContext)(k.a);let d,m,u,h;const p=(o.events?o.events["m.room.power_levels"]:null)||o.state_default,{ban:g=50,kick:f=50,redact:v=50}=o,b=t.getMember(c.getUserId());if(!b)return l.a.createElement("div",null);const y=b.userId===n.userId,_=n.powerLevel<b.powerLevel||y;return _&&b.powerLevel>=f&&(d=l.a.createElement(ie,{member:n,startUpdating:s,stopUpdating:i})),!(b.powerLevel>=v)||E.b.getValue("feature_spaces")&&t.isSpaceRoom()||(h=l.a.createElement(oe,{member:n,startUpdating:s,stopUpdating:i})),_&&b.powerLevel>=g&&(m=l.a.createElement(re,{member:n,startUpdating:s,stopUpdating:i})),_&&b.powerLevel>=p&&(u=l.a.createElement(le,{member:n,room:t,powerLevels:o,startUpdating:s,stopUpdating:i})),d||m||u||h||a?l.a.createElement(se,null,u,d,m,h,a):l.a.createElement("div",null)},de=e=>{let{children:t,groupId:a,groupMember:n,startUpdating:s,stopUpdating:i}=e;const o=Object(r.useContext)(k.a),[c,d]=Object(r.useState)(!1),[m,u]=Object(r.useState)(!1);if(Object(r.useEffect)(()=>{let e=!1;const t=()=>{e||(d(C.a.isUserPrivileged(a)),u(C.a.getGroupInvitedMembers(a).some(e=>e.userId===n.userId)))};return C.a.registerListener(a,t),t(),()=>{e=!0,C.a.unregisterListener(t)}},[a,n.userId]),c){const e=async()=>{const{finished:e}=p.a.createDialog(K.a,{matrixClient:o,groupMember:n,action:m?Object(g.a)("Disinvite"):Object(g.a)("Remove from community"),title:m?Object(g.a)("Disinvite this user from community?"):Object(g.a)("Remove this user from community?"),danger:!0}),[t]=await e;t&&(s(),o.removeUserFromGroup(a,n.userId).then(()=>{h.a.dispatch({action:D.a.ViewUser,member:null})}).catch(e=>{p.a.createTrackedDialog("Failed to remove user from group","",W.a,{title:Object(g.a)("Error"),description:m?Object(g.a)("Failed to withdraw invitation"):Object(g.a)("Failed to remove user from community")}),console.log(e)}).finally(()=>{i()}))},r=l.a.createElement(b.a,{className:"mx_UserInfo_field mx_UserInfo_destructive",onClick:e},m?Object(g.a)("Disinvite"):Object(g.a)("Remove from community"));return l.a.createElement(se,null,r,t)}return l.a.createElement("div",null)};const me=e=>{let{user:t,room:a,roomPermissions:n,powerLevels:s}=e;if(n.canEdit)return l.a.createElement(ue,{user:t,room:a,roomPermissions:n});{const e=s.users_default||0,a=parseInt(t.powerLevel,10),n=Object(R.b)(a,e);return l.a.createElement("div",{className:"mx_UserInfo_profileField"},l.a.createElement("div",{className:"mx_UserInfo_roleDescription"},n))}},ue=e=>{let{user:t,room:a,roomPermissions:n}=e;const s=Object(r.useContext)(k.a),[i,o]=Object(r.useState)(parseInt(t.powerLevel,10)),c=Object(r.useCallback)(async e=>{const n=parseInt(e,10);o(n);const i=t.roomId,r=t.userId,c=a.currentState.getStateEvents("m.room.power_levels","");if(!c)return;const d=s.getUserId(),m=c.getContent().users[d];if(m&&parseInt(m)===n){const{finished:e}=p.a.createTrackedDialog("Promote to PL100 Warning","",H.a,{title:Object(g.a)("Warning!"),description:l.a.createElement("div",null,Object(g.a)("You will not be able to undo this change as you are promoting the user to have the same power level as yourself."),l.a.createElement("br",null),Object(g.a)("Are you sure?")),button:Object(g.a)("Continue")}),[t]=await e;if(!t)return}else if(d===r)try{if(!await ne(E.b.getValue("feature_spaces")&&(null==a?void 0:a.isSpaceRoom())))return}catch(e){console.error("Failed to warn about self demotion: ",e)}await((e,t,a,n)=>s.setPowerLevel(e,t,parseInt(a),n).then((function(){console.log("Power change success")}),(function(e){console.error("Failed to change power level "+e),p.a.createTrackedDialog("Failed to change power level","",W.a,{title:Object(g.a)("Error"),description:Object(g.a)("Failed to change power level")})})))(i,r,n,c)},[t.roomId,t.userId,s,a]),d=a.currentState.getStateEvents("m.room.power_levels",""),m=d?d.getContent().users_default:0;return l.a.createElement("div",{className:"mx_UserInfo_profileField"},l.a.createElement(B.a,{label:null,value:i,maxValue:n.modifyLevelMax,usersDefault:m,onChange:c}))},he=e=>{const t=Object(r.useContext)(k.a),[a,n]=Object(r.useState)(void 0);return Object(r.useEffect)(()=>{n(void 0);let a=!1;return async function(){try{await t.downloadKeys([e],!0);const s=t.getStoredDevicesForUser(e);if(a)return;(e=>{const t=Object.create(null);for(let a=0;a<e.length;a++){const n=e[a].getDisplayName(),s=t[n]||[];s.push(a),t[n]=s}for(const a in t)t[a].length>1&&t[a].forEach(t=>{e[t].ambiguous=!0})})(s),n(s)}catch(e){n(null)}}(),()=>{a=!0}},[t,e]),Object(r.useEffect)(()=>{let a=!1;const s=async()=>{const s=t.getStoredDevicesForUser(e);a||n(s)},i=t=>{t.includes(e)&&s()},o=(t,a)=>{t===e&&s()},r=(t,a)=>{t===e&&s()};return t.on("crypto.devicesUpdated",i),t.on("deviceVerificationChanged",o),t.on("userTrustStatusChanged",r),()=>{a=!0,t.removeListener("crypto.devicesUpdated",i),t.removeListener("deviceVerificationChanged",o),t.removeListener("userTrustStatusChanged",r)}},[t,e]),a},pe=e=>{let{room:t,member:a,groupId:n,devices:s,isRoomEncrypted:i}=e;const o=Object(r.useContext)(k.a),c=((e,t)=>{const[a,n]=Object(r.useState)({}),s=Object(r.useCallback)(e=>{if(!t)return;if(e&&e.getType()!==Y.a.RoomPowerLevels)return;const a=t.currentState.getStateEvents(Y.a.RoomPowerLevels,"");n(a?a.getContent():{})},[t]);return Object(x.a)(e,"RoomState.events",s),Object(r.useEffect)(()=>(s(),()=>{n({})}),[s]),a})(o,t),d=(e=>{const[t,a]=Object(r.useState)(!1);return Object(r.useEffect)(()=>{e.isSynapseAdministrator().then(e=>{a(e)},()=>{a(!1)})},[e]),t})(o),[m,u]=Object(r.useState)(o.isUserIgnored(a.userId));Object(r.useEffect)(()=>{u(o.isUserIgnored(a.userId))},[o,a.userId]);const f=Object(r.useCallback)(e=>{"m.ignored_user_list"===e.getType()&&u(o.isUserIgnored(a.userId))},[o,a.userId]);Object(x.a)(o,"accountData",f);const[y,_]=Object(r.useState)(0),S=Object(r.useCallback)(()=>{_(y+1)},[y]),C=Object(r.useCallback)(()=>{_(y-1)},[y]),O=function(e,t,a){const[n,s]=Object(r.useState)({modifyLevelMax:-1,canEdit:!1,canInvite:!1}),i=Object(r.useCallback)(()=>{if(!t)return;const n=t.currentState.getStateEvents("m.room.power_levels","");if(!n)return;const i=n.getContent();if(!i)return;const o=t.getMember(e.getUserId());if(!o)return;const r=a,l=o.userId===r.userId;let c=-1;if(r.powerLevel<o.powerLevel||l){const e=(i.events?i.events["m.room.power_levels"]:null)||i.state_default;o.powerLevel>=e&&(l||o.powerLevel>r.powerLevel)&&(c=o.powerLevel)}s({canInvite:o.powerLevel>=i.invite,canEdit:c>=0,modifyLevelMax:c})},[e,a,t]);return Object(x.a)(e,"RoomState.members",i),Object(r.useEffect)(()=>(i(),()=>{s({modifyLevelMax:-1,canEdit:!1,canInvite:!1})}),[i]),n}(o,t,a),R=Object(r.useCallback)(async()=>{const{finished:e}=p.a.createTrackedDialog("Synapse User Deactivation","",H.a,{title:Object(g.a)("Deactivate user?"),description:l.a.createElement("div",null,Object(g.a)("Deactivating this user will log them out and prevent them from logging back in. Additionally, they will leave all the rooms they are in. This action cannot be reversed. Are you sure you want to deactivate this user?")),button:Object(g.a)("Deactivate user"),danger:!0}),[t]=await e;if(t)try{await o.deactivateSynapseUser(a.userId)}catch(e){console.error("Failed to deactivate user"),console.error(e),p.a.createTrackedDialog("Failed to deactivate Synapse user","",W.a,{title:Object(g.a)("Failed to deactivate user"),description:e&&e.message?e.message:Object(g.a)("Operation failed")})}},[o,a.userId]);let I,T,A,M;d&&a.userId.endsWith(":"+w.a.getHomeserverName())&&(I=l.a.createElement(b.a,{onClick:R,className:"mx_UserInfo_field mx_UserInfo_destructive"},Object(g.a)("Deactivate user"))),t&&a.roomId?A=l.a.createElement(ce,{powerLevels:c,member:a,room:t,startUpdating:S,stopUpdating:C},I):n?A=l.a.createElement(de,{groupId:n,groupMember:a,startUpdating:S,stopUpdating:C},I):I&&(A=l.a.createElement(se,null,I)),y>0&&(T=l.a.createElement(F.a,null)),t&&a.roomId&&!v.a.shared().getUserIdForRoomId(a.roomId)&&(M=l.a.createElement("div",{className:"mx_UserInfo_container"},l.a.createElement("h3",null,Object(g.a)("Role")),l.a.createElement(me,{powerLevels:c,user:a,room:t,roomPermissions:O})));const U=o.isCryptoEnabled();let L,B;i?E.b.getValue("feature_spaces")&&t.isSpaceRoom()||(L=Object(g.a)("Messages in this room are end-to-end encrypted.")):U?!t||E.b.getValue("feature_spaces")&&t.isSpaceRoom()||(L=Object(g.a)("Messages in this room are not end-to-end encrypted.")):L=Object(g.a)("This client does not support end-to-end encryption.");const V=(e=>Object(P.a)(async()=>e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing"),[e],!1))(o),G=U&&o.checkUserTrust(a.userId),z=U&&G.isCrossSigningVerified(),K=a.userId===o.getUserId(),q=U&&V&&!z&&!K&&s&&s.length>0,$=function(e,t,a,n){return Object(P.a)(async()=>{if(a){n(!0);try{await e.downloadKeys([t.userId]);const a=e.getStoredCrossSigningForUser(t.userId);return!!(a&&a.getId())}finally{n(!1)}}},[e,t,a],void 0)}(o,a,q,e=>{_(t=>t+(e?1:-1))}),J=void 0===s;let Q;q&&(void 0!==$?B=l.a.createElement(b.a,{className:"mx_UserInfo_field mx_UserInfo_verifyButton",onClick:()=>{$?Object(N.d)(a):Object(N.a)(a)}},Object(g.a)("Verify")):J||(B=l.a.createElement(F.a,null))),a.userId==o.getUserId()&&(Q=l.a.createElement("p",null,l.a.createElement(b.a,{className:"mx_UserInfo_field",onClick:()=>{h.a.dispatch({action:D.a.ViewUserSettings,initialTabId:j.c})}},Object(g.a)("Edit devices"))));const X=l.a.createElement("div",{className:"mx_UserInfo_container"},l.a.createElement("h3",null,Object(g.a)("Security")),l.a.createElement("p",null,L),B,U&&l.a.createElement(te,{loading:J,devices:s,userId:a.userId}),Q);return l.a.createElement(l.a.Fragment,null,M,X,l.a.createElement(ae,{canInvite:O.canInvite,isIgnored:m,member:a,isSpace:E.b.getValue("feature_spaces")&&(null==t?void 0:t.isSpaceRoom())}),A,T)},ge=e=>{let{member:t,e2eStatus:a}=e;const n=Object(r.useContext)(k.a),s=Object(r.useCallback)(()=>{const e=t.getMxcAvatarUrl?t.getMxcAvatarUrl():t.avatarUrl;if(!e)return;const a={src:Object(Q.b)(e).srcHttp,name:t.name};p.a.createDialog(L.a,a,"mx_Dialog_lightbox",null,!0)},[t]),i=l.a.createElement("div",{className:"mx_UserInfo_avatar"},l.a.createElement("div",null,l.a.createElement("div",null,l.a.createElement(V.a,{key:t.userId,member:t,width:.6*X.b.instance.windowHeight,height:.6*X.b.instance.windowHeight,resizeMethod:"scale",fallbackUserId:t.userId,onClick:s,urls:t.avatarUrl?[t.avatarUrl]:void 0}))));let o,c,d,u;t instanceof m.a&&t.user&&(o=t.user.presence,c=t.user.lastActiveAgo,d=t.user.currentlyActive,E.b.getValue("feature_custom_status")&&(u=t.user._unstable_statusMessage));const h=y.a.get().enable_presence_by_hs_url;let g=!0;h&&void 0!==h[n.baseUrl]&&(g=h[n.baseUrl]);let f=null;g&&(f=l.a.createElement(G.a,{activeAgo:c,currentlyActive:d,presenceState:o}));let v,b=null;u&&(b=l.a.createElement("span",{className:"mx_UserInfo_statusMessage"},u)),a&&(v=l.a.createElement(O.b,{size:18,status:a,isUser:!0}));const _=t.rawDisplayName||t.displayname;return l.a.createElement(l.a.Fragment,null,i,l.a.createElement("div",{className:"mx_UserInfo_container mx_UserInfo_separator"},l.a.createElement("div",{className:"mx_UserInfo_profile"},l.a.createElement("div",null,l.a.createElement("h2",null,v,l.a.createElement("span",{title:_,"aria-label":_},_))),l.a.createElement("div",null,t.userId),l.a.createElement("div",{className:"mx_UserInfo_profileStatus"},f,b))))};t.a=e=>{let{user:t,groupId:a,room:n,onClose:i,phase:c=I.c.RoomMemberInfo}=e,d=o()(e,Z);const m=Object(r.useContext)(k.a),u=Object(r.useMemo)(()=>n&&n.getMember(t.userId)||t,[n,t]),p=Object(A.a)(m,n),f=he(t.userId);let v;p&&f&&(v=((e,t,a)=>{const n=t===e.getUserId(),s=e.checkUserTrust(t);if(!s.isCrossSigningVerified())return s.wasCrossSigningVerified()?U.a.Warning:U.a.Normal;return a.some(a=>{const{deviceId:s}=a,i=e.checkDeviceTrust(t,s);return n?!i.isCrossSigningVerified():!i.isVerified()})?U.a.Warning:U.a.Verified})(m,t.userId,f));const b=["mx_UserInfo"];let y,_;n&&c===I.c.EncryptionPanel?(_=I.c.RoomMemberInfo,y={member:u}):n&&(_=_=E.b.getValue("feature_spaces")&&n.isSpaceRoom()?I.c.SpaceMemberList:I.c.RoomMemberList);const S=()=>{h.a.dispatch({action:D.a.SetRightPanelPhase,phase:_,refireParams:y})};let C;switch(c){case I.c.RoomMemberInfo:case I.c.GroupMemberInfo:case I.c.SpaceMemberInfo:C=l.a.createElement(pe,{room:n,member:u,groupId:a,devices:f,isRoomEncrypted:p});break;case I.c.EncryptionPanel:b.push("mx_UserInfo_smallAvatar"),C=l.a.createElement(T.a,s()({},d,{member:u,onClose:S,isRoomEncrypted:p}))}let w,O=void 0;if(c===I.c.EncryptionPanel){const e=d.verificationRequest;e&&e.pending&&(O=Object(g.a)("Cancel"))}E.b.getValue("feature_spaces")&&null!=n&&n.isSpaceRoom()&&(w=l.a.createElement("div",{className:"mx_RightPanel_scopeHeader"},l.a.createElement($.a,{room:n,height:32,width:32}),l.a.createElement(J.a,{room:n})));const x=l.a.createElement(l.a.Fragment,null,w,l.a.createElement(ge,{member:u,e2eStatus:v}));return l.a.createElement(M.b,{className:b.join(" "),header:x,onClose:i,closeLabel:O,previousPhase:_,refireParams:y},C)}},1365:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(811),o=a(1366),r=a(99),l=a(214),c=a(193),d=a(106),m=a(364),u=a(97),h=a(93),p=a(100),g=a(115),f=a(183);const v=["m.key_mismatch","m.user_error","m.mismatched_sas"];t.a=e=>{const{verificationRequest:t,verificationRequestPromise:b,member:y,onClose:E,layout:_,isRoomEncrypted:S}=e,[C,w]=Object(n.useState)(t),[O,x]=Object(n.useState)(!1),[R,k]=Object(n.useState)(C&&C.phase);Object(n.useEffect)(()=>{w(t),t&&(x(!1),k(t.phase))},[t]),Object(n.useEffect)(()=>{b&&async function(){x(!0);const e=await b;x(!1),w(e),k(e.phase)}()},[b]);const I=Object(n.useCallback)(()=>{if(C&&C.cancelled&&v.includes(C.cancellationCode)){const e=u.getComponent("dialogs.ErrorDialog");d.a.createTrackedDialog("Verification failed","insecure",e,{headerImage:a(813),title:Object(h.a)("Your messages are not secure"),description:s.a.createElement("div",null,Object(h.a)("One of the following may be compromised:"),s.a.createElement("ul",null,s.a.createElement("li",null,Object(h.a)("Your homeserver")),s.a.createElement("li",null,Object(h.a)("The homeserver the user you’re verifying is connected to")),s.a.createElement("li",null,Object(h.a)("Yours, or the other users’ internet connection")),s.a.createElement("li",null,Object(h.a)("Yours, or the other users’ session")))),onFinished:E})}else C&&k(C.phase)},[E,C]);Object(c.a)(C,"change",I);const T=Object(n.useCallback)(async()=>{x(!0);const e=r.a.get(),t=await Object(l.e)(e,y.userId),a=await e.requestVerificationDM(y.userId,t);w(a),k(a.phase),p.a.dispatch({action:g.a.SetRightPanelPhase,phase:f.c.EncryptionPanel,refireParams:{member:y,verificationRequest:a}})},[y]),P=!C&&O||C&&(R===m.e||R===m.g||void 0===R),N=C?C.isSelfVerification:y.userId===r.a.get().getUserId();if(!C||P){const e=!C&&O||C&&C.initiatedByMe;return s.a.createElement(i.b,{isRoomEncrypted:S,onStartVerification:T,member:y,isSelfVerification:N,waitingForOtherParty:P&&e,waitingForNetwork:P&&!e,inDialog:"dialog"===_})}return s.a.createElement(o.a,{isRoomEncrypted:S,layout:_,onClose:E,member:y,request:C,key:C.channel.transactionId,inDialog:"dialog"===_,phase:R})}},1366:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(99),d=a(97),m=a(584),u=a(487),h=a(812),p=a(93),g=a(110),f=a(280),v=a(364),b=a(168),y=a(94);!function(e){e[e.PHASE_UNSENT=0]="PHASE_UNSENT",e[e.PHASE_REQUESTED=1]="PHASE_REQUESTED",e[e.PHASE_READY=2]="PHASE_READY",e[e.PHASE_DONE=3]="PHASE_DONE",e[e.PHASE_STARTED=4]="PHASE_STARTED",e[e.PHASE_CANCELLED=5]="PHASE_CANCELLED"}(s||(s={}));let E=Object(y.a)("views.right_panel.VerificationPanel")(n=class extends l.a.PureComponent{constructor(e){super(e),o()(this,"hasVerifier",void 0),o()(this,"onReciprocateYesClick",()=>{this.setState({reciprocateButtonClicked:!0}),this.state.reciprocateQREvent.confirm()}),o()(this,"onReciprocateNoClick",()=>{this.setState({reciprocateButtonClicked:!0}),this.state.reciprocateQREvent.cancel()}),o()(this,"startSAS",async()=>{this.setState({emojiButtonClicked:!0});const e=this.props.request.beginKeyVerification(m.d.SAS);try{await e.verify()}catch(e){console.error(e)}}),o()(this,"onSasMatchesClick",()=>{this.state.sasEvent.confirm()}),o()(this,"onSasMismatchesClick",()=>{this.state.sasEvent.mismatch()}),o()(this,"updateVerifierState",()=>{const{request:e}=this.props,{sasEvent:t,reciprocateQREvent:a}=e.verifier;e.verifier.off("show_sas",this.updateVerifierState),e.verifier.off("show_reciprocate_qr",this.updateVerifierState),this.setState({sasEvent:t,reciprocateQREvent:a})}),o()(this,"onRequestChange",async()=>{const{request:e}=this.props,t=this.hasVerifier;if(this.hasVerifier=!!e.verifier,!t&&this.hasVerifier){e.verifier.on("show_sas",this.updateVerifierState),e.verifier.on("show_reciprocate_qr",this.updateVerifierState);try{await e.verifier.verify()}catch(e){console.error("error verify",e)}}}),this.state={},this.hasVerifier=!1}renderQRPhase(){const{member:e,request:t}=this.props,a=t.otherPartySupportsMethod(m.d.SAS),n=t.otherPartySupportsMethod(u.c),s=d.getComponent("elements.AccessibleButton"),i=g.a.get().brand,o=a||n?null:l.a.createElement("p",null,Object(p.a)("The session you are trying to verify doesn't support scanning a QR code or emoji verification, which is what %(brand)s supports. Try with a different client.",{brand:i}));if("dialog"===this.props.layout){let e,i;n&&(e=l.a.createElement("div",{className:"mx_VerificationPanel_QRPhase_startOption"},l.a.createElement("p",null,Object(p.a)("Scan this unique code")),l.a.createElement(h.a,{qrCodeData:t.qrCodeData}))),a&&(i=l.a.createElement("div",{className:"mx_VerificationPanel_QRPhase_startOption"},l.a.createElement("p",null,Object(p.a)("Compare unique emoji")),l.a.createElement("span",{className:"mx_VerificationPanel_QRPhase_helpText"},Object(p.a)("Compare a unique set of emoji if you don't have a camera on either device")),l.a.createElement(s,{disabled:this.state.emojiButtonClicked,onClick:this.startSAS,kind:"primary"},Object(p.a)("Start"))));const r=e&&i?l.a.createElement("div",{className:"mx_VerificationPanel_QRPhase_betweenText"},Object(p.a)("or")):null;return l.a.createElement("div",null,Object(p.a)("Verify this session by completing one of the following:"),l.a.createElement("div",{className:"mx_VerificationPanel_QRPhase_startOptions"},e,r,i,o))}let r,c;if(n&&(r=l.a.createElement("div",{className:"mx_UserInfo_container"},l.a.createElement("h3",null,Object(p.a)("Verify by scanning")),l.a.createElement("p",null,Object(p.a)("Ask %(displayName)s to scan your code:",{displayName:e.displayName||e.name||e.userId})),l.a.createElement("div",{className:"mx_VerificationPanel_qrCode"},l.a.createElement(h.a,{qrCodeData:t.qrCodeData})))),a){const e=this.state.emojiButtonClicked,t=n?Object(p.a)("If you can't scan the code above, verify by comparing unique emoji."):Object(p.a)("Verify by comparing unique emoji.");c=l.a.createElement("div",{className:"mx_UserInfo_container"},l.a.createElement("h3",null,Object(p.a)("Verify by emoji")),l.a.createElement("p",null,t),l.a.createElement(s,{disabled:e,kind:"primary",className:"mx_UserInfo_wideButton mx_VerificationPanel_verifyByEmojiButton",onClick:this.startSAS},Object(p.a)("Verify by emoji")))}const f=o?l.a.createElement("div",{className:"mx_UserInfo_container"},o):null;return l.a.createElement(l.a.Fragment,null,r,c,f)}getDevice(){const e=this.props.request&&this.props.request.channel.deviceId;return c.a.get().getStoredDevice(c.a.get().getUserId(),e)}renderQRReciprocatePhase(){const{member:e,request:t}=this.props;let a;a=this.props.inDialog?d.getComponent("elements.AccessibleButton"):d.getComponent("elements.FormButton");const n=t.isSelfVerification?Object(p.a)("Almost there! Is your other session showing the same shield?"):Object(p.a)("Almost there! Is %(displayName)s showing the same shield?",{displayName:e.displayName||e.name||e.userId});let s;return s=this.state.reciprocateQREvent?l.a.createElement(l.a.Fragment,null,l.a.createElement("p",null,n),l.a.createElement(f.b,{isUser:!0,status:"verified",size:128,hideTooltip:!0}),l.a.createElement("div",{className:"mx_VerificationPanel_reciprocateButtons"},l.a.createElement(a,{label:Object(p.a)("No"),kind:"danger",disabled:this.state.reciprocateButtonClicked,onClick:this.onReciprocateNoClick},Object(p.a)("No")),l.a.createElement(a,{label:Object(p.a)("Yes"),kind:"primary",disabled:this.state.reciprocateButtonClicked,onClick:this.onReciprocateYesClick},Object(p.a)("Yes")))):l.a.createElement("p",null,l.a.createElement(b.a,null)),l.a.createElement("div",{className:"mx_UserInfo_container mx_VerificationPanel_reciprocate_section"},l.a.createElement("h3",null,Object(p.a)("Verify by scanning")),s)}renderVerifiedPhase(){const{member:e,request:t}=this.props;let a,n;if(t.isSelfVerification||(a=this.props.isRoomEncrypted?Object(p.a)("Verify all users in a room to ensure it's secure."):Object(p.a)("In encrypted rooms, verify all users to ensure it’s secure.")),t.isSelfVerification){const e=this.getDevice();e?n=Object(p.a)("You've successfully verified %(deviceName)s (%(deviceId)s)!",{deviceName:e?e.getDisplayName():"",deviceId:this.props.request.channel.deviceId}):(console.warn("Verified device we don't know about: "+this.props.request.channel.deviceId),n=Object(p.a)("You've successfully verified your device!"))}else n=Object(p.a)("You've successfully verified %(displayName)s!",{displayName:e.displayName||e.name||e.userId});const s=d.getComponent("elements.AccessibleButton");return l.a.createElement("div",{className:"mx_UserInfo_container mx_VerificationPanel_verified_section"},l.a.createElement("h3",null,Object(p.a)("Verified")),l.a.createElement("p",null,n),l.a.createElement(f.b,{isUser:!0,status:"verified",size:128,hideTooltip:!0}),a?l.a.createElement("p",null,a):null,l.a.createElement(s,{kind:"primary",className:"mx_UserInfo_wideButton",onClick:this.props.onClose},Object(p.a)("Got it")))}renderCancelledPhase(){const{member:e,request:t}=this.props,a=d.getComponent("elements.AccessibleButton");let n,s;return n=t.isSelfVerification?Object(p.a)("Start verification again from the notification."):Object(p.a)("Start verification again from their profile."),"m.timeout"===t.cancellationCode?s=Object(p.a)("Verification timed out.")+" "+n:t.cancellingUserId===t.otherUserId?(s=t.isSelfVerification?Object(p.a)("You cancelled verification on your other session."):Object(p.a)("%(displayName)s cancelled verification.",{displayName:e.displayName||e.name||e.userId}),s=`${s} ${n}`):s=Object(p.a)("You cancelled verification.")+" "+n,l.a.createElement("div",{className:"mx_UserInfo_container"},l.a.createElement("h3",null,Object(p.a)("Verification cancelled")),l.a.createElement("p",null,s),l.a.createElement(a,{kind:"primary",className:"mx_UserInfo_wideButton",onClick:this.props.onClose},Object(p.a)("Got it")))}render(){const{member:e,phase:t,request:a}=this.props,n=e.displayName||e.name||e.userId;switch(t){case v.d:return this.renderQRPhase();case v.f:switch(a.chosenMethod){case m.d.RECIPROCATE_QR_CODE:return this.renderQRReciprocatePhase();case m.d.SAS:{const e=d.getComponent("views.verification.VerificationShowSas"),t=this.state.sasEvent?l.a.createElement(e,{displayName:n,device:this.getDevice(),sas:this.state.sasEvent.sas,onCancel:this.onSasMismatchesClick,onDone:this.onSasMatchesClick,inDialog:this.props.inDialog,isSelf:a.isSelfVerification}):l.a.createElement(b.a,null);return l.a.createElement("div",{className:"mx_UserInfo_container"},l.a.createElement("h3",null,Object(p.a)("Compare emoji")),t)}default:return null}case v.c:return this.renderVerifiedPhase();case v.b:return this.renderCancelledPhase()}return console.error("VerificationPanel unhandled phase:",t),null}componentDidMount(){const{request:e}=this.props;if(e.on("change",this.onRequestChange),e.verifier){const{sasEvent:t,reciprocateQREvent:a}=e.verifier;this.setState({sasEvent:t,reciprocateQREvent:a})}this.onRequestChange()}componentWillUnmount(){const{request:e}=this.props;e.verifier&&(e.verifier.off("show_sas",this.updateVerifierState),e.verifier.off("show_reciprocate_qr",this.updateVerifierState)),e.off("change",this.onRequestChange)}})||n},1367:function(e,t,a){"use strict";a.d(t,"a",(function(){return N}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(93),d=a(1368),m=a(103),u=a(1372),h=a(1373),p=a(108),g=a(1375),f=a(92),v=a.n(f),b=a(156),y=a(99),E=a(97),_=a(106),S=a(100),C=a(489),w=a(329),O=a(330),x=a(416),R=a(1388),k=a(168),I=a(123),T=a(147),P=a(94);let N=Object(P.a)("views.settings.tabs.user.GeneralUserSettingsTab")((s=class extends l.a.Component{constructor(){super(),o()(this,"_onAction",e=>{"id_server_changed"===e.action&&(this.setState({haveIdServer:Boolean(y.a.get().getIdentityServerUrl())}),this._getThreepidState())}),o()(this,"_onEmailsChange",e=>{this.setState({emails:e})}),o()(this,"_onMsisdnsChange",e=>{this.setState({msisdns:e})}),o()(this,"_onLanguageChange",e=>{if(this.state.language===e)return;m.b.setValue("language",null,I.a.DEVICE,e),this.setState({language:e});const t=b.a.get();t&&(t.setLanguage(e),t.reload())}),o()(this,"_onSpellCheckLanguagesChange",e=>{this.setState({spellCheckLanguages:e});const t=b.a.get();t&&t.setSpellCheckLanguages(e)}),o()(this,"_onPasswordChangeError",e=>{let t=e.error||e.message||"";403===e.httpStatus?t=Object(c.a)("Failed to change password. Is your password correct?"):t||(t+=` (HTTP status ${e.httpStatus})`);const a=E.getComponent("dialogs.ErrorDialog");console.error("Failed to change password: "+t),_.a.createTrackedDialog("Failed to change password","",a,{title:Object(c.a)("Error"),description:t})}),o()(this,"_onPasswordChanged",()=>{const e=E.getComponent("dialogs.ErrorDialog");_.a.createTrackedDialog("Password changed","",e,{title:Object(c.a)("Success"),description:Object(c.a)("Your password was successfully changed. You will not receive push notifications on other sessions until you log back in to them")+"."})}),o()(this,"_onDeactivateClicked",()=>{_.a.createTrackedDialog("Deactivate Account","",g.a,{onFinished:e=>{e&&this.props.closeSettingsFn()}})}),this.state={language:c.d(),spellCheckLanguages:[],haveIdServer:Boolean(y.a.get().getIdentityServerUrl()),serverSupportsSeparateAddAndBind:null,idServerHasUnsignedTerms:!1,requiredPolicyInfo:{hasTerms:!1},emails:[],msisdns:[],loading3pids:!0},this.dispatcherRef=S.a.register(this._onAction)}async UNSAFE_componentWillMount(){const e=y.a.get(),t=await e.doesServerSupportSeparateAddAndBind(),a=(await e.getCapabilities())["m.change_password"],n=!a||!1!==a.enabled;this.setState({serverSupportsSeparateAddAndBind:t,canChangePassword:n}),this._getThreepidState()}async componentDidMount(){const e=b.a.get();e&&this.setState({spellCheckLanguages:await e.getSpellCheckLanguages()})}componentWillUnmount(){S.a.unregister(this.dispatcherRef)}async _getThreepidState(){const e=y.a.get();this._checkTerms();let t=[];try{t=await Object(R.a)(e)}catch(e){const t=y.a.get().getIdentityServerUrl();console.warn(`Unable to reach identity server at ${t} to check for 3PIDs bindings in Settings`),console.warn(e)}this.setState({emails:t.filter(e=>"email"===e.medium),msisdns:t.filter(e=>"msisdn"===e.medium),loading3pids:!1})}async _checkTerms(){if(!this.state.haveIdServer)return void this.setState({idServerHasUnsignedTerms:!1});const e=y.a.get().getIdentityServerUrl(),t=new O.a;try{const a=await t.getAccessToken({check:!1});await Object(C.d)([new C.a(w.a.IS,e,a)],(t,a,n)=>new Promise((n,s)=>{this.setState({idServerName:Object(x.a)(e),requiredPolicyInfo:{hasTerms:!0,policiesAndServices:t,agreedUrls:a,resolve:n}})})),this.setState({requiredPolicyInfo:{hasTerms:!1}})}catch(t){console.warn(`Unable to reach identity server at ${e} to check for terms in Settings`),console.warn(t)}}_renderProfileSection(){return l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement(d.a,null))}_renderAccountSection(){const e=E.getComponent("views.settings.ChangePassword"),t=E.getComponent("views.settings.account.EmailAddresses"),a=E.getComponent("views.settings.account.PhoneNumbers");let n=l.a.createElement(e,{className:"mx_GeneralUserSettingsTab_changePassword",rowClassName:"",buttonKind:"primary",onError:this._onPasswordChangeError,onFinished:this._onPasswordChanged}),s=null;if(m.b.getValue(T.a.ThirdPartyID)&&(this.state.haveIdServer||!0===this.state.serverSupportsSeparateAddAndBind)){const e=this.state.loading3pids?l.a.createElement(k.a,null):l.a.createElement(t,{emails:this.state.emails,onEmailsChange:this._onEmailsChange}),n=this.state.loading3pids?l.a.createElement(k.a,null):l.a.createElement(a,{msisdns:this.state.msisdns,onMsisdnsChange:this._onMsisdnsChange});s=l.a.createElement("div",null,l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Email addresses")),e,l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Phone numbers")),n)}else null===this.state.serverSupportsSeparateAddAndBind&&(s=l.a.createElement(k.a,null));let i=Object(c.a)("Set a new account password...");return this.state.canChangePassword||(i=null,n=null),l.a.createElement("div",{className:"mx_SettingsTab_section mx_GeneralUserSettingsTab_accountSection"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Account")),l.a.createElement("p",{className:"mx_SettingsTab_subsectionText"},i),n,s)}_renderLanguageSection(){return l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Language and region")),l.a.createElement(u.a,{className:"mx_GeneralUserSettingsTab_languageInput",onOptionChange:this._onLanguageChange,value:this.state.language}))}_renderSpellCheckSection(){return l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Spell check dictionaries")),l.a.createElement(h.a,{languages:this.state.spellCheckLanguages,onLanguagesChange:this._onSpellCheckLanguagesChange}))}_renderDiscoverySection(){const e=E.getComponent("views.settings.SetIdServer");if(this.state.requiredPolicyInfo.hasTerms){const t=E.getComponent("views.terms.InlineTermsAgreement"),a=l.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Agree to the identity server (%(serverName)s) Terms of Service to allow yourself to be discoverable by email address or phone number.",{serverName:this.state.idServerName}));return l.a.createElement("div",null,l.a.createElement(t,{policiesAndServicePairs:this.state.requiredPolicyInfo.policiesAndServices,agreedUrls:this.state.requiredPolicyInfo.agreedUrls,onFinished:this.state.requiredPolicyInfo.resolve,introElement:a}),l.a.createElement(e,{missingTerms:!0}))}const t=E.getComponent("views.settings.discovery.EmailAddresses"),a=E.getComponent("views.settings.discovery.PhoneNumbers"),n=this.state.loading3pids?l.a.createElement(k.a,null):l.a.createElement(t,{emails:this.state.emails}),s=this.state.loading3pids?l.a.createElement(k.a,null):l.a.createElement(a,{msisdns:this.state.msisdns}),i=this.state.haveIdServer?l.a.createElement("div",{className:"mx_GeneralUserSettingsTab_discovery"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Email addresses")),n,l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Phone numbers")),s):null;return l.a.createElement("div",{className:"mx_SettingsTab_section"},i,l.a.createElement(e,null))}_renderManagementSection(){return l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Account management")),l.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Deactivating your account is a permanent action - be careful!")),l.a.createElement(p.a,{onClick:this._onDeactivateClicked,kind:"danger"},Object(c.a)("Deactivate Account")))}_renderIntegrationManagerSection(){if(!m.b.getValue(T.a.Widgets))return null;const e=E.getComponent("views.settings.SetIntegrationManager");return l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement(e,null))}render(){const e=b.a.get().supportsMultiLanguageSpellCheck(),t=this.state.requiredPolicyInfo.hasTerms?l.a.createElement("img",{className:"mx_GeneralUserSettingsTab_warningIcon",src:a(1389),width:"18",height:"18",alt:Object(c.a)("Warning")}):null;let n,s;return m.b.getValue(T.a.Deactivate)&&(n=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Deactivate account")),this._renderManagementSection())),m.b.getValue(T.a.IdentityServer)&&(s=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_SettingsTab_heading"},t," ",Object(c.a)("Discovery")),this._renderDiscoverySection())),l.a.createElement("div",{className:"mx_SettingsTab"},l.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("General")),this._renderProfileSection(),this._renderAccountSection(),this._renderLanguageSection(),e?this._renderSpellCheckSection():null,s,this._renderIntegrationManagerSection(),n)}},o()(s,"propTypes",{closeSettingsFn:v.a.func.isRequired}),n=s))||n},1368:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(99),d=a(144),m=a(1369),u=a(97),h=a(253),p=a(106),g=a(186),f=a(94),v=a(126);let b=Object(f.a)("views.settings.ProfileSettings")(n=class extends r.a.Component{constructor(){super(),i()(this,"_uploadAvatar",()=>{this._avatarUpload.current.click()}),i()(this,"_removeAvatar",()=>{this._avatarUpload.current.value="",this.setState({avatarUrl:null,avatarFile:null,enableProfileSave:!0})}),i()(this,"_cancelProfileChanges",async e=>{e.stopPropagation(),e.preventDefault(),this.state.enableProfileSave&&this.setState({enableProfileSave:!1,displayName:this.state.originalDisplayName,avatarUrl:this.state.originalAvatarUrl,avatarFile:null})}),i()(this,"_saveProfile",async e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.enableProfileSave)return;this.setState({enableProfileSave:!1});const t=c.a.get(),a={},n=this.state.displayName.trim();try{if(this.state.originalDisplayName!==this.state.displayName&&(await t.setDisplayName(n),a.originalDisplayName=n,a.displayName=n),this.state.avatarFile){console.log(`Uploading new avatar, ${this.state.avatarFile.name} of type ${this.state.avatarFile.type}, (${this.state.avatarFile.size}) bytes`);const e=await t.uploadContent(this.state.avatarFile);await t.setAvatarUrl(e),a.avatarUrl=Object(v.b)(e).getSquareThumbnailHttp(96),a.originalAvatarUrl=a.avatarUrl,a.avatarFile=null}else this.state.originalAvatarUrl!==this.state.avatarUrl&&await t.setAvatarUrl("")}catch(e){console.log("Failed to save profile",e),p.a.createTrackedDialog("Failed to save profile","",g.a,{title:Object(l.a)("Failed to save your profile"),description:e&&e.message?e.message:Object(l.a)("The operation could not be completed")})}this.setState(a)}),i()(this,"_onDisplayNameChanged",e=>{this.setState({displayName:e.target.value,enableProfileSave:!0})}),i()(this,"_onAvatarChanged",e=>{if(!e.target.files||!e.target.files.length)return void this.setState({avatarUrl:this.state.originalAvatarUrl,avatarFile:null,enableProfileSave:!1});const t=e.target.files[0],a=new FileReader;a.onload=e=>{this.setState({avatarUrl:e.target.result,avatarFile:t,enableProfileSave:!0})},a.readAsDataURL(t)});const e=c.a.get();let t=h.a.instance.avatarMxc;t&&(t=Object(v.b)(t).getSquareThumbnailHttp(96)),this.state={userId:e.getUserId(),originalDisplayName:h.a.instance.displayName,displayName:h.a.instance.displayName,originalAvatarUrl:t,avatarUrl:t,avatarFile:null,enableProfileSave:!1},this._avatarUpload=Object(o.createRef)()}render(){const e=Object(m.a)("user-settings");let t=null;e&&(t=r.a.createElement("span",{className:"mx_ProfileSettings_hostingSignup"},Object(l.a)("<a>Upgrade</a> to your own domain",{},{a:t=>r.a.createElement("a",{href:e,target:"_blank",rel:"noreferrer noopener"},t)}),r.a.createElement("a",{href:e,target:"_blank",rel:"noreferrer noopener"},r.a.createElement("img",{src:a(1371),width:"11",height:"10",alt:""}))));const n=u.getComponent("elements.AccessibleButton"),s=u.getComponent("settings.AvatarSetting");return r.a.createElement("form",{onSubmit:this._saveProfile,autoComplete:"off",noValidate:!0,className:"mx_ProfileSettings_profileForm"},r.a.createElement("input",{type:"file",ref:this._avatarUpload,className:"mx_ProfileSettings_avatarUpload",onChange:this._onAvatarChanged,accept:"image/*"}),r.a.createElement("div",{className:"mx_ProfileSettings_profile"},r.a.createElement("div",{className:"mx_ProfileSettings_controls"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Profile")),r.a.createElement(d.a,{label:Object(l.a)("Display Name"),type:"text",value:this.state.displayName,autoComplete:"off",onChange:this._onDisplayNameChanged}),r.a.createElement("p",null,this.state.userId,t)),r.a.createElement(s,{avatarUrl:this.state.avatarUrl,avatarName:this.state.displayName||this.state.userId,avatarAltText:Object(l.a)("Profile picture"),uploadAvatar:this._uploadAvatar,removeAvatar:this._removeAvatar})),r.a.createElement("div",{className:"mx_ProfileSettings_buttons"},r.a.createElement(n,{onClick:this._cancelProfileChanges,kind:"link",disabled:!this.state.enableProfileSave},Object(l.a)("Cancel")),r.a.createElement(n,{onClick:this._saveProfile,kind:"primary",disabled:!this.state.enableProfileSave},Object(l.a)("Save"))))}})||n},1369:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(223),s=a.n(n),i=a(2714),o=a.n(i),r=a(110),l=a(99);function c(e){const t=r.a.get().hosting_signup_link;if(!t)return null;if(!e)return t;if("matrix.org"!==l.a.get().getDomain())return null;try{const a=s.a.parse(t),n=o.a.parse(a.query);return n.utm_campaign=e,a.search=void 0,a.query=n,a.format()}catch(e){return t}}},1371:function(e,t){e.exports="img/external-link.67fb410.svg"},1372:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,s=a(88),i=a.n(s),o=a(92),r=a.n(o),l=a(97),c=a(93),d=a(103),m=a(94);let u=Object(m.a)("views.elements.LanguageDropdown")(n=class extends i.a.Component{constructor(e){super(e),this._onSearchChange=this._onSearchChange.bind(this),this.state={searchQuery:"",langs:null}}componentDidMount(){if(c.c().then(e=>{e.sort((function(e,t){return e.label<t.label?-1:e.label>t.label?1:0})),this.setState({langs:e})}).catch(()=>{this.setState({langs:["en"]})}),!this.props.value){const e=c.g();this.props.onOptionChange(e)}}_onSearchChange(e){this.setState({searchQuery:e})}render(){if(null===this.state.langs){const e=l.getComponent("elements.Spinner");return i.a.createElement(e,null)}const e=l.getComponent("elements.Dropdown");let t;t=this.state.searchQuery?this.state.langs.filter(e=>function(e,t){return!!t.label.toUpperCase().includes(e.toUpperCase())||t.value.toUpperCase()===e.toUpperCase()}(this.state.searchQuery,e)):this.state.langs;const a=t.map(e=>i.a.createElement("div",{key:e.value},e.label));let n=d.b.getValue("language",null,!0),s=null;return n||(n=navigator.language||navigator.userLanguage),s=this.props.value||n,i.a.createElement(e,{id:"mx_LanguageDropdown",className:this.props.className,onOptionChange:this.props.onOptionChange,onSearchChange:this._onSearchChange,searchEnabled:!0,value:s,label:Object(c.a)("Language Dropdown"),disabled:this.props.disabled},a)}})||n;u.propTypes={className:r.a.string,onOptionChange:r.a.func.isRequired,value:r.a.string}},1373:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(1374),c=a(108),d=a(93),m=a(94);class u extends r.a.Component{constructor(){super(...arguments),i()(this,"_onRemove",e=>(e.stopPropagation(),e.preventDefault(),this.props.onRemoved(this.props.language)))}render(){return r.a.createElement("div",{className:"mx_ExistingSpellCheckLanguage"},r.a.createElement("span",{className:"mx_ExistingSpellCheckLanguage_language"},this.props.language),r.a.createElement(c.a,{onClick:this._onRemove,kind:"danger_sm"},Object(d.a)("Remove")))}}let h=Object(m.a)("views.settings.SpellCheckLanguages")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"_onRemoved",e=>{const t=this.props.languages.filter(t=>t!==e);this.props.onLanguagesChange(t)}),i()(this,"_onAddClick",e=>{e.stopPropagation(),e.preventDefault();const t=this.state.newLanguage;t&&(this.props.languages.includes(t)||(this.props.languages.push(t),this.props.onLanguagesChange(this.props.languages)))}),i()(this,"_onNewLanguageChange",e=>{this.state.newLanguage!==e&&this.setState({newLanguage:e})}),this.state={newLanguage:""}}render(){const e=this.props.languages.map(e=>r.a.createElement(u,{language:e,onRemoved:this._onRemoved,key:e})),t=r.a.createElement(c.a,{onClick:this._onAddClick,kind:"primary"},Object(d.a)("Add"));return r.a.createElement("div",{className:"mx_SpellCheckLanguages"},e,r.a.createElement("form",{onSubmit:this._onAddClick,noValidate:!0},r.a.createElement(l.a,{className:"mx_GeneralUserSettingsTab_spellCheckLanguageInput",value:this.state.newLanguage,onOptionChange:this._onNewLanguageChange}),t))}})||n},1374:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,s=a(88),i=a.n(s),o=a(818),r=a(97),l=a(156),c=a(103),d=a(93),m=a(94);let u=Object(m.a)("views.elements.SpellCheckLanguagesDropdown")(n=class extends i.a.Component{constructor(e){super(e),this._onSearchChange=this._onSearchChange.bind(this),this.state={searchQuery:"",languages:null}}componentDidMount(){const e=l.a.get();e&&e.getAvailableSpellCheckLanguages().then(e=>{e.sort((function(e,t){return e<t?-1:e>t?1:0}));const t=[];e.forEach(e=>{t.push({label:e,value:e})}),this.setState({languages:t})}).catch(e=>{this.setState({languages:["en"]})})}_onSearchChange(e){this.setState({searchQuery:e})}render(){if(null===this.state.languages){const e=r.getComponent("elements.Spinner");return i.a.createElement(e,null)}let e;e=this.state.searchQuery?this.state.languages.filter(e=>function(e,t){return!!t.label.toUpperCase().includes(e.toUpperCase())||t.value.toUpperCase()===e.toUpperCase()}(this.state.searchQuery,e)):this.state.languages;const t=e.map(e=>i.a.createElement("div",{key:e.value},e.label));let a=c.b.getValue("language",null,!0),n=null;return a||(a=navigator.language||navigator.userLanguage),n=this.props.value||a,i.a.createElement(o.a,{id:"mx_LanguageDropdown",className:this.props.className,onOptionChange:this.props.onOptionChange,onSearchChange:this._onSearchChange,searchEnabled:!0,value:n,label:Object(d.a)("Language Dropdown")},t)}})||n},1375:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(92),c=a.n(l),d=a(97),m=a(181),u=a(99),h=a(427),p=a(93),g=a(831),f=a(342),v=a(228),b=a(94);let y=Object(b.a)("views.dialogs.DeactivateAccountDialog")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"_onStagePhaseChange",(e,t)=>{const a={[f.c.PHASE_PREAUTH]:{body:Object(p.a)("Confirm your account deactivation by using Single Sign On to prove your identity."),continueText:Object(p.a)("Single Sign On"),continueKind:"danger"},[f.c.PHASE_POSTAUTH]:{body:Object(p.a)("Are you sure you want to deactivate your account? This is irreversible."),continueText:Object(p.a)("Confirm account deactivation"),continueKind:"danger"}},n={[f.c.LOGIN_TYPE]:a,[f.c.UNSTABLE_LOGIN_TYPE]:a,[f.b.LOGIN_TYPE]:{[f.a]:{body:Object(p.a)("To continue, please enter your password:")}}}[e];let s=null,i=null,o=null;if(n){const e=n[t];e&&e.body&&(s=e.body),e&&e.continueText&&(i=e.continueText),e&&e.continueKind&&(o=e.continueKind)}this.setState({bodyText:s,continueText:i,continueKind:o})}),i()(this,"_onUIAuthFinished",(e,t,a)=>{e||(t!==g.a?(console.error("Error during UI Auth:",{result:t,extra:a}),this.setState({errStr:Object(p.a)("There was a problem communicating with the server. Please try again.")})):this._onCancel())}),i()(this,"_onUIAuthComplete",e=>{u.a.get().deactivateAccount(e,this.state.shouldErase).then(e=>{m.a.trackEvent("Account","Deactivate Account"),h.j(),this.props.onFinished(!0)}).catch(e=>{console.error(e),this.setState({errStr:Object(p.a)("There was a problem communicating with the server. Please try again.")})})}),i()(this,"_onEraseFieldChange",e=>{this.setState({shouldErase:e.target.checked,authEnabled:!1}),this._initAuth(e.target.checked)}),this.state={shouldErase:!1,errStr:null,authData:null,authEnabled:!0,bodyText:null,continueText:null,continueKind:null},this._initAuth(!1)}_onCancel(){this.props.onFinished(!1)}_initAuth(e){u.a.get().deactivateAccount(null,e).then(e=>{console.warn("User's account got deactivated without confirmation: Server had no auth"),this.setState({errStr:Object(p.a)("Server did not require any authentication")})}).catch(e=>{e&&401===e.httpStatus&&e.data?this.setState({authData:e.data,authEnabled:!0}):this.setState({errStr:Object(p.a)("Server did not return valid authentication information.")})})}render(){const e=d.getComponent("views.dialogs.BaseDialog");let t=null;this.state.errStr&&(t=r.a.createElement("div",{className:"error"},this.state.errStr));let a=r.a.createElement("div",null,Object(p.a)("Loading..."));return this.state.authData&&this.state.authEnabled&&(a=r.a.createElement("div",null,this.state.bodyText,r.a.createElement(g.b,{matrixClient:u.a.get(),authData:this.state.authData,makeRequest:this._onUIAuthComplete,onAuthFinished:this._onUIAuthFinished,onStagePhaseChange:this._onStagePhaseChange,continueText:this.state.continueText,continueKind:this.state.continueKind}))),r.a.createElement(e,{className:"mx_DeactivateAccountDialog",onFinished:this.props.onFinished,titleClass:"danger",title:Object(p.a)("Deactivate Account")},r.a.createElement("div",{className:"mx_Dialog_content"},r.a.createElement("p",null,Object(p.a)("This will make your account permanently unusable. You will not be able to log in, and no one will be able to re-register the same user ID. This will cause your account to leave all rooms it is participating in, and it will remove your account details from your identity server. <b>This action is irreversible.</b>",{},{b:e=>r.a.createElement("b",null," ",e," ")})),r.a.createElement("p",null,Object(p.a)("Deactivating your account <b>does not by default cause us to forget messages you have sent.</b> If you would like us to forget your messages, please tick the box below.",{},{b:e=>r.a.createElement("b",null," ",e," ")})),r.a.createElement("p",null,Object(p.a)("Message visibility in Matrix is similar to email. Our forgetting your messages means that messages you have sent will not be shared with any new or unregistered users, but registered users who already have access to these messages will still have access to their copy.")),r.a.createElement("div",{className:"mx_DeactivateAccountDialog_input_section"},r.a.createElement("p",null,r.a.createElement(v.a,{checked:this.state.shouldErase,onChange:this._onEraseFieldChange},Object(p.a)("Please forget all messages I have sent when my account is deactivated (<b>Warning:</b> this will cause future users to see an incomplete view of conversations)",{},{b:e=>r.a.createElement("b",null,e)}))),t,a)))}})||n;y.propTypes={onFinished:c.a.func.isRequired}},1376:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(225),s=a(246),i=a(780),o=a(590);const r=window.localStorage;let l;try{l=window.indexedDB}catch(e){}function c(e){const t={useAuthorizationHeader:!0};return l&&r&&(t.store=new o.a({indexedDB:l,dbName:"riot-web-sync",localStorage:r,workerScript:c.indexedDbWorkerScript})),r&&(t.sessionStore=new i.a(r)),l&&(t.cryptoStore=new s.a(l,"matrix-js-sdk:crypto")),e=Object.assign(t,e),Object(n.createClient)(e)}c.indexedDbWorkerScript=null},1377:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(19),s=a.n(n),i=a(99),o=a(103),r=a(422);class l{constructor(){s()(this,"typingStates",void 0),this.reset()}static sharedInstance(){return void 0===window.mxTypingStore&&(window.mxTypingStore=new l),window.mxTypingStore}reset(){this.typingStates={}}setSelfTyping(e,t){if(!o.b.getValue("sendTypingNotifications"))return;if(o.b.getValue("lowBandwidth"))return;let a=this.typingStates[e];!t&&!a||a&&a.isTyping===t||(a||(a=this.typingStates[e]={isTyping:t,serverTimer:new r.a(3e4),userTimer:new r.a(1e4)}),a.isTyping=t,t&&(a.serverTimer.isRunning()?a.serverTimer.restart():a.serverTimer.restart().finished().then(()=>{const t=this.typingStates[e];t&&(t.isTyping=!1)}),a.userTimer.isRunning()?a.userTimer.restart():a.userTimer.restart().finished().then(()=>{this.setSelfTyping(e,!1)})),i.a.get().sendTyping(e,t,3e4))}}},1378:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(819),u=a(182),h=a(93),p=a(821),g=a(94);function f(e){return e===p.c?a(2727):a(813)}let v=Object(g.a)("views.dialogs.security.SetupEncryptionDialog")((s=class extends l.a.Component{constructor(){super(),o()(this,"_onStoreUpdate",()=>{this.setState({icon:f(this.store.phase)})}),this.store=p.g.sharedInstance(),this.state={icon:f(this.store.phase)}}componentDidMount(){this.store.on("update",this._onStoreUpdate)}componentWillUnmount(){this.store.removeListener("update",this._onStoreUpdate)}render(){return l.a.createElement(u.a,{headerImage:this.state.icon,onFinished:this.props.onFinished,title:Object(h.a)("Verify this session")},l.a.createElement(m.a,{onFinished:this.props.onFinished}))}},o()(s,"propTypes",{onFinished:d.a.func.isRequired}),n=s))||n},1379:function(e,t,a){"use strict";a.d(t,"a",(function(){return be})),a.d(t,"b",(function(){return ye}));var n,s,i=a(95),o=a.n(i),r=a(19),l=a.n(r),c=a(88),d=a.n(c),m=a(225),u=a(331),h=a(257),p=(a(1380),a(1381),a(181)),g=a(154),f=a(1382),v=a(99),b=a(156),y=a(110),E=a(100),_=a(301),S=a(106),C=a(369),w=a(97),O=a(205),x=a(298),R=a(573),k=a(427),I=(a(1383),a(1384)),T=a(214),P=a(93),N=a(103),D=a(595),j=a(822),A=a(428),M=a(823),U=a(382),L=a(185),F=a(494),B=a(824),V=a(745),G=a(211),z=a(217),W=a(504),H=a(115),K=a(1385),q=a(421),Y=a(186),$=a(184),J=a(123),Q=a(295),X=a(825),Z=a(827),ee=a(147),te=a(203),ae=a(828),ne=a(1386),se=a(375),ie=a(175),oe=a(94),re=a(174),le=a(161),ce=a(338),de=a(1546),me=a(200),ue=a(112),he=a.n(ue);function pe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}let ge;!function(e){e[e.LOADING=0]="LOADING",e[e.WELCOME=1]="WELCOME",e[e.LOGIN=2]="LOGIN",e[e.REGISTER=3]="REGISTER",e[e.FORGOT_PASSWORD=4]="FORGOT_PASSWORD",e[e.COMPLETE_SECURITY=5]="COMPLETE_SECURITY",e[e.E2E_SETUP=6]="E2E_SETUP",e[e.LOGGED_IN=7]="LOGGED_IN",e[e.SOFT_LOGOUT=8]="SOFT_LOGOUT"}(ge||(ge={}));const fe=["register","login","forgot_password","start_sso","start_cas"],ve=[H.a.ViewUserSettings,"view_create_chat","view_create_room","view_create_group"];let be=Object(oe.a)("structures.MatrixChat")((s=class extends d.a.PureComponent{constructor(e,t){if(super(e,t),l()(this,"firstSyncComplete",void 0),l()(this,"firstSyncPromise",void 0),l()(this,"screenAfterLogin",void 0),l()(this,"pageChanging",void 0),l()(this,"tokenLogin",void 0),l()(this,"accountPassword",void 0),l()(this,"accountPasswordTimer",void 0),l()(this,"focusComposer",void 0),l()(this,"subTitleStatus",void 0),l()(this,"prevWindowWidth",void 0),l()(this,"loggedInView",void 0),l()(this,"dispatcherRef",void 0),l()(this,"themeWatcher",void 0),l()(this,"fontWatcher",void 0),l()(this,"onAction",e=>{const t=w.getComponent("dialogs.QuestionDialog");if(v.a.get()&&v.a.get().isGuest()&&ve.includes(e.action))return E.a.dispatch({action:"do_after_sync_prepared",deferred_action:e}),void E.a.dispatch({action:"require_registration"});switch(e.action){case"MatrixActions.accountData":if("m.identity_server"===e.event_type){const t=e.event_content?e.event_content.base_url:null;t?(v.a.get().setIdentityServerUrl(t),localStorage.removeItem("mx_is_access_token"),localStorage.setItem("mx_is_url",t)):(v.a.get().setIdentityServerUrl(null),localStorage.removeItem("mx_is_access_token"),localStorage.removeItem("mx_is_url")),E.a.dispatch({action:"id_server_changed"})}break;case"logout":E.a.dispatch({action:"hangup_all"}),k.d(he.a.API_ENPOINT+"/oauth/logout");break;case"require_registration":Object(j.b)(e);break;case"start_registration":if(k.h()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.startRegistration(e.params||{});break;case"start_login":if(k.h()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.viewLogin();break;case"start_password_recovery":this.setStateForNewView({view:ge.FORGOT_PASSWORD}),this.notifyNewScreen("forgot_password");break;case"start_chat":Object(T.d)({dmUserId:e.user_id});break;case"leave_room":this.leaveRoom(e.room_id);break;case"forget_room":this.forgetRoom(e.room_id);break;case"reject_invite":S.a.createTrackedDialog("Reject invitation","",t,{title:Object(P.a)("Reject invitation"),description:Object(P.a)("Are you sure you want to reject the invitation?"),onFinished:t=>{if(t){const t=w.getComponent("elements.Spinner"),a=S.a.createDialog(t,null,"mx_Dialog_spinner");v.a.get().leave(e.room_id).then(()=>{a.close(),this.state.currentRoomId===e.room_id&&E.a.dispatch({action:"view_home_page"})},e=>{a.close(),S.a.createTrackedDialog("Failed to reject invitation","",Y.a,{title:Object(P.a)("Failed to reject invitation"),description:e.toString()})})}}});break;case"view_user_info":this.viewUser(e.userId,e.subAction);break;case"view_room":{const t=this.viewRoom(e);e.deferred_action&&t.then(()=>{E.a.dispatch(e.deferred_action)});break}case H.a.ViewUserSettings:{const t=e,a=w.getComponent("dialogs.UserSettingsDialog");S.a.createTrackedDialog("User settings","",a,{initialTabId:t.initialTabId},null,!1,!0),this.viewSomethingBehindModal();break}case"view_create_room":this.createRoom(e.public,e.defaultName);break;case"view_create_group":{let e=w.getComponent("dialogs.CreateGroupDialog");N.b.getValue("feature_communities_v2_prototypes")&&(e=X.a),S.a.createTrackedDialog("Create Community","",e);break}case H.a.ViewRoomDirectory:if(ie.e.instance.activeSpace);else{const t=w.getComponent("structures.RoomDirectory");S.a.createTrackedDialog("Room directory","",t,{initialText:e.initialText},"mx_RoomDirectory_dialogWrapper",!1,!0)}this.viewSomethingBehindModal();break;case"view_my_groups":this.setPage(I.a.MyGroups),this.notifyNewScreen("groups");break;case"view_group":this.viewGroup(e);break;case"view_welcome_page":this.viewWelcome();break;case"view_home_page":this.viewHome(e.justRegistered);break;case"view_list_page":this.viewListPage(e.justRegistered);break;case"view_list_patient":this.viewPage("Patient",e.justRegistered);break;case"view_start_chat_or_reuse":this.chatCreateOrReuse(e.user_id);break;case"view_create_chat":Object(O.h)(e.initialText||"");break;case"view_invite":Object(O.g)(e.roomId);break;case"view_last_screen":this.showScreenAfterLogin();break;case"toggle_my_groups":localStorage.setItem("mx_seenSpacesBeta","1"),this.state.page_type===I.a.MyGroups?E.a.dispatch({action:"view_last_screen"}):E.a.dispatch({action:"view_my_groups"});break;case"hide_left_panel":this.setState({collapseLhs:!0},()=>{this.state.resizeNotifier.notifyLeftHandleResized()});break;case"focus_room_filter":case"show_left_panel":this.setState({collapseLhs:!1},()=>{this.state.resizeNotifier.notifyLeftHandleResized()});break;case H.a.OpenDialPad:S.a.createTrackedDialog("Dial pad","",ae.a,{},"mx_Dialog_dialPadWrapper");break;case"on_logged_in":this.tokenLogin||k.h()||this.state.view===ge.LOGIN||this.state.view===ge.REGISTER||this.state.view===ge.COMPLETE_SECURITY||this.state.view===ge.E2E_SETUP||this.onLoggedIn();break;case"on_client_not_viable":this.onSoftLogout();break;case"on_logged_out":this.onLoggedOut();break;case"will_start_client":this.setState({ready:!1},()=>{this.onWillStartClient()});break;case"client_started":this.onClientStarted();break;case"send_event":this.onSendEvent(e.room_id,e.event);break;case"aria_hide_main_app":this.setState({hideToSRUsers:!0});break;case"aria_unhide_main_app":this.setState({hideToSRUsers:!1});break;case"accept_cookies":N.b.setValue("analyticsOptIn",null,J.a.DEVICE,!0),N.b.setValue("showCookieBar",null,J.a.DEVICE,!1),Object(K.a)(),p.a.canEnable()&&p.a.enable(),g.a.instance.canEnable()&&g.a.instance.enable(!1);break;case"reject_cookies":N.b.setValue("analyticsOptIn",null,J.a.DEVICE,!1),N.b.setValue("showCookieBar",null,J.a.DEVICE,!1),Object(K.a)()}}),l()(this,"handleResize",()=>{const e=me.b.instance.windowWidth;this.prevWindowWidth<1e3&&e>=1e3&&E.a.dispatch({action:"show_left_panel"}),this.prevWindowWidth>=1e3&&e<1e3&&E.a.dispatch({action:"hide_left_panel"}),this.prevWindowWidth=e,this.state.resizeNotifier.notifyWindowResized()}),l()(this,"onRegisterClick",()=>{this.showScreen("register")}),l()(this,"onLoginClick",()=>{this.showScreen("login")}),l()(this,"onForgotPasswordClick",()=>{this.showScreen("forgot_password")}),l()(this,"onRegisterFlowComplete",(e,t)=>this.onUserCompletedLoginFlow(e,t)),l()(this,"onServerConfigChange",e=>{this.setState({serverConfig:e})}),l()(this,"makeRegistrationUrl",e=>(this.props.startingFragmentQueryParams.referrer&&(e.referrer=this.props.startingFragmentQueryParams.referrer),this.props.makeRegistrationUrl(e))),l()(this,"onUserCompletedLoginFlow",async(e,t)=>{this.accountPassword=t,null!==this.accountPasswordTimer&&clearTimeout(this.accountPasswordTimer),this.accountPasswordTimer=setTimeout(()=>{this.accountPassword=null,this.accountPasswordTimer=null},3e5),await k.l(e),await this.postLoginSetup(),de.b.instance.stop(de.a.LOGIN),de.b.instance.stop(de.a.REGISTER)}),l()(this,"onCompleteSecurityE2eSetupFinished",()=>{this.onLoggedIn()}),this.state={view:ge.LOADING,collapseLhs:!1,hideToSRUsers:!1,syncError:null,resizeNotifier:new M.a,ready:!1},this.loggedInView=Object(c.createRef)(),y.a.put(this.props.config),this.firstSyncComplete=!1,this.firstSyncPromise=Object(G.a)(),this.props.config.sync_timeline_limit&&(v.a.opts.initialSyncLimit=this.props.config.sync_timeline_limit),this.screenAfterLogin=this.props.initialScreenAfterLogin,this.screenAfterLogin){const e=this.screenAfterLogin.params||{};if(this.screenAfterLogin.screen.startsWith("room/")&&e.signurl&&e.email){const t=this.screenAfterLogin.screen.substring("room/".length);Z.a.instance.storeInvite(t,e)}}this.prevWindowWidth=me.b.instance.windowWidth||1e3,me.b.instance.on(me.a.Resize,this.handleResize),this.pageChanging=!1,C.a.tint(),this.state.resizeNotifier.on("middlePanelResized",this.dispatchTimelineResize),k.h()&&k.i(),this.accountPassword=null,this.accountPasswordTimer=null,this.dispatcherRef=E.a.register(this.onAction),this.themeWatcher=new F.a,this.fontWatcher=new B.a,this.themeWatcher.start(),this.fontWatcher.start(),this.focusComposer=!1,this.subTitleStatus="",this.onAliasClick&&(R.a.onAliasClick=this.onAliasClick),this.onUserClick&&(R.a.onUserClick=this.onUserClick),this.onGroupClick&&(R.a.onGroupClick=this.onGroupClick),k.h()||k.a(this.props.realQueryParams,this.props.defaultDeviceDisplayName,this.getFragmentAfterLogin()).then(async e=>{var t;if(null!==(t=this.props.realQueryParams)&&void 0!==t&&t.loginToken&&this.props.onTokenLoginCompleted(),e)return this.tokenLogin=!0,await k.k({ignoreGuest:!0}),this.postLoginSetup();const a=this.screenAfterLogin?this.screenAfterLogin.screen:null;if("login"!==a&&"register"!==a&&"forgot_password"!==a)return this.loadSession();this.showScreenAfterLogin()}),N.b.getValue("analyticsOptIn")&&p.a.enable(),g.a.instance.enable(!0)}async postLoginSetup(){const e=v.a.get(),t=e.isCryptoEnabled();t||this.onLoggedIn();const a=[this.firstSyncPromise.promise];if(t&&a.push(e.downloadKeys([e.getUserId()])),this.setState({pendingInitialSync:!0}),await Promise.all(a),!t)return void this.setState({pendingInitialSync:!1});e.getStoredCrossSigningForUser(e.getUserId())?!1===ce.a.SHOW_ENCRYPTION_SETUP_UI?this.onLoggedIn():this.setStateForNewView({view:ge.COMPLETE_SECURITY}):await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing")?this.setStateForNewView({view:ge.E2E_SETUP}):this.onLoggedIn(),this.setState({pendingInitialSync:!1})}UNSAFE_componentWillUpdate(e,t){this.shouldTrackPageChange(this.state,t)&&this.startPageChangeTimer()}componentDidUpdate(e,t){if(this.shouldTrackPageChange(t,this.state)){const e=this.stopPageChangeTimer();p.a.trackPageChange(e),g.a.instance.trackPageChange(e)}this.focusComposer&&(E.a.fire(H.a.FocusComposer),this.focusComposer=!1)}componentWillUnmount(){k.n(),E.a.unregister(this.dispatcherRef),this.themeWatcher.stop(),this.fontWatcher.stop(),me.b.destroy(),this.state.resizeNotifier.removeListener("middlePanelResized",this.dispatchTimelineResize),null!==this.accountPasswordTimer&&clearTimeout(this.accountPasswordTimer)}getFallbackHsUrl(){return this.props.serverConfig&&this.props.serverConfig.isDefault?this.props.config.fallback_hs_url:null}getServerProperties(){let e=this.state.serverConfig;return e||(e=this.props.serverConfig),e||(e=y.a.get().validated_server_config),{serverConfig:e}}loadSession(){return Promise.resolve().then(()=>k.i({fragmentQueryParams:this.props.startingFragmentQueryParams,enableGuest:this.props.enableGuest,guestHsUrl:this.getServerProperties().serverConfig.hsUrl,guestIsUrl:this.getServerProperties().serverConfig.isUrl,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName})).then(e=>{e?N.b.getValue("analyticsOptIn")&&g.a.instance.enable(!1):Z.a.instance.pickBestInvite()?E.a.dispatch({action:"start_registration"}):E.a.dispatch({action:"view_welcome_page"})})}startPageChangeTimer(){de.b.instance.start(de.a.PAGE_CHANGE)}stopPageChangeTimer(){const e=de.b.instance;e.stop(de.a.PAGE_CHANGE);const t=e.getEntries({name:de.a.PAGE_CHANGE}).pop();return t?t.duration:null}shouldTrackPageChange(e,t){return e.currentRoomId!==t.currentRoomId||e.view!==t.view||e.page_type!==t.page_type}setStateForNewView(e){if(void 0===e.view)throw new Error("setStateForNewView with no view!");const t={currentUserId:null,justRegistered:!1};Object.assign(t,e),this.setState(t)}setPage(e){this.setState({page_type:e})}async startRegistration(e){const t={view:ge.REGISTER};e.client_secret&&e.session_id&&e.hs_url&&e.is_url&&e.sid&&(t.serverConfig=await U.b.validateServerConfigWithStaticUrls(e.hs_url,e.is_url),t.register_client_secret=e.client_secret,t.register_session_id=e.session_id,t.register_id_sid=e.sid),this.setStateForNewView(t),D.a.isLogin=!0,this.themeWatcher.recheck(),this.notifyNewScreen("register")}viewRoom(e){this.focusComposer=!0,e.room_alias?console.log(`Switching to room alias ${e.room_alias} at event `+e.event_id):console.log(`Switching to room id ${e.room_id} at event `+e.event_id);let t=Promise.resolve(null);if(!this.firstSyncComplete){if(!this.firstSyncPromise)return void console.warn("Cannot view a room before first sync. room_id:",e.room_id);t=this.firstSyncPromise.promise}return t.then(()=>{let t=e.room_alias||e.room_id;const a=v.a.get().getRoom(e.room_id);if(a){a.decryptAllEvents();const e=x.a(a);e&&(t=e,Object(V.b)(e,a.roomId)),localStorage&&localStorage.setItem("mx_last_room_id",a.roomId)}const n="#"===t[0]&&e.room_id===this.state.currentRoomId;e.event_id&&e.highlighted&&(t+="/"+e.event_id),this.setState({view:ge.LOGGED_IN,currentRoomId:e.room_id||null,page_type:I.a.RoomView,threepidInvite:e.threepid_invite,roomOobData:e.oob_data,ready:!0,roomJustCreatedOpts:e.justCreatedOpts},()=>{this.notifyNewScreen("room/"+t,n)})})}async viewGroup(e){const t=e.group_id;if(!this.firstSyncComplete){if(!this.firstSyncPromise)return void console.warn("Cannot view a group before first sync. group_id:",t);await this.firstSyncPromise.promise}this.setState({view:ge.LOGGED_IN,currentGroupId:t,currentGroupIsNew:e.group_is_new}),this.setPage(I.a.GroupView),this.notifyNewScreen("group/"+t)}viewSomethingBehindModal(){this.state.view===ge.LOGGED_IN?this.state.currentGroupId||this.state.currentRoomId||this.viewHome():this.viewWelcome()}viewWelcome(){if(Object(se.c)(y.a.get()))return this.viewLogin();this.setStateForNewView({view:ge.WELCOME}),this.notifyNewScreen("welcome"),D.a.isLogin=!0,this.themeWatcher.recheck()}viewLogin(e){this.setStateForNewView(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(a),!0).forEach((function(t){l()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({view:ge.LOGIN},e)),this.notifyNewScreen("login"),D.a.isLogin=!0,this.themeWatcher.recheck()}viewHome(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setStateForNewView({view:ge.LOGGED_IN,justRegistered:e}),this.setPage(I.a.HomePage),this.notifyNewScreen("home"),D.a.isLogin=!1,this.themeWatcher.recheck()}viewListPage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setStateForNewView({view:ge.LOGGED_IN,justRegistered:e}),this.setPage(I.a.ListPage),this.notifyNewScreen("listpage"),D.a.isLogin=!1,this.themeWatcher.recheck()}viewPage(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setStateForNewView({view:ge.LOGGED_IN,justRegistered:t}),this.setPage(e),this.notifyNewScreen(e),D.a.isLogin=!1,this.themeWatcher.recheck()}viewUser(e,t){(this.firstSyncPromise?this.firstSyncPromise.promise:Promise.resolve()).then(()=>{"chat"!==t?(this.notifyNewScreen("user/"+e),this.setState({currentUserId:e}),this.setPage(I.a.UserView)):this.chatCreateOrReuse(e)})}async createRoom(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;const a=te.a.instance.getSelectedCommunityId();if(a&&!te.a.instance.isAdminOf(a))return void S.a.createTrackedDialog("Pre-failure to create room","",Y.a,{title:Object(P.a)("Cannot create rooms in this community"),description:Object(P.a)("You do not have permission to create rooms in this community.")});const n=w.getComponent("dialogs.CreateRoomDialog"),s=S.a.createTrackedDialog("Create Room","",n,{defaultPublic:e,defaultName:t}),[i,o]=await s.finished;i&&Object(T.d)(o)}chatCreateOrReuse(e){if(v.a.get().isGuest())return e!==this.props.config.welcomeUserId&&E.a.dispatch({action:"do_after_sync_prepared",deferred_action:{action:"view_start_chat_or_reuse",user_id:e}}),void E.a.dispatch({action:"require_registration",go_welcome_on_cancel:!0,screen_after:{screen:"user/"+this.props.config.welcomeUserId,params:{action:"chat"}}});const t=v.a.get(),a=new L.a(t).getDMRoomsForUserId(e);a.length>0?E.a.dispatch({action:"view_room",room_id:a[0]}):E.a.dispatch({action:"start_chat",user_id:e})}leaveRoomWarnings(e){const t=v.a.get().getRoom(e),a=N.b.getValue("feature_spaces")&&(null==t?void 0:t.isSpaceRoom()),n=[];if(1===t.currentState.getJoinedMemberCount())return n.push(d.a.createElement("span",{className:"warning",key:"only_member_warning"}," ",Object(P.a)("You are the only person here. If you leave, no one will be able to join in the future, including you."))),n;const s=t.currentState.getStateEvents("m.room.join_rules","");if(s){"public"!==s.getContent().join_rule&&n.push(d.a.createElement("span",{className:"warning",key:"non_public_warning"}," ",a?Object(P.a)("This space is not public. You will not be able to rejoin without an invite."):Object(P.a)("This room is not public. You will not be able to rejoin without an invite.")))}return n}leaveRoom(e){const t=w.getComponent("dialogs.QuestionDialog"),a=v.a.get().getRoom(e),n=this.leaveRoomWarnings(e),s=N.b.getValue("feature_spaces")&&(null==a?void 0:a.isSpaceRoom());S.a.createTrackedDialog(s?"Leave space":"Leave room","",t,{title:s?Object(P.a)("Leave space"):Object(P.a)("Leave room"),description:d.a.createElement("span",null,s?Object(P.a)("Are you sure you want to leave the space '%(spaceName)s'?",{spaceName:a.name}):Object(P.a)("Are you sure you want to leave the room '%(roomName)s'?",{roomName:a.name}),n),button:Object(P.a)("Leave"),onFinished:t=>{if(t){const t=Object(Q.d)(e),a=w.getComponent("elements.Spinner"),n=S.a.createDialog(a,null,"mx_Dialog_spinner");t.finally(()=>n.close()),E.a.dispatch({action:"after_leave_room",room_id:e})}}})}forgetRoom(e){const t=v.a.get().getRoom(e);v.a.get().forget(e).then(()=>{this.state.currentRoomId===e&&E.a.dispatch({action:"view_home_page"}),re.b.instance.manualRoomUpdate(t,le.c.RoomRemoved)}).catch(e=>{const t=e.errcode||Object(P.b)("unknown error code");S.a.createTrackedDialog("Failed to forget room","",Y.a,{title:Object(P.a)("Failed to forget room %(errCode)s",{errCode:t}),description:e&&e.message?e.message:Object(P.a)("Operation failed")})})}async startWelcomeUserChat(){let e;e=this.firstSyncComplete?Promise.resolve():this.firstSyncPromise.promise,await e;if(0===L.a.shared().getDMRoomsForUserId(this.props.config.welcomeUserId).length){const e=await Object(T.d)({dmUserId:this.props.config.welcomeUserId,andView:!this.state.currentRoomId,spinner:!1}),t=e=>{"m.direct"===e.getType()&&e.getContent()&&e.getContent()[this.props.config.welcomeUserId]&&(v.a.get().store.save(!0),v.a.get().removeListener("accountData",t))};return v.a.get().on("accountData",t),e}return null}async onLoggedIn(){if(D.a.isLogin=!1,this.themeWatcher.recheck(),this.setStateForNewView({view:ge.LOGGED_IN}),this.screenAfterLogin&&this.screenAfterLogin.screen)this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=null;else if(v.a.currentUserIsJustRegistered())if(v.a.setJustRegisteredUserId(null),this.props.config.welcomeUserId&&Object(P.d)().startsWith("en")){null===await this.startWelcomeUserChat()&&E.a.dispatch({action:"view_home_page",justRegistered:!0})}else if(Z.a.instance.pickBestInvite()){const e=Z.a.instance.pickBestInvite(),t=Z.a.instance.translateToWireFormat(e);this.showScreen("room/"+e.roomId,t)}else E.a.dispatch({action:"view_home_page",justRegistered:!0});else this.showScreenAfterLogin();var e;(W.g(),await Object(G.c)(30),N.b.getValue("showCookieBar")&&(p.a.canEnable()||g.a.instance.canEnable()))&&Object(K.b)(null===(e=this.props.config.piwik)||void 0===e?void 0:e.policyUrl);y.a.get().mobileGuideToast&&Object(ne.a)()}showScreenAfterLogin(){this.screenAfterLogin&&this.screenAfterLogin.screen?(this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=null):localStorage&&localStorage.getItem("mx_last_room_id")?this.viewLastRoom():v.a.get().isGuest()?E.a.dispatch({action:"view_welcome_page"}):E.a.dispatch({action:"view_home_page"})}viewLastRoom(){E.a.dispatch({action:"view_room",room_id:localStorage.getItem("mx_last_room_id")})}onLoggedOut(){this.viewLogin({ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle()}onSoftLogout(){this.notifyNewScreen("soft_logout"),this.setStateForNewView({view:ge.SOFT_LOGOUT,ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle()}onWillStartClient(){this.firstSyncComplete=!1,this.firstSyncPromise=Object(G.a)();const e=v.a.get();e.setCanResetTimelineCallback(e=>(console.log("Request to reset timeline in room ",e," viewing:",this.state.currentRoomId),e!==this.state.currentRoomId||(!this.loggedInView.current||this.loggedInView.current.canResetTimelineInRoom(e)))),e.on("sync",(e,t,a)=>{E.a.dispatch({action:"sync_state",prevState:t,state:e}),"ERROR"===e||"RECONNECTING"===e?(a.error instanceof u.b&&k.e(a.error),this.setState({syncError:a.error||!0})):this.state.syncError&&this.setState({syncError:null}),this.updateStatusIndicator(e,t),"SYNCING"===e&&"SYNCING"===t||(console.info("MatrixClient sync state => %s",e),"PREPARED"===e&&(this.firstSyncComplete=!0,this.firstSyncPromise.resolve(),_.default.shouldShowPrompt()&&!v.a.userRegisteredWithinLastHours(24)&&Object(q.b)(!1),E.a.fire(H.a.FocusComposer),this.setState({ready:!0})))}),e.on("Session.logged_out",(function(e){if(!k.g()){if(S.a.closeCurrentModal("Session.logged_out"),401===e.httpStatus&&e.data&&e.data.soft_logout)return console.warn("Soft logout issued by server - avoiding data deletion"),void k.m();S.a.createTrackedDialog("Signed out","",Y.a,{title:Object(P.a)("Signed Out"),description:Object(P.a)("For security, this session has been signed out. Please sign in again.")}),E.a.dispatch({action:"logout"})}})),e.on("no_consent",(function(t,a){const n=w.getComponent("dialogs.QuestionDialog");S.a.createTrackedDialog("No Consent Dialog","",n,{title:Object(P.a)("Terms and Conditions"),description:d.a.createElement("div",null,d.a.createElement("p",null," ",Object(P.a)("To continue using the %(homeserverDomain)s homeserver you must review and agree to our terms and conditions.",{homeserverDomain:e.getDomain()}))),button:Object(P.a)("Review terms and conditions"),cancelButton:Object(P.a)("Dismiss"),onFinished:e=>{if(e){window.open(a,"_blank").opener=null}}},null,!0)}));const t=new f.a((e,t)=>{p.a.trackEvent("E2E","Decryption failure",t,e),g.a.instance.track("decryption_failure",{errorCode:t},null,{sum:e})},e=>{switch(e){case"MEGOLM_UNKNOWN_INBOUND_SESSION_ID":return"olm_keys_not_sent_error";case"OLM_UNKNOWN_MESSAGE_INDEX":return"olm_index_error";case void 0:return"unexpected_error";default:return"unspecified_error"}});t.start(),e.on("Session.logged_out",()=>t.stop()),e.on("Event.decrypted",(e,a)=>t.eventDecrypted(e,a)),e.on("Room",e=>{if(v.a.get().isCryptoEnabled()){const t=N.b.getValueAt(J.a.ROOM_DEVICE,"blacklistUnverifiedDevices",e.roomId,!0);e.setBlacklistUnverifiedDevices(t)}}),e.on("crypto.warning",e=>{switch(e){case"CRYPTO_WARNING_OLD_VERSION_DETECTED":S.a.createTrackedDialog("Crypto migrated","",Y.a,{title:Object(P.a)("Old cryptography data detected"),description:Object(P.a)("Data from an older version of %(brand)s has been detected. This will have caused end-to-end cryptography to malfunction in the older version. End-to-end encrypted messages exchanged recently whilst using the older version may not be decryptable in this version. This may also cause messages exchanged with this version to fail. If you experience problems, log out and back in again. To retain message history, export and re-import your keys.",{brand:y.a.get().brand})})}}),e.on("crypto.keyBackupFailed",async e=>{let t,n;if(v.a.get().getKeyBackupEnabled())t=!0;else try{n=await v.a.get().getKeyBackupVersion(),null!==n&&(t=!0)}catch(e){return void console.error("Saw key backup error but failed to check backup version!",e)}t?S.a.createTrackedDialogAsync("New Recovery Method","New Recovery Method",a.e(6).then(a.bind(null,8459)),{newVersionInfo:n}):S.a.createTrackedDialogAsync("Recovery Method Removed","Recovery Method Removed",a.e(7).then(a.bind(null,8460)))}),e.on("crypto.keySignatureUploadFailure",(e,t,a)=>{const n=w.getComponent("views.dialogs.KeySignatureUploadFailedDialog");S.a.createTrackedDialog("Failed to upload key signatures","Failed to upload key signatures",n,{failures:e,source:t,continuation:a})}),e.on("crypto.verification.request",e=>{if(e.verifier){const t=w.getComponent("views.dialogs.IncomingSasDialog");S.a.createTrackedDialog("Incoming Verification","",t,{verifier:e.verifier},null,!1,!0)}else e.pending&&z.a.sharedInstance().addOrReplaceToast({key:"verifreq_"+e.channel.transactionId,title:Object(P.a)("Verification requested"),icon:"verification",props:{request:e},component:w.getComponent("toasts.VerificationRequestToast"),priority:90})});const n=N.b.getValue("roomColor");C.a.tint(n.primary_color,n.secondary_color)}onClientStarted(){const e=v.a.get();if(e.isCryptoEnabled()){const t=N.b.getValueAt(J.a.DEVICE,"blacklistUnverifiedDevices");e.setGlobalBlacklistUnverifiedDevices(t),e.setGlobalErrorOnUnknownDevices(!1)}}showScreen(e,t){const a=v.a.get();if(!a||a.isGuest()||!fe.includes(e))if("register"===e)E.a.dispatch({action:"start_registration",params:t}),de.b.instance.start(de.a.REGISTER);else if("login"===e)E.a.dispatch({action:"start_login",params:t}),de.b.instance.start(de.a.LOGIN);else if("forgot_password"===e)E.a.dispatch({action:"start_password_recovery",params:t});else if("soft_logout"===e)a.getUserId()&&!k.h()?this.viewLastRoom():E.a.dispatch({action:"start_login",params:t});else if("new"===e)E.a.dispatch({action:"view_create_room"});else if("settings"===e)E.a.fire(H.a.ViewUserSettings);else if("welcome"===e)E.a.dispatch({action:"view_welcome_page"});else if("listpage"===e)E.a.dispatch({action:"view_list_page"});else if("Patient"===e)E.a.dispatch({action:"view_list_patient"});else if("home"===e)E.a.dispatch({action:"view_home_page"});else if("start"===e)this.showScreen("home"),E.a.dispatch({action:"require_registration"});else if("directory"===e)this.state.view===ge.WELCOME&&g.a.instance.track("onboarding_room_directory"),E.a.fire(H.a.ViewRoomDirectory);else if("start_sso"===e||"start_cas"===e){let t=v.a.get();if(!t){const{hsUrl:e,isUrl:a}=this.props.serverConfig;t=Object(m.createClient)({baseUrl:e,idBaseUrl:a})}const a="start_sso"===e?"sso":"cas";b.a.get().startSingleSignOn(t,a,this.getFragmentAfterLogin())}else if("groups"===e){if(N.b.getValue("feature_spaces"))return void E.a.dispatch({action:"view_home_page"});E.a.dispatch({action:"view_my_groups"})}else if(0===e.indexOf("room/")){var n,s,i;const a=e.substring(5),o=a.indexOf(":")+1;let r=a.length;a.substring(o).indexOf("/")>-1&&(r=o+a.substring(o).indexOf("/"));const l=a.substring(0,r);let c,d=a.substring(r+1);if(d||(d=void 0),t.signurl&&t.email&&(c=Z.a.instance.storeInvite(l,t)),!c){c=Z.a.instance.getInvites().find(e=>e.roomId===l)}let m=[];t.via&&(m="string"==typeof t.via?[t.via]:t.via);const u={action:"view_room",event_id:d,via_servers:m,highlighted:Boolean(d),threepid_invite:c,oob_data:{name:null===(n=c)||void 0===n?void 0:n.roomName,avatarUrl:null===(s=c)||void 0===s?void 0:s.roomAvatarUrl,inviterName:null===(i=c)||void 0===i?void 0:i.inviterName},room_alias:void 0,room_id:void 0};"#"===l[0]?u.room_alias=l:u.room_id=l,E.a.dispatch(u)}else if(0===e.indexOf("user/")){const a=e.substring(5);E.a.dispatch({action:"view_user_info",userId:a,subAction:t.action})}else if(0===e.indexOf("group/")){if(N.b.getValue("feature_spaces"))return void E.a.dispatch({action:"view_home_page"});const t=e.substring(6);E.a.dispatch({action:"view_group",group_id:t})}else console.info("Ignoring showScreen for '%s'",e);else E.a.dispatch({action:"view_home_page"})}notifyNewScreen(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.props.onNewScreen&&this.props.onNewScreen(e,t),this.setPageSubtitle()}onAliasClick(e,t){e.preventDefault(),E.a.dispatch({action:"view_room",room_alias:t})}onUserClick(e,t){e.preventDefault();const a=new h.a(null,t);a&&E.a.dispatch({action:H.a.ViewUser,member:a})}onGroupClick(e,t){e.preventDefault(),E.a.dispatch({action:"view_group",group_id:t})}onLogoutClick(e){E.a.dispatch({action:"logout"}),e.stopPropagation(),e.preventDefault()}dispatchTimelineResize(){E.a.dispatch({action:"timeline_resize"})}onRoomCreated(e){E.a.dispatch({action:"view_room",room_id:e})}onRegistered(e){return k.l(e)}onSendEvent(e,t){const a=v.a.get();a?a.sendEvent(e,t.getType(),t.getContent()).then(()=>{E.a.dispatch({action:"message_sent"})},e=>{E.a.dispatch({action:"message_send_failed"})}):E.a.dispatch({action:"message_send_failed"})}setPageSubtitle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.state.currentRoomId){const t=v.a.get(),a=t&&t.getRoom(this.state.currentRoomId);a&&(e=`${this.subTitleStatus} | ${a.name} ${e}`)}else e=`${this.subTitleStatus} ${e}`;const t=`${y.a.get().brand} ${e}`;document.title!==t&&(document.title=t)}updateStatusIndicator(e,t){const a=$.a.instance.globalState.numUnreadStates;b.a.get()&&(b.a.get().setErrorStatus("ERROR"===e),b.a.get().setNotificationCount(a)),this.subTitleStatus="","ERROR"===e&&(this.subTitleStatus+=`[${Object(P.a)("Offline")}] `),a>0&&(this.subTitleStatus+=`[${a}]`),this.setPageSubtitle()}onCloseAllSettings(){E.a.dispatch({action:"close_settings"})}getFragmentAfterLogin(){let e="";const t=this.props.initialScreenAfterLogin;return t&&!["welcome","login","register","start_sso","start_cas"].includes(t.screen)&&(e="/"+t.screen),e}render(){const e=this.getFragmentAfterLogin();let t=null;if(this.state.view===ge.LOADING){const e=w.getComponent("elements.Spinner");t=d.a.createElement("div",{className:"mx_MatrixChat_splash"},d.a.createElement(e,null))}else if(this.state.view===ge.COMPLETE_SECURITY){const e=w.getComponent("structures.auth.CompleteSecurity");t=d.a.createElement(e,{onFinished:this.onCompleteSecurityE2eSetupFinished})}else if(this.state.view===ge.E2E_SETUP){const e=w.getComponent("structures.auth.E2eSetup");t=d.a.createElement(e,{onFinished:this.onCompleteSecurityE2eSetupFinished,accountPassword:this.accountPassword,tokenLogin:!!this.tokenLogin})}else if(this.state.view===ge.LOGGED_IN){const e=this.state.syncError&&this.state.syncError instanceof u.b;if(this.state.ready&&this.state.page_type&&!e){const e=w.getComponent("structures.LoggedInView");t=d.a.createElement(e,o()({},this.props,this.state,{ref:this.loggedInView,matrixClient:v.a.get(),onRoomCreated:this.onRoomCreated,onCloseAllSettings:this.onCloseAllSettings,onRegistered:this.onRegistered,currentRoomId:this.state.currentRoomId}))}else{const a=w.getComponent("elements.Spinner");let n;this.state.syncError&&!e&&(n=d.a.createElement("div",{className:"mx_MatrixChat_syncError"},Object(A.b)(this.state.syncError))),t=d.a.createElement("div",{className:"mx_MatrixChat_splash"},n,d.a.createElement(a,null),d.a.createElement("a",{href:"#",className:"mx_MatrixChat_splashButtons",onClick:this.onLogoutClick},Object(P.a)("Logout")))}}else if(this.state.view===ge.WELCOME){const e=w.getComponent("auth.Welcome");t=d.a.createElement(e,null)}else if(this.state.view===ge.REGISTER&&N.b.getValue(ee.a.Registration)){var a;const n=w.getComponent("structures.auth.Registration"),s=null===(a=Z.a.instance.pickBestInvite())||void 0===a?void 0:a.toEmail;t=d.a.createElement(n,o()({clientSecret:this.state.register_client_secret,sessionId:this.state.register_session_id,idSid:this.state.register_id_sid,email:s,brand:this.props.config.brand,makeRegistrationUrl:this.makeRegistrationUrl,onLoggedIn:this.onRegisterFlowComplete,onLoginClick:this.onLoginClick,onServerConfigChange:this.onServerConfigChange,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,fragmentAfterLogin:e},this.getServerProperties()))}else if(this.state.view===ge.FORGOT_PASSWORD&&N.b.getValue(ee.a.PasswordReset)){const e=w.getComponent("structures.auth.ForgotPassword");t=d.a.createElement(e,o()({onComplete:this.onLoginClick,onLoginClick:this.onLoginClick,onServerConfigChange:this.onServerConfigChange},this.getServerProperties()))}else if(this.state.view===ge.LOGIN){const a=N.b.getValue(ee.a.PasswordReset),n=w.getComponent("structures.auth.Login");t=d.a.createElement(n,o()({isSyncing:this.state.pendingInitialSync,onLoggedIn:this.onUserCompletedLoginFlow,onRegisterClick:this.onRegisterClick,fallbackHsUrl:this.getFallbackHsUrl(),defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,onForgotPasswordClick:a?this.onForgotPasswordClick:void 0,onServerConfigChange:this.onServerConfigChange,fragmentAfterLogin:e,defaultUsername:this.props.startingFragmentQueryParams.defaultUsername},this.getServerProperties()))}else if(this.state.view===ge.SOFT_LOGOUT){const a=w.getComponent("structures.auth.SoftLogout");t=d.a.createElement(a,{realQueryParams:this.props.realQueryParams,onTokenLoginCompleted:this.props.onTokenLoginCompleted,fragmentAfterLogin:e})}else console.error("Unknown view "+this.state.view);const n=w.getComponent("elements.ErrorBoundary");return d.a.createElement(n,null,t)}},l()(s,"displayName","MatrixChat"),l()(s,"defaultProps",{realQueryParams:{},startingFragmentQueryParams:{},config:{},onTokenLoginCompleted:()=>{}}),n=s))||n;function ye(){const e=window.matrixChat;return e&&e.state.view===ge.LOGGED_IN}},138:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i);class r extends o.a.Component{constructor(){super(...arguments),s()(this,"containerRef",o.a.createRef())}componentDidMount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){return o.a.createElement("div",{ref:this.containerRef,style:this.props.style,className:["mx_AutoHideScrollbar",this.props.className].join(" "),onWheel:this.props.onWheel,tabIndex:this.props.tabIndex},this.props.children)}}},1382:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(19),s=a.n(n);function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class r{constructor(e,t){this.failedEventId=e,this.errorCode=t,this.ts=Date.now()}}class l{constructor(e,t){if(s()(this,"failures",[]),s()(this,"failureCounts",{}),s()(this,"trackedEventHashMap",{}),s()(this,"checkInterval",null),s()(this,"trackInterval",null),!e||"function"!=typeof e)throw new Error("DecryptionFailureTracker requires tracking function");if(t&&"function"!=typeof t)throw new Error("DecryptionFailureTracker second constructor argument should be a function");this._trackDecryptionFailure=e,this._mapErrorCode=t}eventDecrypted(e,t){t?this.addDecryptionFailure(new r(e.getId(),t.code)):this.removeDecryptionFailuresForEvent(e)}addDecryptionFailure(e){this.failures.push(e)}removeDecryptionFailuresForEvent(e){this.failures=this.failures.filter(t=>t.failedEventId!==e.getId())}start(){this.checkInterval=setInterval(()=>this.checkFailures(Date.now()),l.CHECK_INTERVAL_MS),this.trackInterval=setInterval(()=>this.trackFailures(),l.TRACK_INTERVAL_MS)}stop(){clearInterval(this.checkInterval),clearInterval(this.trackInterval),this.failures=[],this.failureCounts={}}checkFailures(e){const t=[],a=[];for(;this.failures.length>0;){const n=this.failures.shift();e>n.ts+l.GRACE_PERIOD_MS?t.push(n):a.push(n)}this.failures=a;const n=t.reduce((e,t)=>this.trackedEventHashMap[t.failedEventId]?e:e.set(t.failedEventId,t),new Map),s=[...n.keys()];this.trackedEventHashMap=s.reduce((e,t)=>o(o({},e),{},{[t]:!0}),this.trackedEventHashMap);const i=n.values();this._aggregateFailures(i)}_aggregateFailures(e){for(const t of e){const e=t.errorCode;this.failureCounts[e]=(this.failureCounts[e]||0)+1}}trackFailures(){for(const e of Object.keys(this.failureCounts))if(this.failureCounts[e]>0){const t=this._mapErrorCode?this._mapErrorCode(e):e;this._trackDecryptionFailure(this.failureCounts[e],t),this.failureCounts[e]=0}}}s()(l,"TRACK_INTERVAL_MS",6e4),s()(l,"CHECK_INTERVAL_MS",5e3),s()(l,"GRACE_PERIOD_MS",6e4)},1383:function(e,t,a){"use strict";var n=a(100),s=a(569);const i={deferred_action:null};class o extends s.Store{constructor(){super(n.a),this._state=i}_setState(e){this._state=Object.assign(this._state,e),this.__emitChange()}__onDispatch(e){switch(e.action){case"do_after_sync_prepared":this._setState({deferred_action:e.deferred_action});break;case"cancel_after_sync_prepared":this._setState({deferred_action:null});break;case"sync_state":{if("PREPARED"!==e.state)break;if(!this._state.deferred_action)break;const t=Object.assign({},this._state.deferred_action);this._setState({deferred_action:null}),n.a.dispatch(t);break}case"on_client_not_viable":case"on_logged_out":this.reset()}}reset(){this._state=Object.assign({},i)}}let r=null;r||(r=new o)},1384:function(e,t,a){"use strict";t.a={HomePage:"home_page",ListPage:"list_page",RoomView:"room_view",RoomDirectory:"room_directory",UserView:"user_view",GroupView:"group_view",MyGroups:"my_groups"}},1385:function(e,t,a){"use strict";a.d(t,"b",(function(){return g})),a.d(t,"a",(function(){return f}));var n=a(88),s=a.n(n),i=a(93),o=a(110),r=a(100),l=a(181),c=a(108),d=a(268),m=a(217);const u=()=>{r.a.dispatch({action:"accept_cookies"})},h=()=>{r.a.dispatch({action:"reject_cookies"})},p=()=>{l.a.showDetailsModal()},g=e=>{const t=o.a.get().brand;m.a.sharedInstance().addOrReplaceToast({key:"analytics",title:Object(i.a)("Help us improve %(brand)s",{brand:t}),props:{description:Object(i.a)("Send <UsageDataLink>anonymous usage data</UsageDataLink> which helps us improve %(brand)s. This will use a <PolicyLink>cookie</PolicyLink>.",{brand:t},{UsageDataLink:e=>s.a.createElement(c.a,{kind:"link",onClick:p},e),PolicyLink:t=>e?s.a.createElement("a",{target:"_blank",href:e},t):t}),acceptLabel:Object(i.a)("Yes"),onAccept:u,rejectLabel:Object(i.a)("No"),onReject:h},component:d.a,className:"mx_AnalyticsToast",priority:10})},f=()=>{m.a.sharedInstance().dismissToast("analytics")}},1386:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(93),s=a(268),i=a(217);const o=()=>{window.location.href="mobile_guide/"},r=()=>{document.cookie="element_mobile_redirect_to_guide=false;path=/;max-age=14400",c()},l=()=>{const e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,t=/Android/.test(navigator.userAgent);(e||t)&&(document.cookie.includes("element_mobile_redirect_to_guide=false")||i.a.sharedInstance().addOrReplaceToast({key:"mobileguide",title:Object(n.a)("Use app for a better experience"),props:{description:Object(n.a)("Element Web is experimental on mobile. For a better experience and the latest features, use our free native app."),acceptLabel:Object(n.a)("Use app"),onAccept:o,rejectLabel:Object(n.a)("Dismiss"),onReject:r},component:s.a,priority:99}))},c=()=>{i.a.sharedInstance().dismissToast("mobileguide")}},1387:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(88),s=a.n(n),i=a(92),o=a.n(i),r=a(97),l=a(515),c=a.n(l),d=a(93);const m=["vector-im/element-web","matrix-org/matrix-react-sdk","matrix-org/matrix-js-sdk"];class u extends s.a.Component{constructor(e){super(e),this.state={}}componentDidMount(){const e=this.props.newVersion.split("-"),t=this.props.version.split("-");if(null!=e&&null!=t)for(let a=0;a<m.length;a++){const n=t[2*a],s=e[2*a],i=`https://riot.im/github/repos/${m[a]}/compare/${n}...${s}`;c()(i,(e,t,n)=>{t.statusCode<200||t.statusCode>=300?this.setState({[m[a]]:t.statusText}):this.setState({[m[a]]:JSON.parse(n).commits})})}}_elementsForCommit(e){return s.a.createElement("li",{key:e.sha,className:"mx_ChangelogDialog_li"},s.a.createElement("a",{href:e.html_url,target:"_blank",rel:"noreferrer noopener"},e.commit.message.split("\n")[0]))}render(){const e=r.getComponent("views.elements.Spinner"),t=r.getComponent("dialogs.QuestionDialog"),a=m.map(t=>{let a;return a=null==this.state[t]?s.a.createElement(e,{key:t}):"string"==typeof this.state[t]?Object(d.a)("Unable to load commit detail: %(msg)s",{msg:this.state[t]}):this.state[t].map(this._elementsForCommit),s.a.createElement("div",{key:t},s.a.createElement("h2",null,t),s.a.createElement("ul",null,a))}),n=s.a.createElement("div",{className:"mx_ChangelogDialog_content"},null==this.props.version||null==this.props.newVersion?s.a.createElement("h2",null,Object(d.a)("Unavailable")):a);return s.a.createElement(t,{title:Object(d.a)("Changelog"),description:n,button:Object(d.a)("Update"),onFinished:this.props.onFinished})}}u.propTypes={version:o.a.string.isRequired,newVersion:o.a.string.isRequired,onFinished:o.a.func.isRequired}},1388:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(330);async function s(e,t){const a=e.getUserId();let{threepids:s}=await e.getThreePids();if(t&&(s=s.filter(e=>e.medium===t)),s.length>0&&e.getIdentityServerUrl())try{const i=new n.a,o=await i.getAccessToken({check:!1}),r=s.map(e=>{let{medium:t,address:a}=e;return[t,a]}),l=await e.bulkLookupThreePids(r,o);for(const[e,n,i]of l.threepids){if(i!==a)continue;if(t&&e!==t)continue;const o=s.find(t=>t.medium===e&&t.address===n);o&&(o.bound=!0)}}catch(e){if("M_TERMS_NOT_SIGNED"!==e.errcode)throw e}return s}},1389:function(e,t){e.exports="img/feather-customised/warning-triangle.d95b363.svg"},1390:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(92),d=a.n(c),m=a(103),u=a(281),h=a(97),p=a(123),g=a(94),f=a(110),v=a(505);class b extends r.a.Component{constructor(){super(...arguments),i()(this,"_onChange",async e=>{await m.b.setValue(this.props.featureId,null,p.a.DEVICE,e),this.forceUpdate()})}render(){const e=m.b.getDisplayName(this.props.featureId),t=m.b.getValue(this.props.featureId),a=m.b.canSetValue(this.props.featureId,null,p.a.DEVICE);return r.a.createElement(u.a,{value:t,label:e,onChange:this._onChange,disabled:!a})}}i()(b,"propTypes",{featureId:d.a.string.isRequired});let y=Object(g.a)("views.settings.tabs.user.LabsUserSettingsTab")(n=class extends r.a.Component{constructor(){super()}render(){const e=m.b.getFeatureSettingNames(),[t,a]=e.reduce((e,t)=>(e[m.b.getBetaInfo(t)?1:0].push(t),e),[[],[]]);let n,s;if(a.length&&(n=r.a.createElement("div",{className:"mx_SettingsTab_section"},a.map(e=>r.a.createElement(v.b,{key:e,featureId:e})))),f.a.get().showLabsSettings){const e=h.getComponent("views.elements.SettingsFlag"),a=t.map(e=>r.a.createElement(b,{featureId:e,key:e}));s=r.a.createElement("div",{className:"mx_SettingsTab_section"},a,r.a.createElement(e,{name:"enableWidgetScreenshots",level:p.a.ACCOUNT}),r.a.createElement(e,{name:"showHiddenEventsInTimeline",level:p.a.DEVICE}),r.a.createElement(e,{name:"lowBandwidth",level:p.a.DEVICE}),r.a.createElement(e,{name:"advancedRoomListLogging",level:p.a.DEVICE}))}return r.a.createElement("div",{className:"mx_SettingsTab mx_LabsUserSettingsTab"},r.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(l.a)("Labs")),r.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(l.a)("Feeling experimental? Labs are the best way to get things early, test out new features and help shape them before they actually launch. <a>Learn more</a>.",{},{a:e=>r.a.createElement("a",{href:"https://github.com/vector-im/element-web/blob/develop/docs/labs.md",rel:"noreferrer noopener",target:"_blank"},e)})),n,s)}})||n},1397:function(e,t,a){"use strict";a.d(t,"a",(function(){return P}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(110),d=a(99),m=a(103),u=a(335),h=a(494),p=a(1398),g=a(108),f=a(100),v=a(824),b=a(115),y=a(228),E=a(1399),_=a(144),S=a(1400),C=a(598),w=a(123),O=a(147),x=a(245),R=a(94),k=a(226);function I(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function T(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?I(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):I(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let P=Object(R.a)("views.settings.tabs.user.AppearanceUserSettingsTab")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"MESSAGE_PREVIEW_TEXT",Object(l.a)("Hey you. You're the best!")),i()(this,"themeTimer",void 0),i()(this,"onThemeChange",e=>{if(this.state.theme===e)return;const t=m.b.getValue("theme");m.b.setValue("theme",null,w.a.DEVICE,e).catch(()=>{f.a.dispatch({action:b.a.RecheckTheme}),this.setState({theme:t})}),this.setState({theme:e}),f.a.dispatch({action:b.a.RecheckTheme,forceTheme:e})}),i()(this,"onUseSystemThemeChanged",e=>{this.setState({useSystemTheme:e}),m.b.setValue("use_system_theme",null,w.a.DEVICE,e),f.a.dispatch({action:b.a.RecheckTheme})}),i()(this,"onFontSizeChanged",e=>{this.setState({fontSize:e.toString()}),m.b.setValue("baseFontSize",null,w.a.DEVICE,e-v.a.SIZE_DIFF)}),i()(this,"onValidateFontSize",async e=>{let{value:t}=e;const a=parseFloat(t),n=v.a.MIN_SIZE+v.a.SIZE_DIFF,s=v.a.MAX_SIZE+v.a.SIZE_DIFF;return isNaN(a)?{valid:!1,feedback:Object(l.a)("Size must be a number")}:n<=a&&a<=s?(m.b.setValue("baseFontSize",null,w.a.DEVICE,parseInt(t,10)-v.a.SIZE_DIFF),{valid:!0,feedback:Object(l.a)("Use between %(min)s pt and %(max)s pt",{min:n,max:s})}):{valid:!1,feedback:Object(l.a)("Custom font size can only be between %(min)s pt and %(max)s pt",{min:n,max:s})}}),i()(this,"onAddCustomTheme",async()=>{let e=m.b.getValue("custom_themes");e||(e=[]),e=e.map(e=>e),this.themeTimer&&clearTimeout(this.themeTimer);try{const t=await fetch(this.state.customThemeUrl),a=await t.json();if(!a||"string"!=typeof a.name||"object"!=typeof a.colors)return void this.setState({customThemeMessage:{text:Object(l.a)("Invalid theme schema."),isError:!0}});e.push(a)}catch(e){return console.error(e),void this.setState({customThemeMessage:{text:Object(l.a)("Error downloading theme information."),isError:!0}})}await m.b.setValue("custom_themes",null,w.a.ACCOUNT,e),this.setState({customThemeUrl:"",customThemeMessage:{text:Object(l.a)("Theme added!"),isError:!1}}),this.themeTimer=setTimeout(()=>{this.setState({customThemeMessage:{text:"",isError:!1}})},3e3)}),i()(this,"onCustomThemeChange",e=>{this.setState({customThemeUrl:e.target.value})}),i()(this,"onIRCLayoutChange",e=>{e?(this.setState({layout:x.a.IRC}),m.b.setValue("layout",null,w.a.DEVICE,x.a.IRC)):(this.setState({layout:x.a.Group}),m.b.setValue("layout",null,w.a.DEVICE,x.a.Group))}),this.state=T(T({fontSize:(m.b.getValue("baseFontSize",null)+v.a.SIZE_DIFF).toString()},this.calculateThemeState()),{},{customThemeUrl:"",customThemeMessage:{isError:!1,text:""},useCustomFontSize:m.b.getValue("useCustomFontSize"),useSystemFont:m.b.getValue("useSystemFont"),systemFont:m.b.getValue("systemFont"),showAdvanced:!1,layout:m.b.getValue("layout"),userId:"@erim:fink.fink",displayName:"Erimayas Fink",avatarUrl:null})}async componentDidMount(){const e=d.a.get(),t=e.getUserId(),a=await e.getProfileInfo(t);this.setState({userId:t,displayName:a.displayname,avatarUrl:a.avatar_url})}calculateThemeState(){const e=m.b.getValue("theme"),t=m.b.getValueAt(w.a.DEVICE,"use_system_theme",null,!1,!0),a=m.b.getValueAt(w.a.DEVICE,"theme",null,!1,!0);return t?{theme:e,useSystemTheme:!0}:a?{theme:e,useSystemTheme:!1}:{theme:e,useSystemTheme:m.b.getValueAt(w.a.DEVICE,"use_system_theme")}}renderThemeSection(){let e,t;if((new h.a).isSystemThemeSupported()&&(e=r.a.createElement("div",null,r.a.createElement(y.a,{checked:this.state.useSystemTheme,onChange:e=>this.onUseSystemThemeChanged(e.target.checked)},m.b.getDisplayName("use_system_theme")))),m.b.getValue("feature_custom_themes")){let e=null;this.state.customThemeMessage.text&&(e=this.state.customThemeMessage.isError?r.a.createElement("div",{className:"text-error"},this.state.customThemeMessage.text):r.a.createElement("div",{className:"text-success"},this.state.customThemeMessage.text)),t=r.a.createElement("div",{className:"mx_SettingsTab_section"},r.a.createElement("form",{onSubmit:this.onAddCustomTheme},r.a.createElement(_.a,{label:Object(l.a)("Custom theme URL"),type:"text",id:"mx_GeneralUserSettingsTab_customThemeInput",autoComplete:"off",onChange:this.onCustomThemeChange,value:this.state.customThemeUrl}),r.a.createElement(g.a,{onClick:this.onAddCustomTheme,type:"submit",kind:"primary_sm",disabled:!this.state.customThemeUrl.trim()},Object(l.a)("Add theme")),e))}const a=Object.entries(Object(u.b)()).map(e=>({id:e[0],name:e[1]})),n=a.filter(e=>!e.id.startsWith("custom-")),s=a.filter(e=>!n.includes(e)).sort((e,t)=>Object(k.a)(e.name,t.name)),i=[...n,...s];return r.a.createElement("div",{className:"mx_SettingsTab_section mx_AppearanceUserSettingsTab_themeSection"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Theme")),e,r.a.createElement("div",{className:"mx_ThemeSelectors"},r.a.createElement(C.a,{name:"theme",definitions:i.map(e=>({value:e.id,label:e.name,disabled:this.state.useSystemTheme,className:"mx_ThemeSelector_"+e.id})),onChange:this.onThemeChange,value:this.state.useSystemTheme?void 0:this.state.theme,outlined:!0})),t)}renderFontSection(){return r.a.createElement("div",{className:"mx_SettingsTab_section mx_AppearanceUserSettingsTab_fontScaling"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Font size")),r.a.createElement(S.a,{className:"mx_AppearanceUserSettingsTab_fontSlider_preview",message:this.MESSAGE_PREVIEW_TEXT,layout:this.state.layout,userId:this.state.userId,displayName:this.state.displayName,avatarUrl:this.state.avatarUrl}),r.a.createElement("div",{className:"mx_AppearanceUserSettingsTab_fontSlider"},r.a.createElement("div",{className:"mx_AppearanceUserSettingsTab_fontSlider_smallText"},"Aa"),r.a.createElement(p.a,{values:[13,14,15,16,18],value:parseInt(this.state.fontSize,10),onSelectionChange:this.onFontSizeChanged,displayFunc:e=>"",disabled:this.state.useCustomFontSize}),r.a.createElement("div",{className:"mx_AppearanceUserSettingsTab_fontSlider_largeText"},"Aa")),r.a.createElement(E.a,{name:"useCustomFontSize",level:w.a.ACCOUNT,onChange:e=>this.setState({useCustomFontSize:e}),useCheckbox:!0}),r.a.createElement(_.a,{type:"number",label:Object(l.a)("Font size"),autoComplete:"off",placeholder:this.state.fontSize.toString(),value:this.state.fontSize.toString(),id:"font_size_field",onValidate:this.onValidateFontSize,onChange:e=>this.setState({fontSize:e.target.value}),disabled:!this.state.useCustomFontSize,className:"mx_SettingsTab_customFontSizeField"}))}renderAdvancedSection(){if(!m.b.getValue(O.a.AdvancedSettings))return null;const e=c.a.get().brand,t=r.a.createElement("div",{className:"mx_AppearanceUserSettingsTab_AdvancedToggle",onClick:()=>this.setState({showAdvanced:!this.state.showAdvanced})},this.state.showAdvanced?Object(l.a)("Hide advanced"):Object(l.a)("Show advanced"));let a;if(this.state.showAdvanced){const t=Object(l.a)("Set the name of a font installed on your system & %(brand)s will attempt to use it.",{brand:e});a=r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{name:"useCompactLayout",level:w.a.DEVICE,useCheckbox:!0,disabled:this.state.layout==x.a.IRC}),r.a.createElement(y.a,{checked:this.state.layout==x.a.IRC,onChange:e=>this.onIRCLayoutChange(e.target.checked)},Object(l.a)("Enable experimental, compact IRC style layout")),r.a.createElement(E.a,{name:"useSystemFont",level:w.a.DEVICE,useCheckbox:!0,onChange:e=>this.setState({useSystemFont:e})}),r.a.createElement(_.a,{className:"mx_AppearanceUserSettingsTab_systemFont",label:m.b.getDisplayName("systemFont"),onChange:e=>{this.setState({systemFont:e.target.value}),m.b.setValue("systemFont",null,w.a.DEVICE,e.target.value)},tooltipContent:t,forceTooltipVisible:!0,disabled:!this.state.useSystemFont,value:this.state.systemFont}))}return r.a.createElement("div",{className:"mx_SettingsTab_section mx_AppearanceUserSettingsTab_Advanced"},t,a)}render(){const e=c.a.get().brand;return r.a.createElement("div",{className:"mx_SettingsTab mx_AppearanceUserSettingsTab"},r.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(l.a)("Customise your appearance")),r.a.createElement("div",{className:"mx_SettingsTab_SubHeading"},Object(l.a)("Appearance Settings only affect this %(brand)s session.",{brand:e})),this.renderThemeSection(),this.renderFontSection(),this.renderAdvancedSection())}})||n},1398:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n,s=a(88),i=a(94);let o=Object(i.a)("views.elements.Slider")(n=class extends s.Component{offset(e,t){const a=e.reduce((e,a)=>t>a?e+1:e,0);if(0===a)return 0;if(a===e.length)return 100;const n=e[a-1],s=e[a],i=1/(e.length-1);return 100*(a-1+(t-n)/(s-n))*i}render(){const e=this.props.values.map(e=>s.createElement(r,{active:e<=this.props.value,label:this.props.displayFunc(e),onClick:this.props.disabled?()=>{}:()=>this.props.onSelectionChange(e),key:e,disabled:this.props.disabled}));let t=null;if(!this.props.disabled){const e=this.offset(this.props.values,this.props.value);t=s.createElement("div",{className:"mx_Slider_selection"},s.createElement("div",{className:"mx_Slider_selectionDot",style:{left:"calc(-0.55em + "+e+"%)"}}),s.createElement("hr",{style:{width:e+"%"}}))}return s.createElement("div",{className:"mx_Slider"},s.createElement("div",null,s.createElement("div",{className:"mx_Slider_bar"},s.createElement("hr",{onClick:this.props.disabled?()=>{}:this.onClick.bind(this)}),t),s.createElement("div",{className:"mx_Slider_dotContainer"},e)))}onClick(e){const t=e.target.clientWidth,a=e.nativeEvent.offsetX/t,n=this.props.values[Math.round(a*(this.props.values.length-1))];this.props.onSelectionChange(n)}})||n;class r extends s.PureComponent{render(){let e="mx_Slider_dot";return!this.props.disabled&&this.props.active&&(e+=" mx_Slider_dotActive"),s.createElement("span",{onClick:this.props.onClick,className:"mx_Slider_dotValue"},s.createElement("div",{className:e}),s.createElement("div",{className:"mx_Slider_labelContainer"},s.createElement("div",{className:"mx_Slider_label"},this.props.label)))}}},1399:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(103),c=a(93),d=a(496),m=a(228),u=a(94);let h=Object(u.a)("views.elements.SettingsFlag")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"onChange",async e=>{await this.save(e),this.setState({value:e}),this.props.onChange&&this.props.onChange(e)}),i()(this,"checkBoxOnChange",e=>{this.onChange(e.target.checked)}),i()(this,"save",async e=>{await l.b.setValue(this.props.name,this.props.roomId,this.props.level,void 0!==e?e:this.state.value)}),this.state={value:l.b.getValueAt(this.props.level,this.props.name,this.props.roomId,this.props.isExplicit)}}render(){const e=l.b.canSetValue(this.props.name,this.props.roomId,this.props.level);let t=this.props.label;return t=t?Object(c.a)(t):l.b.getDisplayName(this.props.name,this.props.level),this.props.useCheckbox?r.a.createElement(m.a,{checked:this.state.value,onChange:this.checkBoxOnChange,disabled:this.props.disabled||!e},t):r.a.createElement("div",{className:"mx_SettingsFlag"},r.a.createElement("span",{className:"mx_SettingsFlag_label"},t),r.a.createElement(d.a,{checked:this.state.value,onChange:this.onChange,disabled:this.props.disabled||!e,"aria-label":t}))}})||n},140:function(e,t,a){"use strict";let n,s;a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return o})),function(e){e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomAliases="m.room.aliases",e.SpaceChild="m.space.child",e.SpaceParent="m.space.parent",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.CallReplaces="m.call.replaces",e.CallAssertedIdentity="m.call.asserted_identity",e.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.KeyVerificationDone="m.key.verification.done",e.RoomMessageFeedback="m.room.message.feedback",e.Reaction="m.reaction",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy"}(n||(n={})),function(e){e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video"}(s||(s={}));const i="type";let o;!function(e){e.Space="m.space"}(o||(o={}))},1400:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n,s=a(88),i=a.n(s),o=a(102),r=a.n(o),l=a(146),c=a(368),d=a(296),m=a(103),u=a(245),h=a(147),p=a(94);let g=Object(p.a)("views.elements.EventTilePreview")(n=class extends i.a.Component{constructor(e){super(e),this.state={message:e.message}}fakeEvent(e){var t=this;let{message:a}=e;const n={type:"m.room.message",sender:this.props.userId,content:{"m.new_content":{msgtype:"m.text",body:a,displayname:this.props.displayName,avatar_url:this.props.avatarUrl},msgtype:"m.text",body:a,displayname:this.props.displayName,avatar_url:this.props.avatarUrl},unsigned:{age:97},event_id:"$9999999999999999999999999999999999999999999",room_id:"!999999999999999999:example.org"},s=new l.b(n);return s.sender={name:this.props.displayName,userId:this.props.userId,getAvatarUrl:function(){return c.c({avatarUrl:t.props.avatarUrl},32,32,"crop")},getMxcAvatarUrl:()=>this.props.avatarUrl},s}render(){const e=this.fakeEvent(this.state),t=r()(this.props.className,{mx_IRCLayout:this.props.layout==u.a.IRC,mx_GroupLayout:this.props.layout==u.a.Group});return i.a.createElement("div",{className:t},i.a.createElement(d.a,{mxEvent:e,layout:this.props.layout,enableFlair:m.b.getValue(h.a.Flair)}))}})||n},1401:function(e,t,a){"use strict";a.d(t,"a",(function(){return T}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(110),h=a(99),p=a(249),g=a(108),f=a(181),v=a(106),b=a(97),y=a(211),E=a(100),_=a(214),S=a(123),C=a(1402),w=a(103),O=a(147),x=a(1403),R=a(154),k=a(94);class I extends l.a.Component{constructor(){super(...arguments),o()(this,"_onUnignoreClicked",e=>{this.props.onUnignored(this.props.userId)})}render(){const e="mx_SecurityUserSettingsTab_ignoredUser_"+this.props.userId;return l.a.createElement("div",{className:"mx_SecurityUserSettingsTab_ignoredUser"},l.a.createElement(g.a,{onClick:this._onUnignoreClicked,kind:"primary_sm","aria-describedby":e,disabled:this.props.inProgress},Object(m.a)("Unignore")),l.a.createElement("span",{id:e},this.props.userId))}}o()(I,"propTypes",{userId:d.a.string.isRequired,onUnignored:d.a.func.isRequired,inProgress:d.a.bool.isRequired});let T=Object(k.a)("views.settings.tabs.user.SecurityUserSettingsTab")((s=class extends l.a.Component{constructor(){super(),o()(this,"_updateBlacklistDevicesFlag",e=>{h.a.get().setGlobalBlacklistUnverifiedDevices(e)}),o()(this,"_updateAnalytics",e=>{e?f.a.enable():f.a.disable(),R.a.instance.enable(!e)}),o()(this,"_onExportE2eKeysClicked",()=>{v.a.createTrackedDialogAsync("Export E2E Keys","",a.e(4).then(a.bind(null,8461)),{matrixClient:h.a.get()})}),o()(this,"_onImportE2eKeysClicked",()=>{v.a.createTrackedDialogAsync("Import E2E Keys","",a.e(30).then(a.bind(null,8462)),{matrixClient:h.a.get()})}),o()(this,"_onGoToUserProfileClick",()=>{E.a.dispatch({action:"view_user_info",userId:h.a.get().getUserId()}),this.props.closeSettingsFn()}),o()(this,"_onUserUnignored",async e=>{const{ignoredUserIds:t,waitingUnignored:a}=this.state,n=t.filter(e=>!a.includes(e)),s=n.indexOf(e);-1!==s&&(n.splice(s,1),this.setState(t=>{let{waitingUnignored:a}=t;return{waitingUnignored:[...a,e]}}),h.a.get().setIgnoredUsers(n))}),o()(this,"_getInvitedRooms",()=>h.a.get().getRooms().filter(e=>e.hasMembershipState(h.a.get().getUserId(),"invite"))),o()(this,"_manageInvites",async e=>{this.setState({managingInvites:!0});const t=this._getInvitedRooms().map(e=>e.roomId),a=this,n=h.a.get(),s=e?n.joinRoom.bind(n):n.leave.bind(n);for(let e=0;e<t.length;e++){const n=t[e];await s(n).then(()=>{this.setState({invitedRoomAmt:a.state.invitedRoomAmt-1})},async t=>{"M_LIMIT_EXCEEDED"===t.errcode?(await Object(y.c)(t.retry_after_ms||2500),e--):console.warn(t)})}this.setState({managingInvites:!1})}),o()(this,"_onAcceptAllInvitesClicked",e=>{this._manageInvites(!0)}),o()(this,"_onRejectAllInvitesClicked",e=>{this._manageInvites(!1)});const e=this._getInvitedRooms();this.state={ignoredUserIds:h.a.get().getIgnoredUsers(),waitingUnignored:[],managingInvites:!1,invitedRoomAmt:e.length},this._onAction=this._onAction.bind(this)}_onAction(e){let{action:t}=e;if("ignore_state_changed"===t){const e=h.a.get().getIgnoredUsers(),t=this.state.waitingUnignored.filter(t=>e.includes(t));this.setState({ignoredUserIds:e,waitingUnignored:t})}}componentDidMount(){this.dispatcherRef=E.a.register(this._onAction)}componentWillUnmount(){E.a.unregister(this.dispatcherRef)}_renderCurrentDeviceInfo(){const e=b.getComponent("views.elements.SettingsFlag"),t=h.a.get(),a=t.deviceId;let n=t.getDeviceEd25519Key();n=n?p.e(n):Object(m.a)("<not supported>");let s,i=null;return t.isCryptoEnabled()&&(i=l.a.createElement("div",{className:"mx_SecurityUserSettingsTab_importExportButtons"},l.a.createElement(g.a,{kind:"primary",onClick:this._onExportE2eKeysClicked},Object(m.a)("Export E2E room keys")),l.a.createElement(g.a,{kind:"primary",onClick:this._onImportE2eKeysClicked},Object(m.a)("Import E2E room keys")))),w.b.isEnabled("blacklistUnverifiedDevices")&&(s=l.a.createElement(e,{name:"blacklistUnverifiedDevices",level:S.a.DEVICE,onChange:this._updateBlacklistDevicesFlag})),l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(m.a)("Cryptography")),l.a.createElement("ul",{className:"mx_SettingsTab_subsectionText mx_SecurityUserSettingsTab_deviceInfo"},l.a.createElement("li",null,l.a.createElement("label",null,Object(m.a)("Session ID:")),l.a.createElement("span",null,l.a.createElement("code",null,a))),l.a.createElement("li",null,l.a.createElement("label",null,Object(m.a)("Session key:")),l.a.createElement("span",null,l.a.createElement("code",null,l.a.createElement("b",null,n))))),i,s)}_renderIgnoredUsers(){const{waitingUnignored:e,ignoredUserIds:t}=this.state,a=null!=t&&t.length?t.map(t=>l.a.createElement(I,{userId:t,onUnignored:this._onUserUnignored,key:t,inProgress:e.includes(t)})):Object(m.a)("You have no ignored users.");return l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(m.a)("Ignored users")),l.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},a))}_renderManageInvites(){if(0===this.state.invitedRoomAmt)return null;const e=this._getInvitedRooms(),t=b.getComponent("elements.InlineSpinner"),a=this._onAcceptAllInvitesClicked.bind(this,e),n=this._onRejectAllInvitesClicked.bind(this,e);return l.a.createElement("div",{className:"mx_SettingsTab_section mx_SecurityUserSettingsTab_bulkOptions"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(m.a)("Bulk options")),l.a.createElement(g.a,{onClick:a,kind:"primary",disabled:this.state.managingInvites},Object(m.a)("Accept all %(invitedRooms)s invites",{invitedRooms:this.state.invitedRoomAmt})),l.a.createElement(g.a,{onClick:n,kind:"danger",disabled:this.state.managingInvites},Object(m.a)("Reject all %(invitedRooms)s invites",{invitedRooms:this.state.invitedRoomAmt})),this.state.managingInvites?l.a.createElement(t,null):l.a.createElement("div",null))}render(){const e=u.a.get().brand,t=b.getComponent("views.settings.DevicesPanel"),a=b.getComponent("views.elements.SettingsFlag"),n=b.getComponent("views.settings.EventIndexPanel"),s=l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(m.a)("Secure Backup")),l.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},l.a.createElement(C.a,null))),i=l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(m.a)("Message search")),l.a.createElement(n,null)),o=b.getComponent("views.settings.CrossSigningPanel"),r=l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(m.a)("Cross-signing")),l.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},l.a.createElement(o,null)));let c,d;Object(_.h)()||(c=l.a.createElement("div",{className:"mx_SecurityUserSettingsTab_warning"},Object(m.a)("Your server admin has disabled end-to-end encryption by default in private rooms & Direct Messages."))),(f.a.canEnable()||R.a.instance.canEnable())&&(d=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(m.a)("Privacy")),l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(m.a)("Analytics")),l.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(m.a)("%(brand)s collects anonymous analytics to allow us to improve the application.",{brand:e})," ",Object(m.a)("Privacy is important to us, so we don't collect any personal or identifiable data for our analytics."),l.a.createElement(g.a,{className:"mx_SettingsTab_linkBtn",onClick:f.a.showDetailsModal},Object(m.a)("Learn more about how we use analytics."))),l.a.createElement(a,{name:"analyticsOptIn",level:S.a.DEVICE,onChange:this._updateAnalytics}))));const h=b.getComponent("views.settings.E2eAdvancedPanel");let p;if(w.b.getValue(O.a.AdvancedSettings)){const e=this._renderIgnoredUsers(),t=this._renderManageInvites(),a=Object(x.b)()?l.a.createElement(h,null):null;(e||t||a)&&(p=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(m.a)("Advanced")),l.a.createElement("div",{className:"mx_SettingsTab_section"},e,t,a)))}return l.a.createElement("div",{className:"mx_SettingsTab mx_SecurityUserSettingsTab"},c,l.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(m.a)("Where you’re logged in")),l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",null,Object(m.a)("Manage the names of and sign out of your sessions below or <a>verify them in your User Profile</a>.",{},{a:e=>l.a.createElement(g.a,{kind:"link",onClick:this._onGoToUserProfileClick},e)})),l.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(m.a)("A session's public name is visible to people you communicate with"),l.a.createElement(t,null))),l.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(m.a)("Encryption")),l.a.createElement("div",{className:"mx_SettingsTab_section"},s,i,r,this._renderCurrentDeviceInfo()),d,p)}},o()(s,"propTypes",{closeSettingsFn:d.a.func.isRequired}),n=s))||n},1402:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(99),c=a(93),d=a(106),m=a(419),u=a(168),h=a(108),p=a(216),g=a(426),f=a(279),v=a(94);let b=Object(v.a)("views.settings.SecureBackupPanel")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"_onKeyBackupSessionsRemaining",e=>{this.setState({sessionsRemaining:e})}),i()(this,"_onKeyBackupStatus",()=>{this._loadBackupStatus()}),i()(this,"_startNewBackup",()=>{d.a.createTrackedDialogAsync("Key Backup","Key Backup",a.e(5).then(a.bind(null,1536)),{onFinished:()=>{this._loadBackupStatus()}},null,!1,!0)}),i()(this,"_deleteBackup",()=>{d.a.createTrackedDialog("Delete Backup","",p.a,{title:Object(c.a)("Delete Backup"),description:Object(c.a)("Are you sure? You will lose your encrypted messages if your keys are not backed up properly."),button:Object(c.a)("Delete Backup"),danger:!0,onFinished:e=>{e&&(this.setState({loading:!0}),l.a.get().deleteKeyBackupVersion(this.state.backupInfo.version).then(()=>{this._loadBackupStatus()}))}})}),i()(this,"_restoreBackup",async()=>{d.a.createTrackedDialog("Restore Backup","",g.a,null,null,!1,!0)}),i()(this,"_resetSecretStorage",async()=>{this.setState({error:null});try{await Object(f.b)(()=>{},!0)}catch(e){if(console.error("Error resetting secret storage",e),this._unmounted)return;this.setState({error:e})}this._unmounted||this._loadBackupStatus()}),this._unmounted=!1,this.state={loading:!0,error:null,backupKeyStored:null,backupKeyCached:null,backupKeyWellFormed:null,secretStorageKeyInAccount:null,secretStorageReady:null,backupInfo:null,backupSigStatus:null,sessionsRemaining:0}}componentDidMount(){this._checkKeyBackupStatus(),l.a.get().on("crypto.keyBackupStatus",this._onKeyBackupStatus),l.a.get().on("crypto.keyBackupSessionsRemaining",this._onKeyBackupSessionsRemaining)}componentWillUnmount(){this._unmounted=!0,l.a.get()&&(l.a.get().removeListener("crypto.keyBackupStatus",this._onKeyBackupStatus),l.a.get().removeListener("crypto.keyBackupSessionsRemaining",this._onKeyBackupSessionsRemaining))}async _checkKeyBackupStatus(){this._getUpdatedDiagnostics();try{const{backupInfo:e,trustInfo:t}=await l.a.get().checkKeyBackup();this.setState({loading:!1,error:null,backupInfo:e,backupSigStatus:t})}catch(e){if(console.log("Unable to fetch check backup status",e),this._unmounted)return;this.setState({loading:!1,error:e,backupInfo:null,backupSigStatus:null})}}async _loadBackupStatus(){this.setState({loading:!0}),this._getUpdatedDiagnostics();try{const e=await l.a.get().getKeyBackupVersion(),t=await l.a.get().isKeyBackupTrusted(e);if(this._unmounted)return;this.setState({loading:!1,error:null,backupInfo:e,backupSigStatus:t})}catch(e){if(console.log("Unable to fetch key backup status",e),this._unmounted)return;this.setState({loading:!1,error:e,backupInfo:null,backupSigStatus:null})}}async _getUpdatedDiagnostics(){const e=l.a.get(),t=e.crypto._secretStorage,a=!!await e.isKeyBackupKeyStored(),n=await e.crypto.getSessionBackupPrivateKey(),s=!!n,i=n instanceof Uint8Array,o=await t.hasKey(),r=await e.isSecretStorageReady();this._unmounted||this.setState({backupKeyStored:a,backupKeyCached:s,backupKeyWellFormed:i,secretStorageKeyInAccount:o,secretStorageReady:r})}render(){const{loading:e,error:t,backupKeyStored:a,backupKeyCached:n,backupKeyWellFormed:s,secretStorageKeyInAccount:i,secretStorageReady:o,backupInfo:d,backupSigStatus:p,sessionsRemaining:g}=this.state;let f,v,b;const y=[];if(t)f=r.a.createElement("div",{className:"error"},Object(c.a)("Unable to load key backup status"));else if(e)f=r.a.createElement(u.a,null);else if(d){let e,t=Object(c.a)("Restore from Backup");l.a.get().getKeyBackupEnabled()?f=r.a.createElement("p",null,"✅ ",Object(c.a)("This session is backing up your keys. ")):(f=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,Object(c.a)("This session is <b>not backing up your keys</b>, but you do have an existing backup you can restore from and add to going forward.",{},{b:e=>r.a.createElement("b",null,e)})),r.a.createElement("p",null,Object(c.a)("Connect this session to key backup before signing out to avoid losing any keys that may only be on this session."))),t=Object(c.a)("Connect this session to Key Backup")),e=l.a.get().getKeyBackupEnabled()?g>0?r.a.createElement("div",null,Object(c.a)("Backing up %(sessionsRemaining)s keys...",{sessionsRemaining:g})," ",r.a.createElement("br",null)):r.a.createElement("div",null,Object(c.a)("All keys backed up")," ",r.a.createElement("br",null)):"";let a,n=p.sigs.map((e,t)=>{const a=e.device?e.device.getDisplayName()||e.device.deviceId:null,n=t=>r.a.createElement("span",{className:e.valid?"mx_SecureBackupPanel_sigValid":"mx_SecureBackupPanel_sigInvalid"},t),s=t=>r.a.createElement("span",{className:e.device&&e.deviceTrust.isVerified()?"mx_SecureBackupPanel_deviceVerified":"mx_SecureBackupPanel_deviceNotVerified"},t),i=e=>r.a.createElement("span",{className:"mx_SecureBackupPanel_deviceName"},a),o=e.device&&e.device.getFingerprint()===l.a.get().getDeviceEd25519Key(),d=e.crossSigningId&&e.deviceId===l.a.get().getCrossSigningId();let m;return e.valid&&d?m=Object(c.a)("Backup has a <validity>valid</validity> signature from this user",{},{validity:n}):!e.valid&&d?m=Object(c.a)("Backup has a <validity>invalid</validity> signature from this user",{},{validity:n}):e.crossSigningId?m=Object(c.a)("Backup has a signature from <verify>unknown</verify> user with ID %(deviceId)s",{deviceId:e.deviceId},{verify:s}):e.device?e.valid&&o?m=Object(c.a)("Backup has a <validity>valid</validity> signature from this session",{},{validity:n}):!e.valid&&o?m=Object(c.a)("Backup has an <validity>invalid</validity> signature from this session",{},{validity:n}):e.valid&&e.deviceTrust.isVerified()?m=Object(c.a)("Backup has a <validity>valid</validity> signature from <verify>verified</verify> session <device></device>",{},{validity:n,verify:s,device:i}):e.valid&&!e.deviceTrust.isVerified()?m=Object(c.a)("Backup has a <validity>valid</validity> signature from <verify>unverified</verify> session <device></device>",{},{validity:n,verify:s,device:i}):!e.valid&&e.deviceTrust.isVerified()?m=Object(c.a)("Backup has an <validity>invalid</validity> signature from <verify>verified</verify> session <device></device>",{},{validity:n,verify:s,device:i}):e.valid||e.deviceTrust.isVerified()||(m=Object(c.a)("Backup has an <validity>invalid</validity> signature from <verify>unverified</verify> session <device></device>",{},{validity:n,verify:s,device:i})):m=Object(c.a)("Backup has a signature from <verify>unknown</verify> session with ID %(deviceId)s",{deviceId:e.deviceId},{verify:s}),r.a.createElement("div",{key:t},m)});0===p.sigs.length&&(n=Object(c.a)("Backup is not signed by any of your sessions")),p.trusted_locally&&(a=Object(c.a)("This backup is trusted because it has been restored on this session")),v=r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",null,r.a.createElement("td",null,Object(c.a)("Backup version:")),r.a.createElement("td",null,d.version)),r.a.createElement("tr",null,r.a.createElement("td",null,Object(c.a)("Algorithm:")),r.a.createElement("td",null,d.algorithm))),b=r.a.createElement(r.a.Fragment,null,e,r.a.createElement("div",null,n),r.a.createElement("div",null,a)),y.push(r.a.createElement(h.a,{key:"restore",kind:"primary",onClick:this._restoreBackup},t)),Object(m.d)()||y.push(r.a.createElement(h.a,{key:"delete",kind:"danger",onClick:this._deleteBackup},Object(c.a)("Delete Backup")))}else f=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,Object(c.a)("Your keys are <b>not being backed up from this session</b>.",{},{b:e=>r.a.createElement("b",null,e)})),r.a.createElement("p",null,Object(c.a)("Back up your keys before signing out to avoid losing them."))),y.push(r.a.createElement(h.a,{key:"setup",kind:"primary",onClick:this._startNewBackup},Object(c.a)("Set up")));i&&y.push(r.a.createElement(h.a,{key:"reset",kind:"danger",onClick:this._resetSecretStorage},Object(c.a)("Reset")));let E,_="";return n&&(_=", ",_+=s?Object(c.a)("well formed"):Object(c.a)("unexpected type")),y.length&&(E=r.a.createElement("div",{className:"mx_SecureBackupPanel_buttonRow"},y)),r.a.createElement("div",null,r.a.createElement("p",null,Object(c.a)("Back up your encryption keys with your account data in case you lose access to your sessions. Your keys will be secured with a unique Security Key.")),f,r.a.createElement("details",null,r.a.createElement("summary",null,Object(c.a)("Advanced")),r.a.createElement("table",{className:"mx_SecureBackupPanel_statusList"},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,Object(c.a)("Backup key stored:")),r.a.createElement("td",null,!0===a?Object(c.a)("in secret storage"):Object(c.a)("not stored"))),r.a.createElement("tr",null,r.a.createElement("td",null,Object(c.a)("Backup key cached:")),r.a.createElement("td",null,n?Object(c.a)("cached locally"):Object(c.a)("not found locally"),_)),r.a.createElement("tr",null,r.a.createElement("td",null,Object(c.a)("Secret storage public key:")),r.a.createElement("td",null,i?Object(c.a)("in account data"):Object(c.a)("not found"))),r.a.createElement("tr",null,r.a.createElement("td",null,Object(c.a)("Secret storage:")),r.a.createElement("td",null,o?Object(c.a)("ready"):Object(c.a)("not ready"))),v)),b),E)}})||n},1403:function(e,t,a){"use strict";a.d(t,"b",(function(){return c}));var n=a(88),s=a.n(n),i=a(97),o=a(93),r=a(123),l=a(103);function c(){return l.b.isEnabled("e2ee.manuallyVerifyAllSessions")}t.a=e=>{const t=i.getComponent("views.elements.SettingsFlag");return s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(o.a)("Encryption")),s.a.createElement(t,{name:"e2ee.manuallyVerifyAllSessions",level:r.a.DEVICE}),s.a.createElement("div",{className:"mx_E2eAdvancedPanel_settingLongDescription"},Object(o.a)("Individually verify each session used by a user to mark it as trusted, not trusting cross-signed devices.")))}},1404:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n,s=a(88),i=a.n(s),o=a(93),r=a(97),l=a(94);let c=Object(l.a)("views.settings.tabs.user.NotificationUserSettingsTab")(n=class extends i.a.Component{constructor(){super()}render(){const e=r.getComponent("views.settings.Notifications");return i.a.createElement("div",{className:"mx_SettingsTab mx_NotificationUserSettingsTab"},i.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(o.a)("Notifications")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement(e,null)))}})||n},1405:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(93),d=a(281),m=a(103),u=a(144),h=a(97),p=a(156),g=a(123),f=a(94);let v=Object(f.a)("views.settings.tabs.user.PreferencesUserSettingsTab")((s=class e extends l.a.Component{constructor(e){super(e),o()(this,"onAutoLaunchChange",e=>{p.a.get().setAutoLaunchEnabled(e).then(()=>this.setState({autoLaunch:e}))}),o()(this,"onWarnBeforeExitChange",e=>{p.a.get().setWarnBeforeExit(e).then(()=>this.setState({warnBeforeExit:e}))}),o()(this,"onAlwaysShowMenuBarChange",e=>{p.a.get().setAutoHideMenuBarEnabled(!e).then(()=>this.setState({alwaysShowMenuBar:e}))}),o()(this,"onMinimizeToTrayChange",e=>{p.a.get().setMinimizeToTrayEnabled(e).then(()=>this.setState({minimizeToTray:e}))}),o()(this,"onAutocompleteDelayChange",e=>{this.setState({autocompleteDelay:e.target.value}),m.b.setValue("autocompleteDelay",null,g.a.DEVICE,e.target.value)}),o()(this,"onReadMarkerInViewThresholdMs",e=>{this.setState({readMarkerInViewThresholdMs:e.target.value}),m.b.setValue("readMarkerInViewThresholdMs",null,g.a.DEVICE,e.target.value)}),o()(this,"onReadMarkerOutOfViewThresholdMs",e=>{this.setState({readMarkerOutOfViewThresholdMs:e.target.value}),m.b.setValue("readMarkerOutOfViewThresholdMs",null,g.a.DEVICE,e.target.value)}),this.state={autoLaunch:!1,autoLaunchSupported:!1,warnBeforeExit:!0,warnBeforeExitSupported:!1,alwaysShowMenuBar:!0,alwaysShowMenuBarSupported:!1,minimizeToTray:!0,minimizeToTraySupported:!1,autocompleteDelay:m.b.getValueAt(g.a.DEVICE,"autocompleteDelay").toString(10),readMarkerInViewThresholdMs:m.b.getValueAt(g.a.DEVICE,"readMarkerInViewThresholdMs").toString(10),readMarkerOutOfViewThresholdMs:m.b.getValueAt(g.a.DEVICE,"readMarkerOutOfViewThresholdMs").toString(10)}}async componentDidMount(){const e=p.a.get(),t=await e.supportsAutoLaunch();let a=!1;t&&(a=await e.getAutoLaunchEnabled());const n=await e.supportsWarnBeforeExit();let s=!1;n&&(s=await e.shouldWarnBeforeExit());const i=await e.supportsAutoHideMenuBar();let o=!0;i&&(o=!await e.getAutoHideMenuBarEnabled());const r=await e.supportsMinimizeToTray();let l=!0;r&&(l=await e.getMinimizeToTrayEnabled()),this.setState({autoLaunch:a,autoLaunchSupported:t,warnBeforeExit:s,warnBeforeExitSupported:n,alwaysShowMenuBarSupported:i,alwaysShowMenuBar:o,minimizeToTraySupported:r,minimizeToTray:l})}renderGroup(e){const t=h.getComponent("views.elements.SettingsFlag");return e.filter(m.b.isEnabled).map(e=>l.a.createElement(t,{key:e,name:e,level:g.a.ACCOUNT}))}render(){let t=null;this.state.autoLaunchSupported&&(t=l.a.createElement(d.a,{value:this.state.autoLaunch,onChange:this.onAutoLaunchChange,label:Object(c.a)("Start automatically after system login")}));let a=null;this.state.warnBeforeExitSupported&&(a=l.a.createElement(d.a,{value:this.state.warnBeforeExit,onChange:this.onWarnBeforeExitChange,label:Object(c.a)("Warn before quitting")}));let n=null;this.state.alwaysShowMenuBarSupported&&(n=l.a.createElement(d.a,{value:this.state.alwaysShowMenuBar,onChange:this.onAlwaysShowMenuBarChange,label:Object(c.a)("Always show the window menu bar")}));let s=null;return this.state.minimizeToTraySupported&&(s=l.a.createElement(d.a,{value:this.state.minimizeToTray,onChange:this.onMinimizeToTrayChange,label:Object(c.a)("Show tray icon and minimize window to it on close")})),l.a.createElement("div",{className:"mx_SettingsTab mx_PreferencesUserSettingsTab"},l.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Preferences")),l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Room list")),this.renderGroup(e.ROOM_LIST_SETTINGS)),l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Composer")),this.renderGroup(e.COMPOSER_SETTINGS)),l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Timeline")),this.renderGroup(e.TIMELINE_SETTINGS)),l.a.createElement("div",{className:"mx_SettingsTab_section"},l.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("General")),this.renderGroup(e.GENERAL_SETTINGS),s,n,t,a,l.a.createElement(u.a,{label:Object(c.a)("Autocomplete delay (ms)"),type:"number",value:this.state.autocompleteDelay,onChange:this.onAutocompleteDelayChange}),l.a.createElement(u.a,{label:Object(c.a)("Read Marker lifetime (ms)"),type:"number",value:this.state.readMarkerInViewThresholdMs,onChange:this.onReadMarkerInViewThresholdMs}),l.a.createElement(u.a,{label:Object(c.a)("Read Marker off-screen lifetime (ms)"),type:"number",value:this.state.readMarkerOutOfViewThresholdMs,onChange:this.onReadMarkerOutOfViewThresholdMs})))}},o()(s,"ROOM_LIST_SETTINGS",["breadcrumbs"]),o()(s,"COMPOSER_SETTINGS",["MessageComposerInput.autoReplaceEmoji","MessageComposerInput.suggestEmoji","sendTypingNotifications","MessageComposerInput.ctrlEnterToSend","MessageComposerInput.showStickersButton"]),o()(s,"TIMELINE_SETTINGS",["showTypingNotifications","autoplayGifsAndVideos","urlPreviewsEnabled","TextualBody.enableBigEmoji","showReadReceipts","showTwelveHourTimestamps","alwaysShowTimestamps","showRedactions","enableSyntaxHighlightLanguageDetection","expandCodeByDefault","scrollToBottomOnMessageSent","showCodeLineNumbers","showJoinLeaves","showAvatarChanges","showDisplaynameChanges","showImages","showChatEffects","Pill.shouldShowPillAvatar","ctrlFForSearch"]),o()(s,"GENERAL_SETTINGS",["TagPanel.enableTagPanel","promptBeforeInviteUnknownUsers"]),n=s))||n},1406:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(110),d=a(430),m=a(144),u=a(108),h=a(99),p=a(97),g=a(106),f=a(123),v=a(94);let b=Object(v.a)("views.settings.tabs.user.VoiceUserSettingsTab")(n=class extends r.a.Component{constructor(){super(),i()(this,"_refreshMediaDevices",async e=>{this.setState({mediaDevices:await d.a.getDevices(),activeAudioOutput:d.a.getAudioOutput(),activeAudioInput:d.a.getAudioInput(),activeVideoInput:d.a.getVideoInput()}),e&&e.getTracks().forEach(e=>e.stop())}),i()(this,"_requestMediaPermissions",async()=>{let e,t,a;try{e={video:!0,audio:!0},t=await navigator.mediaDevices.getUserMedia(e)}catch(n){if("NotFoundError"===n.name){e={audio:!0};try{t=await navigator.mediaDevices.getUserMedia(e)}catch(e){a=e}}else a=n}if(a){console.log("Failed to list userMedia devices",a);const e=c.a.get().brand,t=p.getComponent("dialogs.ErrorDialog");g.a.createTrackedDialog("No media permissions","",t,{title:Object(l.a)("No media permissions"),description:Object(l.a)("You may need to manually permit %(brand)s to access your microphone/webcam",{brand:e})})}else this._refreshMediaDevices(t)}),i()(this,"_setAudioOutput",e=>{d.a.setAudioOutput(e.target.value),this.setState({activeAudioOutput:e.target.value})}),i()(this,"_setAudioInput",e=>{d.a.setAudioInput(e.target.value),this.setState({activeAudioInput:e.target.value})}),i()(this,"_setVideoInput",e=>{d.a.setVideoInput(e.target.value),this.setState({activeVideoInput:e.target.value})}),i()(this,"_changeWebRtcMethod",e=>{h.a.get().setForceTURN(!e)}),i()(this,"_changeFallbackICEServerAllowed",e=>{h.a.get().setFallbackICEServerAllowed(e)}),this.state={mediaDevices:!1,activeAudioOutput:null,activeAudioInput:null,activeVideoInput:null}}async componentDidMount(){await d.a.hasAnyLabeledDevices()&&this._refreshMediaDevices()}_renderDeviceOptions(e,t){return e.map(e=>r.a.createElement("option",{key:`${t}-${e.deviceId}`,value:e.deviceId},e.label))}render(){const e=p.getComponent("views.elements.SettingsFlag");let t=null,a=null,n=null,s=null;if(!1===this.state.mediaDevices)t=r.a.createElement("div",{className:"mx_VoiceUserSettingsTab_missingMediaPermissions"},r.a.createElement("p",null,Object(l.a)("Missing media permissions, click the button below to request.")),r.a.createElement(u.a,{onClick:this._requestMediaPermissions,kind:"primary"},Object(l.a)("Request media permissions")));else if(this.state.mediaDevices){a=r.a.createElement("p",null,Object(l.a)("No Audio Outputs detected")),n=r.a.createElement("p",null,Object(l.a)("No Microphones detected")),s=r.a.createElement("p",null,Object(l.a)("No Webcams detected"));const e={deviceId:"",label:Object(l.a)("Default Device")},t=t=>t.some(e=>"default"===e.deviceId)?"default":(t.unshift(e),""),i=this.state.mediaDevices.audiooutput.slice(0);if(i.length>0){const e=t(i);a=r.a.createElement(m.a,{element:"select",label:Object(l.a)("Audio Output"),value:this.state.activeAudioOutput||e,onChange:this._setAudioOutput},this._renderDeviceOptions(i,"audioOutput"))}const o=this.state.mediaDevices.audioinput.slice(0);if(o.length>0){const e=t(o);n=r.a.createElement(m.a,{element:"select",label:Object(l.a)("Microphone"),value:this.state.activeAudioInput||e,onChange:this._setAudioInput},this._renderDeviceOptions(o,"audioInput"))}const c=this.state.mediaDevices.videoinput.slice(0);if(c.length>0){const e=t(c);s=r.a.createElement(m.a,{element:"select",label:Object(l.a)("Camera"),value:this.state.activeVideoInput||e,onChange:this._setVideoInput},this._renderDeviceOptions(c,"videoInput"))}}return r.a.createElement("div",{className:"mx_SettingsTab mx_VoiceUserSettingsTab"},r.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(l.a)("Voice & Video")),r.a.createElement("div",{className:"mx_SettingsTab_section"},t,a,n,s,r.a.createElement(e,{name:"VideoView.flipVideoHorizontally",level:f.a.ACCOUNT}),r.a.createElement(e,{name:"webRtcAllowPeerToPeer",level:f.a.DEVICE,onChange:this._changeWebRtcMethod}),r.a.createElement(e,{name:"fallbackICEServerAllowed",level:f.a.DEVICE,onChange:this._changeFallbackICEServerAllowed})))}})||n},1407:function(e,t,a){"use strict";a.d(t,"a",(function(){return w}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(99),d=a(108),m=a(135),u=a(110),h=a(214),p=a(106),g=a(97),f=a(156),v=a(599),b=a(1408),y=a(94),E=a(226),_=a(127);function S(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?S(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):S(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let w=Object(y.a)("views.settings.tabs.user.HelpUserSettingsTab")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"closeCopiedTooltip",void 0),i()(this,"onClearCacheAndReload",e=>{f.a.get()&&(console.log("Clear cache & reload clicked"),c.a.get().stopClient(),c.a.get().store.deleteAllData().then(()=>{f.a.get().reload()}))}),i()(this,"onBugReport",e=>{const t=g.getComponent("dialogs.BugReportDialog");t&&p.a.createTrackedDialog("Bug Report Dialog","",t,{})}),i()(this,"onStartBotChat",e=>{this.props.closeSettingsFn(),Object(h.d)({dmUserId:u.a.get().welcomeUserId,andView:!0})}),i()(this,"showSpoiler",e=>{const t=e.target;t.innerHTML=t.getAttribute("data-spoiler");const a=document.createRange();a.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(a)}),i()(this,"onAccessTokenCopyClick",async e=>{e.preventDefault();const t=e.target,a=await Object(E.c)(c.a.get().getAccessToken()),n=t.getBoundingClientRect(),s=g.getComponent("context_menus.GenericTextContextMenu"),{close:i}=_.n(s,C(C({},Object(_.p)(n,2)),{},{message:a?Object(l.a)("Copied!"):Object(l.a)("Failed to copy")}));this.closeCopiedTooltip=t.onmouseleave=i}),this.state={appVersion:null,canUpdate:!1}}componentDidMount(){f.a.get().getAppVersion().then(e=>this.setState({appVersion:e})).catch(e=>{console.error("Error getting vector version: ",e)}),f.a.get().canSelfUpdate().then(e=>this.setState({canUpdate:e})).catch(e=>{console.error("Error getting self updatability: ",e)})}componentWillUnmount(){this.closeCopiedTooltip&&this.closeCopiedTooltip()}renderLegal(){if(!u.a.get().terms_and_conditions_links)return null;const e=[];for(const t of u.a.get().terms_and_conditions_links)e.push(r.a.createElement("div",{key:t.url},r.a.createElement("a",{href:t.url,rel:"noreferrer noopener",target:"_blank"},t.text)));return r.a.createElement("div",{className:"mx_SettingsTab_section mx_HelpUserSettingsTab_versions"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Legal")),r.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},e))}renderCredits(){return r.a.createElement("div",{className:"mx_SettingsTab_section"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Credits")),r.a.createElement("ul",null,r.a.createElement("li",null,"The ",r.a.createElement("a",{href:"themes/element/img/backgrounds/lake.jpg",rel:"noreferrer noopener",target:"_blank"},"default cover photo")," is © ",r.a.createElement("a",{href:"https://www.flickr.com/golan",rel:"noreferrer noopener",target:"_blank"},"Jesús Roncero")," used under the terms of ",r.a.createElement("a",{href:"https://creativecommons.org/licenses/by-sa/4.0/",rel:"noreferrer noopener",target:"_blank"},"CC-BY-SA 4.0"),"."),r.a.createElement("li",null,"The ",r.a.createElement("a",{href:"https://github.com/matrix-org/twemoji-colr",rel:"noreferrer noopener",target:"_blank"},"twemoji-colr")," font is © ",r.a.createElement("a",{href:"https://mozilla.org",rel:"noreferrer noopener",target:"_blank"},"Mozilla Foundation")," used under the terms of ",r.a.createElement("a",{href:"http://www.apache.org/licenses/LICENSE-2.0",rel:"noreferrer noopener",target:"_blank"},"Apache 2.0"),"."),r.a.createElement("li",null,"The ",r.a.createElement("a",{href:"https://twemoji.twitter.com/",rel:"noreferrer noopener",target:"_blank"},"Twemoji")," emoji art is © ",r.a.createElement("a",{href:"https://twemoji.twitter.com/",rel:"noreferrer noopener",target:"_blank"},"Twitter, Inc and other contributors")," used under the terms of ",r.a.createElement("a",{href:"https://creativecommons.org/licenses/by/4.0/",rel:"noreferrer noopener",target:"_blank"},"CC-BY 4.0"),".")))}render(){const e=u.a.get().brand;let t=Object(l.a)("For help with using %(brand)s, click <a>here</a>.",{brand:e},{a:e=>r.a.createElement("a",{href:"https://element.io/help",rel:"noreferrer noopener",target:"_blank"},e)});u.a.get().welcomeUserId&&Object(l.d)().startsWith("en")&&(t=r.a.createElement("div",null,Object(l.a)("For help with using %(brand)s, click <a>here</a> or start a chat with our bot using the button below.",{brand:e},{a:e=>r.a.createElement("a",{href:"https://element.io/help",rel:"noreferrer noopener",target:"_blank"},e)}),r.a.createElement("div",null,r.a.createElement(d.a,{onClick:this.onStartBotChat,kind:"primary"},Object(l.a)("Chat with %(brand)s Bot",{brand:e})))));const a=this.state.appVersion||"unknown";let n=c.a.get().olmVersion;n=n?`${n[0]}.${n[1]}.${n[2]}`:"<not-enabled>";let s,i=null;return this.state.canUpdate&&(i=r.a.createElement(b.a,null)),u.a.get().bug_report_endpoint_url&&(s=r.a.createElement("div",{className:"mx_SettingsTab_section"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Bug reporting")),r.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(l.a)("If you've submitted a bug via GitHub, debug logs can help us track down the problem. Debug logs contain application usage data including your username, the IDs or aliases of the rooms or groups you have visited and the usernames of other users. They do not contain messages."),r.a.createElement("div",{className:"mx_HelpUserSettingsTab_debugButton"},r.a.createElement(d.a,{onClick:this.onBugReport,kind:"primary"},Object(l.a)("Submit debug logs"))),Object(l.a)("To report a Matrix-related security issue, please read the Matrix.org <a>Security Disclosure Policy</a>.",{},{a:e=>r.a.createElement("a",{href:"https://matrix.org/security-disclosure-policy/",rel:"noreferrer noopener",target:"_blank"},e)})))),r.a.createElement("div",{className:"mx_SettingsTab mx_HelpUserSettingsTab"},r.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(l.a)("Help & About")),s,r.a.createElement("div",{className:"mx_SettingsTab_section"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("FAQ")),r.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},t),r.a.createElement(d.a,{kind:"primary",onClick:v.d},Object(l.a)("Keyboard Shortcuts"))),r.a.createElement("div",{className:"mx_SettingsTab_section mx_HelpUserSettingsTab_versions"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Versions")),r.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(l.a)("%(brand)s version:",{brand:e})," ",a,r.a.createElement("br",null),Object(l.a)("olm version:")," ",n,r.a.createElement("br",null),i)),this.renderLegal(),this.renderCredits(),r.a.createElement("div",{className:"mx_SettingsTab_section mx_HelpUserSettingsTab_versions"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Advanced")),r.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(l.a)("Homeserver is")," ",r.a.createElement("code",null,c.a.get().getHomeserverUrl()),r.a.createElement("br",null),Object(l.a)("Identity Server is")," ",r.a.createElement("code",null,c.a.get().getIdentityServerUrl()),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("details",null,r.a.createElement("summary",null,Object(l.a)("Access Token")),r.a.createElement("br",null),r.a.createElement("b",null,Object(l.a)("Your access token gives full access to your account. Do not share it with anyone.")),r.a.createElement("div",{className:"mx_HelpUserSettingsTab_accessToken"},r.a.createElement("code",null,c.a.get().getAccessToken()),r.a.createElement(m.a,{title:Object(l.a)("Copy"),onClick:this.onAccessTokenCopyClick,className:"mx_HelpUserSettingsTab_accessToken_copy"}))),r.a.createElement("br",null),r.a.createElement("div",{className:"mx_HelpUserSettingsTab_debugButton"},r.a.createElement(d.a,{onClick:this.onClearCacheAndReload,kind:"danger"},Object(l.a)("Clear cache and reload"))))))}})||n},1408:function(e,t,a){"use strict";var n=a(98),s=a.n(n),i=a(88),o=a.n(i),r=a(429),l=a(156),c=a(1330),d=a(100),m=a(115),u=a(93),h=a(251),p=a(108);const g=["action"];function f(){l.a.get().installUpdate()}const v=[r.d.Ready,r.d.Error,r.d.NotAvailable];t.a=()=>{const[e,t]=Object(i.useState)(null);Object(c.a)(d.a,e=>{let{action:a}=e,n=s()(e,g);a===m.a.CheckUpdates&&t(n)});const a=e&&!v.includes(e.status);let n;return e&&(n=o.a.createElement("span",{className:"mx_UpdateCheckButton_summary"},function(e,t){switch(e){case r.d.Error:return Object(u.a)("Error encountered (%(errorDetail)s).",{errorDetail:t});case r.d.Checking:return Object(u.a)("Checking for an update...");case r.d.NotAvailable:return Object(u.a)("No update available.");case r.d.Downloading:return Object(u.a)("Downloading update...");case r.d.Ready:return Object(u.a)("New version available. <a>Update now.</a>",{},{a:e=>o.a.createElement(p.a,{kind:"link",onClick:f},e)})}}(e.status,e.detail),a&&o.a.createElement(h.a,null))),o.a.createElement(o.a.Fragment,null,o.a.createElement(p.a,{onClick:()=>{t(null),l.a.get().startUpdateCheck()},kind:"primary",disabled:a},Object(u.a)("Check for update")),n)}},1409:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n,s=a(88),i=a.n(s),o=a(93),r=a(1410),l=a(94);let c=Object(l.a)("views.settings.tabs.user.FlairUserSettingsTab")(n=class extends i.a.Component{render(){return i.a.createElement("div",{className:"mx_SettingsTab"},i.a.createElement("span",{className:"mx_SettingsTab_heading"},Object(o.a)("Flair")),i.a.createElement("div",{className:"mx_SettingsTab_section"},i.a.createElement(r.a,null)))}})||n},1410:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(97),d=a(93),m=a(119),u=a(94);let h=Object(u.a)("views.groups.GroupUserSettings")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"state",{error:null,groups:null})}componentDidMount(){this.context.getJoinedGroups().then(e=>{this.setState({groups:e.groups||[],error:null})},e=>{console.error(e),this.setState({groups:null,error:e})})}render(){let e="",t=null;const a=this.state.groups;if(this.state.error)e=Object(d.a)("Something went wrong when trying to get your communities.");else if(null===a)e=Object(d.a)("Loading...");else if(a.length>0){const n=c.getComponent("groups.GroupPublicityToggle");t=a.map((e,t)=>l.a.createElement(n,{key:t,groupId:e})),e=Object(d.a)("Display your community flair in rooms configured to show it.")}else e=Object(d.a)("You're not currently a member of any communities.");return l.a.createElement("div",null,l.a.createElement("p",{className:"mx_SettingsTab_subsectionText"},e),l.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},t))}},o()(s,"contextType",m.a),n=s))||n},1411:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(110),d=a(801),m=a(632),u=a(106),h=a(99),p=a(97),g=a(94);let f=Object(g.a)("views.settings.tabs.user.MjolnirUserSettingsTab")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"onPersonalRuleChanged",e=>{this.setState({newPersonalRule:e.target.value})}),i()(this,"onNewListChanged",e=>{this.setState({newList:e.target.value})}),i()(this,"onAddPersonalRule",async e=>{e.preventDefault(),e.stopPropagation();let t=m.d;this.state.newPersonalRule.startsWith("@")&&(t=m.e),this.setState({busy:!0});try{const e=await d.a.sharedInstance().getOrCreatePersonalList();await e.banEntity(t,this.state.newPersonalRule,Object(l.a)("Ignored/Blocked")),this.setState({newPersonalRule:""})}catch(e){console.error(e);const t=p.getComponent("dialogs.ErrorDialog");u.a.createTrackedDialog("Failed to add Mjolnir rule","",t,{title:Object(l.a)("Error adding ignored user/server"),description:Object(l.a)("Something went wrong. Please try again or view your console for hints.")})}finally{this.setState({busy:!1})}}),i()(this,"onSubscribeList",async e=>{e.preventDefault(),e.stopPropagation(),this.setState({busy:!0});try{const e=await h.a.get().joinRoom(this.state.newList);await d.a.sharedInstance().subscribeToList(e.roomId),this.setState({newList:""})}catch(e){console.error(e);const t=p.getComponent("dialogs.ErrorDialog");u.a.createTrackedDialog("Failed to subscribe to Mjolnir list","",t,{title:Object(l.a)("Error subscribing to list"),description:Object(l.a)("Please verify the room ID or address and try again.")})}finally{this.setState({busy:!1})}}),this.state={busy:!1,newPersonalRule:"",newList:""}}async removePersonalRule(e){this.setState({busy:!0});try{const t=d.a.sharedInstance().getPersonalList();await t.unbanEntity(e.kind,e.entity)}catch(e){console.error(e);const t=p.getComponent("dialogs.ErrorDialog");u.a.createTrackedDialog("Failed to remove Mjolnir rule","",t,{title:Object(l.a)("Error removing ignored user/server"),description:Object(l.a)("Something went wrong. Please try again or view your console for hints.")})}finally{this.setState({busy:!1})}}async unsubscribeFromList(e){this.setState({busy:!0});try{await d.a.sharedInstance().unsubscribeFromList(e.roomId),await h.a.get().leave(e.roomId)}catch(e){console.error(e);const t=p.getComponent("dialogs.ErrorDialog");u.a.createTrackedDialog("Failed to unsubscribe from Mjolnir list","",t,{title:Object(l.a)("Error unsubscribing from list"),description:Object(l.a)("Please try again or view your console for hints.")})}finally{this.setState({busy:!1})}}viewListRules(e){const t=p.getComponent("dialogs.QuestionDialog"),a=h.a.get().getRoom(e.roomId),n=a?a.name:e.roomId,s=e=>{if(0===e.length)return r.a.createElement("i",null,Object(l.a)("None"));const t=[];for(const a of e)t.push(r.a.createElement("li",{key:a.kind+a.entity},r.a.createElement("code",null,a.entity)));return r.a.createElement("ul",null,t)};u.a.createTrackedDialog("View Mjolnir list rules","",t,{title:Object(l.a)("Ban list rules - %(roomName)s",{roomName:n}),description:r.a.createElement("div",null,r.a.createElement("h3",null,Object(l.a)("Server rules")),s(e.serverRules),r.a.createElement("h3",null,Object(l.a)("User rules")),s(e.userRules)),button:Object(l.a)("Close"),hasCancelButton:!1})}renderPersonalBanListRules(){const e=p.getComponent("elements.AccessibleButton"),t=d.a.sharedInstance().getPersonalList(),a=t?[...t.userRules,...t.serverRules]:[];if(!t||a.length<=0)return r.a.createElement("i",null,Object(l.a)("You have not ignored anyone."));const n=[];for(const t of a)n.push(r.a.createElement("li",{key:t.entity,className:"mx_MjolnirUserSettingsTab_listItem"},r.a.createElement(e,{kind:"danger_sm",onClick:()=>this.removePersonalRule(t),disabled:this.state.busy},Object(l.a)("Remove"))," ",r.a.createElement("code",null,t.entity)));return r.a.createElement("div",null,r.a.createElement("p",null,Object(l.a)("You are currently ignoring:")),r.a.createElement("ul",null,n))}renderSubscribedBanLists(){const e=p.getComponent("elements.AccessibleButton"),t=d.a.sharedInstance().getPersonalList(),a=d.a.sharedInstance().lists.filter(e=>!t||t.roomId!==e.roomId);if(!a||a.length<=0)return r.a.createElement("i",null,Object(l.a)("You are not subscribed to any lists"));const n=[];for(const t of a){const a=h.a.get().getRoom(t.roomId),s=a?r.a.createElement("span",null,a.name," (",r.a.createElement("code",null,t.roomId),")"):r.a.createElement("code",null,"list.roomId");n.push(r.a.createElement("li",{key:t.roomId,className:"mx_MjolnirUserSettingsTab_listItem"},r.a.createElement(e,{kind:"danger_sm",onClick:()=>this.unsubscribeFromList(t),disabled:this.state.busy},Object(l.a)("Unsubscribe"))," ",r.a.createElement(e,{kind:"primary_sm",onClick:()=>this.viewListRules(t),disabled:this.state.busy},Object(l.a)("View rules"))," ",s))}return r.a.createElement("div",null,r.a.createElement("p",null,Object(l.a)("You are currently subscribed to:")),r.a.createElement("ul",null,n))}render(){const e=p.getComponent("elements.Field"),t=p.getComponent("elements.AccessibleButton"),a=c.a.get().brand;return r.a.createElement("div",{className:"mx_SettingsTab mx_MjolnirUserSettingsTab"},r.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(l.a)("Ignored users")),r.a.createElement("div",{className:"mx_SettingsTab_section"},r.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},r.a.createElement("span",{className:"warning"},Object(l.a)("⚠ These settings are meant for advanced users.")),r.a.createElement("br",null),r.a.createElement("br",null),Object(l.a)("Add users and servers you want to ignore here. Use asterisks to have %(brand)s match any characters. For example, <code>@bot:*</code> would ignore all users that have the name 'bot' on any server.",{brand:a},{code:e=>r.a.createElement("code",null,e)}),r.a.createElement("br",null),r.a.createElement("br",null),Object(l.a)("Ignoring people is done through ban lists which contain rules for who to ban. Subscribing to a ban list means the users/servers blocked by that list will be hidden from you."))),r.a.createElement("div",{className:"mx_SettingsTab_section"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Personal ban list")),r.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(l.a)("Your personal ban list holds all the users/servers you personally don't want to see messages from. After ignoring your first user/server, a new room will show up in your room list named 'My Ban List' - stay in this room to keep the ban list in effect.")),r.a.createElement("div",null,this.renderPersonalBanListRules()),r.a.createElement("div",null,r.a.createElement("form",{onSubmit:this.onAddPersonalRule,autoComplete:"off"},r.a.createElement(e,{type:"text",label:Object(l.a)("Server or user ID to ignore"),placeholder:Object(l.a)("eg: @bot:* or example.org"),value:this.state.newPersonalRule,onChange:this.onPersonalRuleChanged}),r.a.createElement(t,{type:"submit",kind:"primary",onClick:this.onAddPersonalRule,disabled:this.state.busy},Object(l.a)("Ignore"))))),r.a.createElement("div",{className:"mx_SettingsTab_section"},r.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(l.a)("Subscribed lists")),r.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},r.a.createElement("span",{className:"warning"},Object(l.a)("Subscribing to a ban list will cause you to join it!"))," ",r.a.createElement("span",null,Object(l.a)("If this isn't what you want, please use a different tool to ignore users."))),r.a.createElement("div",null,this.renderSubscribedBanLists()),r.a.createElement("div",null,r.a.createElement("form",{onSubmit:this.onSubscribeList,autoComplete:"off"},r.a.createElement(e,{type:"text",label:Object(l.a)("Room ID or address of ban list"),value:this.state.newList,onChange:this.onNewListChanged}),r.a.createElement(t,{type:"submit",kind:"primary",onClick:this.onSubscribeList,disabled:this.state.busy},Object(l.a)("Subscribe"))))))}})||n},1412:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(773),u=a(93),h=a(144),p=a(131),g=a(94);let f=Object(g.a)("views.elements.PowerSelector")((s=class extends l.a.Component{constructor(e){super(e),o()(this,"onSelectChange",e=>{"SELECT_VALUE_CUSTOM"===e.target.value?this.setState({custom:!0}):(this.props.onChange(e.target.value,this.props.powerLevelKey),this.setState({selectValue:e.target.value}))}),o()(this,"onCustomChange",e=>{this.setState({customValue:e.target.value})}),o()(this,"onCustomBlur",e=>{e.preventDefault(),e.stopPropagation(),this.props.onChange(parseInt(this.state.customValue),this.props.powerLevelKey)}),o()(this,"onCustomKeyDown",e=>{e.key===p.a.ENTER&&(e.preventDefault(),e.stopPropagation(),e.target.blur())}),this.state={levelRoleMap:{},options:[],customValue:this.props.value,selectValue:0}}UNSAFE_componentWillMount(){this._initStateFromProps(this.props)}UNSAFE_componentWillReceiveProps(e){this._initStateFromProps(e)}_initStateFromProps(e){const t=m.a(e.usersDefault),a=Object.keys(t).filter(t=>void 0===t||t<=e.maxValue||t==e.value),n=void 0===t[e.value];this.setState({levelRoleMap:t,options:a,custom:n,customLevel:e.value,selectValue:n?"SELECT_VALUE_CUSTOM":e.value})}render(){let e;const t=void 0===this.props.label?Object(u.a)("Power level"):this.props.label;if(this.state.custom)e=l.a.createElement(h.a,{type:"number",label:t,max:this.props.maxValue,onBlur:this.onCustomBlur,onKeyDown:this.onCustomKeyDown,onChange:this.onCustomChange,value:String(this.state.customValue),disabled:this.props.disabled});else{let a=this.state.options.map(e=>({value:e,text:m.b(e,this.props.usersDefault)}));a.push({value:"SELECT_VALUE_CUSTOM",text:Object(u.a)("Custom level")}),a=a.map(e=>l.a.createElement("option",{value:e.value,key:e.value},e.text)),e=l.a.createElement(h.a,{element:"select",label:t,onChange:this.onSelectChange,value:String(this.state.selectValue),disabled:this.props.disabled},a)}return l.a.createElement("div",{className:"mx_PowerSelector"},e)}},o()(s,"propTypes",{value:d.a.number.isRequired,maxValue:d.a.number.isRequired,usersDefault:d.a.number.isRequired,disabled:d.a.bool,onChange:d.a.func,powerLevelKey:d.a.string,label:d.a.string}),o()(s,"defaultProps",{maxValue:1/0,usersDefault:0}),n=s))||n},1413:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(94);let h=Object(u.a)("views.rooms.PresenceLabel")((s=class extends l.a.Component{getDuration(e){if(!e)return;const t=parseInt(e/1e3),a=t%60,n=parseInt(t/60)%60,s=parseInt(t/3600)%24,i=parseInt(t/86400);return t<60?t<0?Object(m.a)("%(duration)ss",{duration:0}):Object(m.a)("%(duration)ss",{duration:a}):t<3600?Object(m.a)("%(duration)sm",{duration:n}):t<86400?Object(m.a)("%(duration)sh",{duration:s}):Object(m.a)("%(duration)sd",{duration:i})}getPrettyPresence(e,t,a){if(!a&&void 0!==t&&t>0){const a=this.getDuration(t);return"online"===e?Object(m.a)("Online for %(duration)s",{duration:a}):"unavailable"===e?Object(m.a)("Idle for %(duration)s",{duration:a}):"offline"===e?Object(m.a)("Offline for %(duration)s",{duration:a}):Object(m.a)("Unknown for %(duration)s",{duration:a})}return"online"===e?Object(m.a)("Online"):"unavailable"===e?Object(m.a)("Idle"):"offline"===e?Object(m.a)("Offline"):Object(m.a)("Unknown")}render(){return l.a.createElement("div",{className:"mx_PresenceLabel"},this.getPrettyPresence(this.props.presenceState,this.props.activeAgo,this.props.currentlyActive))}},o()(s,"propTypes",{activeAgo:d.a.number,currentlyActive:d.a.bool,presenceState:d.a.string}),o()(s,"defaultProps",{activeAgo:-1,presenceState:null}),n=s))||n},1414:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(266),u=a(97),h=a(93),p=a(570),g=a(94),f=a(126);let v=Object(g.a)("views.dialogs.ConfirmUserActionDialog")((s=class extends l.a.Component{constructor(e){super(e),o()(this,"onOk",()=>{let e;this._reasonField&&(e=this._reasonField.value),this.props.onFinished(!0,e)}),o()(this,"onCancel",()=>{this.props.onFinished(!1)}),o()(this,"_collectReasonField",e=>{this._reasonField=e}),this._reasonField=null}render(){const e=u.getComponent("views.dialogs.BaseDialog"),t=u.getComponent("views.elements.DialogButtons"),a=u.getComponent("views.avatars.MemberAvatar"),n=u.getComponent("views.avatars.BaseAvatar"),s=this.props.danger?"danger":"";let i,o,r,c;if(this.props.askReason&&(i=l.a.createElement("div",null,l.a.createElement("form",{onSubmit:this.onOk},l.a.createElement("input",{className:"mx_ConfirmUserActionDialog_reasonField",ref:this._collectReasonField,placeholder:Object(h.a)("Reason"),autoFocus:!0})))),this.props.member)o=l.a.createElement(a,{member:this.props.member,width:48,height:48}),r=this.props.member.name,c=this.props.member.userId;else{const e=this.props.groupMember.avatarUrl?Object(f.b)(this.props.groupMember.avatarUrl).getSquareThumbnailHttp(48):null;r=this.props.groupMember.displayname||this.props.groupMember.userId,c=this.props.groupMember.userId,o=l.a.createElement(n,{name:r,url:e,width:48,height:48})}return l.a.createElement(e,{className:"mx_ConfirmUserActionDialog",onFinished:this.props.onFinished,title:this.props.title,contentId:"mx_Dialog_content"},l.a.createElement("div",{id:"mx_Dialog_content",className:"mx_Dialog_content"},l.a.createElement("div",{className:"mx_ConfirmUserActionDialog_avatar"},o),l.a.createElement("div",{className:"mx_ConfirmUserActionDialog_name"},r),l.a.createElement("div",{className:"mx_ConfirmUserActionDialog_userId"},c)),i,l.a.createElement(t,{primaryButton:this.props.action,onPrimaryButtonClick:this.onOk,primaryButtonClass:s,focus:!this.props.askReason,onCancel:this.onCancel}))}},o()(s,"propTypes",{member:d.a.object,groupMember:p.a,matrixClient:d.a.instanceOf(m.b),action:d.a.string.isRequired,title:d.a.string.isRequired,askReason:d.a.bool,danger:d.a.bool,onFinished:d.a.func.isRequired}),o()(s,"defaultProps",{danger:!1,askReason:!1}),n=s))||n},1415:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(99),c=a(93),d=a(100),m=a(97),u=a(106),h=a(205),p=a(167),g=a(250),f=a(94),v=a(103);let b=Object(f.a)("views.rooms.ThirdPartyMemberInfo")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"room",void 0),i()(this,"onRoomStateEvents",e=>{if("m.room.third_party_invite"===e.getType()&&e.getStateKey()===this.state.stateKey){const t=e.getContent().display_name,a={invited:Object(h.c)(e)};t&&(a.displayName=t),this.setState(a)}}),i()(this,"onCancel",()=>{d.a.dispatch({action:"view_3pid_invite",event:null})}),i()(this,"onKickClick",()=>{l.a.get().sendStateEvent(this.state.roomId,"m.room.third_party_invite",{},this.state.stateKey).catch(e=>{console.error(e),this.setState({invited:!0});const t=m.getComponent("dialogs.ErrorDialog");u.a.createTrackedDialog("Revoke 3pid invite failed","",t,{title:Object(c.a)("Failed to revoke invite"),description:Object(c.a)("Could not revoke the invite. The server may be experiencing a temporary problem or you do not have sufficient permissions to revoke the invite.")})}),this.setState({invited:!1})}),this.room=l.a.get().getRoom(this.props.event.getRoomId());const t=this.room.getMember(l.a.get().getUserId()),a=this.room.currentState.getStateEvents("m.room.power_levels","");let n=a?a.getContent().kick:50;"number"!=typeof n&&(n=50);const s=this.room.getMember(this.props.event.getSender());this.state={stateKey:this.props.event.getStateKey(),roomId:this.props.event.getRoomId(),displayName:this.props.event.getContent().display_name,invited:!0,canKick:!!t&&t.powerLevel>n,senderName:s?s.name:this.props.event.getSender()}}componentDidMount(){l.a.get().on("RoomState.events",this.onRoomStateEvents)}componentWillUnmount(){const e=l.a.get();e&&e.removeListener("RoomState.events",this.onRoomStateEvents)}render(){const e=m.getComponent("elements.AccessibleButton");let t,a=null;return this.state.canKick&&this.state.invited&&(a=r.a.createElement("div",{className:"mx_MemberInfo_container"},r.a.createElement("h3",null,Object(c.a)("Admin Tools")),r.a.createElement("div",{className:"mx_MemberInfo_buttons"},r.a.createElement(e,{className:"mx_MemberInfo_field",onClick:this.onKickClick},Object(c.a)("Revoke invite"))))),v.b.getValue("feature_spaces")&&this.room.isSpaceRoom()&&(t=r.a.createElement("div",{className:"mx_RightPanel_scopeHeader"},r.a.createElement(p.a,{room:this.room,height:32,width:32}),r.a.createElement(g.a,{room:this.room}))),r.a.createElement("div",{className:"mx_MemberInfo",role:"tabpanel"},t,r.a.createElement("div",{className:"mx_MemberInfo_name"},r.a.createElement(e,{className:"mx_MemberInfo_cancel",onClick:this.onCancel,title:Object(c.a)("Close")}),r.a.createElement("h2",null,this.state.displayName)),r.a.createElement("div",{className:"mx_MemberInfo_container"},r.a.createElement("div",{className:"mx_MemberInfo_profile"},r.a.createElement("div",{className:"mx_MemberInfo_profileField"},Object(c.a)("Invited by %(sender)s",{sender:this.state.senderName})))),a)}})||n},1416:function(e,t,a){"use strict";var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(514),u=a(97),h=a(99),p=a(383),g=a(93),f=a(336),v=a(183),b=a(836),y=a(94);let E=Object(y.a)("structures.FilePanel")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"decryptingEvents",new Set),o()(this,"state",{timelineSet:null}),o()(this,"onRoomTimeline",(e,t,a,n,s)=>{var i;if((null==t?void 0:t.roomId)!==(null===(i=this.props)||void 0===i?void 0:i.roomId))return;if(a||!s||!s.liveEvent||e.isRedacted())return;h.a.get().decryptEventIfNeeded(e),e.isBeingDecrypted()?this.decryptingEvents.add(e.getId()):this.addEncryptedLiveEvent(e)}),o()(this,"onEventDecrypted",(e,t)=>{if(e.getRoomId()!==this.props.roomId)return;const a=e.getId();this.decryptingEvents.delete(a)&&(t||this.addEncryptedLiveEvent(e))}),o()(this,"onPaginationRequest",(e,t,a)=>{const n=h.a.get(),s=p.a.get(),i=this.props.roomId,o=n.getRoom(i);return n.isRoomEncrypted(i)&&null!==s?s.paginateTimelineWindow(o,e,t,a):e.paginate(t,a)})}addEncryptedLiveEvent(e,t){if(!this.state.timelineSet)return;const a=this.state.timelineSet.getLiveTimeline();"m.room.message"===e.getType()&&-1!=["m.file","m.image","m.video","m.audio"].indexOf(e.getContent().msgtype)&&(this.state.timelineSet.eventIdToTimeline(e.getId())||this.state.timelineSet.addEventToTimeline(e,a,!1))}async componentDidMount(){const e=h.a.get();await this.updateTimelineSet(this.props.roomId),h.a.get().isRoomEncrypted(this.props.roomId)&&null!==p.a.get()&&(e.on("Room.timeline",this.onRoomTimeline),e.on("Event.decrypted",this.onEventDecrypted))}componentWillUnmount(){const e=h.a.get();null!==e&&h.a.get().isRoomEncrypted(this.props.roomId)&&null!==p.a.get()&&(e.removeListener("Room.timeline",this.onRoomTimeline),e.removeListener("Event.decrypted",this.onEventDecrypted))}async fetchFileEventsServer(e){const t=h.a.get(),a=new m.a(t.credentials.userId);a.setDefinition({room:{timeline:{contains_url:!0,types:["m.room.message"]}}});const n=await t.getOrCreateFilter("FILTER_FILES_"+t.credentials.userId,a);a.filterId=n;return e.getOrCreateFilteredTimelineSet(a)}async updateTimelineSet(e){const t=h.a.get(),a=t.getRoom(e),n=p.a.get();if(this.noRoom=!a,a){let s;try{if(s=await this.fetchFileEventsServer(a),t.isRoomEncrypted(e)&&null!==n){const e=s.getLiveTimeline();await n.populateFileTimeline(s,e,a,10)}this.setState({timelineSet:s})}catch(e){console.error("Failed to get or create file panel filter",e)}}else console.error("Failed to add filtered timelineSet for FilePanel as no room!")}render(){if(h.a.get().isGuest())return l.a.createElement(f.b,{className:"mx_FilePanel mx_RoomView_messageListWrapper",onClose:this.props.onClose,previousPhase:v.c.RoomSummary},l.a.createElement("div",{className:"mx_RoomView_empty"},Object(g.a)("You must <a>register</a> to use this functionality",{},{a:e=>l.a.createElement("a",{href:"#/register",key:"sub"},e)})));if(this.noRoom)return l.a.createElement(f.b,{className:"mx_FilePanel mx_RoomView_messageListWrapper",onClose:this.props.onClose,previousPhase:v.c.RoomSummary},l.a.createElement("div",{className:"mx_RoomView_empty"},Object(g.a)("You must join the room to see its files")));const e=u.getComponent("structures.TimelinePanel"),t=u.getComponent("elements.Spinner"),a=l.a.createElement("div",{className:"mx_RightPanel_empty mx_FilePanel_empty"},l.a.createElement("h2",null,Object(g.a)("No files visible in this room")),l.a.createElement("p",null,Object(g.a)("Attach files from chat or just drag and drop them anywhere in a room."))),n=!this.noRoom&&h.a.get().isRoomEncrypted(this.props.roomId);return this.state.timelineSet?l.a.createElement(f.b,{className:"mx_FilePanel",onClose:this.props.onClose,previousPhase:v.c.RoomSummary,withoutScrollContainer:!0},l.a.createElement(b.b,{isRoomEncrypted:n,kind:b.a.Files}),l.a.createElement(e,{manageReadReceipts:!1,manageReadMarkers:!1,timelineSet:this.state.timelineSet,showUrlPreview:!1,onPaginationRequest:this.onPaginationRequest,tileShape:"file_grid",resizeNotifier:this.props.resizeNotifier,empty:a})):l.a.createElement(f.b,{className:"mx_FilePanel",onClose:this.props.onClose,previousPhase:v.c.RoomSummary},l.a.createElement(t,null))}},o()(s,"propTypes",{roomId:d.a.string.isRequired,onClose:d.a.func.isRequired}),n=s))||n;t.a=E},1417:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,s=a(88),i=a.n(s),o=a(93),r=a(99),l=a(336),c=a(94),d=a(506),m=a(168);let u=Object(c.a)("structures.NotificationPanel")(n=class extends i.a.PureComponent{render(){const e=i.a.createElement("div",{className:"mx_RightPanel_empty mx_NotificationPanel_empty"},i.a.createElement("h2",null,Object(o.a)("You’re all caught up")),i.a.createElement("p",null,Object(o.a)("You have no visible notifications.")));let t;const a=r.a.get().getNotifTimelineSet();return a?t=i.a.createElement(d.a,{manageReadReceipts:!1,manageReadMarkers:!1,timelineSet:a,showUrlPreview:!1,tileShape:"notif",empty:e}):(console.error("No notifTimelineSet available!"),t=i.a.createElement(m.a,null)),i.a.createElement(l.b,{className:"mx_NotificationPanel",onClose:this.props.onClose,withoutScrollContainer:!0},t)}})||n},1418:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));class n{constructor(e){this._event=e,this._serializedParts=null,this.caret=null}setEditorState(e,t){this._caret=e,this._serializedParts=t}hasEditorState(){return!!this._serializedParts}getSerializedParts(){return this._serializedParts}getCaret(){return this._caret}getEvent(){return this._event}}},1419:function(e,t,a){"use strict";a.d(t,"c",(function(){return U})),a.d(t,"a",(function(){return F}));var n=a(19),s=a.n(n),i=a(95),o=a.n(i),r=a(88),l=a.n(r),c=a(140),d=a(102),m=a.n(d),u=a(150),h=a(99),p=a(100),g=a(93),f=a(108),v=a(182),b=a(168),y=a(838),E=a(167),_=a(250),S=a(800),C=a(591),w=a(228),O=a(138),x=a(227),R=a(126),k=a(826),I=a(339),T=a(839),P=a(175),N=a(135),D=a(201);function j(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function A(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?j(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const M=e=>{var t,a,n,s,i;let{room:o,suggested:r,selected:d,hasPermissions:u,onToggleClick:p,onViewRoomClick:v,numChildRooms:b,children:y}=e;const _=h.a.get(),S="join"===(null===(t=_.getRoom(o.room_id))||void 0===t?void 0:t.getMyMembership())?_.getRoom(o.room_id):null,C=(null==S?void 0:S.name)||o.name||o.canonical_alias||(null===(a=o.aliases)||void 0===a?void 0:a[0])||(o.room_type===c.d.Space?Object(g.a)("Unnamed Space"):Object(g.a)("Unnamed Room")),[O,P]=Object(T.a)(!0),N=e=>{e.preventDefault(),e.stopPropagation(),v(!1)},j=e=>{e.preventDefault(),e.stopPropagation(),v(!0)};let A,M,U;S?A=l.a.createElement(f.a,{onClick:N,kind:"primary_outline"},Object(g.a)("View")):j&&(A=l.a.createElement(f.a,{onClick:j,kind:"primary"},Object(g.a)("Join"))),p&&(M=u?l.a.createElement(w.a,{checked:!!d,onChange:p}):l.a.createElement(I.a,{tooltip:Object(g.a)("You don't have permission"),onClick:e=>{e.stopPropagation()}},l.a.createElement(w.a,{disabled:!0}))),U=S?l.a.createElement(E.a,{room:S,width:20,height:20}):l.a.createElement(x.a,{name:C,idName:o.room_id,url:o.avatar_url?Object(R.b)(o.avatar_url).getSquareThumbnailHttp(20):null,width:20,height:20});let L=Object(g.a)("%(count)s members",{count:o.num_joined_members});void 0!==b&&(L+=" · "+Object(g.a)("%(count)s rooms",{count:b}));const F=(null==S||null===(n=S.currentState)||void 0===n||null===(s=n.getStateEvents(c.a.RoomTopic,""))||void 0===s||null===(i=s.getContent())||void 0===i?void 0:i.topic)||o.topic;let B;F&&(L+=" · "+F),r&&(B=l.a.createElement(k.a,{tooltip:Object(g.a)("This room is suggested as a good one to join")},Object(g.a)("Suggested")));const V=l.a.createElement(l.a.Fragment,null,U,l.a.createElement("div",{className:"mx_SpaceRoomDirectory_roomTile_name"},C,B),l.a.createElement("div",{className:"mx_SpaceRoomDirectory_roomTile_info",ref:e=>e&&Object(D.g)(e),onClick:e=>{"A"===e.target.tagName&&e.stopPropagation()}},L),l.a.createElement("div",{className:"mx_SpaceRoomDirectory_actions"},A,M));let G,z;return y&&(G=l.a.createElement("div",{className:m()("mx_SpaceRoomDirectory_subspace_toggle",{mx_SpaceRoomDirectory_subspace_toggle_shown:O}),onClick:e=>{e.stopPropagation(),P()}}),O&&(z=l.a.createElement("div",{className:"mx_SpaceRoomDirectory_subspace_children"},y))),l.a.createElement(l.a.Fragment,null,l.a.createElement(f.a,{className:m()("mx_SpaceRoomDirectory_roomTile",{mx_SpaceRoomDirectory_subspace:o.room_type===c.d.Space}),onClick:u&&p?p:N},V,G),z)},U=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(h.a.get().isGuest()&&!e.world_readable&&!e.guest_can_join)return void p.a.dispatch({action:"require_registration"});const n=B(e)||void 0;p.a.dispatch({action:"view_room",auto_join:a,should_peek:!0,_type:"room_directory",room_alias:n,room_id:e.room_id,via_servers:t,oob_data:{avatarUrl:e.avatar_url,name:e.name||n||Object(g.a)("Unnamed room")}})},L=e=>{var t;let{spaceId:a,rooms:n,relations:s,parents:i,selectedMap:o,onViewRoomClick:r,onToggleClick:d}=e;const m=h.a.get(),p=m.getRoom(a),g=null==p?void 0:p.currentState.maySendStateEvent(c.a.SpaceChild,m.getUserId()),f=Array.from((null===(t=s.get(a))||void 0===t?void 0:t.values())||[]),v=Object(u.sortBy)(f,e=>Object(P.f)(e.content.order,null,e.state_key)),[b,y]=v.reduce((e,t)=>{const a=t.state_key;return n.has(a)?(e[n.get(a).room_type===c.d.Space?0:1].push(a),e):e},[[],[]])||[[],[]],E=new Set(i).add(a);return l.a.createElement(l.a.Fragment,null,y.map(e=>{var t,i,c;return l.a.createElement(M,{key:e,room:n.get(e),suggested:null===(t=s.get(a))||void 0===t||null===(i=t.get(e))||void 0===i?void 0:i.content.suggested,selected:null==o||null===(c=o.get(a))||void 0===c?void 0:c.has(e),onViewRoomClick:t=>{r(e,t)},hasPermissions:g,onToggleClick:d?()=>d(a,e):void 0})}),b.filter(e=>!E.has(e)).map(e=>{var t,i,c,m;return l.a.createElement(M,{key:e,room:n.get(e),numChildRooms:Array.from((null===(t=s.get(e))||void 0===t?void 0:t.values())||[]).filter(e=>n.has(e.state_key)&&!n.get(e.state_key).room_type).length,suggested:null===(i=s.get(a))||void 0===i||null===(c=i.get(e))||void 0===c?void 0:c.content.suggested,selected:null==o||null===(m=o.get(a))||void 0===m?void 0:m.has(e),onViewRoomClick:t=>{r(e,t)},hasPermissions:g,onToggleClick:d?()=>d(a,e):void 0},l.a.createElement(L,{spaceId:e,rooms:n,relations:s,parents:E,selectedMap:o,onViewRoomClick:r,onToggleClick:d}))}))},F=e=>{let{space:t,initialText:a="",showRoom:n,refreshToken:s,additionalButtons:i,children:d}=e;const m=h.a.get(),u=m.getUserId(),[p,v]=Object(r.useState)(a),[E,_]=Object(r.useState)(new Map),[w,x,R,k,I]=((e,t,a)=>Object(S.a)(async()=>{try{const a=await e.getSpaceSummary(t.roomId),n=new C.a,s=new C.a,i=new C.a;return a.events.map(e=>{if(e.type===c.a.SpaceChild&&(n.getOrCreate(e.room_id,new Map).set(e.state_key,e),s.getOrCreate(e.state_key,new Set).add(e.room_id)),Array.isArray(e.content.via)){const t=i.getOrCreate(e.state_key,new Set);e.content.via.forEach(e=>t.add(e))}}),[null,a.rooms,n,i,s]}catch(e){return console.error(e),[e]}},[t,a],[void 0]))(m,t,s),T=Object(r.useMemo)(()=>{if(!x)return null;const e=p.toLowerCase().trim(),t=new Map(x.map(e=>[e.room_id,e]));if(!e)return t;const a=x.filter(t=>{var a,n;return(null===(a=t.name)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(n=t.topic)||void 0===n?void 0:n.toLowerCase().includes(e))}),n=new Set,s=[...a.map(e=>e.room_id)];for(;s.length;){var i;const e=s.pop();n.add(e),null===(i=I.get(e))||void 0===i||i.forEach(e=>{n.has(e)||s.push(e)})}return Array.from(t.keys()).forEach(e=>{n.has(e)||t.delete(e)}),t},[x,I,p]),[P,D]=Object(r.useState)(""),[j,M]=Object(r.useState)(!1),[U,F]=Object(r.useState)(!1);if(w)return l.a.createElement("p",null,Object(g.a)("Your server does not support showing space hierarchies."));let B;if(T){const e=Array.from(T.values()).filter(e=>!e.room_type).length,a=T.size-e-1;let s,r,h;if(s=a>1?Object(g.a)("%(count)s rooms and %(numSpaces)s spaces",{count:e,numSpaces:a}):a>0?Object(g.a)("%(count)s rooms and 1 space",{count:e,numSpaces:a}):Object(g.a)("%(count)s rooms",{count:e,numSpaces:a}),"join"===t.getMyMembership()&&t.currentState.maySendStateEvent(c.a.SpaceChild,u)){const e=Array.from(E.keys()).flatMap(e=>[...E.get(e).values()].map(t=>[e,t])),t=e.every(e=>{var t,a;let[n,s]=e;return null===(t=R.get(n))||void 0===t||null===(a=t.get(s))||void 0===a?void 0:a.content.suggested}),a=!e.length||j||U;let n=f.a,s={};e.length||(n=N.a,s={tooltip:Object(g.a)("Select a room below first"),yOffset:-40}),r=l.a.createElement(l.a.Fragment,null,l.a.createElement(n,o()({},s,{onClick:async()=>{M(!0);try{for(const[t,a]of e)await m.sendStateEvent(t,c.a.SpaceChild,{},a),R.get(t).delete(a),R.get(t).size>0?R.set(t,new Map(R.get(t))):R.delete(t)}catch(e){D(Object(g.a)("Failed to remove some rooms. Try again later"))}M(!1)},kind:"danger_outline",disabled:a}),j?Object(g.a)("Removing..."):Object(g.a)("Remove")),l.a.createElement(n,o()({},s,{onClick:async()=>{F(!0);try{for(const[s,i]of e){var a,n;const e=!t,o=null===(a=R.get(s))||void 0===a||null===(n=a.get(i))||void 0===n?void 0:n.content;if(!o||o.suggested===e)continue;const r=A(A({},o),{},{suggested:!t});await m.sendStateEvent(s,c.a.SpaceChild,r,i),R.get(s).get(i).content=r,R.set(s,new Map(R.get(s)))}}catch(e){D("Failed to update some suggestions. Try again later")}F(!1)},kind:"primary_outline",disabled:a}),U?Object(g.a)("Saving..."):t?Object(g.a)("Mark as not suggested"):Object(g.a)("Mark as suggested")))}if(T.size){const e=null==t?void 0:t.currentState.maySendStateEvent(c.a.SpaceChild,m.getUserId());h=l.a.createElement(l.a.Fragment,null,l.a.createElement(L,{spaceId:t.roomId,rooms:T,relations:R,parents:new Set,selectedMap:E,onToggleClick:e?(e,t)=>{if(D(""),!E.has(e))return void _(new Map(E.set(e,new Set([t]))));const a=E.get(e);a.has(t)?(a.delete(t),_(new Map(E.set(e,new Set(a))))):_(new Map(E.set(e,new Set([...a,t]))))}:void 0,onViewRoomClick:(e,t)=>{n(T.get(e),Array.from(k.get(e)||[]),t)}}),d&&l.a.createElement("hr",null))}else h=l.a.createElement("div",{className:"mx_SpaceRoomDirectory_noResults"},l.a.createElement("h3",null,Object(g.a)("No results found")),l.a.createElement("div",null,Object(g.a)("You may want to try a different search or check for typos.")));B=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_SpaceRoomDirectory_listHeader"},s,l.a.createElement("span",null,i,r)),P&&l.a.createElement("div",{className:"mx_SpaceRoomDirectory_error"},P),l.a.createElement(O.a,{className:"mx_SpaceRoomDirectory_list"},h,d))}else B=l.a.createElement(b.a,null);return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,{className:"mx_textinput_icon mx_textinput_search",placeholder:Object(g.a)("Search names and descriptions"),onSearch:v,autoFocus:!0,initialValue:a}),B)};function B(e){return e.canonical_alias||(e.aliases?e.aliases[0]:"")}t.b=e=>{let{space:t,onFinished:a,initialText:n}=e;const s=()=>{p.a.dispatch({action:"view_create_room",public:!0}),a()},i=l.a.createElement(l.a.Fragment,null,l.a.createElement(E.a,{room:t,height:32,width:32}),l.a.createElement("div",null,l.a.createElement("h1",null,Object(g.a)("Explore rooms")),l.a.createElement("div",null,l.a.createElement(_.a,{room:t}))));return l.a.createElement(v.a,{className:"mx_SpaceRoomDirectory",hasCancel:!0,onFinished:a,title:i},l.a.createElement("div",{className:"mx_Dialog_content"},Object(g.a)("If you can't find the room you're looking for, ask for an invite or <a>create a new room</a>.",null,{a:e=>l.a.createElement(f.a,{kind:"link",onClick:s},e)}),l.a.createElement(F,{space:t,showRoom:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];U(e,t,n),a()},initialText:n},l.a.createElement(f.a,{onClick:s,kind:"primary",className:"mx_SpaceRoomDirectory_createRoom"},Object(g.a)("Create room")))))}},142:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c}));var n=a(19),s=a.n(n),i=a(8),o=a(1315),r=a.n(o);const l="update";class c extends i.EventEmitter{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.dispatcher=e,s()(this,"storeState",void 0),s()(this,"lock",new r.a),s()(this,"dispatcherRef",void 0),this.dispatcherRef=e.register(this.onDispatch.bind(this)),this.storeState=t}get state(){return this.storeState}stop(){this.dispatcherRef&&this.dispatcher.unregister(this.dispatcherRef)}async updateState(e){await this.lock.acquireAsync();try{this.storeState=Object.freeze(Object.assign({},this.storeState,e)),this.emit(l,this)}finally{await this.lock.release()}}async reset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];await this.lock.acquireAsync();try{this.storeState=Object.freeze(e||{}),t||this.emit(l,this)}finally{await this.lock.release()}}}},1420:function(e,t,a){"use strict";var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(150),d=a(278),m=a(93),u=a(185),h=a(339),p=a(803),g=a(119);const f=["room","onlyKnownUsers","numShown"],v=5,b=e=>{var t;return!(null===(t=u.a.shared().getDMRoomsForUserId(e.userId))||void 0===t||!t.length)};t.a=e=>{let{room:t,onlyKnownUsers:a=!0,numShown:n=v}=e,i=o()(e,f);const u=Object(r.useContext)(g.a);let y=Object(p.b)(t);const E=[e=>!!e.getMxcAvatarUrl()];a?y=y.filter(b):E.unshift(e=>b(e));const _=Object(c.sortBy)(y.filter(e=>e.userId!==u.getUserId()),E).slice(0,n);if(_.length<1)return null;const S=_.map(e=>e.rawDisplayName).reverse().join(", ");let C;return C=i.onClick?l.a.createElement("div",null,l.a.createElement("div",{className:"mx_Tooltip_title"},Object(m.a)("View all %(count)s members",{count:y.length})),l.a.createElement("div",{className:"mx_Tooltip_sub"},Object(m.a)("Including %(commaSeparatedMembers)s",{commaSeparatedMembers:S}))):Object(m.a)("%(count)s members including %(commaSeparatedMembers)s",{count:y.length,commaSeparatedMembers:S}),l.a.createElement("div",s()({},i,{className:"mx_FacePile"}),l.a.createElement(h.a,{class:"mx_FacePile_faces",tooltip:C,tooltipProps:{yOffset:32}},y.length>n?l.a.createElement("span",{className:"mx_FacePile_face mx_FacePile_more"}):null,_.map(e=>l.a.createElement(d.a,{key:e.userId,member:e,width:28,height:28,className:"mx_FacePile_face"}))),a&&l.a.createElement("span",{className:"mx_FacePile_summary"},Object(m.a)("%(count)s people you know have already joined",{count:y.length})))}},1421:function(e,t,a){"use strict";a.d(t,"a",(function(){return S}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(110),d=a(252),m=a(93),u=a(99),h=a(131),p=a(214),g=a(203),f=a(94),v=a(144),b=a(1422),y=a(281),E=a(303),_=a(182);let S=Object(f.a)("views.dialogs.CreateRoomDialog")((s=class e extends l.a.Component{constructor(t){super(t),o()(this,"nameField",Object(r.createRef)()),o()(this,"aliasField",Object(r.createRef)()),o()(this,"onKeyDown",e=>{e.key===h.a.ENTER&&(this.onOk(),e.preventDefault(),e.stopPropagation())}),o()(this,"onOk",async()=>{const e=document.activeElement;if(e&&e.blur(),await this.nameField.current.validate({allowEmpty:!1}),this.aliasField.current&&await this.aliasField.current.validate({allowEmpty:!1}),await new Promise(e=>this.setState({},e)),!this.state.nameIsValid||this.aliasField.current&&!this.aliasField.current.isValid){let e;this.state.nameIsValid?this.aliasField.current&&!this.aliasField.current.isValid&&(e=this.aliasField.current):e=this.nameField.current,e&&(e.focus(),e.validate({allowEmpty:!1,focused:!0}))}else this.props.onFinished(!0,this.roomCreateOptions())}),o()(this,"onCancel",()=>{this.props.onFinished(!1)}),o()(this,"onNameChange",e=>{this.setState({name:e.target.value})}),o()(this,"onTopicChange",e=>{this.setState({topic:e.target.value})}),o()(this,"onPublicChange",e=>{this.setState({isPublic:e})}),o()(this,"onEncryptedChange",e=>{this.setState({isEncrypted:e})}),o()(this,"onAliasChange",e=>{this.setState({alias:e})}),o()(this,"onDetailsToggled",e=>{this.setState({detailsOpen:e.target.open})}),o()(this,"onNoFederateChange",e=>{this.setState({noFederate:e})}),o()(this,"onNameValidate",async t=>{const a=await e.validateRoomName(t);return this.setState({nameIsValid:a.valid}),a});const a=c.a.get();this.state={isPublic:this.props.defaultPublic||!1,isEncrypted:Object(p.h)(),name:this.props.defaultName||"",topic:"",alias:"",detailsOpen:!1,noFederate:!1===a.default_federate,nameIsValid:!1,canChangeEncryption:!0},u.a.get().doesServerForceEncryptionForPreset("private").then(e=>this.setState({canChangeEncryption:!e}))}roomCreateOptions(){const e={},t=e.createOpts={};if(t.name=this.state.name,this.state.isPublic){t.visibility=p.b.Public,t.preset=p.a.PublicChat,e.guestAccess=!1;const{alias:a}=this.state;t.room_alias_name=a.substr(1,a.indexOf(":")-1)}return this.state.topic&&(t.topic=this.state.topic),this.state.noFederate&&(t.creation_content={"m.federate":!1}),this.state.isPublic||(this.state.canChangeEncryption?e.encryption=this.state.isEncrypted:e.encryption=!0),g.a.instance.getSelectedCommunityId()&&(e.associatedWithCommunity=g.a.instance.getSelectedCommunityId()),this.props.parentSpace&&(e.parentSpace=this.props.parentSpace),e}componentDidMount(){this.nameField.current.focus()}componentWillUnmount(){}render(){let e;if(this.state.isPublic){const t=u.a.get().getDomain();e=l.a.createElement("div",{className:"mx_CreateRoomDialog_aliasContainer"},l.a.createElement(b.a,{ref:this.aliasField,onChange:this.onAliasChange,domain:t,value:this.state.alias}))}let t,a=l.a.createElement("p",null,Object(m.a)("Private rooms can be found and joined by invitation only. Public rooms can be found and joined by anyone."));if(g.a.instance.getSelectedCommunityId()&&(a=l.a.createElement("p",null,Object(m.a)("Private rooms can be found and joined by invitation only. Public rooms can be found and joined by anyone in this community."))),!this.state.isPublic){let e;e=Object(p.h)()?this.state.canChangeEncryption?Object(m.a)("You can’t disable this later. Bridges & most bots won’t work yet."):Object(m.a)("Your server requires encryption to be enabled in private rooms."):Object(m.a)("Your server admin has disabled end-to-end encryption by default in private rooms & Direct Messages."),t=l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,{label:Object(m.a)("Enable end-to-end encryption"),onChange:this.onEncryptedChange,value:this.state.isEncrypted,className:"mx_CreateRoomDialog_e2eSwitch",disabled:!this.state.canChangeEncryption}),l.a.createElement("p",null,e))}let n=Object(m.a)("You might enable this if the room will only be used for collaborating with internal teams on your homeserver. This cannot be changed later.");!1===c.a.get().default_federate&&(n=Object(m.a)("You might disable this if the room will be used for collaborating with external teams who have their own homeserver. This cannot be changed later."));let s=this.state.isPublic?Object(m.a)("Create a public room"):Object(m.a)("Create a private room");if(g.a.instance.getSelectedCommunityId()){const e=g.a.instance.getSelectedCommunityName();s=Object(m.a)("Create a room in %(communityName)s",{communityName:e})}return l.a.createElement(_.a,{className:"mx_CreateRoomDialog",onFinished:this.props.onFinished,title:s},l.a.createElement("form",{onSubmit:this.onOk,onKeyDown:this.onKeyDown},l.a.createElement("div",{className:"mx_Dialog_content"},l.a.createElement(v.a,{ref:this.nameField,label:Object(m.a)("Name"),onChange:this.onNameChange,onValidate:this.onNameValidate,value:this.state.name,className:"mx_CreateRoomDialog_name"}),l.a.createElement(v.a,{label:Object(m.a)("Topic (optional)"),onChange:this.onTopicChange,value:this.state.topic,className:"mx_CreateRoomDialog_topic"}),l.a.createElement(y.a,{label:Object(m.a)("Make this room public"),onChange:this.onPublicChange,value:this.state.isPublic}),a,t,e,l.a.createElement("details",{onToggle:this.onDetailsToggled,className:"mx_CreateRoomDialog_details"},l.a.createElement("summary",{className:"mx_CreateRoomDialog_details_summary"},this.state.detailsOpen?Object(m.a)("Hide advanced"):Object(m.a)("Show advanced")),l.a.createElement(y.a,{label:Object(m.a)("Block anyone not part of %(serverName)s from ever joining this room.",{serverName:u.a.getHomeserverName()}),onChange:this.onNoFederateChange,value:this.state.noFederate}),l.a.createElement("p",null,n)))),l.a.createElement(E.a,{primaryButton:Object(m.a)("Create Room"),onPrimaryButtonClick:this.onOk,onCancel:this.onCancel}))}},o()(s,"validateRoomName",Object(d.a)({rules:[{key:"required",test:async e=>{let{value:t}=e;return!!t},invalid:()=>Object(m.a)("Please enter a name for the room")}]})),n=s))||n},1422:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n,s,i=a(19),o=a.n(i),r=a(93),l=a(88),c=a.n(l),d=a(92),m=a.n(d),u=a(97),h=a(252),p=a(99),g=a(94);let f=Object(g.a)("views.elements.RoomAliasField")((s=class extends c.a.PureComponent{constructor(e){super(e),o()(this,"_onChange",e=>{this.props.onChange&&this.props.onChange(this._asFullAlias(e.target.value))}),o()(this,"_onValidate",async e=>{const t=await this._validationRules(e);return this.setState({isValid:t.valid}),t}),o()(this,"_validationRules",Object(h.a)({rules:[{key:"safeLocalpart",test:async e=>{let{value:t}=e;if(!t)return!0;const a=this._asFullAlias(t);return!t.includes("#")&&!t.includes(":")&&!t.includes(",")&&encodeURI(a)===a},invalid:()=>Object(r.a)("Some characters not allowed")},{key:"required",test:async e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(r.a)("Please provide a room address")},{key:"taken",final:!0,test:async e=>{let{value:t}=e;if(!t)return!0;const a=p.a.get();try{return await a.getRoomIdForAlias(this._asFullAlias(t)),!1}catch(e){return!!e.errcode}},valid:()=>Object(r.a)("This address is available to use"),invalid:()=>Object(r.a)("This address is already in use")}]})),this.state={isValid:!0}}_asFullAlias(e){return`#${e}:${this.props.domain}`}render(){const e=u.getComponent("views.elements.Field"),t=c.a.createElement("span",null,"#"),a=":"+this.props.domain,n=c.a.createElement("span",{title:a},a),s=255-this.props.domain.length-2;return c.a.createElement(e,{label:Object(r.a)("Room address"),className:"mx_RoomAliasField",prefixComponent:t,postfixComponent:n,ref:e=>this._fieldRef=e,onValidate:this._onValidate,placeholder:Object(r.a)("e.g. my-room"),onChange:this._onChange,value:this.props.value.substring(1,this.props.value.length-this.props.domain.length-1),maxLength:s})}get isValid(){return this.state.isValid}validate(e){return this._fieldRef.validate(e)}focus(){this._fieldRef.focus()}},o()(s,"propTypes",{domain:m.a.string.isRequired,onChange:m.a.func,value:m.a.string.isRequired}),n=s))||n},1423:function(e,t){e.exports="img/icon-email-pill-avatar.575ff20.svg"},1424:function(e,t,a){"use strict";a.d(t,"a",(function(){return C}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(182),c=a(93),d=a(144),m=a(108),u=a(99),h=a(153),p=a(110),g=a(634),f=a(227),v=a(205),b=a(228),y=a(106),E=a(186),_=a(94),S=a(126);let C=Object(_.a)("views.dialogs.CommunityPrototypeInviteDialog")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"onSubmit",async e=>{e.preventDefault(),e.stopPropagation(),this.setState({busy:!0});try{const e=[...this.state.emailTargets,...this.state.userTargets],t=await Object(v.a)(this.props.roomId,e),a=u.a.get().getRoom(this.props.roomId);Object(v.d)(t.states,a,t.inviter)?this.props.onFinished(!0):this.setState({busy:!1})}catch(e){this.setState({busy:!1}),console.error(e),y.a.createTrackedDialog("Failed to invite","",E.a,{title:Object(c.a)("Failed to invite"),description:e&&e.message?e.message:Object(c.a)("Operation failed")})}}),i()(this,"onAddressChange",(e,t)=>{const a=Object(h.b)(this.state.emailTargets);t>=a.length?a.push(e.target.value):a[t]=e.target.value,this.setState({emailTargets:a})}),i()(this,"onAddressBlur",e=>{const t=Object(h.b)(this.state.emailTargets);e>=t.length||""===t[e].trim()&&(t.splice(e,1),this.setState({emailTargets:t}))}),i()(this,"onShowPeopleClick",()=>{this.setState({showPeople:!this.state.showPeople})}),i()(this,"setPersonToggle",(e,t)=>{const a=Object(h.b)(this.state.userTargets);t&&!a.includes(e.userId)?a.push(e.userId):!t&&a.includes(e.userId)&&a.splice(a.indexOf(e.userId),1),this.setState({userTargets:a})}),i()(this,"onShowMorePeople",()=>{this.setState({numPeople:this.state.numPeople+5})}),this.state={emailTargets:[],userTargets:[],showPeople:!1,people:this.buildSuggestions(),numPeople:5,busy:!1}}buildSuggestions(){const e=new Set([u.a.get().getUserId(),p.a.get().welcomeUserId]);if(this.props.roomId){const t=u.a.get().getRoom(this.props.roomId);if(!t)throw new Error("Room ID given to InviteDialog does not look like a room");t.getMembersWithMembership("invite").forEach(t=>e.add(t.userId)),t.getMembersWithMembership("join").forEach(t=>e.add(t.userId)),t.getMembersWithMembership("ban").forEach(t=>e.add(t.userId))}return g.d.buildRecents(e)}renderPerson(e,t){let a=null;return e.user.getMxcAvatarUrl()&&(a=Object(S.b)(e.user.getMxcAvatarUrl()).getSquareThumbnailHttp(36)),r.a.createElement("div",{className:"mx_CommunityPrototypeInviteDialog_person",key:t},r.a.createElement(f.a,{url:a,name:e.user.name,idName:e.user.userId,width:36,height:36}),r.a.createElement("div",{className:"mx_CommunityPrototypeInviteDialog_personIdentifiers"},r.a.createElement("span",{className:"mx_CommunityPrototypeInviteDialog_personName"},e.user.name),r.a.createElement("span",{className:"mx_CommunityPrototypeInviteDialog_personId"},e.userId)),r.a.createElement(b.a,{onChange:t=>this.setPersonToggle(e,t.target.checked)}))}render(){const e=[];this.state.emailTargets.forEach((t,a)=>{e.push(r.a.createElement(d.a,{key:a,value:t,onChange:e=>this.onAddressChange(e,a),label:Object(c.a)("Email address"),placeholder:Object(c.a)("Email address"),onBlur:()=>this.onAddressBlur(a)}))}),e.push(r.a.createElement(d.a,{key:e.length,value:"",onChange:t=>this.onAddressChange(t,e.length),label:e.length>0?Object(c.a)("Add another email"):Object(c.a)("Email address"),placeholder:e.length>0?Object(c.a)("Add another email"):Object(c.a)("Email address")}));let t=null;const a=[];if(this.state.showPeople){const e=this.state.people.slice(0,this.state.numPeople);e.forEach((e,t)=>{a.push(this.renderPerson(e,t))}),e.length<this.state.people.length&&a.push(r.a.createElement(m.a,{onClick:this.onShowMorePeople,kind:"link",key:"more",className:"mx_CommunityPrototypeInviteDialog_morePeople"},Object(c.a)("Show more")))}this.state.people.length>0&&(t=r.a.createElement("div",{className:"mx_CommunityPrototypeInviteDialog_people"},r.a.createElement("span",null,Object(c.a)("People you know on %(brand)s",{brand:p.a.get().brand})),r.a.createElement(m.a,{onClick:this.onShowPeopleClick},this.state.showPeople?Object(c.a)("Hide"):Object(c.a)("Show"))));let n=Object(c.a)("Skip");const s=this.state.userTargets.length+this.state.emailTargets.length;return s>0&&(n=Object(c.a)("Send %(count)s invites",{count:s})),r.a.createElement(l.a,{className:"mx_CommunityPrototypeInviteDialog",onFinished:this.props.onFinished,title:Object(c.a)("Invite people to join %(communityName)s",{communityName:this.props.communityName})},r.a.createElement("form",{onSubmit:this.onSubmit},r.a.createElement("div",{className:"mx_Dialog_content"},e,t,a,r.a.createElement(m.a,{kind:"primary",onClick:this.onSubmit,disabled:this.state.busy,className:"mx_CommunityPrototypeInviteDialog_primaryButton"},n))))}})||n},1425:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(19),s=a.n(n),i=a(477),o=a(8),r=a(1),l=a(150);class c extends o.EventEmitter{constructor(){super(),s()(this,"_search",""),s()(this,"callUpdate",Object(l.throttle)(()=>{this.emit(i.a)},200,{trailing:!0,leading:!0}))}get kind(){return i.b.Runtime}get search(){return this._search}set search(e){this._search=e,this.callUpdate()}isVisible(e){const t=this.search.toLowerCase();if("#"===this.search[0]){if(e.getCanonicalAlias()&&e.getCanonicalAlias().toLowerCase().startsWith(t))return!0;if(e.getAltAliases().some(e=>e.toLowerCase().startsWith(t)))return!0}return!!e.name&&this.matches(e.normalizedName)}matches(e){return e.includes(Object(r.q)(this.search))}}},1426:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(19),s=a.n(n),i=a(847),o=a(1429),r=a(237),l=a(100),c=a(1430),d=a(1431),m=a(1432);const u=e=>"room-"+e.roomId;class h extends r.a{constructor(){super(l.a),s()(this,"caches",new Map)}static get instance(){return h._instance||(h._instance=new h),h._instance}get contexts(){return Array.from(this.caches.values()).map(e=>e.context)}getOrCreateChamberForRoom(e){if(this.caches.has(u(e)))return this.caches.get(u(e));const t=new o.a(e);t.whenAnything(()=>this.checkContexts());const a=new i.b(t);return a.setClient(this.matrixClient),this.caches.set(u(e),a),a}async checkContexts(){let e=!1;for(const t of this.caches.values())if(e=t.context.state===c.a.PendingErrors,e)break;if(e&&!this.state.toastRef){const e=d.a.instance.addToast(m.a);await this.updateState({toastRef:e})}else!e&&this.state.toastRef&&(d.a.instance.removeToast(this.state.toastRef),await this.updateState({toastRef:null}))}async onReady(){if(this.caches)for(const e of this.caches.values())e.setClient(this.matrixClient)}async onNotReady(){for(const e of this.caches.values())e.setClient(null)}async onAction(e){return Promise.resolve()}}s()(h,"_instance",void 0)},1427:function(e,t,a){"use strict";a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c}));var n=a(19),s=a.n(n),i=a(848),o=a(8);async function r(){}const l="property_updated";class c extends o.EventEmitter{constructor(e,t){super(),this.context=e,this.lookupFn=t,s()(this,"cache",new Map),s()(this,"matrixClient",void 0)}setClient(e){const t=this.matrixClient;this.matrixClient=e,this.onClientChanged(t,e)}getValue(e){return this.cache.has(e)?this.cache.get(e).val:this.lookupFn(e)}cacheVal(e,t,a){this.cache.set(e,{txn:a,val:t}),this.emit(l,e)}decacheKey(e){this.cache.has(e)&&(this.context.disownTransaction(this.cache.get(e).txn),this.cache.delete(e),this.emit(l,e))}markEchoReceived(e){if(this.cache.has(e)){const t=this.cache.get(e).txn;this.context.disownTransaction(t),t.cancel()}this.decacheKey(e)}setValue(e,t,a,n,s){this.cache.has(t)&&this.cache.get(t).txn.cancel();const o=this.context.beginTransaction(e,n);this.cacheVal(t,a,o),o.when(i.b.Pending,()=>this.cacheVal(t,a,o)).when(i.b.Error,()=>s()),o.run()}}},1428:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(19),s=a.n(n),i=a(153);class o{constructor(){s()(this,"listeners",[])}when(e,t){return this.listeners.push({condition:e,fn:t}),this}whenAnyOf(e,t){for(const a of e)this.when(a,t);return this}whenAnything(e){return this.listeners.push({condition:null,fn:e}),this}notifyCondition(e){const t=Object(i.b)(this.listeners);for(const a of t)if(null===a.condition||a.condition===e)try{a.fn(this)}catch(t){console.error(`Error calling whenable listener for ${e}:`,t)}}destroy(){this.listeners=[]}}},1429:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(1430);class s extends n.b{constructor(e){super(),this.room=e}}},1430:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return c}));var n=a(19),s=a.n(n),i=a(848),o=a(153),r=a(1428);let l;!function(e){e[e.NotStarted=0]="NotStarted",e[e.PendingErrors=1]="PendingErrors",e[e.AllSuccessful=2]="AllSuccessful"}(l||(l={}));class c extends r.a{constructor(){super(...arguments),s()(this,"_transactions",[]),s()(this,"_state",l.NotStarted),s()(this,"checkTransactions",()=>{let e=l.AllSuccessful;for(const t of this.transactions){if(t.status===i.b.Error||t.didPreviouslyFail){e=l.PendingErrors;break}t.status===i.b.Pending&&(e=l.NotStarted)}this._state=e,this.notifyCondition(e)})}get transactions(){return Object(o.b)(this._transactions)}get state(){return this._state}get firstFailedTime(){const e=this.transactions.find(e=>e.didPreviouslyFail||e.status===i.b.Error);return e?e.startTime:null}disownTransaction(e){const t=this._transactions.indexOf(e);t>=0&&this._transactions.splice(t,1),e.destroy(),this.checkTransactions()}beginTransaction(e,t){const a=new i.a(e,t);return this._transactions.push(a),a.whenAnything(this.checkTransactions),a.when(i.b.Success,()=>a.destroy()),a}destroy(){for(const e of this.transactions)e.destroy();this._transactions=[],super.destroy()}}},1431:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(19),s=a.n(n),i=a(8),o=a.n(i),r=a(142);class l extends o.a{constructor(){super(...arguments),s()(this,"toasts",new Map)}static get instance(){return l._instance||(l._instance=new l),l._instance}get components(){return Array.from(this.toasts.values())}addToast(e){const t=Symbol();return this.toasts.set(t,e),this.emit(r.b),t}removeToast(e){this.toasts.delete(e),this.emit(r.b)}}s()(l,"_instance",void 0)},1432:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(108),d=a(106),m=a(1433),u=a(94);let h=Object(u.a)("views.toasts.NonUrgentEchoFailureToast")(n=class extends r.a.PureComponent{constructor(){super(...arguments),i()(this,"openDialog",()=>{d.a.createTrackedDialog("Local Echo Server Error","",m.a,{})})}render(){return r.a.createElement("div",{className:"mx_NonUrgentEchoFailureToast"},r.a.createElement("span",{className:"mx_NonUrgentEchoFailureToast_icon"}),Object(l.a)("Your server isn't responding to some <a>requests</a>.",{},{a:e=>r.a.createElement(c.a,{kind:"link",onClick:this.openDialog},e)}))}})||n},1433:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n,s=a(19),i=a.n(s),o=a(88),r=a(182),l=a(93),c=a(1426),d=a(222),m=a(103),u=a(1429),h=a(167),p=a(848),g=a(168),f=a(108),v=a(142),b=a(99),y=a(94);let E=Object(y.a)("views.dialogs.ServerOfflineDialog")(n=class extends o.PureComponent{constructor(){super(...arguments),i()(this,"onEchosUpdated",()=>{this.forceUpdate()})}componentDidMount(){c.a.instance.on(v.b,this.onEchosUpdated)}componentWillUnmount(){c.a.instance.off(v.b,this.onEchosUpdated)}renderTimeline(){return c.a.instance.contexts.map((e,t)=>{if(!e.firstFailedTime)return null;if(!(e instanceof u.a))throw new Error("Cannot render unknown context: "+e);const a=o.createElement("div",{className:"mx_ServerOfflineDialog_content_context_timeline_header"},o.createElement(h.a,{width:24,height:24,room:e.room}),o.createElement("span",null,e.room.name)),n=e.transactions.filter(e=>e.status===p.b.Error||e.didPreviouslyFail).map((e,t)=>{let a=o.createElement(g.a,{w:19,h:19});return e.status===p.b.Error&&(a=o.createElement(f.a,{kind:"link",onClick:()=>e.run()},Object(l.a)("Resend"))),o.createElement("div",{className:"mx_ServerOfflineDialog_content_context_txn",key:"txn-"+t},o.createElement("span",{className:"mx_ServerOfflineDialog_content_context_txn_desc"},e.auditName),a)});return o.createElement("div",{className:"mx_ServerOfflineDialog_content_context",key:"context-"+t},o.createElement("div",{className:"mx_ServerOfflineDialog_content_context_timestamp"},Object(d.e)(e.firstFailedTime,m.b.getValue("showTwelveHourTimestamps"))),o.createElement("div",{className:"mx_ServerOfflineDialog_content_context_timeline"},a,n))})}render(){let e=this.renderTimeline().filter(e=>!!e);0===e.length&&(e=[o.createElement("div",{key:1},Object(l.a)("You're all caught up."))]);const t=b.a.getHomeserverName();return o.createElement(r.a,{title:Object(l.a)("Server isn't responding"),className:"mx_ServerOfflineDialog",contentId:"mx_Dialog_content",onFinished:this.props.onFinished,hasCancel:!0},o.createElement("div",{className:"mx_ServerOfflineDialog_content"},o.createElement("p",null,Object(l.a)("Your server isn't responding to some of your requests. Below are some of the most likely reasons.")),o.createElement("ul",null,o.createElement("li",null,Object(l.a)("The server (%(serverName)s) took too long to respond.",{serverName:t})),o.createElement("li",null,Object(l.a)("Your firewall or anti-virus is blocking the request.")),o.createElement("li",null,Object(l.a)("A browser extension is preventing the request.")),o.createElement("li",null,Object(l.a)("The server is offline.")),o.createElement("li",null,Object(l.a)("The server has denied your request.")),o.createElement("li",null,Object(l.a)("Your area is experiencing difficulties connecting to the internet.")),o.createElement("li",null,Object(l.a)("A connection error occurred while trying to contact the server.")),o.createElement("li",null,Object(l.a)("The server is not configured to indicate what the problem is (CORS)."))),o.createElement("hr",null),o.createElement("h2",null,Object(l.a)("Recent changes that have not yet been received")),e))}})||n},1434:function(e,t,a){"use strict";a.d(t,"b",(function(){return C})),a.d(t,"a",(function(){return w}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(99),h=a(799),p=a(100),g=a(428),f=a(115),v=a(94),b=a(146),y=a(269),E=a(304),_=a(108),S=a(251);function C(e){return e?e.getPendingEvents().filter((function(e){return e.status===b.a.NOT_SENT})):[]}let w=Object(v.a)("structures.RoomStatusBar")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"state",{syncState:u.a.get().getSyncState(),syncStateData:u.a.get().getSyncStateData(),unsentMessages:C(this.props.room),isResending:!1}),o()(this,"onSyncStateChange",(e,t,a)=>{"SYNCING"===e&&"SYNCING"===t||this.setState({syncState:e,syncStateData:a})}),o()(this,"_onResendAllClick",()=>{h.a.resendUnsentEvents(this.props.room).then(()=>{this.setState({isResending:!1})}),this.setState({isResending:!0}),p.a.fire(f.a.FocusComposer)}),o()(this,"_onCancelAllClick",()=>{h.a.cancelUnsentEvents(this.props.room),p.a.fire(f.a.FocusComposer)}),o()(this,"_onRoomLocalEchoUpdated",(e,t,a,n)=>{if(t.roomId!==this.props.room.roomId)return;const s=C(this.props.room);this.setState({unsentMessages:s,isResending:s.length>0&&this.state.isResending})})}componentDidMount(){u.a.get().on("sync",this.onSyncStateChange),u.a.get().on("Room.localEchoUpdated",this._onRoomLocalEchoUpdated),this._checkSize()}componentDidUpdate(){this._checkSize()}componentWillUnmount(){const e=u.a.get();e&&(e.removeListener("sync",this.onSyncStateChange),e.removeListener("Room.localEchoUpdated",this._onRoomLocalEchoUpdated))}_checkSize(){this._getSize()?this.props.onVisible&&this.props.onVisible():this.props.onHidden&&this.props.onHidden()}_getSize(){return this._shouldShowConnectionError()?1:this.state.unsentMessages.length>0||this.state.isResending?2:0}_shouldShowConnectionError(){const e=Boolean(this.state.syncStateData&&this.state.syncStateData.error&&"M_RESOURCE_LIMIT_EXCEEDED"===this.state.syncStateData.error.errcode);return"ERROR"===this.state.syncState&&!e}_getUnsentMessageContent(){const e=this.state.unsentMessages;let t,a=null,n=null;for(const t of e){if(t.error&&"M_CONSENT_NOT_GIVEN"===t.error.errcode){a=t.error;break}if(t.error&&"M_RESOURCE_LIMIT_EXCEEDED"===t.error.errcode){n=t.error;break}}t=a?Object(m.a)("You can't send any messages until you review and agree to <consentLink>our terms and conditions</consentLink>.",{},{consentLink:e=>l.a.createElement("a",{href:a.data&&a.data.consent_uri,target:"_blank"},e)}):n?Object(g.a)(n.data.limit_type,n.data.admin_contact,{monthly_active_user:Object(m.b)("Your message wasn't sent because this homeserver has hit its Monthly Active User Limit. Please <a>contact your service administrator</a> to continue using the service."),hs_disabled:Object(m.b)("Your message wasn't sent because this homeserver has been blocked by it's administrator. Please <a>contact your service administrator</a> to continue using the service."),"":Object(m.b)("Your message wasn't sent because this homeserver has exceeded a resource limit. Please <a>contact your service administrator</a> to continue using the service.")}):Object(m.a)("Some of your messages have not been sent");let s=l.a.createElement(l.a.Fragment,null,l.a.createElement(_.a,{onClick:this._onCancelAllClick,className:"mx_RoomStatusBar_unsentCancelAllBtn"},Object(m.a)("Delete all")),l.a.createElement(_.a,{onClick:this._onResendAllClick,className:"mx_RoomStatusBar_unsentResendAllBtn"},Object(m.a)("Retry all")));return this.state.isResending&&(s=l.a.createElement(l.a.Fragment,null,l.a.createElement(S.a,{w:20,h:20}),l.a.createElement("span",null,Object(m.a)("Sending")))),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_RoomStatusBar mx_RoomStatusBar_unsentMessages"},l.a.createElement("div",{role:"alert"},l.a.createElement("div",{className:"mx_RoomStatusBar_unsentBadge"},l.a.createElement(y.a,{notification:E.a.RED_EXCLAMATION})),l.a.createElement("div",null,l.a.createElement("div",{className:"mx_RoomStatusBar_unsentTitle"},t),l.a.createElement("div",{className:"mx_RoomStatusBar_unsentDescription"},Object(m.a)("You can select all or individual messages to retry or delete"))),l.a.createElement("div",{className:"mx_RoomStatusBar_unsentButtonBar"},s))))}render(){return this._shouldShowConnectionError()?l.a.createElement("div",{className:"mx_RoomStatusBar"},l.a.createElement("div",{role:"alert"},l.a.createElement("div",{className:"mx_RoomStatusBar_connectionLostBar"},l.a.createElement("img",{src:a(1389),width:"24",height:"24",title:"/!\\ ",alt:"/!\\ "}),l.a.createElement("div",null,l.a.createElement("div",{className:"mx_RoomStatusBar_connectionLostBar_title"},Object(m.a)("Connectivity to the server has been lost.")),l.a.createElement("div",{className:"mx_RoomStatusBar_connectionLostBar_desc"},Object(m.a)("Sent messages will be stored until your connection has returned.")))))):this.state.unsentMessages.length>0||this.state.isResending?this._getUnsentMessageContent():null}},o()(s,"propTypes",{room:d.a.object.isRequired,isPeeking:d.a.bool,onResendAllClick:d.a.func,onCancelAllClick:d.a.func,onInviteClick:d.a.func,onResize:d.a.func,onHidden:d.a.func,onVisible:d.a.func}),n=s))||n},1435:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=(a(127),a(161)),c=a(847),d=a(94);let m=Object(d.a)("views.rooms.MenuTile")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"roomTileRef",Object(o.createRef)()),i()(this,"onRoomNameUpdate",e=>{this.forceUpdate()}),i()(this,"onNotificationUpdate",()=>{this.forceUpdate()}),i()(this,"onRoomPropertyUpdate",e=>{e===c.a.NotificationVolume&&this.onNotificationUpdate()}),i()(this,"onTileClick",e=>{e.preventDefault(),e.stopPropagation(),alert("Test")})}get showContextMenu(){return this.props.tag!==l.a.Invite}get showMessagePreview(){return!this.props.isMinimized&&this.props.showMessagePreview}componentDidUpdate(e,t){e.showMessagePreview,this.props.showMessagePreview}componentDidMount(){}componentWillUnmount(){}render(){this.props.path;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mx_LeftPanel_filterContainer"},r.a.createElement("a",{href:this.props.path},this.props.title)))}})||n},1437:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));var n,s=a(19),i=a.n(s),o=a(95),r=a.n(o),l=a(88),c=a.n(l),d=a(102),m=a.n(d),u=a(93),h=a(99),p=a(97),g=a(100),f=a(853),v=a(155),b=a(343),y=a(280),E=a(103),_=a(127),S=a(135),C=a(854),w=a(147),O=a(142),x=a(94),R=a(855),k=a(858),I=a(441),T=a(293);function P(e){return c.a.createElement(S.a,{className:"mx_MessageComposer_sendMessage",onClick:e.onClick,title:Object(u.a)("Send message")})}const N=e=>{let{addEmoji:t}=e;const[a,n,s,i]=Object(_.q)();let o;if(a){const e=n.current.getBoundingClientRect(),a=p.getComponent("emojipicker.EmojiPicker");o=c.a.createElement(_.b,r()({},Object(_.k)(e),{onFinished:i,managed:!1}),c.a.createElement(a,{onChoose:t,showQuickReactions:!0}))}const l=m()("mx_MessageComposer_button","mx_MessageComposer_emoji",{mx_MessageComposer_button_highlight:a});return c.a.createElement(c.a.Fragment,null,c.a.createElement(_.d,{className:l,onClick:s,isExpanded:a,title:Object(u.a)("Emoji picker"),inputRef:n}),o)};class D extends c.a.Component{constructor(e){super(e),i()(this,"uploadInput",c.a.createRef()),i()(this,"dispatcherRef",void 0),i()(this,"onAction",e=>{"upload_file"===e.action&&this.onUploadClick()}),i()(this,"onUploadClick",()=>{h.a.get().isGuest()?g.a.dispatch({action:"require_registration"}):this.uploadInput.current.click()}),i()(this,"onUploadFileInputChange",e=>{if(0===e.target.files.length)return;const t=[];for(let a=0;a<e.target.files.length;++a)t.push(e.target.files[a]);b.a.sharedInstance().sendContentListToRoom(t,this.props.roomId,h.a.get()),e.target.value=""}),this.dispatcherRef=g.a.register(this.onAction)}componentWillUnmount(){g.a.unregister(this.dispatcherRef)}render(){return c.a.createElement(S.a,{className:"mx_MessageComposer_button mx_MessageComposer_upload",onClick:this.onUploadClick,title:Object(u.a)("Upload file")},c.a.createElement("input",{ref:this.uploadInput,type:"file",style:{display:"none"},multiple:!0,onChange:this.onUploadFileInputChange}))}}let j=Object(x.a)("views.rooms.MessageComposer")(n=class extends c.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"messageComposerInput",void 0),i()(this,"voiceRecordingButton",void 0),i()(this,"onAction",e=>{"reply_to_event"===e.action&&setTimeout(()=>{this.props.resizeNotifier.notifyTimelineHeightChanged()},100)}),i()(this,"onRoomStateEvents",(e,t)=>{e.getRoomId()===this.props.room.roomId&&("m.room.tombstone"===e.getType()&&this.setState({tombstone:this.getRoomTombstone()}),"m.room.power_levels"===e.getType()&&this.setState({canSendMessages:this.props.room.maySendMessage()}))}),i()(this,"onTombstoneClick",e=>{e.preventDefault();const t=this.state.tombstone.getContent().replacement_room,a=h.a.get().getRoom(t);let n=null;if(a){const e=a.currentState.getStateEvents("m.room.create","");e&&e.getId()&&(n=e.getId())}const s=[this.state.tombstone.getSender().split(":").splice(1).join(":")];g.a.dispatch({action:"view_room",highlighted:!0,event_id:n,room_id:t,auto_join:!0,_type:"tombstone",via_servers:s,opts:{viaServers:s}})}),i()(this,"renderPlaceholderText",()=>this.props.replyToEvent?this.props.e2eStatus?Object(u.a)("Send an encrypted reply…"):Object(u.a)("Send a reply…"):this.props.e2eStatus?Object(u.a)("Send an encrypted message…"):Object(u.a)("Send a message…")),i()(this,"sendMessage",async()=>{this.state.haveRecording&&this.voiceRecordingButton?await this.voiceRecordingButton.send():this.messageComposerInput._sendMessage()}),i()(this,"onChange",e=>{this.setState({isComposerEmpty:e.isEmpty})}),i()(this,"onVoiceStoreUpdate",()=>{const e=k.a.instance.activeRecording;this.setState({haveRecording:!!e}),e&&e.on(I.b.EndingSoon,e=>{let{secondsLeft:t}=e;this.setState({recordingTimeLeftSeconds:t}),setTimeout(()=>this.setState({recordingTimeLeftSeconds:null}),3e3)})}),k.a.instance.on(O.b,this.onVoiceStoreUpdate),this.state={tombstone:this.getRoomTombstone(),canSendMessages:this.props.room.maySendMessage(),isComposerEmpty:!0,haveRecording:!1,recordingTimeLeftSeconds:null}}componentDidMount(){this.dispatcherRef=g.a.register(this.onAction),h.a.get().on("RoomState.events",this.onRoomStateEvents),this.waitForOwnMember()}waitForOwnMember(){const e=this.props.room.getMember(h.a.get().getUserId());e?this.setState({me:e}):this.props.room.loadMembersIfNeeded().then(()=>{const e=this.props.room.getMember(h.a.get().getUserId());this.setState({me:e})})}componentWillUnmount(){h.a.get()&&h.a.get().removeListener("RoomState.events",this.onRoomStateEvents),k.a.instance.off(O.b,this.onVoiceStoreUpdate),g.a.unregister(this.dispatcherRef)}getRoomTombstone(){return this.props.room.currentState.getStateEvents("m.room.tombstone","")}addEmoji(e){g.a.dispatch({action:"insert_emoji",emoji:e})}render(){const e=[this.props.e2eStatus?c.a.createElement(y.b,{key:"e2eIcon",status:this.props.e2eStatus,className:"mx_MessageComposer_e2eIcon"}):null];if(!this.state.tombstone&&this.state.canSendMessages){const t=p.getComponent("rooms.SendMessageComposer");e.push(c.a.createElement(t,{ref:e=>this.messageComposerInput=e,key:"controls_input",room:this.props.room,placeholder:this.renderPlaceholderText(),resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.props.permalinkCreator,replyToEvent:this.props.replyToEvent,onChange:this.onChange,disabled:this.state.haveRecording})),this.state.haveRecording||e.push(c.a.createElement(D,{key:"controls_upload",roomId:this.props.room.roomId}),c.a.createElement(N,{key:"emoji_button",addEmoji:this.addEmoji})),E.b.getValue(w.a.Widgets)&&E.b.getValue("MessageComposerInput.showStickersButton")&&!this.state.haveRecording&&e.push(c.a.createElement(f.a,{key:"stickerpicker_controls_button",room:this.props.room})),E.b.getValue("feature_voice_messages")&&e.push(c.a.createElement(R.a,{key:"controls_voice_record",ref:e=>this.voiceRecordingButton=e,room:this.props.room})),this.state.isComposerEmpty&&!this.state.haveRecording||e.push(c.a.createElement(P,{key:"controls_send",onClick:this.sendMessage}))}else if(this.state.tombstone){const t=this.state.tombstone.getContent().replacement_room,n=t?c.a.createElement("a",{href:Object(v.g)(t),className:"mx_MessageComposer_roomReplaced_link",onClick:this.onTombstoneClick},Object(u.a)("The conversation continues here.")):"";e.push(c.a.createElement("div",{className:"mx_MessageComposer_replaced_wrapper",key:"room_replaced"},c.a.createElement("div",{className:"mx_MessageComposer_replaced_valign"},c.a.createElement("img",{className:"mx_MessageComposer_roomReplaced_icon",src:a(1445)}),c.a.createElement("span",{className:"mx_MessageComposer_roomReplaced_header"},Object(u.a)("This room has been replaced and is no longer active.")),c.a.createElement("br",null),n)))}else e.push(c.a.createElement("div",{key:"controls_error",className:"mx_MessageComposer_noperm_error"},Object(u.a)("You do not have permission to post to this room")));let t;const n=Math.round(this.state.recordingTimeLeftSeconds);return n&&(t=c.a.createElement(T.b,{label:Object(u.a)("%(seconds)ss left",{seconds:n}),alignment:T.a.Top,yOffset:-50})),c.a.createElement("div",{className:"mx_MessageComposer mx_GroupLayout"},t,c.a.createElement("div",{className:"mx_MessageComposer_wrapper"},c.a.createElement(C.a,{permalinkCreator:this.props.permalinkCreator}),c.a.createElement("div",{className:"mx_MessageComposer_row"},e)))}})||n},1439:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return l}));var n=a(441),s=a(2752),i=a(2753),o=a(2754);function r(e){if(window.AudioContext)return new AudioContext(e);if(window.webkitAudioContext)return new window.webkitAudioContext(e);throw new Error("Unsupported browser")}function l(e){return new Promise(t=>{console.log("Decoder WASM path: "+s.a);const a=new Uint8Array(e),r=new Worker(o.a),l=new Worker(i.a);r.postMessage({command:"init",decoderSampleRate:n.c,outputBufferSampleRate:n.c}),l.postMessage({command:"init",wavBitDepth:24,wavSampleRate:n.c}),r.onmessage=e=>{null!==e.data?l.postMessage({command:"encode",buffers:e.data},e.data.map(e=>e.buffer)):l.postMessage({command:"done"})},l.onmessage=e=>{"page"===e.data.message&&t(new Blob([e.data.page],{type:"audio/wav"}).arrayBuffer())},r.postMessage({command:"decode",pages:a},[a.buffer])})}},144:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n=a(98),s=a.n(n),i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(97),u=a(150);const h=["element","prefixComponent","postfixComponent","className","onValidate","children","tooltipContent","forceValidity","tooltipClassName","list","validateOnBlur","validateOnChange","validateOnFocus"];function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let f=1;class v extends l.a.PureComponent{constructor(e){super(e),o()(this,"id",void 0),o()(this,"input",void 0),o()(this,"validateOnChange",Object(u.debounce)(()=>{this.validate({focused:!0})},200)),o()(this,"onFocus",e=>{this.setState({focused:!0}),this.props.validateOnFocus&&this.validate({focused:!0}),this.props.onFocus&&this.props.onFocus(e)}),o()(this,"onChange",e=>{this.props.validateOnChange&&this.validateOnChange(),this.props.onChange&&this.props.onChange(e)}),o()(this,"onBlur",e=>{this.setState({focused:!1}),this.props.validateOnBlur&&this.validate({focused:!1}),this.props.onBlur&&this.props.onBlur(e)}),this.state={valid:void 0,feedback:void 0,feedbackVisible:!1,focused:!1},this.id=this.props.id||"mx_Field_"+f++}focus(){this.input.focus()}async validate(e){let{focused:t,allowEmpty:a=!0}=e;if(!this.props.onValidate)return;const n=this.input?this.input.value:null,{valid:s,feedback:i}=await this.props.onValidate({value:n,focused:t,allowEmpty:a});return this.state.focused&&i?this.setState({valid:s,feedback:i,feedbackVisible:!0}):this.setState({valid:s,feedbackVisible:!1}),s}render(){const e=this.props,{element:t,prefixComponent:a,postfixComponent:n,className:i,onValidate:o,children:r,tooltipContent:c,forceValidity:u,tooltipClassName:p,list:f,validateOnBlur:v,validateOnChange:b,validateOnFocus:y}=e,E=s()(e,h);E.placeholder=E.placeholder||E.label,E.id=this.id,E.onFocus=this.onFocus,E.onChange=this.onChange,E.onBlur=this.onBlur;const _=g(g({},E),{},{ref:e=>this.input=e,list:f}),S=l.a.createElement(this.props.element,_,r);let C=null;a&&(C=l.a.createElement("span",{className:"mx_Field_prefix"},a));let w=null;n&&(w=l.a.createElement("span",{className:"mx_Field_postfix"},n));const O=null!=u,x=d()("mx_Field","mx_Field_"+this.props.element,i,{mx_Field_labelAlwaysTopLeft:a,mx_Field_valid:O?u:o&&!0===this.state.valid,mx_Field_invalid:O?!u:o&&!1===this.state.valid},"border_Bottom"),R=m.getComponent("elements.Tooltip");let k;return(c||this.state.feedback)&&(k=l.a.createElement(R,{tooltipClassName:d()("mx_Field_tooltip",p),visible:this.state.focused&&this.props.forceTooltipVisible||this.state.feedbackVisible,label:c||this.state.feedback,alignment:R.Alignment.Right})),l.a.createElement("div",{className:x},this.props.iconStart,C,S,l.a.createElement("label",{htmlFor:this.id},this.props.label),w,k,this.props.iconEnd)}}o()(v,"defaultProps",{element:"input",type:"text",validateOnFocus:!0,validateOnBlur:!0,validateOnChange:!0})},1440:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(441),c=a(94),d=a(153),m=a(9),u=a(856);let h=Object(c.a)("views.voice_messages.LiveRecordingWaveform")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"onRecordingUpdate",e=>{const t=Object(d.c)(Array.from(e.waveform),l.a);this.setState({heights:t.map(e=>Object(m.c)(e,0,.5))})}),this.state={heights:Object(d.h)(0,l.a)},this.props.recorder.liveData.onUpdate(this.onRecordingUpdate)}render(){return r.a.createElement(u.a,{relHeights:this.state.heights})}})||n},1441:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(94),c=a(857);let d=Object(l.a)("views.voice_messages.LiveRecordingClock")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"onRecordingUpdate",e=>{this.setState({seconds:e.timeSeconds})}),this.state={seconds:0},this.props.recorder.liveData.onUpdate(this.onRecordingUpdate)}render(){return r.a.createElement(c.a,{seconds:this.state.seconds})}})||n},1442:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(94),c=a(153),d=a(856),m=a(442),u=a(9);let h=Object(l.a)("views.voice_messages.PlaybackWaveform")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"onWaveformUpdate",e=>{this.setState({heights:this.toHeights(e)})}),i()(this,"onTimeUpdate",e=>{const t=Number(Object(u.c)(e[0],0,e[1]).toFixed(3));this.setState({progress:t})}),this.state={heights:this.toHeights(this.props.playback.waveform),progress:0},this.props.playback.waveformData.onUpdate(this.onWaveformUpdate),this.props.playback.clockInfo.liveData.onUpdate(this.onTimeUpdate)}toHeights(e){const t=Object(c.h)(0,m.a);return Object(c.j)(e,m.a,t)}render(){return r.a.createElement(d.a,{relHeights:this.state.heights,progress:this.state.progress})}})||n},1443:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(94),c=a(135),d=a(93),m=a(442),u=a(102),h=a.n(u);let p=Object(l.a)("views.voice_messages.PlayPauseButton")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"onClick",async()=>{await this.props.playback.toggle()})}render(){const e=this.props.playback.isPlaying,t=this.props.playbackPhase===m.c.Decoding,a=h()("mx_PlayPauseButton",{mx_PlayPauseButton_play:!e,mx_PlayPauseButton_pause:e,mx_PlayPauseButton_disabled:t});return r.a.createElement(c.a,{className:a,title:e?Object(d.a)("Pause"):Object(d.a)("Play"),onClick:this.onClick,disabled:t})}})||n},1444:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(94),c=a(857),d=a(442),m=a(142);let u=Object(l.a)("views.voice_messages.PlaybackClock")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"onPlaybackUpdate",e=>{e===d.c.Decoding&&(e=d.c.Stopped),this.setState({playbackPhase:e})}),i()(this,"onTimeUpdate",e=>{this.setState({seconds:e[0],durationSeconds:e[1]})}),this.state={seconds:this.props.playback.clockInfo.timeSeconds,durationSeconds:this.props.playback.clockInfo.durationSeconds,playbackPhase:d.c.Stopped},this.props.playback.on(m.b,this.onPlaybackUpdate),this.props.playback.clockInfo.liveData.onUpdate(this.onTimeUpdate)}render(){let e=this.state.seconds;return this.state.playbackPhase===d.c.Stopped&&(e=this.state.durationSeconds),r.a.createElement(c.a,{seconds:e})}})||n},1445:function(e,t){e.exports="img/room_replaced.90ddacd.svg"},1446:function(e,t,a){"use strict";a.d(t,"a",(function(){return S}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(92),l=a.n(r),c=a(102),d=a.n(c),m=a(93),u=a(99),h=a(302),p=a(860),g=a(103),f=a(280),v=a(440),b=a(135),y=a(495),E=a(250),_=a(158);class S extends o.a.Component{constructor(){super(...arguments),s()(this,"_onRoomStateEvents",(e,t)=>{this.props.room&&e.getRoomId()===this.props.room.roomId&&this._rateLimitedUpdate()}),s()(this,"_rateLimitedUpdate",new h.a((function(){this.forceUpdate()}),500))}componentDidMount(){u.a.get().on("RoomState.events",this._onRoomStateEvents)}componentWillUnmount(){const e=u.a.get();e&&e.removeListener("RoomState.events",this._onRoomStateEvents)}render(){let e=null,t=null;this.props.onCancelClick&&(t=o.a.createElement(p.a,{onClick:this.props.onCancelClick})),this.props.searchInfo&&void 0!==this.props.searchInfo.searchCount&&null!==this.props.searchInfo.searchCount&&(e=o.a.createElement("div",{className:"mx_RoomHeader_searchStatus"}," ",Object(m.a)("(~%(count)s results)",{count:this.props.searchInfo.searchCount})));let a=!1;const n=this.props.room?this.props.room.getJoinedMembers():void 0;if(n&&1===n.length&&n[0].userId===u.a.get().credentials.userId){const e=this.props.room.currentState.getStateEvents("m.room.name","");e&&e.getContent().name||(a=!0)}let s=Object(m.a)("Join Room");this.props.oobData&&this.props.oobData.name&&(s=this.props.oobData.name);const i=d()("mx_RoomHeader_nametext",{mx_RoomHeader_settingsHint:a}),r=o.a.createElement("div",{className:"mx_RoomHeader_name",onClick:this.props.onSettingsClick},o.a.createElement(E.a,{room:this.props.room},e=>{const t=e||s;return o.a.createElement("div",{dir:"auto",className:i,title:t},t)}),e),l=o.a.createElement(y.a,{room:this.props.room},(e,t)=>o.a.createElement("div",{className:"mx_RoomHeader_topic",ref:t,title:e,dir:"auto"},e));let c,h,S,C,w,O;this.props.room&&(c=o.a.createElement(v.a,{room:this.props.room,avatarSize:32,oobData:this.props.oobData,viewAvatarOnClick:!0})),this.props.onForgetClick&&(h=o.a.createElement(b.a,{className:"mx_RoomHeader_button mx_RoomHeader_forgetButton",onClick:this.props.onForgetClick,title:Object(m.a)("Forget room")})),this.props.onAppsClick&&(S=o.a.createElement(b.a,{className:d()("mx_RoomHeader_button mx_RoomHeader_appsButton",{mx_RoomHeader_appsButton_highlight:this.props.appsShown}),onClick:this.props.onAppsClick,title:this.props.appsShown?Object(m.a)("Hide Widgets"):Object(m.a)("Show Widgets")})),this.props.onSearchClick&&this.props.inRoom&&(C=o.a.createElement(b.a,{className:"mx_RoomHeader_button mx_RoomHeader_searchButton",onClick:this.props.onSearchClick,title:Object(m.a)("Search")})),this.props.inRoom&&g.b.getValue("showCallButtonsInComposer")&&(w=o.a.createElement(b.a,{className:"mx_RoomHeader_button mx_RoomHeader_voiceCallButton",onClick:()=>this.props.onCallPlaced(_.b.Voice),title:Object(m.a)("Voice call")}),O=o.a.createElement(b.a,{className:"mx_RoomHeader_button mx_RoomHeader_videoCallButton",onClick:e=>this.props.onCallPlaced(e.shiftKey?_.b.ScreenSharing:_.b.Video),title:Object(m.a)("Video call")}));const x=o.a.createElement("div",{className:"mx_RoomHeader_buttons"},O,w,h,S,C),R=this.props.e2eStatus?o.a.createElement(f.b,{status:this.props.e2eStatus}):void 0;return o.a.createElement("div",{className:"mx_RoomHeader light-panel"},o.a.createElement("div",{className:"mx_RoomHeader_wrapper","aria-owns":"mx_RightPanel"},o.a.createElement("div",{className:"mx_RoomHeader_avatar"},c),o.a.createElement("div",{className:"mx_RoomHeader_e2eIcon"},R),r,l,t,x))}}s()(S,"propTypes",{room:l.a.object,oobData:l.a.object,inRoom:l.a.bool,onSettingsClick:l.a.func,onSearchClick:l.a.func,onLeaveClick:l.a.func,onCancelClick:l.a.func,e2eStatus:l.a.string,onAppsClick:l.a.func,appsShown:l.a.bool,onCallPlaced:l.a.func}),s()(S,"defaultProps",{editing:!1,inRoom:!1,onCancelClick:null})},1447:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,s=a(19),i=a.n(s),o=a(102),r=a.n(o),l=a(88),c=a.n(l),d=a(93),m=a(94);let u=Object(m.a)("views.elements.InviteReason")(n=class extends c.a.PureComponent{constructor(e){super(e),i()(this,"onViewClick",()=>{this.setState({hidden:!1})}),this.state={hidden:!0}}render(){const e=r()({mx_InviteReason:!0,mx_InviteReason_hidden:this.state.hidden});return c.a.createElement("div",{className:e},c.a.createElement("div",{className:"mx_InviteReason_reason"},this.props.reason),c.a.createElement("div",{className:"mx_InviteReason_view",onClick:this.onViewClick},Object(d.a)("View message")))}})||n},1448:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));class n{constructor(e,t,a){this.container=e,this.vertical=t,this.reverse=a}getItemOffset(e){const t=(this.vertical?e.offsetTop:e.offsetLeft)-this.getOffset();return this.reverse?this.getTotalSize()-(t+this.getItemSize(e)):t}getItemSize(e){return this.vertical?e.offsetHeight:e.offsetWidth}getTotalSize(){return this.vertical?this.container.offsetHeight:this.container.offsetWidth}getOffset(){return this.vertical?this.container.offsetTop:this.container.offsetLeft}getPageOffset(){let e=this.container,t=0;for(;e;){t+=this.vertical?e.offsetTop:e.offsetLeft,e=e.offsetParent}return t}getDesiredItemSize(e){return this.vertical?e.style.height:e.style.width}setItemSize(e,t){this.vertical?e.style.height=t:e.style.width=t}clearItemSize(e){this.vertical?e.style.height=null:e.style.width=null}start(e){}finish(e){}offsetFromEvent(e){const t=this.vertical?e.pageY:e.pageX;return this.reverse?this.getPageOffset()+this.getTotalSize()-t:t-this.getPageOffset()}}},1449:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(19),s=a.n(n);class i{constructor(e,t,a){this.resizer=t,this.sizer=a,s()(this,"domNode",void 0),s()(this,"id",void 0),s()(this,"reverse",void 0),this.reverse=t.isReverseResizeHandle(e),this.domNode=this.reverse?e.nextElementSibling:e.previousElementSibling,this.id=e.getAttribute("data-id")}copyWith(e,t,a){return new(0,this.constructor)(e,t,a)}advance(e){let t=this.reverse?this.domNode.previousElementSibling:this.domNode.nextElementSibling;const a=e!==this.reverse;do{t=a?t.nextElementSibling:t.previousElementSibling}while(t&&!this.resizer.isResizeHandle(t));if(t){const e=this.copyWith(t,this.resizer,this.sizer);return e.reverse=this.reverse,e}}next(){return this.advance(!0)}previous(){return this.advance(!1)}size(){return this.sizer.getItemSize(this.domNode)}offset(){return this.sizer.getItemOffset(this.domNode)}start(){this.sizer.start(this.domNode)}finish(){this.sizer.finish(this.domNode)}getSize(){return this.sizer.getDesiredItemSize(this.domNode)}setRawSize(e){this.sizer.setItemSize(this.domNode,e)}setSize(e){this.setRawSize(Math.round(e)+"px");const t=this.resizer.config.onResized;t&&t(e,this.id,this.domNode)}clearSize(){this.sizer.clearItemSize(this.domNode);const e=this.resizer.config.onResized;e&&e(null,this.id,this.domNode)}first(){const e=Array.from(this.domNode.parentElement.children).find(e=>this.resizer.isResizeHandle(e));if(e)return this.copyWith(e,this.resizer,this.sizer)}last(){const e=Array.from(this.domNode.parentElement.children).reverse().find(e=>this.resizer.isResizeHandle(e));if(e)return this.copyWith(e,this.resizer,this.sizer)}}},1450:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n,s=a(19),i=a.n(s),o=a(238),r=a(88),l=a.n(r),c=a(158),d=a(866),m=a(100),u=a(370),h=a(94);let p=Object(h.a)("views.voip.CallViewForRoom")(n=class extends l.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"onAction",e=>{switch(e.action){case"call_state":this.updateCall()}}),i()(this,"updateCall",()=>{const e=this.getCall();e!==this.state.call&&this.setState({call:e})}),i()(this,"onResizeStart",()=>{this.props.resizeNotifier.startResizing()}),i()(this,"onResize",()=>{this.props.resizeNotifier.notifyTimelineHeightChanged()}),i()(this,"onResizeStop",()=>{this.props.resizeNotifier.stopResizing()}),this.state={call:this.getCall()}}componentDidMount(){this.dispatcherRef=m.a.register(this.onAction),c.d.sharedInstance().addListener(c.a.CallChangeRoom,this.updateCall)}componentWillUnmount(){m.a.unregister(this.dispatcherRef),c.d.sharedInstance().removeListener(c.a.CallChangeRoom,this.updateCall)}getCall(){const e=c.d.sharedInstance().getCallForRoom(this.props.roomId);return e&&[o.e.Ended,o.e.Ringing].includes(e.state)?null:e}render(){if(!this.state.call)return null;const e=this.props.maxVideoHeight-8;return l.a.createElement("div",{className:"mx_CallViewForRoom"},l.a.createElement(u.Resizable,{minHeight:380,maxHeight:e,enable:{top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,className:"mx_CallViewForRoom_ResizeWrapper",handleClasses:{bottom:"mx_CallViewForRoom_ResizeHandle"}},l.a.createElement(d.a,{call:this.state.call,pipMode:!1})))}})||n},1451:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n,s=a(19),i=a.n(s),o=a(102),r=a.n(o),l=a(88),c=a.n(l),d=a(103),m=a(776),u=a(0),h=a(278),p=a(94);let g=Object(p.a)("views.voip.VideoFeed")(n=class extends c.a.Component{constructor(e){super(e),i()(this,"element",Object(l.createRef)()),i()(this,"onNewStream",()=>{this.setState({audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()}),this.playMedia()}),i()(this,"onResize",e=>{this.props.onResize&&!this.props.feed.isLocal()&&this.props.onResize(e)}),this.state={audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()}}componentDidMount(){this.props.feed.addListener(m.b.NewStream,this.onNewStream),this.playMedia()}componentWillUnmount(){var e;this.props.feed.removeListener(m.b.NewStream,this.onNewStream),null===(e=this.element.current)||void 0===e||e.removeEventListener("resize",this.onResize),this.stopMedia()}playMedia(){const e=this.element.current;if(e){e.muted=!0,e.srcObject=this.props.feed.stream,e.autoplay=!0;try{e.play()}catch(e){u.a.info("Failed to play media element with feed",this.props.feed,e)}}}stopMedia(){const e=this.element.current;e&&(e.pause(),e.src=null)}render(){const e={mx_VideoFeed:!0,mx_VideoFeed_local:this.props.feed.isLocal(),mx_VideoFeed_remote:!this.props.feed.isLocal(),mx_VideoFeed_voice:this.state.videoMuted,mx_VideoFeed_video:!this.state.videoMuted,mx_VideoFeed_mirror:this.props.feed.isLocal()&&d.b.getValue("VideoView.flipVideoHorizontally")};if(this.state.videoMuted){const t=this.props.feed.getMember(),a=this.props.pipMode?76:160;return c.a.createElement("div",{className:r()(e)},c.a.createElement(h.a,{member:t,height:a,width:a}))}return c.a.createElement("video",{className:r()(e),ref:this.element})}})||n},1452:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(127),h=a(158),p=a(634),g=a(106),f=a(94);let v=Object(f.a)("views.context_menus.CallContextMenu")((s=class extends l.a.Component{constructor(e){super(e),o()(this,"onHoldClick",()=>{this.props.call.setRemoteOnHold(!0),this.props.onFinished()}),o()(this,"onUnholdClick",()=>{h.d.sharedInstance().setActiveCallRoomId(this.props.call.roomId),this.props.onFinished()}),o()(this,"onTransferClick",()=>{g.a.createTrackedDialog("Transfer Call","",p.d,{kind:p.a,call:this.props.call},null,!1,!0),this.props.onFinished()})}render(){const e=this.props.call.isRemoteOnHold()?Object(m.a)("Resume"):Object(m.a)("Hold"),t=this.props.call.isRemoteOnHold()?this.onUnholdClick:this.onHoldClick;let a;return this.props.call.opponentCanBeTransferred()&&(a=l.a.createElement(u.f,{className:"mx_CallContextMenu_item",onClick:this.onTransferClick},Object(m.a)("Transfer"))),l.a.createElement(u.b,this.props,l.a.createElement(u.f,{className:"mx_CallContextMenu_item",onClick:t},e),a)}},o()(s,"propTypes",{user:d.a.object}),n=s))||n},1453:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(127),d=a(829),m=a(94);let u=Object(m.a)("views.context_menus.DialpadContextMenu")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"onDigitPress",e=>{this.props.call.sendDtmfDigit(e),this.setState({value:this.state.value+e})}),this.state={value:""}}render(){return r.a.createElement(c.b,this.props,r.a.createElement("div",{className:"mx_DialPadContextMenu_header"},r.a.createElement("div",null,r.a.createElement("span",{className:"mx_DialPadContextMenu_title"},Object(l.a)("Dial pad"))),r.a.createElement("div",{className:"mx_DialPadContextMenu_dialled"},this.state.value)),r.a.createElement("div",{className:"mx_DialPadContextMenu_horizSep"}),r.a.createElement("div",{className:"mx_DialPadContextMenu_dialPad"},r.a.createElement(d.a,{onDigitPress:this.onDigitPress,hasDialAndDelete:!1})))}})||n},146:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return c}));var n=a(8),s=a(1),i=a(0);const o={NOT_SENT:"not_sent",ENCRYPTING:"encrypting",SENDING:"sending",QUEUED:"queued",SENT:"sent",CANCELLED:"cancelled"},r={};function l(e){return r[e]||(r[e]=e),r[e]}const c=function(e){["state_key","type","sender","room_id","membership"].forEach(t=>{e[t]&&(e[t]=l(e[t]))}),["membership","avatar_url","displayname"].forEach(t=>{e.content&&e.content[t]&&(e.content[t]=l(e.content[t]))}),["rel_type"].forEach(t=>{e.content&&e.content["m.relates_to"]&&e.content["m.relates_to"][t]&&(e.content["m.relates_to"][t]=l(e.content["m.relates_to"][t]))}),this.event=e||{},this.sender=null,this.target=null,this.status=null,this.error=null,this.forwardLooking=!0,this._pushActions=null,this._replacingEvent=null,this._localRedactionEvent=null,this._isCancelled=!1,this._clearEvent={},this._senderCurve25519Key=null,this._claimedEd25519Key=null,this._forwardingCurve25519KeyChain=[],this._untrusted=null,this._decryptionPromise=null,this._retryDecryption=!1,this.verificationRequest=null,this._txnId=e.txn_id||null,this._localTimestamp=Date.now()-this.getAge()};s.m(c,n.EventEmitter),s.j(c.prototype,{getId:function(){return this.event.event_id},getSender:function(){return this.event.sender||this.event.user_id},getType:function(){return this._clearEvent.type||this.event.type},getWireType:function(){return this.event.type},getRoomId:function(){return this.event.room_id},getTs:function(){return this.event.origin_server_ts},getDate:function(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null},getOriginalContent:function(){return this._localRedactionEvent?{}:this._clearEvent.content||this.event.content||{}},getContent:function(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()},getWireContent:function(){return this.event.content||{}},getPrevContent:function(){return this.getUnsigned().prev_content||this.event.prev_content||{}},getDirectionalContent:function(){return this.forwardLooking?this.getContent():this.getPrevContent()},getAge:function(){return this.getUnsigned().age||this.event.age},getLocalAge:function(){return Date.now()-this._localTimestamp},getStateKey:function(){return this.event.state_key},isState:function(){return void 0!==this.event.state_key},makeEncrypted:function(e,t,a,n){this._clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this._senderCurve25519Key=a,this._claimedEd25519Key=n},isBeingDecrypted:function(){return null!=this._decryptionPromise},isDecryptionFailure:function(){return this._clearEvent&&this._clearEvent.content&&"m.bad.encrypted"===this._clearEvent.content.msgtype},shouldAttemptDecryption:function(){return this.isEncrypted()&&!this.isBeingDecrypted()&&null===this.getClearContent()},attemptDecryption:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("boolean"==typeof t&&(t={isRetry:t}),!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");if(this._clearEvent&&this._clearEvent.content&&"m.bad.encrypted"!==this._clearEvent.content.msgtype)throw new Error("Attempt to decrypt event which has already been decrypted");return this._decryptionPromise?(i.a.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this._retryDecryption=!0,this._decryptionPromise):(this._decryptionPromise=this._decryptionLoop(e,t),this._decryptionPromise)},cancelAndResendKeyRequest:function(e,t){const a=this.getWireContent();return e.requestRoomKey({algorithm:a.algorithm,room_id:this.getRoomId(),session_id:a.session_id,sender_key:a.sender_key},this.getKeyRequestRecipients(t),!0)},getKeyRequestRecipients:function(e){const t=this.getWireContent(),a=[{userId:e,deviceId:"*"}],n=this.getSender();return n!==e&&a.push({userId:n,deviceId:t.device_id}),a},_decryptionLoop:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(await Promise.resolve();;){let a,n;this._retryDecryption=!1;try{e?(a=await e.decryptEvent(this),!0===t.isRetry&&i.a.info(`Decrypted event on retry (id=${this.getId()})`)):a=this._badEncryptedMessage("Encryption not enabled")}catch(e){if("DecryptionError"!==e.name){const a=t.isRetry?"re":"";return i.a.error(`Error ${a}decrypting event (id=${this.getId()}): ${e.stack||e}`),this._decryptionPromise=null,void(this._retryDecryption=!1)}if(n=e,this._retryDecryption){i.a.log(`Got error decrypting event (id=${this.getId()}: `+e+"), but retrying");continue}i.a.warn(`Error decrypting event (id=${this.getId()}): ${e.detailedString}`),a=this._badEncryptedMessage(e.message)}return this._decryptionPromise=null,this._retryDecryption=!1,this._setClearData(a),this.setPushActions(null),void(!1!==t.emit&&this.emit("Event.decrypted",this,n))}},_badEncryptedMessage:function(e){return{clearEvent:{type:"m.room.message",content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}},_setClearData:function(e){this._clearEvent=e.clearEvent,this._senderCurve25519Key=e.senderCurve25519Key||null,this._claimedEd25519Key=e.claimedEd25519Key||null,this._forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this._untrusted=e.untrusted||!1},getClearContent:function(){const e=this._clearEvent;return e&&e.content?e.content:null},isEncrypted:function(){return!this.isState()&&"m.room.encrypted"===this.event.type},getSenderKey:function(){return this._senderCurve25519Key},getKeysClaimed:function(){return{ed25519:this._claimedEd25519Key}},getClaimedEd25519Key:function(){return this._claimedEd25519Key},getForwardingCurve25519KeyChain:function(){return this._forwardingCurve25519KeyChain},isKeySourceUntrusted:function(){return this._untrusted},getUnsigned:function(){return this.event.unsigned||{}},unmarkLocallyRedacted:function(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=null),!!e},markLocallyRedacted:function(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)},makeRedacted:function(e){if(!e.event)throw new Error("invalid redaction_event in makeRedacted");let t;for(t in this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(t)&&(d[t]||delete this.event[t]);const a=m[this.getType()]||{},n=this.getContent();for(t in n)n.hasOwnProperty(t)&&(a[t]||delete n[t])},isRedacted:function(){return Boolean(this.getUnsigned().redacted_because)},isRedaction:function(){return"m.room.redaction"===this.getType()},getRedactionEvent:function(){return this.isRedacted()?this._clearEvent.unsigned?this._clearEvent.unsigned.redacted_because:this.event.unsigned.redacted_because?this.event.unsigned.redacted_because:{}:null},getPushActions:function(){return this._pushActions},setPushActions:function(e){this._pushActions=e},handleRemoteEcho:function(e){const t=this.getUnsigned(),a=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==a&&this.emit("Event.localEventIdReplaced",this)},isSending(){return!!this.status},setStatus(e){this.status=e,this.emit("Event.status",this,e)},replaceLocalEventId(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)},isRelation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;const t=this.getWireContent(),a=t&&t["m.relates_to"];return a&&a.rel_type&&a.event_id&&(e&&a.rel_type===e||!e)},getRelation(){return this.isRelation()?this.getWireContent()["m.relates_to"]:null},makeReplaced(e){this.isRedacted()&&e||this._replacingEvent!==e&&(this._replacingEvent=e,this.emit("Event.replaced",this))},getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status},getServerAggregatedRelation(e){const t=this.getUnsigned()["m.relations"];if(t)return t[e]},replacingEventId(){const e=this.getServerAggregatedRelation("m.replace");return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0},replacingEvent(){return this._replacingEvent},replacingEventDate(){const e=this.getServerAggregatedRelation("m.replace");if(e){const t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()},localRedactionEvent(){return this._localRedactionEvent},getAssociatedId(){const e=this.getRelation();return e?e.event_id:this.isRedaction()?this.event.redacts:void 0},hasAssocation(){return!!this.getAssociatedId()},updateAssociatedId(e){const t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)},flagCancelled(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isCancelled=e},isCancelled(){return this._isCancelled},toJSON(){const e={type:this.getType(),sender:this.getSender(),content:this.getContent(),event_id:this.getId(),origin_server_ts:this.getTs(),unsigned:this.getUnsigned(),room_id:this.getRoomId()};return this.isRedaction()&&(e.redacts=this.event.redacts),this.isEncrypted()?{decrypted:e,encrypted:this.event}:e},setVerificationRequest:function(e){this.verificationRequest=e},setTxnId(e){this._txnId=e},getTxnId(){return this._txnId}});const d=["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"].reduce((function(e,t){return e[t]=1,e}),{}),m={"m.room.member":{membership:1},"m.room.create":{creator:1},"m.room.join_rules":{join_rule:1},"m.room.power_levels":{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1},"m.room.aliases":{aliases:1}}},147:function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),function(e){e.AdvancedEncryption="UIFeature.advancedEncryption",e.URLPreviews="UIFeature.urlPreviews",e.Widgets="UIFeature.widgets",e.Voip="UIFeature.voip",e.Feedback="UIFeature.feedback",e.Registration="UIFeature.registration",e.PasswordReset="UIFeature.passwordReset",e.Deactivate="UIFeature.deactivate",e.ShareQRCode="UIFeature.shareQrCode",e.ShareSocial="UIFeature.shareSocial",e.IdentityServer="UIFeature.identityServer",e.ThirdPartyID="UIFeature.thirdPartyId",e.Flair="UIFeature.flair",e.Communities="UIFeature.communities",e.AdvancedSettings="UIFeature.advancedSettings",e.RoomHistorySettings="UIFeature.roomHistorySettings"}(n||(n={}))},1473:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return i}));var n=a(88);const s=(e,t)=>{const a=Object(n.useRef)();Object(n.useEffect)(()=>{a.current=e},[e]),Object(n.useEffect)(()=>{const e=setTimeout(()=>{a.current()},t);return()=>clearTimeout(e)},[t])},i=(e,t,a)=>{const[s,i]=Object(n.useState)(a);return((e,t)=>{const a=Object(n.useRef)();Object(n.useEffect)(()=>{a.current=e},[e]),Object(n.useEffect)(()=>{const e=setInterval(()=>{a.current()},t);return()=>clearInterval(e)},[t])})(()=>i(e=>e-1),t),0===s&&e(),s}},1475:function(e,t){e.exports="img/element-icons/roomlist/dark-light-mode.0169ba1.svg"},1476:function(e,t,a){},1481:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(93),c=a(882),d=a(883),m=a(183),u=a(115),h=a(337),p=a(94),g=a(852),f=a(635);const v=[m.c.RoomSummary,m.c.Widget,m.c.FilePanel,m.c.RoomMemberList,m.c.RoomMemberInfo,m.c.EncryptionPanel,m.c.Room3pidMemberInfo],b=e=>{let{room:t,isHighlighted:a,onClick:n}=e;const s=Object(g.a)("feature_pinning"),i=Object(f.c)(s&&t),o=Object(f.d)(s&&t);if(!s)return null;let d;return i.some(e=>!o.has(e))&&(d=r.a.createElement("div",{className:"mx_RightPanel_pinnedMessagesButton_unreadIndicator"})),r.a.createElement(c.a,{name:"pinnedMessagesButton",title:Object(l.a)("Pinned messages"),isHighlighted:a,onClick:n,analytics:["Right Panel","Pinned Messages Button","click"]},d)};let y=Object(p.a)("views.right_panel.RoomHeaderButtons")(n=class extends d.b{constructor(e){super(e,d.a.Room),i()(this,"onRoomSummaryClicked",()=>{const e=h.a.getSharedInstance().roomPanelPhase;v.includes(e)?this.state.phase===e?this.setPhase(e):this.setPhase(e,h.a.getSharedInstance().roomPanelPhaseParams):this.setPhase(m.c.RoomSummary)}),i()(this,"onNotificationsClicked",()=>{this.setPhase(m.c.NotificationPanel)}),i()(this,"onPinnedMessagesClicked",()=>{this.setPhase(m.c.PinnedMessages)})}onAction(e){e.action===u.a.ViewUser?e.member?this.setPhase(m.c.RoomMemberInfo,{member:e.member}):this.setPhase(m.c.RoomMemberList):"view_3pid_invite"===e.action&&(e.event?this.setPhase(m.c.Room3pidMemberInfo,{event:e.event}):this.setPhase(m.c.RoomMemberList))}renderButtons(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(b,{room:this.props.room,isHighlighted:this.isPhase(m.c.PinnedMessages),onClick:this.onPinnedMessagesClicked}),r.a.createElement(c.a,{name:"notifsButton",title:Object(l.a)("Notifications"),isHighlighted:this.isPhase(m.c.NotificationPanel),onClick:this.onNotificationsClicked,analytics:["Right Panel","Notification List Button","click"]}),r.a.createElement(c.a,{name:"roomSummaryButton",title:Object(l.a)("Room Info"),isHighlighted:this.isPhase(v),onClick:this.onRoomSummaryClicked,analytics:["Right Panel","Room Summary Button","click"]}))}})||n},153:function(e,t,a){"use strict";a.d(t,"c",(function(){return s})),a.d(t,"i",(function(){return i})),a.d(t,"g",(function(){return o})),a.d(t,"h",(function(){return r})),a.d(t,"j",(function(){return l})),a.d(t,"b",(function(){return c})),a.d(t,"e",(function(){return d})),a.d(t,"d",(function(){return m})),a.d(t,"a",(function(){return u})),a.d(t,"k",(function(){return h})),a.d(t,"f",(function(){return p}));var n=a(9);function s(e,t){if(e.length===t)return e;const a=[];if(e.length>t){const n=Math.round(e.length/t);for(let t=0;t<e.length;t+=n)a.push(e[t])}else{const n=Math.ceil(t/e.length);for(const t of e)a.push(...r(t,n))}return l(a,t,r(e[e.length-1],t))}function i(e,t){if(e.length===t)return e;let a=[];if(e.length>t){for(;a.length>2*t||0===a.length;){a=[];for(let t=1;t<e.length-1;t+=2){const n=(e[t-1]+e[t+1]+e[t])/3;a.push(n)}e=a}return s(a,t)}return s(e,t)}function o(e,t,a){const s=Math.min(...e),i=Math.max(...e);return e.map(e=>Object(n.d)(Object(n.c)(e,s,i),t,a))}function r(e,t){const a=[];for(let n=0;n<t;n++)a.push(e);return a}function l(e,t,a){return e.length===t?e:e.length>t?e.slice(0,t):e.concat(a.slice(0,t-e.length))}function c(e){return e.slice(0,e.length)}function d(e,t){if(e.length===t.length){for(let a=0;a<e.length;a++)if(e[a]!==t[a])return!0;return!1}return!0}function m(e,t){return e.length!==t.length||(!!t.some(t=>!e.includes(t))||!!e.some(e=>!t.includes(e)))}function u(e,t){return{added:t.filter(t=>!e.includes(t)),removed:e.filter(e=>!t.includes(e))}}function h(e,t){return e.filter(e=>t.includes(e))}function p(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return Array.from(t.reduce((e,t)=>(t.forEach(t=>e.add(t)),e),new Set))}},1530:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(217),o=a(268),r=a(1473);t.a=e=>{let{description:t,acceptLabel:a,dismissLabel:n,onAccept:l,onDismiss:c,toastKey:d,numSeconds:m}=e;const u=()=>{c&&c(),i.a.sharedInstance().dismissToast(d)},h=Object(r.a)(u,1e3,m);let p=n;return h>0&&(p+=` (${h})`),s.a.createElement(o.a,{description:t,acceptLabel:a,onAccept:l,rejectLabel:p,onReject:u})}},1531:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(92),l=a.n(r),c=a(515),d=a.n(c),m=a(93),u=a(575),h=a.n(u),p=a(100),g=a(99),f=a(102),v=a.n(f),b=a(119),y=a(138);class E extends o.a.PureComponent{constructor(e,t){super(e,t),s()(this,"onAction",e=>{"client_started"===e.action&&this.forceUpdate()}),this._dispatcherRef=null,this.state={page:""}}translate(e){return h()(Object(m.a)(e))}componentDidMount(){this._unmounted=!1,this.props.url&&(d()({method:"GET",url:this.props.url},(e,t,a)=>{if(!this._unmounted){if(e||t.status<200||t.status>=300)return console.warn("Error loading page: "+e),void this.setState({page:Object(m.a)("Couldn't load page")});a=a.replace(/_t\(['"]([\s\S]*?)['"]\)/gm,(e,t)=>this.translate(t)),this.props.replaceMap&&Object.keys(this.props.replaceMap).forEach(e=>{a=a.split(e).join(this.props.replaceMap[e])}),this.setState({page:a})}}),this._dispatcherRef=p.a.register(this.onAction))}componentWillUnmount(){this._unmounted=!0,null!==this._dispatcherRef&&p.a.unregister(this._dispatcherRef)}render(){const e=this.context||g.a.get(),t=!e||e.isGuest(),a=this.props.className,n=v()({[a]:!0,[a+"_guest"]:t,[a+"_loggedIn"]:!!e}),s=o.a.createElement("div",{className:a+"_body",dangerouslySetInnerHTML:{__html:this.state.page}});return this.props.scrollbar?o.a.createElement(y.a,{className:n},s):o.a.createElement("div",{className:n},s)}}s()(E,"propTypes",{url:l.a.string,className:l.a.string,scrollbar:l.a.bool,replaceMap:l.a.object}),s()(E,"contextType",b.a)},1532:function(e,t){e.exports="img/icons-create-room.7c857e1.svg"},1533:function(e,t){e.exports="img/cancel-small.1b416ae.svg"},1534:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return h}));var n=a(88),s=a.n(n),i=a(129),o=a.n(i),r=a(99),l=a(103),c=a(475),d=a(899),m=a(155);function u(e,t,a){const n=r.a.get().getRoom(t.getRoomId()),i=l.b.getValue("Pill.shouldShowPillAvatar");let h=e[0];for(;h;){let e=!1;if("A"===h.tagName&&h.getAttribute("href")){const t=h.getAttribute("href"),r=Object(m.i)(t);if(r&&!r.eventId){const r=document.createElement("span"),l=s.a.createElement(d.a,{url:t,inMessage:!0,room:n,shouldShowPillAvatar:i});o.a.render(l,r),h.parentNode.replaceChild(r,h),a.push(r),e=!0,h=r}}else if(h.nodeType===Node.TEXT_NODE&&!h.parentElement.classList.contains("mx_AtRoomPill")){let e=h;const l=[];for(;null!==e;){const t=d.a.roomNotifPos(e.textContent);let a=null;if(t>-1){let n=e;t>0&&(n=n.splitText(t)),n.textContent.length>d.a.roomNotifLen()&&(a=n.splitText(d.a.roomNotifLen())),l.push(n)}e=a}if(l.length>0){const e=new c.a(r.a.get()),m=e.getPushRuleById(".m.rule.roomnotif");if(m&&e.ruleMatchesEvent(m,t)){for(const e of l){h=e.nextSibling;const t=document.createElement("span"),r=s.a.createElement(d.a,{type:d.a.TYPE_AT_ROOM_MENTION,inMessage:!0,room:n,shouldShowPillAvatar:i});o.a.render(r,t),e.parentNode.replaceChild(t,e),a.push(t)}continue}}}h.childNodes&&h.childNodes.length&&!e&&u(h.childNodes,t,a),h=h.nextSibling}}function h(e){for(const t of e)o.a.unmountComponentAtNode(t)}},154:function(e,t,a){"use strict";a.d(t,"a",(function(){return w}));var n=a(98),s=a.n(n),i=a(19),o=a.n(i),r=a(294),l=a(93),c=a(156),d=a(110),m=a(99),u=a(211),h=a(165),p=a(115),g=a(572);const f=["count"];function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let y=window.TextEncoder;y||(y=g.TextEncoder);var E;!function(e){e.Landscape="landscape",e.Portrait="portrait"}(E||(E={}));const _=async e=>{const t=(new y).encode(e),a=await window.crypto.subtle.digest("sha-256",t);return[...new Uint8Array(a)].map(e=>e.toString(16).padStart(2,"0")).join("")},S=new Set(["register","login","forgot_password","soft_logout","new","settings","welcome","home","start","directory","start_sso","start_cas","groups","complete_security","post_registration","room","user","group"]);const C=e=>{var t,a;const n=m.a.get(),s=null==n?void 0:n.getRoom(e);return{num_users:null==s?void 0:s.getJoinedMemberCount(),is_encrypted:null==n?void 0:n.isRoomEncrypted(e),is_public:"public"===(null==s||null===(t=s.currentState.getStateEvents("m.room.join_rules",""))||void 0===t||null===(a=t.getContent())||void 0===a?void 0:a.join_rule)}};class w{constructor(){o()(this,"baseUrl",null),o()(this,"appKey",null),o()(this,"userKey",null),o()(this,"anonymous",void 0),o()(this,"appPlatform",void 0),o()(this,"appVersion","unknown"),o()(this,"initTime",w.getTimestamp()),o()(this,"firstPage",!0),o()(this,"heartbeatIntervalId",void 0),o()(this,"activityIntervalId",void 0),o()(this,"trackTime",!0),o()(this,"lastBeat",void 0),o()(this,"storedDuration",0),o()(this,"lastView",void 0),o()(this,"lastViewTime",0),o()(this,"lastViewStoredDuration",0),o()(this,"sessionStarted",!1),o()(this,"heartbeatEnabled",!1),o()(this,"inactivityCounter",0),o()(this,"pendingEvents",[]),o()(this,"lastMsTs",0),o()(this,"getOrientation",()=>window.matchMedia("(orientation: landscape)").matches?E.Landscape:E.Portrait),o()(this,"reportOrientation",()=>{this.track("[CLY]_orientation",{mode:this.getOrientation()})}),o()(this,"endSession",()=>{this.sessionStarted&&(window.removeEventListener("resize",this.reportOrientation),this.reportViewDuration(),this.request({end_session:1,session_duration:w.getTimestamp()-this.lastBeat})),this.sessionStarted=!1}),o()(this,"onVisibilityChange",()=>{document.hidden?this.stopTime():this.startTime()}),o()(this,"onUserActivity",()=>{this.inactivityCounter>=20&&this.startTime(),this.inactivityCounter=0})}static get instance(){return w.internalInstance}get disabled(){return!this.baseUrl}canEnable(){var e,t;const a=d.a.get();return Boolean("1"!==navigator.doNotTrack&&(null==a||null===(e=a.countly)||void 0===e?void 0:e.url)&&(null==a||null===(t=a.countly)||void 0===t?void 0:t.appKey))}async changeUserKey(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=this.userKey;this.userKey=e,a&&t&&await this.request({old_device_id:a})}async enable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.disabled&&this.anonymous===e)return;if(!this.canEnable())return;this.disabled||this.request();const t=d.a.get();this.baseUrl=new URL("/i",t.countly.url),this.appKey=t.countly.appKey,this.anonymous=e,e?await this.changeUserKey(Object(r.b)(64)):await this.changeUserKey(await _(m.a.get().getUserId()),!0);const a=c.a.get();this.appPlatform=a.getHumanReadableName();try{this.appVersion=await a.getAppVersion()}catch(e){console.warn("Failed to get app version, using 'unknown'")}this.heartbeatIntervalId=setInterval(this.heartbeat.bind(this),5e3),this.trackSessions(),this.trackErrors()}async disable(){this.disabled||(await this.track("Opt-Out"),this.endSession(),window.clearInterval(this.heartbeatIntervalId),window.clearTimeout(this.activityIntervalId),this.baseUrl=null,window.removeEventListener("beforeunload",this.endSession),window.removeEventListener("unload",this.endSession),window.removeEventListener("visibilitychange",this.onVisibilityChange),window.removeEventListener("mousemove",this.onUserActivity),window.removeEventListener("click",this.onUserActivity),window.removeEventListener("keydown",this.onUserActivity),window.removeEventListener("scroll",this.onUserActivity))}reportFeedback(e,t){this.track("[CLY]_star_rating",{rating:e,comment:t},null,{},!0)}trackPageChange(e){this.disabled||this.trackPageView()}async trackPageView(){this.reportViewDuration(),await Object(u.c)(0);const e=await async function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=Object(r.b)(8),{origin:a,hash:n}=window.location;let{pathname:s}=window.location;a.startsWith("file://")&&(s=`/<redacted_${t}>/`);let[i,o,...l]=n.split("/");S.has(o)||(o=`<redacted_${t}>`);for(let a=0;a<l.length;a++)l[a]=e?`<redacted_${t}>`:await _(l[a]);const c=`${i}/${o}/${l.join("/")}`,d=a+s+c,m={};let u="$/"+n;switch(o){case"room":{u="view_room";const e=h.a.getRoomId();u+=" "+l[0],m.room_id=l[0],Object.assign(m,C(e));break}}return{name:u,url:d,meta:m}}(this.anonymous),t=e.name;this.lastView=t,this.lastViewTime=w.getTimestamp();const a=b(b({},e.meta),{},{name:t,visit:1,domain:window.location.hostname,view:e.url,segment:this.appPlatform,start:this.firstPage});this.firstPage&&(this.firstPage=!1),this.track("[CLY]_view",a)}static getTimestamp(){return Math.floor((new Date).getTime()/1e3)}getMsTimestamp(){const e=(new Date).getTime();return this.lastMsTs>=e?this.lastMsTs++:this.lastMsTs=e,this.lastMsTs}async recordError(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.disabled||this.anonymous)return;let a="";"object"==typeof e?void 0!==e.stack?a=e.stack:(void 0!==e.name&&(a+=e.name+":"),void 0!==e.message&&(a+=e.message+"\n"),void 0!==e.fileName&&(a+="in "+e.fileName+"\n"),void 0!==e.lineNumber&&(a+="on "+e.lineNumber),void 0!==e.columnNumber&&(a+=":"+e.columnNumber)):a=e+"",a=await(async(e,t,a)=>{const n=[];e.replace(t,(function(){return n.push(a(...arguments)),""}));const s=await Promise.all(n);return e.replace(t,()=>s.shift())})(a,/([!@+#]).+?:[\w:.]+/g,async(e,t)=>t+await _(e.substring(1)));const n=this.getMetrics(),s={_resolution:null==n?void 0:n._resolution,_error:a,_app_version:this.appVersion,_run:w.getTimestamp()-this.initTime,_nonfatal:!t,_view:this.lastView};void 0!==navigator.onLine&&(s._online=navigator.onLine),s._background=document.hasFocus(),this.request({crash:JSON.stringify(s)})}trackErrors(){window.onerror=(e,t,a,n,s)=>{if(void 0!==s)this.recordError(s,!1);else{let s="";void 0!==e&&(s+=e+"\n"),void 0!==t&&(s+="at "+t),void 0!==a&&(s+=":"+a),void 0!==n&&(s+=":"+n),s+="\n";try{const e=[];let t=arguments.callee.caller;for(;t;)e.push(t.name),t=t.caller;s+=e.join("\n")}catch(e){}this.recordError(s,!1)}},window.addEventListener("unhandledrejection",e=>{var t;this.recordError(new Error(`Unhandled rejection (reason: ${(null===(t=e.reason)||void 0===t?void 0:t.stack)||e.reason}).`),!0)})}heartbeat(){const e={};if(this.sessionStarted&&this.trackTime){const t=w.getTimestamp();t-this.lastBeat>=60&&(e.session_duration=t-this.lastBeat,this.lastBeat=t)}(this.pendingEvents.length>0||e.session_duration)&&this.request(e)}async request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=b(b({app_key:this.appKey,device_id:this.userKey},this.getTimeParams()),e);if(this.pendingEvents.length>0){const e=10,a=this.pendingEvents.splice(0,e);t.events=JSON.stringify(a)}const a=new URLSearchParams(t);try{await window.fetch(this.baseUrl.toString(),{method:"POST",mode:"no-cors",cache:"no-cache",redirect:"follow",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a})}catch(e){console.error("Analytics error: ",e)}}getTimeParams(){const e=new Date;return{timestamp:this.getMsTimestamp(),hour:e.getHours(),dow:e.getDay()}}queue(e){const{count:t=1}=e,a=s()(e,f),n=b(b(b({},this.getTimeParams()),a),{},{count:t,platform:this.appPlatform,app_version:this.appVersion});this.pendingEvents.push(n),this.pendingEvents.length>1e3&&this.pendingEvents.shift()}startTime(){this.trackTime||(this.trackTime=!0,this.lastBeat=w.getTimestamp()-this.storedDuration,this.lastViewTime=w.getTimestamp()-this.lastViewStoredDuration,this.lastViewStoredDuration=0)}stopTime(){this.trackTime&&(this.trackTime=!1,this.storedDuration=w.getTimestamp()-this.lastBeat,this.lastViewStoredDuration=w.getTimestamp()-this.lastViewTime)}getMetrics(){if(this.anonymous)return;const e={};return e._app_version=this.appVersion,e._ua=navigator.userAgent,screen.width&&screen.height&&(e._resolution=`${screen.width}x${screen.height}`),window.devicePixelRatio&&(e._density=window.devicePixelRatio),e._locale=Object(l.d)(),e}async beginSession(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.sessionStarted){this.reportOrientation(),window.addEventListener("resize",this.reportOrientation),this.lastBeat=w.getTimestamp(),this.sessionStarted=!0,this.heartbeatEnabled=e;const t={custom:{home_server:m.a.get()&&m.a.getHomeserverName(),anonymous:this.anonymous}},a={begin_session:1,user_details:JSON.stringify(t)},n=this.getMetrics();n&&(a.metrics=JSON.stringify(n)),await this.request(a)}}reportViewDuration(){this.lastView&&(this.track("[CLY]_view",{name:this.lastView},null,{dur:this.trackTime?w.getTimestamp()-this.lastViewTime:this.lastViewStoredDuration}),this.lastView=null)}trackSessions(){this.beginSession(),this.startTime(),window.addEventListener("beforeunload",this.endSession),window.addEventListener("unload",this.endSession),window.addEventListener("visibilitychange",this.onVisibilityChange),window.addEventListener("mousemove",this.onUserActivity),window.addEventListener("click",this.onUserActivity),window.addEventListener("keydown",this.onUserActivity),window.addEventListener("scroll",this.onUserActivity,{passive:!0}),this.activityIntervalId=setInterval(()=>{this.inactivityCounter++,this.inactivityCounter>=20&&this.stopTime()},6e4)}trackBeginInvite(e){this.track("begin_invite",{},e)}trackSendInvite(e,t,a){this.track("send_invite",{},t,{dur:w.getTimestamp()-e,sum:a})}async trackRoomCreate(e,t){if(this.disabled)return;let a=w.getTimestamp();const n=m.a.get();n.getRoom(t)||(await new Promise(e=>{const a=s=>{s.roomId===t&&(n.off("Room",a),e())};n.on("Room",a)}),a=w.getTimestamp()),this.track("create_room",{},t,{dur:a-e})}trackRoomJoin(e,t,a){this.track(p.a.JoinRoom,{type:a},t,{dur:w.getTimestamp()-e})}async trackSendMessage(e,t,a,n,s,i){if(this.disabled)return;const o=m.a.get().getRoom(a),r=(await t).event_id;let l=w.getTimestamp();o.findEventById(r)||(await new Promise(e=>{const t=a=>{a.getId()===r&&(o.off("Room.localEchoUpdated",t),e())};o.on("Room.localEchoUpdated",t)}),l=w.getTimestamp()),this.track("send_message",{is_edit:n,is_reply:s,msgtype:i.msgtype,format:i.format},a,{dur:l-e})}trackStartCall(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.track("start_call",{is_video:t,is_jitsi:a},e)}trackJoinCall(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.track("join_call",{is_video:t,is_jitsi:a},e)}trackRoomDirectoryBegin(){this.track("room_directory")}trackRoomDirectory(e){this.track("room_directory_done",{},null,{dur:w.getTimestamp()-e})}trackRoomDirectorySearch(e,t){this.track("room_directory_search",{query_length:t.length,query_num_words:t.split(" ").length},null,{sum:e})}async track(e,t,a,n){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.disabled&&!s)return;let i=t||{};a&&(i=b(b({room_id:await _(a)},C(a)),t)),this.queue(b({key:e,count:1,segmentation:i},n)),this.disabled&&s&&await this.request({device_id:Object(r.b)(64)})}}o()(w,"internalInstance",new w),window.mxCountlyAnalytics=w},1540:function(e,t,a){"use strict";a.d(t,"a",(function(){return F}));var n=a(266),s=a(88),i=a.n(s),o=a(93),r=a(1329),l=a(248),c=a(100);class d extends l.a{onChange(e,t,a){c.a.dispatch({action:"feature_custom_status_changed"})}}var m=a(595),u=a(99);class h extends l.a{constructor(e,t){super(),this.setter=e,this.inverse=t}onChange(e,t,a){this.setter.call(u.a.get(),this.inverse?!a:a)}}var p=a(156);class g extends l.a{onChange(e,t,a){p.a.get().reload()}}var f=a(115);class v extends l.a{constructor(){super()}onChange(e,t,a){c.a.dispatch({action:f.a.UpdateFontSize,size:a})}}var b=a(103);class y extends l.a{constructor(){super()}onChange(e,t,a){c.a.dispatch({action:f.a.UpdateSystemFont,useSystemFont:b.b.getValue("useSystemFont"),font:a})}}class E extends l.a{constructor(){super()}onChange(e,t,a){c.a.dispatch({action:f.a.UpdateSystemFont,useSystemFont:a,font:b.b.getValue("systemFont")})}}var _=a(123),S=a(183),C=a(131);class w extends l.a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.uiFeatureName=e,this.forcedValue=t}getValueOverride(e,t,a,n){return this.settingDisabled?this.forcedValue:null}get settingDisabled(){return!b.b.getValue(this.uiFeatureName)}}var O=a(147);class x extends l.a{constructor(e){super(),this.controllers=e}getValueOverride(e,t,a,n){for(const s of this.controllers){const i=s.getValueOverride(e,t,a,n);if(null!=i)return i}return null}onChange(e,t,a){for(const n of this.controllers)n.onChange(e,t,a)}get settingDisabled(){for(const e of this.controllers)if(e.settingDisabled)return!0;return!1}}var R=a(245);class k extends l.a{getValueOverride(e,t,a,n){return!this.prefersReducedMotion()&&null}get settingDisabled(){return this.prefersReducedMotion()}prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}}class I extends l.a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.settingName=e,this.forcedValue=t}getValueOverride(e,t,a,n){return this.incompatibleSettingEnabled?this.forcedValue:null}get incompatibleSettingEnabled(){return b.b.getValue(this.settingName)}}var T=a(110);const P=[_.a.DEVICE,_.a.ROOM_DEVICE,_.a.ROOM_ACCOUNT,_.a.ACCOUNT,_.a.CONFIG],N=[_.a.ROOM_ACCOUNT,_.a.ACCOUNT],D=[_.a.DEVICE,_.a.ROOM_DEVICE,_.a.ROOM_ACCOUNT,_.a.ACCOUNT,_.a.CONFIG,_.a.ROOM],j=[_.a.DEVICE,_.a.ACCOUNT,_.a.CONFIG],A=[_.a.DEVICE,_.a.CONFIG],M=[_.a.DEVICE],U=[_.a.DEVICE,_.a.CONFIG],L=[_.a.CONFIG],F={feature_spaces:{isFeature:!0,displayName:Object(o.b)("Spaces prototype. Incompatible with Communities, Communities v2 and Custom Tags. Requires compatible homeserver for some features."),supportedLevels:A,default:!1,controller:new g,betaInfo:{title:Object(o.b)("Spaces"),caption:Object(o.b)("Spaces are a new way to group rooms and people."),disclaimer:e=>e?i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,Object(o.a)("If you leave, %(brand)s will reload with Spaces disabled. Communities and custom tags will be visible again.",{brand:T.a.get().brand})),i.a.createElement("p",null,Object(o.a)("Beta available for web, desktop and Android. Thank you for trying the beta."))):i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,Object(o.a)("%(brand)s will reload with Spaces enabled. Communities and custom tags will be hidden.",{brand:T.a.get().brand})),i.a.createElement("b",null,Object(o.a)("You can leave the beta any time from settings or tapping on a beta badge, like the one above.")),i.a.createElement("p",null,Object(o.a)("Beta available for web, desktop and Android. Some features may be unavailable on your homeserver."))),image:a(2679),feedbackSubheading:Object(o.b)("Your feedback will help make spaces better. The more detail you can go into, the better."),feedbackLabel:"spaces-feedback"}},feature_dnd:{isFeature:!0,displayName:Object(o.b)("Show options to enable 'Do not disturb' mode"),supportedLevels:A,default:!1},feature_voice_messages:{isFeature:!0,displayName:Object(o.b)("Send and receive voice messages"),supportedLevels:A,default:!1},feature_latex_maths:{isFeature:!0,displayName:Object(o.b)("Render LaTeX maths in messages"),supportedLevels:A,default:!1},feature_communities_v2_prototypes:{isFeature:!0,displayName:Object(o.b)("Communities v2 prototypes. Requires compatible homeserver. Highly experimental - use with caution."),supportedLevels:A,default:!1,controller:new I("feature_spaces")},feature_pinning:{isFeature:!0,displayName:Object(o.b)("Message Pinning"),supportedLevels:A,default:!1},feature_custom_status:{isFeature:!0,displayName:Object(o.b)("Custom user status messages"),supportedLevels:A,default:!1,controller:new d},feature_custom_tags:{isFeature:!0,displayName:Object(o.b)("Group & filter rooms by custom tags (refresh to apply changes)"),supportedLevels:A,default:!1,controller:new I("feature_spaces")},feature_state_counters:{isFeature:!0,displayName:Object(o.b)("Render simple counters in room header"),supportedLevels:A,default:!1},feature_many_integration_managers:{isFeature:!0,displayName:Object(o.b)("Multiple integration managers"),supportedLevels:A,default:!1},feature_mjolnir:{isFeature:!0,displayName:Object(o.b)("Try out new ways to ignore people (experimental)"),supportedLevels:A,default:!1},feature_custom_themes:{isFeature:!0,displayName:Object(o.b)("Support adding custom themes"),supportedLevels:A,default:!1},feature_roomlist_preview_reactions_dms:{isFeature:!0,displayName:Object(o.b)("Show message previews for reactions in DMs"),supportedLevels:A,default:!1,controller:new I("feature_roomlist_preview_reactions_all")},feature_roomlist_preview_reactions_all:{isFeature:!0,displayName:Object(o.b)("Show message previews for reactions in all rooms"),supportedLevels:A,default:!1},feature_dehydration:{isFeature:!0,displayName:Object(o.b)("Offline encrypted messaging using dehydrated devices"),supportedLevels:A,default:!1},advancedRoomListLogging:{displayName:Object(o.b)("Enable advanced debugging for the room list"),supportedLevels:M,default:!1},doNotDisturb:{supportedLevels:[_.a.DEVICE],default:!1},mjolnirRooms:{supportedLevels:[_.a.ACCOUNT],default:[]},mjolnirPersonalRoom:{supportedLevels:[_.a.ACCOUNT],default:null},feature_bridge_state:{isFeature:!0,supportedLevels:A,displayName:Object(o.b)("Show info about bridges in room settings"),default:!1},"RoomList.backgroundImage":{supportedLevels:j,default:null},baseFontSize:{displayName:Object(o.b)("Font size"),supportedLevels:j,default:10,controller:new v},useCustomFontSize:{displayName:Object(o.b)("Use custom size"),supportedLevels:j,default:!1},"MessageComposerInput.suggestEmoji":{supportedLevels:j,displayName:Object(o.b)("Enable Emoji suggestions while typing"),default:!0,invertedSettingName:"MessageComposerInput.dontSuggestEmoji"},"MessageComposerInput.showStickersButton":{supportedLevels:j,displayName:Object(o.b)("Show stickers button"),default:!0},"Notifications.alwaysShowBadgeCounts":{supportedLevels:N,default:!1},useCompactLayout:{supportedLevels:M,displayName:Object(o.b)("Use a more compact ‘Modern’ layout"),default:!1},showRedactions:{supportedLevels:D,displayName:Object(o.b)("Show a placeholder for removed messages"),default:!0,invertedSettingName:"hideRedactions"},showJoinLeaves:{supportedLevels:D,displayName:Object(o.b)("Show join/leave messages (invites/kicks/bans unaffected)"),default:!0,invertedSettingName:"hideJoinLeaves"},showAvatarChanges:{supportedLevels:D,displayName:Object(o.b)("Show avatar changes"),default:!0,invertedSettingName:"hideAvatarChanges"},showDisplaynameChanges:{supportedLevels:D,displayName:Object(o.b)("Show display name changes"),default:!0,invertedSettingName:"hideDisplaynameChanges"},showReadReceipts:{supportedLevels:P,displayName:Object(o.b)("Show read receipts sent by other users"),default:!0,invertedSettingName:"hideReadReceipts"},showTwelveHourTimestamps:{supportedLevels:j,displayName:Object(o.b)("Show timestamps in 12 hour format (e.g. 2:30pm)"),default:!1},alwaysShowTimestamps:{supportedLevels:j,displayName:Object(o.b)("Always show message timestamps"),default:!1},autoplayGifsAndVideos:{supportedLevels:j,displayName:Object(o.b)("Autoplay GIFs and videos"),default:!1},enableSyntaxHighlightLanguageDetection:{supportedLevels:j,displayName:Object(o.b)("Enable automatic language detection for syntax highlighting"),default:!1},expandCodeByDefault:{supportedLevels:j,displayName:Object(o.b)("Expand code blocks by default"),default:!1},showCodeLineNumbers:{supportedLevels:j,displayName:Object(o.b)("Show line numbers in code blocks"),default:!0},scrollToBottomOnMessageSent:{supportedLevels:j,displayName:Object(o.b)("Jump to the bottom of the timeline when you send a message"),default:!0},"Pill.shouldShowPillAvatar":{supportedLevels:j,displayName:Object(o.b)("Show avatars in user and room mentions"),default:!0,invertedSettingName:"Pill.shouldHidePillAvatar"},"TextualBody.enableBigEmoji":{supportedLevels:j,displayName:Object(o.b)("Enable big emoji in chat"),default:!0,invertedSettingName:"TextualBody.disableBigEmoji"},"MessageComposerInput.isRichTextEnabled":{supportedLevels:j,default:!1},"MessageComposer.showFormatting":{supportedLevels:j,default:!1},sendTypingNotifications:{supportedLevels:j,displayName:Object(o.b)("Send typing notifications"),default:!0,invertedSettingName:"dontSendTypingNotifications"},showTypingNotifications:{supportedLevels:j,displayName:Object(o.b)("Show typing notifications"),default:!0},ctrlFForSearch:{supportedLevels:j,displayName:C.b?Object(o.b)("Use Command + F to search"):Object(o.b)("Use Ctrl + F to search"),default:!1},"MessageComposerInput.ctrlEnterToSend":{supportedLevels:j,displayName:C.b?Object(o.b)("Use Command + Enter to send a message"):Object(o.b)("Use Ctrl + Enter to send a message"),default:!1},"MessageComposerInput.autoReplaceEmoji":{supportedLevels:j,displayName:Object(o.b)("Automatically replace plain text Emoji"),default:!1},"VideoView.flipVideoHorizontally":{supportedLevels:j,displayName:Object(o.b)("Mirror local video feed"),default:!1},"TagPanel.enableTagPanel":{supportedLevels:j,displayName:Object(o.b)("Enable Community Filter Panel"),default:!0,invertedSettingName:"TagPanel.disableTagPanel",controller:new w(O.a.Communities,!0)},theme:{supportedLevels:j,default:"light",controller:new m.a},custom_themes:{supportedLevels:j,default:[]},use_system_theme:{supportedLevels:M,default:!0,displayName:Object(o.b)("Match system theme")},useSystemFont:{supportedLevels:M,default:!1,displayName:Object(o.b)("Use a system font"),controller:new E},systemFont:{supportedLevels:M,default:"",displayName:Object(o.b)("System font name"),controller:new y},webRtcAllowPeerToPeer:{supportedLevels:U,displayName:Object(o.b)("Allow Peer-to-Peer for 1:1 calls (if you enable this, the other party might be able to see your IP address)"),default:!0,invertedSettingName:"webRtcForceTURN"},webrtc_audiooutput:{supportedLevels:M,default:null},webrtc_audioinput:{supportedLevels:M,default:null},webrtc_videoinput:{supportedLevels:M,default:null},language:{supportedLevels:U,default:"en"},breadcrumb_rooms:{supportedLevels:[_.a.ACCOUNT],default:[]},recent_emoji:{supportedLevels:[_.a.ACCOUNT],default:[]},room_directory_servers:{supportedLevels:[_.a.ACCOUNT],default:[]},integrationProvisioning:{supportedLevels:[_.a.ACCOUNT],default:!0},allowedWidgets:{supportedLevels:[_.a.ROOM_ACCOUNT,_.a.ROOM_DEVICE],supportedLevelsAreOrdered:!0,default:{}},analyticsOptIn:{supportedLevels:U,displayName:Object(o.b)("Send analytics data"),default:!1},showCookieBar:{supportedLevels:U,default:!0},autocompleteDelay:{supportedLevels:U,default:200},readMarkerInViewThresholdMs:{supportedLevels:U,default:3e3},readMarkerOutOfViewThresholdMs:{supportedLevels:U,default:3e4},blacklistUnverifiedDevices:{supportedLevels:[_.a.ROOM_DEVICE,_.a.DEVICE],supportedLevelsAreOrdered:!0,displayName:{default:Object(o.b)("Never send encrypted messages to unverified sessions from this session"),"room-device":Object(o.b)("Never send encrypted messages to unverified sessions in this room from this session")},default:!1,controller:new w(O.a.AdvancedEncryption)},urlPreviewsEnabled:{supportedLevels:D,displayName:{default:Object(o.b)("Enable inline URL previews by default"),"room-account":Object(o.b)("Enable URL previews for this room (only affects you)"),room:Object(o.b)("Enable URL previews by default for participants in this room")},default:!0,controller:new w(O.a.URLPreviews)},urlPreviewsEnabled_e2ee:{supportedLevels:[_.a.ROOM_DEVICE,_.a.ROOM_ACCOUNT],displayName:{"room-account":Object(o.b)("Enable URL previews for this room (only affects you)")},default:!1,controller:new w(O.a.URLPreviews)},roomColor:{supportedLevels:D,displayName:Object(o.b)("Room Colour"),default:{primary_color:null,secondary_color:null}},notificationsEnabled:{supportedLevels:M,default:!1,controller:new r.b},notificationSound:{supportedLevels:N,default:!1},notificationBodyEnabled:{supportedLevels:M,default:!0,controller:new r.a},audioNotificationsEnabled:{supportedLevels:M,default:!0},enableWidgetScreenshots:{supportedLevels:j,displayName:Object(o.b)("Enable widget screenshots on supported widgets"),default:!1},promptBeforeInviteUnknownUsers:{supportedLevels:j,displayName:Object(o.b)("Prompt before sending invites to potentially invalid matrix IDs"),default:!0},showDeveloperTools:{supportedLevels:j,displayName:Object(o.b)("Show developer tools"),default:!1},widgetOpenIDPermissions:{supportedLevels:M,default:{allow:[],deny:[]}},"RoomList.orderAlphabetically":{supportedLevels:j,displayName:Object(o.b)("Order rooms by name"),default:!1},"RoomList.orderByImportance":{supportedLevels:j,displayName:Object(o.b)("Show rooms with unread notifications first"),default:!0},breadcrumbs:{supportedLevels:j,displayName:Object(o.b)("Show shortcuts to recently viewed rooms above the room list"),default:!0},showHiddenEventsInTimeline:{displayName:Object(o.b)("Show hidden events in timeline"),supportedLevels:M,default:!1},lowBandwidth:{supportedLevels:U,displayName:Object(o.b)("Low bandwidth mode"),default:!1,controller:new g},fallbackICEServerAllowed:{supportedLevels:M,displayName:Object(o.b)("Allow fallback call assist server turn.matrix.org when your homeserver does not offer one (your IP address would be shared during a call)"),default:null},showImages:{supportedLevels:j,displayName:Object(o.b)("Show previews/thumbnails for images"),default:!0},showRightPanelInRoom:{supportedLevels:M,default:!1},showRightPanelInGroup:{supportedLevels:M,default:!1},lastRightPanelPhaseForRoom:{supportedLevels:M,default:S.c.RoomSummary},lastRightPanelPhaseForGroup:{supportedLevels:M,default:S.c.GroupMemberList},enableEventIndexing:{supportedLevels:M,displayName:Object(o.b)("Enable message search in encrypted rooms"),default:!0},crawlerSleepTime:{supportedLevels:M,displayName:Object(o.b)("How fast should messages be downloaded."),default:3e3},showCallButtonsInComposer:{supportedLevels:U,default:!0,controller:new w(O.a.Voip)},"e2ee.manuallyVerifyAllSessions":{supportedLevels:M,displayName:Object(o.b)("Manually verify all remote sessions"),default:!1,controller:new x([new w(O.a.AdvancedEncryption),new h(n.b.prototype.setCryptoTrustCrossSignedDevices,!0)])},ircDisplayNameWidth:{supportedLevels:[_.a.ROOM_DEVICE,_.a.DEVICE],supportedLevelsAreOrdered:!0,displayName:Object(o.b)("IRC display name width"),default:80},layout:{supportedLevels:j,default:R.a.Group},showChatEffects:{supportedLevels:D,displayName:Object(o.b)("Show chat effects (animations when receiving e.g. confetti)"),default:!0,controller:new k},"Widgets.pinned":{supportedLevels:N,default:{}},"Widgets.layout":{supportedLevels:N,default:{}},"Widgets.leftPanel":{supportedLevels:j,default:null},[O.a.RoomHistorySettings]:{supportedLevels:L,default:!0},[O.a.AdvancedEncryption]:{supportedLevels:L,default:!0},[O.a.URLPreviews]:{supportedLevels:L,default:!0},[O.a.Widgets]:{supportedLevels:L,default:!0},[O.a.Voip]:{supportedLevels:L,default:!0},[O.a.Feedback]:{supportedLevels:L,default:!0},[O.a.Registration]:{supportedLevels:L,default:!0},[O.a.PasswordReset]:{supportedLevels:L,default:!0},[O.a.Deactivate]:{supportedLevels:L,default:!0},[O.a.ShareQRCode]:{supportedLevels:L,default:!0},[O.a.ShareSocial]:{supportedLevels:L,default:!0},[O.a.IdentityServer]:{supportedLevels:L,default:!0,controller:new w(O.a.ThirdPartyID)},[O.a.ThirdPartyID]:{supportedLevels:L,default:!0},[O.a.Flair]:{supportedLevels:L,default:!0,controller:new w(O.a.Communities)},[O.a.Communities]:{supportedLevels:L,default:!0,controller:new I("feature_spaces")},[O.a.AdvancedSettings]:{supportedLevels:L,default:!0}}},1541:function(e,t,a){"use strict";a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return m}));var n=a(0),s=a(1),i=a(213),o=a(585);const r={},l={};class c{constructor(e){this._userId=e.userId,this._deviceId=e.deviceId,this._crypto=e.crypto,this._olmDevice=e.olmDevice,this._baseApis=e.baseApis,this._roomId=e.roomId}prepareToEncrypt(e){}onRoomMembership(e,t,a){}}class d{constructor(e){this._userId=e.userId,this._crypto=e.crypto,this._olmDevice=e.olmDevice,this._baseApis=e.baseApis,this._roomId=e.roomId}onRoomKeyEvent(e){}importRoomKey(e){}hasKeysForKeyRequest(e){return Promise.resolve(!1)}shareKeysWithDevice(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}async retryDecryptionFromSender(e){}}class m extends Error{constructor(e,t,a){super(t),this.code=e,this.name="DecryptionError",this.detailedString=function(e,t){let a=e.name+"[msg: "+e.message;t&&(a+=", "+Object.keys(t).map(e=>e+": "+t[e]).join(", "));return a+="]",a}(this,a)}}class u extends Error{constructor(e,t){super(e),this.name="UnknownDeviceError",this.devices=t}}function h(e,t,a){r[e]=t,l[e]=a}const p=o.a.DeviceVerification;function g(e){Object(s.r)(this,c,e),this._sessionPrepared=!1,this._prepPromise=null}function f(e){Object(s.r)(this,d,e)}s.m(g,c),g.prototype._ensureSession=function(e){if(this._prepPromise)return this._prepPromise;if(this._sessionPrepared)return Promise.resolve();const t=this;return this._prepPromise=t._crypto.downloadKeys(e).then((function(a){return t._crypto.ensureOlmSessionsForUsers(e)})).then((function(){t._sessionPrepared=!0})).finally((function(){t._prepPromise=null})),this._prepPromise},g.prototype.encryptMessage=async function(e,t,a){const n=(await e.getEncryptionTargetMembers()).map((function(e){return e.userId})),s=this;await this._ensureSession(n);const o={room_id:e.roomId,type:t,content:a},r={algorithm:i.OLM_ALGORITHM,sender_key:s._olmDevice.deviceCurve25519Key,ciphertext:{}},l=[];for(let e=0;e<n.length;++e){const t=n[e],a=s._crypto.getStoredDevicesForUser(t);for(let e=0;e<a.length;++e){const n=a[e];n.getIdentityKey()!=s._olmDevice.deviceCurve25519Key&&(n.verified!=p.BLOCKED&&l.push(i.encryptMessageForDevice(r.ciphertext,s._userId,s._deviceId,s._olmDevice,t,n,o)))}}return await Promise.all(l).then(()=>r)},s.m(f,d),f.prototype.decryptEvent=async function(e){const t=e.getWireContent(),a=t.sender_key,n=t.ciphertext;if(!n)throw new m("OLM_MISSING_CIPHERTEXT","Missing ciphertext");if(!(this._olmDevice.deviceCurve25519Key in n))throw new m("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");const s=n[this._olmDevice.deviceCurve25519Key];let i;try{i=await this._decryptMessage(a,s)}catch(e){throw new m("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:a,err:e})}const o=JSON.parse(i);if(o.recipient!=this._userId)throw new m("OLM_BAD_RECIPIENT","Message was intented for "+o.recipient);if(o.recipient_keys.ed25519!=this._olmDevice.deviceEd25519Key)throw new m("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:o.recipient_keys.ed25519,our_key:this._olmDevice.deviceEd25519Key});if(o.sender!=e.getSender())throw new m("OLM_FORWARDED_MESSAGE","Message forwarded from "+o.sender,{reported_sender:e.getSender()});if(o.room_id!==e.getRoomId())throw new m("OLM_BAD_ROOM","Message intended for room "+o.room_id,{reported_room:e.room_id});return{clearEvent:o,senderCurve25519Key:a,claimedEd25519Key:(o.keys||{}).ed25519||null}},f.prototype._decryptMessage=async function(e,t){if(0!==t.type)return this._reallyDecryptMessage(e,t);{const a=this._olmDevice._olmPrekeyPromise.then(()=>this._reallyDecryptMessage(e,t));return this._olmDevice._olmPrekeyPromise=a.catch(()=>{}),await a}},f.prototype._reallyDecryptMessage=async function(e,t){const a=await this._olmDevice.getSessionIdsForDevice(e),s={};for(let i=0;i<a.length;i++){const o=a[i];try{const a=await this._olmDevice.decryptMessage(e,o,t.type,t.body);return n.a.log("Decrypted Olm message from "+e+" with session "+o),a}catch(a){if(await this._olmDevice.matchesSession(e,o,t.type,t.body))throw new Error("Error decrypting prekey message with existing session id "+o+": "+a.message);s[o]=a.message}}if(0!==t.type){if(0===a.length)throw new Error("No existing sessions");throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(s))}let i;try{i=await this._olmDevice.createInboundSession(e,t.type,t.body)}catch(e){throw s["(new)"]=e.message,new Error("Error decrypting prekey message: "+JSON.stringify(s))}return n.a.log("created new inbound Olm session ID "+i.session_id+" with "+e),i.payload},h(i.OLM_ALGORITHM,g,f);var v=a(1299);function b(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.sessionId=e,this.useCount=0,this.creationTime=(new Date).getTime(),this.sharedWithDevices={},this.blockedDevicesNotified={},this.sharedHistory=t}function y(e){Object(s.r)(this,c,e),this._setupPromise=Promise.resolve(),this._outboundSessions={},this._sessionRotationPeriodMsgs=100,this._sessionRotationPeriodMs=6048e5,void 0!==e.config.rotation_period_ms&&(this._sessionRotationPeriodMs=e.config.rotation_period_ms),void 0!==e.config.rotation_period_msgs&&(this._sessionRotationPeriodMsgs=e.config.rotation_period_msgs)}function E(e){Object(s.r)(this,d,e),this._pendingEvents={},this.olmlib=i}b.prototype.needsRotation=function(e,t){const a=(new Date).getTime()-this.creationTime;return(this.useCount>=e||a>=t)&&(n.a.log("Rotating megolm session after "+this.useCount+" messages, "+a+"ms"),!0)},b.prototype.markSharedWithDevice=function(e,t,a){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]=a},b.prototype.markNotifiedBlockedDevice=function(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0},b.prototype.sharedWithTooManyDevices=function(e){for(const t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return n.a.log("Starting new megolm session because we shared with "+t),!0;for(const a in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(a)&&!e[t].hasOwnProperty(a))return n.a.log("Starting new megolm session because we shared with "+t+":"+a),!0}},s.m(y,c),y.prototype._ensureOutboundSession=async function(e,t,a,s){let o;function r(){return o}const l=this._setupPromise.then(async r=>{o=r;const l=function(e){const t=e.currentState&&e.currentState.getStateEvents("m.room.history_visibility",""),a=t&&t.getContent()&&t.getContent().history_visibility;return["world_readable","shared"].includes(a)}(e);o&&l!==o.sharedHistory&&(o=null),o&&o.needsRotation(this._sessionRotationPeriodMsgs,this._sessionRotationPeriodMs)&&(n.a.log("Starting new megolm session because we need to rotate."),o=null),o&&o.sharedWithTooManyDevices(t)&&(o=null),o||(n.a.log("Starting new megolm session for room "+this._roomId),o=await this._prepareNewSession(l),n.a.log(`Started new megolm session ${o.sessionId} for room `+this._roomId),this._outboundSessions[o.sessionId]=o);const c={};for(const[e,a]of Object.entries(t))for(const[t,n]of Object.entries(a)){n.getIdentityKey()!=this._olmDevice.deviceCurve25519Key&&(o.sharedWithDevices[e]&&void 0!==o.sharedWithDevices[e][t]||(c[e]=c[e]||[],c[e].push(n)))}const d=this._olmDevice.getOutboundGroupSessionKey(o.sessionId),m={type:"m.room_key",content:{algorithm:i.MEGOLM_ALGORITHM,room_id:this._roomId,session_id:o.sessionId,session_key:d.key,chain_index:d.chain_index,"org.matrix.msc3061.shared_history":l}},[u,h]=await i.getExistingOlmSessions(this._olmDevice,this._baseApis,c);await Promise.all([(async()=>{n.a.debug("Sharing keys with existing Olm sessions in "+this._roomId),await this._shareKeyWithOlmSessions(o,d,m,h),n.a.debug("Shared keys with existing Olm sessions in "+this._roomId)})(),(async()=>{n.a.debug("Sharing keys (start phase 1) with new Olm sessions in "+this._roomId);const e=[],t=Date.now(),a=[];await this._shareKeyWithDevices(o,d,m,u,e,s?1e4:2e3,a),n.a.debug("Shared keys (end phase 1) with new Olm sessions in "+this._roomId),!s&&Date.now()-t<1e4?(async()=>{const t={},s=new Set;for(const e of a)s.add(e);const i=[];for(const{userId:a,deviceInfo:n}of e){const e=a.slice(a.indexOf(":")+1);s.has(e)?(t[a]=t[a]||[],t[a].push(n)):i.push({userId:a,deviceInfo:n})}n.a.debug("Sharing keys (start phase 2) with new Olm sessions in "+this._roomId),await this._shareKeyWithDevices(o,d,m,t,i,3e4),n.a.debug("Shared keys (end phase 2) with new Olm sessions in "+this._roomId),await this._notifyFailedOlmDevices(o,d,i)})():await this._notifyFailedOlmDevices(o,d,e),n.a.debug("Shared keys (all phases done) with new Olm sessions in "+this._roomId)})(),(async()=>{n.a.debug("Notifying blocked devices in "+this._roomId);const e={};let t=0;for(const[n,s]of Object.entries(a))for(const[a,i]of Object.entries(s))o.blockedDevicesNotified[n]&&void 0!==o.blockedDevicesNotified[n][a]||(e[n]=e[n]||{},e[n][a]={device:i},t++);await this._notifyBlockedDevices(o,e),n.a.debug(`Notified ${t} blocked devices in ${this._roomId}`)})()])});return l.catch(e=>{n.a.error("Failed to ensure outbound session in "+this._roomId,e)}),this._setupPromise=l.then(r,r),l.then(r)},y.prototype._prepareNewSession=async function(e){const t=this._olmDevice.createOutboundGroupSession(),a=this._olmDevice.getOutboundGroupSessionKey(t);return await this._olmDevice.addInboundGroupSession(this._roomId,this._olmDevice.deviceCurve25519Key,[],t,a.key,{ed25519:this._olmDevice.deviceEd25519Key},!1,{sharedHistory:e}),this._crypto._backupManager.backupGroupSession(this._olmDevice.deviceCurve25519Key,t),new b(t,e)},y.prototype._getDevicesWithoutSessions=function(e,t,a){a=a||[];for(const[n,s]of Object.entries(t)){const t=e[n];for(const e of s){const s=e.deviceId;t[s].sessionId||(a.push({userId:n,deviceInfo:e}),delete t[s])}}return a},y.prototype._splitDevices=function(e){let t=[];const a=[t];for(const[n,s]of Object.entries(e)){for(const e of Object.values(s))t.push({userId:n,deviceInfo:e.device});t.length>20&&(t=[],a.push(t))}return 0===t.length&&a.pop(),a},y.prototype._encryptAndSendKeysToDevices=function(e,t,a,s){const o={},r=[];for(let e=0;e<a.length;e++){const t={algorithm:i.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}},n=a[e],l=n.userId,c=n.deviceInfo,d=c.deviceId;o[l]||(o[l]={}),o[l][d]=t,r.push(i.encryptMessageForDevice(t.ciphertext,this._userId,this._deviceId,this._olmDevice,l,c,s))}return Promise.all(r).then(()=>{for(const e of Object.keys(o)){for(const t of Object.keys(o[e]))0===Object.keys(o[e][t].ciphertext).length&&(n.a.log("No ciphertext for device "+e+":"+t+": pruning"),delete o[e][t]);0===Object.keys(o[e]).length&&(n.a.log("Pruned all devices for user "+e),delete o[e])}if(0!==Object.keys(o).length)return this._baseApis.sendToDevice("m.room.encrypted",o).then(()=>{for(const a of Object.keys(o))for(const n of Object.keys(o[a]))e.markSharedWithDevice(a,n,t)});n.a.log("No users left to send to: aborting")})},y.prototype._sendBlockedNotificationsToDevices=async function(e,t,a){const n={};for(const e of t){const t=e.userId,s=e.deviceInfo,i=s.deviceInfo.deviceId,o=Object.assign({},a);o.code=s.code,o.reason=s.reason,"m.no_olm"===o.code&&(delete o.room_id,delete o.session_id),n[t]||(n[t]={}),n[t][i]=o}await this._baseApis.sendToDevice("org.matrix.room_key.withheld",n);for(const t of Object.keys(n))for(const a of Object.keys(n[t]))e.markNotifiedBlockedDevice(t,a)},y.prototype.reshareKeyWithDevice=async function(e,t,a,s){const o=this._outboundSessions[t];if(!o)return void n.a.debug(`megolm session ${t} not found: not re-sharing keys`);if(void 0===o.sharedWithDevices[a])return void n.a.debug(`megolm session ${t} never shared with user ${a}`);const r=o.sharedWithDevices[a][s.deviceId];if(void 0===r)return void n.a.debug("megolm session ID "+t+" never shared with device "+a+":"+s.deviceId);const l=await this._olmDevice.getInboundGroupSessionKey(this._roomId,e,t,r);if(!l)return void n.a.warn(`No inbound session key found for megolm ${t}: not re-sharing keys`);await i.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,{[a]:[s]});const c={type:"m.forwarded_room_key",content:{algorithm:i.MEGOLM_ALGORITHM,room_id:this._roomId,session_id:t,session_key:l.key,chain_index:l.chain_index,sender_key:e,sender_claimed_ed25519_key:l.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:l.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":l.shared_history||!1}},d={algorithm:i.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};await i.encryptMessageForDevice(d.ciphertext,this._userId,this._deviceId,this._olmDevice,a,s,c),await this._baseApis.sendToDevice("m.room.encrypted",{[a]:{[s.deviceId]:d}}),n.a.debug(`Re-shared key for megolm session ${t} with ${a}:${s.deviceId}`)},y.prototype._shareKeyWithDevices=async function(e,t,a,s,o,r,l){n.a.debug("Ensuring Olm sessions for devices in "+this._roomId);const c=await i.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,s,r,l,n.a.withPrefix(`[${this._roomId}]`));n.a.debug("Ensured Olm sessions for devices in "+this._roomId),this._getDevicesWithoutSessions(c,s,o),n.a.debug("Sharing keys with Olm sessions in "+this._roomId),await this._shareKeyWithOlmSessions(e,t,a,c),n.a.debug("Shared keys with Olm sessions in "+this._roomId)},y.prototype._shareKeyWithOlmSessions=async function(e,t,a,s){const i=this._splitDevices(s);for(let s=0;s<i.length;s++){const o=`megolm keys for ${e.sessionId} in ${this._roomId} (slice ${s+1}/${i.length})`;try{n.a.debug("Sharing "+o),await this._encryptAndSendKeysToDevices(e,t.chain_index,i[s],a),n.a.debug("Shared "+o)}catch(e){throw n.a.error("Failed to share "+o),e}}},y.prototype._notifyFailedOlmDevices=async function(e,t,a){n.a.debug(`Notifying ${a.length} devices we failed to create Olm sessions in `+this._roomId);for(const{userId:n,deviceInfo:s}of a){const a=s.deviceId;e.markSharedWithDevice(n,a,t.chain_index)}const s=await this._olmDevice.filterOutNotifiedErrorDevices(a);n.a.debug(`Filtered down to ${s.length} error devices in `+this._roomId);const i={};for(const{userId:e,deviceInfo:t}of s)i[e]=i[e]||{},i[e][t.deviceId]={device:{code:"m.no_olm",reason:v.b["m.no_olm"],deviceInfo:t}};await this._notifyBlockedDevices(e,i),n.a.debug(`Notified ${s.length} devices we failed to create Olm sessions in `+this._roomId)},y.prototype._notifyBlockedDevices=async function(e,t){const a={room_id:this._roomId,session_id:e.sessionId,algorithm:i.MEGOLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key},s=this._splitDevices(t);for(let t=0;t<s.length;t++)try{await this._sendBlockedNotificationsToDevices(e,s[t],a),n.a.log(`Completed blacklist notification for ${e.sessionId} in ${this._roomId} (slice ${t+1}/${s.length})`)}catch(a){throw n.a.log(`blacklist notification for ${e.sessionId} in ${this._roomId} (slice ${t+1}/${s.length}) failed`),a}},y.prototype.prepareToEncrypt=function(e){if(this.encryptionPreparation){const e=Date.now()-this.encryptionPreparationMetadata.startTime;n.a.debug(`Already started preparing to encrypt for ${this._roomId} `+e+" ms ago, skipping")}else n.a.debug("Preparing to encrypt events for "+this._roomId),this.encryptionPreparationMetadata={startTime:Date.now()},this.encryptionPreparation=(async()=>{try{n.a.debug("Getting devices in "+this._roomId);const[t,a]=await this._getDevicesInRoom(e);this._crypto.getGlobalErrorOnUnknownDevices()&&this._removeUnknownDevices(t),n.a.debug("Ensuring outbound session in "+this._roomId),await this._ensureOutboundSession(e,t,a,!0),n.a.debug("Ready to encrypt events for "+this._roomId)}catch(e){n.a.error("Failed to prepare to encrypt events for "+this._roomId,e)}finally{delete this.encryptionPreparationMetadata,delete this.encryptionPreparation}})()},y.prototype.encryptMessage=async function(e,t,a){if(n.a.log("Starting to encrypt event for "+this._roomId),this.encryptionPreparation)try{await this.encryptionPreparation}catch(e){}const[s,o]=await this._getDevicesInRoom(e);this._crypto.getGlobalErrorOnUnknownDevices()&&this._checkForUnknownDevices(s);const r=await this._ensureOutboundSession(e,s,o),l={room_id:this._roomId,type:t,content:a},c=this._olmDevice.encryptGroupMessage(r.sessionId,JSON.stringify(l)),d={algorithm:i.MEGOLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:c,session_id:r.sessionId,device_id:this._deviceId};return r.useCount++,d},y.prototype.forceDiscardSession=function(){this._setupPromise=this._setupPromise.then(()=>null)},y.prototype._checkForUnknownDevices=function(e){const t={};if(Object.keys(e).forEach(a=>{Object.keys(e[a]).forEach(n=>{const s=e[a][n];s.isUnverified()&&!s.isKnown()&&(t[a]||(t[a]={}),t[a][n]=s)})}),Object.keys(t).length)throw new u("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)},y.prototype._removeUnknownDevices=function(e){for(const[t,a]of Object.entries(e)){for(const[e,t]of Object.entries(a))t.isUnverified()&&!t.isKnown()&&delete a[e];0===Object.keys(a).length&&delete e[t]}},y.prototype._getDevicesInRoom=async function(e){const t=(await e.getEncryptionTargetMembers()).map((function(e){return e.userId}));let a=this._crypto.getGlobalBlacklistUnverifiedDevices();"boolean"==typeof e.getBlacklistUnverifiedDevices()&&(a=e.getBlacklistUnverifiedDevices());const n=await this._crypto.downloadKeys(t,!1),s={};for(const e in n){if(!n.hasOwnProperty(e))continue;const t=n[e];for(const n in t){if(!t.hasOwnProperty(n))continue;const i=this._crypto.checkDeviceTrust(e,n);if(t[n].isBlocked()||!i.isVerified()&&a){s[e]||(s[e]={});const a=t[n].isBlocked()?{code:"m.blacklisted",reason:v.b["m.blacklisted"]}:{code:"m.unverified",reason:v.b["m.unverified"]};a.deviceInfo=t[n],s[e][n]=a,delete t[n]}}}return[n,s]},s.m(E,d);const _={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};E.prototype.decryptEvent=async function(e){const t=e.getWireContent();if(!t.sender_key||!t.session_id||!t.ciphertext)throw new m("MEGOLM_MISSING_FIELDS","Missing fields in input");let a;this._addEventToPendingList(e);try{a=await this._olmDevice.decryptGroupMessage(e.getRoomId(),t.sender_key,t.session_id,t.ciphertext,e.getId(),e.getTs())}catch(a){if("DecryptionError"===a.name)throw a;let n="OLM_DECRYPT_GROUP_MESSAGE_ERROR";throw a&&"OLM.UNKNOWN_MESSAGE_INDEX"===a.message&&(this._requestKeysForEvent(e),n="OLM_UNKNOWN_MESSAGE_INDEX"),new m(n,a?a.toString():"Unknown Error: Error is undefined",{session:t.sender_key+"|"+t.session_id})}if(null===a){this._requestKeysForEvent(e);const a=await this._olmDevice.sessionMayHaveProblems(t.sender_key,e.getTs()-12e4);if(a){let e=_[a.type]||_.unknown;throw a.fixed&&(e+=" Trying to create a new secure channel and re-requesting the keys."),new m("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",e,{session:t.sender_key+"|"+t.session_id})}throw new m("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:t.sender_key+"|"+t.session_id})}this._removeEventFromPendingList(e);const n=JSON.parse(a.result);if(n.room_id!==e.getRoomId())throw new m("MEGOLM_BAD_ROOM","Message intended for room "+n.room_id);return{clearEvent:n,senderCurve25519Key:a.senderKey,claimedEd25519Key:a.keysClaimed.ed25519,forwardingCurve25519KeyChain:a.forwardingCurve25519KeyChain,untrusted:a.untrusted}},E.prototype._requestKeysForEvent=function(e){const t=e.getWireContent(),a=e.getKeyRequestRecipients(this._userId);this._crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},a)},E.prototype._addEventToPendingList=function(e){const t=e.getWireContent(),a=t.sender_key,n=t.session_id;this._pendingEvents[a]||(this._pendingEvents[a]=new Map);const s=this._pendingEvents[a];s.has(n)||s.set(n,new Set),s.get(n).add(e)},E.prototype._removeEventFromPendingList=function(e){const t=e.getWireContent(),a=t.sender_key,n=t.session_id,s=this._pendingEvents[a],i=s&&s.get(n);i&&(i.delete(e),0===i.size&&s.delete(a),0===s.size&&delete this._pendingEvents[a])},E.prototype.onRoomKeyEvent=function(e){const t=e.getContent(),a=t.session_id;let s,i=e.getSenderKey(),o=[],r=!1;if(!t.room_id||!a||!t.session_key)return void n.a.error("key event is missing fields");if(!i)return void n.a.error("key event has no sender key (not encrypted?)");if("m.forwarded_room_key"==e.getType()){if(r=!0,o=t.forwarding_curve25519_key_chain,Array.isArray(o)||(o=[]),o=o.slice(),o.push(i),i=t.sender_key,!i)return void n.a.error("forwarded_room_key event is missing sender_key field");const e=t.sender_claimed_ed25519_key;if(!e)return void n.a.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");s={ed25519:e}}else s=e.getKeysClaimed();const l={};return t["org.matrix.msc3061.shared_history"]&&(l.sharedHistory=!0),this._olmDevice.addInboundGroupSession(t.room_id,i,o,a,t.session_key,s,r,l).then(()=>{this._retryDecryption(i,a).then(e=>{e&&this._crypto.cancelRoomKeyRequest({algorithm:t.algorithm,room_id:t.room_id,session_id:t.session_id,sender_key:i})})}).then(()=>{this._crypto._backupManager.backupGroupSession(i,t.session_id)}).catch(e=>{n.a.error("Error handling m.room_key_event: "+e)})},E.prototype.onRoomKeyWithheldEvent=async function(e){const t=e.getContent(),a=t.sender_key;if("m.no_olm"===t.code){const s=e.getSender();if(n.a.warn(`${s}:${a} was unable to establish an olm session with us`),await this._olmDevice.getSessionIdForDevice(a))return n.a.debug("New session already created.  Not creating a new one."),await this._olmDevice.recordSessionProblem(a,"no_olm",!0),void this.retryDecryptionFromSender(a);let o=this._crypto._deviceList.getDeviceByIdentityKey(t.algorithm,a);if(!o&&(await this._crypto.downloadKeys([s],!1),o=this._crypto._deviceList.getDeviceByIdentityKey(t.algorithm,a),!o))return n.a.info("Couldn't find device for identity key "+a+": not establishing session"),await this._olmDevice.recordSessionProblem(a,"no_olm",!1),void this.retryDecryptionFromSender(a);await i.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,{[s]:[o]},!1);const r={algorithm:i.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};await i.encryptMessageForDevice(r.ciphertext,this._userId,this._deviceId,this._olmDevice,s,o,{type:"m.dummy"}),await this._olmDevice.recordSessionProblem(a,"no_olm",!0),this.retryDecryptionFromSender(a),await this._baseApis.sendToDevice("m.room.encrypted",{[s]:{[o.deviceId]:r}})}else await this._olmDevice.addInboundGroupSessionWithheld(t.room_id,a,t.session_id,t.code,t.reason)},E.prototype.hasKeysForKeyRequest=function(e){const t=e.requestBody;return this._olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)},E.prototype.shareKeysWithDevice=function(e){const t=e.userId,a=e.deviceId,s=this._crypto.getStoredDevice(t,a),o=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,{[t]:[s]}).then(e=>e[t][a].sessionId?(n.a.log("sharing keys for session "+o.sender_key+"|"+o.session_id+" with device "+t+":"+a),this._buildKeyForwardingMessage(o.room_id,o.sender_key,o.session_id)):null).then(e=>{const n={algorithm:i.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};return this.olmlib.encryptMessageForDevice(n.ciphertext,this._userId,this._deviceId,this._olmDevice,t,s,e).then(()=>{const e={[t]:{[a]:n}};return this._baseApis.sendToDevice("m.room.encrypted",e)})})},E.prototype._buildKeyForwardingMessage=async function(e,t,a){const n=await this._olmDevice.getInboundGroupSessionKey(e,t,a);return{type:"m.forwarded_room_key",content:{algorithm:i.MEGOLM_ALGORITHM,room_id:e,sender_key:t,sender_claimed_ed25519_key:n.sender_claimed_ed25519_key,session_id:a,session_key:n.key,chain_index:n.chain_index,forwarding_curve25519_key_chain:n.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":n.shared_history||!1}}},E.prototype.importRoomKey=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a={};return t.untrusted&&(a.untrusted=!0),e["org.matrix.msc3061.shared_history"]&&(a.sharedHistory=!0),this._olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,a).then(()=>{"backup"!==t.source&&this._crypto._backupManager.backupGroupSession(e.sender_key,e.session_id).catch(e=>{n.a.log("Failed to back up megolm session",e)}),this._retryDecryption(e.sender_key,e.session_id)})},E.prototype._retryDecryption=async function(e,t){const a=this._pendingEvents[e];if(!a)return!0;const s=a.get(t);return!s||(n.a.debug("Retrying decryption on events",[...s]),await Promise.all([...s].map(async e=>{try{await e.attemptDecryption(this._crypto,{isRetry:!0})}catch(e){}})),!(this._pendingEvents[e]||{})[t])},E.prototype.retryDecryptionFromSender=async function(e){const t=this._pendingEvents[e];return!t||(delete this._pendingEvents[e],await Promise.all([...t].map(async e=>{let[t,a]=e;await Promise.all([...a].map(async e=>{try{await e.attemptDecryption(this._crypto)}catch(e){}}))})),!this._pendingEvents[e])},E.prototype.sendSharedHistoryInboundSessions=async function(e){await i.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,e),n.a.log("sendSharedHistoryInboundSessions to users",Object.keys(e));const t=await this._olmDevice.getSharedHistoryInboundGroupSessions(this._roomId);n.a.log("shared-history sessions",t);for(const[a,s]of t){const t=await this._buildKeyForwardingMessage(this._roomId,a,s),o=[],r={};for(const[a,n]of Object.entries(e)){r[a]={};for(const e of n){const n={algorithm:i.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};r[a][e.deviceId]=n,o.push(i.encryptMessageForDevice(n.ciphertext,this._userId,this._deviceId,this._olmDevice,a,e,t))}}await Promise.all(o);for(const e of Object.keys(r)){for(const t of Object.keys(r[e]))0===Object.keys(r[e][t].ciphertext).length&&(n.a.log("No ciphertext for device "+e+":"+t+": pruning"),delete r[e][t]);0===Object.keys(r[e]).length&&(n.a.log("Pruned all devices for user "+e),delete r[e])}if(0===Object.keys(r).length)return void n.a.log("No users left to send to: aborting");await this._baseApis.sendToDevice("m.room.encrypted",r)}},h(i.MEGOLM_ALGORITHM,y,E)},1542:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n=a(19),s=a.n(n),i=a(206),o=a(153);var r=a(99),l=a(1353),c=a(106),d=a(1354),m=a(1543);const u={};var h=a(1355),p=a(247),g=a(140),f=a(282),v=a(374),b=a(100),y=a(155);class E extends i.WidgetDriver{constructor(e,t,a,n){if(super(),this.forWidget=t,this.forWidgetKind=a,this.inRoomId=n,s()(this,"allowedCapabilities",void 0),this.allowedCapabilities=new Set([...e,i.MatrixCapabilities.Screenshots]),p.a.JITSI.matches(this.forWidget.type)&&a===i.WidgetKind.Room)this.allowedCapabilities.add(i.MatrixCapabilities.AlwaysOnScreen);else if(p.a.STICKERPICKER.matches(this.forWidget.type)&&a===i.WidgetKind.Account){const e=i.WidgetEventCapability.forRoomEvent(i.EventDirection.Send,g.a.Sticker).raw;this.allowedCapabilities.add(i.MatrixCapabilities.StickerSending),this.allowedCapabilities.add(e),this.allowedCapabilities.add("visibility")}}async validateCapabilities(e){const t=(a=e,n=this.allowedCapabilities,Object(o.a)(Array.from(a),Array.from(n)));var a,n;const s=new Set(t.removed),i=new Set(this.allowedCapabilities);if(Object(m.b)(this.forWidget).forEach(e=>{i.add(e),s.delete(e)}),u.preapproveCapabilities){const t=await u.preapproveCapabilities(this.forWidget,e);t&&t.forEach(e=>{i.add(e),s.delete(e)})}if(s.size>0)try{const[e]=await c.a.createTrackedDialog("Approve Widget Caps","",m.a,{requestedCapabilities:s,widget:this.forWidget,widgetKind:this.forWidgetKind}).finished;(e.approved||[]).forEach(e=>i.add(e))}catch(e){console.error("Non-fatal error getting capabilities: ",e)}return new Set(function(e,t){return Object(o.k)(Array.from(e),Array.from(t))}(i,e))}async sendEvent(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=r.a.get(),s=l.a.activeRoomId;if(!n||!s)throw new Error("Not in a room or not attached to a client");let i=null;return null!==a?i=await n.sendStateEvent(s,e,t,a):(i=await n.sendEvent(s,e,t),e===g.a.RoomMessage&&f.CHAT_EFFECTS.forEach(e=>{Object(v.containsEmoji)(t,e.emojis)&&b.a.dispatch({action:"effects."+e.command})})),{roomId:s,eventId:i.event_id}}async readRoomEvents(e,t,a){a=a>0?Math.min(a,25):25;const n=r.a.get(),s=l.a.activeRoomId,i=n.getRoom(s);if(!n||!s||!i)throw new Error("Not in a room or not attached to a client");const o=[],c=i.getLiveTimeline().getEvents();for(let n=c.length-1;n>0&&!(o.length>=a);n--){const a=c[n];a.getType()===e&&(e===g.a.RoomMessage&&t&&t!==a.getContent().msgtype||o.push(a))}return o.map(e=>e.event)}async readStateEvents(e,t,a){a=a>0?Math.min(a,100):100;const n=r.a.get(),s=l.a.activeRoomId,i=n.getRoom(s);if(!n||!s||!i)throw new Error("Not in a room or not attached to a client");const o=[],c=i.currentState.events.get(e);if(c)if(""===t||t){const e=c.get(t);e&&o.push(e)}else o.push(...Array.from(c.values()));return o.slice(0,a).map(e=>e.event)}async askOpenID(e){const t=h.b.instance.getOIDCState(this.forWidget,this.forWidgetKind,this.inRoomId),a=()=>r.a.get().getOpenIdToken();return t===h.a.Denied?e.update({state:i.OpenIDRequestState.Blocked}):t===h.a.Allowed?e.update({state:i.OpenIDRequestState.Allowed,token:await a()}):(e.update({state:i.OpenIDRequestState.PendingUserConfirmation}),void c.a.createTrackedDialog("OpenID widget permissions","",d.a,{widget:this.forWidget,widgetKind:this.forWidgetKind,inRoomId:this.inRoomId,onFinished:async t=>t?e.update({state:i.OpenIDRequestState.Allowed,token:await a()}):e.update({state:i.OpenIDRequestState.Blocked})}))}async navigate(e){const t=Object(y.l)(e);if(!t||t===e)throw new Error("Failed to transform URI");window.location.hash=t}}},1543:function(e,t,a){"use strict";a.d(t,"b",(function(){return y})),a.d(t,"a",(function(){return E}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(182),l=a(93),c=a(206),d=a(166),m=a(228),u=a(303),h=a(281),p=a(140),g=a(1356);class f{static bylineFor(e){return e.isState?e.keyStr?Object(l.a)("with state key %(stateKey)s",{stateKey:e.keyStr}):Object(l.a)("with an empty state key"):null}static for(e,t){if(f.simpleCaps[e]){const a=f.simpleCaps[e];if(a[t])return{primary:Object(l.a)(a[t])};if(a.generic)return{primary:Object(l.a)(a.generic)}}const[a]=c.WidgetEventCapability.findEventCapabilities([e]);if(a){if(!a.isState&&a.eventType===p.a.RoomMessage)return f.forRoomMessageCap(a,t);const e=a.isState?f.stateSendRecvCaps:f.nonStateSendRecvCaps;if(e[a.eventType]){const n=e[a.eventType],s=n[t]||n.generic;if(s&&s[a.direction])return{primary:Object(l.a)(s[a.direction])}}return t===c.WidgetKind.Room?a.direction===c.EventDirection.Send?{primary:Object(l.a)("Send <b>%(eventType)s</b> events as you in this room",{eventType:a.eventType},{b:e=>o.a.createElement("b",null,e)}),byline:f.bylineFor(a)}:{primary:Object(l.a)("See <b>%(eventType)s</b> events posted to this room",{eventType:a.eventType},{b:e=>o.a.createElement("b",null,e)}),byline:f.bylineFor(a)}:a.direction===c.EventDirection.Send?{primary:Object(l.a)("Send <b>%(eventType)s</b> events as you in your active room",{eventType:a.eventType},{b:e=>o.a.createElement("b",null,e)}),byline:f.bylineFor(a)}:{primary:Object(l.a)("See <b>%(eventType)s</b> events posted to your active room",{eventType:a.eventType},{b:e=>o.a.createElement("b",null,e)}),byline:f.bylineFor(a)}}return{primary:Object(l.a)("The <b>%(capability)s</b> capability",{capability:e},{b:e=>o.a.createElement("b",null,e)})}}static forRoomMessageCap(e,t){if(!e.keyStr)return e.direction===c.EventDirection.Send?{primary:t===c.WidgetKind.Room?Object(l.a)("Send messages as you in this room"):Object(l.a)("Send messages as you in your active room")}:{primary:t===c.WidgetKind.Room?Object(l.a)("See messages posted to this room"):Object(l.a)("See messages posted to your active room")};switch(e.keyStr){case p.b.Text:return e.direction===c.EventDirection.Send?{primary:t===c.WidgetKind.Room?Object(l.a)("Send text messages as you in this room"):Object(l.a)("Send text messages as you in your active room")}:{primary:t===c.WidgetKind.Room?Object(l.a)("See text messages posted to this room"):Object(l.a)("See text messages posted to your active room")};case p.b.Emote:return e.direction===c.EventDirection.Send?{primary:t===c.WidgetKind.Room?Object(l.a)("Send emotes as you in this room"):Object(l.a)("Send emotes as you in your active room")}:{primary:t===c.WidgetKind.Room?Object(l.a)("See emotes posted to this room"):Object(l.a)("See emotes posted to your active room")};case p.b.Image:return e.direction===c.EventDirection.Send?{primary:t===c.WidgetKind.Room?Object(l.a)("Send images as you in this room"):Object(l.a)("Send images as you in your active room")}:{primary:t===c.WidgetKind.Room?Object(l.a)("See images posted to this room"):Object(l.a)("See images posted to your active room")};case p.b.Video:return e.direction===c.EventDirection.Send?{primary:t===c.WidgetKind.Room?Object(l.a)("Send videos as you in this room"):Object(l.a)("Send videos as you in your active room")}:{primary:t===c.WidgetKind.Room?Object(l.a)("See videos posted to this room"):Object(l.a)("See videos posted to your active room")};case p.b.File:return e.direction===c.EventDirection.Send?{primary:t===c.WidgetKind.Room?Object(l.a)("Send general files as you in this room"):Object(l.a)("Send general files as you in your active room")}:{primary:t===c.WidgetKind.Room?Object(l.a)("See general files posted to this room"):Object(l.a)("See general files posted to your active room")};default:{let a;return a=e.direction===c.EventDirection.Send?t===c.WidgetKind.Room?Object(l.a)("Send <b>%(msgtype)s</b> messages as you in this room",{msgtype:e.keyStr},{b:e=>o.a.createElement("b",null,e)}):Object(l.a)("Send <b>%(msgtype)s</b> messages as you in your active room",{msgtype:e.keyStr},{b:e=>o.a.createElement("b",null,e)}):t===c.WidgetKind.Room?Object(l.a)("See <b>%(msgtype)s</b> messages posted to this room",{msgtype:e.keyStr},{b:e=>o.a.createElement("b",null,e)}):Object(l.a)("See <b>%(msgtype)s</b> messages posted to your active room",{msgtype:e.keyStr},{b:e=>o.a.createElement("b",null,e)}),{primary:a}}}}}s()(f,"simpleCaps",{[c.MatrixCapabilities.AlwaysOnScreen]:{[c.WidgetKind.Room]:Object(l.b)("Remain on your screen when viewing another room, when running"),generic:Object(l.b)("Remain on your screen while running")},[c.MatrixCapabilities.StickerSending]:{[c.WidgetKind.Room]:Object(l.b)("Send stickers into this room"),generic:Object(l.b)("Send stickers into your active room")},[g.a.CanChangeViewedRoom]:{generic:Object(l.b)("Change which room you're viewing")},[c.MatrixCapabilities.MSC2931Navigate]:{generic:Object(l.b)("Change which room, message, or user you're viewing")}}),s()(f,"stateSendRecvCaps",{[p.a.RoomTopic]:{[c.WidgetKind.Room]:{[c.EventDirection.Send]:Object(l.b)("Change the topic of this room"),[c.EventDirection.Receive]:Object(l.b)("See when the topic changes in this room")},generic:{[c.EventDirection.Send]:Object(l.b)("Change the topic of your active room"),[c.EventDirection.Receive]:Object(l.b)("See when the topic changes in your active room")}},[p.a.RoomName]:{[c.WidgetKind.Room]:{[c.EventDirection.Send]:Object(l.b)("Change the name of this room"),[c.EventDirection.Receive]:Object(l.b)("See when the name changes in this room")},generic:{[c.EventDirection.Send]:Object(l.b)("Change the name of your active room"),[c.EventDirection.Receive]:Object(l.b)("See when the name changes in your active room")}},[p.a.RoomAvatar]:{[c.WidgetKind.Room]:{[c.EventDirection.Send]:Object(l.b)("Change the avatar of this room"),[c.EventDirection.Receive]:Object(l.b)("See when the avatar changes in this room")},generic:{[c.EventDirection.Send]:Object(l.b)("Change the avatar of your active room"),[c.EventDirection.Receive]:Object(l.b)("See when the avatar changes in your active room")}},[p.a.RoomMember]:{[c.WidgetKind.Room]:{[c.EventDirection.Send]:Object(l.b)("Kick, ban, or invite people to this room, and make you leave"),[c.EventDirection.Receive]:Object(l.b)("See when people join, leave, or are invited to this room")},generic:{[c.EventDirection.Send]:Object(l.b)("Kick, ban, or invite people to your active room, and make you leave"),[c.EventDirection.Receive]:Object(l.b)("See when people join, leave, or are invited to your active room")}}}),s()(f,"nonStateSendRecvCaps",{[p.a.Sticker]:{[c.WidgetKind.Room]:{[c.EventDirection.Send]:Object(l.b)("Send stickers to this room as you"),[c.EventDirection.Receive]:Object(l.b)("See when a sticker is posted in this room")},generic:{[c.EventDirection.Send]:Object(l.b)("Send stickers to your active room as you"),[c.EventDirection.Receive]:Object(l.b)("See when anyone posts a sticker to your active room")}}});var v,b=a(94);function y(e){return JSON.parse(localStorage.getItem(`widget_${e.id}_approved_caps`)||"[]")}let E=Object(b.a)("views.dialogs.WidgetCapabilitiesPromptDialog")(v=class extends o.a.PureComponent{constructor(e){super(e),s()(this,"eventPermissionsMap",new Map),s()(this,"onToggle",e=>{const t=Object(d.e)(this.state.booleanStates);t[e]=!t[e],this.setState({booleanStates:t})}),s()(this,"onRememberSelectionChange",e=>{this.setState({rememberSelection:e})}),s()(this,"onSubmit",async e=>{this.closeAndTryRemember(Object.entries(this.state.booleanStates).filter(e=>{let[t,a]=e;return a}).map(e=>{let[t]=e;return t}))}),s()(this,"onReject",async e=>{this.closeAndTryRemember([])});c.WidgetEventCapability.findEventCapabilities(this.props.requestedCapabilities).forEach(e=>this.eventPermissionsMap.set(e.raw,e));const t={};this.props.requestedCapabilities.forEach(e=>t[e]=!0),this.state={booleanStates:t,rememberSelection:!0}}closeAndTryRemember(e){var t,a;this.state.rememberSelection&&(t=this.props.widget,a=e,localStorage.setItem(`widget_${t.id}_approved_caps`,JSON.stringify(a))),this.props.onFinished({approved:e})}render(){const e=Object.entries(this.state.booleanStates).map((e,t)=>{let[a,n]=e;const s=f.for(a,this.props.widgetKind),i=s.byline?o.a.createElement("span",{className:"mx_WidgetCapabilitiesPromptDialog_byline"},s.byline):null;return o.a.createElement("div",{className:"mx_WidgetCapabilitiesPromptDialog_cap",key:a+t},o.a.createElement(m.a,{checked:n,onChange:()=>this.onToggle(a)},s.primary),i)});return o.a.createElement(r.a,{className:"mx_WidgetCapabilitiesPromptDialog",onFinished:this.props.onFinished,title:Object(l.a)("Approve widget permissions")},o.a.createElement("form",{onSubmit:this.onSubmit},o.a.createElement("div",{className:"mx_Dialog_content"},o.a.createElement("div",{className:"text-muted"},Object(l.a)("This widget would like to:")),e,o.a.createElement(u.a,{primaryButton:Object(l.a)("Approve"),cancelButton:Object(l.a)("Decline All"),onPrimaryButtonClick:this.onSubmit,onCancel:this.onReject,additive:o.a.createElement(h.a,{value:this.state.rememberSelection,toggleInFront:!0,onChange:this.onRememberSelectionChange,label:Object(l.a)("Remember my selection for this widget")})}))))}})||v},1544:function(e,t,a){"use strict";a.d(t,"a",(function(){return T}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(92),l=a.n(r),c=a(102),d=a.n(c),m=a(370),u=a(501),h=a(100),p=a(97),g=a(1305),f=a(215),v=a(332),b=a(283),y=a(103),E=a(823),_=a(863),S=a(864),C=a(865),w=a(267),O=a(9);var x,R,k=a(94),I=a(200);let T=Object(k.a)("views.rooms.AppsDrawer")((R=class extends o.a.Component{constructor(e){super(e),s()(this,"onIsResizing",e=>{this.setState({resizingVertical:e}),e||this._relaxResizer()}),s()(this,"_collectResizer",e=>{this._resizeContainer&&this.resizer.detach(),e&&(this.resizer.container=e,this.resizer.attach()),this._resizeContainer=e,this._loadResizerPreferences()}),s()(this,"_getAppsHash",e=>e.map(e=>e.id).join("~")),s()(this,"_relaxResizer",()=>{const e=this.resizer.getDistributors();e.forEach(e=>e.start()),e.forEach(e=>e.finish())}),s()(this,"_loadResizerPreferences",()=>{const e=w.d.instance.getResizerDistributions(this.props.room,w.a.Top);if(this.state.apps&&this.state.apps.length-1===e.length)e.forEach((e,t)=>{const a=this.resizer.forHandleAt(t);a&&(a.size=e,a.finish())});else if(this.state.apps){const e=this.resizer.getDistributors();e.forEach(e=>e.item.clearSize()),e.forEach(e=>e.start()),e.forEach(e=>e.finish())}}),s()(this,"onAction",e=>{const t=this.props.room.roomId+"_hide_widget_drawer";switch(e.action){case"appsDrawer":e.show?localStorage.setItem(t,"false"):localStorage.setItem(t,"true")}}),s()(this,"_getApps",()=>w.d.instance.getContainerWidgets(this.props.room,w.a.Top)),s()(this,"_updateApps",()=>{this.setState({apps:this._getApps()})}),this.state={apps:this._getApps(),resizingVertical:!1,resizingHorizontal:!1},this._resizeContainer=null,this.resizer=this._createResizer(),this.props.resizeNotifier.on("isResizing",this.onIsResizing)}componentDidMount(){g.b(),w.d.instance.on(w.d.emissionForRoom(this.props.room),this._updateApps),this.dispatcherRef=h.a.register(this.onAction)}componentWillUnmount(){g.c(),w.d.instance.off(w.d.emissionForRoom(this.props.room),this._updateApps),this.dispatcherRef&&h.a.unregister(this.dispatcherRef),this._resizeContainer&&this.resizer.detach(),this.props.resizeNotifier.off("isResizing",this.onIsResizing)}UNSAFE_componentWillReceiveProps(e){this._updateApps()}_createResizer(){const e={onResizeStart:()=>{this._resizeContainer.classList.add("mx_AppsDrawer_resizing"),this.setState({resizingHorizontal:!0})},onResizeStop:()=>{this._resizeContainer.classList.remove("mx_AppsDrawer_resizing"),w.d.instance.setResizerDistributions(this.props.room,w.a.Top,this.state.apps.slice(1).map((e,t)=>this.resizer.forHandleAt(t).size)),this.setState({resizingHorizontal:!1})}},t=new S.a({},C.a,e);return t.setClassNames({handle:"mx_ResizeHandle",vertical:"mx_ResizeHandle_vertical",reverse:"mx_ResizeHandle_reverse"}),t}componentDidUpdate(e,t){this._getAppsHash(this.state.apps)!==this._getAppsHash(t.apps)&&this._loadResizerPreferences()}isResizing(){return this.state.resizingVertical||this.state.resizingHorizontal}_launchManageIntegrations(){y.b.getValue("feature_many_integration_managers")?b.a.sharedInstance().openAll():b.a.sharedInstance().getPrimaryManager().open(this.props.room,"add_integ")}render(){if(!this.props.showApps)return o.a.createElement("div",null);const e=this.state.apps.map((e,t,a)=>o.a.createElement(u.a,{key:e.id,app:e,fullWidth:a.length<2,room:this.props.room,userId:this.props.userId,creatorUserId:e.creatorUserId,widgetPageTitle:f.a.getWidgetDataTitle(e),waitForIframeLoad:e.waitForIframeLoad,pointerEvents:this.isResizing()?"none":void 0}));if(0===e.length)return o.a.createElement("div",null);let t;if(0===e.length&&v.a.roomHasPendingWidgets(this.props.room.roomId,f.a.getRoomWidgets(this.props.room))){const e=p.getComponent("elements.Spinner");t=o.a.createElement(e,null)}const a=d()({mx_AppsDrawer:!0,mx_AppsDrawer_fullWidth:e.length<2,mx_AppsDrawer_resizing:this.state.resizing,mx_AppsDrawer_2apps:2===e.length,mx_AppsDrawer_3apps:3===e.length});return o.a.createElement("div",{className:a},o.a.createElement(P,{room:this.props.room,minHeight:100,maxHeight:this.props.maxHeight?this.props.maxHeight-50:void 0,handleClass:"mx_AppsContainer_resizerHandle",handleWrapperClass:"mx_AppsContainer_resizerHandleContainer",className:"mx_AppsContainer_resizer",resizeNotifier:this.props.resizeNotifier},o.a.createElement("div",{className:"mx_AppsContainer",ref:this._collectResizer},e.map((t,a)=>a<1?t:o.a.createElement(o.a.Fragment,{key:t.key},o.a.createElement(_.a,{reverse:a>e.length/2}),t)))),t)}},s()(R,"propTypes",{userId:l.a.string.isRequired,room:l.a.object.isRequired,resizeNotifier:l.a.instanceOf(E.a).isRequired,showApps:l.a.bool}),s()(R,"defaultProps",{showApps:!0}),x=R))||x;const P=e=>{let{room:t,minHeight:a,maxHeight:n,className:s,handleWrapperClass:r,handleClass:l,resizeNotifier:c,children:d}=e,u=w.d.instance.getContainerHeight(t,w.a.Top);a||(a=100),n||(n=I.b.instance.windowHeight/4*3),u?(u=Object(O.a)(u,0,100),u=Object(O.d)(u/100,a,n)):u=280;const[h,p]=((e,t)=>{const[a,n]=Object(i.useState)(e);return[a,e=>{n(e),t(e)}]})(u,e=>{e=100*Object(O.c)(e,a,n),w.d.instance.setContainerHeight(t,w.a.Top,e)});return o.a.createElement(m.Resizable,{size:{height:Math.min(h,n)},minHeight:a,maxHeight:n,onResizeStart:()=>{c.startResizing()},onResize:()=>{c.notifyTimelineHeightChanged()},onResizeStop:(e,t,a,n)=>{p(h+n.height),c.stopResizing()},handleWrapperClass:r,handleClasses:{bottom:l},className:s,enable:{bottom:!0}},d)}},1545:function(e,t,a){"use strict";a.d(t,"a",(function(){return j})),a.d(t,"b",(function(){return A}));var n=a(19),s=a.n(n),i=a(206),o=a(1542),r=a(8),l=a(420),c=a(165),d=a(99),m=a(253),u=a(215),h=a(283),p=a(103),g=a(247),f=a(490),v=a(166),b=a(100),y=a(5),E=a(237),_=a(106),S=a(1357);function C(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function w(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?C(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):C(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class O extends E.a{constructor(){super(b.a,{}),s()(this,"modalInstance",null),s()(this,"openSourceWidgetId",null),s()(this,"canOpenModalWidget",()=>!this.modalInstance),s()(this,"openModalWidget",(e,t,a)=>{this.modalInstance||(this.openSourceWidgetId=t.id,this.modalInstance=_.a.createTrackedDialog("Modal Widget","",S.a,{widgetDefinition:w({},e),widgetRoomId:a,sourceWidgetId:t.id,onFinished:(e,a)=>{e?this.closeModalWidget(t,a):this.closeModalWidget(t,{"m.exited":!0}),this.openSourceWidgetId=null,this.modalInstance=null}},null,!1,!0))}),s()(this,"closeModalWidget",(e,t)=>{if(this.modalInstance&&this.openSourceWidgetId===e.id){this.openSourceWidgetId=null,this.modalInstance.close(),this.modalInstance=null;const a=l.a.instance.getMessaging(e);if(!a)return void console.error("No source widget messaging for modal widget");a.notifyModalWidgetClose(t)}})}static get instance(){return O.internalInstance}async onAction(e){}}s()(O,"internalInstance",new O),window.mxModalWidgetStore=O.instance;var x=a(494),R=a(335),k=a(154),I=a(1356),T=a(1358),P=a(93);function N(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function D(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?N(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class j extends i.Widget{constructor(e){super(e),this.rawDefinition=e}get templateUrl(){var e;return g.a.JITSI.matches(this.type)?u.a.getLocalJitsiWrapperUrl({forLocalRender:!0,auth:null===(e=super.rawData)||void 0===e?void 0:e.auth}):super.templateUrl}get popoutTemplateUrl(){var e;return g.a.JITSI.matches(this.type)?u.a.getLocalJitsiWrapperUrl({forLocalRender:!1,auth:null===(e=super.rawData)||void 0===e?void 0:e.auth}):this.templateUrl}get rawData(){let e=super.rawData.conferenceId;if(void 0===e){e=new URL(super.templateUrl).searchParams.get("confId")}let t=super.rawData.domain;void 0===t&&(t="jitsi.riot.im");let a=(new x.a).getEffectiveTheme();if(a.startsWith("custom-")){const e=Object(R.c)(a.substr(7));a=e.is_dark?"dark":"light"}return a=a.includes("light")?"light":"dark",D(D({},super.rawData),{},{theme:a,conferenceId:e,domain:t})}getCompleteUrl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(i.runTemplate)(t?this.popoutTemplateUrl:this.templateUrl,D(D({},this.rawDefinition),{},{data:this.rawData}),e)}}class A extends r.EventEmitter{constructor(e){var t;super(),this.appTileProps=e,s()(this,"messaging",void 0),s()(this,"mockWidget",void 0),s()(this,"scalarToken",void 0),s()(this,"roomId",void 0),s()(this,"kind",void 0),s()(this,"onOpenModal",async e=>{e.preventDefault(),O.instance.canOpenModalWidget()?(O.instance.openModalWidget(e.detail.data,this.mockWidget),this.messaging.transport.reply(e.detail,{})):this.messaging.transport.reply(e.detail,{error:{message:"Unable to open modal at this time"}})}),s()(this,"onEvent",e=>{d.a.get().decryptEventIfNeeded(e),e.isBeingDecrypted()||e.isDecryptionFailure()||e.getRoomId()===this.eventListenerRoomId&&this.feedEvent(e)}),s()(this,"onEventDecrypted",e=>{e.isDecryptionFailure()||e.getRoomId()===this.eventListenerRoomId&&this.feedEvent(e)});let a=e.app;a.creatorUserId||(a=Object(v.e)(a),a.creatorUserId=d.a.get().getUserId()),this.mockWidget=new j(a),this.roomId=null===(t=e.room)||void 0===t?void 0:t.roomId,this.kind=e.userWidget?i.WidgetKind.Account:i.WidgetKind.Room}get eventListenerRoomId(){return this.roomId?this.roomId:c.a.getRoomId()}get widgetApi(){return this.messaging}get embedUrl(){return this.runUrlTemplate({asPopout:!1})}get popoutUrl(){return this.runUrlTemplate({asPopout:!0})}runUrlTemplate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asPopout:!1};const t=this.mockWidget.getCompleteUrl({widgetRoomId:this.roomId,currentUserId:d.a.get().getUserId(),userDisplayName:m.a.instance.displayName,userHttpAvatarUrl:m.a.instance.getHttpAvatarUrl(),clientId:T.a,clientTheme:p.b.getValue("theme"),clientLanguage:Object(P.g)()},null==e?void 0:e.asPopout),a=new URL(t);return null!=e&&e.asPopout||(a.searchParams.set("widgetId",this.mockWidget.id),a.searchParams.set("parentUrl",window.location.href.split("#",2)[0]),this.scalarToken&&a.searchParams.set("scalar_token",this.scalarToken)),a.toString().replace(/%24/g,"$")}get isManagedByManager(){return!!this.scalarToken}get started(){return!!this.messaging}get widgetId(){return this.messaging.widget.id}start(e){if(this.started)return;const t=this.appTileProps.whitelistCapabilities||[],a=new o.a(t,this.mockWidget,this.kind,this.roomId);this.messaging=new i.ClientWidgetApi(this.mockWidget,e,a),this.messaging.on("preparing",()=>this.emit("preparing")),this.messaging.on("ready",()=>this.emit("ready")),this.messaging.on("action:"+i.WidgetApiFromWidgetAction.OpenModalWidget,this.onOpenModal),l.a.instance.storeMessaging(this.mockWidget,this.messaging),!this.appTileProps.userWidget&&this.appTileProps.room&&f.a.setRoomId(this.mockWidget.id,this.appTileProps.room.roomId),this.messaging.on("action:"+y.a.ViewRoom,e=>{e.preventDefault();const t=(e.detail.data||{}).room_id;return t?this.messaging.hasCapability(I.a.CanChangeViewedRoom)?(b.a.dispatch({action:"view_room",room_id:t}),void this.messaging.transport.reply(e.detail,{})):this.messaging.transport.reply(e.detail,{error:{message:"This widget does not have permission for this action (denied)."}}):this.messaging.transport.reply(e.detail,{error:{message:"Room ID not supplied."}})}),d.a.get().on("event",this.onEvent),d.a.get().on("Event.decrypted",this.onEventDecrypted),this.messaging.on("action:"+i.WidgetApiFromWidgetAction.UpdateAlwaysOnScreen,e=>{this.messaging.hasCapability(i.MatrixCapabilities.AlwaysOnScreen)&&(g.a.JITSI.matches(this.mockWidget.type)&&k.a.instance.trackJoinCall(this.appTileProps.room.roomId,!0,!0),f.a.setWidgetPersistence(this.mockWidget.id,e.detail.data.value),e.preventDefault(),this.messaging.transport.reply(e.detail,{}))}),this.messaging.on("action:"+i.WidgetApiFromWidgetAction.SendSticker,e=>{this.messaging.hasCapability(i.MatrixCapabilities.StickerSending)&&(e.preventDefault(),this.messaging.transport.reply(e.detail,{}),b.a.dispatch({action:"m.sticker",data:e.detail.data,widgetId:this.mockWidget.id}))}),g.a.STICKERPICKER.matches(this.mockWidget.type)&&this.messaging.on("action:"+y.a.OpenIntegrationManager,e=>{e.preventDefault(),this.messaging.transport.reply(e.detail,{}),b.a.dispatch({action:"stickerpicker_close"});const t=e.detail.data,a=null==t?void 0:t.integType,n=null==t?void 0:t.integId;p.b.getValue("feature_many_integration_managers")?h.a.sharedInstance().openAll(d.a.get().getRoom(c.a.getRoomId()),"type_"+a,n):h.a.sharedInstance().getPrimaryManager().open(d.a.get().getRoom(c.a.getRoomId()),"type_"+a,n)})}async prepare(){if(this.scalarToken)return;const e=l.a.instance.getMessaging(this.mockWidget);e&&(this.messaging=e);try{if(u.a.isScalarUrl(this.mockWidget.templateUrl)){const e=h.a.sharedInstance();if(e.hasManager()){const t=e.getPrimaryManager();if(u.a.isScalarUrl(t.apiUrl)){const e=t.getScalarClient();this.scalarToken=await e.getScalarToken()}}}}catch(e){console.error("Error preparing widget communications: ",e)}}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{forceDestroy:!1};null!=e&&e.forceDestroy||f.a.getPersistentWidgetId()!==this.mockWidget.id?this.started&&(l.a.instance.stopMessaging(this.mockWidget),f.a.delRoomId(this.mockWidget.id),d.a.get()&&(d.a.get().off("event",this.onEvent),d.a.get().off("Event.decrypted",this.onEventDecrypted))):console.log("Skipping destroy - persistent widget")}feedEvent(e){if(!this.messaging)return;const t=e.event;this.messaging.feedEvent(t).catch(e=>{console.error("Error sending event to widget: ",e)})}}},1546:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return i}));var n=a(19),s=a.n(n);let i;!function(e){e.APP_STARTUP="mx_AppStartup",e.PAGE_CHANGE="mx_PageChange",e.RESEND_EVENT="mx_ResendEvent",e.SEND_E2EE_EVENT="mx_SendE2EEEvent",e.SEND_ATTACHMENT="mx_SendAttachment",e.SWITCH_ROOM="mx_SwithRoom",e.JUMP_TO_ROOM="mx_JumpToRoom",e.JOIN_ROOM="mx_JoinRoom",e.CREATE_DM="mx_CreateDM",e.PEEK_ROOM="mx_PeekRoom",e.VERIFY_E2EE_USER="mx_VerifyE2EEUser",e.LOGIN="mx_Login",e.REGISTER="mx_Register",e.SETUP_VOIP_CALL="mx_SetupVoIPCall"}(i||(i={}));class o{constructor(){s()(this,"START_PREFIX","start:"),s()(this,"STOP_PREFIX","stop:"),s()(this,"listeners",[]),s()(this,"entries",[])}static get instance(){return o._instance||(o._instance=new o),o._instance}start(e,t){if(!this.supportsPerformanceApi())return;const a=this.buildKey(e,t);performance.getEntriesByName(this.START_PREFIX+a).length>0?console.warn("Recording already started for: "+e):performance.mark(this.START_PREFIX+a)}stop(e,t){if(!this.supportsPerformanceApi())return;const a=this.buildKey(e,t);if(0===performance.getEntriesByName(this.START_PREFIX+a).length)return void console.warn("No recording started for: "+e);performance.mark(this.STOP_PREFIX+a),performance.measure(a,this.START_PREFIX+a,this.STOP_PREFIX+a),this.clear(e,t);const n=performance.getEntriesByName(a).pop();return this.entries.push(n),this.listeners.forEach(e=>{this.shouldEmit(e,n)&&e.callback([n])}),n}clear(e,t){if(!this.supportsPerformanceApi())return;const a=this.buildKey(e,t);performance.clearMarks(this.START_PREFIX+a),performance.clearMarks(this.STOP_PREFIX+a)}getEntries(){let{name:e,type:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.entries.filter(a=>{const n=!e||a.name===e,s=!t||a.entryType===t;return n&&s})}addPerformanceDataCallback(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.listeners.push(e),t){const t=this.entries.filter(t=>this.shouldEmit(e,t));t.length>0&&e.callback(t)}}removePerformanceDataCallback(e){e?this.listeners.splice(this.listeners.findIndex(t=>t.callback===e),1):this.listeners=[]}supportsPerformanceApi(){return void 0!==performance&&void 0!==performance.mark}shouldEmit(e,t){return!e.entryNames||e.entryNames.includes(t.name)}buildKey(e,t){return`${e}${t?":"+t:""}`}}s()(o,"_instance",void 0),window.mxPerformanceMonitor=o.instance,window.mxPerformanceEntryNames=i},155:function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"e",(function(){return f})),a.d(t,"h",(function(){return v})),a.d(t,"g",(function(){return b})),a.d(t,"f",(function(){return y})),a.d(t,"d",(function(){return E})),a.d(t,"k",(function(){return _})),a.d(t,"l",(function(){return S})),a.d(t,"c",(function(){return C})),a.d(t,"j",(function(){return O})),a.d(t,"i",(function(){return x})),a.d(t,"b",(function(){return P}));var n=a(19),s=a.n(n),i=a(2309),o=a.n(i),r=a(1),l=a(140),c=a(99),d=a(1248),m=a(1249);class u extends m.b{constructor(e){if(super(),s()(this,"elementUrl",void 0),this.elementUrl=e,!this.elementUrl.startsWith("http:")&&!this.elementUrl.startsWith("https:"))throw new Error("Element prefix URL does not appear to be an HTTP(S) URL")}forEvent(e,t,a){return`${this.elementUrl}/#/room/${e}/${t}${this.encodeServerCandidates(a)}`}forRoom(e,t){return`${this.elementUrl}/#/room/${e}${this.encodeServerCandidates(t)}`}forUser(e){return`${this.elementUrl}/#/user/${e}`}forGroup(e){return`${this.elementUrl}/#/group/${e}`}forEntity(e){if("!"===e[0]||"#"===e[0])return this.forRoom(e);if("@"===e[0])return this.forUser(e);if("+"===e[0])return this.forGroup(e);throw new Error("Unrecognized entity")}isPermalinkHost(e){const t=new URL(this.elementUrl);return e===(t.host||t.hostname)}encodeServerCandidates(e){return e&&0!==e.length?"?via="+e.map(e=>encodeURIComponent(e)).join("&via="):""}parsePermalink(e){if(!e||!e.startsWith(this.elementUrl))throw new Error("Does not appear to be a permalink");const t=e.substring((this.elementUrl+"/#/").length);return u.parseAppRoute(t)}static parseAppRoute(e){const t=e.split("/");if(t.length<2)throw new Error("URL is missing parts");const[a]=t.splice(-1,1),[n,s=""]=a.split("?");t.push(n);const i=t[0],o=t[1];if("user"===i)return m.a.forUser(o);if("group"===i)return m.a.forGroup(o);if("room"===i){const e=t.length>2?t.slice(2).join("/"):"",a=s.split(/&?via=/).filter(e=>!!e);return m.a.forEvent(o,e,a)}throw new Error("Unknown entity type in permalink")}}var h=a(573),p=a(110);class g{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(s()(this,"room",void 0),s()(this,"roomId",void 0),s()(this,"highestPlUserId",void 0),s()(this,"populationMap",void 0),s()(this,"bannedHostsRegexps",void 0),s()(this,"allowedHostsRegexps",void 0),s()(this,"_serverCandidates",void 0),s()(this,"started",void 0),s()(this,"onRoomState",e=>{switch(e.getType()){case l.a.RoomServerAcl:return this.updateAllowedServers(),this.updateHighestPlUser(),this.updatePopulationMap(),void this.updateServerCandidates();case l.a.RoomPowerLevels:return this.updateHighestPlUser(),void this.updateServerCandidates()}}),s()(this,"onMembership",(e,t,a)=>{const n=t.userId,s=t.membership,i=R(n),o="join"!==a&&"join"===s;"join"===a&&"join"!==s?this.populationMap[i]--:o&&this.populationMap[i]++,this.updateHighestPlUser(),this.updateServerCandidates()}),this.room=e,this.roomId=e?e.roomId:t,this.highestPlUserId=null,this.populationMap=null,this.bannedHostsRegexps=null,this.allowedHostsRegexps=null,this._serverCandidates=null,this.started=!1,!this.roomId)throw new Error("Failed to resolve a roomId for the permalink creator to use")}load(){this.room&&this.room.currentState?(this.updateAllowedServers(),this.updateHighestPlUser(),this.updatePopulationMap(),this.updateServerCandidates()):console.warn("Tried to load a permalink creator with no room state")}start(){this.load(),this.room.on("RoomMember.membership",this.onMembership),this.room.on("RoomState.events",this.onRoomState),this.started=!0}stop(){this.room.removeListener("RoomMember.membership",this.onMembership),this.room.removeListener("RoomState.events",this.onRoomState),this.started=!1}get serverCandidates(){return this._serverCandidates}isStarted(){return this.started}forEvent(e){return w().forEvent(this.roomId,e,this._serverCandidates)}forShareableRoom(){if(this.room){const e=this.room.getCanonicalAlias();if(e)return w().forRoom(e,this._serverCandidates)}return w().forRoom(this.roomId,this._serverCandidates)}forRoom(){return w().forRoom(this.roomId,this._serverCandidates)}updateHighestPlUser(){const e=this.room.currentState.getStateEvents("m.room.power_levels","");if(e){const t=e.getContent();if(t){const e=t.users;if(e){const t=Object.entries(e).filter(e=>{let[t]=e;const a=this.room.getMember(t);if(!a||"join"!==a.membership)return!1;const n=R(t);return!T(n)&&!I(n,this.bannedHostsRegexps)&&I(n,this.allowedHostsRegexps)}).reduce((e,t)=>t[1]>e[1]?t:e,[null,0]),[a,n]=t;if(null!==a&&n>=50)return void(this.highestPlUserId=a)}}}this.highestPlUserId=null}updateAllowedServers(){const e=[];let t=[new RegExp(".*")];if(this.room.currentState){const a=this.room.currentState.getStateEvents("m.room.server_acl","");if(a&&a.getContent()){const n=e=>new RegExp("^"+r.l(e,!1)+"$");(a.getContent().deny||[]).forEach(t=>e.push(n(t)));const s=a.getContent().allow||[];t=[],s.forEach(e=>t.push(n(e)))}}this.bannedHostsRegexps=e,this.allowedHostsRegexps=t}updatePopulationMap(){const e={};for(const t of this.room.getJoinedMembers()){const a=R(t.userId);e[a]||(e[a]=0),e[a]++}this.populationMap=e}updateServerCandidates(){let e=[];this.highestPlUserId&&e.push(R(this.highestPlUserId));const t=Object.keys(this.populationMap).sort((e,t)=>this.populationMap[t]-this.populationMap[e]).filter(t=>!e.includes(t)&&!T(t)&&!I(t,this.bannedHostsRegexps)&&I(t,this.allowedHostsRegexps)).slice(0,3-e.length);e=e.concat(t),this._serverCandidates=e}}function f(e){return w().forEntity(e)}function v(e){return w().forUser(e)}function b(e){if(!e)throw new Error("can't permalink a falsey roomId");if("!"!==e[0])return w().forRoom(e,[]);const t=c.a.get().getRoom(e);if(!t)return w().forRoom(e,[]);const a=new g(t);return a.load(),a.forRoom()}function y(e){return w().forGroup(e)}function E(e){return!!(new d.b).isPermalinkHost(e)||w().isPermalinkHost(e)}function _(e){return e?"#"===e[0]||"!"===e[0]?b(e):"@"===e[0]?v(e):"+"===e[0]?y(e):S(e):null}function S(e){if(!e.startsWith("http:")&&!e.startsWith("https:"))return e;try{const t=decodeURIComponent(e).match(h.a.ELEMENT_URL_PATTERN);if(t)return t[1]}catch(t){return e}try{const t=O(e);if(t)if(t.roomIdOrAlias){const a=t.eventId?"/"+t.eventId:"";e=`#/room/${t.roomIdOrAlias}${a}`,t.viaServers.length>0&&(e+=(new d.b).encodeServerCandidates(t.viaServers))}else t.groupId?e="#/group/"+t.groupId:t.userId&&(e="#/user/"+t.userId)}catch(e){}return e}function C(e){try{let t=O(e);if(!t){const a=e.match(h.a.ELEMENT_URL_PATTERN);if(a){const e=new u("http://localhost"),n=a[1].split("#").slice(1).join("#");t=e.parsePermalink("http://localhost/#"+n)}}if(!t)return null;if(t.userId)return t.userId;if(t.groupId)return t.groupId;if(t.roomIdOrAlias)return t.roomIdOrAlias}catch(e){}return null}function w(){const e=p.a.get().permalinkPrefix;return e&&e!==d.a?new u(e):new d.b}function O(e){const t=p.a.get().permalinkPrefix;return decodeURIComponent(e).startsWith(d.a)?(new d.b).parsePermalink(decodeURIComponent(e)):t&&e.startsWith(t)?new u(t).parsePermalink(e):null}function x(e){try{const t=e.replace("#/","");return u.parseAppRoute(t)}catch(e){}return null}function R(e){return e.split(":").splice(1).join(":")}function k(e){return e?new URL("https://"+e).hostname:null}function I(e,t){if(!(e=k(e)))return!0;if(t.length>0&&!t[0].test)throw new Error(t[0].toString());return t.filter(t=>t.test(e)).length>0}function T(e){return!!(e=k(e))&&(e.startsWith("[")&&e.endsWith("]")&&(e=e.substring(1,e.length-1)),o()(e))}const P=e=>{const t=new g(e);return t.load(),t.serverCandidates}},156:function(e,t,a){"use strict";var n=a(19),s=a.n(n);class i{constructor(){s()(this,"platform",null)}get(){return this.platform}set(e){this.platform=e}}window.mxPlatformPeg||(window.mxPlatformPeg=new i),t.a=window.mxPlatformPeg},1564:function(e,t,a){"use strict";(function(e){class n{constructor(){this.components=null}getComponent(e){if(!e)throw new Error("Invalid component name: "+e);if(null===this.components)throw new Error(`Attempted to get a component (${e}) before a skin has been loaded. This is probably because either: a) Your app has not called sdk.loadSkin(), or b) A component has called getComponent at the root level`);const t=(t=>{if(!t)return null;let a=t[e];return a||(a=t["views."+e]),a})(this.components);if(!t)return null;if(!("function"==typeof t||t.render))throw new Error(`Not a valid component: ${e} (type = ${typeof t}).`);return t}load(e){if(null!==this.components)throw new Error("Attempted to load a skin while a skin is already loadedIf you want to change the active skin, call resetSkin first");this.components={};const t=Object.keys(e.components);for(let a=0;a<t.length;++a){const n=e.components[t[a]];this.addComponent(t[a],n)}const n=a(8470);if(!n||!n.components)throw new Error("Invalid react-sdk component index");for(const e in n.components)this.components[e]||(this.components[e]=n.components[e])}addComponent(e,t){let a=e;void 0!==t.replaces&&(a=t.replaces.indexOf(".")>-1?t.replaces:e.substr(0,e.lastIndexOf(".")+1)+t.replaces.split(".").pop()),this.components[a]=t}reset(){this.components=null}}void 0===e.mxSkinner&&(e.mxSkinner=new n),t.a=e.mxSkinner}).call(this,a(7))},158:function(e,t,a){"use strict";(function(e){a.d(t,"c",(function(){return L})),a.d(t,"b",(function(){return B})),a.d(t,"a",(function(){return V})),a.d(t,"d",(function(){return G}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(99),l=a(156),c=a(106),d=a(93),m=a(100),u=a(215),h=a(332),p=a(103),g=a(788),f=a(247),v=a(123),b=a(1314),y=a(216),E=a(186),_=a(299),S=a(420),C=a(5),w=a(238),O=a(181),x=a(154),R=a(147),k=a(0),I=a(1317),T=a(115),P=a(1326),N=a(2485),D=a(294),j=a(8),A=a.n(j),M=a(110),U=a(214);const L="im.vector.is_virtual_room";var F;let B,V;!function(e){e.Ring="ringAudio",e.Ringback="ringbackAudio",e.CallEnd="callendAudio",e.Busy="busyAudio"}(F||(F={})),function(e){e.Voice="voice",e.Video="video",e.ScreenSharing="screensharing"}(B||(B={})),function(e){e.CallsChanged="calls_changed",e.CallChangeRoom="call_change_room"}(V||(V={}));class G extends A.a{constructor(){super(...arguments),s()(this,"calls",new Map),s()(this,"transferees",new Map),s()(this,"audioPromises",new Map),s()(this,"dispatcherRef",null),s()(this,"supportsPstnProtocol",null),s()(this,"pstnSupportPrefixed",null),s()(this,"supportsSipNativeVirtual",null),s()(this,"pstnSupportCheckTimer",void 0),s()(this,"invitedRoomsAreVirtual",new Map),s()(this,"invitedRoomCheckInProgress",!1),s()(this,"assertedIdentityNativeUsers",new Map),s()(this,"onCallIncoming",e=>{m.a.dispatch({action:"incoming_call",call:e},!0)}),s()(this,"onAction",e=>{switch(e.action){case"place_call":{if(Object(N.b)())return void Object(N.a)(e.room_id);if(!r.a.get().supportsVoip())return void c.a.createTrackedDialog("Call Handler","VoIP is unsupported",E.a,{title:Object(d.a)("VoIP is unsupported"),description:Object(d.a)("You cannot place VoIP calls in this browser.")});if(this.getAllActiveCalls().length>1)return void c.a.createTrackedDialog("Call Handler","Existing Call",E.a,{title:Object(d.a)("Too Many Calls"),description:Object(d.a)("You've reached the maximum number of simultaneous calls.")});const t=r.a.get().getRoom(e.room_id);if(!t)return void console.error(`Room ${e.room_id} does not exist.`);if(this.getCallForRoom(t.roomId))return void c.a.createTrackedDialog("Call Handler","Existing Call with user",E.a,{title:Object(d.a)("Already in call"),description:Object(d.a)("You're already in a call with this person.")});const a=t.getJoinedMembers();if(a.length<=1)return void c.a.createTrackedDialog("Call Handler","Cannot place call with self",E.a,{description:Object(d.a)("You cannot place a call with yourself.")});2===a.length?(console.info(`Place ${e.type} call in ${e.room_id}`),this.placeCall(e.room_id,e.type,e.transferee)):m.a.dispatch({action:"place_conference_call",room_id:e.room_id,type:e.type})}break;case"place_conference_call":console.info("Place conference call in "+e.room_id),O.a.trackEvent("voip","placeConferenceCall"),x.a.instance.trackStartCall(e.room_id,e.type===B.Video,!0),this.startCallApp(e.room_id,e.type);break;case"end_conference":console.info("Terminating conference call in "+e.room_id),this.terminateCallApp(e.room_id);break;case"hangup_conference":console.info("Leaving conference call in "+e.room_id),this.hangupCallApp(e.room_id);break;case"incoming_call":{if(!r.a.get().supportsVoip())return;const t=e.call,a=G.sharedInstance().roomIdForCall(t);if(this.getCallForRoom(a))return void console.log("Got incoming call for room "+a+" but there's already a call for this room: ignoring");O.a.trackEvent("voip","receiveCall","type",t.type),this.calls.set(a,t),this.emit(V.CallsChanged,this.calls),this.setCallListeners(t);const n=r.a.get();n.prepareToEncrypt(n.getRoom(t.roomId))}break;case"hangup":case"reject":if(!this.calls.get(e.room_id))return;"reject"===e.action?this.calls.get(e.room_id).reject():this.calls.get(e.room_id).hangup(w.b.UserHangup,!1);break;case"hangup_all":for(const e of this.calls.values())e.hangup(w.b.UserHangup,!1);break;case"answer":{if(!this.calls.has(e.room_id))return;if(this.getAllActiveCalls().length>1)return void c.a.createTrackedDialog("Call Handler","Existing Call",E.a,{title:Object(d.a)("Too Many Calls"),description:Object(d.a)("You've reached the maximum number of simultaneous calls.")});const t=this.calls.get(e.room_id);t.answer(),this.setActiveCallRoomId(e.room_id),x.a.instance.trackJoinCall(e.room_id,t.type===w.f.Video,!1);break}case T.a.DialNumber:this.dialNumber(e.number)}})}static sharedInstance(){return window.mxCallHandler||(window.mxCallHandler=new G),window.mxCallHandler}roomIdForCall(e){if(!e)return null;const t=M.a.get().voip;if(t&&t.obeyAssertedIdentity){const t=this.assertedIdentityNativeUsers[e.callId];if(t){const e=Object(U.g)(r.a.get(),t);if(e)return e.roomId}}return P.a.sharedInstance().nativeRoomForVirtualRoom(e.roomId)||e.roomId}start(){this.dispatcherRef=m.a.register(this.onAction),navigator.mediaSession&&(navigator.mediaSession.setActionHandler("play",(function(){})),navigator.mediaSession.setActionHandler("pause",(function(){})),navigator.mediaSession.setActionHandler("seekbackward",(function(){})),navigator.mediaSession.setActionHandler("seekforward",(function(){})),navigator.mediaSession.setActionHandler("previoustrack",(function(){})),navigator.mediaSession.setActionHandler("nexttrack",(function(){}))),p.b.getValue(R.a.Voip)&&r.a.get().on("Call.incoming",this.onCallIncoming),this.checkProtocols(3)}stop(){const e=r.a.get();e&&e.removeListener("Call.incoming",this.onCallIncoming),null!==this.dispatcherRef&&(m.a.unregister(this.dispatcherRef),this.dispatcherRef=null)}async checkProtocols(e){try{const e=await r.a.get().getThirdpartyProtocols();void 0!==e["m.protocol.pstn"]?(this.supportsPstnProtocol=Boolean(e["m.protocol.pstn"]),this.supportsPstnProtocol&&(this.pstnSupportPrefixed=!1)):void 0!==e["im.vector.protocol.pstn"]?(this.supportsPstnProtocol=Boolean(e["im.vector.protocol.pstn"]),this.supportsPstnProtocol&&(this.pstnSupportPrefixed=!0)):this.supportsPstnProtocol=null,m.a.dispatch({action:T.a.PstnSupportUpdated}),void 0!==e["im.vector.protocol.sip_native"]&&void 0!==e["im.vector.protocol.sip_virtual"]&&(this.supportsSipNativeVirtual=Boolean(e["im.vector.protocol.sip_native"]&&e["im.vector.protocol.sip_virtual"])),m.a.dispatch({action:T.a.VirtualRoomSupportUpdated})}catch(t){1===e?console.log("Failed to check for protocol support and no retries remain: assuming no support",t):(console.log("Failed to check for protocol support: will retry",t),this.pstnSupportCheckTimer=setTimeout(()=>{this.checkProtocols(e-1)},1e4))}}getSupportsPstnProtocol(){return this.supportsPstnProtocol}getSupportsVirtualRooms(){return this.supportsSipNativeVirtual}pstnLookup(e){return r.a.get().getThirdpartyUser(this.pstnSupportPrefixed?"im.vector.protocol.pstn":"m.protocol.pstn",{"m.id.phone":e})}sipVirtualLookup(e){return r.a.get().getThirdpartyUser("im.vector.protocol.sip_virtual",{native_mxid:e})}sipNativeLookup(e){return r.a.get().getThirdpartyUser("im.vector.protocol.sip_native",{virtual_mxid:e})}getCallForRoom(e){return this.calls.get(e)||null}getAnyActiveCall(){for(const e of this.calls.values())if(e.state!==w.e.Ended)return e;return null}getAllActiveCalls(){const e=[];for(const t of this.calls.values())t.state!==w.e.Ended&&t.state!==w.e.Ringing&&e.push(t);return e}getAllActiveCallsNotInRoom(e){const t=[];for(const[a,n]of this.calls.entries())a!==e&&n.state!==w.e.Ended&&t.push(n);return t}getTransfereeForCallId(e){return this.transferees[e]}play(e){const t=document.getElementById(e);if(t){const a=async()=>{try{await t.play()}catch(e){console.log("Unable to play audio clip",e)}};this.audioPromises.has(e)?this.audioPromises.set(e,this.audioPromises.get(e).then(()=>(t.load(),a()))):this.audioPromises.set(e,a())}}pause(e){const t=document.getElementById(e);t&&(this.audioPromises.has(e)?this.audioPromises.set(e,this.audioPromises.get(e).then(()=>t.pause())):t.pause())}matchesCallForThisRoom(e){const t=this.roomIdForCall(e),a=this.getCallForRoom(t);return a&&e.callId===a.callId}setCallListeners(e){let t=G.sharedInstance().roomIdForCall(e);e.on(w.c.Error,t=>{this.matchesCallForThisRoom(e)&&(O.a.trackEvent("voip","callError","error",t.toString()),console.error("Call error:",t),t.code!==w.b.NoUserMedia?0!==r.a.get().getTurnServers().length||null!==p.b.getValue("fallbackICEServerAllowed")?c.a.createTrackedDialog("Call Failed","",E.a,{title:Object(d.a)("Call Failed"),description:t.message}):this.showICEFallbackPrompt():this.showMediaCaptureError(e))}),e.on(w.c.Hangup,()=>{this.matchesCallForThisRoom(e)&&(O.a.trackEvent("voip","callHangup"),this.removeCallForRoom(t))}),e.on(w.c.State,(a,n)=>{if(this.matchesCallForThisRoom(e)){switch(this.setCallState(e,a),n){case w.e.Ringing:this.pause(F.Ring);break;case w.e.InviteSent:this.pause(F.Ringback)}switch(a){case w.e.Ringing:this.play(F.Ring);break;case w.e.InviteSent:this.play(F.Ringback);break;case w.e.Ended:if(O.a.trackEvent("voip","callEnded","hangupReason",e.hangupReason),this.removeCallForRoom(t),n===w.e.InviteSent&&(e.hangupParty===w.d.Remote||e.hangupParty===w.d.Local&&e.hangupReason===w.b.InviteTimeout)){let t,a;this.play(F.Busy),e.hangupReason===w.b.UserHangup?(t=Object(d.a)("Call Declined"),a=Object(d.a)("The other party declined the call.")):e.hangupReason===w.b.UserBusy?(t=Object(d.a)("User Busy"),a=Object(d.a)("The user you called is busy.")):e.hangupReason===w.b.InviteTimeout?(t=Object(d.a)("Call Failed"),a=Object(d.a)("The remote side failed to pick up")+"."):(t=Object(d.a)("Call Failed"),a=Object(d.a)("The call could not be established")),c.a.createTrackedDialog("Call Handler","Call Failed",E.a,{title:t,description:a})}else e.hangupReason===w.b.AnsweredElsewhere&&n===w.e.Connecting?c.a.createTrackedDialog("Call Handler","Call Failed",E.a,{title:Object(d.a)("Answered Elsewhere"),description:Object(d.a)("The call was answered on another device.")}):n!==w.e.Fledgling&&n!==w.e.Ringing&&this.play(F.CallEnd);this.logCallStats(e,t)}}}),e.on(w.c.Replaced,a=>{this.matchesCallForThisRoom(e)&&(console.log(`Call ID ${e.callId} is being replaced by call ID ${a.callId}`),e.state===w.e.Ringing?this.pause(F.Ring):e.state===w.e.InviteSent&&this.pause(F.Ringback),this.calls.set(t,a),this.emit(V.CallsChanged,this.calls),this.setCallListeners(a),this.setCallState(a,a.state))}),e.on(w.c.AssertedIdentityChanged,async()=>{if(!this.matchesCallForThisRoom(e))return;console.log(`Call ID ${e.callId} got new asserted identity:`,e.getRemoteAssertedIdentity());const a=e.getRemoteAssertedIdentity().id;let n=a;if(a){const e=await this.sipNativeLookup(a);e.length&&e[0].fields.lookup_success&&(n=e[0].userid)}if(console.log(`Asserted identity ${a} mapped to ${n}`),n){this.assertedIdentityNativeUsers[e.callId]=n,await Object(U.e)(r.a.get(),n);const a=this.roomIdForCall(e);console.log(`Old room ID: ${t}, new room ID: ${a}`),a!==t&&(this.removeCallForRoom(t),t=a,this.calls.set(t,e),this.emit(V.CallChangeRoom,e))}})}async logCallStats(e,t){const a=await e.getCurrentCallStats();if(k.a.debug(`Call completed. Call ID: ${e.callId}, virtual room ID: ${e.roomId}, user-facing room ID: ${t}, direction: ${e.direction}, our Party ID: ${e.ourPartyId}, hangup party: ${e.hangupParty}, hangup reason: `+e.hangupReason),a){k.a.debug("Local candidates:");for(const e of a.filter(e=>"local-candidate"===e.type)){const t=e.address||e.ip;k.a.debug(`${e.id} - type: ${e.candidateType}, address: ${t}, port: ${e.port}, protocol: ${e.protocol}, relay protocol: ${e.relayProtocol}, network type: ${e.networkType}`)}k.a.debug("Remote candidates:");for(const e of a.filter(e=>"remote-candidate"===e.type)){const t=e.address||e.ip;k.a.debug(`${e.id} - type: ${e.candidateType}, address: ${t}, port: ${e.port}, protocol: `+e.protocol)}k.a.debug("Candidate pairs:");for(const e of a.filter(e=>"candidate-pair"===e.type))k.a.debug(`${e.localCandidateId} / ${e.remoteCandidateId} - state: ${e.state}, nominated: ${e.nominated}, requests sent ${e.requestsSent}, requests received  ${e.requestsReceived},  responses received: ${e.responsesReceived}, responses sent: ${e.responsesSent}, bytes received: ${e.bytesReceived}, bytes sent: ${e.bytesSent}, `)}else k.a.debug("Call statistics are undefined. The call has probably failed before a peerConn was established")}setCallState(e,t){const a=G.sharedInstance().roomIdForCall(e);console.log(`Call state in ${a} changed to ${t}`),m.a.dispatch({action:"call_state",room_id:a,state:t})}removeCallForRoom(e){this.calls.delete(e),this.emit(V.CallsChanged,this.calls)}showICEFallbackPrompt(){const e=r.a.get(),t=e=>o.a.createElement("code",null,e);c.a.createTrackedDialog("No TURN servers","",y.a,{title:Object(d.a)("Call failed due to misconfigured server"),description:o.a.createElement("div",null,o.a.createElement("p",null,Object(d.a)("Please ask the administrator of your homeserver (<code>%(homeserverDomain)s</code>) to configure a TURN server in order for calls to work reliably.",{homeserverDomain:e.getDomain()},{code:t})),o.a.createElement("p",null,Object(d.a)("Alternatively, you can try to use the public server at <code>turn.matrix.org</code>, but this will not be as reliable, and it will share your IP address with that server. You can also manage this in Settings.",null,{code:t}))),button:Object(d.a)("Try using turn.matrix.org"),cancelButton:Object(d.a)("OK"),onFinished:t=>{p.b.setValue("fallbackICEServerAllowed",null,v.a.DEVICE,t),e.setFallbackICEServerAllowed(t)}},null,!0)}showMediaCaptureError(e){let t,a;e.type===w.f.Voice?(t=Object(d.a)("Unable to access microphone"),a=o.a.createElement("div",null,Object(d.a)("Call failed because microphone could not be accessed. Check that a microphone is plugged in and set up correctly."))):e.type===w.f.Video&&(t=Object(d.a)("Unable to access webcam / microphone"),a=o.a.createElement("div",null,Object(d.a)("Call failed because webcam or microphone could not be accessed. Check that:"),o.a.createElement("ul",null,o.a.createElement("li",null,Object(d.a)("A microphone and webcam are plugged in and set up correctly")),o.a.createElement("li",null,Object(d.a)("Permission is granted to use the webcam")),o.a.createElement("li",null,Object(d.a)("No other application is using the webcam"))))),c.a.createTrackedDialog("Media capture failed","",E.a,{title:t,description:a},null,!0)}async placeCall(e,t,a){O.a.trackEvent("voip","placeCall","type",t),x.a.instance.trackStartCall(e,t===B.Video,!1);const n=await P.a.sharedInstance().getOrCreateVirtualRoomForRoom(e)||e;k.a.debug("Mapped real room "+e+" to room ID "+n);const s=r.a.get().getTurnServersExpiry()-Date.now();console.log("Current turn creds expire in "+s+" ms");const i=r.a.get().createCall(n);if(this.calls.set(e,i),this.emit(V.CallsChanged,this.calls),a&&(this.transferees[i.callId]=a),this.setCallListeners(i),this.setActiveCallRoomId(e),t===B.Voice)i.placeVoiceCall();else if("video"===t)i.placeVideoCall();else if(t===B.ScreenSharing){const t=l.a.get().screenCaptureErrorString();if(t)return this.removeCallForRoom(e),console.log("Can't capture screen: "+t),void c.a.createTrackedDialog("Call Handler","Unable to capture screen",E.a,{title:Object(d.a)("Unable to capture screen"),description:t});i.placeScreenSharingCall(async()=>{const{finished:e}=c.a.createDialog(I.a),[t]=await e;return t})}else console.error("Unknown conf call type: "+t)}async dialNumber(e){const t=await this.pstnLookup(e);if(!t||0===t.length||!t[0].userid)return void c.a.createTrackedDialog("","",E.a,{title:Object(d.a)("Unable to look up phone number"),description:Object(d.a)("There was an error looking up the phone number")});const a=t[0].userid;let n;if(this.getSupportsVirtualRooms()){const t=await this.sipNativeLookup(a);n=t.length>0&&t[0].fields.lookup_success?t[0].userid:a,console.log("Looked up "+e+" to "+a+" and mapped to native user "+n)}else n=a;const s=await Object(U.e)(r.a.get(),n);m.a.dispatch({action:"view_room",room_id:s})}setActiveCallRoomId(e){k.a.info("Setting call in room "+e+" active");for(const[t,a]of this.calls.entries())a.state!==w.e.Ended&&(t===e?a.setRemoteOnHold(!1):(k.a.info("Holding call in room "+t+" because another call is being set active"),a.setRemoteOnHold(!0)))}hasAnyUnheldCall(){for(const e of this.calls.values())if(e.state!==w.e.Ended&&!e.isRemoteOnHold())return!0;return!1}async startCallApp(t,a){m.a.dispatch({action:"appsDrawer",show:!0});const n=r.a.get().getRoom(t),s=u.a.getRoomWidgetsOfType(n,f.a.JITSI);if(s.length>0||h.a.roomHasPendingWidgetsOfType(t,s,f.a.JITSI))return void c.a.createTrackedDialog("Call already in progress","",E.a,{title:Object(d.a)("Call in Progress"),description:Object(d.a)("A call is currently being placed!")});const i=g.a.getInstance().preferredDomain,o=await g.a.getInstance().getJitsiAuth();let l;if("openidtoken-jwt"===o)l=b.base32.stringify(e.from(t),{pad:!1});else{l="Jitsi"+(Object(D.c)(1)+Object(D.a)(23))}let p=u.a.getLocalJitsiWrapperUrl({auth:o});const v=new URL(p);v.search="",v.searchParams.set("confId",l),p=v.toString();const y={conferenceId:l,isAudioOnly:"voice"===a,domain:i,auth:o,roomName:n.name},_="jitsi_"+r.a.get().credentials.userId+"_"+Date.now();u.a.setRoomWidget(t,_,f.a.JITSI,p,"Jitsi",y).then(()=>{console.log("Jitsi widget added")}).catch(e=>{"M_FORBIDDEN"===e.errcode&&c.a.createTrackedDialog("Call Failed","",E.a,{title:Object(d.a)("Permission Required"),description:Object(d.a)("You do not have permission to start a conference call in this room")}),console.error(e)})}terminateCallApp(e){c.a.createTrackedDialog("Confirm Jitsi Terminate","",y.a,{hasCancelButton:!0,title:Object(d.a)("End conference"),description:Object(d.a)("This will end the conference for everyone. Continue?"),button:Object(d.a)("End conference"),onFinished:t=>{if(!t)return;_.a.instance.getRoom(e).widgets.filter(e=>f.a.JITSI.matches(e.type)).forEach(t=>{u.a.setRoomWidget(e,t.id)})}})}hangupCallApp(e){const t=_.a.instance.getRoom(e);if(!t)return;t.widgets.filter(e=>f.a.JITSI.matches(e.type)).forEach(e=>{const t=S.a.instance.getMessagingForId(e.id);t&&t.transport.send(C.a.HangupCall,{})})}}}).call(this,a(36).Buffer)},161:function(e,t,a){"use strict";function n(e,t){return function(e){const t=Object.keys(e),a=[];for(const n of t){const t=e[n];(Number.isFinite(t)||e[t.toString()]!==Number(n))&&a.push(t)}return a}(e).includes(t)}let s;a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i})),a.d(t,"d",(function(){return o})),a.d(t,"c",(function(){return r})),function(e){e.Invite="im.vector.fake.invite",e.Untagged="im.vector.fake.recent",e.Archived="im.vector.fake.archived",e.LowPriority="m.lowpriority",e.Favourite="m.favourite",e.DM="im.vector.fake.direct",e.ServerNotice="m.server_notice",e.Suggested="im.vector.fake.suggested"}(s||(s={}));const i=[s.Invite,s.Favourite,s.DM,s.Untagged,s.LowPriority,s.ServerNotice,s.Suggested,s.Archived];function o(e){return!n(s,e)}let r;!function(e){e.Timeline="TIMELINE",e.PossibleTagChange="POSSIBLE_TAG_CHANGE",e.ReadReceipt="READ_RECEIPT",e.NewRoom="NEW_ROOM",e.RoomRemoved="ROOM_REMOVED"}(r||(r={}))},165:function(e,t,a){"use strict";var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(569),l=a(100),c=a(99),d=a(97),m=a(106),u=a(93),h=a(745),p=a(115),g=a(211),f=a(154);function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}const b={joining:!1,joinError:null,roomId:null,initialEventId:null,initialEventPixelOffset:null,isInitialEventHighlighted:!1,roomAlias:null,roomLoading:!1,roomLoadError:null,forwardingEvent:null,quotingEvent:null,replyingToEvent:null,shouldPeek:!1,viaServers:[],wasContextSwitch:!1};class y extends r.Store{constructor(){super(l.a),s()(this,"state",b)}setState(e){let t=!1;for(const a of Object.keys(e))if(this.state[a]!==e[a]){t=!0;break}t&&(this.state=Object.assign(this.state,e),this.__emitChange())}__onDispatch(e){switch(e.action){case"view_room":this.viewRoom(e);break;case"view_create_group":case"view_welcome_page":case"view_home_page":case"view_my_groups":case"view_group":this.setState({roomId:null,roomAlias:null,viaServers:[],wasContextSwitch:!1});break;case"view_room_error":this.viewRoomError(e);break;case"will_join":this.setState({joining:!0});break;case"cancel_join":this.setState({joining:!1});break;case p.a.JoinRoom:this.joinRoom(e);break;case p.a.JoinRoomError:this.joinRoomError(e);break;case p.a.JoinRoomReady:this.setState({shouldPeek:!1});break;case"on_client_not_viable":case"on_logged_out":this.reset();break;case"forward_event":this.setState({forwardingEvent:e.event});break;case"reply_to_event":e.event&&(e.event.getRoomId(),this.state.roomId),this.setState({replyingToEvent:e.event});break;case"open_room_settings":{const t=d.getComponent("dialogs.RoomSettingsDialog");m.a.createTrackedDialog("Room settings","",t,{roomId:e.room_id||this.state.roomId},null,!1,!0);break}}}async viewRoom(e){if(e.room_id){const t={roomId:e.room_id,roomAlias:e.room_alias,initialEventId:e.event_id,isInitialEventHighlighted:e.highlighted,forwardingEvent:null,roomLoading:!1,roomLoadError:null,shouldPeek:void 0===e.should_peek||e.should_peek,joining:e.joining||!1,replyingToEvent:null,isEditingSettings:!1,viaServers:e.via_servers,wasContextSwitch:e.context_switch};e.replyingToEvent&&e.replyingToEvent.getRoomId()===e.room_id&&(t.replyingToEvent=e.replyingToEvent),this.state.forwardingEvent,this.setState(t),e.auto_join}else if(e.room_alias){let t=Object(h.a)(e.room_alias);if(!t){this.setState({roomId:null,initialEventId:null,initialEventPixelOffset:null,isInitialEventHighlighted:null,roomAlias:e.room_alias,roomLoading:!0,roomLoadError:null,viaServers:e.via_servers,wasContextSwitch:e.context_switch});try{const a=await c.a.get().getRoomIdForAlias(e.room_alias);Object(h.b)(e.room_alias,a.room_id),t=a.room_id}catch(e){return void console.error("RVS failed to get room id for alias: ",e)}}}}viewRoomError(e){this.setState({roomId:e.room_id,roomAlias:e.room_alias,roomLoading:!1,roomLoadError:e.err})}async joinRoom(e){const t=f.a.getTimestamp();this.setState({joining:!0});const a=c.a.get(),n=this.state.roomAlias||this.state.roomId,i=this.state.viaServers||[];try{await Object(g.b)(()=>a.joinRoom(n,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({viaServers:i},e.opts)),5,e=>504===e.httpStatus),f.a.instance.trackRoomJoin(t,this.state.roomId,e._type),l.a.dispatch({action:p.a.JoinRoomReady,roomId:this.state.roomId})}catch(e){l.a.dispatch({action:p.a.JoinRoomError,roomId:this.state.roomId,err:e})}}getInvitingUserId(e){const t=c.a.get(),a=t.getRoom(e);if(a&&"invite"===a.getMyMembership()){const e=a.getMember(t.getUserId()),n=e?e.events.member:null;return n&&n.getSender()}}joinRoomError(e){this.setState({joining:!1,joinError:e.err});const t=e.err;let a=t.message?t.message:JSON.stringify(t);if(console.log("Failed to join room:",a),"ConnectionError"===t.name)a=Object(u.a)("There was an error joining the room");else if("M_INCOMPATIBLE_ROOM_VERSION"===t.errcode)a=o.a.createElement("div",null,Object(u.a)("Sorry, your homeserver is too old to participate in this room."),o.a.createElement("br",null),Object(u.a)("Please contact your homeserver administrator."));else if(404===t.httpStatus){const e=this.getInvitingUserId(this.state.roomId);e&&(a=e.endsWith(":"+c.a.get().getDomain())?Object(u.a)("The person who invited you already left the room."):Object(u.a)("The person who invited you already left the room, or their server is offline."))}const n=d.getComponent("dialogs.ErrorDialog");m.a.createTrackedDialog("Failed to join room","",n,{title:Object(u.a)("Failed to join room"),description:a})}reset(){this.state=Object.assign({},b)}getRoomId(){return this.state.roomId}getInitialEventId(){return this.state.initialEventId}isInitialEventHighlighted(){return this.state.isInitialEventHighlighted}getRoomAlias(){return this.state.roomAlias}isRoomLoading(){return this.state.roomLoading}getRoomLoadError(){return this.state.roomLoadError}isJoining(){return this.state.joining}getJoinError(){return this.state.joinError}getForwardingEvent(){return this.state.forwardingEvent}getQuotingEvent(){return this.state.replyingToEvent}shouldPeek(){return this.state.shouldPeek}getWasContextSwitch(){return this.state.wasContextSwitch}}let E=null;E||(E=new y),t.a=E},166:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"f",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"c",(function(){return r})),a.d(t,"d",(function(){return l})),a.d(t,"a",(function(){return c}));var n=a(153);function s(e,t){const a=new Map(Object.entries(e));for(const e of t)a.delete(e);return Array.from(a.entries()).reduce((e,t)=>{let[a,n]=t;return e[a]=n,e},{})}function i(e,t){const a=Object.keys(e),i=Object(n.a)(a,t);return 0===i.removed.length?o(e):s(e,i.removed)}function o(e,t){const a={};for(const[n,s]of Object.entries(e))a[n]=s,t&&(a[n]=t(n,s));return a}function r(e,t){if(e===t)return!1;const a=Object.keys(e),s=Object.keys(t);if(a.length!==s.length)return!0;const i=Object(n.k)(a,s);return i.length!==a.length||i.some(a=>e[a]!==t[a])}function l(e,t){const a=function(e,t){const a=Object.keys(e),s=Object.keys(t),i=Object(n.a)(a,s);return{changed:Object(n.k)(a,s).filter(a=>e[a]!==t[a]),added:i.added,removed:i.removed}}(e,t);return Object(n.f)(a.removed,a.added,a.changed)}function c(e){return JSON.parse(JSON.stringify(e))}},167:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(19),l=a.n(r),c=a(88),d=a.n(c),m=a(227),u=a(906),h=a(99),p=a(106),g=a(368),f=a(94),v=a(126);const b=["room","oobData","viewAvatarOnClick","onClick"];var y,E;let _=Object(f.a)("views.avatars.RoomAvatar")((E=class e extends d.a.Component{constructor(t){super(t),l()(this,"onRoomStateEvents",t=>{this.props.room&&t.getRoomId()===this.props.room.roomId&&"m.room.avatar"===t.getType()&&this.setState({urls:e.getImageUrls(this.props)})}),l()(this,"onRoomAvatarClick",()=>{const e={src:g.b(this.props.room,null,null,null),name:this.props.room.name};p.a.createDialog(u.a,e,"mx_Dialog_lightbox",null,!0)}),this.state={urls:e.getImageUrls(this.props)}}componentDidMount(){h.a.get().on("RoomState.events",this.onRoomStateEvents)}componentWillUnmount(){const e=h.a.get();e&&e.removeListener("RoomState.events",this.onRoomStateEvents)}static getDerivedStateFromProps(t){return{urls:e.getImageUrls(t)}}static getImageUrls(t){let a=null;return t.oobData.avatarUrl&&(a=Object(v.b)(t.oobData.avatarUrl).getThumbnailOfSourceHttp(t.width,t.height,t.resizeMethod)),[a,e.getRoomAvatarUrl(t)].filter((function(e){return null!==e&&""!==e}))}static getRoomAvatarUrl(e){return e.room?g.b(e.room,e.width,e.height,e.resizeMethod):null}render(){const e=this.props,{room:t,oobData:a,viewAvatarOnClick:n,onClick:i}=e,r=o()(e,b),l=t?t.name:a.name;return d.a.createElement(m.a,s()({},r,{name:l,idName:t?t.roomId:null,urls:this.state.urls,onClick:n&&this.state.urls[0]?this.onRoomAvatarClick:i}))}},l()(E,"defaultProps",{width:36,height:36,resizeMethod:"crop",oobData:{}}),y=E))||y},168:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(92),o=a.n(i),r=a(93);const l=e=>{let{w:t=32,h:a=32,message:n}=e;return s.a.createElement("div",{className:"mx_Spinner"},n&&s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_Spinner_Msg"},n)," "),s.a.createElement("div",{className:"mx_Spinner_icon",style:{width:t,height:a},"aria-label":Object(r.a)("Loading...")}))};l.propTypes={w:o.a.number,h:o.a.number,message:o.a.node},t.a=l},174:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return C})),a.d(t,"b",(function(){return O}));var n=a(19),s=a.n(n),i=a(103),o=a(161),r=a(324),l=a(100),c=a(1245),d=a(477),m=a(8476),u=a(165),h=a(8472),p=a(295),g=a(1),f=a(637),v=a(2742),b=a(237),y=a(1425),E=a(184),_=a(907),S=a(2743);const C="lists_update";class w extends b.a{constructor(){super(l.a),s()(this,"initialListsGenerated",!1),s()(this,"algorithm",new h.a),s()(this,"filterConditions",[]),s()(this,"prefilterConditions",[]),s()(this,"tagWatcher",void 0),s()(this,"spaceWatcher",void 0),s()(this,"updateFn",new v.a(()=>{for(const e of Object.keys(this.orderedLists))E.a.instance.getListState(e).setRooms(this.orderedLists[e]);this.emit(C)})),s()(this,"watchedSettings",["feature_custom_tags","advancedRoomListLogging"]),s()(this,"onAlgorithmListUpdated",()=>{i.b.getValue("advancedRoomListLogging")&&console.log("Underlying algorithm has triggered a list update - marking"),this.updateFn.mark()}),s()(this,"onAlgorithmFilterUpdated",()=>{this.updateFn.trigger()}),s()(this,"onPrefilterUpdated",async()=>{await this.recalculatePrefiltering(),this.updateFn.trigger()}),this.checkLoggingEnabled();for(const e of this.watchedSettings)i.b.monitorSetting(e,null);u.a.addListener(()=>this.handleRVSUpdate({})),this.algorithm.on(h.b,this.onAlgorithmListUpdated),this.algorithm.on(d.a,this.onAlgorithmFilterUpdated),this.setupWatchers()}setupWatchers(){i.b.getValue("feature_spaces")?this.spaceWatcher=new S.a(this):this.tagWatcher=new m.a(this)}get unfilteredLists(){return this.algorithm?this.algorithm.getUnfilteredRooms():{}}get orderedLists(){return this.algorithm?this.algorithm.getOrderedRooms():{}}async resetStore(){await this.reset(),this.filterConditions=[],this.prefilterConditions=[],this.initialListsGenerated=!1,this.setupWatchers(),this.algorithm.off(h.b,this.onAlgorithmListUpdated),this.algorithm.off(d.a,this.onAlgorithmListUpdated),this.algorithm=new h.a,this.algorithm.on(h.b,this.onAlgorithmListUpdated),this.algorithm.on(d.a,this.onAlgorithmListUpdated),await this.reset(null,!0)}async makeReady(e){e&&this.readyStore.useUnitTestClient(e),this.checkLoggingEnabled(),console.log("Regenerating room lists: Startup"),await this.readAndCacheSettingsFromStore(),await this.regenerateAllLists({trigger:!1}),await this.handleRVSUpdate({trigger:!1}),this.updateFn.mark(),this.updateFn.trigger()}checkLoggingEnabled(){i.b.getValue("advancedRoomListLogging")&&console.warn("Advanced room list logging is enabled")}async readAndCacheSettingsFromStore(){const e=i.b.getValue("feature_custom_tags");await this.updateState({tagsEnabled:e}),await this.updateAlgorithmInstances()}async handleRVSUpdate(e){let{trigger:t=!0}=e;if(!this.matrixClient)return;const a=u.a.getRoomId();if(!a&&this.algorithm.stickyRoom)await this.algorithm.setStickyRoom(null);else if(a){const e=this.matrixClient.getRoom(a);e?e!==this.algorithm.stickyRoom&&(i.b.getValue("advancedRoomListLogging")&&console.log("Changing sticky room to "+a),await this.algorithm.setStickyRoom(e)):(console.warn(a+" is current in RVS but missing from client - clearing sticky room"),await this.algorithm.setStickyRoom(null))}t&&this.updateFn.trigger()}async onReady(){await this.makeReady()}async onNotReady(){await this.resetStore()}async onAction(t){this.matrixClient&&this.initialListsGenerated&&(w.TEST_MODE?await this.onDispatchAsync(t):e(()=>this.onDispatchAsync(t)))}async onDispatchAsync(e){if(this.matrixClient&&this.initialListsGenerated){if("setting_updated"===e.action&&this.watchedSettings.includes(e.settingName)){if("advancedRoomListLogging"===e.settingName){const e=i.b.getValue("advancedRoomListLogging");return void console.warn("Advanced room list logging is enabled? "+e)}console.log("Regenerating room lists: Settings changed"),await this.readAndCacheSettingsFromStore(),await this.regenerateAllLists({trigger:!1}),this.updateFn.trigger()}if(!this.algorithm)throw new Error("Room list store has no algorithm to process dispatcher update with");if("MatrixActions.Room.receipt"===e.action){if(Object(c.a)(e.event,this.matrixClient)){const t=e.room;return t?(i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Got own read receipt in "+t.roomId),await this.handleRoomUpdate(t,o.c.ReadReceipt),void this.updateFn.trigger()):void console.warn("Own read receipt was in unknown room "+t.roomId)}}else if("MatrixActions.Room.tags"===e.action){const t=e;i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Got tag change in "+t.room.roomId),await this.handleRoomUpdate(t.room,o.c.PossibleTagChange),this.updateFn.trigger()}else if("MatrixActions.Room.timeline"===e.action){const t=e;if(!t.isLiveEvent||!e.isLiveUnfilteredRoomTimelineEvent)return;const a=t.event.getRoomId(),n=this.matrixClient.getRoom(a),s=async e=>{if(i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Live timeline event "+t.event.getId()+" in "+e.roomId),"m.room.tombstone"===t.event.getType()&&""===t.event.getStateKey()){i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Got tombstone event - trying to remove now-dead room");if(this.matrixClient.getRoom(t.event.getContent().replacement_room))return}await this.handleRoomUpdate(e,o.c.Timeline),this.updateFn.trigger()};if(!n)return console.warn(`Live timeline event ${t.event.getId()} received without associated room`),console.warn("Queuing failed room update for retry as a result."),void setTimeout(async()=>{const e=this.matrixClient.getRoom(a);await s(e)},100);await s(n)}else if("MatrixActions.Event.decrypted"===e.action){const t=e,a=t.event.getRoomId();if(!a)return;const n=this.matrixClient.getRoom(a);if(!n)return void console.warn(`Event ${t.event.getId()} was decrypted in an unknown room ${a}`);i.b.getValue("advancedRoomListLogging")&&console.log(`[RoomListDebug] Decrypted timeline event ${t.event.getId()} in ${a}`),await this.handleRoomUpdate(n,o.c.Timeline),this.updateFn.trigger()}else if("MatrixActions.accountData"===e.action&&"m.direct"===e.event_type){const t=e;i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Received updated DM map");const a=t.event.getContent();for(const e of Object.keys(a)){const t=a[e];for(const e of t){const t=this.matrixClient.getRoom(e);t?await this.handleRoomUpdate(t,o.c.PossibleTagChange):console.warn(e+" was found in DMs but the room is not in the store")}}this.updateFn.trigger()}else if("MatrixActions.Room.myMembership"===e.action){const t=e,a=Object(p.b)(t.oldMembership),n=Object(p.b)(t.membership);if(a!==p.a.Join&&n===p.a.Join){i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Handling new room "+t.room.roomId);const e=t.room.currentState.getStateEvents("m.room.create","");if(e&&e.getContent().predecessor){i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Room has a predecessor");const t=this.matrixClient.getRoom(e.getContent().predecessor.room_id);if(t){this.algorithm.stickyRoom===t&&(i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Clearing sticky room due to room upgrade"),await this.algorithm.setStickyRoom(null)),i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Removing previous room from room list"),await this.algorithm.handleRoomUpdate(t,o.c.RoomRemoved)}}return i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Adding new room to room list"),await this.handleRoomUpdate(t.room,o.c.NewRoom),void this.updateFn.trigger()}if(a!==p.a.Invite&&n===p.a.Invite)return i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Handling invite to "+t.room.roomId),await this.handleRoomUpdate(t.room,o.c.NewRoom),void this.updateFn.trigger();if(a!==n)return i.b.getValue("advancedRoomListLogging")&&console.log("[RoomListDebug] Handling membership change in "+t.room.roomId),await this.handleRoomUpdate(t.room,o.c.PossibleTagChange),void this.updateFn.trigger()}}}async handleRoomUpdate(e,t){if(t===o.c.NewRoom&&"invite"===e.getMyMembership()&&await _.a.instance.onNewInvitedRoom(e),!_.a.instance.isRoomVisible(e))return;if((t===o.c.NewRoom||t===o.c.PossibleTagChange)&&!this.prefilterConditions.every(t=>t.isVisible(e)))return;await this.algorithm.handleRoomUpdate(e,t)&&(i.b.getValue("advancedRoomListLogging")&&console.log(`[DEBUG] Room "${e.name}" (${e.roomId}) triggered by ${t} requires list update`),this.updateFn.mark())}async recalculatePrefiltering(){if(!this.algorithm)return;if(!this.algorithm.hasTagSortingMap)return;i.b.getValue("advancedRoomListLogging")&&console.log("Calculating new prefiltered room list"),this.algorithm.updatesInhibited=!0;const e=this.getPlausibleRooms(),t=this.algorithm.stickyRoom,a=t&&e.includes(t);await this.algorithm.setStickyRoom(null),await this.algorithm.setKnownRooms(e),a&&await this.algorithm.setStickyRoom(t),this.updateFn.mark(),this.algorithm.updatesInhibited=!1}async setTagSorting(e,t){await this.setAndPersistTagSorting(e,t),this.updateFn.trigger()}async setAndPersistTagSorting(e,t){await this.algorithm.setTagSorting(e,t),localStorage.setItem("mx_tagSort_"+e,t)}getTagSorting(e){return this.algorithm.getTagSorting(e)}getStoredTagSorting(e){return localStorage.getItem("mx_tagSort_"+e)}calculateTagSorting(e){const t=e===o.a.Invite||e===o.a.DM?r.b.Recent:r.b.Alphabetic,a=i.b.getValue("RoomList.orderAlphabetically",null,!0),n=this.getTagSorting(e),s=this.getStoredTagSorting(e);let l=t;return s?l=s:Object(g.o)(a)?n&&(l=n):l=a?r.b.Alphabetic:r.b.Recent,l}async setListOrder(e,t){await this.setAndPersistListOrder(e,t),this.updateFn.trigger()}async setAndPersistListOrder(e,t){await this.algorithm.setListOrdering(e,t),localStorage.setItem("mx_listOrder_"+e,t)}getListOrder(e){return this.algorithm.getListOrdering(e)}getStoredListOrder(e){return localStorage.getItem("mx_listOrder_"+e)}calculateListOrder(e){const t=r.a.Natural,a=i.b.getValue("RoomList.orderByImportance",null,!0),n=this.getListOrder(e),s=this.getStoredListOrder(e);let o=t;return s?o=s:Object(g.o)(a)?n&&(o=n):o=a?r.a.Importance:r.a.Natural,o}async updateAlgorithmInstances(){this.updateFn.mark();for(const e of Object.keys(this.orderedLists)){const t=this.getTagSorting(e),a=this.getListOrder(e),n=this.calculateTagSorting(e),s=this.calculateListOrder(e);n!==t&&await this.setAndPersistTagSorting(e,n),s!==a&&await this.setAndPersistListOrder(e,s)}}getPlausibleRooms(){if(!this.matrixClient)return[];let e=this.matrixClient.getVisibleRooms().filter(e=>_.a.instance.isRoomVisible(e));return!(this.prefilterConditions.length>0)||i.b.getValue("feature_spaces")&&this.filterConditions.length||(e=e.filter(e=>{for(const t of this.prefilterConditions)if(!t.isVisible(e))return!1;return!0})),e}async regenerateAllLists(e){let{trigger:t=!0}=e;console.warn("Regenerating all room lists");const a=this.getPlausibleRooms(),n=new Set;if(this.state.tagsEnabled)for(const e of a){if(!e.tags)continue;Object.keys(e.tags).filter(e=>Object(o.d)(e)).forEach(e=>n.add(e))}const s={},i={},r=[...o.b,...Array.from(n)];for(const e of r)s[e]=this.calculateTagSorting(e),i[e]=this.calculateListOrder(e),f.a.instance.ensureLayoutExists(e);await this.algorithm.populateTags(s,i),await this.algorithm.setKnownRooms(a),this.initialListsGenerated=!0,t&&this.updateFn.trigger()}async addFilter(e){i.b.getValue("advancedRoomListLogging")&&console.log("Adding filter condition:",e);let t=Promise.resolve();e.kind===d.b.Prefilter?(e.on(d.a,this.onPrefilterUpdated),this.prefilterConditions.push(e),t=this.recalculatePrefiltering()):(this.filterConditions.push(e),i.b.getValue("feature_spaces")&&await this.recalculatePrefiltering(),this.algorithm&&this.algorithm.addFilterCondition(e)),t.then(()=>this.updateFn.trigger())}removeFilter(e){i.b.getValue("advancedRoomListLogging")&&console.log("Removing filter condition:",e);let t=Promise.resolve(),a=this.filterConditions.indexOf(e);a>=0&&(this.filterConditions.splice(a,1),this.algorithm&&this.algorithm.removeFilterCondition(e),i.b.getValue("feature_spaces")&&(t=this.recalculatePrefiltering())),a=this.prefilterConditions.indexOf(e),a>=0&&(e.off(d.a,this.onPrefilterUpdated),this.prefilterConditions.splice(a,1),t=this.recalculatePrefiltering()),t.then(()=>this.updateFn.trigger())}getFirstNameFilterCondition(){for(const e of this.filterConditions)if(e instanceof y.a)return e;return null}getTagsForRoom(e){const t=this.algorithm.getTagsForRoom(e);return t||[o.a.Untagged]}async manualRoomUpdate(e,t){await this.handleRoomUpdate(e,t),this.updateFn.trigger()}}s()(w,"TEST_MODE",!1);class O{static get instance(){return O.internalInstance||(O.internalInstance=new w),O.internalInstance}}s()(O,"internalInstance",void 0),window.mxRoomListStore=O.instance}).call(this,a(212).setImmediate)},175:function(e,t,a){"use strict";a.d(t,"a",(function(){return C})),a.d(t,"d",(function(){return w})),a.d(t,"b",(function(){return O})),a.d(t,"c",(function(){return x})),a.d(t,"f",(function(){return I})),a.d(t,"e",(function(){return N}));var n=a(19),s=a.n(n),i=a(150),o=a(140),r=a(237),l=a(100),c=a(174),d=a(103),m=a(185),u=a(333),h=a(153),p=a(367);class g extends p.b{constructor(e,t){super(),this.spaceId=e,this.getRoomFn=t,s()(this,"rooms",[]),s()(this,"states",{}),s()(this,"onRoomNotificationStateUpdate",()=>{this.calculateTotalState()})}get symbol(){return null}setRooms(e){const t=this.rooms,a=Object(h.a)(t,e);this.rooms=e;for(const e of a.removed){const t=this.states[e.roomId];t&&(delete this.states[e.roomId],t.off(p.a,this.onRoomNotificationStateUpdate))}for(const e of a.added){const t=this.getRoomFn(e);t.on(p.a,this.onRoomNotificationStateUpdate),this.states[e.roomId]=t}this.calculateTotalState()}destroy(){super.destroy();for(const e of Object.values(this.states))e.off(p.a,this.onRoomNotificationStateUpdate);this.states={}}calculateTotalState(){const e=this.snapshot();this._count=0,this._color=u.a.None;for(const e of Object.values(this.states))this._count+=e.count,this._color=Math.max(this.color,e.color);this.emitIfUpdated(e)}}var f=a(184),v=a(161),b=a(591),y=a(744),E=a(165);function _(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function S(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const C=Symbol("suggested-rooms"),w=Symbol("top-level-spaces"),O=Symbol("invited-spaces"),x=Symbol("selected-space"),R=e=>"mx_space_context_"+((null==e?void 0:e.roomId)||"ALL_ROOMS"),k=e=>e.reduce((e,t)=>(e[t.isSpaceRoom()?0:1].push(t),e),[[],[]]),I=(e,t,a)=>{let n=null;return"string"==typeof e&&Array.from(e).every(e=>{const t=e.charCodeAt(0);return t>=32&&t<=126})&&(n=e),[n,t,a]},T=e=>f.a.instance.getRoomState(e);class P extends r.a{constructor(){var e;super(l.a,{}),e=this,s()(this,"rootSpaces",[]),s()(this,"parentMap",new b.a),s()(this,"notificationStateMap",new Map),s()(this,"spaceFilteredRooms",new Map),s()(this,"_activeSpace",null),s()(this,"_suggestedRooms",[]),s()(this,"_invitedSpaces",new Set),s()(this,"fetchSuggestedRooms",(async function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{const n=await e.matrixClient.getSpaceSummary(t.roomId,0,!0,!1,a),s=new b.a;return n.events.forEach(e=>{var t;e.type===o.a.SpaceChild&&null!==(t=e.content.via)&&void 0!==t&&t.length&&e.content.via.forEach(t=>{s.getOrCreate(e.state_key,new Set).add(t)})}),n.rooms.filter(t=>{var a;return t.room_type!==o.d.Space&&"join"!==(null===(a=e.matrixClient.getRoom(t.room_id))||void 0===a?void 0:a.getMyMembership())}).map(e=>S(S({},e),{},{viaServers:Array.from(s.get(e.room_id)||[])}))}catch(e){console.error(e)}return[]})),s()(this,"getSpaceFilteredRoomIds",e=>e?this.spaceFilteredRooms.get(e.roomId)||new Set:new Set(this.matrixClient.getVisibleRooms().map(e=>e.roomId))),s()(this,"rebuild",Object(i.throttle)(()=>{const[e,t]=k(this.matrixClient.getVisibleRooms()),[a,n]=e.reduce((e,t)=>("join"===t.getMyMembership()?e[0].push(t):"invite"===t.getMyMembership()&&e[1].push(t),e),[[],[]]),s=new Set([...t,...a]),o=new b.a,r=Object(i.sortBy)(a,e=>e.roomId);r.forEach(e=>{this.getChildren(e.roomId).forEach(t=>{s.delete(t),o.getOrCreate(t.roomId,new Set).add(e.roomId)})});const[l]=k(Array.from(s)),c=new Set(r),d=(e,t)=>{const a=[e];for(;a.length;){const e=a.pop();t.delete(e),this.getChildSpaces(e.roomId).forEach(e=>{t.has(e)&&a.push(e)})}};l.forEach(e=>{d(e,c)}),Array.from(c).forEach(e=>{c.has(e)&&(c.delete(e),l.push(e),d(e,c))}),this.rootSpaces=l,this.parentMap=o,this._activeSpace&&c.has(this._activeSpace)&&this.setActiveSpace(null,!1),this.onRoomsUpdate(),this.emit(w,this.spacePanelSpaces),this._invitedSpaces=new Set(n),this.emit(O,this.invitedSpaces)},100,{trailing:!0,leading:!0})),s()(this,"onSpaceUpdate",()=>{this.rebuild()}),s()(this,"onSpaceMembersChange",e=>{m.a.shared().getDMRoomsForUserId(e.getStateKey()).length<1||this.onRoomsUpdate()}),s()(this,"onRoomsUpdate",Object(i.throttle)(()=>{const e=this.matrixClient.getVisibleRooms(),t=this.spaceFilteredRooms;this.spaceFilteredRooms=new Map,this.rootSpaces.forEach(e=>{const t=(e,a)=>{var n;if(a.has(e))return;if(this.spaceFilteredRooms.has(e))return this.spaceFilteredRooms.get(e);const[s,i]=k(this.getChildren(e)),o=new Set(i.map(e=>e.roomId)),r=null===(n=this.matrixClient)||void 0===n?void 0:n.getRoom(e);null==r||r.getMembers().forEach(e=>{"join"!==e.membership&&"invite"!==e.membership||m.a.shared().getDMRoomsForUserId(e.userId).forEach(e=>{o.add(e)})});const l=new Set(a).add(e);return s.forEach(e=>{var a;null===(a=t(e.roomId,l))||void 0===a||a.forEach(e=>{o.add(e)})}),this.spaceFilteredRooms.set(e,o),o};t(e.roomId,new Set)});const a=Object(b.b)(t,this.spaceFilteredRooms),n=a.changed.filter(e=>Object(y.a)(t.get(e),this.spaceFilteredRooms.get(e)));[...a.added,...a.removed,...n].forEach(e=>{this.emit(e)}),this.spaceFilteredRooms.forEach((t,a)=>{var n;null===(n=this.getNotificationState(a))||void 0===n||n.setRooms(e.filter(e=>!!t.has(e.roomId)&&(!m.a.shared().getUserIdForRoomId(e.roomId)||c.b.instance.getTagsForRoom(e).includes(v.a.Favourite))))})},100,{trailing:!0,leading:!0})),s()(this,"switchToRelatedSpace",e=>{if(this.suggestedRooms.find(t=>t.room_id===e))return;let t=this.getCanonicalParent(e);if(t||(t=this.rootSpaces.find(t=>{var a;return null===(a=this.spaceFilteredRooms.get(t.roomId))||void 0===a?void 0:a.has(e)})),!t){t=Array.from(this.parentMap.get(e)||[]).find(e=>this.matrixClient.getRoom(e))}this.setActiveSpace(t||null,!1)}),s()(this,"onRoom",(e,t,a)=>{const n=t||e.getMyMembership();if(e.isSpaceRoom())"invite"===n?(this._invitedSpaces.add(e),this.emit(O,this.invitedSpaces)):"invite"===a&&"join"!==n?(this._invitedSpaces.delete(e),this.emit(O,this.invitedSpaces)):(this.onSpaceUpdate(),this.emit(e.roomId)),"join"===n&&e.roomId===E.a.getRoomId()&&this.setActiveSpace(e,!1);else if(this.onRoomsUpdate(),"join"===n){const a=this._suggestedRooms.length;this._suggestedRooms=this._suggestedRooms.filter(t=>t.room_id!==e.roomId),a!==this._suggestedRooms.length&&this.emit(C,this._suggestedRooms),"join"===t&&e.roomId===E.a.getRoomId()&&this.switchToRelatedSpace(e.roomId)}}),s()(this,"onRoomState",e=>{const t=this.matrixClient.getRoom(e.getRoomId());if(t)switch(e.getType()){case o.a.SpaceChild:t.isSpaceRoom()&&(this.onSpaceUpdate(),this.emit(t.roomId));break;case o.a.SpaceParent:t.isSpaceRoom()&&this.onSpaceUpdate(),this.emit(t.roomId);break;case o.a.RoomMember:t.isSpaceRoom()&&this.onSpaceMembersChange(e)}})}get invitedSpaces(){return Array.from(this._invitedSpaces)}get spacePanelSpaces(){return this.rootSpaces}get activeSpace(){return this._activeSpace||null}get suggestedRooms(){return this._suggestedRooms}async setActiveSpace(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e!==this.activeSpace&&(!e||null!=e&&e.isSpaceRoom())){if(this._activeSpace=e,this.emit(x,this.activeSpace),this.emit(C,this._suggestedRooms=[]),t){var a,n;const t=window.localStorage.getItem(R(this.activeSpace));"invite"!==(null==e?void 0:e.getMyMembership)&&"join"===(null===(a=this.matrixClient)||void 0===a||null===(n=a.getRoom(t))||void 0===n?void 0:n.getMyMembership())?l.a.dispatch({action:"view_room",room_id:t,context_switch:!0}):e?l.a.dispatch({action:"view_room",room_id:e.roomId,context_switch:!0}):l.a.dispatch({action:"view_home_page"})}if(e?window.localStorage.setItem("mx_active_space",e.roomId):window.localStorage.removeItem("mx_active_space"),e){const t=await this.fetchSuggestedRooms(e);this._activeSpace===e&&(this._suggestedRooms=t,this.emit(C,this._suggestedRooms))}}}addRoomToSpace(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.matrixClient.sendStateEvent(e.roomId,o.a.SpaceChild,{via:a,suggested:n,auto_join:s},t)}getChildren(e){var t;const a=null===(t=this.matrixClient)||void 0===t?void 0:t.getRoom(e),n=null==a?void 0:a.currentState.getStateEvents(o.a.SpaceChild).filter(e=>{var t;return null===(t=e.getContent())||void 0===t?void 0:t.via});return Object(i.sortBy)(n,e=>{var t,a;const n=e.getStateKey(),s=null===(t=this.matrixClient)||void 0===t?void 0:t.getRoom(n),i=null==s||null===(a=s.currentState.getStateEvents(o.a.RoomCreate,""))||void 0===a?void 0:a.getTs();return I(e.getContent().order,i,n)}).map(e=>this.matrixClient.getRoom(e.getStateKey())).filter(e=>"join"===(null==e?void 0:e.getMyMembership())||"invite"===(null==e?void 0:e.getMyMembership()))||[]}getChildRooms(e){return this.getChildren(e).filter(e=>!e.isSpaceRoom())}getChildSpaces(e){return this.getChildren(e).filter(e=>e.isSpaceRoom()&&"join"===e.getMyMembership())}getParents(e){var t;let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=null===(t=this.matrixClient)||void 0===t?void 0:t.getRoom(e);return(null==n?void 0:n.currentState.getStateEvents(o.a.SpaceParent).filter(e=>{var t;const n=e.getContent();return!(null==n||null===(t=n.via)||void 0===t||!t.length)&&!(a&&(null==n||!n.canonical))}).map(e=>this.matrixClient.getRoom(e.getStateKey())).filter(Boolean))||[]}getCanonicalParent(e){var t;const a=this.getParents(e,!0);return(null===(t=Object(i.sortBy)(a,e=>e.roomId))||void 0===t?void 0:t[0])||null}async reset(){this.rootSpaces=[],this.parentMap=new b.a,this.notificationStateMap=new Map,this.spaceFilteredRooms=new Map,this._activeSpace=null,this._suggestedRooms=[],this._invitedSpaces=new Set}async onNotReady(){d.b.getValue("feature_spaces")&&(this.matrixClient&&(this.matrixClient.removeListener("Room",this.onRoom),this.matrixClient.removeListener("Room.myMembership",this.onRoom),this.matrixClient.removeListener("RoomState.events",this.onRoomState)),await this.reset())}async onReady(){if(!d.b.getValue("feature_spaces"))return;this.matrixClient.on("Room",this.onRoom),this.matrixClient.on("Room.myMembership",this.onRoom),this.matrixClient.on("RoomState.events",this.onRoomState),await this.onSpaceUpdate();const e=window.localStorage.getItem("mx_active_space");e&&this.setActiveSpace(this.matrixClient.getRoom(e))}async onAction(e){if(d.b.getValue("feature_spaces"))switch(e.action){case"view_room":{var t;if(e.context_switch)break;const a=e.room_id,n=null===(t=this.matrixClient)||void 0===t?void 0:t.getRoom(a);null!=n&&n.isSpaceRoom()?this.setActiveSpace(n,!1):this.activeSpace&&!this.getSpaceFilteredRoomIds(this.activeSpace).has(a)&&this.switchToRelatedSpace(a),window.localStorage.setItem(R(this.activeSpace),e.room_id);break}case"after_leave_room":this._activeSpace&&e.room_id===this._activeSpace.roomId&&this.setActiveSpace(null,!1)}}getNotificationState(e){if(this.notificationStateMap.has(e))return this.notificationStateMap.get(e);const t=new g(e,T);return this.notificationStateMap.set(e,t),t}traverseSpace(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;if(n&&n.has(e))return;t(e);const s=new Set(n).add(e),[i,o]=k(this.getChildren(e));a&&o.forEach(e=>t(e.roomId)),i.forEach(e=>this.traverseSpace(e.roomId,t,a,s))}}class N{static get instance(){return N.internalInstance}}s()(N,"internalInstance",new P),window.mxSpaceStore=N.instance},181:function(e,t,a){"use strict";var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(93),l=a(156),c=a(110),d=a(106),m=a(97);function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const p=/#\/(groups?|room|user|settings|register|login|forgot_password|home|directory)/,g=/#\/(group|room|user)\/.*$/;function f(){const{origin:e,hash:t}=window.location;let{pathname:a}=window.location;return e.startsWith("file://")&&(a="/<redacted>/"),e+a+function(e){return p.exec(e)?g.test(e)?e.replace(g,"#/$1/<redacted>"):e.replace(p,"#/$1"):(console.warn(`Unexpected hash location "${e}"`),"#/<unexpected hash location>")}(t)}const v={"App Platform":{id:1,expl:Object(r.b)("The platform you're on"),example:"Electron Platform"},"App Version":{id:2,expl:Object(r.b)("The version of %(brand)s"),getTextVariables:()=>({brand:c.a.get().brand}),example:"15.0.0"},"User Type":{id:3,expl:Object(r.b)("Whether or not you're logged in (we don't record your username)"),example:"Logged In"},"Chosen Language":{id:4,expl:Object(r.b)("Your language of choice"),example:"en"},Instance:{id:5,expl:Object(r.b)("Which officially provided instance you are using, if any"),example:"app"},"RTE: Uses Richtext Mode":{id:6,expl:Object(r.b)("Whether or not you're using the Richtext mode of the Rich Text Editor"),example:"off"},"Homeserver URL":{id:7,expl:Object(r.b)("Your homeserver's URL"),example:"https://matrix.org"},"Touch Input":{id:8,expl:Object(r.b)("Whether you're using %(brand)s on a device where touch is the primary input mechanism"),getTextVariables:()=>({brand:c.a.get().brand}),example:"false"},Breadcrumbs:{id:9,expl:Object(r.b)("Whether or not you're using the 'breadcrumbs' feature (avatars above the room list)"),example:"disabled"},"Installed PWA":{id:10,expl:Object(r.b)("Whether you're using %(brand)s as an installed Progressive Web App"),getTextVariables:()=>({brand:c.a.get().brand}),example:"false"}};const b="mx_Riot_Analytics_uid";class y{constructor(){s()(this,"baseUrl",null),s()(this,"siteId",null),s()(this,"visitVariables",{}),s()(this,"firstPage",!0),s()(this,"heartbeatIntervalID",null),s()(this,"creationTs",void 0),s()(this,"lastVisitTs",void 0),s()(this,"visitCount",void 0),s()(this,"showDetailsModal",()=>{let e=[];e=this.disabled?Object.keys(v).map(e=>[e,Object(r.a)("e.g. %(exampleValue)s",{exampleValue:v[e].example})]):Object.values(this.visitVariables);const t=`${window.screen.width}x${window.screen.height}`,a=[{expl:Object(r.b)("Every page you use in the app"),value:Object(r.a)("e.g. <CurrentPageURL>",{},{CurrentPageURL:f})},{expl:Object(r.b)("Your user agent"),value:navigator.userAgent},{expl:Object(r.b)("Your device resolution"),value:t}],n=m.getComponent("dialogs.ErrorDialog");d.a.createTrackedDialog("Analytics Details","",n,{title:Object(r.a)("Analytics"),description:o.a.createElement("div",{className:"mx_AnalyticsModal"},o.a.createElement("div",null,Object(r.a)("The information being sent to us to help make %(brand)s better includes:",{brand:c.a.get().brand})),o.a.createElement("table",null,e.map(e=>o.a.createElement("tr",{key:e[0]},o.a.createElement("td",null,Object(r.a)(v[e[0]].expl,v[e[0]].getTextVariables?v[e[0]].getTextVariables():null)),void 0!==e[1]&&o.a.createElement("td",null,o.a.createElement("code",null,e[1])))),a.map((e,t)=>o.a.createElement("tr",{key:t},o.a.createElement("td",null,Object(r.a)(e.expl)),o.a.createElement("td",null,o.a.createElement("code",null,e.value))))),o.a.createElement("div",null,Object(r.a)("Where this page includes identifiable information, such as a room, user or group ID, that data is removed before being sent to the server.")))})}),this.creationTs=localStorage&&localStorage.getItem("mx_Riot_Analytics_cts"),!this.creationTs&&localStorage&&localStorage.setItem("mx_Riot_Analytics_cts",this.creationTs=String((new Date).getTime())),this.lastVisitTs=localStorage&&localStorage.getItem("mx_Riot_Analytics_lvts"),this.visitCount=localStorage&&localStorage.getItem("mx_Riot_Analytics_vc")||"0",this.visitCount=String(parseInt(this.visitCount,10)+1),localStorage&&localStorage.setItem("mx_Riot_Analytics_vc",this.visitCount)}get disabled(){return!this.baseUrl}canEnable(){const e=c.a.get();return"1"!==navigator.doNotTrack&&e&&e.piwik&&e.piwik.url&&e.piwik.siteId}async enable(){if(!this.disabled)return;if(!this.canEnable())return;const e=c.a.get();this.baseUrl=new URL("piwik.php",e.piwik.url),this.baseUrl.searchParams.set("rec","1"),this.baseUrl.searchParams.set("idsite",e.piwik.siteId),this.baseUrl.searchParams.set("apiv","1"),this.baseUrl.searchParams.set("send_image","0"),this.baseUrl.searchParams.set("_id",function(){try{let e=localStorage&&localStorage.getItem(b);return!e&&localStorage&&localStorage.setItem(b,e=[...Array(16)].map(()=>Math.random().toString(16)[2]).join("")),e}catch(e){return console.error("Analytics error: ",e),""}}()),this.baseUrl.searchParams.set("_idts",this.creationTs),this.baseUrl.searchParams.set("_idvc",this.visitCount),this.lastVisitTs&&this.baseUrl.searchParams.set("_viewts",this.lastVisitTs);const t=l.a.get();this.setVisitVariable("App Platform",t.getHumanReadableName());try{this.setVisitVariable("App Version",await t.getAppVersion())}catch(e){this.setVisitVariable("App Version","unknown")}this.setVisitVariable("Chosen Language",Object(r.d)());const a=window.location.hostname;"riot.im"===a?this.setVisitVariable("Instance",window.location.pathname):a.endsWith(".element.io")&&this.setVisitVariable("Instance",a.replace(".element.io",""));let n="unknown";try{n=String(window.matchMedia("(display-mode: standalone)").matches)}catch(e){}this.setVisitVariable("Installed PWA",n);let s="unknown";try{s=String(window.matchMedia("(pointer: coarse)").matches)}catch(e){}this.setVisitVariable("Touch Input",s),this.heartbeatIntervalID=window.setInterval(this.ping.bind(this),3e4)}disable(){this.disabled||(this.trackEvent("Analytics","opt-out"),window.clearInterval(this.heartbeatIntervalID),this.baseUrl=null,this.visitVariables={},localStorage.removeItem(b),localStorage.removeItem("mx_Riot_Analytics_cts"),localStorage.removeItem("mx_Riot_Analytics_vc"),localStorage.removeItem("mx_Riot_Analytics_lvts"))}async _track(e){if(this.disabled)return;const t=new Date,a=h(h({},e),{},{url:f(),_cvar:JSON.stringify(this.visitVariables),res:`${window.screen.width}x${window.screen.height}`,rand:String(Math.random()).slice(2,8),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds()}),n=new URL(this.baseUrl.toString());for(const e in a)n.searchParams.set(e,a[e]);try{await window.fetch(n.toString(),{method:"GET",mode:"no-cors",cache:"no-cache",redirect:"follow"})}catch(e){console.error("Analytics error: ",e)}}ping(){this._track({ping:"1"}),localStorage.setItem("mx_Riot_Analytics_lvts",String((new Date).getTime()))}trackPageChange(e){this.disabled||(this.firstPage?this.firstPage=!1:("number"!=typeof e&&console.warn("Analytics.trackPageChange: expected generationTimeMs to be a number"),this._track({gt_ms:String(e)})))}trackEvent(e,t,a,n){this.disabled||this._track({e_c:e,e_a:t,e_n:a,e_v:n})}setVisitVariable(e,t){this.disabled||(this.visitVariables[v[e].id]=[e,t])}setLoggedIn(e,t){if(this.disabled)return;const a=c.a.get();if(!a.piwik)return;const n=a.piwik.whitelistedHSUrls||[];var s;this.setVisitVariable("User Type",e?"Guest":"Logged In"),this.setVisitVariable("Homeserver URL",(s=t,n.includes(s)?s:"<redacted>"))}setBreadcrumbs(e){this.disabled||this.setVisitVariable("Breadcrumbs",e?"enabled":"disabled")}}window.mxAnalytics||(window.mxAnalytics=new y),t.a=window.mxAnalytics},182:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(789),d=a.n(c),m=a(92),u=a.n(m),h=a(102),p=a.n(h),g=a(131),f=a(108),v=a(99),b=a(93),y=a(119),E=a(94);let _=Object(E.a)("views.dialogs.BaseDialog")((s=class extends l.a.Component{constructor(e){super(e),o()(this,"_onKeyDown",e=>{this.props.onKeyDown&&this.props.onKeyDown(e),this.props.hasCancel&&e.key===g.a.ESCAPE&&(e.stopPropagation(),e.preventDefault(),this.props.onFinished(!1))}),o()(this,"_onCancelClick",e=>{this.props.onFinished(!1)}),this._matrixClient=v.a.get()}render(){let e,t;return this.props.hasCancel&&(e=l.a.createElement(f.a,{onClick:this._onCancelClick,className:"mx_Dialog_cancelButton","aria-label":Object(b.a)("Close dialog")})),this.props.headerImage&&(t=l.a.createElement("img",{className:"mx_Dialog_titleImage",src:this.props.headerImage,alt:""})),l.a.createElement(y.a.Provider,{value:this._matrixClient},l.a.createElement(d.a,{returnFocus:!0,lockProps:{onKeyDown:this._onKeyDown,role:"dialog","aria-labelledby":"mx_BaseDialog_title","aria-describedby":this.props.contentId},className:p()({[this.props.className]:!0,mx_Dialog_fixedWidth:this.props.fixedWidth})},l.a.createElement("div",{className:p()("mx_Dialog_header",{mx_Dialog_headerWithButton:!!this.props.headerButton,mx_Dialog_headerWithCancel:!!e})},l.a.createElement("div",{className:p()("mx_Dialog_title",this.props.titleClass),id:"mx_BaseDialog_title"},t,this.props.title),this.props.headerButton,e),this.props.children))}},o()(s,"propTypes",{onFinished:u.a.func.isRequired,hasCancel:u.a.bool,onKeyDown:u.a.func,className:u.a.string,fixedWidth:u.a.bool,title:u.a.node.isRequired,headerImage:u.a.string,children:u.a.node,contentId:u.a.string,titleClass:u.a.oneOfType([u.a.string,u.a.object,u.a.arrayOf(u.a.string)])}),o()(s,"defaultProps",{hasCancel:!0,fixedWidth:!0}),n=s))||n},183:function(e,t,a){"use strict";let n;a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i})),function(e){e.RoomMemberList="RoomMemberList",e.FilePanel="FilePanel",e.NotificationPanel="NotificationPanel",e.RoomMemberInfo="RoomMemberInfo",e.EncryptionPanel="EncryptionPanel",e.RoomSummary="RoomSummary",e.Widget="Widget",e.PinnedMessages="PinnedMessages",e.Room3pidMemberInfo="Room3pidMemberInfo",e.GroupMemberList="GroupMemberList",e.GroupRoomList="GroupRoomList",e.GroupRoomInfo="GroupRoomInfo",e.GroupMemberInfo="GroupMemberInfo",e.SpaceMemberList="SpaceMemberList",e.SpaceMemberInfo="SpaceMemberInfo",e.Space3pidMemberInfo="Space3pidMemberInfo"}(n||(n={}));const s=[n.RoomSummary,n.NotificationPanel,n.PinnedMessages,n.FilePanel,n.RoomMemberList,n.GroupMemberList,n.GroupRoomList],i=[n.SpaceMemberList,n.Space3pidMemberInfo,n.SpaceMemberInfo]},184:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n=a(19),s=a.n(n),i=a(237),o=a(100),r=a(161),l=a(333),c=a(153),d=a(367);class m extends d.b{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;super(),this.byTileCount=e,this.tagId=t,this.getRoomFn=a,s()(this,"rooms",[]),s()(this,"states",{}),s()(this,"onRoomNotificationStateUpdate",()=>{this.calculateTotalState()})}get symbol(){return null}setRooms(e){if(this.byTileCount)return this.rooms=e,void this.calculateTotalState();const t=this.rooms,a=Object(c.a)(t,e);this.rooms=e;for(const e of a.removed){const t=this.states[e.roomId];t&&(delete this.states[e.roomId],t.off(d.a,this.onRoomNotificationStateUpdate))}for(const e of a.added){const t=this.getRoomFn(e);t.on(d.a,this.onRoomNotificationStateUpdate),this.states[e.roomId]=t}this.calculateTotalState()}getForRoom(e){const t=this.states[e.roomId];if(!t)throw new Error("Unknown room for notification state");return t}destroy(){super.destroy();for(const e of Object.values(this.states))e.off(d.a,this.onRoomNotificationStateUpdate);this.states={}}calculateTotalState(){const e=this.snapshot();if(this.byTileCount)this._color=l.a.Red,this._count=this.rooms.length;else{this._count=0,this._color=l.a.None;for(const e of Object.values(this.states))this._count+=e.count,this._color=Math.max(this.color,e.color)}this.emitIfUpdated(e)}}var u=a(99),h=a(295),p=a(1245),g=a(571),f=a(1247);class v extends d.b{constructor(e){super(),this.room=e,s()(this,"handleReadReceipt",(e,t)=>{Object(p.a)(e,u.a.get())&&t.roomId===this.room.roomId&&this.updateNotificationState()}),s()(this,"handleMembershipUpdate",()=>{this.updateNotificationState()}),s()(this,"handleRoomEventUpdate",e=>{e.getRoomId()===this.room.roomId&&this.updateNotificationState()}),s()(this,"handleAccountDataUpdate",e=>{"m.push_rules"===e.getType()&&this.updateNotificationState()}),this.room.on("Room.receipt",this.handleReadReceipt),this.room.on("Room.timeline",this.handleRoomEventUpdate),this.room.on("Room.redaction",this.handleRoomEventUpdate),this.room.on("Room.myMembership",this.handleMembershipUpdate),u.a.get().on("Event.decrypted",this.handleRoomEventUpdate),u.a.get().on("accountData",this.handleAccountDataUpdate),this.updateNotificationState()}get roomIsInvite(){return Object(h.b)(this.room.getMyMembership())===h.a.Invite}destroy(){super.destroy(),this.room.removeListener("Room.receipt",this.handleReadReceipt),this.room.removeListener("Room.timeline",this.handleRoomEventUpdate),this.room.removeListener("Room.redaction",this.handleRoomEventUpdate),this.room.removeListener("Room.myMembership",this.handleMembershipUpdate),u.a.get()&&(u.a.get().removeListener("Event.decrypted",this.handleRoomEventUpdate),u.a.get().removeListener("accountData",this.handleAccountDataUpdate))}updateNotificationState(){const e=this.snapshot();if(g.f(this.room.roomId)===g.d)this._color=l.a.None,this._symbol=null,this._count=0;else if(this.roomIsInvite)this._color=l.a.Red,this._symbol="!",this._count=1;else{const e=g.g(this.room,"highlight"),t=g.g(this.room,"total"),a=t||(e||0);if(e>0)this._color=l.a.Red,this._count=a,this._symbol=null;else if(t>0)this._color=l.a.Grey,this._count=a,this._symbol=null;else{const e=f.a(this.room);this._color=e?l.a.Bold:l.a.None,this._count=0,this._symbol=null}}this.emitIfUpdated(e)}}class b extends d.b{constructor(){super(),s()(this,"totalStatesWithUnread",0),this._symbol=null,this._count=0,this._color=l.a.None}get numUnreadStates(){return this.totalStatesWithUnread}add(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.symbol&&t&&(this._symbol=e.symbol),e.count&&(this._count+=e.count),e.color>this.color&&(this._color=e.color),e.hasUnreadCount&&this.totalStatesWithUnread++}}var y=a(907);class E extends i.a{constructor(){super(o.a,{}),s()(this,"roomMap",new Map),s()(this,"listMap",new Map)}get globalState(){if(!this.matrixClient)return new b;const e=new b;for(const t of this.matrixClient.getVisibleRooms())y.a.instance.isRoomVisible(t)&&e.add(this.getRoomState(t));return e}getListState(e){if(this.listMap.has(e))return this.listMap.get(e);const t=e===r.a.Invite,a=new m(t,e,e=>this.getRoomState(e));return this.listMap.set(e,a),a}getRoomState(e){return this.roomMap.has(e)||this.roomMap.set(e,new v(e)),this.roomMap.get(e)}static get instance(){return E.internalInstance}async onNotReady(){for(const e of this.roomMap.values())e.destroy()}async onAction(e){return Promise.resolve()}}s()(E,"internalInstance",new E)},185:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(99),o=a(150);class r{constructor(e){s()(this,"matrixClient",void 0),s()(this,"roomToUser",null),s()(this,"userToRooms",null),s()(this,"hasSentOutPatchDirectAccountDataPatch",void 0),s()(this,"mDirectEvent",void 0),s()(this,"onAccountData",e=>{"m.direct"==e.getType()&&(this.mDirectEvent=this.matrixClient.getAccountData("m.direct").getContent()||{},this.userToRooms=null,this.roomToUser=null)}),this.matrixClient=e,this.hasSentOutPatchDirectAccountDataPatch=!1;const t=e.getAccountData("m.direct");this.mDirectEvent=t?t.getContent():{}}static makeShared(){return r.sharedInstance=new r(i.a.get()),r.sharedInstance}static setShared(e){r.sharedInstance=e}static shared(){return r.sharedInstance}start(){this.populateRoomToUser(),this.matrixClient.on("accountData",this.onAccountData)}stop(){this.matrixClient.removeListener("accountData",this.onAccountData)}patchUpSelfDMs(e){const t=this.matrixClient.getUserId(),a=e[t];if(a){const n=a.map(e=>{const a=this.matrixClient.getRoom(e);if(a){const n=a.guessDMUserId();if(n&&n!==t)return{userId:n,roomId:e}}}).filter(e=>!!e);return!!n.length&&(e[t]=a.filter(e=>!n.some(t=>t.roomId===e)),n.forEach(t=>{let{userId:a,roomId:n}=t;const s=e[a];s?(s.push(n),e[a]=Object(o.uniq)(s)):e[a]=[n]}),!0)}}getDMRoomsForUserId(e){return this.getUserToRooms()[e]||[]}getDMRoomForIdentifiers(e){let t=this.getDMRoomsForUserId(e[0]);for(let a=1;a<e.length;a++){const n=this.getDMRoomsForUserId(e[a]);t=t.filter(e=>n.includes(e))}return t.map(e=>i.a.get().getRoom(e)).filter(e=>e&&"join"===e.getMyMembership())[0]}getUserIdForRoomId(e){if(null==this.roomToUser&&this.populateRoomToUser(),void 0===this.roomToUser[e]){const t=this.matrixClient.getRoom(e);if(t)return t.getDMInviter()}return this.roomToUser[e]}getUniqueRoomsWithIndividuals(){return this.roomToUser?Object.keys(this.roomToUser).map(e=>({userId:this.getUserIdForRoomId(e),room:this.matrixClient.getRoom(e)})).filter(e=>e.userId&&e.room&&2===e.room.getInvitedAndJoinedMemberCount()).reduce((e,t)=>(e[t.userId]=t.room)&&e,{}):{}}getUserToRooms(){if(!this.userToRooms){const e=this.mDirectEvent,t=e[this.matrixClient.getUserId()];if(t&&t.length){const t=this.patchUpSelfDMs(e);console.warn("Invalid m.direct account data detected (self-chats that shouldn't be), patching it up."),t&&!this.hasSentOutPatchDirectAccountDataPatch&&(this.hasSentOutPatchDirectAccountDataPatch=!0,this.matrixClient.setAccountData("m.direct",e))}this.userToRooms=e}return this.userToRooms}populateRoomToUser(){this.roomToUser={};for(const e of Object.keys(this.getUserToRooms()))for(const t of this.userToRooms[e])this.roomToUser[t]=e}}s()(r,"sharedInstance",void 0)},186:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(97),u=a(93),h=a(94);let p=Object(h.a)("views.dialogs.ErrorDialog")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"onClick",()=>{this.props.onFinished(!0)})}render(){const e=m.getComponent("views.dialogs.BaseDialog");return l.a.createElement(e,{className:"mx_ErrorDialog",onFinished:this.props.onFinished,title:this.props.title||Object(u.a)("Error"),headerImage:this.props.headerImage,contentId:"mx_Dialog_content"},l.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},this.props.description||Object(u.a)("An error has occurred.")),l.a.createElement("div",{className:"mx_Dialog_buttons"},l.a.createElement("button",{className:"mx_Dialog_primary",onClick:this.onClick,autoFocus:this.props.focus},this.props.button||Object(u.a)("OK"))))}},o()(s,"propTypes",{title:d.a.string,description:d.a.oneOfType([d.a.element,d.a.string]),button:d.a.string,focus:d.a.bool,onFinished:d.a.func.isRequired,headerImage:d.a.string}),o()(s,"defaultProps",{focus:!0,title:null,description:null,button:null}),n=s))||n},192:function(e,t,a){"use strict";var n=a(19),s=a.n(n),i=a(8),o=a.n(i),r=a(570),l=a(265),c=a(99),d=a(100);function m(e){return e.chunk.map(e=>Object(r.c)(e))}function u(e){return e.chunk.map(e=>Object(r.d)(e))}let h=0;const p=[];async function g(e){h>=3&&await new Promise((e,t)=>{p.push(e)}),h++;try{return await e()}catch(e){throw e}finally{h--,function(){const e=p.shift();"function"==typeof e&&e()}()}}class f extends o.a{constructor(){super(),s()(this,"STATE_KEY",{GroupMembers:"GroupMembers",GroupInvitedMembers:"GroupInvitedMembers",Summary:"Summary",GroupRooms:"GroupRooms"}),this._state={},this._state[this.STATE_KEY.Summary]={},this._state[this.STATE_KEY.GroupRooms]={},this._state[this.STATE_KEY.GroupMembers]={},this._state[this.STATE_KEY.GroupInvitedMembers]={},this._ready={},this._ready[this.STATE_KEY.Summary]={},this._ready[this.STATE_KEY.GroupRooms]={},this._ready[this.STATE_KEY.GroupMembers]={},this._ready[this.STATE_KEY.GroupInvitedMembers]={},this._fetchResourcePromise={[this.STATE_KEY.Summary]:{},[this.STATE_KEY.GroupRooms]:{},[this.STATE_KEY.GroupMembers]:{},[this.STATE_KEY.GroupInvitedMembers]:{}},this._resourceFetcher={[this.STATE_KEY.Summary]:e=>g(()=>c.a.get().getGroupSummary(e)),[this.STATE_KEY.GroupRooms]:e=>g(()=>c.a.get().getGroupRooms(e).then(u)),[this.STATE_KEY.GroupMembers]:e=>g(()=>c.a.get().getGroupUsers(e).then(m)),[this.STATE_KEY.GroupInvitedMembers]:e=>g(()=>c.a.get().getGroupInvitedUsers(e).then(m))}}_fetchResource(e,t){if(this._fetchResourcePromise[e][t])return;const a=this._resourceFetcher[e](t);return this._fetchResourcePromise[e][t]=a,a.then(a=>{this._state[e][t]=a,this._ready[e][t]=!0,this._notifyListeners()}).catch(a=>{e===this.STATE_KEY.GroupInvitedMembers&&403===a.httpStatus||(console.error(`Failed to get resource ${e} for ${t}`,a),this.emit("error",a,t,e))}).finally(()=>{delete this._fetchResourcePromise[e][t]}),a}_notifyListeners(){this.emit("update")}registerListener(e,t){return this.on("update",t),this.emit("update"),e&&(this._fetchResource(this.STATE_KEY.Summary,e),this._fetchResource(this.STATE_KEY.GroupRooms,e),this._fetchResource(this.STATE_KEY.GroupMembers,e),this._fetchResource(this.STATE_KEY.GroupInvitedMembers,e)),{unregister:()=>{this.unregisterListener(t)}}}unregisterListener(e){this.removeListener("update",e)}isStateReady(e,t){return this._ready[t][e]}getGroupIdsForRoomId(e){return Object.keys(this._state[this.STATE_KEY.GroupRooms]).filter(t=>(this._state[this.STATE_KEY.GroupRooms][t]||[]).some(t=>t.roomId===e))}getSummary(e){return this._state[this.STATE_KEY.Summary][e]||{}}getGroupRooms(e){return this._state[this.STATE_KEY.GroupRooms][e]||[]}getGroupMembers(e){return this._state[this.STATE_KEY.GroupMembers][e]||[]}getGroupInvitedMembers(e){return this._state[this.STATE_KEY.GroupInvitedMembers][e]||[]}getGroupPublicity(e){return(this._state[this.STATE_KEY.Summary][e]||{}).user?(this._state[this.STATE_KEY.Summary][e]||{}).user.is_publicised:null}isUserPrivileged(e){return(this._state[this.STATE_KEY.Summary][e]||{}).user?(this._state[this.STATE_KEY.Summary][e]||{}).user.is_privileged:null}refreshGroupRooms(e){return this._fetchResource(this.STATE_KEY.GroupRooms,e)}refreshGroupMembers(e){return this._fetchResource(this.STATE_KEY.GroupMembers,e)}addRoomToGroup(e,t,a){return c.a.get().addRoomToGroup(e,t,a).then(this._fetchResource.bind(this,this.STATE_KEY.GroupRooms,e))}updateGroupRoomVisibility(e,t,a){return c.a.get().updateGroupRoomVisibility(e,t,a).then(this._fetchResource.bind(this,this.STATE_KEY.GroupRooms,e))}removeRoomFromGroup(e,t){return c.a.get().removeRoomFromGroup(e,t).then(this._fetchResource.bind(this,this.STATE_KEY.Summary,e)).then(this._fetchResource.bind(this,this.STATE_KEY.GroupRooms,e))}inviteUserToGroup(e,t){return c.a.get().inviteUserToGroup(e,t).then(this._fetchResource.bind(this,this.STATE_KEY.GroupInvitedMembers,e))}acceptGroupInvite(e){return c.a.get().acceptGroupInvite(e).then(this._fetchResource.bind(this,this.STATE_KEY.Summary,e)).then(this._fetchResource.bind(this,this.STATE_KEY.GroupRooms,e)).then(this._fetchResource.bind(this,this.STATE_KEY.GroupMembers,e)).then(this._fetchResource.bind(this,this.STATE_KEY.GroupInvitedMembers,e))}joinGroup(e){return c.a.get().joinGroup(e).then(this._fetchResource.bind(this,this.STATE_KEY.Summary,e)).then(this._fetchResource.bind(this,this.STATE_KEY.GroupRooms,e)).then(this._fetchResource.bind(this,this.STATE_KEY.GroupMembers,e)).then(this._fetchResource.bind(this,this.STATE_KEY.GroupInvitedMembers,e))}leaveGroup(e){return d.a.dispatch({action:"deselect_tags",tag:e}),c.a.get().leaveGroup(e).then(this._fetchResource.bind(this,this.STATE_KEY.Summary,e)).then(this._fetchResource.bind(this,this.STATE_KEY.GroupRooms,e)).then(this._fetchResource.bind(this,this.STATE_KEY.GroupMembers,e))}addRoomToGroupSummary(e,t,a){return c.a.get().addRoomToGroupSummary(e,t,a).then(this._fetchResource.bind(this,this.STATE_KEY.Summary,e))}addUserToGroupSummary(e,t,a){return c.a.get().addUserToGroupSummary(e,t,a).then(this._fetchResource.bind(this,this.STATE_KEY.Summary,e))}removeRoomFromGroupSummary(e,t){return c.a.get().removeRoomFromGroupSummary(e,t).then(this._fetchResource.bind(this,this.STATE_KEY.Summary,e))}removeUserFromGroupSummary(e,t){return c.a.get().removeUserFromGroupSummary(e,t).then(this._fetchResource.bind(this,this.STATE_KEY.Summary,e))}setGroupPublicity(e,t){return c.a.get().setGroupPublicity(e,t).then(()=>{l.a.invalidatePublicisedGroups(c.a.get().credentials.userId)}).then(this._fetchResource.bind(this,this.STATE_KEY.Summary,e))}}let v=null;v||(v=new f),t.a=v},193:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(88);const s=(e,t,a)=>{const s=Object(n.useRef)(a);Object(n.useEffect)(()=>{s.current=a},[a]),Object(n.useEffect)(()=>{if(!e)return;const a=function(){return s.current(...arguments)};return e.on(t,a),()=>{e.removeListener(t,a)}},[t,e])}},194:function(e,t,a){"use strict";a.d(t,"c",(function(){return f})),a.d(t,"e",(function(){return v})),a.d(t,"d",(function(){return l})),a.d(t,"a",(function(){return c.a})),a.d(t,"b",(function(){return d.a}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(131);const l=e=>{let{children:t,inputRef:a}=e;const[n,s,i]=v(a);return t({onFocus:n,isActive:s,ref:i})};var c=a(842),d=a(843);function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const h=Object(i.createContext)({state:{activeRef:null,refs:[]},dispatch:()=>{}});var p;h.displayName="RovingTabIndexContext",function(e){e.Register="REGISTER",e.Unregister="UNREGISTER",e.SetFocus="SET_FOCUS"}(p||(p={}));const g=(e,t)=>{switch(t.type){case p.Register:{if(0===e.refs.length)return u(u({},e),{},{activeRef:t.payload.ref,refs:[t.payload.ref]});if(e.refs.includes(t.payload.ref))return e;let a=e.refs.findIndex(e=>2&e.current.compareDocumentPosition(t.payload.ref.current));return a<0&&(a=e.refs.length),u(u({},e),{},{refs:[...e.refs.slice(0,a),t.payload.ref,...e.refs.slice(a)]})}case p.Unregister:{const a=e.refs.filter(e=>e!==t.payload.ref);if(a.length===e.refs.length)return e;if(e.activeRef===t.payload.ref){const n=e.refs.findIndex(e=>e===t.payload.ref);return u(u({},e),{},{activeRef:n>=a.length?a[a.length-1]:a[n],refs:a})}return u(u({},e),{},{refs:a})}case p.SetFocus:return u(u({},e),{},{activeRef:t.payload.ref});default:return e}},f=e=>{let{children:t,handleHomeEnd:a,onKeyDown:n}=e;const[s,l]=Object(i.useReducer)(g,{activeRef:null,refs:[]}),c=Object(i.useMemo)(()=>({state:s,dispatch:l}),[s]),d=Object(i.useCallback)(e=>{let t=!1;if(a&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.key){case r.a.HOME:t=!0,c.state.refs.length>0&&c.state.refs[0].current.focus();break;case r.a.END:t=!0,c.state.refs.length>0&&c.state.refs[c.state.refs.length-1].current.focus()}if(t)e.preventDefault(),e.stopPropagation();else if(n)return n(e,c.state)},[c.state,n,a]);return o.a.createElement(h.Provider,{value:c},t({onKeyDownHandler:d}))},v=e=>{const t=Object(i.useContext)(h);let a=Object(i.useRef)(null);e&&(a=e),Object(i.useLayoutEffect)(()=>(t.dispatch({type:p.Register,payload:{ref:a}}),()=>{t.dispatch({type:p.Unregister,payload:{ref:a}})}),[]);return[Object(i.useCallback)(()=>{t.dispatch({type:p.SetFocus,payload:{ref:a}})},[a,t]),t.state.activeRef===a,a]}},1985:function(e,t,a){},20:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(0),s=a(1);class i{constructor(e){(e=e||{}).maxTimelineEntries=e.maxTimelineEntries||50,this.opts=e,this.accountData={},this.inviteRooms={},this.joinRooms={},this.nextBatch=null,this.groups={invite:{},join:{},leave:{}}}accumulate(e,t){this._accumulateRooms(e,t),this._accumulateGroups(e),this._accumulateAccountData(e),this.nextBatch=e.next_batch}_accumulateAccountData(e){e.account_data&&e.account_data.events&&e.account_data.events.forEach(e=>{this.accountData[e.type]=e})}_accumulateRooms(e,t){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach(a=>{this._accumulateRoom(a,"invite",e.rooms.invite[a],t)}),e.rooms.join&&Object.keys(e.rooms.join).forEach(a=>{this._accumulateRoom(a,"join",e.rooms.join[a],t)}),e.rooms.leave&&Object.keys(e.rooms.leave).forEach(a=>{this._accumulateRoom(a,"leave",e.rooms.leave[a],t)}))}_accumulateRoom(e,t,a,s){switch(t){case"invite":this._accumulateInviteState(e,a);break;case"join":this.inviteRooms[e]&&delete this.inviteRooms[e],this._accumulateJoinState(e,a,s);break;case"leave":this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:n.a.error("Unknown cateogory: ",t)}}_accumulateInviteState(e,t){if(!t.invite_state||!t.invite_state.events)return;if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});const a=this.inviteRooms[e];t.invite_state.events.forEach(e=>{let t=!1;for(let n=0;n<a.invite_state.events.length;n++){const s=a.invite_state.events[n];s.type===e.type&&s.state_key==e.state_key&&(a.invite_state.events[n]=e,t=!0)}t||a.invite_state.events.push(e)})}_accumulateJoinState(e,t,a){this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_summary:{},_readReceipts:{}});const n=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach(e=>{n._accountData[e.type]=e}),t.unread_notifications&&(n._unreadNotifications=t.unread_notifications),t.summary){const e="m.heroes",a="m.invited_member_count",s="m.joined_member_count",i=n._summary,o=t.summary;i[e]=o[e]||i[e],i[s]=o[s]||i[s],i[a]=o[a]||i[a]}if(t.ephemeral&&t.ephemeral.events&&t.ephemeral.events.forEach(e=>{"m.receipt"===e.type&&e.content&&Object.keys(e.content).forEach(t=>{e.content[t]["m.read"]&&Object.keys(e.content[t]["m.read"]).forEach(a=>{n._readReceipts[a]={data:e.content[t]["m.read"][a],eventId:t}})})}),t.timeline&&t.timeline.limited&&(n._timeline=[]),t.state&&t.state.events&&t.state.events.forEach(e=>{o(n._currentState,e)}),t.timeline&&t.timeline.events&&t.timeline.events.forEach((e,s)=>{let i;if(o(n._currentState,e),a)i=e;else{i=Object.assign({},e),void 0!==i.unsigned&&(i.unsigned=Object.assign({},i.unsigned));const t=e.unsigned?e.unsigned.age:e.age;void 0!==t&&(i._localTs=Date.now()-t)}n._timeline.push({event:i,token:0===s?t.timeline.prev_batch:null})}),n._timeline.length>this.opts.maxTimelineEntries){for(let e=n._timeline.length-this.opts.maxTimelineEntries;e<n._timeline.length;e++)if(n._timeline[e].token){n._timeline=n._timeline.slice(e,n._timeline.length);break}}}_accumulateGroups(e){e.groups&&(e.groups.invite&&Object.keys(e.groups.invite).forEach(t=>{this._accumulateGroup(t,"invite",e.groups.invite[t])}),e.groups.join&&Object.keys(e.groups.join).forEach(t=>{this._accumulateGroup(t,"join",e.groups.join[t])}),e.groups.leave&&Object.keys(e.groups.leave).forEach(t=>{this._accumulateGroup(t,"leave",e.groups.leave[t])}))}_accumulateGroup(e,t,a){for(const t of["invite","join","leave"])delete this.groups[t][e];this.groups[t][e]=a}getJSON(e){const t={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach(e=>{t.invite[e]=this.inviteRooms[e]}),Object.keys(this.joinRooms).forEach(a=>{const n=this.joinRooms[a],i={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:n._unreadNotifications,summary:n._summary};Object.keys(n._accountData).forEach(e=>{i.account_data.events.push(n._accountData[e])});const r={type:"m.receipt",room_id:a,content:{}};Object.keys(n._readReceipts).forEach(e=>{const t=n._readReceipts[e];r.content[t.eventId]||(r.content[t.eventId]={"m.read":{}}),r.content[t.eventId]["m.read"][e]=t.data}),Object.keys(r.content).length>0&&i.ephemeral.events.push(r),n._timeline.forEach(t=>{if(!i.timeline.prev_batch){if(!t.token)return;i.timeline.prev_batch=t.token}let a;!e&&t.event._localTs?(a=Object.assign({},t.event),void 0!==a.unsigned&&(a.unsigned=Object.assign({},a.unsigned)),delete a._localTs,a.unsigned=a.unsigned||{},a.unsigned.age=Date.now()-t.event._localTs):a=t.event,i.timeline.events.push(a)});const l=Object.create(null);for(let e=i.timeline.events.length-1;e>=0;e--){const t=i.timeline.events[e];if(null===t.state_key||void 0===t.state_key)continue;const a=Object(s.d)(t);a.unsigned&&(a.unsigned.prev_content&&(a.content=a.unsigned.prev_content),a.unsigned.prev_sender&&(a.sender=a.unsigned.prev_sender)),o(l,a)}Object.keys(n._currentState).forEach(e=>{Object.keys(n._currentState[e]).forEach(t=>{let a=n._currentState[e][t];l[e]&&l[e][t]&&(a=l[e][t]),i.state.events.push(a)})}),t.join[a]=i});const a=[];return Object.keys(this.accountData).forEach(e=>{a.push(this.accountData[e])}),{nextBatch:this.nextBatch,roomsData:t,groupsData:this.groups,accountData:a}}getNextBatchToken(){return this.nextBatch}}function o(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}},200:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return d}));var n=a(19),s=a.n(n),i=a(8),o=a.n(i),r=a(741),l=a.n(r);let c;!function(e){e.Resize="resize"}(c||(c={}));class d extends o.a{constructor(){super(),s()(this,"resizeObserver",void 0),s()(this,"uiElementDimensions",new Map),s()(this,"trackedUiElements",new Map),s()(this,"windowWidth",void 0),s()(this,"windowHeight",void 0),s()(this,"resizeObserverCallback",e=>{const t=e.find(e=>e.target===document.body);t&&(this.windowWidth=t.contentRect.width,this.windowHeight=t.contentRect.height),e.forEach(e=>{const t=this.trackedUiElements.get(e.target);t&&(this.uiElementDimensions.set(t,e.contentRect),this.emit(t,c.Resize,e))}),this.emit(c.Resize,e)}),this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.resizeObserver=new l.a(this.resizeObserverCallback),this.resizeObserver.observe(document.body)}static get instance(){return d._instance||(d._instance=new d),d._instance}static destroy(){d._instance&&(d._instance.resizeObserver.disconnect(),d._instance.removeAllListeners(),d._instance=null)}getElementDimensions(e){return this.uiElementDimensions.get(e)}trackElementDimensions(e,t){this.trackedUiElements.set(t,e),this.resizeObserver.observe(t)}stopTrackingElementDimensions(e){let t;this.trackedUiElements.forEach((a,n)=>{a===e&&(t=n)}),t&&(this.resizeObserver.unobserve(t),this.uiElementDimensions.delete(e),this.trackedUiElements.delete(t))}isTrackingElementDimensions(e){return this.uiElementDimensions.has(e)}}s()(d,"_instance",null),window.mxUIStore=d.instance},201:function(e,t,a){"use strict";a.d(t,"a",(function(){return F})),a.d(t,"j",(function(){return V})),a.d(t,"i",(function(){return G})),a.d(t,"h",(function(){return z})),a.d(t,"d",(function(){return W})),a.d(t,"e",(function(){return H})),a.d(t,"b",(function(){return J})),a.d(t,"g",(function(){return X})),a.d(t,"f",(function(){return Z})),a.d(t,"c",(function(){return ee}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(575),l=a.n(r),c=a(2312),d=a(573),m=a(2317),u=a.n(m),h=a(2319),p=a.n(h),g=a(102),f=a.n(g),v=a(1276),b=a.n(v),y=a(223),E=a.n(y),_=a(2323),S=a.n(_),C=a(748),w=a(103),O=a(1252),x=a.n(O),R=a(155),k=a(480),I=a(413),T=a(126);function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function N(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}Object(d.a)(c);const D=/([\ud800-\udbff])([\udc00-\udfff])/,j=/([\u2100-\u2bff])/,A=new RegExp("‍| ","g"),M=new RegExp("\\s","g"),U=new RegExp(`^(${b.a.source})+$`,"i"),L=/^#[0-9a-fA-F]{6}$/,F=["http","https","ftp","mailto","magnet"];function B(e){return D.test(e)||j.test(e)}function V(e){const t=Object(k.e)(e);return t&&t.shortcodes?`:${t.shortcodes[0]}:`:""}function G(e){e=e.slice(1,e.length-1);const t=k.d.get(e);return t?t.unicode:null}function z(e){const t=l()(e,q);return o.a.createElement("div",{dangerouslySetInnerHTML:{__html:t},dir:"auto"})}function W(e){return l()(e,{allowedTags:[],allowedAttributes:{},selfClosing:[],allowedSchemes:[],disallowedTagsMode:"discard"})}function H(e){try{const t=E.a.parse(e);return!!t.protocol&&F.includes(t.protocol.slice(0,-1))}catch(e){return!1}}const K={a:function(e,t){if(t.href){t.target="_blank";const e=Object(R.l)(t.href);(e!==t.href||t.href.match(d.a.ELEMENT_URL_PATTERN))&&(t.href=e,delete t.target)}return t.rel="noreferrer noopener",{tagName:e,attribs:t}},img:function(e,t){if(!t.src||!t.src.startsWith("mxc://")||!w.b.getValue("showImages"))return{tagName:e,attribs:{}};const a=Number(t.width)||800,n=Number(t.height)||600;return t.src=Object(T.b)(t.src).getThumbnailOfSourceHttp(a,n),{tagName:e,attribs:t}},code:function(e,t){if(void 0!==t.class){const e=t.class.split(/\s/).filter((function(e){return e.startsWith("language-")&&!e.startsWith("language-_")}));t.class=e.join(" ")}return{tagName:e,attribs:t}},"*":function(e,t){delete t.style;const a={"data-mx-color":"color","data-mx-bg-color":"background-color"};let n="";return Object.keys(a).forEach(e=>{const s=a[e],i=t[e];i&&"string"==typeof i&&L.test(i)&&(n+=s+":"+i+";",delete t[e])}),n&&(t.style=n),{tagName:e,attribs:t}}},q={allowedTags:["font","del","h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","sup","sub","nl","li","b","i","u","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre","span","img","details","summary"],allowedAttributes:{font:["color","data-mx-bg-color","data-mx-color","style"],span:["data-mx-maths","data-mx-bg-color","data-mx-color","data-mx-spoiler","style"],div:["data-mx-maths"],a:["href","name","target","rel"],img:["src","width","height","alt","title"],ol:["start"],code:["class"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:F,allowProtocolRelative:!1,transformTags:K,nestingLimit:50},Y=N(N({},q),{},{transformTags:{code:K.code,"*":K["*"]}});class $ extends class{constructor(e,t){this.highlightClass=e,this.highlightLink=t}applyHighlights(e,t){let a,n=0,s=[];const i=t[0];for(;(a=e.toLowerCase().indexOf(i.toLowerCase(),n))>=0;){if(a>n){const i=e.substring(n,a);s=s.concat(this.applySubHighlights(i,t))}const o=a+i.length;s.push(this.processSnippet(e.substring(a,o),!0)),n=o}if(n!==e.length){const a=e.substring(n,void 0);s=s.concat(this.applySubHighlights(a,t))}return s}applySubHighlights(e,t){return t[1]?this.applyHighlights(e,t.slice(1)):[this.processSnippet(e,!1)]}}{processSnippet(e,t){if(!t)return e;let a=`<span class="${this.highlightClass}">${e}</span>`;return this.highlightLink&&(a=`<a href="${encodeURI(this.highlightLink)}">${a}</a>`),a}}function J(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n="org.matrix.custom.html"===e.format&&e.formatted_body;let s,i,r,c=!1,d=q;a.forComposerQuote&&(d=Y);try{if(t&&t.length>0){const e=new $("mx_EventTile_searchHighlight",a.highlightLink),n=t.map((function(e){return l()(e,d)}));d.textFilter=function(t){return e.applyHighlights(t,n).join("")}}let o="string"==typeof e.formatted_body?e.formatted_body:null;const m="string"==typeof e.body?e.body:"";if(a.stripReplyFallback&&o&&(o=I.a.stripHTMLReply(o)),s=a.stripReplyFallback?I.a.stripPlainReply(m):m,c=B(n?o:m),n&&(r=!0,i=l()(o,d),w.b.getValue("feature_latex_maths"))){const e=x.a.load(i,{_useHtmlParser2:!0,decodeEntities:!1});e('div, span[data-mx-maths!=""]').replaceWith((function(t,a){return S.a.renderToString(C.AllHtmlEntities.decode(e(a).attr("data-mx-maths")),{throwOnError:!1,displayMode:"div"==a.name,output:"htmlAndMathml"})})),i=e.html()}}finally{delete d.textFilter}const m=r?i:s;if(a.returnString)return m;let u=!1;if(!a.disableBigEmoji&&c){let t=void 0!==m?m.trim():"";t=t.replace(M,""),t=t.replace(A,"");const a=U.exec(t);u=a&&a[0]&&a[0].length===t.length&&(s===i||void 0===e.formatted_body||!e.formatted_body.includes("http:")&&!e.formatted_body.includes("https:"))}const h=f()({mx_EventTile_body:!0,mx_EventTile_bigEmoji:u,"markdown-body":n&&!u});return r?o.a.createElement("span",{key:"body",ref:a.ref,className:h,dangerouslySetInnerHTML:{__html:i},dir:"auto"}):o.a.createElement("span",{key:"body",ref:a.ref,className:h,dir:"auto"},s)}function Q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.a.options;return p()(e,t)}function X(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.a.options;return u()(e,t)}function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.a.options;return l()(Q(e,t),q)}function ee(e){switch(e.nodeName){case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"PRE":case"BLOCKQUOTE":case"P":case"UL":case"OL":case"LI":case"HR":case"TABLE":case"THEAD":case"TBODY":case"TR":case"TH":case"TD":return!0;case"DIV":return!e.hasAttribute("data-mx-maths");default:return!1}}},202:function(e,t,a){"use strict";a.d(t,"d",(function(){return f})),a.d(t,"a",(function(){return v})),a.d(t,"b",(function(){return b})),a.d(t,"c",(function(){return y}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(127);const u=["label","iconClassName","active","className"],h=["label","iconClassName","active","className"],p=["label","iconClassName"],g=["className","children","compact"],f=e=>{let{label:t,iconClassName:a,active:n,className:i}=e,r=o()(e,u);return l.a.createElement(m.h,s()({},r,{className:d()(i,{mx_IconizedContextMenu_active:n}),active:n,label:t}),l.a.createElement("span",{className:d()("mx_IconizedContextMenu_icon",a)}),l.a.createElement("span",{className:"mx_IconizedContextMenu_label"},t),n&&l.a.createElement("span",{className:"mx_IconizedContextMenu_icon mx_IconizedContextMenu_checked"}))},v=e=>{let{label:t,iconClassName:a,active:n,className:i}=e,r=o()(e,h);return l.a.createElement(m.g,s()({},r,{className:d()(i,{mx_IconizedContextMenu_active:n}),active:n,label:t}),l.a.createElement("span",{className:d()("mx_IconizedContextMenu_icon",a)}),l.a.createElement("span",{className:"mx_IconizedContextMenu_label"},t),n&&l.a.createElement("span",{className:"mx_IconizedContextMenu_icon mx_IconizedContextMenu_checked"}))},b=e=>{let{label:t,iconClassName:a}=e,n=o()(e,p);return l.a.createElement(m.f,s()({},n,{label:t}),a&&l.a.createElement("span",{className:d()("mx_IconizedContextMenu_icon",a)}),l.a.createElement("span",{className:"mx_IconizedContextMenu_label"},t))},y=e=>{let{first:t,red:a,className:n,children:s}=e;const i=d()("mx_IconizedContextMenu_optionList",n,{mx_IconizedContextMenu_optionList_notFirst:!t,mx_IconizedContextMenu_optionList_red:a});return l.a.createElement("div",{className:i},s)};t.e=e=>{let{className:t,children:a,compact:n}=e,i=o()(e,g);const r=d()("mx_IconizedContextMenu",t,{mx_IconizedContextMenu_compact:n});return l.a.createElement(m.b,s()({chevronFace:m.a.None},i),l.a.createElement("div",{className:r},a))}},203:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(19),s=a.n(n),i=a(237),o=a(100),r=a(295),l=a(103),c=a(1),d=a(142),m=a(265),u=a(277),h=a(192);class p extends i.a{constructor(){super(o.a,{})}static get instance(){return p.internalInstance}static getUpdateEventName(e){return`${d.b}:${e}`}getSelectedCommunityId(){return l.b.getValue("feature_communities_v2_prototypes")?u.a.getSelectedTags()[0]:null}getSelectedCommunityName(){return p.instance.getCommunityName(this.getSelectedCommunityId())}getSelectedCommunityGeneralChat(){const e=this.getSelectedCommunityId();if(e)return this.getGeneralChat(e)}getCommunityName(e){const t=m.a.getGroupProfileCachedFast(this.matrixClient,e);return(null==t?void 0:t.name)||e}getCommunityProfile(e){return m.a.getGroupProfileCachedFast(this.matrixClient,e)}getGeneralChat(e){const t=h.a.getGroupRooms(e).map(e=>this.matrixClient.getRoom(e.roomId)).filter(e=>!!e);let a=t.find(t=>{const a=t.currentState.getStateEvents("im.vector.general_chat","");return!(!a||a.getContent().groupId!==e)});return a||(a=t[0]),a}isAdminOf(e){const t=h.a.getGroupMembers(e).find(e=>e.userId===this.matrixClient.getUserId());return null==t?void 0:t.isPrivileged}canInviteTo(e){const t=this.getGeneralChat(e);if(!t)return this.isAdminOf(e);const a=t.getMember(this.matrixClient.getUserId());if(!a)return this.isAdminOf(e);const n=t.currentState.getStateEvents("m.room.power_levels","");if(!n)return this.isAdminOf(e);return(Object(c.o)(n.invite)?50:Number(n.invite))<=a.powerLevel}async onAction(e){if(this.matrixClient&&l.b.getValue("feature_communities_v2_prototypes"))if("MatrixActions.Room.myMembership"===e.action){const t=e.room,a=Object(r.b)(e.membership);if(a===Object(r.b)(e.oldMembership))return;if(a===r.a.Invite)try{const e=c.g("/rooms/$roomId/group_info",{$roomId:t.roomId}),a=await this.matrixClient.http.authedRequest(void 0,"GET",e,void 0,void 0,{prefix:"/_matrix/client/unstable/im.vector.custom"});await this.matrixClient.setAccountData("im.vector.group_info."+t.roomId,a)}catch(e){console.warn("Non-fatal error getting group information for invite:",e)}}else if("MatrixActions.accountData"===e.action){if(e.event_type.startsWith("im.vector.group_info.")){const t=e.event_type.substring("im.vector.group_info.".length);this.emit(p.getUpdateEventName(t),t)}}else if("select_tag"===e.action){const t=this.getGeneralChat(e.tag);t&&o.a.dispatch({action:"view_room",room_id:t.roomId})}}getInviteProfile(e){if(!this.matrixClient)return{displayName:null,avatarMxc:null};const t=this.matrixClient.getRoom(e);if(l.b.getValue("feature_communities_v2_prototypes")){const t=this.matrixClient.getAccountData("im.vector.group_info."+e);if(t&&t.getContent())return{displayName:t.getContent().name,avatarMxc:t.getContent().avatar_url}}return{displayName:t.name,avatarMxc:t.avatar_url}}async onReady(){for(const e of this.matrixClient.getRooms()){const t=e.currentState.getMembers().find(e=>e.userId===this.matrixClient.getUserId());t&&(Object(r.b)(t.membership)===r.a.Invite&&this.emit(p.getUpdateEventName(e.roomId),e.roomId))}}}s()(p,"internalInstance",new p)},2045:function(e,t,a){var n={"./af":1022,"./af.js":1022,"./ar":1023,"./ar-dz":1024,"./ar-dz.js":1024,"./ar-kw":1025,"./ar-kw.js":1025,"./ar-ly":1026,"./ar-ly.js":1026,"./ar-ma":1027,"./ar-ma.js":1027,"./ar-sa":1028,"./ar-sa.js":1028,"./ar-tn":1029,"./ar-tn.js":1029,"./ar.js":1023,"./az":1030,"./az.js":1030,"./be":1031,"./be.js":1031,"./bg":1032,"./bg.js":1032,"./bm":1033,"./bm.js":1033,"./bn":1034,"./bn-bd":1035,"./bn-bd.js":1035,"./bn.js":1034,"./bo":1036,"./bo.js":1036,"./br":1037,"./br.js":1037,"./bs":1038,"./bs.js":1038,"./ca":1039,"./ca.js":1039,"./cs":1040,"./cs.js":1040,"./cv":1041,"./cv.js":1041,"./cy":1042,"./cy.js":1042,"./da":1043,"./da.js":1043,"./de":1044,"./de-at":1045,"./de-at.js":1045,"./de-ch":1046,"./de-ch.js":1046,"./de.js":1044,"./dv":1047,"./dv.js":1047,"./el":1048,"./el.js":1048,"./en-au":1049,"./en-au.js":1049,"./en-ca":1050,"./en-ca.js":1050,"./en-gb":1051,"./en-gb.js":1051,"./en-ie":1052,"./en-ie.js":1052,"./en-il":1053,"./en-il.js":1053,"./en-in":1054,"./en-in.js":1054,"./en-nz":1055,"./en-nz.js":1055,"./en-sg":1056,"./en-sg.js":1056,"./eo":1057,"./eo.js":1057,"./es":1058,"./es-do":1059,"./es-do.js":1059,"./es-mx":1060,"./es-mx.js":1060,"./es-us":1061,"./es-us.js":1061,"./es.js":1058,"./et":1062,"./et.js":1062,"./eu":1063,"./eu.js":1063,"./fa":1064,"./fa.js":1064,"./fi":1065,"./fi.js":1065,"./fil":1066,"./fil.js":1066,"./fo":1067,"./fo.js":1067,"./fr":1068,"./fr-ca":1069,"./fr-ca.js":1069,"./fr-ch":1070,"./fr-ch.js":1070,"./fr.js":1068,"./fy":1071,"./fy.js":1071,"./ga":1072,"./ga.js":1072,"./gd":1073,"./gd.js":1073,"./gl":1074,"./gl.js":1074,"./gom-deva":1075,"./gom-deva.js":1075,"./gom-latn":1076,"./gom-latn.js":1076,"./gu":1077,"./gu.js":1077,"./he":1078,"./he.js":1078,"./hi":1079,"./hi.js":1079,"./hr":1080,"./hr.js":1080,"./hu":1081,"./hu.js":1081,"./hy-am":1082,"./hy-am.js":1082,"./id":1083,"./id.js":1083,"./is":1084,"./is.js":1084,"./it":1085,"./it-ch":1086,"./it-ch.js":1086,"./it.js":1085,"./ja":1087,"./ja.js":1087,"./jv":1088,"./jv.js":1088,"./ka":1089,"./ka.js":1089,"./kk":1090,"./kk.js":1090,"./km":1091,"./km.js":1091,"./kn":1092,"./kn.js":1092,"./ko":1093,"./ko.js":1093,"./ku":1094,"./ku.js":1094,"./ky":1095,"./ky.js":1095,"./lb":1096,"./lb.js":1096,"./lo":1097,"./lo.js":1097,"./lt":1098,"./lt.js":1098,"./lv":1099,"./lv.js":1099,"./me":1100,"./me.js":1100,"./mi":1101,"./mi.js":1101,"./mk":1102,"./mk.js":1102,"./ml":1103,"./ml.js":1103,"./mn":1104,"./mn.js":1104,"./mr":1105,"./mr.js":1105,"./ms":1106,"./ms-my":1107,"./ms-my.js":1107,"./ms.js":1106,"./mt":1108,"./mt.js":1108,"./my":1109,"./my.js":1109,"./nb":1110,"./nb.js":1110,"./ne":1111,"./ne.js":1111,"./nl":1112,"./nl-be":1113,"./nl-be.js":1113,"./nl.js":1112,"./nn":1114,"./nn.js":1114,"./oc-lnc":1115,"./oc-lnc.js":1115,"./pa-in":1116,"./pa-in.js":1116,"./pl":1117,"./pl.js":1117,"./pt":1118,"./pt-br":1119,"./pt-br.js":1119,"./pt.js":1118,"./ro":1120,"./ro.js":1120,"./ru":1121,"./ru.js":1121,"./sd":1122,"./sd.js":1122,"./se":1123,"./se.js":1123,"./si":1124,"./si.js":1124,"./sk":1125,"./sk.js":1125,"./sl":1126,"./sl.js":1126,"./sq":1127,"./sq.js":1127,"./sr":1128,"./sr-cyrl":1129,"./sr-cyrl.js":1129,"./sr.js":1128,"./ss":1130,"./ss.js":1130,"./sv":1131,"./sv.js":1131,"./sw":1132,"./sw.js":1132,"./ta":1133,"./ta.js":1133,"./te":1134,"./te.js":1134,"./tet":1135,"./tet.js":1135,"./tg":1136,"./tg.js":1136,"./th":1137,"./th.js":1137,"./tk":1138,"./tk.js":1138,"./tl-ph":1139,"./tl-ph.js":1139,"./tlh":1140,"./tlh.js":1140,"./tr":1141,"./tr.js":1141,"./tzl":1142,"./tzl.js":1142,"./tzm":1143,"./tzm-latn":1144,"./tzm-latn.js":1144,"./tzm.js":1143,"./ug-cn":1145,"./ug-cn.js":1145,"./uk":1146,"./uk.js":1146,"./ur":1147,"./ur.js":1147,"./uz":1148,"./uz-latn":1149,"./uz-latn.js":1149,"./uz.js":1148,"./vi":695,"./vi.js":695,"./x-pseudo":1150,"./x-pseudo.js":1150,"./yo":1151,"./yo.js":1151,"./zh-cn":1152,"./zh-cn.js":1152,"./zh-hk":1153,"./zh-hk.js":1153,"./zh-mo":1154,"./zh-mo.js":1154,"./zh-tw":1155,"./zh-tw.js":1155};function s(e){var t=i(e);return a(t)}function i(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}s.keys=function(){return Object.keys(n)},s.resolve=i,e.exports=s,s.id=2045},205:function(e,t,a){"use strict";a.d(t,"a",(function(){return h})),a.d(t,"h",(function(){return p})),a.d(t,"g",(function(){return g})),a.d(t,"f",(function(){return f})),a.d(t,"e",(function(){return v})),a.d(t,"c",(function(){return b})),a.d(t,"b",(function(){return y})),a.d(t,"d",(function(){return E}));var n=a(88),s=a.n(n),i=a(99),o=a(582),r=a(106),l=a(97),c=a(93),d=a(634),m=a(1424),u=a(203);function h(e,t){const a=new o.a(e);return a.invite(t).then(e=>Promise.resolve({states:e,inviter:a}))}function p(e){const t=l.getComponent("dialogs.InviteDialog");r.a.createTrackedDialog("Start DM","",t,{kind:d.b,initialText:e},null,!1,!0)}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";r.a.createTrackedDialog("Invite Users","",d.d,{kind:d.c,initialText:t,roomId:e},null,!1,!0)}function f(e,t){r.a.createTrackedDialog("Invite Users to Community","",m.a,{communityName:t,roomId:e},null,!1,!0)}function v(e){const t=u.a.instance.getGeneralChat(e);if(!t)throw new Error("Failed to locate appropriate room to start an invite in");{const a=u.a.instance.getCommunityName(e);f(t.roomId,a)}}function b(e){if(!e||"m.room.third_party_invite"!==e.getType())return!1;const t=["key_validity_url","public_key","display_name"];for(let a=0;a<t.length;++a)if(!e.getContent()[t[a]])return!1;return!0}function y(e,t){return h(e,t).then(t=>{const a=i.a.get().getRoom(e);E(t.states,a,t.inviter)}).catch(e=>{console.error(e.stack);const t=l.getComponent("dialogs.ErrorDialog");r.a.createTrackedDialog("Failed to invite","",t,{title:Object(c.a)("Failed to invite"),description:e&&e.message?e.message:Object(c.a)("Operation failed")})})}function E(e,t,a){const n=Object.keys(e).filter(t=>"error"===e[t]);if(1===n.length&&a.fatal){const e=l.getComponent("dialogs.ErrorDialog");return r.a.createTrackedDialog("Failed to invite users to the room","",e,{title:Object(c.a)("Failed to invite users to the room:",{roomName:t.name}),description:a.getErrorText(n[0])}),!1}{const i=[];for(const t of n)if("error"===e[t]){const e=a.getErrorText(t);i.push(t+": "+e)}if(i.length>0){const e=s.a.createElement("div",null,i.map(e=>s.a.createElement("div",{key:e},e))),a=l.getComponent("dialogs.ErrorDialog");return r.a.createTrackedDialog("Failed to invite the following users to the room","",a,{title:Object(c.a)("Failed to invite the following users to the %(roomName)s room:",{roomName:t.name}),description:e}),!1}}return!0}},21:function(e,t,a){"use strict";function n(e,t){return new Promise((a,n)=>{let s=!0;const i=e.open(t);i.onupgradeneeded=()=>{s=!1},i.onblocked=()=>n(),i.onsuccess=()=>{i.result.close(),s||e.deleteDatabase(t),a(s)},i.onerror=e=>n(e.target.error)})}a.d(t,"a",(function(){return n}))},211:function(e,t,a){"use strict";function n(e,t){return new Promise(a=>{setTimeout(a,e,t)})}async function s(e,t,a){const n=new Promise(n=>{const s=setTimeout(n,a,t);e.then(()=>{clearTimeout(s)})});return Promise.race([e,n])}function i(){let e,t;const a=new Promise((a,n)=>{e=a,t=n});return{resolve:e,reject:t,promise:a}}async function o(e,t,a){let n;for(let s=0;s<t;s++)try{return await e()}catch(e){if(a&&!a(e))throw e;n=e}throw n}a.d(t,"c",(function(){return n})),a.d(t,"d",(function(){return s})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return o}))},213:function(e,t,a){"use strict";a.r(t),function(e,n){a.d(t,"OLM_ALGORITHM",(function(){return l})),a.d(t,"MEGOLM_ALGORITHM",(function(){return c})),a.d(t,"MEGOLM_BACKUP_ALGORITHM",(function(){return d})),a.d(t,"encryptMessageForDevice",(function(){return m})),a.d(t,"getExistingOlmSessions",(function(){return u})),a.d(t,"ensureOlmSessionsForDevices",(function(){return h})),a.d(t,"verifySignature",(function(){return g})),a.d(t,"pkSign",(function(){return f})),a.d(t,"pkVerify",(function(){return v})),a.d(t,"encodeBase64",(function(){return b})),a.d(t,"encodeUnpaddedBase64",(function(){return y})),a.d(t,"decodeBase64",(function(){return E}));var s=a(0),i=a(1),o=a(583),r=a.n(o);const l="m.olm.v1.curve25519-aes-sha2",c="m.megolm.v1.aes-sha2",d="m.megolm_backup.v1.curve25519-aes-sha2";async function m(e,t,a,n,o,r,l){const c=r.getIdentityKey(),d=await n.getSessionIdForDevice(c);if(null===d)return;s.a.log("Using sessionid "+d+" for device "+o+":"+r.deviceId);const m={sender:t,sender_device:a,keys:{ed25519:n.deviceEd25519Key},recipient:o,recipient_keys:{ed25519:r.getFingerprint()}};i.j(m,l),e[c]=await n.encryptMessage(c,d,JSON.stringify(m))}async function u(e,t,a){const n={},s={},i=[];for(const[t,o]of Object.entries(a))for(const a of o){const o=a.deviceId,r=a.getIdentityKey();i.push((async()=>{const i=await e.getSessionIdForDevice(r,!0);null===i?(n[t]=n[t]||[],n[t].push(a)):(s[t]=s[t]||{},s[t][o]={device:a,sessionId:i})})())}return await Promise.all(i),[n,s]}async function h(e,t,a,n,i,o,r){"number"==typeof n&&(r=o,o=i,i=n,n=!1),r||(r=s.a);const l=[],c={},d={};for(const[,t]of Object.entries(a))for(const a of t){const t=a.getIdentityKey();t!==e.deviceCurve25519Key&&(e._sessionsInProgress[t]||(e._sessionsInProgress[t]=new Promise(a=>{d[t]=function(){delete e._sessionsInProgress[t],a(...arguments)}})))}for(const[t,s]of Object.entries(a)){c[t]={};for(const a of s){const s=a.deviceId,i=a.getIdentityKey();if(i===e.deviceCurve25519Key){r.info("Attempted to start session with ourself! Ignoring"),c[t][s]={device:a,sessionId:null};continue}const o=`for ${i} (${t}:${s})`,m=await e.getSessionIdForDevice(i,d[i],r);null!==m&&d[i]&&d[i](),(null===m||n)&&(n?r.info("Forcing new Olm session "+o):r.info("Making new Olm session "+o),l.push([t,s])),c[t][s]={device:a,sessionId:m}}}if(0===l.length)return c;let m,u=`one-time keys for ${l.length} devices`;try{r.debug("Claiming "+u),m=await t.claimOneTimeKeys(l,"signed_curve25519",i),r.debug("Claimed "+u)}catch(e){for(const e of Object.values(d))e();throw r.log("Failed to claim "+u,e,l),e}o&&"failures"in m&&o.push(...Object.keys(m.failures));const h=m.one_time_keys||{},g=[];for(const[t,s]of Object.entries(a)){const a=h[t]||{};for(let i=0;i<s.length;i++){const o=s[i],l=o.deviceId,m=o.getIdentityKey();if(m===e.deviceCurve25519Key)continue;if(c[t][l].sessionId&&!n)continue;const u=a[l]||{};let h=null;for(const e in u)0===e.indexOf("signed_curve25519:")&&(h=u[e]);h?g.push(p(e,h,t,o).then(e=>{d[m]&&d[m](e),c[t][l].sessionId=e},e=>{throw d[m]&&d[m](),e})):(r.warn(`No one-time keys (alg=signed_curve25519) for device ${t}:${l}`),d[m]&&d[m]())}}return u=`Olm sessions for ${g.length} devices`,r.debug("Starting "+u),await Promise.all(g),r.debug("Started "+u),c}async function p(e,t,a,n){const i=n.deviceId;try{await g(e,t,a,i,n.getFingerprint())}catch(e){return s.a.error("Unable to verify signature on one-time key for device "+a+":"+i+":",e),null}let o;try{o=await e.createOutboundSession(n.getIdentityKey(),t.key)}catch(e){return s.a.error("Error starting olm session with device "+a+":"+i+": "+e),null}return s.a.log("Started new olm sessionid "+o+" for device "+a+":"+i),o}async function g(e,t,a,n,s){const i="ed25519:"+n,o=((t.signatures||{})[a]||{})[i];if(!o)throw Error("No signature");const l=Object.assign({},t);delete l.unsigned,delete l.signatures;const c=r.a.stringify(l);e.verifySignature(s,c,o)}function f(t,a,n,s){let i=!1;if(a instanceof Uint8Array){const t=new e.Olm.PkSigning;s=t.init_with_seed(a),a=t,i=!0}const o=t.signatures||{};delete t.signatures;const l=t.unsigned;t.unsigned&&delete t.unsigned;try{const e=o[n]||{};return o[n]=e,e["ed25519:"+s]=a.sign(r.a.stringify(t))}finally{t.signatures=o,l&&(t.unsigned=l),i&&a.free()}}function v(t,a,n){const s="ed25519:"+a;if(!(t.signatures&&t.signatures[n]&&t.signatures[n][s]))throw new Error("No signature");const i=t.signatures[n][s],o=new e.Olm.Utility,l=t.signatures;delete t.signatures;const c=t.unsigned;t.unsigned&&delete t.unsigned;try{o.ed25519_verify(a,r.a.stringify(t),i)}finally{t.signatures=l,c&&(t.unsigned=c),o.free()}}function b(e){return n.from(e).toString("base64")}function y(e){return b(e).replace(/=+$/g,"")}function E(e){return n.from(e,"base64")}}.call(this,a(7),a(36).Buffer)},214:function(e,t,a){"use strict";a.d(t,"b",(function(){return E})),a.d(t,"a",(function(){return _})),a.d(t,"d",(function(){return S})),a.d(t,"g",(function(){return C})),a.d(t,"c",(function(){return w})),a.d(t,"f",(function(){return O})),a.d(t,"e",(function(){return x})),a.d(t,"h",(function(){return R}));var n=a(140),s=a(99),i=a(106),o=a(97),r=a(93),l=a(100),c=a(298),d=a(185),m=a(363),u=a(419),h=a(192),p=a(154),g=a(295),f=a(158),v=a(175),b=a(334),y=a(115);let E,_;function S(e){void 0===(e=e||{}).spinner&&(e.spinner=!0),void 0===e.guestAccess&&(e.guestAccess=!0),void 0===e.encryption&&(e.encryption=!1);const t=p.a.getTimestamp(),a=o.getComponent("dialogs.ErrorDialog"),d=o.getComponent("elements.Spinner"),u=s.a.get();if(u.isGuest())return l.a.dispatch({action:"require_registration"}),Promise.resolve(null);const g=e.dmUserId?_.TrustedPrivateChat:_.PrivateChat,f=e.createOpts||{};if(f.preset=f.preset||g,f.visibility=f.visibility||E.Private,e.dmUserId&&void 0===f.invite)switch(Object(m.c)(e.dmUserId)){case"mx-user-id":f.invite=[e.dmUserId];break;case"email":f.invite_3pid=[{id_server:s.a.get().getIdentityServerUrl(!0),medium:"email",address:e.dmUserId}]}let S,C;return e.dmUserId&&void 0===f.is_direct&&(f.is_direct=!0),void 0===e.andView&&(e.andView=!0),f.initial_state=f.initial_state||[],e.guestAccess&&f.initial_state.push({type:"m.room.guest_access",state_key:"",content:{guest_access:"can_join"}}),e.encryption&&f.initial_state.push({type:"m.room.encryption",state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}),e.parentSpace&&(e.createOpts.initial_state.push(Object(b.a)(e.parentSpace,!0)),e.createOpts.initial_state.push({type:n.a.RoomHistoryVisibility,content:{history_visibility:e.createOpts.preset===_.PublicChat?"world_readable":"invited"}})),e.spinner&&(S=i.a.createDialog(d,null,"mx_Dialog_spinner")),u.createRoom(f).finally((function(){S&&S.close()})).then((function(t){return C=t.room_id,e.dmUserId?c.c(C,e.dmUserId):Promise.resolve()})).then(()=>e.parentSpace?v.e.instance.addRoomToSpace(e.parentSpace,C,[u.getDomain()],!0):e.associatedWithCommunity?h.a.addRoomToGroup(e.associatedWithCommunity,C,!1):void 0).then((function(){return e.andView&&l.a.dispatch({action:"view_room",room_id:C,should_peek:!1,joining:!0,justCreatedOpts:e}),p.a.instance.trackRoomCreate(t,C),C}),(function(t){if(e.inlineErrors)throw t;l.a.dispatch({action:y.a.JoinRoomError,roomId:C}),console.error("Failed to create room "+C+" "+t);let n=Object(r.a)("Server may be unavailable, overloaded, or you hit a bug.");return"M_UNSUPPORTED_ROOM_VERSION"===t.errcode&&(n=Object(r.a)("The server does not support the room version specified.")),i.a.createTrackedDialog("Failure to create room","",a,{title:Object(r.a)("Failure to create room"),description:n}),null}))}function C(e,t){const a=d.a.shared().getDMRoomsForUserId(t).map(t=>e.getRoom(t)).filter(e=>{if(e&&"join"===e.getMyMembership()){const a=e.currentState.getMembers().filter(e=>Object(g.c)(e.membership));return a.find(e=>e.userId===t)&&2===a.length}return!1}).sort((e,t)=>t.getLastActiveTimestamp()-e.getLastActiveTimestamp());if(a.length)return a[0]}async function w(e,t){try{const a=await e.downloadKeys(t);return Object.values(a).every(e=>Object.keys(e).length>0)}catch(e){return console.error("Error determining if it's possible to encrypt to all users: ",e),!1}}async function O(e,t,a){const n=C(e,t);let s;return s=n?n.roomId:await S({dmUserId:t,spinner:!1,andView:!1,createOpts:{creation_content:{[f.c]:a}}}),s}async function x(e,t){const a=C(e,t);let n;if(a)n=a.roomId;else{let a=void 0;R()&&(a=await w(e,[t])),n=await S({encryption:a,dmUserId:t,spinner:!1,andView:!1}),await async function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{timeout:1500};const{timeout:s}=n;let i;return new Promise(n=>{i=function(e,s,i){i.userId===a&&i.roomId===t&&n(!0)},e.on("RoomState.newMember",i),setTimeout(n,s,!1)}).finally(()=>{e.removeListener("RoomState.newMember",i)})}(e,n,t)}return n}function R(){const e=Object(u.b)();if(e){return!(!1===e.default)}return!0}!function(e){e.Public="public",e.Private="private"}(E||(E={})),function(e){e.PrivateChat="private_chat",e.TrustedPrivateChat="trusted_private_chat",e.PublicChat="public_chat"}(_||(_={}))},215:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(223),s=a(99),i=a(110),o=a(100),r=a(332),l=a(103),c=a(283),d=a(247),m=a(166),u=a(93),h=a(206);class p{static canUserModifyWidgets(e){if(!e)return console.warn("No room ID specified"),!1;const t=s.a.get();if(!t)return console.warn("User must be be logged in"),!1;const a=t.getRoom(e);if(!a)return console.warn(`Room ID ${e} is not recognised`),!1;const n=t.credentials.userId;return n?"join"!==a.getMyMembership()?(console.warn(`User ${n} is not in room ${e}`),!1):a.currentState.maySendStateEvent("im.vector.modular.widgets",n):(console.warn("Failed to get user ID"),!1)}static isScalarUrl(e){if(!e)return console.error("Scalar URL check failed. No URL specified"),!1;const t=n.parse(e);let a=i.a.get().integrations_widgets_urls;if(!a||0===a.length){const e=c.a.sharedInstance().getPrimaryManager();a=e?[e.apiUrl]:[]}for(let e=0;e<a.length;e++){const s=n.parse(a[e]);if(t&&s&&t.protocol===s.protocol&&t.host===s.host&&t.pathname.startsWith(s.pathname))return!0}return!1}static waitForUserWidget(e,t){return new Promise((a,n)=>{function i(a){return!(!a||!a.getContent())&&(t?void 0!==a.getContent()[e]:void 0===a.getContent()[e])}if(i(s.a.get().getAccountData("m.widgets")))return void a();function o(e){i(s.a.get().getAccountData("m.widgets"))&&(s.a.get().removeListener("accountData",o),clearTimeout(r),a())}const r=setTimeout(()=>{s.a.get().removeListener("accountData",o),n(new Error("Timed out waiting for widget ID "+e+" to appear"))},2e4);s.a.get().on("accountData",o)})}static waitForRoomWidget(e,t,a){return new Promise((n,i)=>{function o(t){const n=t.some(t=>t.getContent()&&t.getContent().id===e);return a?n:!n}const r=s.a.get().getRoom(t);if(o(r.currentState.getStateEvents("im.vector.modular.widgets")))return void n();function l(e){if(e.getRoomId()!==t)return;o(r.currentState.getStateEvents("im.vector.modular.widgets"))&&(s.a.get().removeListener("RoomState.events",l),clearTimeout(c),n())}const c=setTimeout(()=>{s.a.get().removeListener("RoomState.events",l),i(new Error("Timed out waiting for widget ID "+e+" to appear"))},2e4);s.a.get().on("RoomState.events",l)})}static setUserWidget(e,t,a,n,i){const r={type:t.preferred,url:a,name:n,data:i},l=s.a.get(),c=Object(m.a)(p.getUserWidgets());try{delete c[e]}catch(e){console.error("$widgetId is non-configurable")}const d=Boolean(a);return d&&(c[e]={content:r,sender:l.getUserId(),state_key:e,type:"m.widget",id:e}),l.setAccountData("m.widgets",c).then(()=>p.waitForUserWidget(e,d)).then(()=>{o.a.dispatch({action:"user_widget_updated"})})}static setRoomWidget(e,t,a,n,s,i){let o;return o=Boolean(n)?{type:a.legacy,url:n,name:s,data:i}:{},p.setRoomWidgetContent(e,t,o)}static setRoomWidgetContent(e,t,a){const n=!!a.url;r.a.setRoomWidgetEcho(e,t,a);return s.a.get().sendStateEvent(e,"im.vector.modular.widgets",a,t).then(()=>p.waitForRoomWidget(t,e,n)).finally(()=>{r.a.removeRoomWidgetEcho(e,t)})}static getRoomWidgets(e){const t=e.currentState.getStateEvents("im.vector.modular.widgets");return t?t.filter(e=>e.getContent().type&&e.getContent().url):[]}static getUserWidgets(){const e=s.a.get();if(!e)throw new Error("User not logged in");const t=e.getAccountData("m.widgets");return t&&t.getContent()?t.getContent():{}}static getUserWidgetsArray(){return Object.values(p.getUserWidgets())}static getStickerpickerWidgets(){return p.getUserWidgetsArray().filter(e=>e.content&&"m.stickerpicker"===e.content.type)}static getIntegrationManagerWidgets(){return p.getUserWidgetsArray().filter(e=>e.content&&"m.integration_manager"===e.content.type)}static getRoomWidgetsOfType(e,t){return(p.getRoomWidgets(e)||[]).filter(e=>{const a=e.getContent();return a.url&&t.matches(a.type)})}static removeIntegrationManagerWidgets(){const e=s.a.get();if(!e)throw new Error("User not logged in");const t=e.getAccountData("m.widgets");if(!t)return;const a=t.getContent()||{};return Object.entries(a).forEach(e=>{let[t,n]=e;n.content&&"m.integration_manager"===n.content.type&&delete a[t]}),e.setAccountData("m.widgets",a)}static addIntegrationManagerWidget(e,t,a){return p.setUserWidget("integration_manager_"+(new Date).getTime(),d.a.INTEGRATION_MANAGER,t,"Integration Manager: "+e,{api_url:a})}static removeStickerpickerWidgets(){const e=s.a.get();if(!e)throw new Error("User not logged in");const t=e.getAccountData("m.widgets");if(!t)return;const a=t.getContent()||{};return Object.entries(a).forEach(e=>{let[t,n]=e;n.content&&"m.stickerpicker"===n.content.type&&delete a[t]}),e.setAccountData("m.widgets",a)}static makeAppConfig(e,t,a,n,s){if(!a)throw new Error("Widgets must be created by someone - provide a senderUserId");return t.creatorUserId=a,t.id=e,t.roomId=n,t.eventId=s,t.name=t.name||t.type,t}static getCapWhitelistForAppTypeInRoomId(e,t){const a=l.b.getValue("enableWidgetScreenshots",t)?[h.MatrixCapabilities.Screenshots]:[];return d.a.JITSI.matches(e)&&a.push(h.MatrixCapabilities.AlwaysOnScreen),a}static getLocalJitsiWrapperUrl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["conferenceDomain=$domain","conferenceId=$conferenceId","isAudioOnly=$isAudioOnly","displayName=$matrix_display_name","avatarUrl=$matrix_avatar_url","userId=$matrix_user_id","roomId=$matrix_room_id","theme=$theme","roomName=$roomName"];e.auth&&t.push("auth="+e.auth);const a=t.join("&");let n=window.location.href;"https:"===window.location.protocol||e.forLocalRender||(n="https://app.element.io/");return new URL("jitsi.html#"+a,n).href}static getWidgetName(e){var t;return(null==e||null===(t=e.name)||void 0===t?void 0:t.trim())||Object(u.a)("Unknown App")}static getWidgetDataTitle(e){var t,a;return(null==e||null===(t=e.data)||void 0===t||null===(a=t.title)||void 0===a?void 0:a.trim())||""}static editWidget(e,t){l.b.getValue("feature_many_integration_managers")?c.a.sharedInstance().openAll(e,"type_"+t.type,t.id):c.a.sharedInstance().getPrimaryManager().open(e,"type_"+t.type,t.id)}static isManagedByManager(e){if(p.isScalarUrl(e.url)){const e=c.a.sharedInstance();if(e.hasManager()){const t=e.getPrimaryManager();return p.isScalarUrl(t.apiUrl)}}return!1}}},216:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(92),l=a.n(r),c=a(102),d=a.n(c),m=a(97),u=a(93);class h extends o.a.Component{constructor(){super(...arguments),s()(this,"onOk",()=>{this.props.onFinished(!0)}),s()(this,"onCancel",()=>{this.props.onFinished(!1)})}render(){const e=m.getComponent("views.dialogs.BaseDialog"),t=m.getComponent("views.elements.DialogButtons");let a="";return this.props.danger&&(a="danger"),o.a.createElement(e,{className:d()("mx_QuestionDialog",this.props.className),onFinished:this.props.onFinished,title:this.props.title,contentId:"mx_Dialog_content",headerImage:this.props.headerImage,hasCancel:this.props.hasCancelButton,fixedWidth:this.props.fixedWidth},o.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},this.props.description),o.a.createElement(t,{primaryButton:this.props.button||Object(u.a)("OK"),primaryButtonClass:a,primaryDisabled:this.props.buttonDisabled,cancelButton:this.props.cancelButton,hasCancel:this.props.hasCancelButton&&!this.props.quitOnly,onPrimaryButtonClick:this.onOk,focus:this.props.focus,onCancel:this.onCancel},this.props.extraButtons))}}s()(h,"propTypes",{title:l.a.string,description:l.a.node,extraButtons:l.a.node,button:l.a.string,buttonDisabled:l.a.bool,danger:l.a.bool,focus:l.a.bool,onFinished:l.a.func.isRequired,headerImage:l.a.string,quitOnly:l.a.bool,fixedWidth:l.a.bool,className:l.a.string}),s()(h,"defaultProps",{title:"",description:"",extraButtons:null,focus:!0,hasCancelButton:!0,danger:!1,quitOnly:!1})},217:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(8),o=a.n(i);class r extends o.a{constructor(){super(...arguments),s()(this,"toasts",[]),s()(this,"countSeen",0)}static sharedInstance(){return window.mxToastStore||(window.mxToastStore=new r),window.mxToastStore}reset(){this.toasts=[],this.countSeen=0}addOrReplaceToast(e){const t=this.toasts.findIndex(t=>t.key===e.key);if(-1===t){let t=this.toasts.length;for(;t>0&&this.toasts[t-1].priority<e.priority;)--t;this.toasts.splice(t,0,e)}else this.toasts[t]=e;this.emit("update")}dismissToast(e){this.toasts[0]&&this.toasts[0].key===e&&this.countSeen++;const t=this.toasts.length;this.toasts=this.toasts.filter(t=>t.key!==e),t!==this.toasts.length&&(0===this.toasts.length&&(this.countSeen=0),this.emit("update"))}getToasts(){return this.toasts}getCountSeen(){return this.countSeen}}},220:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c})),a.d(t,"e",(function(){return d})),a.d(t,"d",(function(){return m})),a.d(t,"c",(function(){return u})),a.d(t,"f",(function(){return g}));var n=a(19),s=a.n(n),i=a(131),o=a(103);const r={getMessageComposerBindings:()=>{const e=[{action:l.SelectPrevSendHistory,keyCombo:{key:i.a.ARROW_UP,altKey:!0,ctrlKey:!0}},{action:l.SelectNextSendHistory,keyCombo:{key:i.a.ARROW_DOWN,altKey:!0,ctrlKey:!0}},{action:l.EditPrevMessage,keyCombo:{key:i.a.ARROW_UP}},{action:l.EditNextMessage,keyCombo:{key:i.a.ARROW_DOWN}},{action:l.CancelEditing,keyCombo:{key:i.a.ESCAPE}},{action:l.FormatBold,keyCombo:{key:i.a.B,ctrlOrCmd:!0}},{action:l.FormatItalics,keyCombo:{key:i.a.I,ctrlOrCmd:!0}},{action:l.FormatQuote,keyCombo:{key:i.a.GREATER_THAN,ctrlOrCmd:!0,shiftKey:!0}},{action:l.EditUndo,keyCombo:{key:i.a.Z,ctrlOrCmd:!0}},{action:l.MoveCursorToStart,keyCombo:{key:i.a.HOME,ctrlOrCmd:!0}},{action:l.MoveCursorToEnd,keyCombo:{key:i.a.END,ctrlOrCmd:!0}}];return i.b?e.push({action:l.EditRedo,keyCombo:{key:i.a.Z,ctrlOrCmd:!0,shiftKey:!0}}):e.push({action:l.EditRedo,keyCombo:{key:i.a.Y,ctrlOrCmd:!0}}),o.b.getValue("MessageComposerInput.ctrlEnterToSend")?(e.push({action:l.Send,keyCombo:{key:i.a.ENTER,ctrlOrCmd:!0}}),e.push({action:l.NewLine,keyCombo:{key:i.a.ENTER}})):(e.push({action:l.Send,keyCombo:{key:i.a.ENTER}}),e.push({action:l.NewLine,keyCombo:{key:i.a.ENTER,shiftKey:!0}}),i.b&&e.push({action:l.NewLine,keyCombo:{key:i.a.ENTER,altKey:!0}})),e},getAutocompleteBindings:()=>[{action:c.CompleteOrNextSelection,keyCombo:{key:i.a.TAB}},{action:c.CompleteOrNextSelection,keyCombo:{key:i.a.TAB,ctrlKey:!0}},{action:c.CompleteOrPrevSelection,keyCombo:{key:i.a.TAB,shiftKey:!0}},{action:c.CompleteOrPrevSelection,keyCombo:{key:i.a.TAB,ctrlKey:!0,shiftKey:!0}},{action:c.Cancel,keyCombo:{key:i.a.ESCAPE}},{action:c.PrevSelection,keyCombo:{key:i.a.ARROW_UP}},{action:c.NextSelection,keyCombo:{key:i.a.ARROW_DOWN}}],getRoomListBindings:()=>[{action:d.ClearSearch,keyCombo:{key:i.a.ESCAPE}},{action:d.PrevRoom,keyCombo:{key:i.a.ARROW_UP}},{action:d.NextRoom,keyCombo:{key:i.a.ARROW_DOWN}},{action:d.SelectRoom,keyCombo:{key:i.a.ENTER}},{action:d.CollapseSection,keyCombo:{key:i.a.ARROW_LEFT}},{action:d.ExpandSection,keyCombo:{key:i.a.ARROW_RIGHT}}],getRoomBindings:()=>{const e=[{action:m.ScrollUp,keyCombo:{key:i.a.PAGE_UP}},{action:m.RoomScrollDown,keyCombo:{key:i.a.PAGE_DOWN}},{action:m.DismissReadMarker,keyCombo:{key:i.a.ESCAPE}},{action:m.JumpToOldestUnread,keyCombo:{key:i.a.PAGE_UP,shiftKey:!0}},{action:m.UploadFile,keyCombo:{key:i.a.U,ctrlOrCmd:!0,shiftKey:!0}},{action:m.JumpToFirstMessage,keyCombo:{key:i.a.HOME,ctrlKey:!0}},{action:m.JumpToLatestMessage,keyCombo:{key:i.a.END,ctrlKey:!0}}];return o.b.getValue("ctrlFForSearch")&&e.push({action:m.FocusSearch,keyCombo:{key:i.a.F,ctrlOrCmd:!0}}),e},getNavigationBindings:()=>[{action:u.FocusRoomSearch,keyCombo:{key:i.a.K,ctrlOrCmd:!0}},{action:u.ToggleRoomSidePanel,keyCombo:{key:i.a.PERIOD,ctrlOrCmd:!0}},{action:u.ToggleUserMenu,keyCombo:{key:i.a.BACKTICK,ctrlOrCmd:!0}},{action:u.ToggleShortCutDialog,keyCombo:{key:i.a.SLASH,ctrlOrCmd:!0}},{action:u.ToggleShortCutDialog,keyCombo:{key:i.a.SLASH,ctrlOrCmd:!0,shiftKey:!0}},{action:u.GoToHome,keyCombo:{key:i.a.H,ctrlKey:!0,altKey:!i.b,shiftKey:i.b}},{action:u.SelectPrevRoom,keyCombo:{key:i.a.ARROW_UP,altKey:!0}},{action:u.SelectNextRoom,keyCombo:{key:i.a.ARROW_DOWN,altKey:!0}},{action:u.SelectPrevUnreadRoom,keyCombo:{key:i.a.ARROW_UP,altKey:!0,shiftKey:!0}},{action:u.SelectNextUnreadRoom,keyCombo:{key:i.a.ARROW_DOWN,altKey:!0,shiftKey:!0}}]};let l,c,d,m,u;function h(e,t,a){var n,s,i,o,r,l,c,d;if(void 0!==t.key)if(e.shiftKey){if(e.key.toLowerCase()!==t.key.toLowerCase())return!1}else if(e.key!==t.key)return!1;const m=null!==(n=t.ctrlKey)&&void 0!==n&&n,u=null!==(s=t.altKey)&&void 0!==s&&s,h=null!==(i=t.shiftKey)&&void 0!==i&&i,p=null!==(o=t.metaKey)&&void 0!==o&&o,g=null!==(r=e.ctrlKey)&&void 0!==r&&r,f=null!==(l=e.altKey)&&void 0!==l&&l,v=null!==(c=e.shiftKey)&&void 0!==c&&c,b=null!==(d=e.metaKey)&&void 0!==d&&d;if(t.ctrlOrCmd){if(a){if(!b||g!==m||f!==u||v!==h)return!1}else if(!g||b!==p||f!==u||v!==h)return!1;return!0}return b===p&&g===m&&f===u&&v===h}!function(e){e.Send="Send",e.SelectPrevSendHistory="SelectPrevSendHistory",e.SelectNextSendHistory="SelectNextSendHistory",e.EditPrevMessage="EditPrevMessage",e.EditNextMessage="EditNextMessage",e.CancelEditing="CancelEditing",e.FormatBold="FormatBold",e.FormatItalics="FormatItalics",e.FormatQuote="FormatQuote",e.EditUndo="EditUndo",e.EditRedo="EditRedo",e.NewLine="NewLine",e.MoveCursorToStart="MoveCursorToStart",e.MoveCursorToEnd="MoveCursorToEnd"}(l||(l={})),function(e){e.CompleteOrPrevSelection="ApplySelection",e.CompleteOrNextSelection="CompleteOrNextSelection",e.PrevSelection="PrevSelection",e.NextSelection="NextSelection",e.Cancel="Cancel"}(c||(c={})),function(e){e.ClearSearch="ClearSearch",e.PrevRoom="PrevRoom",e.NextRoom="NextRoom",e.SelectRoom="SelectRoom",e.CollapseSection="CollapseSection",e.ExpandSection="ExpandSection"}(d||(d={})),function(e){e.ScrollUp="ScrollUp",e.RoomScrollDown="RoomScrollDown",e.DismissReadMarker="DismissReadMarker",e.JumpToOldestUnread="JumpToOldestUnread",e.UploadFile="UploadFile",e.FocusSearch="FocusSearch",e.JumpToFirstMessage="JumpToFirstMessage",e.JumpToLatestMessage="JumpToLatestMessage"}(m||(m={})),function(e){e.FocusRoomSearch="FocusRoomSearch",e.ToggleRoomSidePanel="ToggleRoomSidePanel",e.ToggleUserMenu="ToggleUserMenu",e.ToggleShortCutDialog="ToggleShortCutDialog",e.GoToHome="GoToHome",e.SelectPrevRoom="SelectPrevRoom",e.SelectNextRoom="SelectNextRoom",e.SelectPrevUnreadRoom="SelectPrevUnreadRoom",e.SelectNextUnreadRoom="SelectNextUnreadRoom"}(u||(u={}));const p=new class{constructor(){s()(this,"bindingsProviders",[r])}getAction(e,t){for(const a of e){const e=a().find(e=>h(t,e.keyCombo,i.b));if(e)return e.action}}getMessageComposerAction(e){return this.getAction(this.bindingsProviders.map(e=>e.getMessageComposerBindings),e)}getAutocompleteAction(e){return this.getAction(this.bindingsProviders.map(e=>e.getAutocompleteBindings),e)}getRoomListAction(e){return this.getAction(this.bindingsProviders.map(e=>e.getRoomListBindings),e)}getRoomAction(e){return this.getAction(this.bindingsProviders.map(e=>e.getRoomBindings),e)}getNavigationAction(e){return this.getAction(this.bindingsProviders.map(e=>e.getNavigationBindings),e)}};function g(){return p}},222:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return c})),a.d(t,"b",(function(){return d})),a.d(t,"d",(function(){return m})),a.d(t,"e",(function(){return u})),a.d(t,"f",(function(){return h}));var n=a(93);function s(){return[Object(n.a)("Sun"),Object(n.a)("Mon"),Object(n.a)("Tue"),Object(n.a)("Wed"),Object(n.a)("Thu"),Object(n.a)("Fri"),Object(n.a)("Sat")]}function i(){return[Object(n.a)("Jan"),Object(n.a)("Feb"),Object(n.a)("Mar"),Object(n.a)("Apr"),Object(n.a)("May"),Object(n.a)("Jun"),Object(n.a)("Jul"),Object(n.a)("Aug"),Object(n.a)("Sep"),Object(n.a)("Oct"),Object(n.a)("Nov"),Object(n.a)("Dec")]}function o(e){return(e<10?"0":"")+e}function r(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.getHours()%12;const s=o(e.getMinutes()),i=e.getHours()>=12?Object(n.a)("PM"):Object(n.a)("AM");if(a=a||12,t){return`${a}:${s}:${o(e.getSeconds())}${i}`}return`${a}:${s}${i}`}function l(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=new Date,o=s(),r=i();return e.toDateString()===a.toDateString()?u(e,t):a.getTime()-e.getTime()<5184e5?Object(n.a)("%(weekDayName)s %(time)s",{weekDayName:o[e.getDay()],time:u(e,t)}):a.getFullYear()===e.getFullYear()?Object(n.a)("%(weekDayName)s, %(monthName)s %(day)s %(time)s",{weekDayName:o[e.getDay()],monthName:r[e.getMonth()],day:e.getDate(),time:u(e,t)}):d(e,t)}function c(e){const t=s(),a=i();return Object(n.a)("%(weekDayName)s, %(monthName)s %(day)s %(fullYear)s",{weekDayName:t[e.getDay()],monthName:a[e.getMonth()],day:e.getDate(),fullYear:e.getFullYear()})}function d(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=s(),r=i();return Object(n.a)("%(weekDayName)s, %(monthName)s %(day)s %(fullYear)s %(time)s",{weekDayName:o[e.getDay()],monthName:r[e.getMonth()],day:e.getDate(),fullYear:e.getFullYear(),time:a?m(e,t):u(e,t)})}function m(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?r(e,!0):o(e.getHours())+":"+o(e.getMinutes())+":"+o(e.getSeconds())}function u(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?r(e):o(e.getHours())+":"+o(e.getMinutes())}function h(e,t){return!(!t||!e)&&(Math.abs(e.getTime()-t.getTime())>864e5||e.getDay()!==t.getDay())}},225:function(e,t,a){"use strict";a.r(t),function(e){a.d(t,"request",(function(){return T})),a.d(t,"getRequest",(function(){return P})),a.d(t,"wrapRequest",(function(){return N})),a.d(t,"setCryptoStoreFactory",(function(){return j})),a.d(t,"createClient",(function(){return A}));var n=a(484),s=a(443),i=a(774),o=a(266);a.d(t,"CRYPTO_ENABLED",(function(){return o.a})),a.d(t,"MatrixClient",(function(){return o.b}));var r=a(485);a.d(t,"PREFIX_R0",(function(){return r.h})),a.d(t,"PREFIX_UNSTABLE",(function(){return r.i})),a.d(t,"PREFIX_IDENTITY_V1",(function(){return r.e})),a.d(t,"PREFIX_IDENTITY_V2",(function(){return r.f})),a.d(t,"PREFIX_MEDIA_R0",(function(){return r.g})),a.d(t,"MatrixHttpApi",(function(){return r.d})),a.d(t,"MatrixError",(function(){return r.c})),a.d(t,"ConnectionError",(function(){return r.b})),a.d(t,"AbortError",(function(){return r.a})),a.d(t,"retryNetworkOperation",(function(){return r.j}));var l=a(418);a.d(t,"AutoDiscovery",(function(){return l.a}));var c=a(20);a.d(t,"SyncAccumulator",(function(){return c.a}));var d=a(331);a.d(t,"InvalidStoreError",(function(){return d.b})),a.d(t,"InvalidCryptoStoreError",(function(){return d.a})),a.d(t,"KeySignatureUploadError",(function(){return d.c}));var m=a(146);a.d(t,"EventStatus",(function(){return m.a})),a.d(t,"MatrixEvent",(function(){return m.b}));var u=a(439);a.d(t,"Room",(function(){return u.a}));var h=a(417);a.d(t,"Group",(function(){return h.a}));var p=a(256);a.d(t,"EventTimeline",(function(){return p.a}));var g=a(633);a.d(t,"EventTimelineSet",(function(){return g.a}));var f=a(257);a.d(t,"RoomMember",(function(){return f.a}));var v=a(639);a.d(t,"RoomState",(function(){return v.a}));var b=a(346);a.d(t,"User",(function(){return b.a})),a.d(t,"MatrixScheduler",(function(){return i.a}));var y=a(514);a.d(t,"Filter",(function(){return y.a}));var E=a(778);a.d(t,"TimelineWindow",(function(){return E.b})),a.d(t,"TimelineIndex",(function(){return E.a}));var _=a(779);a.d(t,"InteractiveAuth",(function(){return _.a}));var S=a(329);a.d(t,"SERVICE_TYPES",(function(){return S.a})),a.d(t,"MemoryStore",(function(){return s.a}));var C=a(590);a.d(t,"IndexedDBStore",(function(){return C.a}));var w=a(780);a.d(t,"WebStorageSessionStore",(function(){return w.a})),a.d(t,"MemoryCryptoStore",(function(){return n.a}));var O=a(246);a.d(t,"IndexedDBCryptoStore",(function(){return O.a}));var x=a(444);a.d(t,"getHttpUriForMxc",(function(){return x.a}));var R=a(589);a.d(t,"ContentHelpers",(function(){return R}));var k=a(238);let I;function T(e){I=e}function P(){return I}function N(e){const t=I;I=function(a,n){return e(t,a,n)}}a.d(t,"createNewMatrixCall",(function(){return k.g})),a.d(t,"setMatrixCallAudioInput",(function(){return k.i})),a.d(t,"setMatrixCallVideoInput",(function(){return k.j}));let D=()=>new n.a;function j(e){D=e}function A(t){return"string"==typeof t&&(t={baseUrl:t}),t.request=t.request||I,t.store=t.store||new s.a({localStorage:e.localStorage}),t.scheduler=t.scheduler||new i.a,t.cryptoStore=t.cryptoStore||D(),new o.b(t)}}.call(this,a(7))},2256:function(e,t,a){},2257:function(e,t){},2258:function(e,t,a){},2259:function(e,t,a){},226:function(e,t,a){"use strict";async function n(e){try{if(navigator&&navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0;{const t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t);const a=document.getSelection(),n=document.createRange();n.selectNode(t),a.removeAllRanges(),a.addRange(n);const s=document.execCommand("copy");return a.removeAllRanges(),document.body.removeChild(t),s}}catch(e){console.error("copyPlaintext failed",e)}return!1}function s(e){const t=document.createRange();t.selectNodeContents(e);const a=window.getSelection();a.removeAllRanges(),a.addRange(t)}function i(e){return s(e),document.execCommand("copy")}a.d(t,"c",(function(){return n})),a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return r}));const o=new Intl.Collator;function r(e,t){return o.compare(e,t)}},2260:function(e,t,a){},2261:function(e,t,a){},2262:function(e,t,a){},2263:function(e,t,a){},2264:function(e,t,a){},227:function(e,t,a){"use strict";var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(368),u=a(103),h=a(108),p=a(119),g=a(193),f=a(596),v=a(93);const b=["name","idName","title","url","urls","width","height","resizeMethod","defaultToInitialLetter","onClick","inputRef","className"],y=(e,t)=>{let a=[];return u.b.getValue("lowBandwidth")||(a=t||[],e&&(a=[e,...a])),Array.from(new Set(a))};t.a=e=>{const{name:t,idName:a,title:n,url:i,urls:c,width:u=40,height:E=40,resizeMethod:_="crop",defaultToInitialLetter:S=!0,onClick:C,inputRef:w,className:O}=e,x=o()(e,b),[R,k]=(e=>{let{url:t,urls:a}=e;const[n,s]=Object(r.useState)(y(t,a)),[i,o]=Object(r.useState)(0),l=Object(r.useCallback)(()=>{o(e=>e+1)},[]);Object(r.useEffect)(()=>{s(y(t,a)),o(0)},[t,JSON.stringify(a)]);const c=Object(r.useContext)(p.a),d=Object(r.useCallback)((e,t)=>{"ERROR"!==e&&t!==e&&o(0)},[]);Object(g.a)(c,"sync",d);return[n[i],l]})({url:i,urls:c});if(!R&&S){const e=m.e(t),i=l.a.createElement("span",{className:"mx_BaseAvatar_initial","aria-hidden":"true",style:{fontSize:Object(f.a)(.65*u),width:Object(f.a)(u),lineHeight:Object(f.a)(E)}},e),o=l.a.createElement("img",{className:"mx_BaseAvatar_image",src:m.d(a||t),alt:"",title:n,onError:k,style:{width:Object(f.a)(u),height:Object(f.a)(E)},"aria-hidden":"true"});return C?l.a.createElement(h.a,s()({"aria-label":Object(v.a)("Avatar")},x,{element:"span",className:d()("mx_BaseAvatar",O),onClick:C,inputRef:w}),i,o):l.a.createElement("span",s()({className:d()("mx_BaseAvatar",O),ref:w},x,{role:"presentation"}),i,o)}return C?l.a.createElement(h.a,s()({className:d()("mx_BaseAvatar mx_BaseAvatar_image",O),element:"img",src:R,onClick:C,onError:k,style:{width:Object(f.a)(u),height:Object(f.a)(E)},title:n,alt:Object(v.a)("Avatar"),inputRef:w},x)):l.a.createElement("img",s()({className:d()("mx_BaseAvatar mx_BaseAvatar_image",O),src:R,onError:k,style:{width:Object(f.a)(u),height:Object(f.a)(E)},title:n,alt:"",ref:w},x))}},228:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(19),l=a.n(r),c=a(88),d=a.n(c),m=a(294),u=a(94);const h=["children","className"];var p,g;let f=Object(u.a)("views.elements.StyledCheckbox")((g=class extends d.a.PureComponent{constructor(e){super(e),l()(this,"id",void 0),this.id="checkbox_"+Object(m.b)(10)}render(){const e=this.props,{children:t,className:n}=e,i=o()(e,h);return d.a.createElement("span",{className:"mx_Checkbox "+n},d.a.createElement("input",s()({id:this.id},i,{type:"checkbox"})),d.a.createElement("label",{htmlFor:this.id},d.a.createElement("div",{className:"mx_Checkbox_background"},d.a.createElement("img",{src:a(2680)})),d.a.createElement("div",null,this.props.children)))}},l()(g,"defaultProps",{className:""}),p=g))||p},2285:function(e,t){e.exports="img/element-desktop-logo.81db796.svg"},23:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(20),s=a(1),i=a(21),o=a(0);function r(e,t,a){const n=e.openCursor(t);return new Promise((e,t)=>{const s=[];n.onerror=e=>{t(new Error("Query failed: "+e.target.errorCode))},n.onsuccess=t=>{const n=t.target.result;n?(s.push(a(n)),n.continue()):e(s)}})}function l(e){return new Promise((t,a)=>{e.oncomplete=function(e){t(e)},e.onerror=function(e){a(e.target.error)}})}function c(e){return new Promise((t,a)=>{e.onsuccess=function(e){t(e)},e.onerror=function(e){a(e.target.error)}})}function d(e){return c(e).then(e=>e.target.result)}function m(e,t){this.indexedDB=e,this._dbName="matrix-js-sdk:"+(t||"default"),this.db=null,this._disconnected=!0,this._syncAccumulator=new n.a,this._isNewlyCreated=!1}m.exists=function(e,t){return t="matrix-js-sdk:"+(t||"default"),i.a(e,t)},m.prototype={connect:function(){if(!this._disconnected)return o.a.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this._disconnected=!1,o.a.log("LocalIndexedDBStoreBackend.connect: connecting...");const e=this.indexedDB.open(this._dbName,3);return e.onupgradeneeded=e=>{const t=e.target.result,a=e.oldVersion;o.a.log("LocalIndexedDBStoreBackend.connect: upgrading from "+a),a<1&&(this._isNewlyCreated=!0,function(e){e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})}(t)),a<2&&function(e){e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")}(t),a<3&&function(e){e.createObjectStore("client_options",{keyPath:["clobber"]})}(t)},e.onblocked=()=>{o.a.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},o.a.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),c(e).then(e=>(o.a.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=e.target.result,this.db.onversionchange=()=>{this.db.close()},this._init()))},isNewlyCreated:function(){return Promise.resolve(this._isNewlyCreated)},_init:function(){return Promise.all([this._loadAccountData(),this._loadSyncData()]).then(e=>{let[t,a]=e;o.a.log("LocalIndexedDBStoreBackend: loaded initial data"),this._syncAccumulator.accumulate({next_batch:a.nextBatch,rooms:a.roomsData,groups:a.groupsData,account_data:{events:t}},!0)})},getOutOfBandMembers:function(e){return new Promise((t,a)=>{const n=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),s=IDBKeyRange.only(e),i=n.openCursor(s),o=[];let r=!1;i.onsuccess=e=>{const a=e.target.result;if(!a)return o.length||r?t(o):t(null);const n=a.value;n.oob_written?r=!0:o.push(n),a.continue()},i.onerror=e=>{a(e)}}).then(t=>(o.a.log("LL: got "+(t&&t.length)+` membershipEvents from storage for room ${e} ...`),t))},setOutOfBandMembers:async function(e,t){o.a.log("LL: backend about to store "+t.length+" members for "+e);const a=this.db.transaction(["oob_membership_events"],"readwrite"),n=a.objectStore("oob_membership_events");t.forEach(e=>{n.put(e)});const s={room_id:e,oob_written:!0,state_key:0};n.put(s),await l(a),o.a.log(`LL: backend done storing for ${e}!`)},clearOutOfBandMembers:async function(e){const t=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),a=IDBKeyRange.only(e),n=d(t.openKeyCursor(a,"next")).then(e=>e&&e.primaryKey[1]),s=d(t.openKeyCursor(a,"prev")).then(e=>e&&e.primaryKey[1]),[i,r]=await Promise.all([n,s]),l=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),c=IDBKeyRange.bound([e,i],[e,r]);var m;o.a.log(`LL: Deleting all users + marker in storage for room ${e}, with key range:`,[e,i],[e,r]),await(m=l.delete(c),new Promise((e,t)=>{m.onsuccess=()=>e(m),m.onerror=e=>t(e)}))},clearDatabase:function(){return new Promise((e,t)=>{o.a.log("Removing indexeddb instance: "+this._dbName);const a=this.indexedDB.deleteDatabase(this._dbName);a.onblocked=()=>{o.a.log("can't yet delete indexeddb "+this._dbName+" because it is open elsewhere")},a.onerror=t=>{o.a.warn("unable to delete js-sdk store indexeddb: "+t.target.error),e()},a.onsuccess=()=>{o.a.log("Removed indexeddb instance: "+this._dbName),e()}})},getSavedSync:function(e){void 0===e&&(e=!0);const t=this._syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(s.d(t)):Promise.resolve(t):Promise.resolve(null)},getNextBatchToken:function(){return Promise.resolve(this._syncAccumulator.getNextBatchToken())},setSyncData:function(e){return Promise.resolve().then(()=>{this._syncAccumulator.accumulate(e)})},syncToDatabase:function(e){const t=this._syncAccumulator.getJSON(!0);return Promise.all([this._persistUserPresenceEvents(e),this._persistAccountData(t.accountData),this._persistSyncData(t.nextBatch,t.roomsData,t.groupsData)])},_persistSyncData:function(e,t,a){return o.a.log("Persisting sync data up to",e),s.t(()=>{const n=this.db.transaction(["sync"],"readwrite");return n.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t,groupsData:a}),l(n)})},_persistAccountData:function(e){return s.t(()=>{const t=this.db.transaction(["accountData"],"readwrite"),a=t.objectStore("accountData");for(let t=0;t<e.length;t++)a.put(e[t]);return l(t)})},_persistUserPresenceEvents:function(e){return s.t(()=>{const t=this.db.transaction(["users"],"readwrite"),a=t.objectStore("users");for(const t of e)a.put({userId:t[0],event:t[1]});return l(t)})},getUserPresenceEvents:function(){return s.t(()=>r(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,e=>[e.value.userId,e.value.event]))},_loadAccountData:function(){return o.a.log("LocalIndexedDBStoreBackend: loading account data..."),s.t(()=>r(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,e=>e.value).then(e=>(o.a.log("LocalIndexedDBStoreBackend: loaded account data"),e)))},_loadSyncData:function(){return o.a.log("LocalIndexedDBStoreBackend: loading sync data..."),s.t(()=>r(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,e=>e.value).then(e=>(o.a.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&o.a.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{})))},getClientOptions:function(){return Promise.resolve().then(()=>r(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,e=>{if(e.value&&e.value&&e.value.options)return e.value.options}).then(e=>e[0]))},storeClientOptions:async function(e){const t=this.db.transaction(["client_options"],"readwrite");t.objectStore("client_options").put({clobber:"-",options:e}),await l(t)}}},237:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(142),o=a(1316);class r extends i.a{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),s()(this,"readyStore",void 0);const t=this;this.readyStore=new class extends o.a{get mxClient(){return this.matrixClient}async onReady(){return t.onReady()}async onNotReady(){return t.onNotReady()}}(e)}get matrixClient(){return this.readyStore.mxClient}async onReady(){}async onNotReady(){}async onDispatch(e){await this.onAction(e)}}},238:function(e,t,a){"use strict";a.d(t,"e",(function(){return u})),a.d(t,"f",(function(){return h})),a.d(t,"a",(function(){return p})),a.d(t,"d",(function(){return g})),a.d(t,"c",(function(){return f})),a.d(t,"b",(function(){return v})),a.d(t,"h",(function(){return y})),a.d(t,"i",(function(){return R})),a.d(t,"j",(function(){return k})),a.d(t,"g",(function(){return I}));var n=a(258),s=a.n(n),i=a(0),o=a(8),r=a(1),l=a(140),c=a(294);let d;!function(e){e.Usermedia="m.usermedia",e.Screenshare="m.screenshare"}(d||(d={}));var m=a(776);let u,h,p,g,f,v;var b;!function(e){e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended"}(u||(u={})),function(e){e.Voice="voice",e.Video="video"}(h||(h={})),function(e){e.Inbound="inbound",e.Outbound="outbound"}(p||(p={})),function(e){e.Local="local",e.Remote="remote"}(g||(g={})),function(e){e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold",e.FeedsChanged="feeds_changed",e.AssertedIdentityChanged="asserted_identity_changed"}(f||(f={})),function(e){e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout",e.UserBusy="user_busy"}(v||(v={})),function(e){e.Audio="audio",e.Video="video"}(b||(b={}));function y(){return window.electron.getDesktopCapturerSources({thumbnailSize:{height:176,width:312},types:["screen","window"]})}class E extends Error{constructor(e,t,a){super(t+": "+a),s()(this,"code",void 0),this.code=e}}function _(){return Date.now().toString()+Object(c.b)(16)}class S extends o.EventEmitter{constructor(e){super(),s()(this,"roomId",void 0),s()(this,"type",void 0),s()(this,"callId",void 0),s()(this,"state",void 0),s()(this,"hangupParty",void 0),s()(this,"hangupReason",void 0),s()(this,"direction",void 0),s()(this,"ourPartyId",void 0),s()(this,"client",void 0),s()(this,"forceTURN",void 0),s()(this,"turnServers",void 0),s()(this,"candidateSendQueue",void 0),s()(this,"candidateSendTries",void 0),s()(this,"sentEndOfCandidates",void 0),s()(this,"peerConn",void 0),s()(this,"feeds",void 0),s()(this,"screenSharingStream",void 0),s()(this,"localAVStream",void 0),s()(this,"inviteOrAnswerSent",void 0),s()(this,"waitForLocalAVStream",void 0),s()(this,"config",void 0),s()(this,"successor",void 0),s()(this,"opponentMember",void 0),s()(this,"opponentVersion",void 0),s()(this,"opponentPartyId",void 0),s()(this,"opponentCaps",void 0),s()(this,"inviteTimeout",void 0),s()(this,"remoteOnHold",void 0),s()(this,"unholdingRemote",void 0),s()(this,"micMuted",void 0),s()(this,"vidMuted",void 0),s()(this,"callStatsAtEnd",void 0),s()(this,"makingOffer",void 0),s()(this,"ignoreOffer",void 0),s()(this,"remoteCandidateBuffer",new Map),s()(this,"remoteAssertedIdentity",void 0),s()(this,"gotUserMediaForInvite",async e=>{if(this.successor)this.successor.gotUserMediaForAnswer(e);else if(this.callHasEnded())this.stopAllMedia();else{this.localAVStream=e,i.a.info("Got local AV stream with id "+this.localAVStream.id),this.setState(u.CreateOffer),i.a.debug("gotUserMediaForInvite -> "+this.type),this.screenSharingStream?(i.a.debug("Setting screen sharing stream to the local video element"),this.pushNewFeed(this.screenSharingStream,this.client.getUserId(),d.Screenshare)):this.pushNewFeed(e,this.client.getUserId(),d.Usermedia),C(e.getAudioTracks(),!0);for(const t of e.getAudioTracks())i.a.info("Adding audio track with id "+t.id),this.peerConn.addTrack(t,e);for(const t of(this.screenSharingStream||e).getVideoTracks())i.a.info("Adding video track with id "+t.id),this.peerConn.addTrack(t,e)}}),s()(this,"gotUserMediaForAnswer",async e=>{if(this.callHasEnded())return;this.pushNewFeed(e,this.client.getUserId(),d.Usermedia),this.localAVStream=e,i.a.info("Got local AV stream with id "+this.localAVStream.id),C(e.getAudioTracks(),!0);for(const t of e.getTracks())this.peerConn.addTrack(t,e);let t;this.setState(u.CreateAnswer);try{t=await this.peerConn.createAnswer()}catch(e){return i.a.debug("Failed to create answer: ",e),void this.terminate(g.Local,v.CreateAnswer,!0)}try{await this.peerConn.setLocalDescription(t),this.setState(u.Connecting),await new Promise(e=>{setTimeout(e,200)}),this.sendAnswer()}catch(e){return i.a.debug("Error setting local description!",e),void this.terminate(g.Local,v.SetLocalDescription,!0)}}),s()(this,"gotLocalIceCandidate",e=>{if(e.candidate){if(i.a.debug("Call "+this.callId+" got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),this.callHasEnded())return;""===e.candidate.candidate&&this.sentEndOfCandidates||(this.queueCandidate(e.candidate),""===e.candidate.candidate&&(this.sentEndOfCandidates=!0))}}),s()(this,"onIceGatheringStateChange",e=>{if(i.a.debug("ice gathering state changed to "+this.peerConn.iceGatheringState),"complete"===this.peerConn.iceGatheringState&&!this.sentEndOfCandidates){const e={candidate:""};this.queueCandidate(e),this.sentEndOfCandidates=!0}}),s()(this,"gotLocalOffer",async e=>{if(i.a.debug("Created offer: ",e),this.callHasEnded())return void i.a.debug("Ignoring newly created offer on call ID "+this.callId+" because the call has ended");try{await this.peerConn.setLocalDescription(e)}catch(e){return i.a.debug("Error setting local description!",e),void this.terminate(g.Local,v.SetLocalDescription,!0)}if("gathering"===this.peerConn.iceGatheringState&&await new Promise(e=>{setTimeout(e,200)}),this.callHasEnded())return;const t=this.state===u.CreateOffer?l.a.CallInvite:l.a.CallNegotiate,a={lifetime:6e4};this.state===u.CreateOffer?a.offer=this.peerConn.localDescription:a.description=this.peerConn.localDescription,this.client.supportsCallTransfer&&(a.capabilities={"m.call.transferee":!0}),i.a.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in offer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(t,a)}catch(e){i.a.error("Failed to send invite",e),e.event&&this.client.cancelPendingEvent(e.event);let t=v.SignallingFailed,a="Signalling failed";return this.state===u.CreateOffer&&(t=v.SendInvite,a="Failed to send invite"),"UnknownDeviceError"==e.name&&(t=v.UnknownDevices,a="Unknown devices present in the room"),this.emit(f.Error,new E(t,a,e)),void this.terminate(g.Local,t,!1)}this.sendCandidateQueue(),this.state===u.CreateOffer&&(this.inviteOrAnswerSent=!0,this.setState(u.InviteSent),this.inviteTimeout=setTimeout(()=>{this.inviteTimeout=null,this.state===u.InviteSent&&this.hangup(v.InviteTimeout,!1)},6e4))}),s()(this,"getLocalOfferFailed",e=>{i.a.error("Failed to get local offer",e),this.emit(f.Error,new E(v.LocalOfferFailed,"Failed to get local offer!",e)),this.terminate(g.Local,v.LocalOfferFailed,!1)}),s()(this,"getUserMediaFailed",e=>{this.successor?this.successor.getUserMediaFailed(e):(i.a.warn("Failed to get user media - ending call",e),this.emit(f.Error,new E(v.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),this.terminate(g.Local,v.NoUserMedia,!1))}),s()(this,"onIceConnectionStateChanged",()=>{this.callHasEnded()||(i.a.debug("Call ID "+this.callId+": ICE connection state changed to: "+this.peerConn.iceConnectionState),"connected"==this.peerConn.iceConnectionState?this.setState(u.Connected):"failed"==this.peerConn.iceConnectionState&&this.hangup(v.IceFailed,!1))}),s()(this,"onSignallingStateChanged",()=>{i.a.debug("call "+this.callId+": Signalling state changed to: "+this.peerConn.signalingState)}),s()(this,"onTrack",e=>{var t;if(0===e.streams.length)return void i.a.warn(`Streamless ${e.track.kind} found: ignoring.`);const a=null===(t=this.feeds.find(e=>!e.isLocal()))||void 0===t?void 0:t.stream;if(a&&e.streams[0].id!==a.id)return void i.a.warn(`Ignoring new stream ID ${e.streams[0].id}: we already have stream ID ${a.id}`);a||i.a.info("Got remote stream with id "+e.streams[0].id);const n=e.streams[0];i.a.debug(`Track id ${e.track.id} of kind ${e.track.kind} added`),this.pushNewFeed(n,this.getOpponentMember().userId,d.Usermedia),i.a.info("playing remote. stream active? "+n.active)}),s()(this,"onNegotiationNeeded",async()=>{if(i.a.info("Negotation is needed!"),this.state===u.CreateOffer||0!==this.opponentVersion){this.makingOffer=!0;try{const e=await this.peerConn.createOffer();await this.gotLocalOffer(e)}catch(e){return void this.getLocalOfferFailed(e)}finally{this.makingOffer=!1}}else i.a.info("Opponent does not support renegotiation: ignoring negotiationneeded event")}),s()(this,"onHangupReceived",e=>{i.a.debug("Hangup received for call ID "+this.callId),this.partyIdMatches(e)||this.state===u.Ringing?this.terminate(g.Remote,e.reason||v.UserHangup,!0):i.a.info(`Ignoring message from party ID ${e.party_id}: our partner is ${this.opponentPartyId}`)}),s()(this,"onRejectReceived",e=>{i.a.debug("Reject received for call ID "+this.callId);[u.InviteSent,u.Ringing].includes(this.state)||this.state===u.Fledgling&&this.direction===p.Inbound?this.terminate(g.Remote,e.reason||v.UserHangup,!0):i.a.debug(`Call is in state: ${this.state}: ignoring reject`)}),s()(this,"onAnsweredElsewhere",e=>{i.a.debug("Call ID "+this.callId+" answered elsewhere"),this.terminate(g.Remote,v.AnsweredElsewhere,!0)}),this.roomId=e.roomId,this.client=e.client,this.type=null,this.forceTURN=e.forceTURN,this.ourPartyId=this.client.deviceId,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:["stun:turn.matrix.org"]});for(const e of this.turnServers)r.a(e,["urls"]);this.callId=_(),this.state=u.Fledgling,this.candidateSendQueue=[],this.candidateSendTries=0,this.sentEndOfCandidates=!1,this.inviteOrAnswerSent=!1,this.makingOffer=!1,this.remoteOnHold=!1,this.unholdingRemote=!1,this.micMuted=!1,this.vidMuted=!1,this.feeds=[]}async placeVoiceCall(){i.a.debug("placeVoiceCall"),this.checkForErrorListener();const e=w(b.Audio);this.type=h.Voice,await this.placeCallWithConstraints(e)}async placeVideoCall(){i.a.debug("placeVideoCall"),this.checkForErrorListener();const e=w(b.Video);this.type=h.Video,await this.placeCallWithConstraints(e)}async placeScreenSharingCall(e){i.a.debug("placeScreenSharingCall"),this.checkForErrorListener();try{var t;const a=await async function(e){var t;if(null!==(t=window.electron)&&void 0!==t&&t.getDesktopCapturerSources&&e){i.a.debug("Electron getDesktopCapturerSources() is available...");const t=await e();return t?{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t.id}}}:null}return i.a.debug("Electron desktopCapturer is not available..."),{audio:!1,video:!0}}(e);if(!a)return void this.terminate(g.Local,v.NoUserMedia,!1);null!==(t=window.electron)&&void 0!==t&&t.getDesktopCapturerSources?(i.a.debug("Getting screen stream using getUserMedia()..."),this.screenSharingStream=await navigator.mediaDevices.getUserMedia(a)):(i.a.debug("Getting screen stream using getDisplayMedia()..."),this.screenSharingStream=await navigator.mediaDevices.getDisplayMedia(a)),i.a.debug("Got screen stream, requesting audio stream...");const n=w(b.Audio);this.placeCallWithConstraints(n)}catch(e){this.emit(f.Error,new E(v.NoUserMedia,"Failed to get screen-sharing stream: ",e)),this.terminate(g.Local,v.NoUserMedia,!1)}this.type=h.Video}getOpponentMember(){return this.opponentMember}opponentCanBeTransferred(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter(e=>e.isLocal())}getRemoteFeeds(){return this.feeds.filter(e=>!e.isLocal())}noIncomingFeeds(){return!this.feeds.some(e=>!e.isLocal())}pushNewFeed(e,t,a){const n=this.feeds.find(t=>t.stream.id===e.id);n?n.setNewStream(e):(this.feeds.push(new m.a(e,t,a,this.client,this.roomId)),this.emit(f.FeedsChanged,this.feeds))}deleteAllFeeds(){this.feeds=[],this.emit(f.FeedsChanged,this.feeds)}async getCurrentCallStats(){return this.callHasEnded()?this.callStatsAtEnd:this.collectCallStats()}async collectCallStats(){if(!this.peerConn)return;const e=await this.peerConn.getStats(),t=[];for(const a of e)t.push(a[1]);return t}async initWithInvite(e){var t;const a=e.getContent();this.direction=p.Inbound;await this.client.checkTurnServers()||i.a.warn("Failed to get TURN credentials! Proceeding with call anyway..."),this.peerConn=this.createPeerConnection(),this.chooseOpponent(e);try{await this.peerConn.setRemoteDescription(a.offer),await this.addBufferedIceCandidates()}catch(e){return i.a.debug("Failed to set remote description",e),void this.terminate(g.Local,v.SetRemoteDescription,!1)}const n=null===(t=this.feeds.find(e=>!e.isLocal()))||void 0===t?void 0:t.stream;if(!n||0===n.getTracks().length)return i.a.error("No remote stream or no tracks after setting remote description!"),void this.terminate(g.Local,v.SetRemoteDescription,!1);this.type=n.getTracks().some(e=>"video"===e.kind)?h.Video:h.Voice,this.setState(u.Ringing),e.getLocalAge()&&setTimeout(()=>{this.state==u.Ringing&&(i.a.debug("Call invite has expired. Hanging up."),this.hangupParty=g.Remote,this.setState(u.Ended),this.stopAllMedia(),"closed"!=this.peerConn.signalingState&&this.peerConn.close(),this.emit(f.Hangup))},a.lifetime-e.getLocalAge())}initWithHangup(e){this.setState(u.Ended)}async answer(){if(!this.inviteOrAnswerSent)if(i.a.debug(`Answering call ${this.callId} of type ${this.type}`),this.localAVStream||this.waitForLocalAVStream)this.localAVStream?this.gotUserMediaForAnswer(this.localAVStream):this.waitForLocalAVStream&&this.setState(u.WaitLocalMedia);else{const e=w(this.type==h.Video?b.Video:b.Audio);i.a.log("Getting user media with constraints",e),this.setState(u.WaitLocalMedia),this.waitForLocalAVStream=!0;try{const t=await navigator.mediaDevices.getUserMedia(e);this.waitForLocalAVStream=!1,this.gotUserMediaForAnswer(t)}catch(e){return void this.getUserMediaFailed(e)}}}replacedBy(e){i.a.debug(this.callId+" being replaced by "+e.callId),this.state===u.WaitLocalMedia?(i.a.debug("Telling new call to wait for local media"),e.waitForLocalAVStream=!0):(this.state===u.CreateOffer||this.state===u.InviteSent)&&(i.a.debug("Handing local stream to new call"),e.gotUserMediaForAnswer(this.localAVStream),delete this.localAVStream),this.successor=e,this.emit(f.Replaced,e),this.hangup(v.Replaced,!0)}hangup(e,t){if(this.callHasEnded())return;if(i.a.debug("Ending call "+this.callId),this.terminate(g.Local,e,!t),this.state===u.WaitLocalMedia)return;const a={};e!==v.UserHangup&&(a.reason=e),this.sendVoipEvent(l.a.CallHangup,a)}reject(){if(this.state!==u.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion<1)return i.a.info(`Opponent version is less than 1 (${this.opponentVersion}): sending hangup instead of reject`),void this.hangup(v.UserHangup,!0);i.a.debug("Rejecting call: "+this.callId),this.terminate(g.Local,v.UserHangup,!0),this.sendVoipEvent(l.a.CallReject,{})}setLocalVideoMuted(e){this.vidMuted=e,this.updateMuteStatus()}isLocalVideoMuted(){return this.vidMuted}setMicrophoneMuted(e){this.micMuted=e,this.updateMuteStatus()}isMicrophoneMuted(){return this.micMuted}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e,e||(this.unholdingRemote=!0);for(const t of this.peerConn.getTransceivers())t.direction=e?"inactive":"sendrecv";this.updateMuteStatus(),this.emit(f.RemoteHoldUnhold,this.remoteOnHold)}}isLocalOnHold(){if(this.state!==u.Connected)return!1;if(this.unholdingRemote)return!1;let e=!0;for(const t of this.peerConn.getTransceivers()){["inactive","recvonly"].includes(t.currentDirection)||(e=!1)}return e}sendDtmfDigit(e){for(const t of this.peerConn.getSenders())if("audio"===t.track.kind&&t.dtmf)return void t.dtmf.insertDTMF(e);throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){if(!this.localAVStream)return;const e=this.micMuted||this.remoteOnHold;C(this.localAVStream.getAudioTracks(),!e);const t=this.vidMuted||this.remoteOnHold;C(this.localAVStream.getVideoTracks(),!t)}async sendAnswer(){const e={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type}};this.client.supportsCallTransfer&&(e.capabilities={"m.call.transferee":!0}),i.a.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in answer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(l.a.CallAnswer,e),this.inviteOrAnswerSent=!0}catch(e){this.setState(u.Ringing),this.client.cancelPendingEvent(e.event);let t=v.SendAnswer,a="Failed to send answer";throw"UnknownDeviceError"==e.name&&(t=v.UnknownDevices,a="Unknown devices present in the room"),this.emit(f.Error,new E(t,a,e)),e}this.sendCandidateQueue()}async onRemoteIceCandidatesReceived(e){if(this.callHasEnded())return;const t=e.getContent().candidates;if(!t)return void i.a.info("Ignoring candidates event with no candidates!");const a=0===e.getContent().version?null:e.getContent().party_id||null;if(void 0===this.opponentPartyId){i.a.info(`Bufferring ${t.length} candidates until we pick an opponent`);const e=this.remoteCandidateBuffer.get(a)||[];return e.push(...t),void this.remoteCandidateBuffer.set(a,e)}this.partyIdMatches(e.getContent())?await this.addIceCandidates(t):i.a.info(`Ignoring candidates from party ID ${e.getContent().party_id}: we have chosen party ID `+this.opponentPartyId)}async onAnswerReceived(e){if(i.a.debug(`Got answer for call ID ${this.callId} from party ID ${e.getContent().party_id}`),this.callHasEnded())i.a.debug(`Ignoring answer because call ID ${this.callId} has ended`);else if(void 0===this.opponentPartyId){this.chooseOpponent(e),await this.addBufferedIceCandidates(),this.setState(u.Connecting);try{await this.peerConn.setRemoteDescription(e.getContent().answer)}catch(e){return i.a.debug("Failed to set remote description",e),void this.terminate(g.Local,v.SetRemoteDescription,!1)}if(null!==this.opponentPartyId)try{await this.sendVoipEvent(l.a.CallSelectAnswer,{selected_party_id:this.opponentPartyId})}catch(e){i.a.warn("Failed to send select_answer event",e)}}else i.a.info(`Ignoring answer from party ID ${e.getContent().party_id}: we already have an answer/reject from `+this.opponentPartyId)}async onSelectAnswerReceived(e){if(this.direction!==p.Inbound)return void i.a.warn("Got select_answer for an outbound call: ignoring");const t=e.getContent().selected_party_id;null!=t?t!==this.ourPartyId&&(i.a.info(`Got select_answer for party ID ${t}: we are party ID ${this.ourPartyId}.`),this.terminate(g.Remote,v.AnsweredElsewhere,!0)):i.a.warn("Got nonsensical select_answer with null/undefined selected_party_id: ignoring")}async onNegotiateReceived(e){const t=e.getContent().description;if(!t||!t.sdp||!t.type)return void i.a.info("Ignoring invalid m.call.negotiate event");const a=this.direction===p.Inbound,n="offer"===t.type&&(this.makingOffer||"stable"!=this.peerConn.signalingState);if(this.ignoreOffer=!a&&n,this.ignoreOffer)return void i.a.info("Ignoring colliding negotiate event because we're impolite");const s=this.isLocalOnHold();"answer"===t.type&&(this.unholdingRemote=!1);try{if(await this.peerConn.setRemoteDescription(t),"offer"===t.type){const e=await this.peerConn.createAnswer();await this.peerConn.setLocalDescription(e),this.sendVoipEvent(l.a.CallNegotiate,{description:this.peerConn.localDescription})}}catch(e){i.a.warn("Failed to complete negotiation",e)}const o=this.isLocalOnHold();s!==o&&(this.emit(f.LocalHoldUnhold,o),this.emit(f.HoldUnhold,o))}async onAssertedIdentityReceived(e){e.getContent().asserted_identity&&(this.remoteAssertedIdentity={id:e.getContent().asserted_identity.id,displayName:e.getContent().asserted_identity.display_name},this.emit(f.AssertedIdentityChanged))}callHasEnded(){return this.state===u.Ended}setState(e){const t=this.state;this.state=e,this.emit(f.State,e,t)}sendVoipEvent(e,t){return this.client.sendEvent(this.roomId,e,Object.assign({},t,{version:1,call_id:this.callId,party_id:this.ourPartyId}))}queueCandidate(e){if(this.candidateSendQueue.push(e),this.state===u.Ringing||!this.inviteOrAnswerSent)return;const t=this.direction===p.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout(()=>{this.sendCandidateQueue()},t)}async transfer(e){const t=await this.client.getProfileInfo(e),a=_(),n={replacement_id:_(),target_user:{id:e,display_name:t.display_name,avatar_url:t.avatar_url},create_call:a};await this.sendVoipEvent(l.a.CallReplaces,n),await this.terminate(g.Local,v.Replaced,!0)}async transferToCall(e){const t=await this.client.getProfileInfo(e.getOpponentMember().userId),a=await this.client.getProfileInfo(this.getOpponentMember().userId),n=_(),s={replacement_id:_(),target_user:{id:this.getOpponentMember().userId,display_name:a.display_name,avatar_url:a.avatar_url},await_call:n};await e.sendVoipEvent(l.a.CallReplaces,s);const i={replacement_id:_(),target_user:{id:e.getOpponentMember().userId,display_name:t.display_name,avatar_url:t.avatar_url},create_call:n};await this.sendVoipEvent(l.a.CallReplaces,i),await this.terminate(g.Local,v.Replaced,!0),await e.terminate(g.Local,v.Replaced,!0)}async terminate(e,t,a){this.callHasEnded()||(this.callStatsAtEnd=await this.collectCallStats(),this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=null),t!==v.Replaced&&this.stopAllMedia(),this.deleteAllFeeds(),this.hangupParty=e,this.hangupReason=t,this.setState(u.Ended),this.peerConn&&"closed"!==this.peerConn.signalingState&&this.peerConn.close(),a&&this.emit(f.Hangup,this))}stopAllMedia(){i.a.debug(`stopAllMedia (stream=${this.localAVStream})`);for(const e of this.feeds)for(const t of e.stream.getTracks())t.stop()}checkForErrorListener(){if(0===this.listeners("error").length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}async sendCandidateQueue(){if(0===this.candidateSendQueue.length)return;const e=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;const t={candidates:e};i.a.debug("Attempting to send "+e.length+" candidates");try{await this.sendVoipEvent(l.a.CallCandidates,t)}catch(t){if(t.event&&this.client.cancelPendingEvent(t.event),this.candidateSendQueue.push(...e),this.candidateSendTries>5){i.a.debug("Failed to send candidates on attempt "+this.candidateSendTries+". Giving up on this call.",t);const e=v.SignallingFailed,a="Signalling failed";return this.emit(f.Error,new E(e,a,t)),void this.hangup(e,!1)}const a=500*Math.pow(2,this.candidateSendTries);++this.candidateSendTries,i.a.debug("Failed to send candidates. Retrying in "+a+"ms",t),setTimeout(()=>{this.sendCandidateQueue()},a)}}async placeCallWithConstraints(e){i.a.log("Getting user media with constraints",e),this.client.callEventHandler.calls.set(this.callId,this),this.setState(u.WaitLocalMedia),this.direction=p.Outbound,this.config=e;await this.client.checkTurnServers()||i.a.warn("Failed to get TURN credentials! Proceeding with call anyway..."),this.peerConn=this.createPeerConnection();try{const t=await navigator.mediaDevices.getUserMedia(e);this.gotUserMediaForInvite(t)}catch(e){return void this.getUserMediaFailed(e)}}createPeerConnection(){const e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client.iceCandidatePoolSize});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e}partyIdMatches(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){const t=e.getContent();i.a.debug(`Choosing party ID ${t.party_id} for call ID ${this.callId}`),this.opponentVersion=t.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=t.party_id||null,this.opponentCaps=t.capabilities||{},this.opponentMember=e.sender}async addBufferedIceCandidates(){const e=this.remoteCandidateBuffer.get(this.opponentPartyId);e&&(i.a.info(`Adding ${e.length} buffered candidates for opponent ${this.opponentPartyId}`),await this.addIceCandidates(e)),this.remoteCandidateBuffer=null}async addIceCandidates(e){for(const t of e)if(null!==t.sdpMid&&void 0!==t.sdpMid||null!==t.sdpMLineIndex&&void 0!==t.sdpMLineIndex){i.a.debug("Call "+this.callId+" got remote ICE "+t.sdpMid+" candidate: "+t.candidate);try{await this.peerConn.addIceCandidate(t)}catch(e){this.ignoreOffer||i.a.info("Failed to add remote ICE candidate",e)}}else i.a.debug("Ignoring remote ICE candidate with no sdpMid or sdpMLineIndex")}}function C(e,t){for(let a=0;a<e.length;a++)e[a].enabled=t}function w(e){const t=!!navigator.webkitGetUserMedia;switch(e){case b.Audio:return{audio:{deviceId:O?{ideal:O}:void 0},video:!1};case b.Video:return{audio:{deviceId:O?{ideal:O}:void 0},video:{deviceId:x?{ideal:x}:void 0,width:t?{exact:640}:{ideal:640},height:t?{exact:360}:{ideal:360}}}}}let O,x;function R(e){O=e}function k(e){x=e}function I(e,t,a){if("undefined"==typeof window||"undefined"==typeof document)return null;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return i.a.error("WebRTC is not supported in this browser / environment"),null}catch(e){return i.a.error("Exception thrown when trying to access WebRTC",e),null}const n=!!a&&a.forceTURN,s={client:e,roomId:t,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||n},o=new S(s);return e.reEmitter.reEmit(o,Object.values(f)),o}},2397:function(e,t){},2403:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return p}));var n=a(346),s=a(439),i=a(417),o=a(1),r=a(514),l=a(256),c=a(475),d=a(0),m=a(331);function u(e,t){return"FILTER_SYNC_"+e+(t?"_"+t:"")}function h(){d.a.log(...arguments)}function p(e,t){this.client=e,(t=t||{}).initialSyncLimit=void 0===t.initialSyncLimit?8:t.initialSyncLimit,t.resolveInvitesToProfiles=t.resolveInvitesToProfiles||!1,t.pollTimeout=t.pollTimeout||3e4,t.pendingEventOrdering=t.pendingEventOrdering||"chronological",t.canResetEntireTimeline||(t.canResetEntireTimeline=function(e){return!1}),this.opts=t,this._peekRoom=null,this._currentSyncRequest=null,this._syncState=null,this._syncStateData=null,this._catchingUp=!1,this._running=!1,this._keepAliveTimer=null,this._connectionReturnedDefer=null,this._notifEvents=[],this._failedSyncCount=0,this._storeIsInvalid=!1,e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),["Room.timeline","Room.timelineReset"])}function g(e,t){const a=new n.a(t);return e.reEmitter.reEmit(a,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),a}p.prototype.createRoom=function(e){const t=this.client,{timelineSupport:a,unstableClientRelationAggregation:n}=t,i=new s.a(e,t,t.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:a,unstableClientRelationAggregation:n});return t.reEmitter.reEmit(i,["Room.name","Room.timeline","Room.redaction","Room.redactionCancelled","Room.receipt","Room.tags","Room.timelineReset","Room.localEchoUpdated","Room.accountData","Room.myMembership","Room.replaceEvent"]),this._registerStateListeners(i),i},p.prototype.createGroup=function(e){const t=this.client,a=new i.a(e);return t.reEmitter.reEmit(a,["Group.profile","Group.myMembership"]),t.store.storeGroup(a),a},p.prototype._registerStateListeners=function(e){const t=this.client;t.reEmitter.reEmit(e.currentState,["RoomState.events","RoomState.members","RoomState.newMember"]),e.currentState.on("RoomState.newMember",(function(e,a,n){n.user=t.getUser(n.userId),t.reEmitter.reEmit(n,["RoomMember.name","RoomMember.typing","RoomMember.powerLevel","RoomMember.membership"])}))},p.prototype._deregisterStateListeners=function(e){e.currentState.removeAllListeners("RoomState.events"),e.currentState.removeAllListeners("RoomState.members"),e.currentState.removeAllListeners("RoomState.newMember")},p.prototype.syncLeftRooms=function(){const e=this.client,t=this,a=new r.a(this.client.credentials.userId);a.setTimelineLimit(1),a.setIncludeLeaveRooms(!0);const n=this.opts.pollTimeout+8e4,s={timeout:0};return e.getOrCreateFilter(u(e.credentials.userId,"LEFT_ROOMS"),a).then((function(t){return s.filter=t,e.http.authedRequest(void 0,"GET","/sync",s,void 0,n)})).then((function(a){let n=[];a.rooms&&a.rooms.leave&&(n=t._mapSyncResponseToRoomArray(a.rooms.leave));const s=[];return n.forEach((function(a){const n=a.room;if(s.push(n),!a.isBrandNewRoom)return;a.timeline=a.timeline||{};const i=t._mapSyncEventsFormat(a.timeline,n),o=t._mapSyncEventsFormat(a.state,n);n.getLiveTimeline().setPaginationToken(a.timeline.prev_batch,l.a.BACKWARDS),t._processRoomEvents(n,o,i),n.recalculate(),e.store.storeRoom(n),e.emit("Room",n),t._processEventsForNotifs(n,i)})),s}))},p.prototype.peek=function(e){if(this._peekRoom&&this._peekRoom.roomId===e)return Promise.resolve(this._peekRoom);const t=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,20).then(e=>{e.messages=e.messages||{},e.messages.chunk=e.messages.chunk||[],e.state=e.state||[];const a=o.d(e.state).map(t.getEventMapper()),n=e.state.map(t.getEventMapper()),s=e.messages.chunk.map(t.getEventMapper());return e.presence&&Array.isArray(e.presence)&&e.presence.map(t.getEventMapper()).forEach((function(e){let a=t.store.getUser(e.getContent().user_id);a?a.setPresenceEvent(e):(a=g(t,e.getContent().user_id),a.setPresenceEvent(e),t.store.storeUser(a)),t.emit("event",e)})),e.messages.start&&(this._peekRoom.oldState.paginationToken=e.messages.start),this._peekRoom.oldState.setStateEvents(a),this._peekRoom.currentState.setStateEvents(n),this._resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(s.reverse(),!0,this._peekRoom.getLiveTimeline(),e.messages.start),t.store.storeRoom(this._peekRoom),t.emit("Room",this._peekRoom),this._peekPoll(this._peekRoom),this._peekRoom})},p.prototype.stopPeeking=function(){this._peekRoom=null},p.prototype._peekPoll=function(e,t){if(this._peekRoom!==e)return void h("Stopped peeking in room %s",e.roomId);const a=this;this.client.http.authedRequest(void 0,"GET","/events",{room_id:e.roomId,timeout:3e4,from:t},void 0,5e4).then((function(t){if(a._peekRoom!==e)return void h("Stopped peeking in room %s",e.roomId);t.chunk.filter((function(e){return"m.presence"===e.type})).map(a.client.getEventMapper()).forEach((function(e){let t=a.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):(t=g(a.client,e.getContent().user_id),t.setPresenceEvent(e),a.client.store.storeUser(t)),a.client.emit("event",e)}));const n=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(a.client.getEventMapper());e.addLiveEvents(n),a._peekPoll(e,t.end)}),(function(n){d.a.error("[%s] Peek poll failed: %s",e.roomId,n),setTimeout((function(){a._peekPoll(e,t)}),3e4)}))},p.prototype.getSyncState=function(){return this._syncState},p.prototype.getSyncStateData=function(){return this._syncStateData},p.prototype.recoverFromSyncStartupError=async function(e,t){await e;const a=this._startKeepAlives();this._updateSyncState("ERROR",{error:t}),await a},p.prototype._wasLazyLoadingToggled=async function(e){e=!!e;let t=!1;if(!await this.client.store.isNewlyCreated()){const a=await this.client.store.getClientOptions();return a&&(t=!!a.lazyLoadMembers),t!==e}return!1},p.prototype._shouldAbortSync=function(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(d.a.warn("Token no longer valid - assuming logout"),this.stop(),!0)},p.prototype.sync=function(){const t=this.client,a=this;this._running=!0,e.window&&e.window.addEventListener&&(this._onOnlineBound=this._onOnline.bind(this),e.window.addEventListener("online",this._onOnlineBound,!1));let n=Promise.resolve(),s=null;function i(){const e=new r.a(t.credentials.userId);return e.setTimelineLimit(a.opts.initialSyncLimit),e}const o=async()=>{if(h("Checking lazy load status..."),this.opts.lazyLoadMembers&&t.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers){h("Checking server lazy load support...");await t.doesServerSupportLazyLoading()?(h("Enabling lazy load on sync filter..."),this.opts.filter||(this.opts.filter=i()),this.opts.filter.setLazyLoadMembers(!0)):(h("LL: lazy loading requested but not supported by server, so disabling"),this.opts.lazyLoadMembers=!1)}h("Checking whether lazy loading has changed in store...");if(await this._wasLazyLoadingToggled(this.opts.lazyLoadMembers)){this._storeIsInvalid=!0;const e=m.b.TOGGLED_LAZY_LOADING,t=new m.b(e,!!this.opts.lazyLoadMembers);return this._updateSyncState("ERROR",{error:t}),void d.a.warn("InvalidStoreError: store is not usable: stopping sync.")}this.opts.lazyLoadMembers&&this.opts.crypto&&this.opts.crypto.enableLazyLoading();try{h("Storing client options..."),await this.client.storeClientOptions(),h("Stored client options")}catch(e){throw d.a.error("Storing client options failed",e),e}!async function e(){let o,r;h("Getting filter..."),o=a.opts.filter?a.opts.filter:i();try{r=await t.getOrCreateFilter(u(t.credentials.userId),o)}catch(t){if(d.a.error("Getting filter failed",t),a._shouldAbortSync(t))return;return h("Waiting for saved sync before retrying filter..."),await a.recoverFromSyncStartupError(n,t),void e()}t.resetNotifTimelineSet(),null===a._currentSyncRequest&&(h("Sending first sync request..."),a._currentSyncRequest=a._doSyncRequest({filterId:r},s));h("Waiting for saved sync before starting sync processing..."),await n,a._sync({filterId:r})}()};t.isGuest()?a._sync({}):(h("Getting saved sync token..."),n=t.store.getSavedSyncToken().then(e=>(h("Got saved sync token"),s=e,h("Getting saved sync..."),t.store.getSavedSync())).then(e=>{if(h("Got reply from saved sync, exists? "+!!e),e)return a._syncFromCache(e)}).catch(e=>{d.a.error("Getting saved sync failed",e)}),async function e(){try{h("Getting push rules...");const e=await t.getPushRules();h("Got push rules"),t.pushRules=e}catch(t){if(d.a.error("Getting push rules failed",t),a._shouldAbortSync(t))return;return h("Waiting for saved sync before retrying push rules..."),await a.recoverFromSyncStartupError(n,t),void e()}o()}())},p.prototype.stop=function(){h("SyncApi.stop"),e.window&&(e.window.removeEventListener("online",this._onOnlineBound,!1),this._onOnlineBound=void 0),this._running=!1,this._currentSyncRequest&&this._currentSyncRequest.abort(),this._keepAliveTimer&&(clearTimeout(this._keepAliveTimer),this._keepAliveTimer=null)},p.prototype.retryImmediately=function(){return!!this._connectionReturnedDefer&&(this._startKeepAlives(0),!0)},p.prototype._syncFromCache=async function(e){h("sync(): not doing HTTP hit, instead returning stored /sync data");const t=e.nextBatch;this.client.store.setSyncToken(t);const a={oldSyncToken:null,nextSyncToken:t,catchingUp:!1,fromCache:!0},n={next_batch:t,rooms:e.roomsData,groups:e.groupsData,account_data:{events:e.accountData}};try{await this._processSyncResponse(a,n)}catch(e){d.a.error("Error processing cached sync",e.stack||e)}this._storeIsInvalid||this._updateSyncState("PREPARED",a)},p.prototype._sync=async function(e){const t=this.client;if(!this._running)return h("Sync no longer running: exiting."),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),void this._updateSyncState("STOPPED");const a=t.store.getSyncToken();let n;try{null===this._currentSyncRequest&&(this._currentSyncRequest=this._doSyncRequest(e,a)),n=await this._currentSyncRequest}catch(t){return void this._onSyncError(t,e)}finally{this._currentSyncRequest=null}t.store.setSyncToken(n.next_batch),this._failedSyncCount=0,await t.store.setSyncData(n);const s={oldSyncToken:a,nextSyncToken:n.next_batch,catchingUp:this._catchingUp};this.opts.crypto&&await this.opts.crypto.onSyncWillProcess(s);try{await this._processSyncResponse(s,n)}catch(e){d.a.error("Caught /sync error",e.stack||e),this.client.emit("sync.unexpectedError",e)}s.catchingUp=this._catchingUp,e.hasSyncedBefore||(this._updateSyncState("PREPARED",s),e.hasSyncedBefore=!0),this.opts.crypto&&await this.opts.crypto.onSyncCompleted(s),this._updateSyncState("SYNCING",s),t.store.wantsSave()&&(this.opts.crypto&&await this.opts.crypto.saveDeviceList(0),t.store.save()),this._sync(e)},p.prototype._doSyncRequest=function(e,t){const a=this._getSyncParams(e,t);return this.client.http.authedRequest(void 0,"GET","/sync",a,void 0,a.timeout+8e4)},p.prototype._getSyncParams=function(e,t){let a=this.opts.pollTimeout;("SYNCING"!==this.getSyncState()||this._catchingUp)&&(this._catchingUp=!0,a=0);let n=e.filterId;this.client.isGuest()&&!n&&(n=this._getGuestFilter());const s={filter:n,timeout:a};return this.opts.disablePresence&&(s.set_presence="offline"),t?s.since=t:s._cacheBuster=Date.now(),"ERROR"!=this.getSyncState()&&"RECONNECTING"!=this.getSyncState()||(s.timeout=0),s},p.prototype._onSyncError=function(e,t){if(!this._running)return h("Sync no longer running: exiting"),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),void this._updateSyncState("STOPPED");d.a.error("/sync error %s",e),d.a.error(e),this._shouldAbortSync(e)||(this._failedSyncCount++,d.a.log("Number of consecutive failed sync requests:",this._failedSyncCount),h("Starting keep-alive"),this._startKeepAlives().then(e=>{e&&"ERROR"===this.getSyncState()&&this._updateSyncState("CATCHUP",{oldSyncToken:null,nextSyncToken:null,catchingUp:!0}),this._sync(t)}),this._currentSyncRequest=null,this._updateSyncState(this._failedSyncCount>=3?"ERROR":"RECONNECTING",{error:e}))},p.prototype._processSyncResponse=async function(e,t){const a=this.client,n=this;if(t.presence&&Array.isArray(t.presence.events)&&t.presence.events.map(a.getEventMapper()).forEach((function(e){let t=a.store.getUser(e.getSender());t?t.setPresenceEvent(e):(t=g(a,e.getSender()),t.setPresenceEvent(e),a.store.storeUser(t)),a.emit("event",e)})),t.account_data&&Array.isArray(t.account_data.events)){const e=t.account_data.events.map(a.getEventMapper()),n=e.reduce((e,t)=>(e[t.getId()]=a.store.getAccountData(t.getType()),e),{});a.store.storeAccountDataEvents(e),e.forEach((function(e){if("m.push_rules"===e.getType()){const t=e.getContent();a.pushRules=c.a.rewriteDefaultRules(t)}const t=n[e.getId()];return a.emit("accountData",e,t),e}))}if(t.to_device&&Array.isArray(t.to_device.events)&&t.to_device.events.length>0){const e=[];t.to_device.events.map(a.getEventMapper()).map(t=>{if("m.key.verification.cancel"===t.getType()){const a=t.getContent().transaction_id;a&&e.push(a)}return t}).forEach((function(t){const n=t.getContent();if("m.room.message"!=t.getType()||"m.bad.encrypted"!=n.msgtype){if("m.key.verification.start"===t.getType()||"m.key.verification.request"===t.getType()){const a=n.transaction_id;e.includes(a)&&t.flagCancelled()}a.emit("toDeviceEvent",t)}else d.a.log("Ignoring undecryptable to-device event from "+t.getSender())}))}else this._catchingUp=!1;t.groups&&(t.groups.invite&&this._processGroupSyncEntry(t.groups.invite,"invite"),t.groups.join&&this._processGroupSyncEntry(t.groups.join,"join"),t.groups.leave&&this._processGroupSyncEntry(t.groups.leave,"leave"));let s=[],i=[],r=[];if(t.rooms&&(t.rooms.invite&&(s=this._mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(i=this._mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(r=this._mapSyncResponseToRoomArray(t.rooms.leave))),this._notifEvents=[],s.forEach((function(e){const t=e.room,s=n._mapSyncEventsFormat(e.invite_state,t);n._processRoomEvents(t,s),e.isBrandNewRoom&&(t.recalculate(),a.store.storeRoom(t),a.emit("Room",t)),s.forEach((function(e){a.emit("event",e)})),t.updateMyMembership("invite")})),await o.s(i,(async function(t){const s=t.room,i=n._mapSyncEventsFormat(t.state,s),r=n._mapSyncEventsFormat(t.timeline,s,!1),c=n._mapSyncEventsFormat(t.ephemeral),d=n._mapSyncEventsFormat(t.account_data),m=a.isRoomEncrypted(s.roomId);if(t.unread_notifications&&(s.setUnreadNotificationCount("total",t.unread_notifications.notification_count),(!m||m&&s.getUnreadNotificationCount("highlight")<=0)&&s.setUnreadNotificationCount("highlight",t.unread_notifications.highlight_count)),t.timeline=t.timeline||{},t.isBrandNewRoom)s.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,l.a.BACKWARDS);else if(t.timeline.limited){let i=!0;for(let e=r.length-1;e>=0;e--){const t=r[e].getId();if(s.getTimelineForEvent(t)){h("Already have event "+t+" in limited sync - not resetting"),i=!1,r.splice(0,e);break}}i&&(n._deregisterStateListeners(s),s.resetLiveTimeline(t.timeline.prev_batch,n.opts.canResetEntireTimeline(s.roomId)?null:e.oldSyncToken),a.resetNotifTimelineSet(),n._registerStateListeners(s))}async function u(e){if(a.emit("event",e),e.isState()&&"m.room.encryption"==e.getType()&&n.opts.crypto&&await n.opts.crypto.onCryptoEvent(e),e.isState()&&"im.vector.user_status"===e.getType()){let t=a.store.getUser(e.getStateKey());t?t._unstable_updateStatusMessage(e):(t=g(a,e.getStateKey()),t._unstable_updateStatusMessage(e),a.store.storeUser(t))}}n._processRoomEvents(s,i,r,e.fromCache),t.summary&&s.setSummary(t.summary),s.addEphemeralEvents(c),s.addAccountData(d),s.recalculate(),t.isBrandNewRoom&&(a.store.storeRoom(s),a.emit("Room",s)),n._processEventsForNotifs(s,r),await o.s(i,u),await o.s(r,u),c.forEach((function(e){a.emit("event",e)})),d.forEach((function(e){a.emit("event",e)})),s.updateMyMembership("join"),s.decryptCriticalEvents()})),r.forEach((function(e){const t=e.room,s=n._mapSyncEventsFormat(e.state,t),i=n._mapSyncEventsFormat(e.timeline,t),o=n._mapSyncEventsFormat(e.account_data);n._processRoomEvents(t,s,i),t.addAccountData(o),t.recalculate(),e.isBrandNewRoom&&(a.store.storeRoom(t),a.emit("Room",t)),n._processEventsForNotifs(t,i),s.forEach((function(e){a.emit("event",e)})),i.forEach((function(e){a.emit("event",e)})),o.forEach((function(e){a.emit("event",e)})),t.updateMyMembership("leave")})),e.oldSyncToken&&this._notifEvents.length&&(this._notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this._notifEvents.forEach((function(e){a.getNotifTimelineSet().addLiveEvent(e)}))),t.device_lists&&this.opts.crypto&&await this.opts.crypto.handleDeviceListChanges(e,t.device_lists),this.opts.crypto&&t.device_one_time_keys_count){const e=t.device_one_time_keys_count.signed_curve25519||0;this.opts.crypto.updateOneTimeKeyCount(e)}if(this.opts.crypto&&t["org.matrix.msc2732.device_unused_fallback_key_types"]){const e=t["org.matrix.msc2732.device_unused_fallback_key_types"];this.opts.crypto.setNeedsNewFallback(e instanceof Array&&!e.includes("signed_curve25519"))}},p.prototype._startKeepAlives=function(e){void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this._keepAliveTimer&&clearTimeout(this._keepAliveTimer);const t=this;return e>0?t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t),e):t._pokeKeepAlive(),this._connectionReturnedDefer||(this._connectionReturnedDefer=o.e()),this._connectionReturnedDefer.promise},p.prototype._pokeKeepAlive=function(e){void 0===e&&(e=!1);const t=this;function a(){clearTimeout(t._keepAliveTimer),t._connectionReturnedDefer&&(t._connectionReturnedDefer.resolve(e),t._connectionReturnedDefer=null)}this.client.http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3}).then((function(){a()}),(function(n){400==n.httpStatus||404==n.httpStatus?t._keepAliveTimer=setTimeout(a,2e3):(e=!0,t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t,e),5e3+Math.floor(5e3*Math.random())),t._updateSyncState("ERROR",{error:n}))}))},p.prototype._processGroupSyncEntry=function(e,t){for(const a of Object.keys(e)){const n=e[a];let s=this.client.store.getGroup(a);const i=null===s;null===s&&(s=this.createGroup(a)),n.profile&&s.setProfile(n.profile.name,n.profile.avatar_url),n.inviter&&s.setInviter({userId:n.inviter}),s.setMyMembership(t),i&&this.client.emit("Group",s)}},p.prototype._mapSyncResponseToRoomArray=function(e){const t=this.client,a=this;return Object.keys(e).map((function(n){const s=e[n];let i=t.store.getRoom(n),o=!1;return i||(i=a.createRoom(n),o=!0),s.room=i,s.isBrandNewRoom=o,s}))},p.prototype._mapSyncEventsFormat=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!Array.isArray(e.events))return[];const n=this.client.getEventMapper({decrypt:a});return e.events.map((function(e){return t&&(e.room_id=t.roomId),n(e)}))},p.prototype._resolveInvites=function(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(a){if(a._requestedProfileInfo)return;a._requestedProfileInfo=!0;const n=t.getUser(a.userId);let s;s=n?Promise.resolve({avatar_url:n.avatarUrl,displayname:n.displayName}):t.getProfileInfo(a.userId),s.then((function(t){const n=a.events.member;"invite"===n.getContent().membership&&(n.getContent().avatar_url=t.avatar_url,n.getContent().displayname=t.displayname,a.setMembershipEvent(n,e.currentState))}),(function(e){}))}))},p.prototype._processRoomEvents=function(e,t,a,n){const s=e.getLiveTimeline(),i=0==s.getEvents().length;if(i){for(const e of t)this.client.getPushActionsForEvent(e);s.initialiseState(t)}this._resolveInvites(e),e.recalculate(),i||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(a||[],null,n)},p.prototype._processEventsForNotifs=function(e,t){if(this.client.getNotifTimelineSet())for(let e=0;e<t.length;e++){const a=this.client.getPushActionsForEvent(t[e]);a&&a.notify&&a.tweaks&&a.tweaks.highlight&&this._notifEvents.push(t[e])}},p.prototype._getGuestFilter=function(){return"{}"},p.prototype._updateSyncState=function(e,t){const a=this._syncState;this._syncState=e,this._syncStateData=t,this.client.emit("sync",this._syncState,a,t)},p.prototype._onOnline=function(){h("Browser thinks we are back online"),this._startKeepAlives(0)}}).call(this,a(7))},2404:function(e,t,a){"use strict";function n(){this.fromToken=null}a.d(t,"a",(function(){return n})),n.prototype={isNewlyCreated:function(){return Promise.resolve(!0)},getSyncToken:function(){return this.fromToken},setSyncToken:function(e){this.fromToken=e},storeGroup:function(e){},getGroup:function(e){return null},getGroups:function(){return[]},storeRoom:function(e){},getRoom:function(e){return null},getRooms:function(){return[]},removeRoom:function(e){},getRoomSummaries:function(){return[]},storeUser:function(e){},getUser:function(e){return null},getUsers:function(){return[]},scrollback:function(e,t){return[]},storeEvents:function(e,t,a,n){},storeFilter:function(e){},getFilter:function(e,t){return null},getFilterIdByName:function(e){return null},setFilterIdByName:function(e,t){},storeAccountDataEvents:function(e){},getAccountData:function(e){},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return Promise.resolve()},getOutOfBandMembers:function(){return Promise.resolve(null)},setOutOfBandMembers:function(){return Promise.resolve()},clearOutOfBandMembers:function(){return Promise.resolve()},getClientOptions:function(){return Promise.resolve()},storeClientOptions:function(){return Promise.resolve()}}},2405:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(258),s=a.n(n),i=a(0),o=a(238),r=a(140);class l{constructor(e){s()(this,"client",void 0),s()(this,"calls",void 0),s()(this,"callEventBuffer",void 0),s()(this,"candidateEventsByCall",void 0),s()(this,"evaluateEventBuffer",async()=>{if("SYNCING"===this.client.getSyncState()){await Promise.all(this.callEventBuffer.map(e=>{this.client.decryptEventIfNeeded(e)}));const e=new Set;for(const t of this.callEventBuffer)t.getType()!==r.a.CallAnswer&&t.getType()!==r.a.CallHangup||e.add(t.getContent().call_id);for(const t of this.callEventBuffer)if(t.getType()!==r.a.CallInvite||!e.has(t.getContent().call_id))try{this.handleCallEvent(t)}catch(e){i.a.error("Caught exception handling call event",e)}this.callEventBuffer=[]}}),s()(this,"onEvent",e=>{this.client.decryptEventIfNeeded(e),(this.eventIsACall(e)||e.isBeingDecrypted())&&this.callEventBuffer.push(e),(e.isBeingDecrypted()||e.isDecryptionFailure())&&e.once("Event.decrypted",()=>{if(this.eventIsACall(e))if(this.callEventBuffer.includes(e))this.evaluateEventBuffer();else try{this.handleCallEvent(e)}catch(e){i.a.error("Caught exception handling call event",e)}})}),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on("sync",this.evaluateEventBuffer),this.client.on("event",this.onEvent)}stop(){this.client.removeListener("sync",this.evaluateEventBuffer),this.client.removeListener("event",this.onEvent)}eventIsACall(e){const t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")}handleCallEvent(e){const t=e.getContent();let a=t.call_id?this.calls.get(t.call_id):void 0;if(e.getType()===r.a.CallInvite){if(e.getSender()===this.client.credentials.userId)return;if(e.getLocalAge()>t.lifetime-3e3)return;if(a&&a.state===o.e.Ended)return;a&&i.a.log(`WARN: Already have a MatrixCall with id ${t.call_id} but got an invite. Clobbering.`);const n=this.client.getTurnServersExpiry()-Date.now();if(i.a.info("Current turn creds expire in "+n+" ms"),a=Object(o.g)(this.client,e.getRoomId(),{forceTURN:this.client.forceTURN}),!a)return void i.a.log("Incoming call ID "+t.call_id+" but this client doesn't support WebRTC");if(a.callId=t.call_id,a.initWithInvite(e),this.calls.set(a.callId,a),this.candidateEventsByCall.get(a.callId))for(const e of this.candidateEventsByCall.get(a.callId))a.onRemoteIceCandidatesReceived(e);let s;for(const e of this.calls.values()){const t=[o.e.WaitLocalMedia,o.e.CreateOffer,o.e.InviteSent].includes(e.state);if(a.roomId===e.roomId&&e.direction===o.a.Outbound&&t){s=e;break}}s?s.state===o.e.WaitLocalMedia||s.state===o.e.CreateOffer||s.callId>a.callId?(i.a.log("Glare detected: answering incoming call "+a.callId+" and canceling outgoing call "+s.callId),s.replacedBy(a),a.answer()):(i.a.log("Glare detected: rejecting incoming call "+a.callId+" and keeping outgoing call "+s.callId),a.hangup(o.b.Replaced,!0)):this.client.emit("Call.incoming",a)}else if(e.getType()===r.a.CallAnswer){if(!a)return;e.getSender()===this.client.credentials.userId?a.state===o.e.Ringing&&a.onAnsweredElsewhere(t):a.onAnswerReceived(e)}else if(e.getType()===r.a.CallCandidates){if(e.getSender()===this.client.credentials.userId)return;a?a.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(t.call_id)||this.candidateEventsByCall.set(t.call_id,[]),this.candidateEventsByCall.get(t.call_id).push(e))}else if([r.a.CallHangup,r.a.CallReject].includes(e.getType()))a?a.state!==o.e.Ended&&(e.getType()===r.a.CallHangup?a.onHangupReceived(t):a.onRejectReceived(t),this.calls.delete(t.call_id)):(a=Object(o.g)(this.client,e.getRoomId()),a&&(a.callId=t.call_id,a.initWithHangup(e),this.calls.set(t.call_id,a)));else if(e.getType()===r.a.CallSelectAnswer){if(!a)return;if(e.getContent().party_id===a.ourPartyId)return;a.onSelectAnswerReceived(e)}else if(e.getType()===r.a.CallNegotiate){if(!a)return;if(e.getContent().party_id===a.ourPartyId)return;a.onNegotiateReceived(e)}else if(e.getType()===r.a.CallAssertedIdentity||e.getType()===r.a.CallAssertedIdentityPrefix){if(!a)return;if(e.getContent().party_id===a.ourPartyId)return;a.onAssertedIdentityReceived(e)}}}},2407:function(e,t,a){"use strict";(function(e){a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c}));var n=a(0);let s,i=0;const o=[];let r=Date.now;function l(e,t){(t=t||0)<0&&(t=0);const a=Array.prototype.slice.call(arguments,2),n=r()+t,s=i++,l={runAt:n,func:e,params:a,key:s},c=u(o,(function(e){return e.runAt-n}));return o.splice(c,0,l),d(),s}function c(e){if(0===o.length)return;let t;for(t=0;t<o.length;t++){if(o[t].key==e){o.splice(t,1);break}}0===t&&d()}function d(){s&&e.clearTimeout(s);const t=o[0];if(!t)return;const a=r(),n=Math.min(t.runAt-a,1e3);s=e.setTimeout(m,n)}function m(){let t;const a=r(),s=[];for(;;){const e=o[0];if(!e||e.runAt>a)break;t=o.shift(),t.key,s.push(t)}d();for(let a=0;a<s.length;a++){t=s[a];try{t.func.apply(e,t.params)}catch(e){n.a.error("Uncaught exception in callback function",e.stack||e)}}}function u(e,t){let a=0,n=e.length;for(;a<n;){const s=a+n>>1;t(e[s])>0?n=s:a=s+1}return a}}).call(this,a(7))},2408:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(246);class s{constructor(e){this._cryptoStore=e,this._roomEncryption={}}async init(){await this._cryptoStore.doTxn("readwrite",[n.a.STORE_ROOMS],e=>{this._cryptoStore.getEndToEndRooms(e,e=>{this._roomEncryption=e})})}getRoomEncryption(e){return this._roomEncryption[e]||null}isRoomEncrypted(e){return Boolean(this.getRoomEncryption(e))}async setRoomEncryption(e,t){this._roomEncryption[e]=t,await this._cryptoStore.doTxn("readwrite",[n.a.STORE_ROOMS],a=>{this._cryptoStore.storeEndToEndRoom(e,t,a)})}}},2409:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return r}));var n=a(0),s=a(1);const i=10;class o{constructor(e){this._db=e,this._nextTxnId=0,e.onversionchange=t=>{n.a.log(`versionchange for indexeddb ${this._dbName}: closing`),e.close()}}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return new Promise((a,s)=>{const i=this._db.transaction("outgoingRoomKeyRequests","readwrite");i.onerror=s,this._getOutgoingRoomKeyRequest(i,t,s=>{if(s)return n.a.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),void a(s);n.a.log(`enqueueing key request for ${t.room_id} / `+t.session_id),i.oncomplete=()=>{a(e)};i.objectStore("outgoingRoomKeyRequests").add(e)})})}getOutgoingRoomKeyRequest(e){return new Promise((t,a)=>{const n=this._db.transaction("outgoingRoomKeyRequests","readonly");n.onerror=a,this._getOutgoingRoomKeyRequest(n,e,e=>{t(e)})})}_getOutgoingRoomKeyRequest(e,t,a){e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]).onsuccess=e=>{const n=e.target.result;if(!n)return void a(null);const i=n.value;s.c(i.requestBody,t)?a(i):n.continue()}}getOutgoingRoomKeyRequestByState(e){if(0===e.length)return Promise.resolve(null);let t,a=0;const n=this._db.transaction("outgoingRoomKeyRequests","readonly"),s=n.objectStore("outgoingRoomKeyRequests"),i=e[a];return s.index("state").openCursor(i).onsuccess=function n(s){const i=s.target.result;if(i)return void(t=i.value);if(a++,a>=e.length)return;const o=e[a];s.target.source.openCursor(o).onsuccess=n},c(n).then(()=>t)}getAllOutgoingRoomKeyRequestsByState(e){return new Promise((t,a)=>{const n=this._db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);n.onsuccess=e=>t(e.target.result),n.onerror=e=>a(e.target.error)})}getOutgoingRoomKeyRequestsByTarget(e,t,a){let n=0;const s=[];const i=this._db.transaction("outgoingRoomKeyRequests","readonly"),o=i.objectStore("outgoingRoomKeyRequests"),r=a[n];return o.index("state").openCursor(r).onsuccess=function i(o){const r=o.target.result;if(r){const a=r.value;a.recipients.includes({userId:e,deviceId:t})&&s.push(a),r.continue()}else{if(n++,n>=a.length)return;const e=a[n];o.target.source.openCursor(e).onsuccess=i}},c(i).then(()=>s)}updateOutgoingRoomKeyRequest(e,t,a){let s=null;const i=this._db.transaction("outgoingRoomKeyRequests","readwrite");return i.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(e){const i=e.target.result;if(!i)return;const o=i.value;o.state==t?(Object.assign(o,a),i.update(o),s=o):n.a.warn(`Cannot update room key request from ${t} as it was already updated to `+o.state)},c(i).then(()=>s)}deleteOutgoingRoomKeyRequest(e,t){const a=this._db.transaction("outgoingRoomKeyRequests","readwrite");return a.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=e=>{const a=e.target.result;if(!a)return;const s=a.value;s.state==t?a.delete():n.a.warn(`Cannot delete room key request in state ${s.state} (expected ${t})`)},c(a)}getAccount(e,t){const a=e.objectStore("account").get("-");a.onsuccess=function(){try{t(a.result||null)}catch(t){l(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){const a=e.objectStore("account").get("crossSigningKeys");a.onsuccess=function(){try{t(a.result||null)}catch(t){l(e,t)}}}getSecretStorePrivateKey(e,t,a){const n=e.objectStore("account").get("ssss_cache:"+a);n.onsuccess=function(){try{t(n.result||null)}catch(t){l(e,t)}}}storeCrossSigningKeys(e,t){e.objectStore("account").put(t,"crossSigningKeys")}storeSecretStorePrivateKey(e,t,a){e.objectStore("account").put(a,"ssss_cache:"+t)}countEndToEndSessions(e,t){const a=e.objectStore("sessions").count();a.onsuccess=function(){try{t(a.result)}catch(t){l(e,t)}}}getEndToEndSessions(e,t,a){const n=t.objectStore("sessions").index("deviceKey").openCursor(e),s={};n.onsuccess=function(){const e=n.result;if(e)s[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{a(s)}catch(e){l(t,e)}}}getEndToEndSession(e,t,a,n){const s=a.objectStore("sessions").get([e,t]);s.onsuccess=function(){try{s.result?n({session:s.result.session,lastReceivedMessageTs:s.result.lastReceivedMessageTs}):n(null)}catch(e){l(a,e)}}}getAllEndToEndSessions(e,t){const a=e.objectStore("sessions").openCursor();a.onsuccess=function(){try{const e=a.result;e?(t(e.value),e.continue()):t(null)}catch(t){l(e,t)}}}storeEndToEndSession(e,t,a,n){n.objectStore("sessions").put({deviceKey:e,sessionId:t,session:a.session,lastReceivedMessageTs:a.lastReceivedMessageTs})}async storeEndToEndSessionProblem(e,t,a){const n=this._db.transaction("session_problems","readwrite");return n.objectStore("session_problems").put({deviceKey:e,type:t,fixed:a,time:Date.now()}),c(n)}async getEndToEndSessionProblem(e,t){let a;const n=this._db.transaction("session_problems","readwrite"),s=n.objectStore("session_problems").index("deviceKey").getAll(e);return s.onsuccess=e=>{const n=s.result;if(!n.length)return void(a=null);n.sort((e,t)=>e.time-t.time);const i=n[n.length-1];for(const e of n)if(e.time>t)return void(a=Object.assign({},e,{fixed:i.fixed}));a=i.fixed?null:i},await c(n),a}async filterOutNotifiedErrorDevices(e){const t=this._db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),a=[];return await Promise.all(e.map(e=>new Promise(n=>{const{userId:s,deviceInfo:i}=e,o=t.get([s,i.deviceId]);o.onsuccess=function(){o.result||(t.put({userId:s,deviceId:i.deviceId}),a.push(e)),n()}}))),a}getEndToEndInboundGroupSession(e,t,a,n){let s=!1,i=!1;const o=a.objectStore("inbound_group_sessions").get([e,t]);o.onsuccess=function(){try{s=o.result?o.result.session:null,!1!==i&&n(s,i)}catch(e){l(a,e)}};const r=a.objectStore("inbound_group_sessions_withheld").get([e,t]);r.onsuccess=function(){try{i=r.result?r.result.session:null,!1!==s&&n(s,i)}catch(e){l(a,e)}}}getAllEndToEndInboundGroupSessions(e,t){const a=e.objectStore("inbound_group_sessions").openCursor();a.onsuccess=function(){const n=a.result;if(n){try{t({senderKey:n.value.senderCurve25519Key,sessionId:n.value.sessionId,sessionData:n.value.session})}catch(t){l(e,t)}n.continue()}else try{t(null)}catch(t){l(e,t)}}}addEndToEndInboundGroupSession(e,t,a,s){const i=s.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:a});i.onerror=a=>{"ConstraintError"===i.error.name?(a.stopPropagation(),a.preventDefault(),n.a.log("Ignoring duplicate inbound group session: "+e+" / "+t)):l(s,new Error("Failed to add inbound group session: "+i.error))}}storeEndToEndInboundGroupSession(e,t,a,n){n.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:a})}storeEndToEndInboundGroupSessionWithheld(e,t,a,n){n.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:a})}getEndToEndDeviceData(e,t){const a=e.objectStore("device_data").get("-");a.onsuccess=function(){try{t(a.result||null)}catch(t){l(e,t)}}}storeEndToEndDeviceData(e,t){t.objectStore("device_data").put(e,"-")}storeEndToEndRoom(e,t,a){a.objectStore("rooms").put(t,e)}getEndToEndRooms(e,t){const a={},n=e.objectStore("rooms").openCursor();n.onsuccess=function(){const s=n.result;if(s)a[s.key]=s.value,s.continue();else try{t(a)}catch(t){l(e,t)}}}getSessionsNeedingBackup(e){return new Promise((t,a)=>{const n=[],s=this._db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");s.onerror=a,s.oncomplete=function(){t(n)};const i=s.objectStore("sessions_needing_backup"),o=s.objectStore("inbound_group_sessions"),r=i.openCursor();r.onsuccess=function(){const t=r.result;if(t){const a=o.get(t.key);a.onsuccess=function(){n.push({senderKey:a.result.senderCurve25519Key,sessionId:a.result.sessionId,sessionData:a.result.session})},(!e||n.length<e)&&t.continue()}}})}countSessionsNeedingBackup(e){e||(e=this._db.transaction("sessions_needing_backup","readonly"));const t=e.objectStore("sessions_needing_backup");return new Promise((e,a)=>{const n=t.count();n.onerror=a,n.onsuccess=()=>e(n.result)})}unmarkSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const a=t.objectStore("sessions_needing_backup");return Promise.all(e.map(e=>new Promise((t,n)=>{const s=a.delete([e.senderKey,e.sessionId]);s.onsuccess=t,s.onerror=n})))}markSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const a=t.objectStore("sessions_needing_backup");return Promise.all(e.map(e=>new Promise((t,n)=>{const s=a.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});s.onsuccess=t,s.onerror=n})))}addSharedHistoryInboundGroupSession(e,t,a,n){n||(n=this._db.transaction("shared_history_inbound_group_sessions","readwrite"));const s=n.objectStore("shared_history_inbound_group_sessions"),i=s.get([e]);i.onsuccess=()=>{const{sessions:n}=i.result||{sessions:[]};n.push([t,a]),s.put({roomId:e,sessions:n})}}getSharedHistoryInboundGroupSessions(e,t){t||(t=this._db.transaction("shared_history_inbound_group_sessions","readonly"));const a=t.objectStore("shared_history_inbound_group_sessions").get([e]);return new Promise((e,t)=>{a.onsuccess=()=>{const{sessions:t}=a.result||{sessions:[]};e(t)},a.onerror=t})}doTxn(e,t,a){arguments.length>3&&void 0!==arguments[3]||n.a;const s=this._db.transaction(t,e),i=c(s),o=a(s);return i.then(()=>o)}}function r(e,t){if(n.a.log("Upgrading IndexedDBCryptoStore from version "+t+" to "+i),t<1&&function(e){const t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e),t<2&&e.createObjectStore("account"),t<3){e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")}if(t<4&&e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]}),t<5&&e.createObjectStore("device_data"),t<6&&e.createObjectStore("rooms"),t<7&&e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]}),t<8&&e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]}),t<9){e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})}t<10&&e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})}function l(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function c(e){return new Promise((t,a)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&a(e._mx_abortexception),t()},e.onerror=t=>{void 0!==e._mx_abortexception?a(e._mx_abortexception):(n.a.log("Error performing indexeddb txn",t),a(t.target.error))},e.onabort=t=>{void 0!==e._mx_abortexception?a(e._mx_abortexception):(n.a.log("Error performing indexeddb txn",t),a(t.target.error))}})}},2410:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(8),s=a(0),i=a(585),o=a(586),r=a(213),l=a(246),c=a(1);class d extends n.EventEmitter{constructor(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:250;super(),this._cryptoStore=t,this._devices={},this._crossSigningInfo={},this._userByIdentityKey={},this._deviceTrackingStatus={},this._syncToken=null,this._serialiser=new m(e,a,this),this._keyDownloadsInProgressByUser={},this._keyDownloadChunkSize=n,this._dirty=!1,this._savePromise=null,this._resolveSavePromise=null,this._savePromiseTime=null,this._saveTimer=null,this._hasFetched=null}async load(){await this._cryptoStore.doTxn("readonly",[l.a.STORE_DEVICE_DATA],e=>{this._cryptoStore.getEndToEndDeviceData(e,e=>{this._hasFetched=Boolean(e&&e.devices),this._devices=e?e.devices:{},this._crossSigningInfo=e&&e.crossSigningInfo||{},this._deviceTrackingStatus=e?e.trackingStatus:{},this._syncToken=e?e.syncToken:null,this._userByIdentityKey={};for(const e of Object.keys(this._devices)){const t=this._devices[e];for(const a of Object.keys(t)){const n=t[a].keys["curve25519:"+a];void 0!==n&&(this._userByIdentityKey[n]=e)}}})});for(const e of Object.keys(this._deviceTrackingStatus))2==this._deviceTrackingStatus[e]&&(this._deviceTrackingStatus[e]=1)}stop(){null!==this._saveTimer&&clearTimeout(this._saveTimer)}async saveIfDirty(e){if(!this._dirty)return Promise.resolve(!1);void 0===e&&(e=500);const t=Date.now+e;this._savePromiseTime&&t<this._savePromiseTime&&(clearTimeout(this._saveTimer),this._saveTimer=null,this._savePromiseTime=null);let a=this._savePromise;if(null===a&&(a=new Promise((e,t)=>{this._resolveSavePromise=e}),this._savePromise=a),null===this._saveTimer){const a=this._resolveSavePromise;this._savePromiseTime=t,this._saveTimer=setTimeout(()=>{s.a.log("Saving device tracking data",this._syncToken),this._savePromiseTime=null,this._saveTimer=null,this._savePromise=null,this._resolveSavePromise=null,this._cryptoStore.doTxn("readwrite",[l.a.STORE_DEVICE_DATA],e=>{this._cryptoStore.storeEndToEndDeviceData({devices:this._devices,crossSigningInfo:this._crossSigningInfo,trackingStatus:this._deviceTrackingStatus,syncToken:this._syncToken},e)}).then(()=>{this._dirty=!1,a()},e=>{s.a.error("Failed to save device tracking data",this._syncToken),s.a.error(e)})},e)}return a}getSyncToken(){return this._syncToken}setSyncToken(e){this._syncToken=e}downloadKeys(e,t){const a=[],n=[];if(e.forEach(e=>{const i=this._deviceTrackingStatus[e];this._keyDownloadsInProgressByUser[e]?(s.a.log("downloadKeys: already have a download in progress for "+e+": awaiting its result"),n.push(this._keyDownloadsInProgressByUser[e])):(t||3!=i)&&a.push(e)}),0!=a.length){s.a.log("downloadKeys: downloading for",a);const e=this._doKeyDownload(a);n.push(e)}return 0===n.length&&s.a.log("downloadKeys: already have all necessary keys"),Promise.all(n).then(()=>this._getDevicesFromStore(e))}_getDevicesFromStore(e){const t={},a=this;return e.map((function(e){t[e]={};(a.getStoredDevicesForUser(e)||[]).map((function(a){t[e][a.deviceId]=a}))})),t}getKnownUserIds(){return Object.keys(this._devices)}getStoredDevicesForUser(e){const t=this._devices[e];if(!t)return null;const a=[];for(const e in t)t.hasOwnProperty(e)&&a.push(i.a.fromStorage(t[e],e));return a}getRawStoredDevicesForUser(e){return this._devices[e]}getStoredCrossSigningForUser(e){return this._crossSigningInfo[e]?o.a.fromStorage(this._crossSigningInfo[e],e):null}storeCrossSigningForUser(e,t){this._crossSigningInfo[e]=t,this._dirty=!0}getStoredDevice(e,t){const a=this._devices[e];if(a&&a[t])return i.a.fromStorage(a[t],t)}getUserByIdentityKey(e,t){return e!==r.OLM_ALGORITHM&&e!==r.MEGOLM_ALGORITHM?null:this._userByIdentityKey[t]}getDeviceByIdentityKey(e,t){const a=this.getUserByIdentityKey(e,t);if(!a)return null;const n=this._devices[a];if(!n)return null;for(const e in n){if(!n.hasOwnProperty(e))continue;const a=n[e];for(const n in a.keys){if(!a.keys.hasOwnProperty(n))continue;if(0!==n.indexOf("curve25519:"))continue;if(a.keys[n]==t)return i.a.fromStorage(a,e)}}return null}storeDevicesForUser(e,t){if(void 0!==this._devices[e])for(const[t,a]of Object.entries(this._devices[e])){const e=a.keys["curve25519:"+t];delete this._userByIdentityKey[e]}this._devices[e]=t;for(const[a,n]of Object.entries(t)){const t=n.keys["curve25519:"+a];this._userByIdentityKey[t]=e}this._dirty=!0}startTrackingDeviceList(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this._deviceTrackingStatus[e]||(s.a.log("Now tracking device list for "+e),this._deviceTrackingStatus[e]=1,this._dirty=!0)}stopTrackingDeviceList(e){this._deviceTrackingStatus[e]&&(s.a.log("No longer tracking device list for "+e),this._deviceTrackingStatus[e]=0,this._dirty=!0)}stopTrackingAllDeviceLists(){for(const e of Object.keys(this._deviceTrackingStatus))this._deviceTrackingStatus[e]=0;this._dirty=!0}invalidateUserDeviceList(e){this._deviceTrackingStatus[e]&&(s.a.log("Marking device list outdated for",e),this._deviceTrackingStatus[e]=1,this._dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();const e=[];for(const t of Object.keys(this._deviceTrackingStatus)){1==this._deviceTrackingStatus[t]&&e.push(t)}return this._doKeyDownload(e)}_setRawStoredDevicesForUser(e,t){if(void 0!==this._devices[e])for(const[t,a]of Object.entries(this._devices[e])){const e=a.keys["curve25519:"+t];delete this._userByIdentityKey[e]}this._devices[e]=t;for(const[a,n]of Object.entries(t)){const t=n.keys["curve25519:"+a];this._userByIdentityKey[t]=e}}setRawStoredCrossSigningForUser(e,t){this._crossSigningInfo[e]=t}_doKeyDownload(e){if(0===e.length)return Promise.resolve();const t=this._serialiser.updateDevicesForUsers(e,this._syncToken).then(()=>{a(!0)},t=>{throw s.a.error("Error downloading keys for "+e+":",t),a(!1),t});e.forEach(e=>{this._keyDownloadsInProgressByUser[e]=t;1==this._deviceTrackingStatus[e]&&(this._deviceTrackingStatus[e]=2)});const a=a=>{this.emit("crypto.willUpdateDevices",e,!this._hasFetched),e.forEach(e=>{if(this._dirty=!0,this._keyDownloadsInProgressByUser[e]!==t)return void s.a.log("Another update in the queue for",e,"- not marking up-to-date");delete this._keyDownloadsInProgressByUser[e];2==this._deviceTrackingStatus[e]&&(a?(this._deviceTrackingStatus[e]=3,s.a.log("Device list for",e,"now up to date")):this._deviceTrackingStatus[e]=1)}),this.saveIfDirty(),this.emit("crypto.devicesUpdated",e,!this._hasFetched),this._hasFetched=!0};return t}}class m{constructor(e,t,a){this._baseApis=e,this._olmDevice=t,this._deviceList=a,this._downloadInProgress=!1,this._keyDownloadsQueuedByUser={},this._queuedQueryDeferred=null,this._syncToken=null}updateDevicesForUsers(e,t){return e.forEach(e=>{this._keyDownloadsQueuedByUser[e]=!0}),this._queuedQueryDeferred||(this._queuedQueryDeferred=Object(c.e)()),this._syncToken=t,this._downloadInProgress?(s.a.log("Queued key download for",e),this._queuedQueryDeferred.promise):this._doQueuedQueries()}_doQueuedQueries(){if(this._downloadInProgress)throw new Error("DeviceListUpdateSerialiser._doQueuedQueries called with request active");const e=Object.keys(this._keyDownloadsQueuedByUser);this._keyDownloadsQueuedByUser={};const t=this._queuedQueryDeferred;this._queuedQueryDeferred=null,s.a.log("Starting key download for",e),this._downloadInProgress=!0;const a={};this._syncToken&&(a.token=this._syncToken);const n=[];for(let t=0;t<e.length;t+=this._deviceList._keyDownloadChunkSize){const s=e.slice(t,t+this._deviceList._keyDownloadChunkSize);n.push(()=>this._baseApis.downloadKeysForUsers(s,a))}return Object(c.b)(n,3).then(async t=>{const a=Object.assign({},...t.map(e=>e.device_keys||{})),n=Object.assign({},...t.map(e=>e.master_keys||{})),i=Object.assign({},...t.map(e=>e.self_signing_keys||{})),o=Object.assign({},...t.map(e=>e.user_signing_keys||{}));for(const t of e){await Object(c.w)(5);try{await this._processQueryResponseForUser(t,a[t],{master:n[t],self_signing:i[t],user_signing:o[t]})}catch(e){s.a.error(`Error processing keys for ${t}:`,e)}}}).then(()=>{s.a.log("Completed key download for "+e),this._downloadInProgress=!1,t.resolve(),this._queuedQueryDeferred&&this._doQueuedQueries()},a=>{s.a.warn("Error downloading keys for "+e+":",a),this._downloadInProgress=!1,t.reject(a)}),t.promise}async _processQueryResponseForUser(e,t,a){s.a.log("got device keys for "+e+":",t),s.a.log("got cross-signing keys for "+e+":",a);{const a={},n=this._deviceList.getRawStoredDevicesForUser(e);n&&Object.keys(n).forEach(e=>{const t=i.a.fromStorage(n[e],e);a[e]=t}),await async function(e,t,a,n,i,o){let r=!1;for(const e in a)if(a.hasOwnProperty(e)&&!(e in n)){if(t===i&&e===o){s.a.warn(`Local device ${e} missing from sync, skipping removal`);continue}s.a.log("Device "+t+":"+e+" has been removed"),delete a[e],r=!0}for(const i in n){if(!n.hasOwnProperty(i))continue;const o=n[i];o.user_id===t?o.device_id===i?await u(e,a,o)&&(r=!0):s.a.warn("Mismatched device_id "+o.device_id+" in keys from "+t+":"+i):s.a.warn("Mismatched user_id "+o.user_id+" in keys from "+t+":"+i)}return r}(this._olmDevice,e,a,t||{},this._baseApis.getUserId(),this._baseApis.deviceId);const o={};Object.keys(a).forEach(e=>{o[e]=a[e].toStorage()}),this._deviceList._setRawStoredDevicesForUser(e,o)}if(a&&(a.master||a.self_signing||a.user_signing)){const t=this._deviceList.getStoredCrossSigningForUser(e)||new o.a(e);t.setKeys(a),this._deviceList.setRawStoredCrossSigningForUser(e,t.toStorage()),this._deviceList.emit("userCrossSigningUpdated",e)}}}async function u(e,t,a){if(!a.keys)return!1;const n=a.device_id,o=a.user_id,l="ed25519:"+n,c=a.keys[l];if(!c)return s.a.warn("Device "+o+":"+n+" has no ed25519 key"),!1;const d=a.unsigned||{},m=a.signatures||{};try{await r.verifySignature(e,a,o,n,c)}catch(e){return s.a.warn("Unable to verify signature on device "+o+":"+n+":"+e),!1}let u;if(n in t){if(u=t[n],u.getFingerprint()!=c)return s.a.warn("Ed25519 key for device "+o+":"+n+" has changed"),!1}else t[n]=u=new i.a(n);return u.keys=a.keys||{},u.algorithms=a.algorithms||[],u.unsigned=d,u.signatures=m,!0}},2411:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(0),s=a(146),i=a(8),o=a(586),r=a(246),l=a(485);class c{constructor(e,t){this.accountDataClientAdapter=new m(e),this.crossSigningCallbacks=new u,this.ssssCryptoCallbacks=new h(t),this._crossSigningKeys=null,this._keySignatures=null,this._keyBackupInfo=null}addCrossSigningKeys(e,t){this._crossSigningKeys={authUpload:e,keys:t}}addSessionBackup(e){this._keyBackupInfo=e}addSessionBackupPrivateKeyToCache(e){this._sessionBackupPrivateKey=e}addKeySignature(e,t,a){this._keySignatures||(this._keySignatures={});const n=this._keySignatures[e]||{};this._keySignatures[e]=n,n[t]=a}setAccountData(e,t){return this.accountDataClientAdapter.setAccountData(e,t)}buildOperation(){const e=this.accountDataClientAdapter._values;return new d(e,this._crossSigningKeys,this._keyBackupInfo,this._keySignatures)}async persist(e){if(this._crossSigningKeys){const t=Object(o.d)(e._cryptoStore,e._olmDevice);for(const e of["master","self_signing","user_signing"]){n.a.log(`Cache ${e} cross-signing private key locally`);const a=this.crossSigningCallbacks.privateKeys.get(e);await t.storeCrossSigningKeyCache(e,a)}await e._cryptoStore.doTxn("readwrite",[r.a.STORE_ACCOUNT],t=>{e._cryptoStore.storeCrossSigningKeys(t,this._crossSigningKeys.keys)})}this._sessionBackupPrivateKey&&await e.storeSessionBackupPrivateKey(this._sessionBackupPrivateKey)}}class d{constructor(e,t,a,n){this._accountData=e,this._crossSigningKeys=t,this._keyBackupInfo=a,this._keySignatures=n}async apply(e){const t=e._baseApis;if(this._crossSigningKeys){const a={};for(const[e,t]of Object.entries(this._crossSigningKeys.keys))a[e+"_key"]=t;await this._crossSigningKeys.authUpload(e=>t.uploadDeviceSigningKeys(e,a)),e._crossSigningInfo.setKeys(this._crossSigningKeys.keys)}if(this._accountData)for(const[e,a]of this._accountData)await t.setAccountData(e,a);this._keySignatures&&await t.uploadKeySignatures(this._keySignatures),this._keyBackupInfo&&(this._keyBackupInfo.version?await t.http.authedRequest(void 0,"PUT","/room_keys/version/"+this._keyBackupInfo.version,void 0,{algorithm:this._keyBackupInfo.algorithm,auth_data:this._keyBackupInfo.auth_data},{prefix:l.i}):await t.http.authedRequest(void 0,"POST","/room_keys/version",void 0,this._keyBackupInfo,{prefix:l.i}))}}class m extends i.EventEmitter{constructor(e){super(),this._existingValues=e,this._values=new Map}getAccountDataFromServer(e){return Promise.resolve(this.getAccountData(e))}getAccountData(e){const t=this._values.get(e);if(t)return t;const a=this._existingValues[e];return a?a.getContent():null}setAccountData(e,t){const a=this._values.get(e);return this._values.set(e,t),Promise.resolve().then(()=>{const n=new s.b({type:e,content:t});this.emit("accountData",n,a)})}}class u{constructor(){this.privateKeys=new Map}getCrossSigningKeyCache(e,t){return this.getCrossSigningKey(e,t)}storeCrossSigningKeyCache(e,t){return this.privateKeys.set(e,t),Promise.resolve()}getCrossSigningKey(e,t){return Promise.resolve(this.privateKeys.get(e))}saveCrossSigningKeys(e){for(const[t,a]of Object.entries(e))this.privateKeys.set(t,a)}}class h{constructor(e){this._privateKeys=new Map,this._delegateCryptoCallbacks=e}async getSecretStorageKey(e,t){let{keys:a}=e;for(const e of Object.keys(a)){const t=this._privateKeys.get(e);if(t)return[e,t]}if(this._delegateCryptoCallbacks){const e=await this._delegateCryptoCallbacks.getSecretStorageKey({keys:a},t);if(e){const[t,a]=e;this._privateKeys.set(t,a)}return e}}addPrivateKey(e,t,a){this._privateKeys.set(e,a),this._delegateCryptoCallbacks&&this._delegateCryptoCallbacks.cacheSecretStorageKey&&this._delegateCryptoCallbacks.cacheSecretStorageKey(e,t,a)}}},2412:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return c}));var n=a(8),s=a(0),i=a(213),o=a(294),r=a(486);const l="m.secret_storage.v1.aes-hmac-sha2";class c extends n.EventEmitter{constructor(e,t){super(),this._baseApis=e,this._cryptoCallbacks=t,this._requests={},this._incomingRequests={}}async getDefaultKeyId(){const e=await this._baseApis.getAccountDataFromServer("m.secret_storage.default_key");return e?e.key:null}setDefaultKeyId(e){return new Promise(async(t,a)=>{const n=a=>{"m.secret_storage.default_key"===a.getType()&&a.getContent().key===e&&(this._baseApis.removeListener("accountData",n),t())};this._baseApis.on("accountData",n);try{await this._baseApis.setAccountData("m.secret_storage.default_key",{key:e})}catch(e){this._baseApis.removeListener("accountData",n),a(e)}})}async addKey(e,t,a){const n={algorithm:e};if(t||(t={}),t.name&&(n.name=t.name),e!==l)throw new Error("Unknown key algorithm "+t.algorithm);if(t.passphrase&&(n.passphrase=t.passphrase),t.key){const{iv:e,mac:a}=await c._calculateKeyCheck(t.key);n.iv=e,n.mac=a}if(!a)do{a=Object(o.b)(32)}while(await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+a));return await this._baseApis.setAccountData("m.secret_storage.key."+a,n),{keyId:a,keyInfo:n}}async getKey(e){if(e||(e=await this.getDefaultKeyId()),!e)return null;const t=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+e);return t?[e,t]:null}async hasKey(e){return!!await this.getKey(e)}async checkKey(e,t){if(t.algorithm===l){if(t.mac){const{mac:a}=await c._calculateKeyCheck(e,t.iv);return t.mac.replace(/=+$/g,"")===a.replace(/=+$/g,"")}return!0}throw new Error("Unknown algorithm")}static async _calculateKeyCheck(e,t){return await Object(r.b)("\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",e,"",t)}async store(e,t,a){const n={};if(!a){const e=await this.getDefaultKeyId();if(!e)throw new Error("No keys specified and no default key present");a=[e]}if(0===a.length)throw new Error("Zero keys given to encrypt with!");for(const i of a){const a=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+i);if(!a)throw new Error("Unknown key: "+i);if(a.algorithm===l){const s={[i]:a},[,o]=await this._getSecretStorageKey(s,e);n[i]=await o.encrypt(t)}else s.a.warn("unknown algorithm for secret storage key "+i+": "+a.algorithm)}await this._baseApis.setAccountData(e,{encrypted:n})}async _fixupStoredSecret(e,t){const a=Object.keys(t);if(1===a.length&&"encrypted"!==a[0]&&t[a[0]].passthrough){if(await this.hasKey(a[0])){s.a.log("Fixing up passthrough secret: "+e),await this.storePassthrough(e,a[0]);return await this._baseApis.getAccountDataFromServer(e)}}return null}async get(e){let t=await this._baseApis.getAccountDataFromServer(e);if(!t)return;if(!t.encrypted&&(t=await this._fixupStoredSecret(e,t),!t||!t.encrypted))throw new Error("Content is not encrypted!");const a={};for(const e of Object.keys(t.encrypted)){const n=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+e),s=t.encrypted[e];n.algorithm===l&&s.iv&&s.ciphertext&&s.mac&&(a[e]=n)}if(0===Object.keys(a).length)throw new Error(`Could not decrypt ${e} because none of the keys it is encrypted with are for a supported algorithm`);let n,s;try{[n,s]=await this._getSecretStorageKey(a,e);const o=t.encrypted[n];return o.passthrough?Object(i.encodeBase64)(s.get_private_key()):await s.decrypt(o)}finally{s&&s.free&&s.free()}}async isStored(e,t){let a=await this._baseApis.getAccountDataFromServer(e);if(!a)return null;if(!a.encrypted&&(a=await this._fixupStoredSecret(e,a),!a||!a.encrypted))return null;void 0===t&&(t=!0);const n={};for(const e of Object.keys(a.encrypted)){const t=await this._baseApis.getAccountDataFromServer("m.secret_storage.key."+e);if(!t)continue;const s=a.encrypted[e];t.algorithm===l&&s.iv&&s.ciphertext&&s.mac&&(n[e]=t)}return Object.keys(n).length?n:null}request(e,t){const a=this._baseApis.makeTxnId(),n=this._requests[a]={name:e,devices:t},i=new Promise((e,t)=>{n.resolve=e,n.reject=t}),o={name:e,action:"request",requesting_device_id:this._baseApis.deviceId,request_id:a},r={};for(const e of t)r[e]=o;return s.a.info(`Request secret ${e} from ${t}, id ${a}`),this._baseApis.sendToDevice("m.secret.request",{[this._baseApis.getUserId()]:r}),{request_id:a,promise:i,cancel:e=>{const s={action:"request_cancellation",requesting_device_id:this._baseApis.deviceId,request_id:a},i={};for(const e of t)i[e]=s;this._baseApis.sendToDevice("m.secret.request",{[this._baseApis.getUserId()]:i}),n.reject(new Error(e||"Cancelled"))}}}async _onRequestReceived(e){const t=e.getSender(),a=e.getContent();if(t!==this._baseApis.getUserId()||!(a.name&&a.action&&a.requesting_device_id&&a.request_id))return;const n=a.requesting_device_id;if("request_cancellation"===a.action)this._incomingRequests[n]&&this._incomingRequests[n][a.request_id]&&(s.a.info("received request cancellation for secret ("+t+", "+n+", "+a.request_id+")"),this._baseApis.emit("crypto.secrets.requestCancelled",{user_id:t,device_id:n,request_id:a.request_id}));else if("request"===a.action){if(n===this._baseApis.deviceId)return;if(s.a.info("received request for secret ("+t+", "+n+", "+a.request_id+")"),!this._cryptoCallbacks.onSecretRequested)return;const e=await this._cryptoCallbacks.onSecretRequested(t,n,a.request_id,a.name,this._baseApis.checkDeviceTrust(t,n));if(e){s.a.info(`Preparing ${a.name} secret for ${n}`);const o={type:"m.secret.send",content:{request_id:a.request_id,secret:e}},r={algorithm:i.OLM_ALGORITHM,sender_key:this._baseApis.crypto._olmDevice.deviceCurve25519Key,ciphertext:{}};await i.ensureOlmSessionsForDevices(this._baseApis.crypto._olmDevice,this._baseApis,{[t]:[this._baseApis.getStoredDevice(t,n)]}),await i.encryptMessageForDevice(r.ciphertext,this._baseApis.getUserId(),this._baseApis.deviceId,this._baseApis.crypto._olmDevice,t,this._baseApis.getStoredDevice(t,n),o);const l={[t]:{[n]:r}};s.a.info(`Sending ${a.name} secret for ${n}`),this._baseApis.sendToDevice("m.room.encrypted",l)}else s.a.info(`Request denied for ${a.name} secret for ${n}`)}}_onSecretReceived(e){if(e.getSender()!==this._baseApis.getUserId())return;const t=e.getContent();s.a.log("got secret share for request",t.request_id);const a=this._requests[t.request_id];if(a){const n=this._baseApis.crypto._deviceList.getDeviceByIdentityKey(i.OLM_ALGORITHM,e.getSenderKey());if(!n)return void s.a.log("secret share from unknown device with key",e.getSenderKey());if(!a.devices.includes(n.deviceId))return void s.a.log("unsolicited secret share from device",n.deviceId);s.a.log(`Successfully received secret ${a.name} from `+n.deviceId),a.resolve(t.secret)}}async _getSecretStorageKey(e,t){if(!this._cryptoCallbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const a=await this._cryptoCallbacks.getSecretStorageKey({keys:e},t);if(!a)throw new Error("getSecretStorageKey callback returned falsey");if(a.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[n,s]=a;if(!e[n])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[n].algorithm===l){return[n,{encrypt:async function(e){return await Object(r.b)(e,s,t)},decrypt:async function(e){return await Object(r.a)(e,s,t)}}]}throw new Error("Unknown key type: "+e[n].algorithm)}}},2413:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return l}));var n=a(0);const s=0,i=1,o=2,r=3;class l{constructor(e,t,a){this._baseApis=e,this._deviceId=t,this._cryptoStore=a,this._sendOutgoingRoomKeyRequestsTimer=null,this._sendOutgoingRoomKeyRequestsRunning=!1,this._clientRunning=!1}start(){this._clientRunning=!0}stop(){n.a.log("stopping OutgoingRoomKeyRequestManager"),this._clientRunning=!1}sendQueuedRequests(){this._startTimer()}async queueRoomKeyRequest(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=await this._cryptoStore.getOutgoingRoomKeyRequest(e);if(l)switch(l.state){case r:case s:return;case o:{const e=a?r:i;await this._cryptoStore.updateOutgoingRoomKeyRequest(l.requestId,o,{state:e,cancellationTxnId:this._baseApis.makeTxnId()});break}case i:if(a){const s=r,o=await this._cryptoStore.updateOutgoingRoomKeyRequest(l.requestId,i,{state:s,cancellationTxnId:this._baseApis.makeTxnId(),requestTxnId:this._baseApis.makeTxnId()});if(!o)return await this.queueRoomKeyRequest(e,t,a);try{await this._sendOutgoingRoomKeyRequestCancellation(o,!0)}catch(e){n.a.error("Error sending room key request cancellation; will retry later.",e)}}break;default:throw new Error("unhandled state: "+l.state)}else await this._cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:t,requestId:this._baseApis.makeTxnId(),state:s})}cancelRoomKeyRequest(e){return this._cryptoStore.getOutgoingRoomKeyRequest(e).then(t=>{if(t)switch(t.state){case o:case r:return;case s:return n.a.log("deleting unnecessary room key request for "+c(e)),this._cryptoStore.deleteOutgoingRoomKeyRequest(t.requestId,s);case i:return this._cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,i,{state:o,cancellationTxnId:this._baseApis.makeTxnId()}).then(t=>{t?this._sendOutgoingRoomKeyRequestCancellation(t).catch(e=>{n.a.error("Error sending room key request cancellation; will retry later.",e),this._startTimer()}):n.a.log("Tried to cancel room key request for "+c(e)+" but it was already cancelled in another tab")});default:throw new Error("unhandled state: "+t.state)}})}getOutgoingSentRoomKeyRequest(e,t){return this._cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[i])}async cancelAndResendAllOutgoingRequests(){const e=await this._cryptoStore.getAllOutgoingRoomKeyRequestsByState(i);return Promise.all(e.map(e=>{let{requestBody:t,recipients:a}=e;return this.queueRoomKeyRequest(t,a,!0)}))}_startTimer(){if(this._sendOutgoingRoomKeyRequestsTimer)return;this._sendOutgoingRoomKeyRequestsTimer=e.setTimeout(()=>{if(this._sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this._sendOutgoingRoomKeyRequestsRunning=!0,this._sendOutgoingRoomKeyRequests().finally(()=>{this._sendOutgoingRoomKeyRequestsRunning=!1}).catch(e=>{n.a.warn("error in OutgoingRoomKeyRequestManager: "+e)})},500)}_sendOutgoingRoomKeyRequests(){return this._clientRunning?this._cryptoStore.getOutgoingRoomKeyRequestByState([o,r,s]).then(e=>{if(!e)return void(this._sendOutgoingRoomKeyRequestsTimer=null);let t;switch(e.state){case s:t=this._sendOutgoingRoomKeyRequest(e);break;case o:t=this._sendOutgoingRoomKeyRequestCancellation(e);break;case r:t=this._sendOutgoingRoomKeyRequestCancellation(e,!0)}return t.then(()=>this._sendOutgoingRoomKeyRequests()).catch(e=>{n.a.error("Error sending room key request; will retry later.",e),this._sendOutgoingRoomKeyRequestsTimer=null})}):(this._sendOutgoingRoomKeyRequestsTimer=null,Promise.resolve())}_sendOutgoingRoomKeyRequest(e){n.a.log("Requesting keys for "+c(e.requestBody)+" from "+d(e.recipients)+`(id ${e.requestId})`);const t={action:"request",requesting_device_id:this._deviceId,request_id:e.requestId,body:e.requestBody};return this._sendMessageToDevices(t,e.recipients,e.requestTxnId||e.requestId).then(()=>this._cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,s,{state:i}))}_sendOutgoingRoomKeyRequestCancellation(e,t){n.a.log("Sending cancellation for key request for "+c(e.requestBody)+" to "+d(e.recipients)+" "+`(cancellation id ${e.cancellationTxnId})`);const a={action:"request_cancellation",requesting_device_id:this._deviceId,request_id:e.requestId};return this._sendMessageToDevices(a,e.recipients,e.cancellationTxnId).then(()=>t?this._cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,r,{state:s}):this._cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,o))}_sendMessageToDevices(e,t,a){const n={};for(const a of t)n[a.userId]||(n[a.userId]={}),n[a.userId][a.deviceId]=e;return this._baseApis.sendToDevice("m.room_key_request",n,a)}}function c(e){return e.room_id+" / "+e.session_id}function d(e){return"["+e.map(e=>`${e.userId}:${e.deviceId}`).join(",")+"]"}}).call(this,a(7))},2414:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return k}));var n=a(777),s=a(583),i=a.n(s),o=a(488),r=a(0);const l="m.key.verification.start",c=["m.key.verification.accept","m.key.verification.key","m.key.verification.mac"];let d;const m=Object(o.a)("m.mismatched_sas","Mismatched short authentication string"),u=Object(o.a)("m.mismatched_commitment","Mismatched commitment");const h=[["🐶","dog"],["🐱","cat"],["🦁","lion"],["🐎","horse"],["🦄","unicorn"],["🐷","pig"],["🐘","elephant"],["🐰","rabbit"],["🐼","panda"],["🐓","rooster"],["🐧","penguin"],["🐢","turtle"],["🐟","fish"],["🐙","octopus"],["🦋","butterfly"],["🌷","flower"],["🌳","tree"],["🌵","cactus"],["🍄","mushroom"],["🌏","globe"],["🌙","moon"],["☁️","cloud"],["🔥","fire"],["🍌","banana"],["🍎","apple"],["🍓","strawberry"],["🌽","corn"],["🍕","pizza"],["🎂","cake"],["❤️","heart"],["🙂","smiley"],["🤖","robot"],["🎩","hat"],["👓","glasses"],["🔧","spanner"],["🎅","santa"],["👍","thumbs up"],["☂️","umbrella"],["⌛","hourglass"],["⏰","clock"],["🎁","gift"],["💡","light bulb"],["📕","book"],["✏️","pencil"],["📎","paperclip"],["✂️","scissors"],["🔒","lock"],["🔑","key"],["🔨","hammer"],["☎️","telephone"],["🏁","flag"],["🚂","train"],["🚲","bicycle"],["✈️","aeroplane"],["🚀","rocket"],["🏆","trophy"],["⚽","ball"],["🎸","guitar"],["🎺","trumpet"],["🔔","bell"],["⚓️","anchor"],["🎧","headphones"],["📁","folder"],["📌","pin"]];const p={decimal:function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]},emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map(e=>h[e])}};function g(e,t){const a={};for(const n of t)n in p&&(a[n]=p[n](e));return a}const f={"hkdf-hmac-sha256":"calculate_mac","hmac-sha256":"calculate_mac_long_kdf"};function v(e,t){return function(){const a=e[f[t]];for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];const o=a.apply(e,s);return r.a.log("SAS calculateMAC:",t,s,o),o}}const b={"curve25519-hkdf-sha256":function(e,t,a){const n=`${e._baseApis.getUserId()}|${e._baseApis.deviceId}|`+e.ourSASPubKey+"|",s=`${e.userId}|${e.deviceId}|${e.theirSASPubKey}|`,i="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?n+s:s+n)+e._channel.transactionId;return t.generate_bytes(i,a)},curve25519:function(e,t,a){const n=`${e._baseApis.getUserId()}${e._baseApis.deviceId}`,s=`${e.userId}${e.deviceId}`,i="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?n+s:s+n)+e._channel.transactionId;return t.generate_bytes(i,a)}},y=["curve25519-hkdf-sha256","curve25519"],E=["sha256"],_=["hkdf-hmac-sha256","hmac-sha256"],S=Object.keys(p),C=new Set(y),w=new Set(E),O=new Set(_),x=new Set(S);function R(e,t){return e instanceof Array?e.filter(e=>t.has(e)):[]}class k extends n.b{static get NAME(){return"m.sas.v1"}get events(){return c}async _doVerification(){await e.Olm.init(),d=d||new e.Olm.Utility,await this._baseApis.downloadKeys([this.userId]);let t=!1;do{try{return this.initiatedByMe?await this._doSendVerification():await this._doRespondVerification()}catch(e){if(!(e instanceof n.a))throw e;this.startEvent=e.startEvent,t=!0}}while(t)}canSwitchStartEvent(e){if(e.getType()!==l)return!1;const t=e.getContent();return t&&t.method===k.NAME&&this._waitingForAccept}async _sendStart(){const e=this._channel.completeContent(l,{method:k.NAME,from_device:this._baseApis.deviceId,key_agreement_protocols:y,hashes:E,message_authentication_codes:_,short_authentication_string:S});return await this._channel.sendCompleted(l,e),e}async _doSendVerification(){let t,a;if(this._waitingForAccept=!0,t=this.startEvent?this._channel.completedContentFromEvent(this.startEvent):await this._sendStart(),!this.initiatedByMe)throw new n.a(this.startEvent);try{a=await this._waitForEvent("m.key.verification.accept")}finally{this._waitingForAccept=!1}let s=a.getContent();const r=R(s.short_authentication_string,x);if(!(C.has(s.key_agreement_protocol)&&w.has(s.hash)&&O.has(s.message_authentication_code)&&r.length))throw Object(o.g)();if("string"!=typeof s.commitment)throw Object(o.c)();const l=s.key_agreement_protocol,c=s.message_authentication_code,h=s.commitment,p=new e.Olm.SAS;try{this.ourSASPubKey=p.get_pubkey(),await this._send("m.key.verification.key",{key:this.ourSASPubKey}),a=await this._waitForEvent("m.key.verification.key"),s=a.getContent();const e=s.key+i.a.stringify(t);if(d.sha256(e)!==h)throw u();this.theirSASPubKey=s.key,p.set_their_key(s.key);const n=b[l](this,p,6),f=new Promise((e,t)=>{this.sasEvent={sas:g(n,r),confirm:async()=>{try{await this._sendMAC(p,c),e()}catch(e){t(e)}},cancel:()=>t(Object(o.h)()),mismatch:()=>t(m())},this.emit("show_sas",this.sasEvent)});[a]=await Promise.all([this._waitForEvent("m.key.verification.mac").then(e=>(this._expectedEvent="m.key.verification.done",e)),f]),s=a.getContent(),await this._checkMAC(p,s,c)}finally{p.free()}}async _doRespondVerification(){let t=this._channel.completedContentFromEvent(this.startEvent);const a=R(y,new Set(t.key_agreement_protocols))[0],n=R(E,new Set(t.hashes))[0],s=R(_,new Set(t.message_authentication_codes))[0],r=R(t.short_authentication_string,x);if(void 0===a||void 0===n||void 0===s||!r.length)throw Object(o.g)();const l=new e.Olm.SAS;try{const e=l.get_pubkey()+i.a.stringify(t);await this._send("m.key.verification.accept",{key_agreement_protocol:a,hash:n,message_authentication_code:s,short_authentication_string:r,commitment:d.sha256(e)});let c=await this._waitForEvent("m.key.verification.key");t=c.getContent(),this.theirSASPubKey=t.key,l.set_their_key(t.key),this.ourSASPubKey=l.get_pubkey(),await this._send("m.key.verification.key",{key:this.ourSASPubKey});const u=b[a](this,l,6),h=new Promise((e,t)=>{this.sasEvent={sas:g(u,r),confirm:async()=>{try{await this._sendMAC(l,s),e()}catch(e){t(e)}},cancel:()=>t(Object(o.h)()),mismatch:()=>t(m())},this.emit("show_sas",this.sasEvent)});[c]=await Promise.all([this._waitForEvent("m.key.verification.mac").then(e=>(this._expectedEvent="m.key.verification.done",e)),h]),t=c.getContent(),await this._checkMAC(l,t,s)}finally{l.free()}}_sendMAC(e,t){const a={},n=[],s="MATRIX_KEY_VERIFICATION_MAC"+this._baseApis.getUserId()+this._baseApis.deviceId+this.userId+this.deviceId+this._channel.transactionId,i="ed25519:"+this._baseApis.deviceId;a[i]=v(e,t)(this._baseApis.getDeviceEd25519Key(),s+i),n.push(i);const o=this._baseApis.getCrossSigningId();if(o){const i="ed25519:"+o;a[i]=v(e,t)(o,s+i),n.push(i)}const r=v(e,t)(n.sort().join(","),s+"KEY_IDS");return this._send("m.key.verification.mac",{mac:a,keys:r})}async _checkMAC(e,t,a){const n="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this._baseApis.getUserId()+this._baseApis.deviceId+this._channel.transactionId;if(t.keys!==v(e,a)(Object.keys(t.mac).sort().join(","),n+"KEY_IDS"))throw Object(o.d)();await this._verifyKeys(this.userId,t.mac,(t,s,i)=>{if(i!==v(e,a)(s.keys[t],n+t))throw Object(o.d)()})}}}).call(this,a(7))},2418:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return o}));var n=a(364),s=a(0);class i{constructor(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._client=e,this._roomId=t,this.userId=a,this._requestEventId=null}get receiveStartFromOtherDevices(){return!0}get roomId(){return this._roomId}get transactionId(){return this._requestEventId}static getOtherPartyUserId(e,t){if(i.getEventType(e)!==n.i)return;const a=t.getUserId(),s=e.getSender(),o=e.getContent().to;return s===a?o:o===a?s:void 0}getTimestamp(e){return e.getTs()}static canCreateRequest(e){return e===n.i}static getTransactionId(e){if(i.getEventType(e)===n.i)return e.getId();{const t=e.getRelation();if(t&&"m.reference"===t.rel_type)return t.event_id}}static validateEvent(e,t){const a=i.getTransactionId(e);if("string"!=typeof a||0===a.length)return!1;const o=i.getEventType(e),r=e.getContent();if(o===n.i){if(!r||"string"!=typeof r.to||!r.to.length)return s.a.log("InRoomChannel: validateEvent: no valid to "+(r&&r.to)),!1;if(!i.getOtherPartyUserId(e,t))return s.a.log("InRoomChannel: validateEvent: not directed to or sent by me: "+e.getSender()+", "+(r&&r.to)),!1}return n.k.validateEvent(o,e,t)}static getEventType(e){const t=e.getType();if("m.room.message"===t){const t=e.getContent();if(t){const{msgtype:e}=t;if(e===n.i)return n.i}}return t&&t!==n.i?t:""}async handleEvent(e,t,a){if(t.hasEventId(e.getId()))return;const n=i.getEventType(e);if(e.getRoomId()!==this._roomId)return;if(null===this.userId){const t=i.getOtherPartyUserId(e,this._client);t&&(this.userId=t)}const o=this._client.getUserId(),r=e.getSender();if(null!==this.userId&&r!==o&&r!==this.userId)return void s.a.log("InRoomChannel: ignoring verification event from non-participating sender "+r);null===this._requestEventId&&(this._requestEventId=i.getTransactionId(e));const l=!!e.getUnsigned().transaction_id,c=e.getSender()===this._client.getUserId();return await t.handleEvent(n,e,a,l,c)}completedContentFromEvent(e){const t=Object.assign({},e.getContent());return t["m.relates_to"]=e.getRelation(),t}completeContent(e,t){return t=Object.assign({},t),e!==n.i&&e!==n.h&&e!==n.j||(t.from_device=this._client.getDeviceId()),e===n.i?t={body:this._client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:n.i,to:this.userId,from_device:t.from_device,methods:t.methods}:t["m.relates_to"]={rel_type:"m.reference",event_id:this.transactionId},t}send(e,t){const a=this.completeContent(e,t);return this.sendCompleted(e,a)}async sendCompleted(e,t){let a=e;e===n.i&&(a="m.room.message");const s=await this._client.sendEvent(this._roomId,a,t);e===n.i&&(this._requestEventId=s.event_id)}}class o{constructor(){this._requestsByRoomId=new Map}getRequest(e){const t=e.getRoomId(),a=i.getTransactionId(e);return this._getRequestByTxnId(t,a)}getRequestByChannel(e){return this._getRequestByTxnId(e.roomId,e.transactionId)}_getRequestByTxnId(e,t){const a=this._requestsByRoomId.get(e);if(a)return a.get(t)}setRequest(e,t){this._setRequest(e.getRoomId(),i.getTransactionId(e),t)}setRequestByChannel(e,t){this._setRequest(e.roomId,e.transactionId,t)}_setRequest(e,t,a){let n=this._requestsByRoomId.get(e);n||(n=new Map,this._requestsByRoomId.set(e,n)),n.set(t,a)}removeRequest(e){const t=e.getRoomId(),a=this._requestsByRoomId.get(t);a&&(a.delete(i.getTransactionId(e)),0===a.size&&this._requestsByRoomId.delete(t))}findRequestInProgress(e){const t=this._requestsByRoomId.get(e);if(t)for(const e of t.values())if(e.pending)return e}}},2419:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return c}));var n=a(294),s=a(0),i=a(364),o=a(488),r=a(146);class l{constructor(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._client=e,this.userId=t,this._devices=a,this.transactionId=n,this._deviceId=s}isToDevices(e){if(e.length===this._devices.length){for(const t of e){if(!this._devices.find(e=>e.deviceId===t.deviceId))return!1}return!0}return!1}get deviceId(){return this._deviceId}static getEventType(e){return e.getType()}static getTransactionId(e){const t=e.getContent();return t&&t.transaction_id}static canCreateRequest(e){return e===i.i||e===i.j}static validateEvent(e,t){if(e.isCancelled())return s.a.warn("Ignoring flagged verification request from "+e.getSender()),!1;const a=e.getContent();if(!a)return s.a.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!a.transaction_id)return s.a.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;const n=e.getType();if(n===i.i){if(!Number.isFinite(a.timestamp))return s.a.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&a.from_device==t.getDeviceId())return s.a.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return i.k.validateEvent(n,e,t)}getTimestamp(e){const t=e.getContent();return t&&t.timestamp}async handleEvent(e,t,a){const n=e.getType(),s=e.getContent();if(n===i.i||n===i.h||n===i.j){this.transactionId||(this.transactionId=s.transaction_id);const e=s.from_device;if(!this._deviceId&&this._devices.includes(e)&&(this._deviceId=e),!this._deviceId||this._deviceId!==e){const t=this.completeContent(Object(o.b)(Object(o.f)()));return this._sendToDevices(i.a,t,[e])}}const r=t.phase===i.f||t.phase===i.d;await t.handleEvent(e.getType(),e,a,!1,!1);const l=t.phase===i.f||t.phase===i.d;if((n===i.j||n===i.h)&&!r&&l&&this._deviceId){const e=this._devices.filter(e=>e!==this._deviceId&&e!==this._client.getDeviceId());if(e.length){const t=this.completeContent({code:"m.accepted",reason:"Verification request accepted by another device"});await this._sendToDevices(i.a,t,e)}}}completedContentFromEvent(e){return e.getContent()}completeContent(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==i.i&&e!==i.h&&e!==i.j||(t.from_device=this._client.getDeviceId()),e===i.i&&(t.timestamp=Date.now()),t}send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e!==i.i&&e!==i.j||this.transactionId||(this.transactionId=l.makeTransactionId());const a=this.completeContent(e,t);return this.sendCompleted(e,a)}async sendCompleted(e,t){let a;a=e===i.i?await this._sendToDevices(e,t,this._devices):await this._sendToDevices(e,t,[this._deviceId]);const n=new r.b({sender:this._client.getUserId(),content:t,type:e});return await this._request.handleEvent(e,n,!0,!0,!0),a}_sendToDevices(e,t,a){if(a.length){const n={};for(const e of a)n[e]=t;return this._client.sendToDevice(e,{[this.userId]:n})}return Promise.resolve()}static makeTransactionId(){return Object(n.b)(32)}}class c{constructor(){this._requestsByUserId=new Map}getRequest(e){return this.getRequestBySenderAndTxnId(e.getSender(),l.getTransactionId(e))}getRequestByChannel(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}getRequestBySenderAndTxnId(e,t){const a=this._requestsByUserId.get(e);if(a)return a.get(t)}setRequest(e,t){this.setRequestBySenderAndTxnId(e.getSender(),l.getTransactionId(e),t)}setRequestByChannel(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}setRequestBySenderAndTxnId(e,t,a){let n=this._requestsByUserId.get(e);n||(n=new Map,this._requestsByUserId.set(e,n)),n.set(t,a)}removeRequest(e){const t=e.getSender(),a=this._requestsByUserId.get(t);a&&(a.delete(l.getTransactionId(e)),0===a.size&&this._requestsByUserId.delete(t))}findRequestInProgress(e,t){const a=this._requestsByUserId.get(e);if(a)for(const e of a.values())if(e.pending&&e.channel.isToDevices(t))return e}getRequestsInProgress(e){const t=this._requestsByUserId.get(e);return t?Array.from(t.values()).filter(e=>e.pending):[]}}},2420:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(777);class s extends n.b{static factory(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return new s(...t)}static get NAME(){return"org.matrix.illegal_method"}async _doVerification(){throw new Error("Verification is not possible with this method")}}},2421:function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),function(e){e.Error="ERROR",e.Prepared="PREPARED",e.Stopped="STOPPED",e.Syncing="SYNCING",e.Catchup="CATCHUP",e.Reconnecting="RECONNECTING"}(n||(n={}))},2422:function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),function(e){e.Master="master",e.SelfSigning="self_signing",e.UserSigning="user_signing"}(n||(n={}))},2423:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(146);function s(e,t){const a=Boolean(t.preventReEmit),s=!1!==t.decrypt;return function(t){const i=new n.b(t);return i.isEncrypted()&&(a||e.reEmitter.reEmit(i,["Event.decrypted"]),s&&e.decryptEventIfNeeded(i)),a||e.reEmitter.reEmit(i,["Event.replaced"]),i}}},2424:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(0),s=a(1);function i(e,t,a){this._workerScript=e,this._dbName=t,this._workerApi=a,this._worker=null,this._nextSeq=0,this._inFlight={},this._startPromise=null}i.prototype={connect:function(){return this._ensureStarted().then(()=>this._doCmd("connect"))},clearDatabase:function(){return this._ensureStarted().then(()=>this._doCmd("clearDatabase"))},isNewlyCreated:function(){return this._doCmd("isNewlyCreated")},getSavedSync:function(){return this._doCmd("getSavedSync")},getNextBatchToken:function(){return this._doCmd("getNextBatchToken")},setSyncData:function(e){return this._doCmd("setSyncData",[e])},syncToDatabase:function(e){return this._doCmd("syncToDatabase",[e])},getOutOfBandMembers:function(e){return this._doCmd("getOutOfBandMembers",[e])},setOutOfBandMembers:function(e,t){return this._doCmd("setOutOfBandMembers",[e,t])},clearOutOfBandMembers:function(e){return this._doCmd("clearOutOfBandMembers",[e])},getClientOptions:function(){return this._doCmd("getClientOptions")},storeClientOptions:function(e){return this._doCmd("storeClientOptions",[e])},getUserPresenceEvents:function(){return this._doCmd("getUserPresenceEvents")},_ensureStarted:function(){return null===this._startPromise&&(this._worker=new this._workerApi(this._workerScript),this._worker.onmessage=this._onWorkerMessage.bind(this),this._startPromise=this._doCmd("_setupWorker",[this._dbName]).then(()=>{n.a.log("IndexedDB worker is ready")})),this._startPromise},_doCmd:function(e,t){return Promise.resolve().then(()=>{const a=this._nextSeq++,n=Object(s.e)();return this._inFlight[a]=n,this._worker.postMessage({command:e,seq:a,args:t}),n.promise})},_onWorkerMessage:function(e){const t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void n.a.error("Got reply from worker with no seq");const e=this._inFlight[t.seq];if(void 0===e)return void n.a.error("Got reply for unknown seq "+t.seq);if(delete this._inFlight[t.seq],"cmd_success"==t.command)e.resolve(t.result);else{const a=new Error(t.error.message);a.name=t.error.name,e.reject(a)}}else n.a.warn("Unrecognised message from worker: "+t)}}},245:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return o}));var n=a(92),s=a.n(n);let i;!function(e){e.IRC="irc",e.Group="group"}(i||(i={}));const o=s.a.oneOf(Object.values(i))},246:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return c}));var n=a(0),s=a(1298),i=a(484),o=a(2409),r=a(331),l=a(21);class c{constructor(e,t){this._indexedDB=e,this._dbName=t,this._backendPromise=null,this._backend=null}static exists(e,t){return l.a(e,t)}startup(){return this._backendPromise||(this._backendPromise=new Promise((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));n.a.log("connecting to indexeddb "+this._dbName);const a=this._indexedDB.open(this._dbName,o.b);a.onupgradeneeded=e=>{const t=e.target.result,a=e.oldVersion;o.c(t,a)},a.onblocked=()=>{n.a.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},a.onerror=e=>{n.a.log("Error connecting to indexeddb",e),t(e.target.error)},a.onsuccess=t=>{const a=t.target.result;n.a.log("connected to indexeddb "+this._dbName),e(new o.a(a))}}).then(e=>e.doTxn("readonly",[c.STORE_INBOUND_GROUP_SESSIONS,c.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],t=>{e.getEndToEndInboundGroupSession("","",t,()=>{})}).then(()=>e)).catch(t=>{if("VersionError"===t.name)throw n.a.warn("Crypto DB is too new for us to use!",t),new r.a(r.a.TOO_NEW);n.a.warn("unable to connect to indexeddb "+this._dbName+": falling back to localStorage store: "+t);try{return new s.a(e.localStorage)}catch(t){return n.a.warn("unable to open localStorage: falling back to in-memory store: "+t),new i.a}}).then(e=>{this._backend=e})),this._backendPromise}deleteAllData(){return new Promise((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));n.a.log("Removing indexeddb instance: "+this._dbName);const a=this._indexedDB.deleteDatabase(this._dbName);a.onblocked=()=>{n.a.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},a.onerror=e=>{n.a.log("Error deleting data from indexeddb",e),t(e.target.error)},a.onsuccess=()=>{n.a.log("Removed indexeddb instance: "+this._dbName),e()}}).catch(e=>{n.a.warn("unable to delete IndexedDBCryptoStore: "+e)})}getOrAddOutgoingRoomKeyRequest(e){return this._backend.getOrAddOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequest(e){return this._backend.getOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequestByState(e){return this._backend.getOutgoingRoomKeyRequestByState(e)}getAllOutgoingRoomKeyRequestsByState(e){return this._backend.getAllOutgoingRoomKeyRequestsByState(e)}getOutgoingRoomKeyRequestsByTarget(e,t,a){return this._backend.getOutgoingRoomKeyRequestsByTarget(e,t,a)}updateOutgoingRoomKeyRequest(e,t,a){return this._backend.updateOutgoingRoomKeyRequest(e,t,a)}deleteOutgoingRoomKeyRequest(e,t){return this._backend.deleteOutgoingRoomKeyRequest(e,t)}getAccount(e,t){this._backend.getAccount(e,t)}storeAccount(e,t){this._backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this._backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,a){this._backend.getSecretStorePrivateKey(e,t,a)}storeCrossSigningKeys(e,t){this._backend.storeCrossSigningKeys(e,t)}storeSecretStorePrivateKey(e,t,a){this._backend.storeSecretStorePrivateKey(e,t,a)}countEndToEndSessions(e,t){this._backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,a,n){this._backend.getEndToEndSession(e,t,a,n)}getEndToEndSessions(e,t,a){this._backend.getEndToEndSessions(e,t,a)}getAllEndToEndSessions(e,t){this._backend.getAllEndToEndSessions(e,t)}storeEndToEndSession(e,t,a,n){this._backend.storeEndToEndSession(e,t,a,n)}storeEndToEndSessionProblem(e,t,a){return this._backend.storeEndToEndSessionProblem(e,t,a)}getEndToEndSessionProblem(e,t){return this._backend.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this._backend.filterOutNotifiedErrorDevices(e)}getEndToEndInboundGroupSession(e,t,a,n){this._backend.getEndToEndInboundGroupSession(e,t,a,n)}getAllEndToEndInboundGroupSessions(e,t){this._backend.getAllEndToEndInboundGroupSessions(e,t)}addEndToEndInboundGroupSession(e,t,a,n){this._backend.addEndToEndInboundGroupSession(e,t,a,n)}storeEndToEndInboundGroupSession(e,t,a,n){this._backend.storeEndToEndInboundGroupSession(e,t,a,n)}storeEndToEndInboundGroupSessionWithheld(e,t,a,n){this._backend.storeEndToEndInboundGroupSessionWithheld(e,t,a,n)}storeEndToEndDeviceData(e,t){this._backend.storeEndToEndDeviceData(e,t)}getEndToEndDeviceData(e,t){this._backend.getEndToEndDeviceData(e,t)}storeEndToEndRoom(e,t,a){this._backend.storeEndToEndRoom(e,t,a)}getEndToEndRooms(e,t){this._backend.getEndToEndRooms(e,t)}getSessionsNeedingBackup(e){return this._backend.getSessionsNeedingBackup(e)}countSessionsNeedingBackup(e){return this._backend.countSessionsNeedingBackup(e)}unmarkSessionsNeedingBackup(e,t){return this._backend.unmarkSessionsNeedingBackup(e,t)}markSessionsNeedingBackup(e,t){return this._backend.markSessionsNeedingBackup(e,t)}addSharedHistoryInboundGroupSession(e,t,a,n){this._backend.addSharedHistoryInboundGroupSession(e,t,a,n)}getSharedHistoryInboundGroupSessions(e,t){return this._backend.getSharedHistoryInboundGroupSessions(e,t)}doTxn(e,t,a,n){return this._backend.doTxn(e,t,a,n)}}c.STORE_ACCOUNT="account",c.STORE_SESSIONS="sessions",c.STORE_INBOUND_GROUP_SESSIONS="inbound_group_sessions",c.STORE_INBOUND_GROUP_SESSIONS_WITHHELD="inbound_group_sessions_withheld",c.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS="shared_history_inbound_group_sessions",c.STORE_DEVICE_DATA="device_data",c.STORE_ROOMS="rooms",c.STORE_BACKUP="sessions_needing_backup"}).call(this,a(7))},247:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(19),s=a.n(n);class i{constructor(e,t){this.preferred=e,this.legacy=t}matches(e){return e===this.preferred||e===this.legacy}static fromString(e){const t=Object.values(i).filter(e=>e instanceof i).find(t=>t.matches(e));return t||new i(e,e)}}s()(i,"JITSI",new i("m.jitsi","jitsi")),s()(i,"STICKERPICKER",new i("m.stickerpicker","m.stickerpicker")),s()(i,"INTEGRATION_MANAGER",new i("m.integration_manager","m.integration_manager")),s()(i,"CUSTOM",new i("m.custom","m.custom"))},248:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));class n{getValueOverride(e,t,a,n){return null}onChange(e,t,a){}get settingDisabled(){return!1}}},2485:function(e,t,a){"use strict";a.d(t,"b",(function(){return m})),a.d(t,"a",(function(){return u}));var n=a(99),s=a(419),i=a(215),o=a(267),r=a(332),l=a(299),c=a(110);function d(){var e;return c.a.get().widget_build_url?c.a.get().widget_build_url:null===(e=Object(s.a)())||void 0===e?void 0:e.widget_build_url}function m(){return!!d()}async function u(e){const t=n.a.get().getRoom(e);if(!t)return;if(!i.a.canUserModifyWidgets(e))return void console.error("User not allowed to modify widgets in "+e);const a=d();if(!a)return;let s;try{const t=await fetch(`${a}?roomId=${e}`);s=await t.json()}catch(t){return void console.error("Managed hybrid widget builder failed for room "+e,t)}if(!s)return;const{widget_id:c,widget:m,layout:u}=s;let h=l.a.instance.getApps(e);if(h.some(e=>e.id===c)||r.a.roomHasPendingWidgets(e,[]))return void console.error("Managed hybrid widget already present in room "+e);try{await i.a.setRoomWidgetContent(e,c,m)}catch(t){return void console.error("Unable to add managed hybrid widget in room "+e,t)}if(!o.d.instance.canCopyLayoutToRoom(t))return;h=l.a.instance.getApps(e);const p=h.find(e=>e.id===c);p&&(o.d.instance.moveToContainer(t,p,u.container),o.d.instance.setContainerHeight(t,u.container,u.height),o.d.instance.copyLayoutToRoom(t))}},249:function(e,t,a){"use strict";a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return i})),a.d(t,"a",(function(){return o})),a.d(t,"e",(function(){return r})),a.d(t,"f",(function(){return l})),a.d(t,"b",(function(){return c}));var n=a(93);function s(e){return e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"K":e<1e5?(e/1e3).toFixed(0)+"K":e<1e7?(e/1e6).toFixed(1)+"M":e<1e8?(e/1e6).toFixed(0)+"M":(e/1e9).toFixed(1)+"B"}function i(e){return(new Intl.NumberFormat).format(e)}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";const a=1024,n=t<0?0:t,s=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,i)).toFixed(n))+" "+s[i]}function r(e){return e.match(/.{1,4}/g).join(" ")}function l(e){return"mx_Username_color"+(function(e){let t,a,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)a=e.charCodeAt(t),n=(n<<5)-n+a,n|=0;return Math.abs(n)}(e)%8+1)}function c(e,t){const a=void 0===t?0:Math.max(e.length-t,0);if(0===e.length)return"";if(1===e.length)return e[0];if(a>0)return e=e.slice(0,t),Object(n.a)("%(items)s and %(count)s others",{items:e.join(", "),count:a});{const t=e.pop();return Object(n.a)("%(items)s and %(lastItem)s",{items:e.join(", "),lastItem:t})}}},25:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(22),s=a.n(n);async function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""===e||e.endsWith("/")||(e+="/");const t=o(`${e}config.${document.domain}.json`),a=o(e+"config.json");try{const e=await t;if(0===Object.keys(e).length)throw new Error;return e}catch(e){return await a}}function o(e){return new Promise((function(t,a){s()({method:"GET",url:e,qs:{cachebuster:Date.now()}},(e,n,s)=>{try{if(e||n.status<200||n.status>=300)return n&&(404==n.status||0==n.status&&""==s)&&t({}),void a({err:e,response:n});t(JSON.parse(s))}catch(e){a({err:e})}})}))}},250:function(e,t,a){"use strict";var n=a(88),s=a(193);t.a=e=>{let{room:t,children:a}=e;const[i,o]=Object(n.useState)(null==t?void 0:t.name);return Object(s.a)(t,"Room.name",()=>{o(null==t?void 0:t.name)}),Object(n.useEffect)(()=>{o(null==t?void 0:t.name)},[t]),a?a(i):i||""}},251:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(93),d=a(94);let m=Object(d.a)("views.elements.InlineSpinner")((s=class extends l.a.PureComponent{render(){return l.a.createElement("div",{className:"mx_InlineSpinner"},l.a.createElement("div",{className:"mx_InlineSpinner_icon mx_Spinner_icon",style:{width:this.props.w,height:this.props.h},"aria-label":Object(c.a)("Loading...")},this.props.children))}},o()(s,"defaultProps",{w:16,h:16}),n=s))||n},252:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(88),s=a.n(n),i=a(102),o=a.n(i);function r(e){let{description:t,hideDescriptionIfValid:a,deriveData:n,rules:i}=e;return async function(e){let{value:r,focused:l,allowEmpty:c=!0}=e;if(!r&&c)return{valid:null,feedback:null};const d={value:r,allowEmpty:c},m=n?await n(d):void 0,u=[];let h,p,g,f=!0;if(i&&i.length)for(const e of i){if(!e.key||!e.test)continue;if(!f&&e.final)continue;if(e.skip&&e.skip.call(this,d,m))continue;const t=await e.test.call(this,d,m);if(f=f&&t,t&&e.valid){const t=e.valid.call(this,m);if(!t)continue;u.push({key:e.key,valid:!0,text:t})}else if(!t&&e.invalid){const t=e.invalid.call(this,m);if(!t)continue;u.push({key:e.key,valid:!1,text:t})}}if(!l)return{valid:f,feedback:null};if(u&&u.length&&(h=s.a.createElement("ul",{className:"mx_Validation_details"},u.map(e=>{const t=o()({mx_Validation_detail:!0,mx_Validation_valid:e.valid,mx_Validation_invalid:!e.valid});return s.a.createElement("li",{key:e.key,className:t},e.text)}))),t&&(h||!a)){const e=t.call(this,m);p=s.a.createElement("div",{className:"mx_Validation_description"},e)}return(p||h)&&(g=s.a.createElement("div",{className:"mx_Validation"},p,h)),{valid:f,feedback:g}}}},253:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(19),s=a.n(n),i=a(237),o=a(100),r=a(150),l=a(99),c=a(93),d=a(126);class m extends i.a{constructor(){super(o.a,{displayName:window.localStorage.getItem("mx_profile_displayname"),avatarUrl:window.localStorage.getItem("mx_profile_avatar_url")}),s()(this,"monitoredUser",void 0),s()(this,"onProfileUpdate",async()=>{const e=await this.matrixClient.getProfileInfo(this.matrixClient.getUserId());e.displayname?window.localStorage.setItem("mx_profile_displayname",e.displayname):window.localStorage.removeItem("mx_profile_displayname"),e.avatar_url?window.localStorage.setItem("mx_profile_avatar_url",e.avatar_url):window.localStorage.removeItem("mx_profile_avatar_url"),await this.updateState({displayName:e.displayname,avatarUrl:e.avatar_url})}),s()(this,"onStateEvents",Object(r.throttle)(async e=>{const t=l.a.get().getUserId();"m.room.member"===e.getType()&&e.getSender()===t&&e.getStateKey()===t&&await this.onProfileUpdate()},200,{trailing:!0,leading:!0}))}static get instance(){return m.internalInstance}get displayName(){return this.matrixClient?this.matrixClient.isGuest()?Object(c.a)("Guest"):this.state.displayName?this.state.displayName:this.matrixClient.getUserId():this.state.displayName||null}get avatarMxc(){return this.state.avatarUrl||null}getHttpAvatarUrl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.avatarMxc)return null;const t=Object(d.b)(this.avatarMxc);return!e||e<=0?t.srcHttp:t.getSquareThumbnailHttp(e)}async onNotReady(){this.monitoredUser&&(this.monitoredUser.removeListener("User.displayName",this.onProfileUpdate),this.monitoredUser.removeListener("User.avatarUrl",this.onProfileUpdate)),this.matrixClient&&this.matrixClient.removeListener("RoomState.events",this.onStateEvents),await this.reset({})}async onReady(){const e=this.matrixClient.getUserId();this.monitoredUser=this.matrixClient.getUser(e),this.monitoredUser&&(this.monitoredUser.on("User.displayName",this.onProfileUpdate),this.monitoredUser.on("User.avatarUrl",this.onProfileUpdate)),this.matrixClient.on("RoomState.events",this.onStateEvents),await this.onProfileUpdate()}async onAction(e){}}s()(m,"internalInstance",new m)},256:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(639);function s(e){this._eventTimelineSet=e,this._roomId=e.room?e.room.roomId:null,this._events=[],this._baseIndex=0,this._startState=new n.a(this._roomId),this._startState.paginationToken=null,this._endState=new n.a(this._roomId),this._endState.paginationToken=null,this._prevTimeline=null,this._nextTimeline=null,this._paginationRequests={b:null,f:null},this._name=this._roomId+":"+(new Date).toISOString()}s.BACKWARDS="b",s.FORWARDS="f",s.prototype.initialiseState=function(e){if(this._events.length>0)throw new Error("Cannot initialise state after events are added");for(const t of e)Object.freeze(t);this._startState.setStateEvents(e),this._endState.setStateEvents(e)},s.prototype.forkLive=function(e){const t=this.getState(e),a=new s(this._eventTimelineSet);return a._startState=t.clone(),a._endState=t,this._endState=t.clone(),a},s.prototype.fork=function(e){const t=this.getState(e),a=new s(this._eventTimelineSet);return a._startState=t.clone(),a._endState=t.clone(),a},s.prototype.getRoomId=function(){return this._roomId},s.prototype.getFilter=function(){return this._eventTimelineSet.getFilter()},s.prototype.getTimelineSet=function(){return this._eventTimelineSet},s.prototype.getBaseIndex=function(){return this._baseIndex},s.prototype.getEvents=function(){return this._events},s.prototype.getState=function(e){if(e==s.BACKWARDS)return this._startState;if(e==s.FORWARDS)return this._endState;throw new Error("Invalid direction '"+e+"'")},s.prototype.getPaginationToken=function(e){return this.getState(e).paginationToken},s.prototype.setPaginationToken=function(e,t){this.getState(t).paginationToken=e},s.prototype.getNeighbouringTimeline=function(e){if(e==s.BACKWARDS)return this._prevTimeline;if(e==s.FORWARDS)return this._nextTimeline;throw new Error("Invalid direction '"+e+"'")},s.prototype.setNeighbouringTimeline=function(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==s.BACKWARDS)this._prevTimeline=e;else{if(t!=s.FORWARDS)throw new Error("Invalid direction '"+t+"'");this._nextTimeline=e}this.setPaginationToken(null,t)},s.prototype.addEvent=function(e,t){const a=t?this._startState:this._endState,n=this.getTimelineSet();let i;n.room&&n.room.getUnfilteredTimelineSet()===n&&(s.setEventMetadata(e,a,t),e.isState()&&(a.setStateEvents([e]),e.sender&&("m.room.member"!==e.getType()||t)||s.setEventMetadata(e,a,t))),i=t?0:this._events.length,this._events.splice(i,0,e),t&&this._baseIndex++},s.setEventMetadata=function(e,t,a){e.sender=t.getSentinelMember(e.getSender()),"m.room.member"===e.getType()&&(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&a&&(e.forwardLooking=!1)},s.prototype.removeEvent=function(e){for(let t=this._events.length-1;t>=0;t--){const a=this._events[t];if(a.getId()==e)return this._events.splice(t,1),t<this._baseIndex&&this._baseIndex--,a}return null},s.prototype.toString=function(){return this._name}},257:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(8),s=a(444),i=a(1);function o(e,t){this.roomId=e,this.userId=t,this.typing=!1,this.name=t,this.rawDisplayName=t,this.powerLevel=0,this.powerLevelNorm=0,this.user=null,this.membership=null,this.events={member:null},this._isOutOfBand=!1,this._updateModifiedTime()}i.m(o,n.EventEmitter),o.prototype.markOutOfBand=function(){this._isOutOfBand=!0},o.prototype.isOutOfBand=function(){return this._isOutOfBand},o.prototype.setMembershipEvent=function(e,t){if("m.room.member"!==e.getType())return;this._isOutOfBand=!1,this.events.member=e;const a=this.membership;this.membership=e.getDirectionalContent().membership;const n=this.name;this.name=function(e,t,a){if(!t||t===e)return e;if(!i.v(t))return e;if(!a)return t;let n=r.test(t);n||(n=l.test(t));if(!n){const s=a.getUserIdsWithDisplayName(t);n=s.some(t=>t!==e)}if(n)return t+" ("+e+")";return t}(this.userId,e.getDirectionalContent().displayname,t),this.rawDisplayName=e.getDirectionalContent().displayname||this.userId,a!==this.membership&&(this._updateModifiedTime(),this.emit("RoomMember.membership",e,this,a)),n!==this.name&&(this._updateModifiedTime(),this.emit("RoomMember.name",e,this,n))},o.prototype.setPowerLevelEvent=function(e){if("m.room.power_levels"!==e.getType())return;const t=e.getDirectionalContent();let a=t.users_default||0;const n=t.users||{};Object.values(n).forEach((function(e){a=Math.max(a,e)}));const s=this.powerLevel,i=this.powerLevelNorm;void 0!==n[this.userId]?this.powerLevel=n[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,a>0&&(this.powerLevelNorm=100*this.powerLevel/a),s===this.powerLevel&&i===this.powerLevelNorm||(this._updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))},o.prototype.setTypingEvent=function(e){if("m.typing"!==e.getType())return;const t=this.typing;this.typing=!1;const a=e.getContent().user_ids;Array.isArray(a)&&(-1!==a.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this._updateModifiedTime(),this.emit("RoomMember.typing",e,this)))},o.prototype._updateModifiedTime=function(){this._modified=Date.now()},o.prototype.getLastModifiedTime=function(){return this._modified},o.prototype.isKicked=function(){return"leave"===this.membership&&this.events.member.getSender()!==this.events.member.getStateKey()},o.prototype.getDMInviter=function(){if(this.events.member){const e=this.events.member;let t=e.getContent(),a=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),a=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return a}},o.prototype.getAvatarUrl=function(e,t,a,n,i,o){void 0===i&&(i=!0);const r=this.getMxcAvatarUrl();if(!r&&!i)return null;const l=Object(s.a)(e,r,t,a,n,o);return l||null},o.prototype.getMxcAvatarUrl=function(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:null};const r=/@.+:.+/,l=/[\u200E\u200F\u202A-\u202F]/},265:function(e,t,a){"use strict";(function(e){var n=a(8),s=a.n(n);let i=!0;class o extends s.a{constructor(e){super(),this._matrixClient=e,this._userGroups={},this._groupProfiles={},this._groupProfilesPromise={},this._usersPending={},this._usersInFlight={},this._debounceTimeoutID=null}groupSupport(){return i}invalidatePublicisedGroups(e){delete this._userGroups[e]}cachedPublicisedGroups(e){return this._userGroups[e]}getPublicisedGroupsCached(e,t){return this._userGroups[t]?Promise.resolve(this._userGroups[t]):this._usersPending[t]?this._usersPending[t].prom:this._usersInFlight[t]?this._usersInFlight[t].prom:(this._usersPending[t]={},this._usersPending[t].prom=new Promise((e,a)=>{this._usersPending[t].resolve=e,this._usersPending[t].reject=a}).then(e=>(this._userGroups[t]=e,setTimeout(()=>{delete this._userGroups[t]},18e5),this._userGroups[t])).catch(e=>{if("M_UNRECOGNIZED"===e.errcode)return console.warn("Cannot display flair, server does not support groups"),void(i=!1);throw console.error("Could not get groups for user",t,e),e}).finally(()=>{delete this._usersInFlight[t]}),this._debounceTimeoutID&&clearTimeout(this._debounceTimeoutID),this._debounceTimeoutID=setTimeout(()=>{this._batchedGetPublicGroups(e)},200),this._usersPending[t].prom)}async _batchedGetPublicGroups(e){this._usersInFlight=this._usersPending,this._usersPending={};let t={users:[]};try{t=await e.getPublicisedGroups(Object.keys(this._usersInFlight))}catch(e){return void Object.keys(this._usersInFlight).forEach(t=>{this._usersInFlight[t]&&this._usersInFlight[t].reject(e)})}const a=t.users;Object.keys(this._usersInFlight).forEach(e=>{this._usersInFlight[e]&&this._usersInFlight[e].resolve(a[e]||[])})}getGroupProfileCachedFast(e,t){return e&&t?this._groupProfiles[t]?this._groupProfiles[t]:(this.getGroupProfileCached(e,t),null):null}async getGroupProfileCached(e,t){if(this._groupProfiles[t])return this._groupProfiles[t];if(this._groupProfilesPromise[t]){try{await this._groupProfilesPromise[t]}catch(e){return null}return this._groupProfiles[t]}let a;console.log("FlairStore: Request group profile of "+t),this._groupProfilesPromise[t]=e.getGroupProfile(t);try{a=await this._groupProfilesPromise[t]}catch(e){return console.log("FlairStore: Failed to get group profile for "+t,e),delete this._groupProfilesPromise[t],null}return this._groupProfiles[t]={groupId:t,avatarUrl:a.avatar_url,name:a.name,shortDescription:a.short_description},delete this._groupProfilesPromise[t],console.log("FlairStore: Emit updateGroupProfile for "+t),this.emit("updateGroupProfile"),setTimeout(()=>{this.refreshGroupProfile(e,t)},18e5),this._groupProfiles[t]}refreshGroupProfile(e,t){return delete this._groupProfiles[t],this.getGroupProfileCached(e,t)}}void 0===e.singletonFlairStore&&(e.singletonFlairStore=new o),t.a=e.singletonFlairStore}).call(this,a(7))},266:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return L})),a.d(t,"b",(function(){return F}));var n=a(258),s=a.n(n),i=a(8),o=a(2403),r=a(146),l=a(2404),c=a(238),d=a(514),m=a(2405),u=a(1),h=a(256),p=a(475),g=a(418),f=a(485),v=a(213),b=a(775),y=a(2408),E=a(0),_=a(329),S=a(584),C=a(588),w=a(587),O=a(346),x=a(444),R=a(8474),k=a(1300),I=a(2421),T=a(589),P=a(2422),N=a(140),D=a(2423),j=a(223),A=a.n(j),M=a(294),U=a(1301);const L=Object(S.c)();class F extends i.EventEmitter{constructor(e){super(),s()(this,"reEmitter",new b.a(this)),s()(this,"olmVersion",null),s()(this,"usingExternalCrypto",!1),s()(this,"store",void 0),s()(this,"deviceId",void 0),s()(this,"credentials",void 0),s()(this,"pickleKey",void 0),s()(this,"scheduler",void 0),s()(this,"clientRunning",!1),s()(this,"timelineSupport",!1),s()(this,"urlPreviewCache",{}),s()(this,"unstableClientRelationAggregation",!1),s()(this,"identityServer",void 0),s()(this,"sessionStore",void 0),s()(this,"http",void 0),s()(this,"crypto",void 0),s()(this,"cryptoCallbacks",void 0),s()(this,"callEventHandler",void 0),s()(this,"supportsCallTransfer",!1),s()(this,"forceTURN",!1),s()(this,"iceCandidatePoolSize",0),s()(this,"idBaseUrl",void 0),s()(this,"baseUrl",void 0),s()(this,"canSupportVoip",!1),s()(this,"peekSync",null),s()(this,"isGuestAccount",!1),s()(this,"ongoingScrollbacks",{}),s()(this,"notifTimelineSet",null),s()(this,"cryptoStore",void 0),s()(this,"verificationMethods",void 0),s()(this,"fallbackICEServerAllowed",!1),s()(this,"roomList",void 0),s()(this,"syncApi",void 0),s()(this,"pushRules",void 0),s()(this,"syncLeftRoomsPromise",void 0),s()(this,"syncedLeftRooms",!1),s()(this,"clientOpts",void 0),s()(this,"clientWellKnownIntervalID",void 0),s()(this,"canResetTimelineCallback",void 0),s()(this,"pushProcessor",new p.a(this)),s()(this,"serverVersionsPromise",void 0),s()(this,"cachedCapabilities",void 0),s()(this,"clientWellKnown",void 0),s()(this,"clientWellKnownPromise",void 0),s()(this,"turnServers",[]),s()(this,"turnServersExpiry",0),s()(this,"checkTurnServersIntervalID",void 0),s()(this,"exportedOlmDeviceToImport",void 0),s()(this,"txnCtr",0),s()(this,"startCallEventHandler",()=>{this.isInitialSyncComplete()&&(this.callEventHandler.start(),this.off("sync",this.startCallEventHandler))}),e.baseUrl=u.h(e.baseUrl),e.idBaseUrl=u.h(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.usingExternalCrypto=e.usingExternalCrypto,this.store=e.store||new l.a,this.deviceId=e.deviceId||null;const t=e.userId||null;this.credentials={userId:t},this.http=new f.d(this,{baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,request:e.request,prefix:f.h,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader}),e.deviceToImport?this.deviceId?E.a.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?E.a.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this.exportedOlmDeviceToImport=e.deviceToImport.olmDevice):E.a.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction(async e=>{const t=this.getRoom(e.getRoomId());e.status!==r.a.SENDING&&this.updatePendingEventStatus(t,e,r.a.SENDING);const a=await this.sendEventHttpRequest(e);return t&&t.updatePendingEvent(e,r.a.SENT,a.event_id),a});Object(c.g)(this,void 0,void 0)&&(this.callEventHandler=new m.a(this),this.canSupportVoip=!0,this.on("sync",this.startCallEventHandler)),this.timelineSupport=Boolean(e.timelineSupport),this.unstableClientRelationAggregation=!!e.unstableClientRelationAggregation,this.cryptoStore=e.cryptoStore,this.sessionStore=e.sessionStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.roomList=new y.a(this.cryptoStore),this.on("Event.decrypted",e=>{const t=e.getPushActions(),a=this.pushProcessor.actionsForEvent(e);e.setPushActions(a);const n=this.getRoom(e.getRoomId());if(!n)return;const s=n.getUnreadNotificationCount("highlight"),i=!(!t||!t.tweaks)&&!!t.tweaks.highlight,o=!(!a||!a.tweaks)&&!!a.tweaks.highlight;if((i!==o||s>0)&&!n.hasUserReadEvent(this.getUserId(),e.getId())){let e=s;o&&!i&&e++,!o&&i&&e--,n.setUnreadNotificationCount("highlight",e);n.getUnreadNotificationCount("total")<e&&n.setUnreadNotificationCount("total",e)}}),this.on("Room.receipt",(e,t)=>{if(t&&this.isRoomEncrypted(t.roomId)){const a=e.getContent();if(!(Object.keys(a).filter(e=>Object.keys(a[e]["m.read"]).includes(this.getUserId())).length>0))return;const n=20,s=t.getLiveTimeline().getEvents();let i=0;for(let e=s.length-1;e>=0;e--){if(e===s.length-n)return;const a=s[e];if(t.hasUserReadEvent(this.getUserId(),a.getId()))break;const o=this.getPushActionsForEvent(a);i+=o.tweaks&&o.tweaks.highlight?1:0}t.setUnreadNotificationCount("highlight",i)}})}async startClient(e){if(this.clientRunning)return;this.clientRunning=!0,"number"==typeof e&&(e={initialSyncLimit:e});const t=this.getUserId();t&&this.store.storeUser(new O.a(t)),this.crypto&&(this.crypto.uploadDeviceKeys(),this.crypto.start()),this.canSupportVoip&&(this.checkTurnServersIntervalID=setInterval(()=>{this.checkTurnServers()},6e5),this.checkTurnServers()),this.syncApi&&(E.a.error("Still have sync object whilst not running: stopping old one"),this.syncApi.stop()),this.clientOpts=Object.assign({},e),this.clientOpts.crypto=this.crypto,this.clientOpts.canResetEntireTimeline=e=>!!this.canResetTimelineCallback&&this.canResetTimelineCallback(e),this.syncApi=new o.a(this,this.clientOpts),this.syncApi.sync(),void 0!==this.clientOpts.clientWellKnownPollPeriod&&(this.clientWellKnownIntervalID=setInterval(()=>{this.fetchClientWellKnown()},1e3*this.clientOpts.clientWellKnownPollPeriod),this.fetchClientWellKnown())}stopClient(){var t,a,n,s;E.a.log("stopping MatrixClient"),this.clientRunning=!1,null===(t=this.syncApi)||void 0===t||t.stop(),this.syncApi=null,null===(a=this.crypto)||void 0===a||a.stop(),null===(n=this.peekSync)||void 0===n||n.stopPeeking(),null===(s=this.callEventHandler)||void 0===s||s.stop(),this.callEventHandler=null,e.clearInterval(this.checkTurnServersIntervalID),void 0!==this.clientWellKnownIntervalID&&e.clearInterval(this.clientWellKnownIntervalID)}async rehydrateDevice(){if(this.crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(!this.cryptoCallbacks.getDehydrationKey)return;const t=await this.getDehydratedDevice();if(!t)return;if(!t.device_data||!t.device_id)return void E.a.info("no dehydrated device found");const a=new e.Olm.Account;try{const e=t.device_data;if(e.algorithm!==k.a)return void E.a.warn("Wrong algorithm for dehydrated device");E.a.log("unpickling dehydrated device");const n=await this.cryptoCallbacks.getDehydrationKey(e,t=>{a.unpickle(new Uint8Array(t),e.account)});a.unpickle(n,e.account),E.a.log("unpickled device");if(!0===(await this.http.authedRequest(void 0,"POST","/dehydrated_device/claim",void 0,{device_id:t.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).success){this.deviceId=t.device_id,E.a.info("using dehydrated device");const e=this.pickleKey||"DEFAULT_KEY";return this.exportedOlmDeviceToImport={pickledAccount:a.pickle(e),sessions:[],pickleKey:e},a.free(),this.deviceId}return a.free(),void E.a.info("not using dehydrated device")}catch(e){a.free(),E.a.warn("could not unpickle",e)}}async getDehydratedDevice(){try{return await this.http.authedRequest(void 0,"GET","/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(e){return void E.a.info("could not get dehydrated device",e.toString())}}async setDehydrationKey(e,t,a){if(this.crypto)return await this.crypto._dehydrationManager.setKeyAndQueueDehydration(e,t,a);E.a.warn("not dehydrating device if crypto is not enabled")}async createDehydratedDevice(e,t,a){if(this.crypto)return await this.crypto._dehydrationManager.setKey(e,t,a),await this.crypto._dehydrationManager.dehydrateDevice();E.a.warn("not dehydrating device if crypto is not enabled")}async exportDevice(){if(this.crypto)return{userId:this.credentials.userId,deviceId:this.deviceId,olmDevice:await this.crypto._olmDevice.export()};E.a.warn("not exporting device if crypto is not enabled")}clearStores(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];return e.push(this.store.deleteAllData()),this.cryptoStore&&e.push(this.cryptoStore.deleteAllData()),Promise.all(e).then()}getUserId(){return this.credentials&&this.credentials.userId?this.credentials.userId:null}getDomain(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null}getDeviceId(){return this.deviceId}supportsVoip(){return this.canSupportVoip}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}createCall(e){return Object(c.g)(this,e)}getSyncState(){return this.syncApi?this.syncApi.getSyncState():null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){const e=this.getSyncState();return!!e&&(e===I.a.Prepared||e===I.a.Syncing)}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){return this.syncApi.retryImmediately()}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=(new Date).getTime();return this.cachedCapabilities&&!e&&t<this.cachedCapabilities.expiration?(E.a.log("Returning cached capabilities"),Promise.resolve(this.cachedCapabilities.capabilities)):this.http.authedRequest(void 0,"GET","/capabilities").catch(e=>(E.a.error(e),null)).then(e=>{e||(e={});const a=e.capabilities||{},n=Object.keys(a).length?216e5:6e4+5e3*Math.random();return this.cachedCapabilities={capabilities:a,expiration:t+n},E.a.log("Caching capabilities: ",a),a})}async initCrypto(){if(!Object(S.c)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this.crypto)return void E.a.warn("Attempt to re-initialise e2e encryption on MatrixClient");if(!this.sessionStore)throw new Error("Cannot enable encryption: no sessionStore provided");if(!this.cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");E.a.log("Crypto: Starting up crypto store..."),await this.cryptoStore.startup(),E.a.log("Crypto: initialising roomlist..."),await this.roomList.init();const e=this.getUserId();if(null===e)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===this.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const t=new S.a(this,this.sessionStore,e,this.deviceId,this.store,this.cryptoStore,this.roomList,this.verificationMethods);this.reEmitter.reEmit(t,["crypto.keyBackupFailed","crypto.keyBackupSessionsRemaining","crypto.roomKeyRequest","crypto.roomKeyRequestCancellation","crypto.warning","crypto.devicesUpdated","crypto.willUpdateDevices","deviceVerificationChanged","userTrustStatusChanged","crossSigning.keysChanged"]),E.a.log("Crypto: initialising crypto object..."),await t.init({exportedOlmDevice:this.exportedOlmDeviceToImport,pickleKey:this.pickleKey}),delete this.exportedOlmDeviceToImport,this.olmVersion=S.a.getOlmVersion(),t.registerEventHandlers(this),this.crypto=t}isCryptoEnabled(){return!!this.crypto}getDeviceEd25519Key(){return this.crypto?this.crypto.getDeviceEd25519Key():null}getDeviceCurve25519Key(){return this.crypto?this.crypto.getDeviceCurve25519Key():null}uploadKeys(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.uploadDeviceKeys()}downloadKeys(e,t){return this.crypto?this.crypto.downloadKeys(e,t):Promise.reject(new Error("End-to-end encryption disabled"))}getStoredDevicesForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(e)||[]}getStoredDevice(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(e,t)||null}setDeviceVerified(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=this.setDeviceVerification(e,t,a,null,null);return e==this.credentials.userId&&this.checkKeyBackup(),n}setDeviceBlocked(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.setDeviceVerification(e,t,null,a,null)}setDeviceKnown(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.setDeviceVerification(e,t,null,null,a)}async setDeviceVerification(e,t,a,n,s){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.setDeviceVerification(e,t,a,n,s)}requestVerificationDM(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(e,t)}findVerificationRequestDMInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.findVerificationRequestDMInProgress(e)}getVerificationRequestsToDeviceInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(e)}requestVerification(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(e,t)}beginKeyVerification(e,t,a){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(e,t,a)}checkSecretStorageKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStorageKey(e,t)}setGlobalBlacklistUnverifiedDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalBlacklistUnverifiedDevices(e)}getGlobalBlacklistUnverifiedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalBlacklistUnverifiedDevices()}setGlobalErrorOnUnknownDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalErrorOnUnknownDevices(e)}getGlobalErrorOnUnknownDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalErrorOnUnknownDevices()}getCrossSigningId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.a.Master;if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(e)}getStoredCrossSigningForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredCrossSigningForUser(e)}checkUserTrust(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkUserTrust(e)}checkDeviceTrust(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkDeviceTrust(e,t)}checkOwnCrossSigningTrust(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkOwnCrossSigningTrust(e)}checkCrossSigningPrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(e,t)}legacyDeviceVerification(e,t,a){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(e,t,a)}prepareToEncrypt(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.prepareToEncrypt(e)}isCrossSigningReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isCrossSigningReady()}bootstrapCrossSigning(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapCrossSigning(e)}getCryptoTrustCrossSignedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCryptoTrustCrossSignedDevices()}setCryptoTrustCrossSignedDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setCryptoTrustCrossSignedDevices(e)}countSessionsNeedingBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}getEventEncryptionInfo(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getEventEncryptionInfo(e)}createRecoveryKeyFromPassphrase(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.createRecoveryKeyFromPassphrase(e)}isSecretStorageReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStorageReady()}bootstrapSecretStorage(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapSecretStorage(e)}addSecretStorageKey(e,t,a){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.addSecretStorageKey(e,t,a)}hasSecretStorageKey(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.hasSecretStorageKey(e)}storeSecret(e,t,a){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.storeSecret(e,t,a)}getSecret(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getSecret(e)}isSecretStored(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStored(e,t)}requestSecret(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(e,t)}getDefaultSecretStorageKeyId(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getDefaultSecretStorageKeyId()}setDefaultSecretStorageKeyId(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setDefaultSecretStorageKeyId(e)}checkSecretStoragePrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(e,t)}getEventSenderDeviceInfo(e){return this.crypto?this.crypto.getEventSenderDeviceInfo(e):null}async isEventSenderVerified(e){const t=await this.getEventSenderDeviceInfo(e);return!!t&&t.isVerified()}cancelAndResendEventRoomKeyRequest(e){return e.cancelAndResendKeyRequest(this.crypto,this.getUserId())}setRoomEncryption(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(e,t)}isRoomEncrypted(e){const t=this.getRoom(e);if(!t)return!1;return!!t.currentState.getStateEvents("m.room.encryption","")||this.roomList.isRoomEncrypted(e)}forceDiscardSession(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");this.crypto.forceDiscardSession(e)}exportRoomKeys(){return this.crypto?this.crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}importRoomKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.importRoomKeys(e,t)}checkKeyBackup(){return this.crypto._backupManager.checkKeyBackup()}getKeyBackupVersion(){return this.http.authedRequest(void 0,"GET","/room_keys/version",void 0,void 0,{prefix:f.i}).then(e=>{if(e.algorithm!==v.MEGOLM_BACKUP_ALGORITHM){const t="Unknown backup algorithm: "+e.algorithm;return Promise.reject(t)}if("object"==typeof e.auth_data&&e.auth_data.public_key)return e;{const e="Invalid backup data returned";return Promise.reject(e)}}).catch(e=>{if("M_NOT_FOUND"===e.errcode)return null;throw e})}isKeyBackupTrusted(e){return this.crypto._backupManager.isKeyBackupTrusted(e)}getKeyBackupEnabled(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto._backupManager.getKeyBackupEnabled()}enableKeyBackup(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto._backupManager.enableKeyBackup(e)}disableKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto._backupManager.disableKeyBackup()}async prepareKeyBackupVersion(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{secureSecretStorage:!1};if(!this.crypto)throw new Error("End-to-end encryption disabled");const{algorithm:a,auth_data:n,recovery_key:s,privateKey:i}=await this.crypto._backupManager.prepareKeyBackupVersion(e);return t.secureSecretStorage&&(await this.storeSecret("m.megolm_backup.v1",Object(v.encodeBase64)(i)),E.a.info("Key backup private key stored in secret storage")),{algorithm:a,auth_data:n,recovery_key:s}}isKeyBackupKeyStored(){return Promise.resolve(this.isSecretStored("m.megolm_backup.v1",!1))}async createKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto._backupManager.createKeyBackupVersion(e);const t={algorithm:e.algorithm,auth_data:e.auth_data};await this.crypto._signObject(t.auth_data),this.cryptoCallbacks.getCrossSigningKey&&this.crypto._crossSigningInfo.getId()&&await this.crypto._crossSigningInfo.signObject(t.auth_data,"master");const a=await this.http.authedRequest(void 0,"POST","/room_keys/version",void 0,t,{prefix:f.i});return await this.checkKeyBackup(),this.getKeyBackupEnabled()||E.a.error("Key backup not usable even though we just created it"),a}deleteKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto._backupManager.version&&this.crypto._backupManager.disableKeyBackup();const t=u.g("/room_keys/version/$version",{$version:e});return this.http.authedRequest(void 0,"DELETE",t,void 0,void 0,{prefix:f.i})}makeKeyBackupPath(e,t,a){let n;n=void 0!==t?u.g("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?u.g("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys";return{path:n,queryData:void 0===a?void 0:{version:a}}}sendKeyBackup(e,t,a,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");const s=this.makeKeyBackupPath(e,t,a);return this.http.authedRequest(void 0,"PUT",s.path,s.queryData,n,{prefix:f.i})}async scheduleAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto._backupManager.scheduleAllGroupSessionsForBackup()}flagAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto._backupManager.flagAllGroupSessionsForBackup()}isValidRecoveryKey(e){try{return Object(C.a)(e),!0}catch(e){return!1}}keyBackupKeyFromPassword(e,t){return Object(w.b)(t.auth_data,e)}keyBackupKeyFromRecoveryKey(e){return Object(C.a)(e)}async restoreKeyBackupWithPassword(e,t,a,n,s){const i=await Object(w.b)(n.auth_data,e);return this.restoreKeyBackup(i,t,a,n,s)}async restoreKeyBackupWithSecretStorage(e,t,a,n){const s=await this.getSecret("m.megolm_backup.v1"),i=Object(S.b)(s);if(i){const[e]=await this.crypto.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",i,[e])}const o=Object(v.decodeBase64)(i||s);return this.restoreKeyBackup(o,t,a,e,n)}restoreKeyBackupWithRecoveryKey(e,t,a,n,s){const i=Object(C.a)(e);return this.restoreKeyBackup(i,t,a,n,s)}async restoreKeyBackupWithCache(e,t,a,n){const s=await this.crypto.getSessionBackupPrivateKey();if(!s)throw new Error("Couldn't get key");return this.restoreKeyBackup(s,e,t,a,n)}async restoreKeyBackup(e,t,a,n,s){const i=null==s?void 0:s.cacheCompleteCallback,o=null==s?void 0:s.progressCallback;if(!this.crypto)throw new Error("End-to-end encryption disabled");let r=0,l=[];const c=this.makeKeyBackupPath(t,a,n.version),d=await U.a.makeAlgorithm(n,async()=>e);try{if(!await d.keyMatches(e))return Promise.reject(new f.c({errcode:F.RESTORE_BACKUP_ERROR_BAD_KEY}));this.crypto.storeSessionBackupPrivateKey(e).catch(e=>{E.a.warn("Error caching session backup key:",e)}).then(i),o&&o({stage:"fetch"});const n=await this.http.authedRequest(void 0,"GET",c.path,c.queryData,void 0,{prefix:f.i});if(n.rooms)for(const[e,t]of Object.entries(n.rooms)){if(!t.sessions)continue;r+=Object.keys(t.sessions).length;const a=await d.decryptSessions(t.sessions);for(const t of a)t.room_id=e,l.push(t)}else if(n.sessions){r=Object.keys(n.sessions).length,l=await d.decryptSessions(n.sessions);for(const e of l)e.room_id=t}else{r=1;try{const[e]=await d.decryptSessions({[a]:n});e.room_id=t,e.session_id=a,l.push(e)}catch(e){E.a.log("Failed to decrypt megolm session from backup",e)}}}finally{d.free()}return await this.importRoomKeys(l,{progressCallback:o,untrusted:!0,source:"backup"}),await this.checkKeyBackup(),{total:r,imported:l.length}}deleteKeysFromBackup(e,t,a){if(!this.crypto)throw new Error("End-to-end encryption disabled");const n=this.makeKeyBackupPath(e,t,a);return this.http.authedRequest(void 0,"DELETE",n.path,n.queryData,void 0,{prefix:f.i})}async sendSharedHistoryKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");const a=this.roomList.getRoomEncryption(e);if(!a)return void E.a.error("Unknown room.  Not sharing decryption keys");const n=await this.crypto.downloadKeys(t),s={};for(const[e,t]of Object.entries(n))s[e]=Object.values(t);const i=this.crypto._getRoomDecryptor(e,a.algorithm);i.sendSharedHistoryInboundSessions?await i.sendSharedHistoryInboundSessions(s):E.a.warn("Algorithm does not support sharing previous keys",a.algorithm)}getGroup(e){return this.store.getGroup(e)}getGroups(){return this.store.getGroups()}getMediaConfig(e){return this.http.authedRequest(e,"GET","/config",void 0,void 0,{prefix:f.g})}getRoom(e){return this.store.getRoom(e)}getRooms(){return this.store.getRooms()}getVisibleRooms(){const e=this.store.getRooms(),t=new Set;for(const a of e){const e=a.currentState.getStateEvents("m.room.create","");if(e){const a=e.getContent().predecessor;a&&a.room_id&&t.add(a.room_id)}}return e.filter(e=>!e.currentState.getStateEvents("m.room.tombstone","")||!t.has(e.roomId))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,t,a){const n=u.g("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e}),s=Object(f.j)(5,()=>this.http.authedRequest(void 0,"PUT",n,void 0,t));return a&&s.then(e=>a(null,e),a),s}getAccountData(e){return this.store.getAccountData(e)}async getAccountDataFromServer(e){if(this.isInitialSyncComplete()){const t=this.store.getAccountData(e);return t?t.getContent():null}const t=u.g("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});try{return await this.http.authedRequest(void 0,"GET",t,void 0)}catch(e){if(e.data&&"M_NOT_FOUND"===e.data.errcode)return null;throw e}}getIgnoredUsers(){const e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e,t){const a={ignored_users:{}};return e.map(e=>a.ignored_users[e]={}),this.setAccountData("m.ignored_user_list",a,t)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}async joinRoom(e,t,a){if(u.n(t))throw new Error("Expected 'opts' object, got function.");void 0===(t=t||{}).syncRoom&&(t.syncRoom=!0);const n=this.getRoom(e);if(n&&n.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(n);let s=Promise.resolve();t.inviteSignUrl&&(s=this.http.requestOtherUrl(void 0,"POST",t.inviteSignUrl,{mxid:this.credentials.userId}));const i={};t.viaServers&&(i.server_name=t.viaServers);const r={qsStringifyOptions:{arrayFormat:"repeat"}};try{const n={},l=await s;l&&(n.third_party_signed=l);const c=u.g("/join/$roomid",{$roomid:e}),d=(await this.http.authedRequest(void 0,"POST",c,i,n,r)).room_id,m=new o.a(this,this.clientOpts).createRoom(d);return t.syncRoom,null==a||a(null,m),m}catch(e){throw null==a||a(e),e}}resendEvent(e,t){return this.updatePendingEventStatus(t,e,r.a.SENDING),this.encryptAndSendEvent(t,e)}cancelPendingEvent(e){if([r.a.QUEUED,r.a.NOT_SENT].indexOf(e.status)<0)throw new Error("cannot cancel an event with status "+e.status);this.scheduler&&this.scheduler.removeEventFromQueue(e);const t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,r.a.CANCELLED)}setRoomName(e,t,a){return this.sendStateEvent(e,"m.room.name",{name:t},void 0,a)}setRoomTopic(e,t,a){return this.sendStateEvent(e,"m.room.topic",{topic:t},void 0,a)}getRoomTags(e,t){const a=u.g("/user/$userId/rooms/$roomId/tags/",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(t,"GET",a,void 0)}setRoomTag(e,t,a,n){const s=u.g("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(n,"PUT",s,void 0,a)}deleteRoomTag(e,t,a){const n=u.g("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(a,"DELETE",n,void 0,void 0)}setRoomAccountData(e,t,a,n){const s=u.g("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(n,"PUT",s,void 0,a)}setPowerLevel(e,t,a,n,s){let i={users:{}};n&&"m.room.power_levels"===n.getType()&&(i=u.d(n.getContent())),i.users[t]=a;const o=u.g("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this.http.authedRequest(s,"PUT",o,void 0,i)}sendEvent(e,t,a,n,s){return this.sendCompleteEvent(e,{type:t,content:a},n,s)}sendCompleteEvent(e,t,a,n){u.n(a)&&(n=a,a=void 0),a||(a=this.makeTxnId());const s=new r.b(Object.assign(t,{event_id:"~"+e+":"+a,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),i=this.getRoom(e),o=s.getAssociatedId();if(o&&o.startsWith("~")){const e=i.getPendingEvents().find(e=>e.getId()===o);e.once("Event.localEventIdReplaced",()=>{s.updateAssociatedId(e.getId())})}const l=s.getType();return E.a.log(`sendEvent of type ${l} in ${e} with txnId ${a}`),s.setTxnId(a),s.setStatus(r.a.SENDING),i&&i.addPendingEvent(s,a),s.status===r.a.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(i,s,n)}encryptAndSendEvent(e,t,a){return Promise.resolve().then(()=>{const a=this.encryptEventIfNeeded(t,e);return a?(this.updatePendingEventStatus(e,t,r.a.ENCRYPTING),a.then(()=>this.updatePendingEventStatus(e,t,r.a.SENDING))):null}).then(()=>{let a;return this.scheduler&&(a=this.scheduler.queueEvent(t),a&&this.scheduler.getQueueForEvent(t).length>1&&this.updatePendingEventStatus(e,t,r.a.QUEUED)),a||(a=this.sendEventHttpRequest(t),e&&(a=a.then(a=>(e.updatePendingEvent(t,r.a.SENT,a.event_id),a)))),a}).then(e=>(null==a||a(null,e),e)).catch(n=>{E.a.error("Error sending event",n.stack||n);try{t.error=n,this.updatePendingEventStatus(e,t,r.a.NOT_SENT),n.event=t,null==a||a(n)}catch(e){E.a.error("Exception in error handler!",e.stack||n)}throw n})}encryptEventIfNeeded(e,t){if(e.isEncrypted())return null;if(!this.isRoomEncrypted(e.getRoomId()))return null;if(!this.crypto&&this.usingExternalCrypto)return null;if(e.getType()===N.a.Reaction)return null;if(!this.crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return this.crypto.encryptEvent(e,t)}getEncryptedIfNeededEventType(e,t){return t===N.a.Reaction?t:this.isRoomEncrypted(e)?N.a.RoomMessageEncrypted:t}updatePendingEventStatus(e,t,a){e?e.updatePendingEvent(t,a):t.setStatus(a)}sendEventHttpRequest(e){let t=e.getTxnId();t||(t=this.makeTxnId(),e.setTxnId(t));const a={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:t};let n;if(e.isState()){let t="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(t="/rooms/$roomId/state/$eventType/$stateKey"),n=u.g(t,a)}else if(e.isRedaction()){const t="/rooms/$roomId/redact/$redactsEventId/$txnId";n=u.g(t,Object.assign({$redactsEventId:e.event.redacts},a))}else n=u.g("/rooms/$roomId/send/$eventType/$txnId",a);return this.http.authedRequest(void 0,"PUT",n,void 0,e.getWireContent()).then(t=>(E.a.log(`Event sent to ${e.getRoomId()} with event id ${t.event_id}`),t))}redactEvent(e,t,a,n){const s=("object"==typeof n?n:{}).reason,i="function"==typeof n?n:void 0;return this.sendCompleteEvent(e,{type:N.a.RoomRedaction,content:{reason:s},redacts:t},a,i)}sendMessage(e,t,a,n){return u.n(a)&&(n=a,a=void 0),this.sendEvent(e,"m.room.message",t,a,n)}sendTextMessage(e,t,a,n){const s=T.makeTextMessage(t);return this.sendMessage(e,s,a,n)}sendNotice(e,t,a,n){const s=T.makeNotice(t);return this.sendMessage(e,s,a,n)}sendEmoteMessage(e,t,a,n){const s=T.makeEmoteMessage(t);return this.sendMessage(e,s,a,n)}sendImageMessage(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Image",s=arguments.length>4?arguments[4]:void 0;u.n(n)&&(s=n,n=void 0);const i={msgtype:"m.image",url:t,info:a,body:n};return this.sendMessage(e,i,void 0,s)}sendStickerMessage(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Sticker",s=arguments.length>4?arguments[4]:void 0;u.n(n)&&(s=n,n=void 0);const i={url:t,info:a,body:n};return this.sendEvent(e,N.a.Sticker,i,void 0,s)}sendHtmlMessage(e,t,a,n){const s=T.makeHtmlMessage(t,a);return this.sendMessage(e,s,void 0,n)}sendHtmlNotice(e,t,a,n){const s=T.makeHtmlNotice(t,a);return this.sendMessage(e,s,void 0,n)}sendHtmlEmote(e,t,a,n){const s=T.makeHtmlEmote(t,a);return this.sendMessage(e,s,void 0,n)}sendReceipt(e,t,a,n){if("function"==typeof a&&(n=a,a={}),this.isGuest())return Promise.resolve({});const s=u.g("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),i=this.http.authedRequest(n,"POST",s,void 0,a||{}),o=this.getRoom(e.getRoomId());return o&&o._addLocalEchoReceipt(this.credentials.userId,e,t),i}async sendReadReceipt(e,t,a){"function"==typeof t&&(a=t,t={}),t||(t={});const n=e.getId(),s=this.getRoom(e.getRoomId());if(s&&s.hasPendingEvent(n))throw new Error(`Cannot set read receipt to a pending event (${n})`);const i={"m.hidden":Boolean(t.hidden)};return this.sendReceipt(e,"m.read",i,a)}async setRoomReadMarkers(e,t,a,n){const s=this.getRoom(e);if(s&&s.hasPendingEvent(t))throw new Error(`Cannot set read marker to a pending event (${t})`);let i;if(a){if(i=a.getId(),s&&s.hasPendingEvent(i))throw new Error(`Cannot set read receipt to a pending event (${i})`);s&&s._addLocalEchoReceipt(this.credentials.userId,a,"m.read")}return this.setRoomReadMarkersHttpRequest(e,t,i,n)}getUrlPreview(e,t,a){const n=(t=6e4*Math.floor(t/6e4))+"_"+e,s=this.urlPreviewCache[n];if(s)return a&&s.then(a).catch(a),s;const i=this.http.authedRequest(a,"GET","/preview_url",{url:e,ts:t},void 0,{prefix:f.g});return this.urlPreviewCache[n]=i,i}sendTyping(e,t,a,n){if(this.isGuest())return Promise.resolve({});const s=u.g("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.credentials.userId}),i={typing:t};return t&&(i.timeout=a||2e4),this.http.authedRequest(n,"PUT",s,void 0,i)}getRoomUpgradeHistory(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.getRoom(e);if(!a)return[];const n=[a];let s=a.currentState.getStateEvents("m.room.create","");for(;s;){E.a.log("Looking at "+s.getId());const e=s.getContent().predecessor;if(!e||!e.room_id)break;{E.a.log("Looking at predecessor "+e.room_id);const a=this.getRoom(e.room_id);if(!a)break;if(t){const e=a.currentState.getStateEvents("m.room.tombstone","");if(!e||e.getContent().replacement_room!==a.roomId)break}n.splice(0,0,a),s=a.currentState.getStateEvents("m.room.create","")}}let i=a.currentState.getStateEvents("m.room.tombstone","");for(;i;){const e=this.getRoom(i.getContent().replacement_room);if(!e)break;if(e.roomId===a.roomId)break;if(t){if(s=e.currentState.getStateEvents("m.room.create",""),!s||!s.getContent().predecessor)break;if(s.getContent().predecessor.room_id!==a.roomId)break}n.push(e);if(new Set(n.map(e=>e.roomId)).size<n.length)return n.slice(0,n.length-1);a=e,i=a.currentState.getStateEvents("m.room.tombstone","")}return n}invite(e,t,a,n){return this.membershipChange(e,t,"invite",n,a)}inviteByEmail(e,t,a){return this.inviteByThreePid(e,"email",t,a)}async inviteByThreePid(e,t,a,n){const s=u.g("/rooms/$roomId/invite",{$roomId:e}),i=this.getIdentityServerUrl(!0);if(!i)return Promise.reject(new f.c({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const o={id_server:i,medium:t,address:a};if(this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(o.id_access_token=e)}return this.http.authedRequest(n,"POST",s,void 0,o)}leave(e,t){return this.membershipChange(e,void 0,"leave",void 0,t)}leaveRoomChain(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const a=this.getRoomUpgradeHistory(e);let n=a;if(!t){n=[];for(const t of a)if(n.push(t),t.roomId===e)break}const s={},i=[],o=e=>this.leave(e).then(()=>{s[e]=null}).catch(t=>(s[e]=t,null));for(const e of n)i.push(o(e.roomId));return Promise.all(i).then(()=>s)}ban(e,t,a,n){return this.membershipChange(e,t,"ban",a,n)}forget(e,t,a){void 0===t&&(t=!0);const n=this.membershipChange(e,void 0,"forget",void 0,a);return t?n.then(t=>(this.store.removeRoom(e),this.emit("deleteRoom",e),t)):n}unban(e,t,a){const n=u.g("/rooms/$roomId/unban",{$roomId:e}),s={user_id:t};return this.http.authedRequest(a,"POST",n,void 0,s)}kick(e,t,a,n){return this.setMembershipState(e,t,"leave",a,n)}setMembershipState(e,t,a,n,s){u.n(n)&&(s=n,n=void 0);const i=u.g("/rooms/$roomId/state/m.room.member/$userId",{$roomId:e,$userId:t});return this.http.authedRequest(s,"PUT",i,void 0,{membership:a,reason:n})}membershipChange(e,t,a,n,s){u.n(n)&&(s=n,n=void 0);const i=u.g("/rooms/$room_id/$membership",{$room_id:e,$membership:a});return this.http.authedRequest(s,"POST",i,void 0,{user_id:t,reason:n})}getPushActionsForEvent(e){return e.getPushActions()||e.setPushActions(this.pushProcessor.actionsForEvent(e)),e.getPushActions()}setProfileInfo(e,t,a){const n=u.g("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(a,"PUT",n,void 0,t)}async setDisplayName(e,t){const a=await this.setProfileInfo("displayname",{displayname:e},t),n=this.getUser(this.getUserId());return n&&(n.displayName=e,n.emit("User.displayName",n.events.presence,n)),a}async setAvatarUrl(e,t){const a=await this.setProfileInfo("avatar_url",{avatar_url:e},t),n=this.getUser(this.getUserId());return n&&(n.avatarUrl=e,n.emit("User.avatarUrl",n.events.presence,n)),a}mxcUrlToHttp(e,t,a,n,s){return Object(x.a)(this.baseUrl,e,t,a,n,s)}_unstable_setStatusMessage(e){const t="im.vector.user_status";return Promise.all(this.getRooms().map(a=>{const n="join"===a.getMyMembership(),s=2===a.getInvitedAndJoinedMemberCount();if(!n||!s)return Promise.resolve();return a.currentState.mayClientSendStateEvent(t,this)?this.sendStateEvent(a.roomId,t,{status:e},this.getUserId()):Promise.resolve()})).then()}setPresence(e,t){const a=u.g("/presence/$userId/status",{$userId:this.credentials.userId});"string"==typeof e&&(e={presence:e});if(-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return this.http.authedRequest(t,"PUT",a,void 0,e)}getPresence(e,t){const a=u.g("/presence/$userId/status",{$userId:e});return this.http.authedRequest(t,"GET",a,void 0,void 0)}scrollback(e,t,a){u.n(t)&&(a=t,t=void 0),t=t||30;let n=0,s=this.ongoingScrollbacks[e.roomId]||{};if(s.promise)return s.promise;if(s.errorTs){const e=Date.now()-s.errorTs;n=Math.max(3e3-e,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);const i=this.store.scrollback(e,t).length;if(i===t)return Promise.resolve(e);t-=i;const o=new Promise((s,i)=>{Object(u.w)(n).then(()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,"b")).then(t=>{var n;const i=t.chunk.map(this.getEventMapper());if(t.state){const a=t.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(a)}e.addEventsToTimeline(i,!0,e.getLiveTimeline()),e.oldState.paginationToken=t.end,0===t.chunk.length&&(e.oldState.paginationToken=null),this.store.storeEvents(e,i,t.end,!0),this.ongoingScrollbacks[e.roomId]=null,null===(n=a)||void 0===n||n(null,e),s(e)}).catch(t=>{var n;this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},null===(n=a)||void 0===n||n(t),i(t)})});return s={promise:o,errorTs:null},this.ongoingScrollbacks[e.roomId]=s,o}getEventMapper(e){return Object(D.a)(this,e||{})}getEventTimeline(e,t){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(e.getTimelineForEvent(t))return Promise.resolve(e.getTimelineForEvent(t));const a=u.g("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t});let n=void 0;this.clientOpts.lazyLoadMembers&&(n={filter:JSON.stringify(d.a.LAZY_LOADING_MESSAGES_FILTER)});return this.http.authedRequest(void 0,"GET",a,n).then(a=>{if(!a.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);a.events_after.reverse();const n=a.events_after.concat([a.event]).concat(a.events_before).map(this.getEventMapper());let s=e.getTimelineForEvent(n[0].getId());if(s){const e=a.state.map(this.getEventMapper());s.getState(h.a.BACKWARDS).setUnknownStateEvents(e)}else s=e.addTimeline(),s.initialiseState(a.state.map(this.getEventMapper())),s.getState(h.a.FORWARDS).paginationToken=a.end;return e.addEventsToTimeline(n,!0,s,a.start),e.getTimelineForEvent(t)||s})}createMessagesRequest(e,t,a,n,s){const i=u.g("/rooms/$roomId/messages",{$roomId:e});void 0===a&&(a=30);const o={from:t,limit:a,dir:n};let r=null;return this.clientOpts.lazyLoadMembers&&(r=Object.assign({},d.a.LAZY_LOADING_MESSAGES_FILTER)),s&&(r=r||{},Object.assign(r,s.getRoomTimelineFilterComponent())),r&&(o.filter=JSON.stringify(r)),this.http.authedRequest(void 0,"GET",i,o)}paginateEventTimeline(e,t){const a=e.getTimelineSet()===this.notifTimelineSet,n=(t=t||{}).backwards||!1;if(a&&!n)throw new Error("paginateNotifTimeline can only paginate backwards");const s=n?h.a.BACKWARDS:h.a.FORWARDS,i=e.getPaginationToken(s);if(!i)return Promise.resolve(!1);const o=e._paginationRequests[s];if(o)return o;let r,l,c;if(a)r="/notifications",l={limit:"limit"in t?t.limit:30,only:"highlight"},i&&"end"!==i&&(l.from=i),c=this.http.authedRequest(void 0,"GET","/notifications",l,void 0).then(t=>{const a=t.next_token,i=[];for(let e=0;e<t.notifications.length;e++){const a=t.notifications[e],n=this.getEventMapper()(a.event);n.setPushActions(p.a.actionListToActionsObject(a.actions)),n.event.room_id=a.room_id,i[e]=n}return e.getTimelineSet().addEventsToTimeline(i,n,e,a),n&&!t.next_token&&e.setPaginationToken(null,s),!!t.next_token}).finally(()=>{e._paginationRequests[s]=null}),e._paginationRequests[s]=c;else{if(!this.getRoom(e.getRoomId()))throw new Error("Unknown room "+e.getRoomId());c=this.createMessagesRequest(e.getRoomId(),i,t.limit,s,e.getFilter()),c.then(t=>{if(t.state){const a=e.getState(s),n=t.state.map(this.getEventMapper());a.setUnknownStateEvents(n)}const a=t.end,i=t.chunk.map(this.getEventMapper());return e.getTimelineSet().addEventsToTimeline(i,n,e,a),n&&t.end==t.start&&e.setPaginationToken(null,s),t.end!=t.start}).finally(()=>{e._paginationRequests[s]=null}),e._paginationRequests[s]=c}return c}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end",null)}peekInRoom(e){return this.peekSync&&this.peekSync.stopPeeking(),this.peekSync=new o.a(this,this.clientOpts),this.peekSync.peek(e)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,t){const a=this.sendStateEvent(e,"m.room.guest_access",{guest_access:t.allowJoin?"can_join":"forbidden"},"");let n=Promise.resolve();return t.allowRead&&(n=this.sendStateEvent(e,"m.room.history_visibility",{history_visibility:"world_readable"},"")),Promise.all([n,a]).then()}requestRegisterEmailToken(e,t,a,n){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:a,next_link:n})}requestRegisterMsisdnToken(e,t,a,n,s){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:a,send_attempt:n,next_link:s})}requestAdd3pidEmailToken(e,t,a,n){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:a,next_link:n})}requestAdd3pidMsisdnToken(e,t,a,n,s){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:a,send_attempt:n,next_link:s})}requestPasswordEmailToken(e,t,a,n){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:a,next_link:n})}requestPasswordMsisdnToken(e,t,a,n,s){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:a,send_attempt:n,next_link:s})}async requestTokenFromEndpoint(e,t){const a=Object.assign({},t);if(!await this.doesServerSupportSeparateAddAndBind()&&this.idBaseUrl){const e=A.a.parse(this.idBaseUrl);if(!e.host)throw new Error("Invalid ID server URL: "+this.idBaseUrl);if(a.id_server=e.host,this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(a.id_access_token=e)}}return this.http.request(void 0,"POST",e,void 0,a)}getRoomPushRule(e,t){if(!this.pushRules)throw new Error("SyncApi.sync() must be done before accessing to push rules.");for(let a=0;a<this.pushRules[e].room.length;a++){const n=this.pushRules[e].room[a];if(n.rule_id===t)return n}}setRoomMutePushRule(e,t,a){let n,s;const i=this.getRoomPushRule(e,t);if(i&&0<=i.actions.indexOf("dont_notify")&&(s=!0),a?i?s||(n=u.e(),this.deletePushRule(e,"room",i.rule_id).then(()=>{this.addPushRule(e,"room",t,{actions:["dont_notify"]}).then(()=>{n.resolve()}).catch(e=>{n.reject(e)})}).catch(e=>{n.reject(e)}),n=n.promise):n=this.addPushRule(e,"room",t,{actions:["dont_notify"]}):s&&(n=this.deletePushRule(e,"room",i.rule_id)),n)return new Promise((e,t)=>{n.then(()=>{this.getPushRules().then(t=>{this.pushRules=t,e()}).catch(e=>{t(e)})}).catch(e=>{this.getPushRules().then(a=>{this.pushRules=a,t(e)}).catch(a=>{t(e)})})})}searchMessageText(e,t){const a={search_term:e.query};return"keys"in e&&(a.keys=e.keys),this.search({body:{search_categories:{room_events:a}}},t)}searchRoomEvents(e){const t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:"recent",event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},a={_query:t,results:[],highlights:[]};return this.search({body:t}).then(e=>this.processRoomEventsSearch(a,e))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const t={body:e._query,next_batch:e.next_batch},a=this.search(t).then(t=>this.processRoomEventsSearch(e,t)).finally(()=>{e.pendingRequest=null});return e.pendingRequest=a,a}processRoomEventsSearch(e,t){const a=t.search_categories.room_events;e.count=a.count,e.next_batch=a.next_batch;const n={};a.highlights.forEach(e=>{n[e]=1}),e.highlights.forEach(e=>{n[e]=1}),e.highlights=Object.keys(n);const s=a.results?a.results.length:0;for(let t=0;t<s;t++){const n=R.a.fromJson(a.results[t],this.getEventMapper());e.results.push(n)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;const e=new o.a(this,this.clientOpts);return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then(e=>{E.a.log("Marking success of sync left room request"),this.syncedLeftRooms=!0}).finally(()=>{this.syncLeftRoomsPromise=null}),this.syncLeftRoomsPromise}createFilter(e){const t=u.g("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,"POST",t,void 0,e).then(t=>{const a=d.a.fromJson(this.credentials.userId,t.filter_id,e);return this.store.storeFilter(a),a})}getFilter(e,t,a){if(a){const a=this.store.getFilter(e,t);if(a)return Promise.resolve(a)}const n=u.g("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(void 0,"GET",n,void 0,void 0).then(a=>{const n=d.a.fromJson(e,t,a);return this.store.storeFilter(n),n})}async getOrCreateFilter(e,t){const a=this.store.getFilterIdByName(e);let n=void 0;if(a){try{const e=await this.getFilter(this.credentials.userId,a,!0);if(e){const s=e.getDefinition(),i=t.getDefinition();u.c(s,i)&&(n=a)}}catch(e){if("M_UNKNOWN"!==e.errcode&&"M_NOT_FOUND"!==e.errcode)throw e}n||this.store.setFilterIdByName(e,void 0)}if(n)return n;const s=await this.createFilter(t.getDefinition());return this.store.setFilterIdByName(e,s.filterId),s.filterId}getOpenIdToken(){const e=u.g("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,"POST",e,void 0,{})}turnServer(e){return this.http.authedRequest(e,"GET","/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}async checkTurnServers(){if(!this.canSupportVoip)return;let t=!1;const a=this.turnServersExpiry-Date.now();if(a>6e5)E.a.debug("TURN creds are valid for another "+a+" ms: not fetching new ones."),t=!0;else{E.a.debug("Fetching new TURN credentials");try{const e=await this.turnServer();if(e.uris){E.a.log("Got TURN URIs: "+e.uris+" refresh in "+e.ttl+" secs");const a={urls:e.uris,username:e.username,credential:e.password};this.turnServers=[a],this.turnServersExpiry=Date.now()+1e3*e.ttl,t=!0}}catch(t){E.a.error("Failed to get TURN URIs",t),403===t.httpStatus&&(E.a.info("TURN access unavailable for this account: stopping credentials checks"),null!==this.checkTurnServersIntervalID&&e.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=null)}}return t}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){const e=u.g("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(void 0,"GET",e,void 0,void 0,{prefix:""}).then(e=>e.admin)}whoisSynapseUser(e){const t=u.g("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){const t=u.g("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(void 0,"POST",t,void 0,void 0,{prefix:""})}async fetchClientWellKnown(){this.clientWellKnownPromise=g.a.getRawClientConfig(this.getDomain()),this.clientWellKnown=await this.clientWellKnownPromise,this.emit("WellKnown.client",this.clientWellKnown)}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){return this.clientWellKnownPromise}storeClientOptions(){const e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter(t=>{let[a,n]=t;return e.includes(typeof n)}).reduce((e,t)=>{let[a,n]=t;return e[a]=n,e},{});return this.store.storeClientOptions(t)}async _unstable_getSharedRooms(e){if(!await this.doesServerSupportUnstableFeature("uk.half-shot.msc2666"))throw Error("Server does not support shared_rooms API");const t=u.g("/uk.half-shot.msc2666/user/shared_rooms/$userId",{$userId:e});return(await this.http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:f.i})).joined}getVersions(){return this.serverVersionsPromise||(this.serverVersionsPromise=this.http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:""}).catch(e=>{throw this.serverVersionsPromise=null,e})),this.serverVersionsPromise}async isVersionSupported(e){const{versions:t}=await this.getVersions();return t&&t.includes(e)}async doesServerSupportLazyLoading(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,a=e.unstable_features;return t&&t.includes("r0.5.0")||a&&a["m.lazy_load_members"]}async doesServerRequireIdServerParam(){const e=await this.getVersions();if(!e)return!0;const t=e.versions;if(t&&t.includes("r0.6.0"))return!1;const a=e.unstable_features;return!a||(void 0===a["m.require_identity_server"]||a["m.require_identity_server"])}async doesServerAcceptIdentityAccessToken(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,a=e.unstable_features;return t&&t.includes("r0.6.0")||a&&a["m.id_access_token"]}async doesServerSupportSeparateAddAndBind(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,a=e.unstable_features;return t&&t.includes("r0.6.0")||a&&a["m.separate_add_and_bind"]}async doesServerSupportUnstableFeature(e){const t=await this.getVersions();if(!t)return!1;const a=t.unstable_features;return a&&!!a[e]}async doesServerForceEncryptionForPreset(e){const t=await this.getVersions();if(!t)return!1;const a=t.unstable_features;return a&&!!a["io.element.e2ee_forced."+e]}hasLazyLoadMembersEnabled(){return!!this.clientOpts.lazyLoadMembers}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}async relations(e,t,a,n,s){const i=this.getEncryptedIfNeededEventType(e,n),o=await this.fetchRelations(e,t,a,i,s),r=this.getEventMapper();let l;o.original_event&&(l=r(o.original_event));let c=o.chunk.map(r);if("m.room.encrypted"===i){const e=l?c.concat(l):c;await Promise.all(e.map(e=>new Promise(t=>e.once("Event.decrypted",t)))),c=c.filter(e=>e.getType()===n)}return l&&"m.replace"===a&&(c=c.filter(e=>e.getSender()===l.getSender())),{originalEvent:l,events:c,nextBatch:o.next_batch}}getCrossSigningCacheCallbacks(){var e;return null===(e=this.crypto)||void 0===e?void 0:e._crossSigningInfo.getCacheCallbacks()}generateClientSecret(){return Object(M.b)(32)}decryptEventIfNeeded(e,t){return e.shouldAttemptDecryption()&&e.attemptDecryption(this.crypto,t),e.isBeingDecrypted()?e._decryptionPromise:Promise.resolve()}termsUrlForService(e,t){switch(e){case _.a.IS:return t+f.f+"/terms";case _.a.IM:return t+"/_matrix/integrations/v1/terms";default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this.idBaseUrl.startsWith("http://")||this.idBaseUrl.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=u.h(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}isLoggedIn(){return void 0!==this.http.opts.accessToken}makeTxnId(){return"m"+(new Date).getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(void 0,"GET","/register/available",{username:e}).then(e=>e.available)}register(e,t,a,n,s,i,o,r){!0===s?s={email:!0}:null==s&&(s={}),"function"==typeof o&&(r=o,o=void 0),a&&(n.session=a);const l={auth:n};return null!=e&&(l.username=e),null!=t&&(l.password=t),s.email&&(l.bind_email=!0),s.msisdn&&(l.bind_msisdn=!0),null!=i&&(l.guest_access_token=i),null!=o&&(l.inhibit_login=o),null!=t&&(l.x_show_msisdn=!0),this.registerRequest(l,void 0,r)}registerGuest(e,t){return(e=e||{}).body=e.body||{},this.registerRequest(e.body,"guest",t)}registerRequest(e,t,a){const n={};return t&&(n.kind=t),this.http.request(a,"POST","/register",n,e)}loginFlows(e){return this.http.request(e,"GET","/login")}login(e,t,a){const n={type:e};return u.j(n,t),this.http.authedRequest((e,t)=>{t&&t.access_token&&t.user_id&&(this.http.opts.accessToken=t.access_token,this.credentials={userId:t.user_id}),a&&a(e,t)},"POST","/login",void 0,n)}globitsLogin(e,t,a,n){const s={type:t};return u.j(s,a),this.http.globitsAuthedRequest((e,t)=>{t&&t.access_token&&t.user_id&&(this.http.opts.accessToken=t.access_token,this.credentials={userId:t.user_id}),n&&n(e,t)},"POST",e,void 0,s)}loginWithPassword(e,t,a){return this.login("m.login.password",{user:e,password:t},a)}loginWithSAML2(e,t){return this.login("m.login.saml2",{relay_state:e},t)}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e){let t=arguments.length>2?arguments[2]:void 0,a="/login/"+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sso")+"/redirect";return t&&(a+="/"+t),this.http.getUrl(a,{redirectUrl:e},f.h)}loginWithToken(e,t){return this.login("m.login.token",{token:e},t)}logout(e){return this.http.authedRequest(e,"POST","/logout")}globitsLogout(e,t){return this.http.globitsAuthedRequest(t,"POST",e)}deactivateAccount(e,t){if("function"==typeof t)throw new Error("deactivateAccount no longer accepts a callback parameter");const a={};return e&&(a.auth=e),void 0!==t&&(a.erase=t),this.http.authedRequest(void 0,"POST","/account/deactivate",void 0,a)}getFallbackAuthUrl(e,t){const a=u.g("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(a,{session:t},f.h)}async createRoom(e,t){const a=(e.invite_3pid||[]).filter(e=>!e.id_access_token);if(a.length>0&&this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();if(e)for(const t of a)t.id_access_token=e}return this.http.authedRequest(t,"POST","/createRoom",void 0,e)}async fetchRelations(e,t,a,n,s){const i={};s.from&&(i.from=s.from);const o=u.f(i),r=u.g("/rooms/$roomId/relations/$eventId/$relationType/$eventType?"+o,{$roomId:e,$eventId:t,$relationType:a,$eventType:n});return await this.http.authedRequest(void 0,"GET",r,null,null,{prefix:f.i})}roomState(e,t){const a=u.g("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(t,"GET",a)}fetchRoomEvent(e,t,a){const n=u.g("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(a,"GET",n)}members(e,t,a,n,s){const i={};t&&(i.membership=t),a&&(i.not_membership=a),n&&(i.at=n);const o=u.f(i),r=u.g("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(s,"GET",r)}upgradeRoom(e,t){const a=u.g("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(void 0,"POST",a,void 0,{new_version:t})}getStateEvent(e,t,a,n){const s={$roomId:e,$eventType:t,$stateKey:a};let i=u.g("/rooms/$roomId/state/$eventType",s);return void 0!==a&&(i=u.g(i+"/$stateKey",s)),this.http.authedRequest(n,"GET",i)}sendStateEvent(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4?arguments[4]:void 0;const i={$roomId:e,$eventType:t,$stateKey:n};let o=u.g("/rooms/$roomId/state/$eventType",i);return void 0!==n&&(o=u.g(o+"/$stateKey",i)),this.http.authedRequest(s,"PUT",o,void 0,a)}roomInitialSync(e,t,a){u.n(t)&&(a=t,t=void 0);const n=u.g("/rooms/$roomId/initialSync",{$roomId:e});return t||(t=30),this.http.authedRequest(a,"GET",n,{limit:t})}setRoomReadMarkersHttpRequest(e,t,a,n){const s=u.g("/rooms/$roomId/read_markers",{$roomId:e}),i={"m.fully_read":t,"m.read":a,"m.hidden":Boolean(!!n&&n.hidden)};return this.http.authedRequest(void 0,"POST",s,void 0,i)}getJoinedRooms(){const e=u.g("/joined_rooms",{});return this.http.authedRequest(void 0,"GET",e)}getJoinedRoomMembers(e){const t=u.g("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(void 0,"GET",t)}publicRooms(e,t){"function"==typeof e&&(t=e,e={}),void 0===e&&(e={});const a={};return e.server&&(a.server=e.server,delete e.server),0===Object.keys(e).length&&0===Object.keys(a).length?this.http.authedRequest(t,"GET","/publicRooms"):this.http.authedRequest(t,"POST","/publicRooms",a,e)}createAlias(e,t,a){const n=u.g("/directory/room/$alias",{$alias:e}),s={room_id:t};return this.http.authedRequest(a,"PUT",n,void 0,s)}deleteAlias(e,t){const a=u.g("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,"DELETE",a,void 0,void 0)}unstableGetLocalAliases(e,t){const a=u.g("/rooms/$roomId/aliases",{$roomId:e}),n=f.i+"/org.matrix.msc2432";return this.http.authedRequest(t,"GET",a,null,null,{prefix:n})}getRoomIdForAlias(e,t){const a=u.g("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,"GET",a)}resolveRoomAlias(e,t){const a=u.g("/directory/room/$alias",{$alias:e});return this.http.request(t,"GET",a)}getRoomDirectoryVisibility(e,t){const a=u.g("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(t,"GET",a)}setRoomDirectoryVisibility(e,t,a){const n=u.g("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(a,"PUT",n,void 0,{visibility:t})}setRoomDirectoryVisibilityAppService(e,t,a,n){const s=u.g("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this.http.authedRequest(n,"PUT",s,void 0,{visibility:a})}searchUserDirectory(e){const t={search_term:e.term};return void 0!==e.limit&&(t.limit=e.limit),this.http.authedRequest(void 0,"POST","/user_directory/search",void 0,t)}uploadContent(e,t){return this.http.uploadContent(e,t)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,t,a){u.n(t)&&(a=t,t=void 0);const n=t?u.g("/profile/$userId/$info",{$userId:e,$info:t}):u.g("/profile/$userId",{$userId:e});return this.http.authedRequest(a,"GET",n)}getThreePids(e){return this.http.authedRequest(e,"GET","/account/3pid",void 0,void 0)}addThreePid(e,t,a){const n={threePidCreds:e,bind:t};return this.http.authedRequest(a,"POST","/account/3pid",null,n)}async addThreePidOnly(e){const t=await this.isVersionSupported("r0.6.0")?f.h:f.i;return this.http.authedRequest(void 0,"POST","/account/3pid/add",null,e,{prefix:t})}async bindThreePid(e){const t=await this.isVersionSupported("r0.6.0")?f.h:f.i;return this.http.authedRequest(void 0,"POST","/account/3pid/bind",null,e,{prefix:t})}async unbindThreePid(e,t){const a={medium:e,address:t,id_server:this.getIdentityServerUrl(!0)},n=await this.isVersionSupported("r0.6.0")?f.h:f.i;return this.http.authedRequest(void 0,"POST","/account/3pid/unbind",null,a,{prefix:n})}deleteThreePid(e,t){const a={medium:e,address:t};return this.http.authedRequest(void 0,"POST","/account/3pid/delete",null,a)}setPassword(e,t,a){const n={auth:e,new_password:t};return this.http.authedRequest(a,"POST","/account/password",null,n)}getDevices(){return this.http.authedRequest(void 0,"GET","/devices",void 0,void 0)}getDevice(e){const t=u.g("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,"GET",t,void 0,void 0)}setDeviceDetails(e,t){const a=u.g("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,"PUT",a,void 0,t)}deleteDevice(e,t){const a=u.g("/devices/$device_id",{$device_id:e}),n={};return t&&(n.auth=t),this.http.authedRequest(void 0,"DELETE",a,void 0,n)}deleteMultipleDevices(e,t){const a={devices:e};t&&(a.auth=t);return this.http.authedRequest(void 0,"POST","/delete_devices",void 0,a)}getPushers(e){return this.http.authedRequest(e,"GET","/pushers",void 0,void 0)}setPusher(e,t){return this.http.authedRequest(t,"POST","/pushers/set",null,e)}getPushRules(e){return this.http.authedRequest(e,"GET","/pushrules/").then(e=>p.a.rewriteDefaultRules(e))}addPushRule(e,t,a,n,s){const i=u.g("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:a});return this.http.authedRequest(s,"PUT",i,void 0,n)}deletePushRule(e,t,a,n){const s=u.g("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:a});return this.http.authedRequest(n,"DELETE",s)}setPushRuleEnabled(e,t,a,n,s){const i=u.g("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:a});return this.http.authedRequest(s,"PUT",i,void 0,{enabled:n})}setPushRuleActions(e,t,a,n,s){const i=u.g("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:a});return this.http.authedRequest(s,"PUT",i,void 0,{actions:n})}search(e,t){const a={};return e.next_batch&&(a.next_batch=e.next_batch),this.http.authedRequest(t,"POST","/search",a,e.body)}uploadKeysRequest(e,t,a){return this.http.authedRequest(a,"POST","/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(void 0,"POST","/keys/signatures/upload",void 0,e,{prefix:f.i})}downloadKeysForUsers(e,t){if(u.n(t))throw new Error("downloadKeysForUsers no longer accepts a callback parameter");const a={device_keys:{}};return"token"in(t=t||{})&&(a.token=t.token),e.forEach(e=>{a.device_keys[e]=[]}),this.http.authedRequest(void 0,"POST","/keys/query",void 0,a)}claimOneTimeKeys(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signed_curve25519",a=arguments.length>2?arguments[2]:void 0;const n={};void 0===t&&(t="signed_curve25519");for(let a=0;a<e.length;++a){const s=e[a][0],i=e[a][1],o=n[s]||{};n[s]=o,o[i]=t}const s={one_time_keys:n};a&&(s.timeout=a);return this.http.authedRequest(void 0,"POST","/keys/claim",void 0,s)}getKeyChanges(e,t){const a={from:e,to:t};return this.http.authedRequest(void 0,"GET","/keys/changes",a,void 0)}uploadDeviceSigningKeys(e,t){const a=Object.assign({},t);return e&&Object.assign(a,{auth:e}),this.http.authedRequest(void 0,"POST","/keys/device_signing/upload",void 0,a,{prefix:f.i})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No Identity Server base URL set");const t=this.idBaseUrl+f.f+"/account/register";return this.http.requestOtherUrl(void 0,"POST",t,null,e)}async requestEmailToken(e,t,a,n,s,i){const o={client_secret:t,email:e,send_attempt:a,next_link:n};return await this.http.idServerRequest(s,"POST","/validate/email/requestToken",o,f.f,i)}async requestMsisdnToken(e,t,a,n,s,i,o){const r={client_secret:a,country:e,phone_number:t,send_attempt:n,next_link:s};return await this.http.idServerRequest(i,"POST","/validate/msisdn/requestToken",r,f.f,o)}async submitMsisdnToken(e,t,a,n){const s={sid:e,client_secret:t,token:a};return await this.http.idServerRequest(void 0,"POST","/validate/msisdn/submitToken",s,f.f,n)}submitMsisdnTokenOtherUrl(e,t,a,n){const s={sid:t,client_secret:a,token:n};return this.http.requestOtherUrl(void 0,"POST",e,void 0,s)}getIdentityHashDetails(e){return this.http.idServerRequest(void 0,"GET","/hash_details",null,f.f,e)}async identityHashedLookup(t,a){const n={},s=await this.getIdentityHashDetails(a);if(!s||!s.lookup_pepper||!s.algorithms)throw new Error("Unsupported identity server: bad response");n.pepper=s.lookup_pepper;const i={};if(s.algorithms.includes("sha256")){const a=new e.Olm.Utility;n.addresses=t.map(e=>{const t=e[0].toLowerCase(),s=e[1].toLowerCase(),o=a.sha256(`${t} ${s} ${n.pepper}`).replace(/\+/g,"-").replace(/\//g,"_");return i[o]=e[0],o}),n.algorithm="sha256"}else{if(!s.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");n.addresses=t.map(e=>{const t=`${e[0].toLowerCase()} ${e[1].toLowerCase()}`;return i[t]=e[0],t}),n.algorithm="none"}const o=await this.http.idServerRequest(void 0,"POST","/lookup",n,f.f,a);if(!o||!o.mappings)return[];const r=[];for(const e of Object.keys(o.mappings)){const t=o.mappings[e],a=i[e];if(!a)throw new Error("Identity server returned more results than expected");r.push({address:a,mxid:t})}return r}async lookupThreePid(e,t,a,n){const s=(await this.identityHashedLookup([[t,e]],n)).find(e=>e.address===t);if(!s)return a&&a(null,{}),{};const i={address:t,medium:e,mxid:s.mxid};return a&&a(null,i),i}async bulkLookupThreePids(e,t){const a=await this.identityHashedLookup(e.map(e=>[e[1],e[0]]),t),n=[];for(const t of a){const a=e.find(e=>e[1]===t.address);if(!a)throw new Error("Identity sever returned unexpected results");n.push([a[0],t.address,t.mxid])}return{threepids:n}}getIdentityAccount(e){return this.http.idServerRequest(void 0,"GET","/account",void 0,f.f,e)}sendToDevice(e,t,a){const n=u.g("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:a||this.makeTxnId()}),s={messages:t},i=Object.keys(t).reduce((e,a)=>(e[a]=Object.keys(t[a]),e),{});return E.a.log("PUT "+n,i),this.http.authedRequest(void 0,"PUT",n,void 0,s)}getThirdpartyProtocols(){return this.http.authedRequest(void 0,"GET","/thirdparty/protocols",void 0,void 0).then(e=>{if(!e||"object"!=typeof e)throw new Error("/thirdparty/protocols did not return an object: "+e);return e})}getThirdpartyLocation(e,t){const a=u.g("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(void 0,"GET",a,t,void 0)}getThirdpartyUser(e,t){const a=u.g("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(void 0,"GET",a,t,void 0)}getTerms(e,t){const a=this.termsUrlForService(e,t);return this.http.requestOtherUrl(void 0,"GET",a)}agreeToTerms(e,t,a,n){const s=this.termsUrlForService(e,t),i={Authorization:"Bearer "+a};return this.http.requestOtherUrl(void 0,"POST",s,null,{user_accepts:n},{headers:i})}reportEvent(e,t,a,n){const s=u.g("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(void 0,"POST",s,null,{score:a,reason:n})}getSpaceSummary(e,t,a,n,s,i){const o=u.g("/rooms/$roomId/spaces",{$roomId:e});return this.http.authedRequest(void 0,"POST",o,null,{max_rooms_per_space:t,suggested_only:a,auto_join_only:n,limit:s,batch:i},{prefix:"/_matrix/client/unstable/org.matrix.msc2946"})}getGroupSummary(e){const t=u.g("/groups/$groupId/summary",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}getGroupProfile(e){const t=u.g("/groups/$groupId/profile",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}setGroupProfile(e,t){const a=u.g("/groups/$groupId/profile",{$groupId:e});return this.http.authedRequest(void 0,"POST",a,void 0,t)}setGroupJoinPolicy(e,t){const a=u.g("/groups/$groupId/settings/m.join_policy",{$groupId:e});return this.http.authedRequest(void 0,"PUT",a,void 0,{"m.join_policy":t})}getGroupUsers(e){const t=u.g("/groups/$groupId/users",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}getGroupInvitedUsers(e){const t=u.g("/groups/$groupId/invited_users",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}getGroupRooms(e){const t=u.g("/groups/$groupId/rooms",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}inviteUserToGroup(e,t){const a=u.g("/groups/$groupId/admin/users/invite/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,"PUT",a,void 0,{})}removeUserFromGroup(e,t){const a=u.g("/groups/$groupId/admin/users/remove/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,"PUT",a,void 0,{})}addUserToGroupSummary(e,t,a){const n=u.g(a?"/groups/$groupId/summary/$roleId/users/$userId":"/groups/$groupId/summary/users/$userId",{$groupId:e,$roleId:a,$userId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{})}removeUserFromGroupSummary(e,t){const a=u.g("/groups/$groupId/summary/users/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,"DELETE",a,void 0,{})}addRoomToGroupSummary(e,t,a){const n=u.g(a?"/groups/$groupId/summary/$categoryId/rooms/$roomId":"/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$categoryId:a,$roomId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{})}removeRoomFromGroupSummary(e,t){const a=u.g("/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"DELETE",a,void 0,{})}addRoomToGroup(e,t,a){void 0===a&&(a=!0);const n=u.g("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{"m.visibility":{type:a?"public":"private"}})}updateGroupRoomVisibility(e,t,a){const n=u.g("/groups/$groupId/admin/rooms/$roomId/config/m.visibility",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{type:a?"public":"private"})}removeRoomFromGroup(e,t){const a=u.g("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"DELETE",a,void 0,{})}acceptGroupInvite(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=u.g("/groups/$groupId/self/accept_invite",{$groupId:e});return this.http.authedRequest(void 0,"PUT",a,void 0,t||{})}joinGroup(e){const t=u.g("/groups/$groupId/self/join",{$groupId:e});return this.http.authedRequest(void 0,"PUT",t,void 0,{})}leaveGroup(e){const t=u.g("/groups/$groupId/self/leave",{$groupId:e});return this.http.authedRequest(void 0,"PUT",t,void 0,{})}getJoinedGroups(){const e=u.g("/joined_groups",{});return this.http.authedRequest(void 0,"GET",e)}createGroup(e){const t=u.g("/create_group",{});return this.http.authedRequest(void 0,"POST",t,void 0,e)}getPublicisedGroups(e){const t=u.g("/publicised_groups",{});return this.http.authedRequest(void 0,"POST",t,void 0,{user_ids:e})}setGroupPublicity(e,t){const a=u.g("/groups/$groupId/self/update_publicity",{$groupId:e});return this.http.authedRequest(void 0,"PUT",a,void 0,{publicise:t})}}s()(F,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY")}).call(this,a(7))},267:function(e,t,a){"use strict";a.d(t,"c",(function(){return v})),a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return y})),a.d(t,"d",(function(){return E}));var n=a(19),s=a.n(n),i=a(103),o=a(299),r=a(247),l=a(9),c=a(100),d=a(1316),m=a(123),u=a(153),h=a(142),p=a(226);function g(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?g(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const v="io.element.widgets.layout";let b;!function(e){e.Top="top",e.Right="right"}(b||(b={}));const y=3;class E extends d.a{constructor(){super(c.a),s()(this,"byRoom",{}),s()(this,"pinnedRef",void 0),s()(this,"layoutRef",void 0),s()(this,"updateAllRooms",()=>{this.byRoom={};for(const e of this.matrixClient.getVisibleRooms())this.recalculateRoom(e)}),s()(this,"updateFromWidgetStore",e=>{if(e){const t=this.matrixClient.getRoom(e);t&&this.recalculateRoom(t)}else this.updateAllRooms()}),s()(this,"updateRoomFromState",e=>{if(e.getType()!==v)return;const t=this.matrixClient.getRoom(e.getRoomId());t&&this.recalculateRoom(t)}),s()(this,"updateFromSettings",(e,t)=>{if(t){const e=this.matrixClient.getRoom(t);e&&this.recalculateRoom(e)}else this.updateAllRooms()})}static get instance(){return E.internalInstance||(E.internalInstance=new E),E.internalInstance}static emissionForRoom(e){return"update_"+e.roomId}emitFor(e){this.emit(E.emissionForRoom(e))}async onReady(){this.updateAllRooms(),this.matrixClient.on("RoomState.events",this.updateRoomFromState),this.pinnedRef=i.b.watchSetting("Widgets.pinned",null,this.updateFromSettings),this.layoutRef=i.b.watchSetting("Widgets.layout",null,this.updateFromSettings),o.a.instance.on(h.b,this.updateFromWidgetStore)}async onNotReady(){this.byRoom={},i.b.unwatchSetting(this.pinnedRef),i.b.unwatchSetting(this.layoutRef),o.a.instance.off(h.b,this.updateFromWidgetStore)}recalculateRoom(e){const t=o.a.instance.getApps(e.roomId);if(null==t||!t.length)return this.byRoom[e.roomId]={},void this.emitFor(e);const a=JSON.stringify(this.byRoom[e.roomId]),n=e.currentState.getStateEvents(v,""),s=i.b.getValue("Widgets.pinned",e.roomId);let c=i.b.getValue("Widgets.layout",e.roomId);n&&c&&c.overrides!==n.getId()&&(c=null);const d=n?n.getContent():null,m=[],u=[];for(const e of t){var h,g,f,E,_;const t=null==d||null===(h=d.widgets)||void 0===h||null===(g=h[e.id])||void 0===g?void 0:g.container,a=null===(f=c)||void 0===f||null===(E=f.widgets)||void 0===E||null===(_=E[e.id])||void 0===_?void 0:_.container,n=!(null==s||!s[e.id]),i=r.a.JITSI.matches(e.type)?b.Top:b.Right;a===b.Right?u.push(e):a===b.Top||t===b.Top||n&&!t?m.push(e):(i===b.Top?m:u).push(e)}const S=m.slice(y);u.push(...S),m.sort((e,t)=>{var a,n,s,i,o,m;const u=null==d||null===(a=d.widgets)||void 0===a?void 0:a[e.id],h=null==d||null===(n=d.widgets)||void 0===n?void 0:n[t.id],g=null===(s=c)||void 0===s||null===(i=s.widgets)||void 0===i?void 0:i[e.id],f=null===(o=c)||void 0===o||null===(m=o.widgets)||void 0===m?void 0:m[t.id],v=r.a.JITSI.matches(e.type)?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,b=r.a.JITSI.matches(t.type)?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,y=Object(l.b)(null==g?void 0:g.index,Object(l.b)(null==u?void 0:u.index,v)),E=Object(l.b)(null==f?void 0:f.index,Object(l.b)(null==h?void 0:h.index,b));return y===E?Object(p.a)(e.id,t.id):y-E});const C=[];let w=null,O=!0;for(let e=0;e<m.length;e++){var x,R,k;const t=m[e],a=null==d||null===(x=d.widgets)||void 0===x?void 0:x[t.id],n=null===(R=c)||void 0===R||null===(k=R.widgets)||void 0===k?void 0:k[t.id];if(Number.isFinite(null==n?void 0:n.width)||Number.isFinite(null==a?void 0:a.width)){const e=(null==n?void 0:n.width)||(null==a?void 0:a.width),t=Object(l.a)(e,10,100);C.push(t),O=!1}else C.push(100);if(null!=a&&a.height||null!=n&&n.height){const e=Object(l.b)(null==a?void 0:a.height,2),t=Object(l.b)(null==n?void 0:n.height,e);w=Math.max(w,Object(l.a)(t,2,100))}}if(O)for(let e=0;e<C.length;e++)C[e]=100/C.length;else{const e=Object(l.e)(...C)-100;if(e<0)for(let t=0;t<C.length;t++)C[t]+=Math.abs(e)/C.length;else if(e>0){for(let t=0;t<C.length;t++)C[t]=Object(l.a)(C[t]-e/C.length,10,100);const t=Object(l.e)(...C)-100;if(t>0){const e=C.map((e,t)=>[t,e]).filter(e=>e[1]>10).map(e=>e[0]);for(const a of e)C[a]-=t/e.length}}}this.byRoom[e.roomId]={},m.length&&(this.byRoom[e.roomId][b.Top]={ordered:m,distributions:C,height:w}),u.length&&(this.byRoom[e.roomId][b.Right]={ordered:u});JSON.stringify(this.byRoom[e.roomId])!==a&&this.emitFor(e)}getContainerWidgets(e,t){var a,n;return(null===(a=this.byRoom[e.roomId])||void 0===a||null===(n=a[t])||void 0===n?void 0:n.ordered)||[]}isInContainer(e,t,a){return this.getContainerWidgets(e,a).some(e=>e.id===t.id)}canAddToContainer(e,t){return this.getContainerWidgets(e,t).length<y}getResizerDistributions(e,t){var a,n;let s=null===(a=this.byRoom[e.roomId])||void 0===a||null===(n=a[t])||void 0===n?void 0:n.distributions;return!s||s.length<2?[]:(2===s.length&&(s=[s[0]]),3===s.length&&(s=[s[0],s[2]]),s.map(e=>e.toFixed(1)+"%"))}setResizerDistributions(e,t,a){if(t!==b.Top)return;const n=a.map(e=>Number(Number(e.substring(0,e.length-1)).toFixed(1))),s=this.getContainerWidgets(e,t),i=100-Object(l.e)(...n);2===n.length&&n.splice(1,0,i),1===n.length&&n.push(i);const o={};s.forEach((a,s)=>{var i,r;o[a.id]={container:t,width:n[s],index:s,height:(null===(i=this.byRoom[e.roomId])||void 0===i||null===(r=i[t])||void 0===r?void 0:r.height)||2}}),this.updateUserLayout(e,o)}getContainerHeight(e,t){var a,n;return null===(a=this.byRoom[e.roomId])||void 0===a||null===(n=a[t])||void 0===n?void 0:n.height}setContainerHeight(e,t,a){var n,s;const i=this.getContainerWidgets(e,t),o=null===(n=this.byRoom[e.roomId])||void 0===n||null===(s=n[t])||void 0===s?void 0:s.distributions,r={};i.forEach((e,n)=>{r[e.id]={container:t,width:o[n],index:n,height:a}}),this.updateUserLayout(e,r)}moveWithinContainer(e,t,a,n){var s,i,o,r;const c=Object(u.b)(this.getContainerWidgets(e,t)),d=c.findIndex(e=>e.id===a.id);if(d<0)return;c.splice(d,1);const m=Object(l.a)(d+n,0,c.length);c.splice(m,0,a);const h=null===(s=this.byRoom[e.roomId])||void 0===s||null===(i=s[t])||void 0===i?void 0:i.distributions,p=null===(o=this.byRoom[e.roomId])||void 0===o||null===(r=o[t])||void 0===r?void 0:r.height,g={};c.forEach((e,a)=>{g[e.id]={container:t,width:h[a],index:a,height:p}}),this.updateUserLayout(e,g)}moveToContainer(e,t,a){this.getAllWidgets(e).some(e=>{let[a]=e;return a.id===t.id})&&this.updateUserLayout(e,{[t.id]:{container:a}})}canCopyLayoutToRoom(e){return!!this.matrixClient&&e.currentState.maySendStateEvent(v,this.matrixClient.getUserId())}copyLayoutToRoom(e){const t=this.getAllWidgets(e),a={widgets:{}};for(const[r,l]of t)if(a.widgets[r.id]={container:l},l===b.Top){var n,s,i,o;const t=this.getContainerWidgets(e,l).findIndex(e=>e.id===r.id),c=null===(n=this.byRoom[e.roomId])||void 0===n||null===(s=n[l])||void 0===s?void 0:s.distributions,d=null===(i=this.byRoom[e.roomId])||void 0===i||null===(o=i[l])||void 0===o?void 0:o.height;a.widgets[r.id]=f(f({},a.widgets[r.id]),{},{height:d?Math.round(d):null,width:c[t]?Math.round(c[t]):null,index:t})}this.matrixClient.sendStateEvent(e.roomId,v,a,"")}getAllWidgets(e){const t=this.byRoom[e.roomId];if(!t)return[];const a=[];for(const e of Object.keys(t)){const n=t[e].ordered;for(const t of n)a.push([t,e])}return a}updateUserLayout(e,t){const a=this.getAllWidgets(e);for(const[i,l]of a){var n,s;const a=this.getContainerWidgets(e,l).findIndex(e=>e.id===i.id),c=null===(n=this.byRoom[e.roomId])||void 0===n||null===(s=n[l])||void 0===s?void 0:s.distributions;var o,r;if(!t[i.id])t[i.id]={container:l,index:a,height:null===(o=this.byRoom[e.roomId])||void 0===o||null===(r=o[l])||void 0===r?void 0:r.height,width:null==c?void 0:c[a]}}const l=e.currentState.getStateEvents(v,"");i.b.setValue("Widgets.layout",e.roomId,m.a.ROOM_ACCOUNT,{overrides:null==l?void 0:l.getId(),widgets:t}).catch(()=>this.recalculateRoom(e)),this.recalculateRoom(e)}}s()(E,"internalInstance",void 0),window.mxWidgetLayoutStore=E.instance},2679:function(e,t){e.exports="img/betas/spaces.475c2e5.png"},268:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(795);t.a=e=>{let{description:t,detail:a,acceptLabel:n,rejectLabel:o,onAccept:r,onReject:l}=e;const c=a?s.a.createElement("div",{className:"mx_Toast_detail"},a):null;return s.a.createElement("div",null,s.a.createElement("div",{className:"mx_Toast_description"},t,c),s.a.createElement("div",{className:"mx_Toast_buttons","aria-live":"off"},l&&o&&s.a.createElement(i.a,{label:o,kind:"danger",onClick:l}),s.a.createElement(i.a,{label:n,onClick:r})))}},2680:function(e,t){e.exports="img/feather-customised/check.237da63.svg"},269:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(19),l=a.n(r),c=a(88),d=a.n(c),m=a(102),u=a.n(m),h=a(249),p=a(103),g=a(108),f=a(367),v=a(94);const b=["notification","forceCount","roomId","onClick"];var y;let E=Object(v.a)("views.rooms.NotificationBadge")(y=class extends d.a.PureComponent{constructor(e){super(e),l()(this,"countWatcherRef",void 0),l()(this,"countPreferenceChanged",()=>{this.setState({showCounts:p.b.getValue("Notifications.alwaysShowBadgeCounts",this.roomId)})}),l()(this,"onNotificationUpdate",()=>{this.forceUpdate()}),this.props.notification.on(f.a,this.onNotificationUpdate),this.state={showCounts:p.b.getValue("Notifications.alwaysShowBadgeCounts",this.roomId)},this.countWatcherRef=p.b.watchSetting("Notifications.alwaysShowBadgeCounts",this.roomId,this.countPreferenceChanged)}get roomId(){return this.props.roomId||null}componentWillUnmount(){p.b.unwatchSetting(this.countWatcherRef),this.props.notification.off(f.a,this.onNotificationUpdate)}componentDidUpdate(e){e.notification&&e.notification.off(f.a,this.onNotificationUpdate),this.props.notification.on(f.a,this.onNotificationUpdate)}render(){const e=this.props,{notification:t,forceCount:a,roomId:n,onClick:i}=e,r=o()(e,b);if(t.isIdle)return null;let l=!(t.symbol||t.count>0)||!t.hasUnreadCount;if(a&&(l=!1,!t.hasUnreadCount))return null;let c=t.symbol||Object(h.c)(t.count);l&&(c="");const m=u()({mx_NotificationBadge:!0,mx_NotificationBadge_visible:!!l||t.hasUnreadCount,mx_NotificationBadge_highlighted:t.hasMentions,mx_NotificationBadge_dot:l,mx_NotificationBadge_2char:c.length>0&&c.length<3,mx_NotificationBadge_3char:c.length>2});return i?d.a.createElement(g.a,s()({},r,{className:m,onClick:i}),d.a.createElement("span",{className:"mx_NotificationBadge_count"},c)):d.a.createElement("div",{className:m},d.a.createElement("span",{className:"mx_NotificationBadge_count"},c))}})||y},2704:function(e,t){e.exports="img/social/facebook.d547f79.png"},2705:function(e,t){e.exports="img/social/twitter-2.6517b36.png"},2706:function(e,t){e.exports="img/social/linkedin.ab157f6.png"},2707:function(e,t){e.exports="img/social/reddit.eeab8e6.png"},2708:function(e,t){e.exports="img/social/email-1.1134895.png"},2709:function(e,t){e.exports="img/element-icons/room/default_app.0ae9a45.svg"},2710:function(e,t){e.exports="img/element-icons/room/default_video.eb49053.svg"},2711:function(e,t){e.exports="img/element-icons/room/default_cal.d1dabb4.svg"},2712:function(e,t){e.exports="img/element-icons/room/default_doc.e56ef5a.svg"},2713:function(e,t){e.exports="img/element-icons/room/default_clock.2cdb237.svg"},2724:function(e,t){},2726:function(e,t,a){"use strict";var n=a(19),s=a.n(n),i=a(99),o=a(100),r=a(422);var l;!function(e){e.Online="online",e.Offline="offline",e.Unavailable="unavailable"}(l||(l={}));t.a=new class{constructor(){s()(this,"unavailableTimer",null),s()(this,"dispatcherRef",null),s()(this,"state",null),s()(this,"onAction",e=>{"user_activity"===e.action&&(this.setState(l.Online),this.unavailableTimer.restart())})}async start(){for(this.unavailableTimer=new r.a(18e4),this.dispatcherRef=o.a.register(this.onAction);this.unavailableTimer;)try{await this.unavailableTimer.finished(),this.setState(l.Unavailable)}catch(e){}}stop(){this.dispatcherRef&&(o.a.unregister(this.dispatcherRef),this.dispatcherRef=null),this.unavailableTimer&&(this.unavailableTimer.abort(),this.unavailableTimer=null)}getState(){return this.state}async setState(e){if(e===this.state)return;const t=this.state;if(this.state=e,!i.a.get().isGuest())try{await i.a.get().setPresence({presence:this.state}),console.info("Presence:",e)}catch(e){console.error("Failed to set presence:",e),this.state=t}}}},2727:function(e,t){e.exports="img/e2e/verified.f3662a7.svg"},2728:function(e,t,a){"use strict";t.a={}},2740:function(e,t){e.exports="img/icon-pill-remove.7719165.svg"},2741:function(e,t){e.exports="img/element-icons/info.10ae959.svg"},2742:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(19),s=a.n(n);class i{constructor(e){this.fn=e,s()(this,"marked",!1)}reset(){this.marked=!1}mark(){this.marked=!0}trigger(){this.marked&&(this.reset(),this.fn())}}},2743:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(2744),o=a(175);class r{constructor(e){this.store=e,s()(this,"filter",void 0),s()(this,"activeSpace",o.e.instance.activeSpace),s()(this,"onSelectedSpaceUpdated",e=>{this.activeSpace=e,this.filter?e?this.updateFilter():(this.store.removeFilter(this.filter),this.filter=null):e&&(this.filter=new i.a,this.updateFilter(),this.store.addFilter(this.filter))}),s()(this,"updateFilter",()=>{o.e.instance.traverseSpace(this.activeSpace.roomId,e=>{var t,a;null===(t=this.store.matrixClient)||void 0===t||null===(a=t.getRoom(e))||void 0===a||a.loadMembersIfNeeded()}),this.filter.updateSpace(this.activeSpace)}),o.e.instance.on(o.c,this.onSelectedSpaceUpdated)}}},2744:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return c}));var n=a(19),s=a.n(n),i=a(8),o=a(477),r=a(175),l=a(744);class c extends i.EventEmitter{constructor(){super(...arguments),s()(this,"roomIds",new Set),s()(this,"space",null),s()(this,"onStoreUpdate",async()=>{const t=this.roomIds;this.roomIds=new Set(r.e.instance.getSpaceFilteredRoomIds(this.space)),Object(l.a)(t,this.roomIds)&&(this.emit(o.a),e(()=>{this.emit(o.a)}))}),s()(this,"getSpaceEventKey",e=>e.roomId)}get kind(){return o.b.Prefilter}isVisible(e){return this.roomIds.has(e.roomId)}updateSpace(e){this.space&&r.e.instance.off(this.getSpaceEventKey(this.space),this.onStoreUpdate),r.e.instance.on(this.getSpaceEventKey(this.space=e),this.onStoreUpdate),this.onStoreUpdate()}destroy(){r.e.instance.off(this.getSpaceEventKey(this.space),this.onStoreUpdate)}}}).call(this,a(212).setImmediate)},2745:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(1426);class s{constructor(){}static forRoom(e){return n.a.instance.getOrCreateChamberForRoom(e)}}},2746:function(e,t){e.exports="img/stickerpack-placeholder.9c54c13.png"},2755:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return de}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(360),u=a(93),h=a(155),p=a(343),g=a(106),f=a(97),v=a(158),b=a(100),y=a(369),E=a(302),_=a(298),S=a(861),C=a(424),w=a(425),O=a(165),x=a(862),R=a(332),k=a(103),I=a(245),T=a(108),P=a(337),N=a(296),D=a(340),j=a(119),A=a(500),M=a(115),U=a(507),L=a(506),F=a(499),B=a(601),V=a(602),G=a(603),z=a(604),W=a(605),H=a(1446),K=a(607),q=a(374),Y=a(282),$=a(299),J=a(142),Q=a(301),X=a(421),Z=a(184),ee=a(267),te=a(220),ae=a(166),ne=a(384),se=a(94),ie=a(150),oe=a(200),re=a(1437);a(1436);let le=function(e){};const ce="sandbox"in document.createElement("iframe");let de=Object(se.a)("structures.GlobitsRoomView")((s=class extends l.a.Component{constructor(t,a){super(t,a),o()(this,"dispatcherRef",void 0),o()(this,"roomStoreToken",void 0),o()(this,"rightPanelStoreToken",void 0),o()(this,"showReadReceiptsWatchRef",void 0),o()(this,"layoutWatcherRef",void 0),o()(this,"unmounted",!1),o()(this,"permalinkCreators",{}),o()(this,"searchId",void 0),o()(this,"roomView",Object(r.createRef)()),o()(this,"searchResultsPanel",Object(r.createRef)()),o()(this,"messagePanel",void 0),o()(this,"onWidgetStoreUpdate",()=>{this.state.room&&this.checkWidgets(this.state.room)}),o()(this,"checkWidgets",e=>{this.setState({hasPinnedWidgets:ee.d.instance.getContainerWidgets(e,ee.a.Top).length>0,showApps:this.shouldShowApps(e)})}),o()(this,"onReadReceiptsChange",()=>{this.setState({showReadReceipts:k.b.getValue("showReadReceipts",this.state.roomId)})}),o()(this,"onRoomViewStoreUpdate",e=>{if(this.unmounted)return;if(!e&&this.state.roomId!==O.a.getRoomId())return;const t=O.a.getRoomId(),a={roomId:t,roomAlias:O.a.getRoomAlias(),roomLoading:O.a.isRoomLoading(),roomLoadError:O.a.getRoomLoadError(),joining:O.a.isJoining(),initialEventId:O.a.getInitialEventId(),isInitialEventHighlighted:O.a.isInitialEventHighlighted(),replyToEvent:O.a.getQuotingEvent(),forwardingEvent:O.a.getForwardingEvent(),shouldPeek:this.state.matrixClientIsReady&&O.a.shouldPeek(),showReadReceipts:k.b.getValue("showReadReceipts",t),wasContextSwitch:O.a.getWasContextSwitch()};if(e||!this.state.shouldPeek||a.shouldPeek||this.context.stopPeeking(),console.log("RVS update:",a.roomId,a.roomAlias,"loading?",a.roomLoading,"joining?",a.joining,"initial?",e,"shouldPeek?",a.shouldPeek),e&&(a.room=this.context.getRoom(a.roomId),a.room&&(a.showApps=this.shouldShowApps(a.room),this.onRoomLoaded(a.room))),null===this.state.roomId&&null!==a.roomId&&!a.initialEventId){const e=x.a.getScrollState(a.roomId);e&&(a.initialEventId=e.focussedEvent,a.initialEventPixelOffset=e.pixelOffset)}this.state.initialEventId!==a.initialEventId&&(a.searchResults=null),this.setState(a),e&&this.setupRoom(a.room,a.roomId,a.joining,a.shouldPeek)}),o()(this,"getRoomId",()=>this.state.room?this.state.room.roomId:this.state.roomId),o()(this,"onWidgetEchoStoreUpdate",()=>{this.state.room&&this.setState({hasPinnedWidgets:ee.d.instance.getContainerWidgets(this.state.room,ee.a.Top).length>0,showApps:this.shouldShowApps(this.state.room)})}),o()(this,"onWidgetLayoutChange",()=>{this.onWidgetEchoStoreUpdate()}),o()(this,"onUserScroll",()=>{this.state.initialEventId&&this.state.isInitialEventHighlighted&&b.a.dispatch({action:"view_room",room_id:this.state.room.roomId,event_id:this.state.initialEventId,highlighted:!1})}),o()(this,"onLayoutChange",()=>{this.setState({layout:k.b.getValue("layout")})}),o()(this,"onRightPanelStoreUpdate",()=>{this.setState({showRightPanel:P.a.getSharedInstance().isOpenForRoom})}),o()(this,"onPageUnload",e=>p.a.sharedInstance().getCurrentUploads().length>0?e.returnValue=Object(u.a)("You seem to be uploading files, are you sure you want to quit?"):this.getCallForRoom()&&"ended"!==this.state.callState?e.returnValue=Object(u.a)("You seem to be in a call, are you sure you want to quit?"):void 0),o()(this,"onReactKeyDown",e=>{let t=!1;switch(Object(te.f)().getRoomAction(e)){case te.d.DismissReadMarker:this.messagePanel.forgetReadMarker(),this.jumpToLiveTimeline(),t=!0;break;case te.d.JumpToOldestUnread:this.jumpToReadMarker(),t=!0;break;case te.d.UploadFile:b.a.dispatch({action:"upload_file"},!0),t=!0}t&&(e.stopPropagation(),e.preventDefault())}),o()(this,"onAction",t=>{switch(t.action){case"message_sent":this.checkDesktopNotifications();break;case"post_sticker_message":this.injectSticker(t.data.content.url,t.data.content.info,t.data.description||t.data.name);break;case"picture_snapshot":p.a.sharedInstance().sendContentListToRoom([t.file],this.state.room.roomId,this.context);break;case"notifier_enabled":case M.a.UploadStarted:case M.a.UploadFinished:case M.a.UploadCanceled:this.forceUpdate();break;case"call_state":{if(!t.room_id)return;const e=this.getCallForRoom();this.setState({callState:e?e.state:null});break}case"appsDrawer":this.setState({showApps:t.show});break;case"reply_to_event":this.state.searchResults&&t.event.getRoomId()===this.state.roomId&&!this.unmounted&&this.onCancelSearchClick();break;case"quote":if(this.state.searchResults){const a=t.event.getRoomId();a===this.state.roomId&&this.onCancelSearchClick(),e(()=>{b.a.dispatch({action:"view_room",room_id:a,deferred_action:t})})}break;case"sync_state":this.state.matrixClientIsReady||this.setState({matrixClientIsReady:this.context&&this.context.isInitialSyncComplete()},()=>{this.onRoomViewStoreUpdate(!0)});break;case"focus_search":this.onSearchClick()}}),o()(this,"onRoomTimeline",(e,t,a,n,s)=>{this.unmounted||t&&this.state.room&&t.roomId==this.state.room.roomId&&s.timeline.getTimelineSet()===t.getUnfilteredTimelineSet()&&("org.matrix.room.preview_urls"===e.getType()&&this.updatePreviewUrlVisibility(t),"m.room.encryption"===e.getType()&&this.updateE2EStatus(t),!a&&s&&s.liveEvent&&(this.state.joining||e.getSender()!==this.context.credentials.userId&&(!this.state.searchResults&&this.state.atEndOfLiveTimeline||Object(m.a)(e)||this.setState((e,t)=>({numUnreadMessages:e.numUnreadMessages+1})))))}),o()(this,"onEventDecrypted",e=>{e.isDecryptionFailure()||this.handleEffects(e)}),o()(this,"onEvent",e=>{e.isBeingDecrypted()||e.isDecryptionFailure()||this.handleEffects(e)}),o()(this,"handleEffects",e=>{if(!this.state.room||!this.state.matrixClientIsReady)return;if(e.getRoomId()!==this.state.room.roomId)return;Z.a.instance.getRoomState(this.state.room).isUnread&&Y.CHAT_EFFECTS.forEach(t=>{(Object(q.containsEmoji)(e.getContent(),t.emojis)||e.getContent().msgtype===t.msgType)&&b.a.dispatch({action:"effects."+t.command})})}),o()(this,"onRoomName",e=>{this.state.room&&e.roomId==this.state.room.roomId&&this.forceUpdate()}),o()(this,"onKeyBackupStatus",()=>{this.forceUpdate()}),o()(this,"canResetTimeline",()=>!this.messagePanel||this.messagePanel.canResetTimeline()),o()(this,"onRoomLoaded",e=>{ee.d.instance.on(ee.d.emissionForRoom(e),this.onWidgetLayoutChange),this.onWidgetLayoutChange(),this.calculatePeekRules(e),this.updatePreviewUrlVisibility(e),this.loadMembersIfJoined(e),this.calculateRecommendedVersion(e),this.updateE2EStatus(e),this.updatePermissions(e),this.checkWidgets(e)}),o()(this,"onRoom",e=>{e&&e.roomId===this.state.roomId&&(this.state.room&&ee.d.instance.off(ee.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),this.setState({room:e},()=>{this.onRoomLoaded(e)}))}),o()(this,"onDeviceVerificationChanged",(e,t)=>{const a=this.state.room;a.currentState.getMember(e)&&this.updateE2EStatus(a)}),o()(this,"onUserVerificationChanged",(e,t)=>{const a=this.state.room;a&&a.currentState.getMember(e)&&this.updateE2EStatus(a)}),o()(this,"onCrossSigningKeysChanged",()=>{const e=this.state.room;e&&this.updateE2EStatus(e)}),o()(this,"onAccountData",e=>{const t=e.getType();"org.matrix.preview_urls"!==t&&"im.vector.web.settings"!==t||!this.state.room||this.updatePreviewUrlVisibility(this.state.room)}),o()(this,"onRoomAccountData",(e,t)=>{if(t.roomId==this.state.roomId){const a=e.getType();if("org.matrix.room.color_scheme"===a){const t=e.getContent();console.log("Tinter.tint from onRoomAccountData"),y.a.tint(t.primary_color,t.secondary_color)}else"org.matrix.room.preview_urls"!==a&&"im.vector.web.settings"!==a||this.updatePreviewUrlVisibility(t)}}),o()(this,"onRoomStateEvents",(e,t)=>{this.state.room&&this.state.room.roomId===t.roomId&&this.updatePermissions(this.state.room)}),o()(this,"onRoomStateMember",(e,t,a)=>{this.state.room&&a.roomId===this.state.room.roomId&&this.updateRoomMembers(a)}),o()(this,"onMyMembership",(e,t,a)=>{e.roomId===this.state.roomId&&(this.forceUpdate(),this.loadMembersIfJoined(e),this.updatePermissions(e))}),o()(this,"updateRoomMembers",Object(E.a)(()=>{this.updateDMState(),this.updateE2EStatus(this.state.room)},500)),o()(this,"onSearchResultsFillRequest",e=>{if(!e)return Promise.resolve(!1);if(this.state.searchResults.next_batch){le("requesting more search results");const e=Object(S.b)(this.state.searchResults);return this.handleSearchResult(e)}return le("no more search results"),Promise.resolve(!1)}),o()(this,"onInviteButtonClick",()=>{b.a.dispatch({action:"view_invite",roomId:this.state.room.roomId})}),o()(this,"onJoinButtonClicked",()=>{this.context&&this.context.isGuest()?(b.a.dispatch({action:"do_after_sync_prepared",deferred_action:{action:"view_room",room_id:this.getRoomId()}}),b.a.dispatch({action:"require_registration"})):Promise.resolve().then(()=>{var e;const t=null===(e=this.props.threepidInvite)||void 0===e?void 0:e.signUrl;return b.a.dispatch({action:M.a.JoinRoom,roomId:this.getRoomId(),opts:{inviteSignUrl:t},_type:"unknown"}),Promise.resolve()})}),o()(this,"onMessageListScroll",e=>{this.messagePanel.isAtEndOfLiveTimeline()?this.setState({numUnreadMessages:0,atEndOfLiveTimeline:!0}):this.setState({atEndOfLiveTimeline:!1}),this.updateTopUnreadMessagesBar()}),o()(this,"onDragEnter",e=>{e.stopPropagation(),e.preventDefault(),this.setState({dragCounter:this.state.dragCounter+1}),(e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"))&&this.setState({draggingFile:!0})}),o()(this,"onDragLeave",e=>{e.stopPropagation(),e.preventDefault(),this.setState({dragCounter:this.state.dragCounter-1}),0===this.state.dragCounter&&this.setState({draggingFile:!1})}),o()(this,"onDragOver",e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="none",(e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"))&&(e.dataTransfer.dropEffect="copy")}),o()(this,"onDrop",e=>{e.stopPropagation(),e.preventDefault(),p.a.sharedInstance().sendContentListToRoom(e.dataTransfer.files,this.state.room.roomId,this.context),b.a.fire(M.a.FocusComposer),this.setState({draggingFile:!1,dragCounter:this.state.dragCounter-1})}),o()(this,"onSearch",(e,t)=>{let a;this.setState({searchTerm:e,searchScope:t,searchResults:{},searchHighlights:[]}),this.searchResultsPanel.current&&this.searchResultsPanel.current.resetScrollState(),this.searchId=(new Date).getTime(),"Room"===t&&(a=this.state.room.roomId),le("sending search request");const n=Object(S.a)(e,a);this.handleSearchResult(n)}),o()(this,"onCallPlaced",e=>{b.a.dispatch({action:"place_call",type:e,room_id:this.state.room.roomId})}),o()(this,"onSettingsClick",()=>{b.a.dispatch({action:"open_room_settings"})}),o()(this,"onCancelClick",()=>{console.log("updateTint from onCancelClick"),this.updateTint(),this.state.forwardingEvent&&b.a.dispatch({action:"forward_event",event:null}),b.a.fire(M.a.FocusComposer)}),o()(this,"onAppsClick",()=>{b.a.dispatch({action:"appsDrawer",show:!this.state.showApps})}),o()(this,"onLeaveClick",()=>{b.a.dispatch({action:"leave_room",room_id:this.state.room.roomId})}),o()(this,"onForgetClick",()=>{b.a.dispatch({action:"forget_room",room_id:this.state.room.roomId})}),o()(this,"onRejectButtonClicked",()=>{this.setState({rejecting:!0}),this.context.leave(this.state.roomId).then(()=>{b.a.dispatch({action:"view_home_page"}),this.setState({rejecting:!1})},e=>{console.error("Failed to reject invite: %s",e);const t=e.message?e.message:JSON.stringify(e),a=f.getComponent("dialogs.ErrorDialog");g.a.createTrackedDialog("Failed to reject invite","",a,{title:Object(u.a)("Failed to reject invite"),description:t}),this.setState({rejecting:!1,rejectError:e})})}),o()(this,"onRejectAndIgnoreClick",async()=>{this.setState({rejecting:!0});try{const e=this.state.room.getMember(this.context.getUserId()).events.member,t=this.context.getIgnoredUsers();t.push(e.getSender()),await this.context.setIgnoredUsers(t),await this.context.leave(this.state.roomId),b.a.dispatch({action:"view_home_page"}),this.setState({rejecting:!1})}catch(e){console.error("Failed to reject invite: %s",e);const t=e.message?e.message:JSON.stringify(e),a=f.getComponent("dialogs.ErrorDialog");g.a.createTrackedDialog("Failed to reject invite","",a,{title:Object(u.a)("Failed to reject invite"),description:t}),this.setState({rejecting:!1,rejectError:e})}}),o()(this,"onRejectThreepidInviteButtonClicked",()=>{b.a.fire(M.a.ViewRoomDirectory)}),o()(this,"onSearchClick",()=>{this.setState({searching:!this.state.searching})}),o()(this,"onCancelSearchClick",()=>{this.setState({searching:!1,searchResults:null})}),o()(this,"jumpToLiveTimeline",()=>{b.a.dispatch({action:"view_room",room_id:this.state.room.roomId})}),o()(this,"jumpToReadMarker",()=>{this.messagePanel.jumpToReadMarker()}),o()(this,"forgetReadMarker",e=>{e.stopPropagation(),this.messagePanel.forgetReadMarker()}),o()(this,"updateTopUnreadMessagesBar",()=>{if(!this.messagePanel)return;const e=this.messagePanel.canJumpToReadMarker();this.state.showTopUnreadMessagesBar!=e&&this.setState({showTopUnreadMessagesBar:e})}),o()(this,"onResize",()=>{let e=oe.b.instance.windowHeight-261;e<50&&(e=50),this.setState({auxPanelMaxHeight:e})}),o()(this,"onStatusBarVisible",()=>{this.unmounted||this.setState({statusBarVisible:!0})}),o()(this,"onStatusBarHidden",()=>{this.unmounted||this.setState({statusBarVisible:!1})}),o()(this,"gatherTimelinePanelRef",e=>{this.messagePanel=e,e&&(console.log("updateTint from RoomView.gatherTimelinePanelRef"),this.updateTint())}),o()(this,"onHiddenHighlightsClick",()=>{const e=this.getOldRoom();e&&b.a.dispatch({action:"view_room",room_id:e.roomId})});const n=this.context.hasLazyLoadMembersEnabled();this.state={roomId:null,roomLoading:!0,peekLoading:!1,shouldPeek:!0,membersLoaded:!n,numUnreadMessages:0,draggingFile:!1,searching:!1,searchResults:null,callState:null,guestsCanJoin:!1,canPeek:!1,showApps:!1,isPeeking:!1,showReadReceipts:!0,showRightPanel:P.a.getSharedInstance().isOpenForRoom,joining:!1,atEndOfLiveTimeline:!0,atEndOfLiveTimelineInit:!1,showTopUnreadMessagesBar:!1,statusBarVisible:!1,canReact:!1,canReply:!1,layout:k.b.getValue("layout"),matrixClientIsReady:this.context&&this.context.isInitialSyncComplete(),dragCounter:0},this.dispatcherRef=b.a.register(this.onAction),this.context.on("Room",this.onRoom),this.context.on("Room.timeline",this.onRoomTimeline),this.context.on("Room.name",this.onRoomName),this.context.on("Room.accountData",this.onRoomAccountData),this.context.on("RoomState.events",this.onRoomStateEvents),this.context.on("RoomState.members",this.onRoomStateMember),this.context.on("Room.myMembership",this.onMyMembership),this.context.on("accountData",this.onAccountData),this.context.on("crypto.keyBackupStatus",this.onKeyBackupStatus),this.context.on("deviceVerificationChanged",this.onDeviceVerificationChanged),this.context.on("userTrustStatusChanged",this.onUserVerificationChanged),this.context.on("crossSigning.keysChanged",this.onCrossSigningKeysChanged),this.context.on("Event.decrypted",this.onEventDecrypted),this.context.on("event",this.onEvent),this.roomStoreToken=O.a.addListener(this.onRoomViewStoreUpdate),this.rightPanelStoreToken=P.a.getSharedInstance().addListener(this.onRightPanelStoreUpdate),R.a.on(J.b,this.onWidgetEchoStoreUpdate),$.a.instance.on(J.b,this.onWidgetStoreUpdate),this.showReadReceiptsWatchRef=k.b.watchSetting("showReadReceipts",null,this.onReadReceiptsChange),this.layoutWatcherRef=k.b.watchSetting("layout",null,this.onLayoutChange)}getPermalinkCreatorForRoom(e){return this.permalinkCreators[e.roomId]||(this.permalinkCreators[e.roomId]=new h.a(e),this.state.room&&e.roomId===this.state.room.roomId?this.permalinkCreators[e.roomId].start():this.permalinkCreators[e.roomId].load()),this.permalinkCreators[e.roomId]}stopAllPermalinkCreators(){if(this.permalinkCreators)for(const e of Object.keys(this.permalinkCreators))this.permalinkCreators[e].stop()}setupRoom(e,t,a,n){!a&&t&&(!e&&n?(console.info("Attempting to peek into room %s",t),this.setState({peekLoading:!0,isPeeking:!0}),this.context.peekInRoom(t).then(e=>{this.unmounted||(this.setState({room:e,peekLoading:!1}),this.onRoomLoaded(e))}).catch(e=>{if(!this.unmounted){if(this.setState({isPeeking:!1}),"M_GUEST_ACCESS_FORBIDDEN"!==e.errcode&&"M_FORBIDDEN"!==e.errcode)throw e;this.setState({peekLoading:!1})}})):e&&(this.context.stopPeeking(),this.setState({isPeeking:!1})))}shouldShowApps(e){if(!ce||!e)return!1;const t="false"===localStorage.getItem(e.roomId+"_hide_widget_drawer");return ee.d.instance.getContainerWidgets(e,ee.a.Top).length>0||t}componentDidMount(){this.onRoomViewStoreUpdate(!0);const e=this.getCallForRoom(),t=e?e.state:null;this.setState({callState:t}),window.addEventListener("beforeunload",this.onPageUnload),this.props.resizeNotifier&&this.props.resizeNotifier.on("middlePanelResized",this.onResize),this.onResize()}shouldComponentUpdate(e,t){const a=Object(ae.c)(this.props,e),n=t.upgradeRecommendation||{},s=Object(ie.omit)(this.state,["upgradeRecommendation"]),i=Object(ie.omit)(t,["upgradeRecommendation"]),o=Object(ae.c)(s,i)||!0===n.needsUpgrade;return a||o}componentDidUpdate(){if(this.roomView.current){const e=this.roomView.current;e.ondrop||(e.addEventListener("drop",this.onDrop),e.addEventListener("dragover",this.onDragOver),e.addEventListener("dragenter",this.onDragEnter),e.addEventListener("dragleave",this.onDragLeave))}this.messagePanel&&!this.state.atEndOfLiveTimelineInit&&this.setState({atEndOfLiveTimelineInit:!0,atEndOfLiveTimeline:this.messagePanel.isAtEndOfLiveTimeline()})}componentWillUnmount(){if(this.unmounted=!0,this.state.roomId&&x.a.setScrollState(this.state.roomId,this.getScrollState()),this.state.shouldPeek&&this.context.stopPeeking(),this.stopAllPermalinkCreators(),this.roomView.current){const e=this.roomView.current;e.removeEventListener("drop",this.onDrop),e.removeEventListener("dragover",this.onDragOver),e.removeEventListener("dragenter",this.onDragEnter),e.removeEventListener("dragleave",this.onDragLeave)}b.a.unregister(this.dispatcherRef),this.context&&(this.context.removeListener("Room",this.onRoom),this.context.removeListener("Room.timeline",this.onRoomTimeline),this.context.removeListener("Room.name",this.onRoomName),this.context.removeListener("Room.accountData",this.onRoomAccountData),this.context.removeListener("RoomState.events",this.onRoomStateEvents),this.context.removeListener("Room.myMembership",this.onMyMembership),this.context.removeListener("RoomState.members",this.onRoomStateMember),this.context.removeListener("accountData",this.onAccountData),this.context.removeListener("crypto.keyBackupStatus",this.onKeyBackupStatus),this.context.removeListener("deviceVerificationChanged",this.onDeviceVerificationChanged),this.context.removeListener("userTrustStatusChanged",this.onUserVerificationChanged),this.context.removeListener("crossSigning.keysChanged",this.onCrossSigningKeysChanged),this.context.removeListener("Event.decrypted",this.onEventDecrypted),this.context.removeListener("event",this.onEvent)),window.removeEventListener("beforeunload",this.onPageUnload),this.props.resizeNotifier&&this.props.resizeNotifier.removeListener("middlePanelResized",this.onResize),this.roomStoreToken&&this.roomStoreToken.remove(),this.rightPanelStoreToken&&this.rightPanelStoreToken.remove(),R.a.removeListener(J.b,this.onWidgetEchoStoreUpdate),$.a.instance.removeListener(J.b,this.onWidgetStoreUpdate),this.state.room&&ee.d.instance.off(ee.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),this.showReadReceiptsWatchRef&&k.b.unwatchSetting(this.showReadReceiptsWatchRef),this.updateRoomMembers.cancelPendingCall(),k.b.unwatchSetting(this.layoutWatcherRef)}async calculateRecommendedVersion(e){this.setState({upgradeRecommendation:await e.getRecommendedVersion()})}async loadMembersIfJoined(e){if(this.context.hasLazyLoadMembersEnabled()&&e&&"join"===e.getMyMembership())try{await e.loadMembersIfNeeded(),this.unmounted||this.setState({membersLoaded:!0})}catch(t){const a=`Fetching room members for ${e.roomId} failed. Room members will appear incomplete.`;console.error(a),console.error(t)}}calculatePeekRules(e){const t=e.currentState.getStateEvents("m.room.guest_access","");t&&"can_join"===t.getContent().guest_access&&this.setState({guestsCanJoin:!0});const a=e.currentState.getStateEvents("m.room.history_visibility","");a&&"world_readable"===a.getContent().history_visibility&&this.setState({canPeek:!0})}updatePreviewUrlVisibility(e){let{roomId:t}=e;const a=this.context.isRoomEncrypted(t)?"urlPreviewsEnabled_e2ee":"urlPreviewsEnabled";this.setState({showUrlPreview:k.b.getValue(a,t)})}async updateE2EStatus(e){this.context.isRoomEncrypted(e.roomId)&&(this.context.isCryptoEnabled()?this.setState({e2eStatus:await Object(A.b)(this.context,e)}):this.setState({e2eStatus:A.a.Warning}))}updateTint(){const e=this.state.room;if(!e)return;console.log("Tinter.tint from updateTint");const t=k.b.getValue("roomColor",e.roomId);y.a.tint(t.primary_color,t.secondary_color)}updatePermissions(e){if(e){const t=this.context.getUserId(),a="join"===e.getMyMembership()&&e.currentState.maySendEvent("m.reaction",t),n=e.maySendMessage();this.setState({canReact:a,canReply:n})}}checkDesktopNotifications(){this.state.room.getJoinedMemberCount()+this.state.room.getInvitedMemberCount()>1&&Q.default.shouldShowPrompt()&&Object(X.b)(!0)}updateDMState(){const e=this.state.room;if("join"!=e.getMyMembership())return;const t=e.getDMInviter();t&&_.c(e.roomId,t)}injectSticker(e,t,a){this.context.isGuest()?b.a.dispatch({action:"require_registration"}):p.a.sharedInstance().sendStickerContentToRoom(e,this.state.room.roomId,t,a,this.context).then(void 0,e=>{e.name})}handleSearchResult(e){const t=this.searchId;return this.setState({searchInProgress:!0}),e.then(e=>{if(le("search complete"),this.unmounted||!this.state.searching||this.searchId!=t)return void console.error("Discarding stale search results");let a=e.highlights;a.indexOf(this.state.searchTerm)<0&&(a=a.concat(this.state.searchTerm)),a=a.sort((function(e,t){return t.length-e.length})),this.setState({searchHighlights:a,searchResults:e})},e=>{const t=f.getComponent("dialogs.ErrorDialog");console.error("Search failed",e),g.a.createTrackedDialog("Search failed","",t,{title:Object(u.a)("Search failed"),description:e&&e.message?e.message:Object(u.a)("Server may be unavailable, overloaded, or search timed out :(")})}).finally(()=>{this.setState({searchInProgress:!1})})}getSearchResultTiles(){const e=f.getComponent("rooms.SearchResultTile"),t=f.getComponent("elements.Spinner"),a=[];var n,s;(this.state.searchInProgress&&a.push(l.a.createElement("li",{key:"search-spinner"},l.a.createElement(t,null))),this.state.searchResults.next_batch)||(null!==(n=this.state.searchResults)&&void 0!==n&&null!==(s=n.results)&&void 0!==s&&s.length?a.push(l.a.createElement("li",{key:"search-top-marker"},l.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(u.a)("No more results")))):a.push(l.a.createElement("li",{key:"search-top-marker"},l.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(u.a)("No results")))));const i=()=>{const e=this.searchResultsPanel.current;e&&e.checkScroll()};let o;for(let t=((null===(r=this.state.searchResults)||void 0===r||null===(c=r.results)||void 0===c?void 0:c.length)||0)-1;t>=0;t--){var r,c;const n=this.state.searchResults.results[t],s=n.context.getEvent(),d=s.getRoomId(),m=this.context.getRoom(d);if(!m){console.log("Hiding search result from an unknown room",d);continue}if(!Object(N.b)(s))continue;"All"===this.state.searchScope&&d!==o&&(a.push(l.a.createElement("li",{key:s.getId()+"-room"},l.a.createElement("h2",null,Object(u.a)("Room"),": ",m.name))),o=d);const h="#/room/"+d+"/"+s.getId();a.push(l.a.createElement(e,{key:s.getId(),searchResult:n,searchHighlights:this.state.searchHighlights,resultLink:h,permalinkCreator:this.getPermalinkCreatorForRoom(m),onHeightChanged:i}))}return a}getScrollState(){const e=this.messagePanel;if(!e)return null;if(this.state.atEndOfLiveTimeline)return null;const t=e.getScrollState();return!t||t.stuckAtBottom?null:{focussedEvent:t.trackedScrollToken,pixelOffset:t.pixelOffset}}getCallForRoom(){return this.state.room?v.d.sharedInstance().getCallForRoom(this.state.room.roomId):null}getOldRoom(){const e=this.state.room.currentState.getStateEvents("m.room.create","");return e&&e.getContent().predecessor?this.context.getRoom(e.getContent().predecessor.room_id):null}getHiddenHighlightCount(){const e=this.getOldRoom();return e?e.getUnreadNotificationCount("highlight"):0}render(){var e;if(!this.state.room){const e=!this.state.matrixClientIsReady||this.state.roomLoading||this.state.peekLoading;if(e){const t=!this.state.matrixClientIsReady||!this.state.roomId||this.state.peekLoading;return l.a.createElement("div",{className:"mx_RoomView"},l.a.createElement(F.a,null,l.a.createElement(B.a,{canPreview:!1,previewLoading:t&&!this.state.roomLoadError,error:this.state.roomLoadError,loading:e,joining:this.state.joining,oobData:this.props.oobData})))}{var t,n;let e=void 0;this.props.oobData&&(e=this.props.oobData.inviterName);const a=null===(t=this.props.threepidInvite)||void 0===t?void 0:t.toEmail,s=this.state.roomAlias;return l.a.createElement("div",{className:"mx_RoomView"},l.a.createElement(F.a,null,l.a.createElement(B.a,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,canPreview:!1,error:this.state.roomLoadError,roomAlias:s,joining:this.state.joining,inviterName:e,invitedEmail:a,oobData:this.props.oobData,signUrl:null===(n=this.props.threepidInvite)||void 0===n?void 0:n.signUrl,room:this.state.room})))}}const s=this.state.room.getMyMembership();if(!("invite"!==s||k.b.getValue("feature_spaces")&&this.state.room.isSpaceRoom())){if(this.state.joining||this.state.rejecting)return l.a.createElement(F.a,null,l.a.createElement(B.a,{canPreview:!1,error:this.state.roomLoadError,joining:this.state.joining,rejecting:this.state.rejecting}));{const e=this.context.credentials.userId,t=this.state.room.getMember(e),a=t?t.events.member:null;let n=Object(u.a)("Unknown");return a&&(n=a.sender?a.sender.name:a.getSender()),l.a.createElement("div",{className:"mx_RoomView"},l.a.createElement(F.a,null,l.a.createElement(B.a,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectButtonClicked,onRejectAndIgnoreClick:this.onRejectAndIgnoreClick,inviterName:n,canPreview:!1,joining:this.state.joining,room:this.state.room})))}}let i=null;this.state.draggingFile&&(i=l.a.createElement("div",{className:"mx_RoomView_fileDropTarget"},l.a.createElement("img",{src:a(867),className:"mx_RoomView_fileDropTarget_image"}),Object(u.a)("Drop file here to upload")));let o=null;{const e=this.getCallForRoom();e&&"ended"!==this.state.callState&&"ringing"!==this.state.callState&&(o=e)}const r=d()({mx_RoomView_scrollheader:!0});let c,m=!0;if(p.a.sharedInstance().getCurrentUploads().length>0){const e=f.getComponent("structures.UploadBar");c=l.a.createElement(e,{room:this.state.room})}else if(!this.state.searchResults){const e=f.getComponent("structures.RoomStatusBar");m=this.state.statusBarVisible,c=l.a.createElement(e,{room:this.state.room,isPeeking:"join"!==s,onInviteClick:this.onInviteButtonClick,onVisible:this.onStatusBarVisible,onHidden:this.onStatusBarHidden})}const h=this.state.upgradeRecommendation,g=h&&h.needsUpgrade&&this.state.room.userMayUpgradeRoom(this.context.credentials.userId),v=this.getHiddenHighlightCount();let b,y=null,E=!1;if(this.state.forwardingEvent)y=l.a.createElement(V.a,{onCancelClick:this.onCancelClick});else if(this.state.searching)E=!0,y=l.a.createElement(G.a,{searchInProgress:this.state.searchInProgress,onCancelClick:this.onCancelSearchClick,onSearch:this.onSearch,isRoomEncrypted:this.context.isRoomEncrypted(this.state.room.roomId)});else if(g)y=l.a.createElement(z.a,{room:this.state.room,recommendation:h}),E=!0;else if("join"!==s){var _,S;let e=void 0;this.props.oobData&&(e=this.props.oobData.inviterName);const t=null===(_=this.props.threepidInvite)||void 0===_?void 0:_.toEmail;if(E=!0,b=l.a.createElement(B.a,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,joining:this.state.joining,inviterName:e,invitedEmail:t,oobData:this.props.oobData,canPreview:this.state.canPeek,room:this.state.room}),!(this.state.canPeek||k.b.getValue("feature_spaces")&&null!==(S=this.state.room)&&void 0!==S&&S.isSpaceRoom()))return l.a.createElement("div",{className:"mx_RoomView"},b)}else v>0&&(y=l.a.createElement(T.a,{element:"div",className:"mx_RoomView_auxPanel_hiddenHighlights",onClick:this.onHiddenHighlightsClick},Object(u.a)("You have %(count)s unread notifications in a prior version of this room.",{count:v})));if(null!==(e=this.state.room)&&void 0!==e&&e.isSpaceRoom())return l.a.createElement(ne.b,{space:this.state.room,justCreatedOpts:this.props.justCreatedOpts,resizeNotifier:this.props.resizeNotifier,onJoinButtonClicked:this.onJoinButtonClicked,onRejectButtonClicked:this.props.threepidInvite?this.onRejectThreepidInviteButtonClicked:this.onRejectButtonClicked});const O=l.a.createElement(W.a,{room:this.state.room,fullHeight:!1,userId:this.context.credentials.userId,maxHeight:this.state.auxPanelMaxHeight,showApps:this.state.showApps,onResize:this.onResize,resizeNotifier:this.props.resizeNotifier},y);let x,R;let P;"join"===s&&!this.state.searchResults&&(x=l.a.createElement(re.a,{room:this.state.room,e2eStatus:this.state.e2eStatus,resizeNotifier:this.props.resizeNotifier,replyToEvent:this.state.replyToEvent,permalinkCreator:this.getPermalinkCreatorForRoom(this.state.room)})),this.state.searchResults&&(R={searchTerm:this.state.searchTerm,searchScope:this.state.searchScope,searchCount:this.state.searchResults.count});let N=!1;this.state.searchResults&&(P=void 0===this.state.searchResults.count?l.a.createElement("div",{className:"mx_RoomView_messagePanel mx_RoomView_messagePanelSearchSpinner"}):l.a.createElement(U.a,{ref:this.searchResultsPanel,className:"mx_RoomView_messagePanel mx_RoomView_searchResultsPanel mx_GroupLayout",onFillRequest:this.onSearchResultsFillRequest,resizeNotifier:this.props.resizeNotifier},l.a.createElement("li",{className:r}),this.getSearchResultTiles()),N=!0);const j=this.state.isInitialEventHighlighted;let A=null;this.state.forwardingEvent?A=this.state.forwardingEvent.getId():j&&(A=this.state.initialEventId);const M=d()("mx_RoomView_messagePanel",{mx_IRCLayout:this.state.layout==I.a.IRC,mx_GroupLayout:this.state.layout==I.a.Group}),q=l.a.createElement(L.a,{ref:this.gatherTimelinePanelRef,timelineSet:this.state.room.getUnfilteredTimelineSet(),showReadReceipts:this.state.showReadReceipts,manageReadReceipts:!this.state.isPeeking,sendReadReceiptOnLoad:!this.state.wasContextSwitch,manageReadMarkers:!this.state.isPeeking,hidden:N,highlightedEventId:A,eventId:this.state.initialEventId,eventPixelOffset:this.state.initialEventPixelOffset,onScroll:this.onMessageListScroll,onUserScroll:this.onUserScroll,onReadMarkerUpdated:this.updateTopUnreadMessagesBar,showUrlPreview:this.state.showUrlPreview,className:M,membersLoaded:this.state.membersLoaded,permalinkCreator:this.getPermalinkCreatorForRoom(this.state.room),resizeNotifier:this.props.resizeNotifier,showReactions:!0,layout:this.state.layout});let Y,$=null;if(this.state.showTopUnreadMessagesBar&&!this.state.searchResults){const e=f.getComponent("rooms.TopUnreadMessagesBar");$=l.a.createElement(e,{onScrollUpClick:this.jumpToReadMarker,onCloseClick:this.forgetReadMarker})}if(!this.state.atEndOfLiveTimeline&&!this.state.searchResults){const e=f.getComponent("rooms.JumpToBottomButton");Y=l.a.createElement(e,{highlight:this.state.room.getUnreadNotificationCount("highlight")>0,numUnreadMessages:this.state.numUnreadMessages,onScrollToBottomClick:this.jumpToLiveTimeline,roomId:this.state.roomId})}const J=d()("mx_RoomView_statusArea",{mx_RoomView_statusArea_expanded:m}),Q=this.state.room&&this.state.showRightPanel?l.a.createElement(w.a,{room:this.state.room,resizeNotifier:this.props.resizeNotifier}):null,X=d()("mx_RoomView_timeline",{mx_RoomView_timeline_rr_enabled:this.state.showReadReceipts}),Z=d()("mx_RoomView",{mx_RoomView_inCall:Boolean(o)}),ee=k.b.getValue("showChatEffects");return l.a.createElement(D.a.Provider,{value:this.state},l.a.createElement("main",{className:Z,ref:this.roomView,onKeyDown:this.onReactKeyDown},ee&&this.roomView.current&&l.a.createElement(K.a,{roomWidth:this.roomView.current.offsetWidth}),l.a.createElement(F.a,null,l.a.createElement(H.a,{room:this.state.room,searchInfo:R,oobData:this.props.oobData,inRoom:"join"===s,onSearchClick:this.onSearchClick,onSettingsClick:this.onSettingsClick,onCancelClick:y&&!E?this.onCancelClick:null,onForgetClick:"leave"===s?this.onForgetClick:null,onLeaveClick:"join"===s?this.onLeaveClick:null,e2eStatus:this.state.e2eStatus,onAppsClick:this.state.hasPinnedWidgets?this.onAppsClick:null,appsShown:this.state.showApps,onCallPlaced:this.onCallPlaced}),l.a.createElement(C.a,{panel:Q,resizeNotifier:this.props.resizeNotifier},l.a.createElement("div",{className:"mx_RoomView_body"},O,l.a.createElement("div",{className:X},i,$,Y,q,P),l.a.createElement("div",{className:J},l.a.createElement("div",{className:"mx_RoomView_statusAreaBox"},l.a.createElement("div",{className:"mx_RoomView_statusAreaBox_line"}),c)),b,x)))))}},o()(s,"contextType",j.a),n=s))||n}).call(this,a(212).setImmediate)},2756:function(e,t,a){var n={"./":[282,9],"./ICanvasEffect":[1537,7,8],"./ICanvasEffect.ts":[1537,7,8],"./confetti":[628,9,0],"./confetti/":[628,9,0],"./confetti/index":[628,9,0],"./confetti/index.ts":[628,9,0],"./effect":[1538,7,9],"./effect.ts":[1538,7,9],"./fireworks":[629,9,1],"./fireworks/":[629,9,1],"./fireworks/index":[629,9,1],"./fireworks/index.ts":[629,9,1],"./index":[282,9],"./index.ts":[282,9],"./snowfall":[630,9,2],"./snowfall/":[630,9,2],"./snowfall/index":[630,9,2],"./snowfall/index.ts":[630,9,2],"./spaceinvaders":[631,9,3],"./spaceinvaders/":[631,9,3],"./spaceinvaders/index":[631,9,3],"./spaceinvaders/index.ts":[631,9,3],"./utils":[374,9],"./utils.ts":[374,9]};function s(e){if(!a.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],s=t[0];return Promise.all(t.slice(2).map(a.e)).then((function(){return a.t(s,t[1])}))}s.keys=function(){return Object.keys(n)},s.id=2756,e.exports=s},277:function(e,t,a){"use strict";(function(e){var n=a(569),s=a(100),i=a(192),o=a(181),r=a(571),l=a(99),c=a(103);const d={orderedTags:null,orderedTagsAccountData:null,hasSynced:!1,joinedGroupIds:null,selectedTags:[],anchorTag:null};class m extends n.Store{constructor(){super(s.a),this._state=Object.assign({},d),c.b.monitorSetting("TagPanel.enableTagPanel",null)}_setState(e){this._state=Object.assign(this._state,e),this.__emitChange()}__onDispatch(e){switch(e.action){case"view_room":{const t=i.a.getGroupIdsForRoomId(e.room_id);this._updateBadges(t);break}case"MatrixActions.sync":{if("SYNCING"!==e.state&&"PREPARED"!==e.state||this._updateBadges(),"PREPARED"===e.prevState||"PREPARED"!==e.state)break;const t=e.matrixClient.getAccountData("im.vector.web.tag_ordering"),a=t?t.getContent():{};this._setState({orderedTagsAccountData:a.tags||null,removedTagsAccountData:a.removedTags||null,hasSynced:!0}),this._updateOrderedTags();break}case"MatrixActions.accountData":if("im.vector.web.tag_ordering"!==e.event_type)break;if(e.event_content._storeId===this.getStoreId())break;this._setState({orderedTagsAccountData:e.event_content?e.event_content.tags:null,removedTagsAccountData:e.event_content?e.event_content.removedTags:null}),this._updateOrderedTags();break;case"GroupActions.fetchJoinedGroups.success":this._setState({joinedGroupIds:e.result.groups.sort(),hasFetchedJoinedGroups:!0}),this._updateOrderedTags();break;case"TagOrderActions.moveTag.pending":this._setState({orderedTags:e.request.tags,removedTagsAccountData:e.request.removedTags});break;case"TagOrderActions.removeTag.pending":this._setState({removedTagsAccountData:e.request.removedTags}),this._updateOrderedTags();break;case"select_tag":{const t=!c.b.getValue("feature_communities_v2_prototypes");let a=[];if(e.shiftKey&&t){let t=this._state.orderedTags.indexOf(this._state.anchorTag),n=this._state.orderedTags.indexOf(e.tag);if(-1===t&&(t=n),t>n){const e=t;t=n,n=e}a=e.ctrlOrCmdKey?this._state.selectedTags:[],a=[...new Set(this._state.orderedTags.slice(t,n+1).concat(a))]}else a=e.ctrlOrCmdKey&&t?this._state.selectedTags.includes(e.tag)?this._state.selectedTags.filter(t=>t!==e.tag):[...this._state.selectedTags,e.tag]:1===this._state.selectedTags.length&&this._state.selectedTags.includes(e.tag)?[]:[e.tag],this._state.selectedTags.includes(e.tag)||this._setState({anchorTag:e.tag});this._setState({selectedTags:a}),o.a.trackEvent("FilterStore","select_tag")}break;case"deselect_tags":e.tag?this._setState({selectedTags:this._state.selectedTags.filter(t=>t!==e.tag)}):this._setState({selectedTags:[]}),o.a.trackEvent("FilterStore","deselect_tags");break;case"on_client_not_viable":case"on_logged_out":this._state=Object.assign({},d);break;case"setting_updated":"TagPanel.enableTagPanel"!==e.settingName||e.newValue||(this._setState({selectedTags:[]}),o.a.trackEvent("FilterStore","disable_tags"))}}_updateBadges(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._state.joinedGroupIds;if(e&&e.length){const t=l.a.get(),a={};e.forEach(e=>{const n=i.a.getGroupRooms(e).map(e=>t.getRoom(e.roomId)).filter(e=>null!=e),s=n&&r.e(n);a[e]=s&&0!==s.count?s:void 0});const n=Object.assign({},this._state.badges,a);this._setState({badges:n})}}_updateOrderedTags(){this._setState({orderedTags:this._state.hasSynced&&this._state.hasFetchedJoinedGroups?this._mergeGroupsAndTags():null})}_mergeGroupsAndTags(){const e=this._state.joinedGroupIds||[],t=this._state.orderedTagsAccountData||[],a=new Set(this._state.removedTagsAccountData||[]),n=t.filter(t=>("+"!==t[0]||e.includes(t))&&!a.has(t)),s=e.filter(e=>!t.includes(e)&&!a.has(e));return n.concat(s)}getGroupBadge(e){const t=this._state.badges;return t&&t[e]}getOrderedTags(){return this._state.orderedTags}getRemovedTagsAccountData(){return this._state.removedTagsAccountData}getStoreId(){return this._id||(this._id=Math.random().toString(16).slice(2,10)),this._id}getSelectedTags(){return this._state.selectedTags}}void 0===e.singletonGroupFilterOrderStore&&(e.singletonGroupFilterOrderStore=new m),t.a=e.singletonGroupFilterOrderStore}).call(this,a(7))},278:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(19),l=a.n(r),c=a(88),d=a.n(c),m=a(100),u=a(115),h=a(227),p=a(94),g=a(126);const f=["member","fallbackUserId","onClick","viewUserOnClick"];var v,b;let y=Object(p.a)("views.avatars.MemberAvatar")((b=class e extends d.a.Component{constructor(t){super(t),this.state=e.getState(t)}static getDerivedStateFromProps(t){return e.getState(t)}static getState(e){var t;if(null!==(t=e.member)&&void 0!==t&&t.name){let t=null;return e.member.getMxcAvatarUrl()&&(t=Object(g.b)(e.member.getMxcAvatarUrl()).getThumbnailOfSourceHttp(e.width,e.height,e.resizeMethod)),{name:e.member.name,title:e.title||e.member.userId,imageUrl:t}}if(e.fallbackUserId)return{name:e.fallbackUserId,title:e.fallbackUserId};console.error("MemberAvatar called somehow with null member or fallbackUserId")}render(){let e=this.props,{member:t,fallbackUserId:a,onClick:n,viewUserOnClick:i}=e,r=o()(e,f);const l=t?t.userId:a;return i&&(n=()=>{m.a.dispatch({action:u.a.ViewUser,member:this.props.member})}),d.a.createElement(h.a,s()({},r,{name:this.state.name,title:this.state.title,idName:l,url:this.state.imageUrl,onClick:n}))}},l()(b,"defaultProps",{width:40,height:40,resizeMethod:"crop",viewUserOnClick:!1}),v=b))||v},279:function(e,t,a){"use strict";a.d(t,"d",(function(){return _})),a.d(t,"a",(function(){return S})),a.d(t,"c",(function(){return x})),a.d(t,"e",(function(){return R})),a.d(t,"b",(function(){return k})),a.d(t,"f",(function(){return I}));var n=a(106),s=a(97),i=a(99),o=a(587),r=a(588),l=a(93),c=a(213),d=a(419),m=a(1343),u=a(426),h=a(103),p=a(338);let g={},f={},v=!1,b=!1,y={};function E(){return v}function _(){return v}class S extends Error{constructor(){super("Secret storage access canceled")}}async function C(){const e=s.getComponent("dialogs.QuestionDialog"),[t]=await n.a.createDialog(e,{title:Object(l.a)("Cancel entering passphrase?"),description:Object(l.a)("Are you sure you want to cancel entering passphrase?"),danger:!1,button:Object(l.a)("Go Back"),cancelButton:Object(l.a)("Cancel")}).finished;return!t}function w(e){return async t=>{let{passphrase:a,recoveryKey:n}=t;return a?Object(o.a)(a,e.passphrase.salt,e.passphrase.iterations):Object(r.a)(n)}}function O(e,t,a){E()&&(g[e]=a,f[e]=t)}const x={getSecretStorageKey:async function(e,t){var a;let{keys:s}=e;const o=i.a.get();let r,l=await o.getDefaultSecretStorageKeyId();if(l&&(r=s[l],r||(l=void 0)),!l){const e=Object.entries(s);if(e.length>1)throw new Error("Multiple storage key requests not implemented");[l,r]=e[0]}if(E()&&g[l])return[l,g[l]];if(y.key&&await i.a.get().checkSecretStorageKey(y.key,r))return O(l,r,y.key),[l,y.key];const c=null===(a=p.a.getSecretStorageKey)||void 0===a?void 0:a.call(p.a);if(c)return console.log("Using key from security customisations (secret storage)"),O(l,r,c),[l,c];if(b)throw new Error("Could not unlock non-interactively");const d=w(r),{finished:u}=n.a.createTrackedDialog("Access Secret Storage dialog","",m.a,{keyInfo:r,checkPrivateKey:async e=>{const t=await d(e);return await i.a.get().checkSecretStorageKey(t,r)}},null,!1,!1,{onBeforeClose:async e=>"backgroundClick"!==e||C()}),[h]=await u;if(!h)throw new S;const f=await d(h);return O(l,r,f),[l,f]},cacheSecretStorageKey:O,onSecretRequested:async function(e,t,a,n,s){console.log("onSecretRequested",e,t,a,n,s);const o=i.a.get();if(e===o.getUserId())if(s&&s.isVerified()){if("m.cross_signing.master"===n||"m.cross_signing.self_signing"===n||"m.cross_signing.user_signing"===n){const e=o.getCrossSigningCacheCallbacks();if(!e.getCrossSigningKeyCache)return;const a=n.replace("m.cross_signing.",""),s=await e.getCrossSigningKeyCache(a);return s||console.log(`${a} requested by ${t}, but not found in cache`),s&&Object(c.encodeBase64)(s)}if("m.megolm_backup.v1"===n){const e=await o.crypto.getSessionBackupPrivateKey();return e||console.log(`session backup key requested by ${t}, but not found in cache`),e&&Object(c.encodeBase64)(e)}console.warn("onSecretRequested didn't recognise the secret named ",n)}else console.log("Ignoring secret request from untrusted device "+t)},getDehydrationKey:async function(e,t){var a;const s=null===(a=p.a.getSecretStorageKey)||void 0===a?void 0:a.call(p.a);if(s)return console.log("Using key from security customisations (dehydration)"),s;const i=w(e),{finished:o}=n.a.createTrackedDialog("Access Secret Storage dialog","",m.a,{keyInfo:e,checkPrivateKey:async e=>{const a=await i(e);try{return t(a),!0}catch(e){return!1}}},null,!1,!1,{onBeforeClose:async e=>"backgroundClick"!==e||C()}),[r]=await o;if(!r)throw new S;const l=await i(r);return y={key:new Uint8Array(l),keyInfo:e},l}};async function R(){let e;const{finished:t}=n.a.createTrackedDialog("Restore Backup","",u.a,{showSummary:!1,keyCallback:t=>e=t},null,!1,!0);if(!await t)throw new Error("Key backup prompt cancelled");return e}async function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:async()=>{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=i.a.get();v=!0;try{if(!await o.hasSecretStorageKey()||t){const{finished:e}=n.a.createTrackedDialogAsync("Create Secret Storage dialog","",a.e(33).then(a.bind(null,8458)),{forceReset:t},null,!1,!0,{onBeforeClose:async e=>"backgroundClick"!==e||!Object(d.d)()}),[s]=await e;if(!s)throw new Error("Secret storage creation canceled")}else{const e=s.getComponent("dialogs.InteractiveAuthDialog");await o.bootstrapCrossSigning({authUploadDeviceSigningKeys:async t=>{const{finished:a}=n.a.createTrackedDialog("Cross-signing keys dialog","",e,{title:Object(l.a)("Setting up keys"),matrixClient:o,makeRequest:t}),[s]=await a;if(!s)throw new Error("Cross-signing key upload auth canceled")}}),await o.bootstrapSecretStorage({getKeyBackupPassphrase:R});const t=Object.keys(g)[0];if(t&&h.b.getValue("feature_dehydration")){let e={};f[t]&&f[t].passphrase&&(e={passphrase:f[t].passphrase}),console.log("Setting dehydration key"),await o.setDehydrationKey(g[t],e,"Backup device")}else t?console.log("Not setting dehydration key: feature disabled"):console.warn("Not setting dehydration key: no SSSS key found")}return await e()}catch(e){var r;throw null===(r=p.a.catchAccessSecretStorageError)||void 0===r||r.call(p.a,e),console.error(e),e}finally{v=!1,E()||(g={},f={})}}async function I(e){const t=y.key;let a=!1;if(t&&await e.isSecretStorageReady()){console.log("Trying to set up cross-signing using dehydration key"),v=!0,b=!0;try{await e.checkOwnCrossSigningTrust();let n={};y.keyInfo&&y.keyInfo.passphrase&&(n={passphrase:y.keyInfo.passphrase}),await e.setDehydrationKey(t,n,"Backup device");const s=await e.getKeyBackupVersion();s&&(a=!0,e.restoreKeyBackupWithSecretStorage(s).finally(()=>{v=!1,b=!1,E()||(g={},f={})}))}finally{y={},a||(v=!1,b=!1,E()||(g={},f={}))}}}},280:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(88),s=a.n(n),i=a(92),o=a.n(i),r=a(102),l=a.n(r),c=a(93),d=a(108),m=a(293);const u={VERIFIED:"verified",WARNING:"warning",UNKNOWN:"unknown",NORMAL:"normal",UNAUTHENTICATED:"unauthenticated"},h={[u.WARNING]:Object(c.b)("This user has not verified all of their sessions."),[u.NORMAL]:Object(c.b)("You have not verified this user."),[u.VERIFIED]:Object(c.b)("You have verified this user. This user has verified all of their sessions.")},p={[u.WARNING]:Object(c.b)("Someone is using an unknown session"),[u.NORMAL]:Object(c.b)("This room is end-to-end encrypted"),[u.VERIFIED]:Object(c.b)("Everyone in this room is verified")},g=e=>{let{isUser:t,status:a,className:i,size:o,onClick:r,hideTooltip:g,bordered:f}=e;const[v,b]=Object(n.useState)(!1),y=l()({mx_E2EIcon:!0,mx_E2EIcon_bordered:f,mx_E2EIcon_warning:a===u.WARNING,mx_E2EIcon_normal:a===u.NORMAL,mx_E2EIcon_verified:a===u.VERIFIED},i);let E,_;E=t?h[a]:p[a],o&&(_={width:o+"px",height:o+"px"});const S=()=>b(!0),C=()=>b(!1);let w;return v&&!g&&(w=s.a.createElement(m.b,{label:E?Object(c.a)(E):""})),r?s.a.createElement(d.a,{onClick:r,onMouseOver:S,onMouseLeave:C,className:y,style:_},w):s.a.createElement("div",{onMouseOver:S,onMouseLeave:C,className:y,style:_},w)};g.propTypes={isUser:o.a.bool,status:o.a.oneOf(Object.values(u)),className:o.a.string,size:o.a.number,onClick:o.a.func},t.b=g},281:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(496),u=a(94);let h=Object(u.a)("views.elements.LabelledToggleSwitch")((s=class extends l.a.Component{render(){let e=l.a.createElement("span",{className:"mx_SettingsFlag_label"},this.props.label),t=l.a.createElement(m.a,{checked:this.props.value,disabled:this.props.disabled,onChange:this.props.onChange,"aria-label":this.props.label});if(this.props.toggleInFront){const a=e;e=t,t=a}const a="mx_SettingsFlag "+(this.props.className||"");return l.a.createElement("div",{className:a},e,t)}},o()(s,"propTypes",{value:d.a.bool.isRequired,onChange:d.a.func.isRequired,label:d.a.string.isRequired,disabled:d.a.bool,toggleInFront:d.a.bool,className:d.a.string}),n=s))||n},282:function(e,t,a){"use strict";a.r(t),a.d(t,"CHAT_EFFECTS",(function(){return s}));var n=a(93);const s=[{emojis:["🎊","🎉"],msgType:"nic.custom.confetti",command:"confetti",description:()=>Object(n.b)("Sends the given message with confetti"),fallbackMessage:()=>Object(n.a)("sends confetti")+" 🎉",options:{maxCount:150,speed:3,frameInterval:15,alpha:1,gradient:!1}},{emojis:["🎆"],msgType:"nic.custom.fireworks",command:"fireworks",description:()=>Object(n.b)("Sends the given message with fireworks"),fallbackMessage:()=>Object(n.a)("sends fireworks")+" 🎆",options:{maxCount:500,gravity:.05}},{emojis:["❄","🌨"],msgType:"io.element.effect.snowfall",command:"snowfall",description:()=>Object(n.b)("Sends the given message with snowfall"),fallbackMessage:()=>Object(n.a)("sends snowfall")+" ❄",options:{maxCount:200,gravity:.05,maxDrift:5}},{emojis:["👾","🌌"],msgType:"io.element.effects.space_invaders",command:"spaceinvaders",description:()=>Object(n.b)("Sends the given message with a space themed effect"),fallbackMessage:()=>Object(n.a)("sends space invaders")+" 👾",options:{maxCount:50,gravity:.01}}]},283:function(e,t,a){"use strict";a.d(t,"a",(function(){return O}));var n=a(19),s=a.n(n),i=a(110),o=a(106),r=a(223),l=a.n(r),c=a(103),d=a(489),m=a(99),u=a(515),h=a.n(u),p=a(329);class g{constructor(e,t){this.apiUrl=e,this.uiUrl=t,s()(this,"scalarToken",void 0),s()(this,"termsInteractionCallback",void 0),s()(this,"isDefaultManager",void 0),this.scalarToken=null,this.termsInteractionCallback=void 0;const a=i.a.get().integrations_rest_url,n=i.a.get().integrations_ui_url;this.isDefaultManager=e===a&&n===t}writeTokenToStore(){window.localStorage.setItem("mx_scalar_token_at_"+this.apiUrl,this.scalarToken),this.isDefaultManager&&window.localStorage.removeItem("mx_scalar_token")}readTokenFromStore(){let e=window.localStorage.getItem("mx_scalar_token_at_"+this.apiUrl);return!e&&this.isDefaultManager&&(e=window.localStorage.getItem("mx_scalar_token")),e}readToken(){return this.scalarToken?this.scalarToken:this.readTokenFromStore()}setTermsInteractionCallback(e){this.termsInteractionCallback=e}connect(){return this.getScalarToken().then(e=>{this.scalarToken=e})}hasCredentials(){return null!=this.scalarToken}getScalarToken(){const e=this.readToken();return e?this.checkToken(e).catch(e=>{if(e instanceof d.b)throw e;return this.registerForToken()}):this.registerForToken()}getAccountName(e){const t=this.apiUrl+"/account";return new Promise((function(a,n){h()({method:"GET",uri:t,qs:{scalar_token:e,v:"1.1"},json:!0},(e,t,s)=>{e?n(e):s&&"M_TERMS_NOT_SIGNED"===s.errcode?n(new d.b):t.statusCode/100!=2?n(s):s&&s.user_id?a(s.user_id):n(new Error("Missing user_id in response"))})}))}checkToken(e){return this.getAccountName(e).then(t=>{const a=m.a.get().getUserId();if(t!==a)throw new Error("Scalar token is owned by someone else: "+a);return e}).catch(t=>{if(t instanceof d.b){console.log("Integration manager requires new terms to be agreed to");const t=l.a.parse(this.apiUrl);return t.path="",t.pathname="",Object(d.d)([new d.a(p.a.IM,l.a.format(t),e)],this.termsInteractionCallback).then(()=>e)}throw t})}registerForToken(){return m.a.get().getOpenIdToken().then(e=>this.exchangeForScalarToken(e)).then(e=>this.checkToken(e)).then(e=>(this.scalarToken=e,this.writeTokenToStore(),e))}exchangeForScalarToken(e){const t=this.apiUrl;return new Promise((function(a,n){h()({method:"POST",uri:t+"/register",qs:{v:"1.1"},body:e,json:!0},(e,t,s)=>{e?n(e):t.statusCode/100!=2?n(new Error("Scalar request failed: "+t.statusCode)):s&&s.scalar_token?a(s.scalar_token):n(new Error("Missing scalar_token in response"))})}))}getScalarPageTitle(e){let t=this.apiUrl+"/widgets/title_lookup";return t=this.getStarterLink(t),t+="&curl="+encodeURIComponent(e),new Promise((function(e,a){h()({method:"GET",uri:t,json:!0},(t,n,s)=>{if(t)a(t);else if(n.statusCode/100!=2)a(new Error("Scalar request failed: "+n.statusCode));else if(s){let t="";s.page_title_cache_item&&s.page_title_cache_item.cached_title&&(t=s.page_title_cache_item.cached_title),e(t)}else a(new Error("Missing page title in response"))})}))}disableWidgetAssets(e,t){let a=this.apiUrl+"/widgets/set_assets_state";return a=this.getStarterLink(a),new Promise((n,s)=>{h()({method:"GET",uri:a,json:!0,qs:{widget_type:e.preferred,widget_id:t,state:"disable"}},(e,t,a)=>{e?s(e):t.statusCode/100!=2?s(new Error("Scalar request failed: "+t.statusCode)):a?n():s(new Error("Failed to set widget assets state"))})})}getScalarInterfaceUrlForRoom(e,t,a){const n=e.roomId,s=e.name;let i=this.uiUrl;return i+="?scalar_token="+encodeURIComponent(this.scalarToken),i+="&room_id="+encodeURIComponent(n),i+="&room_name="+encodeURIComponent(s),i+="&theme="+encodeURIComponent(c.b.getValue("theme")),a&&(i+="&integ_id="+encodeURIComponent(a)),t&&(i+="&screen="+encodeURIComponent(t)),i}getStarterLink(e){return e+"?scalar_token="+encodeURIComponent(this.scalarToken)}}var f=a(1302);let v;!function(e){e.Account="account",e.Config="config",e.Homeserver="homeserver"}(v||(v={}));class b{constructor(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,n=arguments.length>3?arguments[3]:void 0;s()(this,"apiUrl",void 0),s()(this,"uiUrl",void 0),s()(this,"kind",void 0),s()(this,"id",void 0),this.kind=e,this.apiUrl=t,this.uiUrl=a,this.id=n}get name(){return l.a.parse(this.uiUrl).host}get trimmedApiUrl(){const e=l.a.parse(this.apiUrl);return e.pathname="",e.path="",l.a.format(e)}getScalarClient(){return new g(this.apiUrl,this.uiUrl)}async open(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!c.b.getValue("integrationProvisioning"))return O.sharedInstance().showDisabledDialog();const n=o.a.createTrackedDialog("Integration Manager","",f.a,{loading:!0},"mx_IntegrationManager"),s=this.getScalarClient();s.setTermsInteractionCallback((e,t)=>Object(d.c)(e,t,"mx_TermsDialog_forIntegrationManager"));const i={};try{await s.connect(),s.hasCredentials()?i.url=s.getScalarInterfaceUrlForRoom(e,t,a):i.connected=!1}catch(e){if(e instanceof d.b)return void n.close();console.error(e),i.connected=!1}n.close(),o.a.createTrackedDialog("Integration Manager","",f.a,i,"mx_IntegrationManager")}}var y=a(1303),E=a(1304),_=a(1306),S=a(215),C=a(226);const w=[v.Account,v.Homeserver,v.Config];class O{static sharedInstance(){return O.instance||(O.instance=new O),O.instance}constructor(){s()(this,"managers",[]),s()(this,"client",void 0),s()(this,"primaryManager",void 0),s()(this,"setupHomeserverManagers",async e=>{if(console.log("Updating homeserver-configured integration managers..."),e&&e["m.integrations"]){let t=e["m.integrations"].managers;Array.isArray(t)||(t=[]),console.log(`Homeserver has ${t.length} integration managers`),this.managers=this.managers.filter(e=>e.kind!==v.Homeserver);for(const e of t)e.api_url&&this.managers.push(new b(v.Homeserver,e.api_url,e.ui_url));this.primaryManager=null}else console.log("Homeserver has no integration managers")}),s()(this,"onAccountData",e=>{"m.widgets"===e.getType()&&this.compileManagers()}),this.compileManagers()}startWatching(){this.stopWatching(),this.client=m.a.get(),this.client.on("accountData",this.onAccountData),this.client.on("WellKnown.client",this.setupHomeserverManagers),this.compileManagers()}stopWatching(){this.client&&(this.client.removeListener("accountData",this.onAccountData),this.client.removeListener("WellKnown.client",this.setupHomeserverManagers))}compileManagers(){this.managers=[],this.setupConfiguredManager(),this.setupAccountManagers()}setupConfiguredManager(){const e=i.a.get().integrations_rest_url,t=i.a.get().integrations_ui_url;e&&t&&(this.managers.push(new b(v.Config,e,t)),this.primaryManager=null)}setupAccountManagers(){if(!this.client||!this.client.getUserId())return;S.a.getIntegrationManagerWidgets().forEach(e=>{const t=e.content.data;if(!t)return;const a=e.content.url,n=t.api_url;if(!n||!a)return;const s=new b(v.Account,n,a,e.id||e.state_key||"");this.managers.push(s)}),this.primaryManager=null}hasManager(){return this.managers.length>0}getOrderedManagers(){const e=[];for(const t of w){const a=this.managers.filter(e=>e.kind===t);a&&a.length&&(t===v.Account&&a.sort((e,t)=>Object(C.a)(e.id,t.id)),e.push(...a))}return e}getPrimaryManager(){return this.hasManager()?(this.primaryManager||(this.primaryManager=this.getOrderedManagers()[0]),this.primaryManager):null}openNoManagerDialog(){o.a.createTrackedDialog("Integrations impossible","",y.a)}openAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return c.b.getValue("integrationProvisioning")?0===this.managers.length?this.openNoManagerDialog():void o.a.createTrackedDialog("Tabbed Integration Manager","",E.a,{room:e,screen:t,integrationId:a},"mx_TabbedIntegrationManagerDialog"):this.showDisabledDialog()}showDisabledDialog(){o.a.createTrackedDialog("Integrations disabled","",_.a)}async overwriteManagerOnAccount(e){await S.a.removeIntegrationManagerWidgets(),await S.a.addIntegrationManagerWidget(e.name,e.uiUrl,e.apiUrl)}async tryDiscoverManager(e){let t;console.log("Looking up integration manager via .well-known"),(e.startsWith("http:")||e.startsWith("https:"))&&(e=l.a.parse(e).host);try{const a=await fetch(`https://${e}/.well-known/matrix/integrations`);t=await a.json()}catch(e){return console.error(e),console.warn("Failed to locate integration manager"),null}if(!t||!t["m.integrations_widget"])return console.warn("Missing integrations widget on .well-known response"),null;const a=t["m.integrations_widget"];if(!a.url||!a.data||!a.data.api_url)return console.warn("Malformed .well-known response for integrations widget"),null;const n=new b(v.Account,a.data.api_url,a.url);return console.log("Got an integration manager (untested)"),n}}s()(O,"instance",void 0),window.mxIntegrationManagers=O},293:function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"b",(function(){return f}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(129),d=a.n(c),m=a(102),u=a.n(m),h=a(94),p=a(200);let g;!function(e){e[e.Natural=0]="Natural",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Top=3]="Top",e[e.Bottom=4]="Bottom"}(g||(g={}));let f=Object(h.a)("views.elements.Tooltip")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"tooltipContainer",void 0),o()(this,"tooltip",void 0),o()(this,"parent",void 0),o()(this,"renderTooltip",()=>{const e=this.updatePosition({});e.display=this.props.visible?"block":"none";const t=u()("mx_Tooltip",this.props.tooltipClassName,{mx_Tooltip_visible:this.props.visible,mx_Tooltip_invisible:!this.props.visible}),a=l.a.createElement("div",{className:t,style:e},l.a.createElement("div",{className:"mx_Tooltip_chevron"}),this.props.label);this.tooltip=d.a.render(a,this.tooltipContainer)})}componentDidMount(){this.tooltipContainer=document.createElement("div"),this.tooltipContainer.className="mx_Tooltip_wrapper",document.body.appendChild(this.tooltipContainer),window.addEventListener("scroll",this.renderTooltip,{passive:!0,capture:!0}),this.parent=d.a.findDOMNode(this).parentNode,this.renderTooltip()}componentDidUpdate(){this.renderTooltip()}componentWillUnmount(){d.a.unmountComponentAtNode(this.tooltipContainer),document.body.removeChild(this.tooltipContainer),window.removeEventListener("scroll",this.renderTooltip,{capture:!0})}updatePosition(e){const t=this.parent.getBoundingClientRect();let a=0;a=t.height>25?Math.floor((t.height-25)/2):Math.floor(t.height-25);const n=p.b.instance.windowWidth,s=t.top-2+this.props.yOffset+window.pageYOffset,i=s+a,o=n-t.right-window.pageXOffset-16,r=t.right+window.pageXOffset+6,l=t.right-window.pageXOffset-t.width/2;switch(this.props.alignment){case g.Natural:if(t.right>n/2){e.right=o,e.top=i;break}case g.Right:e.left=r,e.top=i;break;case g.Left:e.right=o,e.top=i;break;case g.Top:e.top=s-16,e.left=l;break;case g.Bottom:e.top=s+t.height,e.left=l}return e}render(){return l.a.createElement("div",{className:this.props.className})}},o()(s,"Alignment",g),o()(s,"defaultProps",{visible:!0,yOffset:0,alignment:g.Natural}),n=s))||n},294:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return i}));function n(e){return o(e,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}function s(e){return o(e,"abcdefghijklmnopqrstuvwxyz")}function i(e){return o(e,"ABCDEFGHIJKLMNOPQRSTUVWXYZ")}function o(e,t){let a="";for(let n=0;n<e;++n)a+=t.charAt(Math.floor(Math.random()*t.length));return a}},295:function(e,t,a){"use strict";a.d(t,"a",(function(){return m})),a.d(t,"e",(function(){return u})),a.d(t,"b",(function(){return h})),a.d(t,"c",(function(){return p})),a.d(t,"d",(function(){return g}));var n=a(99),s=a(93),i=a(106),o=a(186),r=a(88),l=a.n(r),c=a(100),d=a(165);let m;function u(e){const t={[m.Invite]:[],[m.Join]:[],[m.Leave]:[]};for(const a of e)t[h(a.getMyMembership())].push(a);return t}function h(e){return"invite"===e?m.Invite:"join"===e?m.Join:m.Leave}function p(e){const t=h(e);return t===m.Join||t===m.Invite}async function g(e){let t=!0;const a=await n.a.get().getRoomUpgradeHistory(e);if(a&&a.length>0){a[a.length-1].roomId!==e&&(t=!1)}let r={};if(t)r=await n.a.get().leaveRoomChain(e);else try{await n.a.get().leave(e)}catch(t){if(t&&t.data&&t.data.errcode){const a=t.data.error||Object(s.a)("Unexpected server error trying to leave the room");r[e]=Object.assign(new Error(a),{errcode:t.data.errcode})}else r[e]=t||new Error("Failed to leave room for unknown causes")}const m=Object.entries(r).filter(e=>!!e[1]);if(m.length>0){const t=[];for(const a of m){const n=a[1];let c=Object(s.a)("Unexpected server error trying to leave the room");if(n.errcode&&n.message){if("M_CANNOT_LEAVE_SERVER_NOTICE_ROOM"===n.errcode)return void i.a.createTrackedDialog("Error Leaving Room","",o.a,{title:Object(s.a)("Can't leave Server Notices room"),description:Object(s.a)("This room is used for important messages from the Homeserver, so you cannot leave it.")});c=r[e].message}t.push(c,l.a.createElement("BR"))}i.a.createTrackedDialog("Error Leaving Room","",o.a,{title:Object(s.a)("Error leaving room"),description:t})}else d.a.getRoomId()===e&&c.a.dispatch({action:"view_home_page"})}!function(e){e.Join="JOIN",e.Invite="INVITE",e.Leave="LEAVE"}(m||(m={}))},296:function(e,t,a){"use strict";a.d(t,"a",(function(){return B})),a.d(t,"b",(function(){return z}));var n,s,i=a(19),o=a.n(i),r=a(95),l=a.n(r),c=a(88),d=a.n(c),m=a(102),u=a.n(m),h=a(140),p=a(146),g=a(413),f=a(93),v=a(581),b=a(97),y=a(100),E=a(103),_=a(245),S=a(222),C=a(99),w=a(632),O=a(119),x=a(280),R=a(596),k=a(247),I=a(167),T=a(267),P=a(166),N=a(94),D=a(293),j=a(304),A=a(269);const M={[h.a.RoomMessage]:"messages.MessageEvent",[h.a.Sticker]:"messages.MessageEvent",[h.a.KeyVerificationCancel]:"messages.MKeyVerificationConclusion",[h.a.KeyVerificationDone]:"messages.MKeyVerificationConclusion",[h.a.CallInvite]:"messages.TextualEvent",[h.a.CallAnswer]:"messages.TextualEvent",[h.a.CallHangup]:"messages.TextualEvent",[h.a.CallReject]:"messages.TextualEvent"},U={[h.a.RoomEncryption]:"messages.EncryptionEvent",[h.a.RoomCanonicalAlias]:"messages.TextualEvent",[h.a.RoomCreate]:"messages.RoomCreate",[h.a.RoomMember]:"messages.TextualEvent",[h.a.RoomName]:"messages.TextualEvent",[h.a.RoomAvatar]:"messages.RoomAvatarEvent",[h.a.RoomThirdPartyInvite]:"messages.TextualEvent",[h.a.RoomHistoryVisibility]:"messages.TextualEvent",[h.a.RoomTopic]:"messages.TextualEvent",[h.a.RoomPowerLevels]:"messages.TextualEvent",[h.a.RoomPinnedEvents]:"messages.TextualEvent",[h.a.RoomServerAcl]:"messages.TextualEvent","im.vector.modular.widgets":"messages.TextualEvent",[T.c]:"messages.TextualEvent",[h.a.RoomTombstone]:"messages.TextualEvent",[h.a.RoomJoinRules]:"messages.TextualEvent",[h.a.RoomGuestAccess]:"messages.TextualEvent","m.room.related_groups":"messages.TextualEvent"},L=new Set([h.a.RoomEncryption,h.a.RoomCanonicalAlias,h.a.RoomCreate,h.a.RoomName,h.a.RoomAvatar,h.a.RoomHistoryVisibility,h.a.RoomTopic,h.a.RoomPowerLevels,h.a.RoomPinnedEvents,h.a.RoomServerAcl,T.c,h.a.RoomTombstone,h.a.RoomJoinRules,h.a.RoomGuestAccess,"m.room.related_groups"]);for(const e of w.a)U[e]="messages.TextualEvent";function F(e){const t=e.getType();if("m.room.message"===t){const t=e.getContent();if(t&&"m.key.verification.request"===t.msgtype){const a=C.a.get(),n=a&&a.getUserId();return e.getSender()!==n&&t.to!==n?void 0:"messages.MKeyVerificationRequest"}}if("m.key.verification.done"===t){const t=C.a.get(),a=t&&t.getUserId();if(e.getSender()!==a)return}if("m.key.verification.cancel"===t||"m.key.verification.done"===t){if(!b.getComponent("messages.MKeyVerificationConclusion").prototype._shouldRender.call(null,e,e.request))return}if("im.vector.modular.widgets"===t){let t=e.getContent().type;if(t||(t=e.getPrevContent().type),k.a.JITSI.matches(t))return"messages.MJitsiWidgetEvent"}if(e.isState()){if(L.has(t)&&""!==e.getStateKey())return;return U[t]}return M[t]}let B=Object(N.a)("views.rooms.EventTile")((s=class extends d.a.Component{constructor(e,t){super(e,t),o()(this,"suppressReadReceiptAnimation",void 0),o()(this,"isListeningForReceipts",void 0),o()(this,"ref",void 0),o()(this,"tile",d.a.createRef()),o()(this,"replyThread",d.a.createRef()),o()(this,"onRoomReceipt",(e,t)=>{t===C.a.get().getRoom(this.props.mxEvent.getRoomId())&&(this.shouldShowSentReceipt||this.shouldShowSendingReceipt||this.isListeningForReceipts)&&this.forceUpdate(()=>{this.shouldShowSentReceipt||this.shouldShowSendingReceipt||(this.context.removeListener("Room.receipt",this.onRoomReceipt),this.isListeningForReceipts=!1)})}),o()(this,"onDecrypted",()=>{this.verifyEvent(this.props.mxEvent),this.forceUpdate()}),o()(this,"onDeviceVerificationChanged",(e,t)=>{e===this.props.mxEvent.getSender()&&this.verifyEvent(this.props.mxEvent)}),o()(this,"onUserVerificationChanged",(e,t)=>{e===this.props.mxEvent.getSender()&&this.verifyEvent(this.props.mxEvent)}),o()(this,"toggleAllReadAvatars",()=>{this.setState({allReadAvatars:!this.state.allReadAvatars})}),o()(this,"onSenderProfileClick",e=>{const t=this.props.mxEvent;y.a.dispatch({action:"insert_mention",user_id:t.getSender()})}),o()(this,"onRequestKeysClick",()=>{this.setState({previouslyRequestedKeys:!0}),this.context.cancelAndResendEventRoomKeyRequest(this.props.mxEvent)}),o()(this,"onPermalinkClicked",e=>{e.preventDefault(),y.a.dispatch({action:"view_room",event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId()})}),o()(this,"onActionBarFocusChange",e=>{this.setState({actionBarFocused:e})}),o()(this,"getTile",()=>this.tile.current),o()(this,"getReplyThread",()=>this.replyThread.current),o()(this,"getReactions",()=>{if(!this.props.showReactions||!this.props.getRelationsForEvent)return null;const e=this.props.mxEvent.getId();return this.props.getRelationsForEvent(e,"m.annotation","m.reaction")}),o()(this,"onReactionsCreated",(e,t)=>{"m.annotation"===e&&"m.reaction"===t&&(this.props.mxEvent.removeListener("Event.relationsCreated",this.onReactionsCreated),this.setState({reactions:this.getReactions()}))}),this.state={actionBarFocused:!1,allReadAvatars:!1,verified:null,previouslyRequestedKeys:!1,reactions:this.getReactions(),hover:!1},this.suppressReadReceiptAnimation=!0,this.isListeningForReceipts=!1,this.ref=d.a.createRef()}get isEligibleForSpecialReceipt(){if(this.props.readReceipts&&this.props.readReceipts.length>0)return!1;if(!this.props.mxEvent)return!1;if(!this.context.getRoom(this.props.mxEvent.getRoomId()))return!1;const e=C.a.get().getUserId();if(this.props.mxEvent.getSender()!==e)return!1;return!![h.a.Sticker,h.a.RoomMessage,h.a.RoomMessageEncrypted].includes(this.props.mxEvent.getType())}get shouldShowSentReceipt(){if(!this.isEligibleForSpecialReceipt)return!1;if(!this.props.lastSuccessful)return!1;if(this.props.eventSendStatus&&"sent"!==this.props.eventSendStatus)return!1;const e=this.props.readReceipts||[],t=C.a.get().getUserId();return!e.some(e=>e.userId!==t)}get shouldShowSendingReceipt(){return!!this.isEligibleForSpecialReceipt&&!(!this.props.eventSendStatus||"sent"===this.props.eventSendStatus)}UNSAFE_componentWillMount(){this.verifyEvent(this.props.mxEvent)}componentDidMount(){this.suppressReadReceiptAnimation=!1;const e=this.context;e.on("deviceVerificationChanged",this.onDeviceVerificationChanged),e.on("userTrustStatusChanged",this.onUserVerificationChanged),this.props.mxEvent.on("Event.decrypted",this.onDecrypted),this.props.showReactions&&this.props.mxEvent.on("Event.relationsCreated",this.onReactionsCreated),(this.shouldShowSentReceipt||this.shouldShowSendingReceipt)&&(e.on("Room.receipt",this.onRoomReceipt),this.isListeningForReceipts=!0)}UNSAFE_componentWillReceiveProps(e){e.eventSendStatus!==this.props.eventSendStatus&&this.verifyEvent(e.mxEvent)}shouldComponentUpdate(e,t){return!!Object(P.c)(this.state,t)||!this.propsEqual(this.props,e)}componentWillUnmount(){const e=this.context;e.removeListener("deviceVerificationChanged",this.onDeviceVerificationChanged),e.removeListener("userTrustStatusChanged",this.onUserVerificationChanged),e.removeListener("Room.receipt",this.onRoomReceipt),this.isListeningForReceipts=!1,this.props.mxEvent.removeListener("Event.decrypted",this.onDecrypted),this.props.showReactions&&this.props.mxEvent.removeListener("Event.relationsCreated",this.onReactionsCreated)}componentDidUpdate(e,t,a){this.isListeningForReceipts||!this.shouldShowSentReceipt&&!this.shouldShowSendingReceipt||(this.context.on("Room.receipt",this.onRoomReceipt),this.isListeningForReceipts=!0)}async verifyEvent(e){if(!e.isEncrypted())return;const t=this.context.getEventEncryptionInfo(e),a=e.getSender(),n=this.context.checkUserTrust(a);if(t.mismatchedSender)return void this.setState({verified:x.a.WARNING},this.props.onHeightChanged);if(!n.isCrossSigningVerified())return void this.setState({verified:x.a.NORMAL},this.props.onHeightChanged);const s=t.sender&&this.context.checkDeviceTrust(a,t.sender.deviceId);s?s.isVerified()?t.authenticated?this.setState({verified:x.a.VERIFIED},this.props.onHeightChanged):this.setState({verified:x.a.UNAUTHENTICATED},this.props.onHeightChanged):this.setState({verified:x.a.WARNING},this.props.onHeightChanged):this.setState({verified:x.a.UNKNOWN},this.props.onHeightChanged)}propsEqual(e,t){const a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(let n=0;n<a.length;n++){const s=a[n];if(!t.hasOwnProperty(s))return!1;if("readReceipts"===s){const a=e[s],n=t[s];if(a===n)continue;if(!a||!n)return!1;if(a.length!==n.length)return!1;for(let e=0;e<a.length;e++){if(a[e].userId!==n[e].userId)return!1;if(a[e].roomMember!==n[e].roomMember)return!1}}else if(e[s]!==t[s])return!1}return!0}shouldHighlight(){const e=this.context.getPushActionsForEvent(this.props.mxEvent.replacingEvent()||this.props.mxEvent);return!(!e||!e.tweaks)&&(this.props.mxEvent.getSender()!==this.context.credentials.userId&&e.tweaks.highlight)}getReadAvatars(){if(this.shouldShowSentReceipt||this.shouldShowSendingReceipt)return d.a.createElement(J,{messageState:this.props.mxEvent.getAssociatedStatus()});if(!this.props.readReceipts||0===this.props.readReceipts.length)return null;const e=b.getComponent("rooms.ReadReceiptMarker"),t=[];let a=0;const n=this.props.readReceipts||[];if(0===n.length)return null;for(let s=0;s<n.length;++s){const i=n[s];let o=!0;(s<5||this.state.allReadAvatars)&&(o=!1),a=-15*(o?4:s);const r=i.userId;let l;this.props.readReceiptMap&&(l=this.props.readReceiptMap[r],l||(l={},this.props.readReceiptMap[r]=l)),t.unshift(d.a.createElement(e,{key:r,member:i.roomMember,fallbackUserId:r,leftOffset:a,hidden:o,readReceiptInfo:l,checkUnmounting:this.props.checkUnmounting,suppressAnimation:this.suppressReadReceiptAnimation,onClick:this.toggleAllReadAvatars,timestamp:i.ts,showTwelveHour:this.props.isTwelveHour}))}let s;if(!this.state.allReadAvatars){const e=n.length-5;e>0&&(s=d.a.createElement("span",{className:"mx_EventTile_readAvatarRemainder",onClick:this.toggleAllReadAvatars,style:{right:"calc("+Object(R.b)(-a)+" + 15px)"}},e,"+"))}return d.a.createElement("div",{className:"mx_EventTile_msgOption"},d.a.createElement("span",{className:"mx_EventTile_readAvatars"},s,t))}renderE2EPadlock(){const e=this.props.mxEvent;if("m.bad.encrypted"===e.getContent().msgtype)return d.a.createElement(W,null);if(e.isEncrypted())return this.state.verified===x.a.NORMAL||this.state.verified===x.a.VERIFIED?void 0:this.state.verified===x.a.UNAUTHENTICATED?d.a.createElement(Y,null):this.state.verified===x.a.UNKNOWN?d.a.createElement(q,null):d.a.createElement(H,null);if(this.context.isRoomEncrypted(e.getRoomId())){if(e.status===p.a.ENCRYPTING)return;if(e.status===p.a.NOT_SENT)return;if(e.isState())return;return d.a.createElement(K,null)}return null}render(){const e=b.getComponent("messages.MessageTimestamp"),t=b.getComponent("messages.SenderProfile"),a=b.getComponent("avatars.MemberAvatar"),n=this.props.mxEvent.getContent().msgtype,s=this.props.mxEvent.getType();let i=F(this.props.mxEvent);const o=s.startsWith("m.key.verification")||s===h.a.RoomMessage&&n&&n.startsWith("m.key.verification")||s===h.a.RoomCreate||s===h.a.RoomEncryption||"messages.MJitsiWidgetEvent"===i;let r=!o&&s!==h.a.RoomMessage&&s!==h.a.Sticker&&s!==h.a.RoomCreate;if(E.b.getValue("showHiddenEventsInTimeline")&&!z(this.props.mxEvent)&&(i="messages.ViewSourceEvent",r=!0),!i){const{mxEvent:e}=this.props;return console.warn(`Event type not supported: type:${e.getType()} isState:${e.isState()}`),d.a.createElement("div",{className:"mx_EventTile mx_EventTile_info mx_MNoticeBody"},d.a.createElement("div",{className:"mx_EventTile_line"},Object(f.a)("This event could not be displayed")))}const l=b.getComponent(i),c=-1!==["sending","queued","encrypting"].indexOf(this.props.eventSendStatus),m=G(this.props.mxEvent)&&this.props.isRedacted,p=this.props.mxEvent.isDecryptionFailure(),v=!!this.props.editState,y=u()({mx_EventTile_bubbleContainer:o,mx_EventTile:!0,mx_EventTile_isEditing:v,mx_EventTile_info:r,mx_EventTile_12hr:this.props.isTwelveHour,mx_EventTile_sending:!v&&c,mx_EventTile_highlight:"notif"!==this.props.tileShape&&this.shouldHighlight(),mx_EventTile_selected:this.props.isSelectedEvent,mx_EventTile_continuation:this.props.tileShape?"":this.props.continuation,mx_EventTile_last:this.props.last,mx_EventTile_lastInSection:this.props.lastInSection,mx_EventTile_contextual:this.props.contextual,mx_EventTile_actionBarFocused:this.state.actionBarFocused,mx_EventTile_verified:!o&&this.state.verified===x.a.VERIFIED,mx_EventTile_unverified:!o&&this.state.verified===x.a.WARNING,mx_EventTile_unknown:!o&&this.state.verified===x.a.UNKNOWN,mx_EventTile_bad:p,mx_EventTile_emote:"m.emote"===n}),C=null!==this.props.eventSendStatus?"off":void 0;let w,O,R,k,T="#";if(this.props.permalinkCreator&&(T=this.props.permalinkCreator.forEvent(this.props.mxEvent.getId())),"notif"===this.props.tileShape?(R=24,k=!0):"messages.RoomCreate"===i||o?(R=0,k=!1):r?(R=14,k=!1):this.props.layout==_.a.IRC?(R=14,k=!0):this.props.continuation&&"file_grid"!==this.props.tileShape?(R=0,k=!1):(R=30,k=!0),this.props.mxEvent.sender&&R){let e;e=this.props.mxEvent.getContent().third_party_invite?this.props.mxEvent.target:this.props.mxEvent.sender,w=d.a.createElement("div",{className:"mx_EventTile_avatar"},d.a.createElement(a,{member:e,width:R,height:R,viewUserOnClick:!0}))}k&&(O=this.props.tileShape&&"reply"!==this.props.tileShape&&"reply_preview"!==this.props.tileShape?d.a.createElement(t,{mxEvent:this.props.mxEvent,enableFlair:this.props.enableFlair}):d.a.createElement(t,{onClick:this.onSenderProfileClick,mxEvent:this.props.mxEvent,enableFlair:this.props.enableFlair}));const P=b.getComponent("messages.MessageActionBar"),N=v?void 0:d.a.createElement(P,{mxEvent:this.props.mxEvent,reactions:this.state.reactions,permalinkCreator:this.props.permalinkCreator,getTile:this.getTile,getReplyThread:this.getReplyThread,onFocusChange:this.onActionBarFocusChange}),D=this.props.mxEvent.getTs()&&(this.props.alwaysShowTimestamps||this.state.hover)?d.a.createElement(e,{showTwelveHour:this.props.isTwelveHour,ts:this.props.mxEvent.getTs()}):null,j=d.a.createElement("div",{className:"mx_EventTile_keyRequestInfo_tooltip_contents"},d.a.createElement("p",null,this.state.previouslyRequestedKeys?Object(f.a)("Your key share request has been sent - please check your other sessions for key share requests."):Object(f.a)("Key share requests are sent to your other sessions automatically. If you rejected or dismissed the key share request on your other sessions, click here to request the keys for this session again.")),d.a.createElement("p",null,Object(f.a)("If your other sessions do not have the key for this message you will not be able to decrypt them."))),A=this.state.previouslyRequestedKeys?Object(f.a)("Key request sent."):Object(f.a)("<requestLink>Re-request encryption keys</requestLink> from your other sessions.",{},{requestLink:e=>d.a.createElement("a",{onClick:this.onRequestKeysClick},e)}),M=b.getComponent("elements.TooltipButton"),U=p&&!m?d.a.createElement("div",{className:"mx_EventTile_keyRequestInfo"},d.a.createElement("span",{className:"mx_EventTile_keyRequestInfo_text"},A),d.a.createElement(M,{helpText:j})):null;let L;if(!m){const e=b.getComponent("messages.ReactionsRow");L=d.a.createElement(e,{mxEvent:this.props.mxEvent,reactions:this.state.reactions})}const B=d.a.createElement("a",{href:T,onClick:this.onPermalinkClicked,"aria-label":Object(S.e)(new Date(this.props.mxEvent.getTs()),this.props.isTwelveHour)},D),V=this.props.layout==_.a.IRC,W=V?null:B,H=V?B:null,K=!V&&!o&&this.renderE2EPadlock(),q=V&&!o&&this.renderE2EPadlock();let Y;if(this.props.showReadReceipts){Y=this.getReadAvatars()}switch(this.props.tileShape){case"notif":{const e=this.context.getRoom(this.props.mxEvent.getRoomId());return d.a.createElement("div",{className:y,"aria-live":C,"aria-atomic":"true"},d.a.createElement("div",{className:"mx_EventTile_roomName"},d.a.createElement(I.a,{room:e,width:28,height:28}),d.a.createElement("a",{href:T,onClick:this.onPermalinkClicked},e?e.name:"")),d.a.createElement("div",{className:"mx_EventTile_senderDetails"},w,d.a.createElement("a",{href:T,onClick:this.onPermalinkClicked},O,D)),d.a.createElement("div",{className:"mx_EventTile_line"},d.a.createElement(l,{ref:this.tile,mxEvent:this.props.mxEvent,highlights:this.props.highlights,highlightLink:this.props.highlightLink,showUrlPreview:this.props.showUrlPreview,onHeightChanged:this.props.onHeightChanged})))}case"file_grid":return d.a.createElement("div",{className:y,"aria-live":C,"aria-atomic":"true"},d.a.createElement("div",{className:"mx_EventTile_line"},d.a.createElement(l,{ref:this.tile,mxEvent:this.props.mxEvent,highlights:this.props.highlights,highlightLink:this.props.highlightLink,showUrlPreview:this.props.showUrlPreview,tileShape:this.props.tileShape,onHeightChanged:this.props.onHeightChanged})),d.a.createElement("a",{className:"mx_EventTile_senderDetailsLink",href:T,onClick:this.onPermalinkClicked},d.a.createElement("div",{className:"mx_EventTile_senderDetails"},O,D)));case"reply":case"reply_preview":{let e;return"reply_preview"===this.props.tileShape&&(e=g.a.makeThread(this.props.mxEvent,this.props.onHeightChanged,this.props.permalinkCreator,this.replyThread)),d.a.createElement("div",{className:y,"aria-live":C,"aria-atomic":"true"},H,w,O,q,d.a.createElement("div",{className:"mx_EventTile_reply"},W,K,e,d.a.createElement(l,{ref:this.tile,mxEvent:this.props.mxEvent,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,replacingEventId:this.props.replacingEventId,showUrlPreview:!1})))}default:{const e=g.a.makeThread(this.props.mxEvent,this.props.onHeightChanged,this.props.permalinkCreator,this.replyThread,this.props.layout);return d.a.createElement(this.props.as||"div",{ref:this.ref,className:y,tabIndex:-1,"aria-live":C,"aria-atomic":"true","data-scroll-tokens":this.props["data-scroll-tokens"],onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1})},[H,O,q,d.a.createElement("div",{className:"mx_EventTile_line",key:"mx_EventTile_line"},W,K,e,d.a.createElement(l,{ref:this.tile,mxEvent:this.props.mxEvent,replacingEventId:this.props.replacingEventId,editState:this.props.editState,highlights:this.props.highlights,highlightLink:this.props.highlightLink,showUrlPreview:this.props.showUrlPreview,permalinkCreator:this.props.permalinkCreator,onHeightChanged:this.props.onHeightChanged}),U,L,N),Y,w])}}}},o()(s,"defaultProps",{onHeightChanged:function(){}}),o()(s,"contextType",O.a),n=s))||n;const V=["m.room.message","m.sticker"];function G(e){return V.includes(e.getType())}function z(e){if(e.isRedacted()&&!G(e))return!1;if(e.isRelation("m.replace"))return!1;const t=F(e);return void 0!==t&&("messages.TextualEvent"===t?""!==v.a(e):"messages.RoomCreate"!==t||Boolean(e.getContent().predecessor))}function W(e){return d.a.createElement($,l()({title:Object(f.a)("This message cannot be decrypted"),icon:"undecryptable"},e))}function H(e){return d.a.createElement($,l()({title:Object(f.a)("Encrypted by an unverified session"),icon:"unverified"},e))}function K(e){return d.a.createElement($,l()({title:Object(f.a)("Unencrypted"),icon:"unencrypted"},e))}function q(e){return d.a.createElement($,l()({title:Object(f.a)("Encrypted by a deleted session"),icon:"unknown"},e))}function Y(e){return d.a.createElement($,l()({title:Object(f.a)("The authenticity of this encrypted message can't be guaranteed on this device."),icon:"unauthenticated"},e))}class $ extends d.a.Component{constructor(e){super(e),o()(this,"onHoverStart",()=>{this.setState({hover:!0})}),o()(this,"onHoverEnd",()=>{this.setState({hover:!1})}),this.state={hover:!1}}render(){let e=null;this.state.hover&&(e=d.a.createElement(D.b,{className:"mx_EventTile_e2eIcon_tooltip",label:this.props.title}));const t="mx_EventTile_e2eIcon mx_EventTile_e2eIcon_"+this.props.icon;return d.a.createElement("div",{className:t,onMouseEnter:this.onHoverStart,onMouseLeave:this.onHoverEnd},e)}}class J extends d.a.PureComponent{constructor(e){super(e),o()(this,"onHoverStart",()=>{this.setState({hover:!0})}),o()(this,"onHoverEnd",()=>{this.setState({hover:!1})}),this.state={hover:!1}}render(){const e=!this.props.messageState||"sent"===this.props.messageState,t="not_sent"===this.props.messageState,a=u()({mx_EventTile_receiptSent:e,mx_EventTile_receiptSending:!e&&!t});let n=null;t&&(n=d.a.createElement(A.a,{notification:j.a.RED_EXCLAMATION}));let s=null;if(this.state.hover){let a=Object(f.a)("Sending your message...");"encrypting"===this.props.messageState?a=Object(f.a)("Encrypting your message..."):e?a=Object(f.a)("Your message was sent"):t&&(a=Object(f.a)("Failed to send")),s=d.a.createElement(D.b,{className:"mx_EventTile_readAvatars_receiptTooltip",label:a,yOffset:20})}return d.a.createElement("div",{className:"mx_EventTile_msgOption"},d.a.createElement("span",{className:"mx_EventTile_readAvatars"},d.a.createElement("span",{className:a,onMouseEnter:this.onHoverStart,onMouseLeave:this.onHoverEnd},n,s)))}}},298:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return o}));var n=a(99);function s(e){return e.getCanonicalAlias()||e.getAltAliases()[0]}function i(e,t){let a;if(t){a=function(e,t){let a,n;for(const s of e.getJoinedMembers())s.userId!=t&&(void 0===a||s.events.member&&s.events.member.getTs()<a)&&(n=s,a=s.events.member.getTs());if(n)return n.userId;for(const s of e.currentState.getMembers())s.userId!=t&&(void 0===a||s.events.member&&s.events.member.getTs()<a)&&(n=s,a=s.events.member.getTs());return void 0===n?t:n.userId}(e,n.a.get().getUserId())}else a=null;return o(e.roomId,a)}function o(e,t){if(n.a.get().isGuest())return Promise.resolve();const a=n.a.get().getAccountData("m.direct");let s={};void 0!==a&&(s=a.getContent());for(const a of Object.keys(s)){const n=s[a];if(a!=t){const t=n.indexOf(e);t>-1&&n.splice(t,1)}}if(t){const a=s[t]||[];-1==a.indexOf(e)&&a.push(e),s[t]=a}return n.a.get().setAccountData("m.direct",s)}},299:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(19),s=a.n(n),i=a(237),o=a(100),r=a(332),l=a(490),c=a(215),d=a(247),m=a(142),u=a(99);function h(e){var t;return`${null!==(t=e.roomId)&&void 0!==t?t:u.a.get().getUserId()}::${e.id}`}class p extends i.a{constructor(){var e;super(o.a,{}),e=this,s()(this,"widgetMap",new Map),s()(this,"roomMap",new Map),s()(this,"onWidgetEchoStoreUpdate",(e,t)=>{this.initRoom(e),this.loadRoomWidgets(this.matrixClient.getRoom(e)),this.emit(m.b,e)}),s()(this,"onRoom",e=>{this.initRoom(e.roomId),this.loadRoomWidgets(e),this.emit(m.b,e.roomId)}),s()(this,"onRoomStateEvents",e=>{if("im.vector.modular.widgets"!==e.getType())return;const t=e.getRoomId();this.initRoom(t),this.loadRoomWidgets(this.matrixClient.getRoom(t)),this.emit(m.b,t)}),s()(this,"getRoom",(function(t){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a&&e.initRoom(t),e.roomMap.get(t)})),r.a.on("update",this.onWidgetEchoStoreUpdate)}static get instance(){return p.internalInstance}initRoom(e){this.roomMap.has(e)||this.roomMap.set(e,{widgets:[]})}async onReady(){this.matrixClient.on("Room",this.onRoom),this.matrixClient.on("RoomState.events",this.onRoomStateEvents),this.matrixClient.getRooms().forEach(e=>{this.loadRoomWidgets(e)}),this.emit(m.b,null)}async onNotReady(){this.matrixClient.off("Room",this.onRoom),this.matrixClient.off("RoomState.events",this.onRoomStateEvents),this.widgetMap=new Map,this.roomMap=new Map,await this.reset({})}async onAction(e){}generateApps(e){return r.a.getEchoedRoomWidgets(e.roomId,c.a.getRoomWidgets(e)).map(e=>c.a.makeAppConfig(e.getStateKey(),e.getContent(),e.getSender(),e.getRoomId(),e.getId()))}loadRoomWidgets(e){if(!e)return;const t=this.roomMap.get(e.roomId)||{};t.widgets=[],Array.from(this.widgetMap.values()).forEach(t=>{t.roomId===e.roomId&&this.widgetMap.delete(h(t))});let a=!1;this.generateApps(e).forEach(e=>{const n=this.widgetMap.get(h(e));n&&console.warn(`Possible widget ID conflict for ${e.id} - wants to store in room ${e.roomId} but is currently stored as ${n.roomId} - letting the want win`),this.widgetMap.set(h(e),e),t.widgets.push(e),a=!0}),a&&!this.roomMap.has(e.roomId)&&this.roomMap.set(e.roomId,t),this.emit(e.roomId)}getApps(e){const t=this.getRoom(e);return(null==t?void 0:t.widgets)||[]}doesRoomHaveConference(e){const t=this.getRoom(e.roomId);if(!t)return!1;const a=t.widgets.filter(e=>d.a.JITSI.matches(e.type)),n=r.a.roomHasPendingWidgetsOfType(e.roomId,[],d.a.JITSI);return a.length>0||n}isJoinedToConferenceIn(e){const t=this.getRoom(e.roomId);if(!t)return!1;return t.widgets.filter(e=>d.a.JITSI.matches(e.type)).some(e=>l.a.getWidgetPersistence(e.id))}}s()(p,"internalInstance",new p),window.mxWidgetStore=p.instance},301:function(e,t,a){"use strict";a.r(t),function(e){a.d(t,"Notifier",(function(){return _}));var n=a(99),s=a(110),i=a(156),o=a(581),r=a(181),l=a(368),c=a(100),d=a(97),m=a(93),u=a(106),h=a(103),p=a(421),g=a(123),f=a(1329),v=a(165),b=a(796),y=a(126);const E={"m.key.verification.request":e=>{const t=(e.sender||{}).name;return Object(m.a)("%(name)s is requesting verification",{name:t})}},_={notifsByRoom:{},pendingEncryptedEventIds:[],notificationMessageForEvent:function(e){return E.hasOwnProperty(e.getContent().msgtype)?E[e.getContent().msgtype](e):o.a(e)},_displayPopupNotification:function(t,a){const n=i.a.get();if(!n)return;if(!n.supportsNotifications()||!n.maySendNotifications())return;if(e.document.hasFocus())return;let s,o=this.notificationMessageForEvent(t);if(!o)return;t.sender&&a.name!==t.sender.name?"m.room.member"===t.getType()?s=a.name:t.sender&&(s=t.sender.name+" ("+a.name+")",t.getContent().body&&!E.hasOwnProperty(t.getContent().msgtype)&&(o=t.getContent().body)):(s=a.name,t.getContent().body&&!E.hasOwnProperty(t.getContent().msgtype)&&(o=t.getContent().body)),this.isBodyEnabled()||(o="");let r=null;t.sender&&!h.b.getValue("lowBandwidth")&&(r=l.a(t.sender,40,40,"crop"));const c=n.displayNotification(s,o,r,a);c&&(void 0===this.notifsByRoom[t.getRoomId()]&&(this.notifsByRoom[t.getRoomId()]=[]),this.notifsByRoom[t.getRoomId()].push(c))},getSoundForRoom:function(e){const t=h.b.getValue("notificationSound",e);return t?t.url?t.url.startsWith("mxc://")?{url:Object(y.b)(t.url).srcHttp,name:t.name,type:t.type,size:t.size}:(console.warn(e+" has custom notification sound event, but url is not a mxc url"),null):(console.warn(e+" has custom notification sound event, but no url key"),null):null},_playAudioNotification:async function(e,t){const a=this.getSoundForRoom(t.roomId);console.log(`Got sound ${a&&a.name||"default"} for ${t.roomId}`);try{const e=document.querySelector(a?`audio[src='${a.url}']`:"#messageAudio");let t=e;if(!e){if(!a)return void console.error("No audio element or sound to play for notification");t=new Audio(a.url),a.type&&(t.type=a.type),document.body.appendChild(t)}await t.play()}catch(e){console.warn("Caught error when trying to fetch room notification sound:",e)}},start:function(){this.boundOnEvent=this.boundOnEvent||this.onEvent.bind(this),this.boundOnSyncStateChange=this.boundOnSyncStateChange||this.onSyncStateChange.bind(this),this.boundOnRoomReceipt=this.boundOnRoomReceipt||this.onRoomReceipt.bind(this),this.boundOnEventDecrypted=this.boundOnEventDecrypted||this.onEventDecrypted.bind(this),n.a.get().on("event",this.boundOnEvent),n.a.get().on("Room.receipt",this.boundOnRoomReceipt),n.a.get().on("Event.decrypted",this.boundOnEventDecrypted),n.a.get().on("sync",this.boundOnSyncStateChange),this.toolbarHidden=!1,this.isSyncing=!1},stop:function(){n.a.get()&&(n.a.get().removeListener("Event",this.boundOnEvent),n.a.get().removeListener("Room.receipt",this.boundOnRoomReceipt),n.a.get().removeListener("Event.decrypted",this.boundOnEventDecrypted),n.a.get().removeListener("sync",this.boundOnSyncStateChange)),this.isSyncing=!1},supportsDesktopNotifications:function(){const e=i.a.get();return e&&e.supportsNotifications()},setEnabled:function(e,t){const a=i.a.get();a&&(r.a.trackEvent("Notifier","Set Enabled",String(e)),h.b.isLevelSupported(g.a.DEVICE)&&h.b.setValue("audioNotificationsEnabled",null,g.a.DEVICE,this.isEnabled()),e?a.requestNotificationPermission().then(e=>{if("granted"===e)t&&t(),c.a.dispatch({action:"notifier_enabled",value:!0});else{const t=s.a.get().brand,a="denied"===e?Object(m.a)("%(brand)s does not have permission to send you notifications - please check your browser settings",{brand:t}):Object(m.a)("%(brand)s was not given permission to send notifications - please try again",{brand:t}),n=d.getComponent("dialogs.ErrorDialog");u.a.createTrackedDialog("Unable to enable Notifications",e,n,{title:Object(m.a)("Unable to enable Notifications"),description:a})}}):c.a.dispatch({action:"notifier_enabled",value:!1}),this.setPromptHidden(!0))},isEnabled:function(){return this.isPossible()&&h.b.getValue("notificationsEnabled")},isPossible:function(){const e=i.a.get();return!!e&&(!!e.supportsNotifications()&&!!e.maySendNotifications())},isBodyEnabled:function(){return this.isEnabled()&&h.b.getValue("notificationBodyEnabled")},isAudioEnabled:function(){return h.b.getValue("audioNotificationsEnabled")},setPromptHidden:function(t){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.toolbarHidden=t,r.a.trackEvent("Notifier","Set Toolbar Hidden",String(t)),Object(p.a)(),a&&e.localStorage&&e.localStorage.setItem("notifications_hidden",String(t))},shouldShowPrompt:function(){const e=n.a.get();if(!e)return!1;return!e.isGuest()&&this.supportsDesktopNotifications()&&!Object(f.c)()&&!this.isEnabled()&&!this._isPromptHidden()},_isPromptHidden:function(){return e.localStorage?"true"===e.localStorage.getItem("notifications_hidden"):this.toolbarHidden},onSyncStateChange:function(e){"SYNCING"===e?this.isSyncing=!0:"STOPPED"!==e&&"ERROR"!==e||(this.isSyncing=!1)},onEvent:function(e){if(this.isSyncing&&(!e.sender||e.sender.userId!==n.a.get().credentials.userId))if(n.a.get().decryptEventIfNeeded(e),e.isBeingDecrypted()||e.isDecryptionFailure())for(this.pendingEncryptedEventIds.push(e.getId());this.pendingEncryptedEventIds.length>20;)this.pendingEncryptedEventIds.shift();else this._evaluateEvent(e)},onEventDecrypted:function(e){if(e.isDecryptionFailure())return;const t=this.pendingEncryptedEventIds.indexOf(e.getId());-1!==t&&(this.pendingEncryptedEventIds.splice(t,1),this._evaluateEvent(e))},onRoomReceipt:function(e,t){if(0===t.getUnreadNotificationCount()){const e=i.a.get();if(!e)return;if(void 0===this.notifsByRoom[t.roomId])return;for(const a of this.notifsByRoom[t.roomId])e.clearNotification(a);delete this.notifsByRoom[t.roomId]}},_evaluateEvent:function(e){const t=n.a.get().getRoom(e.getRoomId()),a=n.a.get().getPushActionsForEvent(e);if(a&&a.notify){if(v.a.getRoomId()===t.roomId&&b.a.sharedInstance().userActiveRecently())return;if(h.b.getValue("doNotDisturb"))return;this.isEnabled()&&this._displayPopupNotification(e,t),a.tweaks.sound&&this.isAudioEnabled()&&(i.a.get().loudNotification(e,t),this._playAudioNotification(e,t))}}};window.mxNotifier||(window.mxNotifier=_),t.default=window.mxNotifier}.call(this,a(7))},302:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(150);function s(e,t){const a=Object(n.throttle)(e,t,{leading:!0,trailing:!0}),s=a.bind;return a.bind=function(){const e=s.apply(a,arguments);return e.cancelPendingCall=a.cancelPendingCall,e},a.cancelPendingCall=function(){a.cancel()},a}},303:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(94);let h=Object(u.a)("views.elements.DialogButtons")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"_onCancelClick",()=>{this.props.onCancel()})}render(){let e,t="mx_Dialog_primary";this.props.primaryButtonClass&&(t+=" "+this.props.primaryButtonClass),(this.props.cancelButton||this.props.hasCancel)&&(e=l.a.createElement("button",{type:"button",onClick:this._onCancelClick,className:this.props.cancelButtonClass,disabled:this.props.disabled},this.props.cancelButton||Object(m.a)("Cancel")));let a=null;return this.props.additive&&(a=l.a.createElement("div",{className:"mx_Dialog_buttons_additive"},this.props.additive)),l.a.createElement("div",{className:"mx_Dialog_buttons"},a,e,this.props.children,l.a.createElement("button",{type:this.props.primaryIsSubmit?"submit":"button",className:t,onClick:this.props.onPrimaryButtonClick,autoFocus:this.props.focus,disabled:this.props.disabled||this.props.primaryDisabled},this.props.primaryButton))}},o()(s,"propTypes",{primaryButton:d.a.node.isRequired,cancelButton:d.a.node,primaryIsSubmit:d.a.bool,onPrimaryButtonClick:d.a.func,hasCancel:d.a.bool,cancelButtonClass:d.a.node,onCancel:d.a.func,focus:d.a.bool,disabled:d.a.bool,primaryDisabled:d.a.bool,additive:d.a.element}),o()(s,"defaultProps",{hasCancel:!0,disabled:!1}),n=s))||n},304:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(333),o=a(367);class r extends o.b{constructor(e,t,a){super(),this._symbol=e,this._count=t,this._color=a}static forCount(e,t){return new r(null,e,t)}static forSymbol(e,t){return new r(e,0,t)}}s()(r,"RED_EXCLAMATION",r.forSymbol("!",i.a.Red))},324:function(e,t,a){"use strict";let n,s;a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return s})),function(e){e.Manual="MANUAL",e.Alphabetic="ALPHABETIC",e.Recent="RECENT"}(n||(n={})),function(e){e.Importance="IMPORTANCE",e.Natural="NATURAL"}(s||(s={}))},328:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const n=new RegExp("^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$","i");function s(e){return n.test(e)}},329:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n=Object.freeze({IS:"SERVICE_TYPE_IS",IM:"SERVICE_TYPE_IM"})},330:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(329),s=a(225),i=a(99),o=a(106),r=a(97),l=a(93),c=a(489),d=a(483),m=a(416);class u extends Error{}class h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.accessToken=null,this.authEnabled=!0,this.tempClient=e?Object(s.createClient)({baseUrl:"",idBaseUrl:e}):null}get _matrixClient(){return this.tempClient?this.tempClient:i.a.get()}_writeToken(){this.tempClient||window.localStorage.setItem("mx_is_access_token",this.accessToken)}_readToken(){return this.tempClient?null:window.localStorage.getItem("mx_is_access_token")}hasCredentials(){return null!=this.accessToken}async getAccessToken(){let{check:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.authEnabled)return null;let t=this.accessToken;if(t||(t=this._readToken()),!t)return t=await this.registerForToken(e),t&&(this.accessToken=t,this._writeToken()),t;if(e)try{await this._checkToken(t)}catch(e){if(e instanceof c.b||e instanceof u)throw e;t=await this.registerForToken(),t&&(this.accessToken=t,this._writeToken())}return t}async _checkToken(e){const t=this._matrixClient.getIdentityServerUrl();try{await this._matrixClient.getIdentityAccount(e)}catch(a){if("M_TERMS_NOT_SIGNED"===a.errcode)return console.log("Identity Server requires new terms to be agreed to"),void await Object(c.d)([new c.a(n.a.IS,t,e)]);throw a}if(!this.tempClient&&!Object(d.a)()&&!await Object(d.b)(t)){const e=r.getComponent("dialogs.QuestionDialog"),{finished:a}=o.a.createTrackedDialog("Default identity server terms warning","",e,{title:Object(l.a)("Identity server has no terms of service"),description:React.createElement("div",null,React.createElement("p",null,Object(l.a)("This action requires accessing the default identity server <server /> to validate an email address or phone number, but the server does not have any terms of service.",{},{server:()=>React.createElement("b",null,Object(m.a)(t))})),React.createElement("p",null,Object(l.a)("Only continue if you trust the owner of the server."))),button:Object(l.a)("Trust")}),[n]=await a;if(!n)throw new u("User aborted identity server action without terms");Object(d.d)()}}async registerForToken(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=await i.a.get().getOpenIdToken(),{access_token:a,token:n}=await this._matrixClient.registerWithIdentityServer(t),s=n||a;return e&&await this._checkToken(s),s}}},331:function(e,t,a){"use strict";function n(e,t){const a=`Store is invalid because ${e}, please stop the client, delete all data and start the client again`,n=Reflect.construct(Error,[a]);return Reflect.setPrototypeOf(n,Reflect.getPrototypeOf(this)),n.reason=e,n.value=t,n}function s(e){const t=`Crypto store is invalid because ${e}, please stop the client, delete all data and start the client again`,a=Reflect.construct(Error,[t]);return Reflect.setPrototypeOf(a,Reflect.getPrototypeOf(this)),a.reason=e,a.name="InvalidCryptoStoreError",a}a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return i})),n.TOGGLED_LAZY_LOADING="TOGGLED_LAZY_LOADING",n.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(n,Error),s.TOO_NEW="TOO_NEW",s.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(s,Error);class i extends Error{constructor(e,t){super(e),this.value=t}}},332:function(e,t,a){"use strict";var n=a(19),s=a.n(n),i=a(8),o=a.n(i);class r extends o.a{constructor(){super(),s()(this,"roomWidgetEcho",void 0),this.roomWidgetEcho={}}getEchoedRoomWidgets(e,t){const a=[],n=Object.assign({},this.roomWidgetEcho[e]);for(const e of t){const t=e.getStateKey();n[t]&&0===Object.keys(n[t]).length||a.push(e),delete n[t]}return a}roomHasPendingWidgetsOfType(e,t,a){const n=Object.assign({},this.roomWidgetEcho[e]);for(const e of t){delete n[e.getStateKey()]}return void 0===a?Object.keys(n).length>0:Object.values(n).some(e=>a.matches(e.type))}roomHasPendingWidgets(e,t){return this.roomHasPendingWidgetsOfType(e,t)}setRoomWidgetEcho(e,t,a){void 0===this.roomWidgetEcho[e]&&(this.roomWidgetEcho[e]={}),this.roomWidgetEcho[e][t]=a,this.emit("update",e,t)}removeRoomWidgetEcho(e,t){delete this.roomWidgetEcho[e][t],0===Object.keys(this.roomWidgetEcho[e]).length&&delete this.roomWidgetEcho[e],this.emit("update",e,t)}}let l=null;l||(l=new r),t.a=l},333:function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),function(e){e[e.None=0]="None",e[e.Bold=1]="Bold",e[e.Grey=2]="Grey",e[e.Red=3]="Red"}(n||(n={}))},334:function(e,t,a){"use strict";a.d(t,"b",(function(){return f})),a.d(t,"a",(function(){return v})),a.d(t,"f",(function(){return b})),a.d(t,"c",(function(){return y})),a.d(t,"d",(function(){return E})),a.d(t,"e",(function(){return _}));var n=a(88),s=a.n(n),i=a(140),o=a(155),r=a(106),l=a(1327),c=a(840),d=a(1421),m=a(214),u=a(93),h=a(837),p=a(377),g=a(205);const f=(e,t)=>{const a=e.getUserId();return"join"===t.getMyMembership()&&(t.currentState.maySendStateEvent(i.a.RoomAvatar,a)||t.currentState.maySendStateEvent(i.a.RoomName,a)||t.currentState.maySendStateEvent(i.a.RoomTopic,a)||t.currentState.maySendStateEvent(i.a.RoomJoinRules,a))},v=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:i.a.SpaceParent,content:{via:Object(o.b)(e),canonical:t},state_key:e.roomId}},b=(e,t)=>{r.a.createTrackedDialog("Space Settings","",l.a,{matrixClient:e,space:t},null,!1,!0)},y=async(e,t)=>r.a.createTrackedDialog("Space Landing","Add Existing",c.b,{matrixClient:e,onCreateRoomClick:E,space:t},"mx_AddExistingToSpaceDialog_wrapper").finished,E=async(e,t)=>{const a=r.a.createTrackedDialog("Space Landing","Create Room",d.a,{defaultPublic:"public"===t.getJoinRule(),parentSpace:t}),[n,s]=await a.finished;return n&&await Object(m.d)(s),n},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("public"===e.getJoinRule()){const t=r.a.createTrackedDialog("Space Invite","User Menu",p.a,{title:Object(u.a)("Invite to %(spaceName)s",{spaceName:e.name}),description:s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,Object(u.a)("Share your public space")),s.a.createElement(h.a,{space:e,onFinished:()=>t.close()})),fixedWidth:!1,button:!1,className:"mx_SpacePanel_sharePublicSpace",hasCloseButton:!0})}else Object(g.g)(e.roomId,t)}},335:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return m})),a.d(t,"d",(function(){return u}));var n=a(93),s=a(369),i=a(103),o=a(494);const r="light";function l(){const e={light:Object(n.a)("Light"),dark:Object(n.a)("Dark")},t=i.b.getValue("custom_themes"),a={};for(const{name:e}of t)a["custom-"+e]=e;return Object.assign({},a,e)}const c=["font-display","font-family","font-stretch","font-style","font-weight","font-variant","font-feature-settings","font-variation-settings","src","unicode-range"];function d(e){const{style:t}=document.body;function a(e,a){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.setProperty("--"+e,a),n&&(t.setProperty(`--${e}-0pct`,a+"00"),t.setProperty(`--${e}-15pct`,a+"26"),t.setProperty(`--${e}-50pct`,a+"7F"))}if(e.colors)for(const[t,n]of Object.entries(e.colors))if(Array.isArray(n))for(let e=0;e<n.length;e+=1)a(`${t}_${e}`,n[e],!1);else a(t,n);if(e.fonts){const{fonts:a}=e;if(a.faces){const e=a.faces.map(e=>{const t=e.src&&e.src.map(e=>{let t;return e.format&&(t=`format("${e.format}")`),e.url?`url("${e.url}") ${t}`:e.local?`local("${e.local}") ${t}`:""}).join(", ");return`@font-face {${Object.keys(e).filter(e=>c.includes(e)).map(a=>{let n;return n="src"===a?t:"font-family"===a?`"${e[a]}"`:e[a],`${a}: ${n}`}).join(";")}}`}).join("\n"),t=document.createElement("style");t.setAttribute("title","custom-theme-font-faces"),t.setAttribute("type","text/css"),t.appendChild(document.createTextNode(e)),document.head.appendChild(t)}a.general&&t.setProperty("--font-family",a.general),a.monospace&&t.setProperty("--font-family-monospace",a.monospace)}}function m(e){const t=i.b.getValue("custom_themes");if(!t)throw new Error(`No custom themes set, can't set custom theme "${e}"`);const a=t.find(t=>t.name===e);if(!a){const a=t.map(e=>e.name).join(", ");throw new Error(`Can't find custom theme "${e}", only know ${a}`)}return a}async function u(t){if(!t){const e=new o.a;t=e.getEffectiveTheme()}!function(){const e=Object.values(document.body.style);for(const t of e)t.startsWith("--")&&document.body.style.removeProperty(t);const t=document.querySelector("head > style[title='custom-theme-font-faces']");t&&t.remove()}();let a=t;if(t.startsWith("custom-")){const e=m(t.substr(7));a=e.is_dark?"dark-custom":"light-custom",d(e)}const n=Object.create(null);let i;for(let e=0;i=document.getElementsByTagName("link")[e];e++){const e=i.getAttribute("href"),t=e&&e.match(/^bundles\/.*\/theme-(.*)\.css$/);t&&(n[t[1]]=i)}if(!(a in n))throw new Error("Unknown theme "+a);return n[a].disabled=!1,new Promise(i=>{const o=function(){n[a].disabled=!1,Object.values(n).forEach(e=>{e!=n[a]&&(e.disabled=!0)});const o=e.getComputedStyle(document.body);o.backgroundColor&&(document.querySelector('meta[name="theme-color"]').content=o.backgroundColor),s.a.setTheme(t),i()};let r=!1;n[a].onload=()=>{o()};for(let e=0;e<document.styleSheets.length;e++){const t=document.styleSheets[e];if(t&&t.href===n[a].href){r=!0;break}}r&&(n[a].onload=void 0,o())})}}).call(this,a(7))},336:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(88),s=a.n(n),i=a(102),o=a.n(i),r=a(138),l=a(93),c=a(108),d=a(100),m=a(115);const u=e=>{let{className:t,title:a,children:n}=e;return s.a.createElement("div",{className:o()("mx_BaseCard_Group",t)},s.a.createElement("h1",null,a),n)};t.b=e=>{let t,a,{closeLabel:n,onClose:i,className:u,header:h,footer:p,withoutScrollContainer:g,previousPhase:f,children:v,refireParams:b}=e;if(f){const e=()=>{d.a.dispatch({action:m.a.SetRightPanelPhase,phase:f,refireParams:b})};t=s.a.createElement(c.a,{className:"mx_BaseCard_back",onClick:e,title:Object(l.a)("Back")})}return i&&(a=s.a.createElement(c.a,{className:"mx_BaseCard_close",onClick:i,title:n||Object(l.a)("Close")})),g||(v=s.a.createElement(r.a,null,v)),s.a.createElement("div",{className:o()("mx_BaseCard",u)},s.a.createElement("div",{className:"mx_BaseCard_header"},t,a,h),v,p&&s.a.createElement("div",{className:"mx_BaseCard_footer"},p))}},337:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(19),s=a.n(n),i=a(100),o=a(1342),r=a(569),l=a(103),c=a(183),d=a(115),m=a(123);function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}const h={showRoomPanel:l.b.getValue("showRightPanelInRoom"),showGroupPanel:l.b.getValue("showRightPanelInGroup"),lastRoomPhase:l.b.getValue("lastRightPanelPhaseForRoom"),lastGroupPhase:l.b.getValue("lastRightPanelPhaseForGroup"),lastRoomPhaseParams:{}},p=[c.c.GroupMemberList,c.c.GroupRoomList,c.c.GroupRoomInfo,c.c.GroupMemberInfo],g=[c.c.RoomMemberInfo,c.c.Room3pidMemberInfo,c.c.EncryptionPanel];class f extends r.Store{constructor(){super(i.a),s()(this,"state",void 0),this.state=h}get isOpenForRoom(){return this.state.showRoomPanel}get isOpenForGroup(){return this.state.showGroupPanel}get roomPanelPhase(){return this.state.lastRoomPhase}get groupPanelPhase(){return this.state.lastGroupPhase}get previousPhase(){return c.a.includes(this.state.previousPhase)?this.state.previousPhase:null}get visibleRoomPanelPhase(){return this.isOpenForRoom?this.roomPanelPhase:null}get visibleGroupPanelPhase(){return this.isOpenForGroup?this.groupPanelPhase:null}get roomPanelPhaseParams(){return this.state.lastRoomPhaseParams||{}}setState(e){this.state=Object.assign(this.state,e),l.b.setValue("showRightPanelInRoom",null,m.a.DEVICE,this.state.showRoomPanel),l.b.setValue("showRightPanelInGroup",null,m.a.DEVICE,this.state.showGroupPanel),c.a.includes(this.state.lastRoomPhase)&&l.b.setValue("lastRightPanelPhaseForRoom",null,m.a.DEVICE,this.state.lastRoomPhase),c.a.includes(this.state.lastGroupPhase)&&l.b.setValue("lastRightPanelPhaseForGroup",null,m.a.DEVICE,this.state.lastGroupPhase),this.__emitChange()}__onDispatch(e){switch(e.action){case"view_room":case"view_group":g.includes(this.state.lastRoomPhase)&&this.setState({lastRoomPhase:c.c.RoomMemberList,lastRoomPhaseParams:{}}),this.state.lastGroupPhase===c.c.GroupMemberInfo&&this.setState({lastGroupPhase:c.c.GroupMemberList});break;case d.a.SetRightPanelPhase:{let t=e.phase,a=e.refireParams;if(t===c.c.RoomMemberInfo&&e.refireParams){const{member:n}=e.refireParams,s=Object(o.b)(n);s&&(t=c.c.EncryptionPanel,a={verificationRequest:s,member:n})}if(!c.c[t])return void console.warn("Tried to switch right panel to unknown phase: "+t);p.includes(t)?t===this.state.lastGroupPhase?this.setState({showGroupPanel:!this.state.showGroupPanel,previousPhase:null}):this.setState({lastGroupPhase:t,showGroupPanel:!0,previousPhase:this.state.lastGroupPhase}):t!==this.state.lastRoomPhase||a?this.setState({lastRoomPhase:t,showRoomPanel:!0,lastRoomPhaseParams:a||{},previousPhase:this.state.lastRoomPhase}):this.setState({showRoomPanel:!this.state.showRoomPanel,previousPhase:null}),i.a.dispatch(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({action:d.a.AfterRightPanelPhaseChange,phase:t},a||{}));break}case d.a.ToggleRightPanel:"room"===e.type?this.setState({showRoomPanel:!this.state.showRoomPanel}):this.setState({showGroupPanel:!this.state.showGroupPanel})}}static getSharedInstance(){return f.instance||(f.instance=new f),f.instance}}s()(f,"instance",void 0),window.mxRightPanelStore=f.getSharedInstance()},338:function(e,t,a){"use strict";t.a={SHOW_ENCRYPTION_SETUP_UI:!1}},339:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(19),l=a.n(r),c=a(88),d=a.n(c),m=a(92),u=a.n(m),h=a(97),p=a(94);const g=["class","children","tooltip","tooltipClass","tooltipProps"];var f,v;let b=Object(p.a)("views.elements.TextWithTooltip")((v=class extends d.a.Component{constructor(){super(),l()(this,"onMouseOver",()=>{this.setState({hover:!0})}),l()(this,"onMouseLeave",()=>{this.setState({hover:!1})}),this.state={hover:!1}}render(){const e=h.getComponent("elements.Tooltip"),t=this.props,{class:a,children:n,tooltip:i,tooltipClass:r,tooltipProps:l}=t,c=o()(t,g);return d.a.createElement("span",s()({},c,{onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave,className:a}),n,this.state.hover&&d.a.createElement(e,s()({},l,{label:i,tooltipClassName:r,className:"mx_TextWithTooltip_tooltip"})))}},l()(v,"propTypes",{class:u.a.string,tooltipClass:u.a.string,tooltip:u.a.node.isRequired,tooltipProps:u.a.object}),f=v))||f},340:function(e,t,a){"use strict";var n=a(88),s=a(245);const i=Object(n.createContext)({roomLoading:!0,peekLoading:!1,shouldPeek:!0,membersLoaded:!1,numUnreadMessages:0,draggingFile:!1,searching:!1,guestsCanJoin:!1,canPeek:!1,showApps:!1,isPeeking:!1,showReadReceipts:!0,showRightPanel:!0,joining:!1,atEndOfLiveTimeline:!0,atEndOfLiveTimelineInit:!1,showTopUnreadMessagesBar:!1,statusBarVisible:!1,canReact:!1,canReply:!1,layout:s.a.Group,matrixClientIsReady:!1,dragCounter:0});i.displayName="RoomContext",t.a=i},341:function(e,t,a){"use strict";a.d(t,"b",(function(){return k})),a.d(t,"c",(function(){return I})),a.d(t,"a",(function(){return T})),a.d(t,"d",(function(){return P}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(814),u=a(93),h=a(1367),p=a(103),g=a(1390),f=a(1397),v=a(1401),b=a(1404),y=a(1405),E=a(1406),_=a(1407),S=a(1409),C=a(97),w=a(110),O=a(1411),x=a(147),R=a(94);const k="USER_NOTIFICATIONS_TAB",I="USER_SECURITY_TAB",T="USER_LABS_TAB";let P=Object(R.a)("views.dialogs.UserSettingsDialog")((s=class extends l.a.Component{constructor(){super(),this.state={mjolnirEnabled:p.b.getValue("feature_mjolnir")}}componentDidMount(){this._mjolnirWatcher=p.b.watchSetting("feature_mjolnir",null,this._mjolnirChanged.bind(this))}componentWillUnmount(){p.b.unwatchSetting(this._mjolnirWatcher)}_mjolnirChanged(e,t,a,n){this.setState({mjolnirEnabled:n})}_getTabs(){const e=[];return e.push(new m.a("USER_GENERAL_TAB",Object(u.b)("General"),"mx_UserSettingsDialog_settingsIcon",l.a.createElement(h.a,{closeSettingsFn:this.props.onFinished}))),e.push(new m.a("USER_APPEARANCE_TAB",Object(u.b)("Appearance"),"mx_UserSettingsDialog_appearanceIcon",l.a.createElement(f.a,null))),p.b.getValue(x.a.Flair)&&e.push(new m.a("USER_FLAIR_TAB",Object(u.b)("Flair"),"mx_UserSettingsDialog_flairIcon",l.a.createElement(S.a,null))),e.push(new m.a(k,Object(u.b)("Notifications"),"mx_UserSettingsDialog_bellIcon",l.a.createElement(b.a,null))),e.push(new m.a("USER_PREFERENCES_TAB",Object(u.b)("Preferences"),"mx_UserSettingsDialog_preferencesIcon",l.a.createElement(y.a,null))),p.b.getValue(x.a.Voip)&&e.push(new m.a("USER_VOICE_TAB",Object(u.b)("Voice & Video"),"mx_UserSettingsDialog_voiceIcon",l.a.createElement(E.a,null))),e.push(new m.a(I,Object(u.b)("Security & Privacy"),"mx_UserSettingsDialog_securityIcon",l.a.createElement(v.a,{closeSettingsFn:this.props.onFinished}))),(w.a.get().showLabsSettings||p.b.getFeatureSettingNames().some(e=>p.b.getBetaInfo(e)))&&e.push(new m.a(T,Object(u.b)("Labs"),"mx_UserSettingsDialog_labsIcon",l.a.createElement(g.a,null))),this.state.mjolnirEnabled&&e.push(new m.a("USER_MJOLNIR_TAB",Object(u.b)("Ignored users"),"mx_UserSettingsDialog_mjolnirIcon",l.a.createElement(O.a,null))),e.push(new m.a("USER_HELP_TAB",Object(u.b)("Help & About"),"mx_UserSettingsDialog_helpIcon",l.a.createElement(_.a,{closeSettingsFn:this.props.onFinished}))),e}render(){const e=C.getComponent("views.dialogs.BaseDialog");return l.a.createElement(e,{className:"mx_UserSettingsDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(u.a)("Settings")},l.a.createElement("div",{className:"mx_SettingsDialog_content"},l.a.createElement(m.b,{tabs:this._getTabs(),initialTabId:this.props.initialTabId})))}},o()(s,"propTypes",{onFinished:d.a.func.isRequired,initialTabId:d.a.string}),n=s))||n},342:function(e,t,a){"use strict";a.d(t,"a",(function(){return T})),a.d(t,"b",(function(){return P})),a.d(t,"c",(function(){return M})),a.d(t,"d",(function(){return L}));var n,s,i,o,r,l,c,d,m,u,h,p,g,f,v=a(19),b=a.n(v),y=a(88),E=a.n(y),_=a(102),S=a.n(_),C=a(97),w=a(93),O=a(103),x=a(108),R=a(168),k=a(154),I=a(94);!function(e){e.Password="m.login.password",e.Recaptcha="m.login.recaptcha",e.Terms="m.login.terms",e.Email="m.login.email.identity",e.Msisdn="m.login.msisdn",e.Sso="m.login.sso",e.SsoUnstable="org.matrix.login.sso"}(f||(f={}));const T=0;let P=Object(I.a)("views.auth.PasswordAuthEntry")((s=class extends E.a.Component{constructor(e){super(e),b()(this,"onSubmit",e=>{e.preventDefault(),this.props.busy||this.props.submitAuthDict({type:f.Password,user:this.props.matrixClient.credentials.userId,identifier:{type:"m.id.user",user:this.props.matrixClient.credentials.userId},password:this.state.password})}),b()(this,"onPasswordFieldChange",e=>{this.setState({password:e.target.value})}),this.state={password:""}}componentDidMount(){this.props.onPhaseChange(T)}render(){const e=S()({error:this.props.errorText});let t,a;if(this.props.busy){const e=C.getComponent("elements.Spinner");t=E.a.createElement(e,null)}else t=E.a.createElement("input",{type:"submit",className:"mx_Dialog_primary",disabled:!this.state.password,value:Object(w.a)("Continue")});this.props.errorText&&(a=E.a.createElement("div",{className:"error",role:"alert"},this.props.errorText));const n=C.getComponent("elements.Field");return E.a.createElement("div",null,E.a.createElement("p",null,Object(w.a)("Confirm your identity by entering your account password below.")),E.a.createElement("form",{onSubmit:this.onSubmit,className:"mx_InteractiveAuthEntryComponents_passwordSection"},E.a.createElement(n,{className:e,type:"password",name:"passwordField",label:Object(w.a)("Password"),autoFocus:!0,value:this.state.password,onChange:this.onPasswordFieldChange}),E.a.createElement("div",{className:"mx_button_row"},t)),a)}},b()(s,"LOGIN_TYPE",f.Password),n=s))||n,N=Object(I.a)("views.auth.RecaptchaAuthEntry")((o=class extends E.a.Component{constructor(){super(...arguments),b()(this,"onCaptchaResponse",e=>{k.a.instance.track("onboarding_grecaptcha_submit"),this.props.submitAuthDict({type:f.Recaptcha,response:e})})}componentDidMount(){this.props.onPhaseChange(T)}render(){if(this.props.busy){const e=C.getComponent("elements.Spinner");return E.a.createElement(e,null)}let e=this.props.errorText;const t=C.getComponent("views.auth.CaptchaForm");let a,n;return this.props.stageParams&&this.props.stageParams.public_key?a=this.props.stageParams.public_key:e=Object(w.a)("Missing captcha public key in homeserver configuration. Please report this to your homeserver administrator."),e&&(n=E.a.createElement("div",{className:"error",role:"alert"},e)),E.a.createElement("div",null,E.a.createElement(t,{sitePublicKey:a,onCaptchaResponse:this.onCaptchaResponse}),n)}},b()(o,"LOGIN_TYPE",f.Recaptcha),i=o))||i,D=Object(I.a)("views.auth.TermsAuthEntry")((l=class extends E.a.Component{constructor(e){super(e),b()(this,"tryContinue",()=>{this.trySubmit()}),b()(this,"trySubmit",()=>{let e=!0;for(const t of this.state.policies){const a=this.state.toggledPolicies[t.id];e=e&&a}e?(this.props.submitAuthDict({type:f.Terms}),k.a.instance.track("onboarding_terms_complete")):this.setState({errorText:Object(w.a)("Please review and accept all of the homeserver's policies")})});const t=this.props.stageParams.policies||{},a=O.b.getValue("language"),n={},s=[];for(const e of Object.keys(t)){const i=t[e];let o=i[a];if(o||(o=i.en),!o){o=i[Object.keys(i).find(e=>"version"!==e)]}if(!o)throw new Error("Failed to find a policy to show the user");n[e]=!1,s.push({id:e,name:o.name,url:o.url})}this.state={toggledPolicies:n,policies:s},k.a.instance.track("onboarding_terms_begin")}componentDidMount(){this.props.onPhaseChange(T)}togglePolicy(e){const t={};for(const a of this.state.policies){let n=this.state.toggledPolicies[a.id];a.id===e&&(n=!n),t[a.id]=n}this.setState({toggledPolicies:t})}render(){if(this.props.busy){const e=C.getComponent("elements.Spinner");return E.a.createElement(e,null)}const e=[];let t,a,n=!0;for(const t of this.state.policies){const a=this.state.toggledPolicies[t.id];n=n&&a,e.push(E.a.createElement("label",{key:"policy_checkbox_"+t.id,className:"mx_InteractiveAuthEntryComponents_termsPolicy"},E.a.createElement("input",{type:"checkbox",onChange:()=>this.togglePolicy(t.id),checked:a}),E.a.createElement("a",{href:t.url,target:"_blank",rel:"noreferrer noopener"},t.name)))}return(this.props.errorText||this.state.errorText)&&(t=E.a.createElement("div",{className:"error",role:"alert"},this.props.errorText||this.state.errorText)),!1!==this.props.showContinue&&(a=E.a.createElement("button",{className:"mx_InteractiveAuthEntryComponents_termsSubmit mx_GeneralButton",onClick:this.trySubmit,disabled:!n},Object(w.a)("Accept"))),E.a.createElement("div",null,E.a.createElement("p",null,Object(w.a)("Please review and accept the policies of this homeserver:")),e,t,a)}},b()(l,"LOGIN_TYPE",f.Terms),r=l))||r,j=Object(I.a)("views.auth.EmailIdentityAuthEntry")((d=class extends E.a.Component{componentDidMount(){this.props.onPhaseChange(T)}render(){var e;return void 0===this.props.inputs.emailAddress||null!==(e=this.props.stageState)&&void 0!==e&&e.emailSid?E.a.createElement(R.a,null):E.a.createElement("div",{className:"mx_InteractiveAuthEntryComponents_emailWrapper"},E.a.createElement("p",null,Object(w.a)("A confirmation email has been sent to %(emailAddress)s",{emailAddress:E.a.createElement("b",null,this.props.inputs.emailAddress)})),E.a.createElement("p",null,Object(w.a)("Open the link in the email to continue registration.")))}},b()(d,"LOGIN_TYPE",f.Email),c=d))||c,A=Object(I.a)("views.auth.MsisdnAuthEntry")((u=class extends E.a.Component{constructor(e){super(e),b()(this,"submitUrl",void 0),b()(this,"sid",void 0),b()(this,"msisdn",void 0),b()(this,"onTokenChange",e=>{this.setState({token:e.target.value})}),b()(this,"onFormSubmit",async e=>{if(e.preventDefault(),""!=this.state.token){this.setState({errorText:null});try{let e;if(!this.submitUrl)throw new Error("The registration with MSISDN flow is misconfigured");if(e=await this.props.matrixClient.submitMsisdnTokenOtherUrl(this.submitUrl,this.sid,this.props.clientSecret,this.state.token),e.success){const e={sid:this.sid,client_secret:this.props.clientSecret};this.props.submitAuthDict({type:f.Msisdn,threepid_creds:e,threepidCreds:e})}else this.setState({errorText:Object(w.a)("Token incorrect")})}catch(e){this.props.fail(e),console.log("Failed to submit msisdn token")}}}),this.state={token:"",requestingToken:!1,errorText:""}}componentDidMount(){this.props.onPhaseChange(T),this.setState({requestingToken:!0}),this.requestMsisdnToken().catch(e=>{this.props.fail(e)}).finally(()=>{this.setState({requestingToken:!1})})}requestMsisdnToken(){return this.props.matrixClient.requestRegisterMsisdnToken(this.props.inputs.phoneCountry,this.props.inputs.phoneNumber,this.props.clientSecret,1).then(e=>{this.submitUrl=e.submit_url,this.sid=e.sid,this.msisdn=e.msisdn})}render(){if(this.state.requestingToken){const e=C.getComponent("elements.Spinner");return E.a.createElement(e,null)}{const e=Boolean(this.state.token),t=S()({mx_InteractiveAuthEntryComponents_msisdnSubmit:!0,mx_GeneralButton:!0});let a;return this.state.errorText&&(a=E.a.createElement("div",{className:"error",role:"alert"},this.state.errorText)),E.a.createElement("div",null,E.a.createElement("p",null,Object(w.a)("A text message has been sent to %(msisdn)s",{msisdn:E.a.createElement("i",null,this.msisdn)})),E.a.createElement("p",null,Object(w.a)("Please enter the code it contains:")),E.a.createElement("div",{className:"mx_InteractiveAuthEntryComponents_msisdnWrapper"},E.a.createElement("form",{onSubmit:this.onFormSubmit},E.a.createElement("input",{type:"text",className:"mx_InteractiveAuthEntryComponents_msisdnEntry",value:this.state.token,onChange:this.onTokenChange,"aria-label":Object(w.a)("Code")}),E.a.createElement("br",null),E.a.createElement("input",{type:"submit",value:Object(w.a)("Submit"),className:t,disabled:!e})),a))}}},b()(u,"LOGIN_TYPE",f.Msisdn),m=u))||m,M=Object(I.a)("views.auth.SSOAuthEntry")((p=class e extends E.a.Component{constructor(t){super(t),b()(this,"ssoUrl",void 0),b()(this,"popupWindow",void 0),b()(this,"attemptFailed",()=>{this.setState({attemptFailed:!0})}),b()(this,"onReceiveMessage",e=>{"authDone"===e.data&&e.origin===this.props.matrixClient.getHomeserverUrl()&&this.popupWindow&&(this.popupWindow.close(),this.popupWindow=null)}),b()(this,"onStartAuthClick",()=>{this.popupWindow=window.open(this.ssoUrl,"_blank"),this.setState({phase:e.PHASE_POSTAUTH}),this.props.onPhaseChange(e.PHASE_POSTAUTH)}),b()(this,"onConfirmClick",()=>{this.props.submitAuthDict({})}),this.ssoUrl=t.matrixClient.getFallbackAuthUrl(this.props.loginType,this.props.authSessionId),this.popupWindow=null,window.addEventListener("message",this.onReceiveMessage),this.state={phase:e.PHASE_PREAUTH,attemptFailed:!1}}componentDidMount(){this.props.onPhaseChange(e.PHASE_PREAUTH)}componentWillUnmount(){window.removeEventListener("message",this.onReceiveMessage),this.popupWindow&&(this.popupWindow.close(),this.popupWindow=null)}render(){let t=null;const a=E.a.createElement(x.a,{onClick:this.props.onCancel,kind:this.props.continueKind?this.props.continueKind+"_outline":"primary_outline"},Object(w.a)("Cancel"));let n;return t=this.state.phase===e.PHASE_PREAUTH?E.a.createElement(x.a,{onClick:this.onStartAuthClick,kind:this.props.continueKind||"primary"},this.props.continueText||Object(w.a)("Single Sign On")):E.a.createElement(x.a,{onClick:this.onConfirmClick,kind:this.props.continueKind||"primary"},this.props.continueText||Object(w.a)("Confirm")),this.props.errorText?n=E.a.createElement("div",{className:"error",role:"alert"},this.props.errorText):this.state.attemptFailed&&(n=E.a.createElement("div",{className:"error",role:"alert"},Object(w.a)("Something went wrong in confirming your identity. Cancel and try again."))),E.a.createElement(E.a.Fragment,null,n,E.a.createElement("div",{className:"mx_InteractiveAuthEntryComponents_sso_buttons"},a,t))}},b()(p,"LOGIN_TYPE",f.Sso),b()(p,"UNSTABLE_LOGIN_TYPE",f.SsoUnstable),b()(p,"PHASE_PREAUTH",1),b()(p,"PHASE_POSTAUTH",2),h=p))||h,U=Object(I.a)("views.auth.FallbackAuthEntry")(g=class extends E.a.Component{constructor(e){super(e),b()(this,"popupWindow",void 0),b()(this,"fallbackButton",Object(y.createRef)()),b()(this,"focus",()=>{this.fallbackButton.current&&this.fallbackButton.current.focus()}),b()(this,"onShowFallbackClick",e=>{e.preventDefault(),e.stopPropagation();const t=this.props.matrixClient.getFallbackAuthUrl(this.props.loginType,this.props.authSessionId);this.popupWindow=window.open(t,"_blank")}),b()(this,"onReceiveMessage",e=>{"authDone"===e.data&&e.origin===this.props.matrixClient.getHomeserverUrl()&&this.props.submitAuthDict({})}),this.popupWindow=null,window.addEventListener("message",this.onReceiveMessage)}componentDidMount(){this.props.onPhaseChange(T)}componentWillUnmount(){window.removeEventListener("message",this.onReceiveMessage),this.popupWindow&&this.popupWindow.close()}render(){let e;return this.props.errorText&&(e=E.a.createElement("div",{className:"error",role:"alert"},this.props.errorText)),E.a.createElement("div",null,E.a.createElement("a",{href:"",ref:this.fallbackButton,onClick:this.onShowFallbackClick},Object(w.a)("Start authentication")),e)}})||g;function L(e){switch(e){case f.Password:return P;case f.Recaptcha:return N;case f.Email:return j;case f.Msisdn:return A;case f.Terms:return D;case f.Sso:case f.SsoUnstable:return M;default:return U}}},343:function(e,t,a){"use strict";a.d(t,"a",(function(){return R}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(100),l=a(99),c=a(97),d=a(93),m=a(106),u=a(165),h=a(1438),p=a.n(h),g=a(2747),f=a.n(g),v=a(168),b=(a(2749),a(115)),y=a(154);const E=[0,0,22,37,0,0,22,37,1];class _ extends Error{}function S(e,t,a,n){return new Promise(s=>{let i=t,o=a;o>600&&(i=Math.floor(i*(600/o)),o=600),i>800&&(o=Math.floor(o*(800/i)),i=800);const r=document.createElement("canvas");r.width=i,r.height=o,r.getContext("2d").drawImage(e,0,0,i,o),r.toBlob((function(e){s({info:{thumbnail_info:{w:i,h:o,mimetype:e.type,size:e.size},w:t,h:a},thumbnail:e})}),n)})}function C(e,t,a){let n,s="image/png";return"image/jpeg"===a.type&&(s="image/jpeg"),async function(e){const t=document.createElement("img"),a=URL.createObjectURL(e),n=new Promise((e,n)=>{t.onload=function(){URL.revokeObjectURL(a),e(t)},t.onerror=function(e){n(e)}});let s;if(t.src=a,"image/png"===e.type){s=O(e).then(e=>{const t=new Uint8Array(e),a=f()(t);for(const e of a)if("pHYs"===e.name){if(e.data.byteLength!==E.length)return;return e.data.every((e,t)=>e===E[t])}return!1})}const[i]=await Promise.all([s,n]);return{width:i?t.width>>1:t.width,height:i?t.height>>1:t.height,img:t}}(a).then(e=>S(e.img,e.width,e.height,s)).then(a=>(n=a.info,x(e,t,a.thumbnail))).then(e=>(n.thumbnail_url=e.url,n.thumbnail_file=e.file,n))}function w(e,t,a){let n;return function(e){return new Promise((t,a)=>{const n=document.createElement("video"),s=new FileReader;s.onload=function(e){n.src=e.target.result,n.onloadeddata=function(){t(n)},n.onerror=function(e){a(e)}},s.onerror=function(e){a(e)},s.readAsDataURL(e)})}(a).then(e=>S(e,e.videoWidth,e.videoHeight,"image/jpeg")).then(a=>(n=a.info,x(e,t,a.thumbnail))).then(e=>(n.thumbnail_url=e.url,n.thumbnail_file=e.file,n))}function O(e){return new Promise((t,a)=>{const n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=function(e){a(e)},n.readAsArrayBuffer(e)})}function x(e,t,a,n){let s=!1;if(e.isRoomEncrypted(t)){let t,i;const o=O(a).then((function(e){if(s)throw new _;return p.a.encryptAttachment(e)})).then((function(a){if(s)throw new _;i=a.info;const o=new Blob([a.data]);return t=e.uploadContent(o,{progressHandler:n,includeFilename:!1}),t})).then((function(e){if(s)throw new _;return i.url=e,a.type&&(i.mimetype=a.type),{file:i}}));return o.abort=()=>{s=!0,t&&l.a.get().cancelUpload(t)},o}{const t=e.uploadContent(a,{progressHandler:n}),i=t.then((function(e){if(s)throw new _;return{url:e}}));return i.abort=()=>{s=!0,l.a.get().cancelUpload(t)},i}}class R{constructor(){s()(this,"inprogress",[]),s()(this,"mediaConfig",null)}sendStickerContentToRoom(e,t,a,n,s){const i=y.a.getTimestamp(),o=l.a.get().sendStickerMessage(t,e,a,n).catch(a=>{throw console.warn(`Failed to send content with URL ${e} to room ${t}`,a),a});return y.a.instance.trackSendMessage(i,o,t,!1,!1,{msgtype:"m.sticker"}),o}getUploadLimit(){return null!==this.mediaConfig&&void 0!==this.mediaConfig["m.upload.size"]?this.mediaConfig["m.upload.size"]:null}async sendContentListToRoom(e,t,a){if(a.isGuest())return void r.a.dispatch({action:"require_registration"});if(Boolean(u.a.getQuotingEvent())){const e=c.getComponent("dialogs.QuestionDialog"),{finished:t}=m.a.createTrackedDialog("Upload Reply Warning","",e,{title:Object(d.a)("Replying With Files"),description:o.a.createElement("div",null,Object(d.a)("At this time it is not possible to reply with a file. Would you like to upload this file without replying?")),hasCancelButton:!0,button:Object(d.a)("Continue")}),[a]=await t;if(!a)return}if(!this.mediaConfig){const e=m.a.createDialog(v.a,null,"mx_Dialog_spinner");await this.ensureMediaConfigFetched(),e.close()}const n=[],s=[];for(let t=0;t<e.length;++t)this.isFileSizeAcceptable(e[t])?s.push(e[t]):n.push(e[t]);if(n.length>0){const t=c.getComponent("dialogs.UploadFailureDialog"),{finished:a}=m.a.createTrackedDialog("Upload Failure","",t,{badFiles:n,totalFiles:e.length,contentMessages:this}),[s]=await a;if(!s)return}const i=c.getComponent("dialogs.UploadConfirmDialog");let l=!1,h=Promise.resolve();for(let e=0;e<s.length;++e){const n=s[e];if(!l){const{finished:t}=m.a.createTrackedDialog("Upload Files confirmation","",i,{file:n,currentIndex:e,totalFiles:s.length}),[a,o]=await t;if(!a)break;o&&(l=!0)}h=this.sendContentToRoom(n,t,a,h)}}getCurrentUploads(){return this.inprogress.filter(e=>!e.canceled)}cancelUpload(e){let t;for(let a=0;a<this.inprogress.length;++a)if(this.inprogress[a].promise===e){t=this.inprogress[a];break}t&&(t.canceled=!0,l.a.get().cancelUpload(t.promise),r.a.dispatch({action:b.a.UploadCanceled,upload:t}))}sendContentToRoom(e,t,a,n){const s=y.a.getTimestamp(),i={body:e.name||"Attachment",info:{size:e.size},msgtype:""};e.type&&(i.info.mimetype=e.type);const o=new Promise(n=>{0===e.type.indexOf("image/")?(i.msgtype="m.image",C(a,t,e).then(e=>{Object.assign(i.info,e),n()},e=>{console.error(e),i.msgtype="m.file",n()})):0===e.type.indexOf("audio/")?(i.msgtype="m.audio",n()):0===e.type.indexOf("video/")?(i.msgtype="m.video",w(a,t,e).then(e=>{Object.assign(i.info,e),n()},e=>{i.msgtype="m.file",n()})):(i.msgtype="m.file",n())});o.abort=()=>{l.canceled=!0};const l={fileName:e.name||"Attachment",roomId:t,total:e.size,loaded:0,promise:o};function u(e){l.total=e.total,l.loaded=e.loaded,r.a.dispatch({action:b.a.UploadProgress,upload:l})}let h;return this.inprogress.push(l),r.a.dispatch({action:b.a.UploadStarted,upload:l}),r.a.fire(b.a.FocusComposer),o.then((function(){if(l.canceled)throw new _;return l.promise=x(a,t,e,u),l.promise.then((function(e){i.file=e.file,i.url=e.url}))})).then(()=>n).then((function(){if(l.canceled)throw new _;const e=a.sendMessage(t,i);return y.a.instance.trackSendMessage(s,e,t,!1,!1,i),e}),(function(e){if(h=e,!l.canceled){let t=Object(d.a)("The file '%(fileName)s' failed to upload.",{fileName:l.fileName});413===e.http_status&&(t=Object(d.a)("The file '%(fileName)s' exceeds this homeserver's size limit for uploads",{fileName:l.fileName}));const a=c.getComponent("dialogs.ErrorDialog");m.a.createTrackedDialog("Upload failed","",a,{title:Object(d.a)("Upload Failed"),description:t})}})).finally(()=>{for(let e=0;e<this.inprogress.length;++e)if(this.inprogress[e].promise===l.promise){this.inprogress.splice(e,1);break}h?(h&&413===h.http_status&&(this.mediaConfig=null),r.a.dispatch({action:b.a.UploadFailed,upload:l,error:h})):(r.a.dispatch({action:b.a.UploadFinished,upload:l}),r.a.dispatch({action:"message_sent"}))})}isFileSizeAcceptable(e){return!(null!==this.mediaConfig&&void 0!==this.mediaConfig["m.upload.size"]&&e.size>this.mediaConfig["m.upload.size"])}ensureMediaConfigFetched(){if(null===this.mediaConfig)return console.log("[Media Config] Fetching"),l.a.get().getMediaConfig().then(e=>(console.log("[Media Config] Fetched config:",e),e)).catch(()=>(console.log("[Media Config] Could not fetch config, so not limiting uploads."),{})).then(e=>{this.mediaConfig=e})}static sharedInstance(){return void 0===window.mxContentMessages&&(window.mxContentMessages=new R),window.mxContentMessages}}},346:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(1),s=a(8);function i(e){this.userId=e,this.presence="offline",this.presenceStatusMsg=null,this._unstable_statusMessage="",this.displayName=e,this.rawDisplayName=e,this.avatarUrl=null,this.lastActiveAgo=0,this.lastPresenceTs=0,this.currentlyActive=!1,this.events={presence:null,profile:null},this._updateModifiedTime()}n.m(i,s.EventEmitter),i.prototype.setPresenceEvent=function(e){if("m.presence"!==e.getType())return;const t=null===this.events.presence;this.events.presence=e;const a=[];(e.getContent().presence!==this.presence||t)&&a.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&a.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&a.push("User.displayName"),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&a.push("User.currentlyActive"),this.presence=e.getContent().presence,a.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this._updateModifiedTime();for(let t=0;t<a.length;t++)this.emit(a[t],e,this)},i.prototype.setDisplayName=function(e){const t=this.displayName;this.displayName="string"==typeof e?e:void 0,e!==t&&this._updateModifiedTime()},i.prototype.setRawDisplayName=function(e){this.rawDisplayName="string"==typeof e?e:void 0},i.prototype.setAvatarUrl=function(e){const t=this.avatarUrl;this.avatarUrl=e,e!==t&&this._updateModifiedTime()},i.prototype._updateModifiedTime=function(){this._modified=Date.now()},i.prototype.getLastModifiedTime=function(){return this._modified},i.prototype.getLastActiveTs=function(){return this.lastPresenceTs-this.lastActiveAgo},i.prototype._unstable_updateStatusMessage=function(e){e.getContent()?this._unstable_statusMessage=e.getContent().status:this._unstable_statusMessage="",this._updateModifiedTime(),this.emit("User._unstable_statusMessage",this)}},360:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(103);function s(e){const t=t=>n.b.getValue(t,e.getRoomId());if(e.isRedacted()&&!t("showRedactions"))return!0;if(e.isRelation("m.replace"))return!0;const a=function(e){const t={isMemberEvent:"m.room.member"===e.getType()};if(!t.isMemberEvent)return t;const a=e.getContent(),n=e.getPrevContent(),s=a.membership!==n.membership;t.isJoin=s&&"join"===a.membership,t.isPart=s&&"leave"===a.membership&&e.getStateKey()===e.getSender();const i=!s&&"join"===a.membership;return t.isDisplaynameChange=i&&a.displayname!==n.displayname,t.isAvatarChange=i&&a.avatar_url!==n.avatar_url,t}(e);if(a.isMemberEvent){if((a.isJoin||a.isPart)&&!t("showJoinLeaves"))return!0;if(a.isAvatarChange&&!t("showAvatarChanges"))return!0;if(a.isDisplaynameChange&&!t("showDisplaynameChanges"))return!0}return!1}},363:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c})),a.d(t,"c",(function(){return d}));var n=a(92),s=a.n(n);const i=/^\S+@\S+\.\S+$/,o=/^@\S+:\S+$/,r=/^!\S+:\S+$/,l=["mx-user-id","mx-room-id","email"],c=s.a.shape({addressType:s.a.oneOf(l).isRequired,address:s.a.string.isRequired,displayName:s.a.string,avatarMxc:s.a.string,isKnown:s.a.bool});function d(e){const t=i.test(e),a=o.test(e),n=r.test(e);return t?"email":a?"mx-user-id":n?"mx-room-id":null}},364:function(e,t,a){"use strict";a.d(t,"i",(function(){return d})),a.d(t,"j",(function(){return m})),a.d(t,"a",(function(){return u})),a.d(t,"h",(function(){return h})),a.d(t,"g",(function(){return p})),a.d(t,"e",(function(){return g})),a.d(t,"d",(function(){return f})),a.d(t,"f",(function(){return v})),a.d(t,"b",(function(){return b})),a.d(t,"c",(function(){return y})),a.d(t,"k",(function(){return E}));var n=a(258),s=a.n(n),i=a(0),o=a(8),r=a(488),l=a(487);const c="m.key.verification.",d=c+"request",m=c+"start",u=c+"cancel",h=c+"ready",p=1,g=2,f=3,v=4,b=5,y=6;class E extends o.EventEmitter{constructor(e,t,a){super(),s()(this,"_cancelOnTimeout",()=>{try{this.initiatedByMe?this.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):this.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(e){i.a.error("Error while cancelling verification request",e)}}),this.channel=e,this.channel._request=this,this._verificationMethods=t,this._client=a,this._commonMethods=[],this._setPhase(p,!1),this._eventsByUs=new Map,this._eventsByThem=new Map,this._observeOnly=!1,this._timeoutTimer=null,this._accepting=!1,this._declining=!1,this._verifierHasFinished=!1,this._cancelled=!1,this._chosenMethod=null,this._qrCodeData=null,this._requestReceivedAt=null}static validateEvent(e,t,a){const n=t.getContent();return!(!e||!e.startsWith(c))&&(n?e!==d&&e!==h||Array.isArray(n.methods)?e!==d&&e!==h&&e!==m||"string"==typeof n.from_device&&0!==n.from_device.length||(i.a.log("VerificationRequest: validateEvent: fail because from_device"),!1):(i.a.log("VerificationRequest: validateEvent: fail because methods"),!1):(i.a.log("VerificationRequest: validateEvent: no content"),!1))}get invalid(){return this.phase===p}get requested(){return this.phase===g}get cancelled(){return this.phase===b}get ready(){return this.phase===f}get started(){return this.phase===v}get done(){return this.phase===y}get methods(){return this._commonMethods}get chosenMethod(){return this._chosenMethod}calculateEventTimeout(e){let t=this.channel.getTimestamp(e)+6e5;if(this._requestReceivedAt&&!this.initiatedByMe&&this.phase<=g){const e=this._requestReceivedAt+12e4;t=Math.min(t,e)}return Math.max(0,t-Date.now())}get timeout(){const e=this._getEventByEither(d);return e?this.calculateEventTimeout(e):0}get requestEvent(){return this._getEventByEither(d)}get phase(){return this._phase}get verifier(){return this._verifier}get canAccept(){return this.phase<f&&!this._accepting&&!this._declining}get accepting(){return this._accepting}get declining(){return this._declining}get pending(){return!this.observeOnly&&this._phase!==y&&this._phase!==b}get qrCodeData(){return this._qrCodeData}otherPartySupportsMethod(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.ready&&!this.started)return!1;const t=this._eventsByThem.get(d)||this._eventsByThem.get(h);if(!t){if(this.started&&this.initiatedByMe){const t=this._eventsByUs.get(m),a=t&&t.getContent();return e==(a&&a.method)}return!1}const a=t.getContent();if(!a)return!1;const{methods:n}=a;return!!Array.isArray(n)&&n.includes(e)}get initiatedByMe(){const e=this._eventsByUs.size+this._eventsByThem.size===0;if(this._phase===p&&e)return!0;const t=this._eventsByUs.has(d),a=this._eventsByThem.has(d);if(t&&!a)return!0;if(!t&&a)return!1;const n=this._eventsByUs.has(m),s=this._eventsByThem.has(m);return!(!n||s)}get requestingUserId(){return this.initiatedByMe?this._client.getUserId():this.otherUserId}get receivingUserId(){return this.initiatedByMe?this.otherUserId:this._client.getUserId()}get otherUserId(){return this.channel.userId}get isSelfVerification(){return this._client.getUserId()===this.otherUserId}get cancellingUserId(){const e=this._eventsByUs.get(u),t=this._eventsByThem.get(u);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}get cancellationCode(){const e=this._getEventByEither(u);return e?e.getContent().code:null}get observeOnly(){return this._observeOnly}get targetDevice(){const e=(this._eventsByThem.get(d)||this._eventsByThem.get(h)||this._eventsByThem.get(m)).getContent().from_device;return{userId:this.otherUserId,deviceId:e}}beginKeyVerification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.observeOnly&&!this._verifier){if(this.phase===g||this.phase===f||this.phase===p&&this.channel.constructor.canCreateRequest(m)){if(this._commonMethods.length&&!this._commonMethods.includes(e))throw Object(r.g)();if(this._verifier=this._createVerifier(e,null,t),!this._verifier)throw Object(r.g)();this._chosenMethod=e}}return this._verifier}async sendRequest(){if(!this.observeOnly&&this._phase===p){const e=[...this._verificationMethods.keys()];await this.channel.send(d,{methods:e})}}async cancel(){let{reason:e="User declined",code:t="m.user"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.observeOnly&&this._phase!==b){if(this._declining=!0,this.emit("change"),this._verifier)return this._verifier.cancel(Object(r.a)(t,e)());this._cancellingUserId=this._client.getUserId(),await this.channel.send(u,{code:t,reason:e})}}async accept(){if(!this.observeOnly&&this.phase===g&&!this.initiatedByMe){const e=[...this._verificationMethods.keys()];this._accepting=!0,this.emit("change"),await this.channel.send(h,{methods:e})}}waitFor(e){return new Promise((t,a)=>{const n=()=>{let s=!1;return e(this)?(t(this),s=!0):this.cancelled&&(a(new Error("cancelled")),s=!0),s&&this.off("change",n),s};n()||this.on("change",n)})}_setPhase(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._phase=e,t&&this.emit("change")}_getEventByEither(e){return this._eventsByThem.get(e)||this._eventsByUs.get(e)}_getEventBy(e,t){return t?this._eventsByThem.get(e):this._eventsByUs.get(e)}_calculatePhaseTransitions(){const e=[{phase:p}],t=()=>e[e.length-1].phase,a=this._eventsByThem.has(d),n=this._getEventBy(d,a);n&&e.push({phase:g,event:n});const s=n&&this._getEventBy(h,!a);let i;if(s&&t()===g&&e.push({phase:f,event:s}),s||!n){const e=this._eventsByThem.get(m),t=this._eventsByUs.get(m);i=e&&t?e.getSender()<t.getSender()?e:t:e||t}else i=this._getEventBy(m,!a);if(i){const a=t()===g&&n.getSender()!==i.getSender(),s=t()===p&&this.channel.constructor.canCreateRequest(m);(a||t()===f||s)&&e.push({phase:v,event:i})}const o=this._eventsByUs.get("m.key.verification.done");(this._verifierHasFinished||o&&t()===v)&&e.push({phase:y});const r=this._getEventByEither(u);return(this._cancelled||r)&&t()!==y?(e.push({phase:b,event:r}),e):e}_transitionToPhase(e){const{phase:t,event:a}=e;if((t===g||t===f)&&!this._wasSentByOwnDevice(a)){const e=a.getContent();this._commonMethods=e.methods.filter(e=>this._verificationMethods.has(e))}if(this.observeOnly||t!==g&&t!==v&&t!==f||this.channel.receiveStartFromOtherDevices&&this._wasSentByOwnUser(a)&&!this._wasSentByOwnDevice(a)&&(this._observeOnly=!0),t===v){const{method:e}=a.getContent();this._verifier||this.observeOnly||(this._verifier=this._createVerifier(e,a),this._verifier?this._chosenMethod=e:this.cancel({code:"m.unknown_method",reason:"Unknown method: "+e}))}}_applyPhaseTransitions(){const e=this._calculatePhaseTransitions(),t=e.findIndex(e=>e.phase===this.phase),a=e.slice(t+1);for(const e of a)this._transitionToPhase(e);return a}_isWinningStartRace(e){if(e.getType()!==m)return!1;const t=this._verifier.startEvent;let a,n;if(this.isSelfVerification)if(t){const e=t.getContent();a=e&&e.from_device}else a=this._client.getDeviceId();else a=t?t.getSender():this._client.getUserId();if(this.isSelfVerification){const t=e.getContent();n=t&&t.from_device}else n=e.getSender();return n<a}hasEventId(e){for(const t of this._eventsByUs.values())if(t.getId()===e)return!0;for(const t of this._eventsByThem.values())if(t.getId()===e)return!0;return!1}async handleEvent(e,t,a,n,s){if(this.done||this.cancelled)return;const o=this._observeOnly;if(this._adjustObserveOnly(t,a),!this.observeOnly&&!n&&await this._cancelOnError(e,t))return;if(s?this._eventsByUs.has(e):this._eventsByThem.has(e))return;const r=this.phase;this._addEvent(e,t,s);const c=this._applyPhaseTransitions();try{if(this._verifier&&!this.observeOnly){const a=this._isWinningStartRace(t);this._verifier.canSwitchStartEvent(t)&&a?this._verifier.switchStartEvent(t):n||(e===u||this._verifier.events&&this._verifier.events.includes(e))&&this._verifier.handleEvent(t)}if(c.length){if(a&&c.some(e=>e.phase===f)){this.otherPartySupportsMethod(l.c,!0)&&(this._qrCodeData=await l.a.create(this,this._client))}const e=c[c.length-1],{phase:t}=e;this._setupTimeout(t),this._setPhase(t)}else this._observeOnly!==o&&this.emit("change")}finally{i.a.log(`Verification request ${this.channel.transactionId}: ${e} event with id:${t.getId()}, content:${JSON.stringify(t.getContent())} deviceId:${this.channel.deviceId}, sender:${t.getSender()}, isSentByUs:${s}, isLiveEvent:${a}, isRemoteEcho:${n}, phase:${r}=>${this.phase}, observeOnly:${o}=>${this._observeOnly}`)}}_setupTimeout(e){if(!this._timeoutTimer&&!this.observeOnly&&e===g&&(this._timeoutTimer=setTimeout(this._cancelOnTimeout,this.timeout)),this._timeoutTimer){(e===v||e===f||e===y||e===b)&&(clearTimeout(this._timeoutTimer),this._timeoutTimer=null)}}async _cancelOnError(e,t){if(e===m){const e=t.getContent().method;if(!this._verificationMethods.has(e))return await this.cancel(Object(r.b)(Object(r.g)())),!0}const a=e===d&&this.phase!==p,n=e===h&&this.phase!==g;if(this.phase!==p&&(a||n)){i.a.warn(`Cancelling, unexpected ${e} verification event from `+t.getSender());const a=`Unexpected ${e} event in phase ${this.phase}`;return await this.cancel(Object(r.b)(Object(r.f)({reason:a}))),!0}return!1}_adjustObserveOnly(e,t){t||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}_addEvent(e,t,a){if(a?this._eventsByUs.set(e,t):this._eventsByThem.set(e,t),e===d){for(const[e,t]of this._eventsByThem.entries())t.getSender()!==this.otherUserId&&this._eventsByThem.delete(e);this._requestReceivedAt=Date.now()}}_createVerifier(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a||(a=this.targetDevice);const{userId:n,deviceId:s}=a,o=this._verificationMethods.get(e);if(o)return new o(this.channel,this._client,n,s,t,this);i.a.warn("could not find verifier constructor for method",e)}_wasSentByOwnUser(e){return e.getSender()===this._client.getUserId()}_wasSentByOwnDevice(e){if(!this._wasSentByOwnUser(e))return!1;const t=e.getContent();return!(!t||t.from_device!==this._client.getDeviceId())}onVerifierCancelled(){this._cancelled=!0;const e=this._applyPhaseTransitions();e.length&&this._setPhase(e[e.length-1].phase)}onVerifierFinished(){this.channel.send("m.key.verification.done",{}),this._verifierHasFinished=!0;const e=this._applyPhaseTransitions();e.length&&this._setPhase(e[e.length-1].phase)}getEventFromOtherParty(e){return this._eventsByThem.get(e)}}},367:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return l}));var n=a(19),s=a.n(n),i=a(8),o=a(333);const r="update";class l extends i.EventEmitter{constructor(){super(...arguments),s()(this,"_symbol",void 0),s()(this,"_count",void 0),s()(this,"_color",void 0)}get symbol(){return this._symbol}get count(){return this._count}get color(){return this._color}get isIdle(){return this.color<=o.a.None}get isUnread(){return this.color>=o.a.Bold}get hasUnreadCount(){return this.color>=o.a.Grey&&(!!this.count||!!this.symbol)}get hasMentions(){return this.color>=o.a.Red}emitIfUpdated(e){e.isDifferentFrom(this)&&this.emit(r)}snapshot(){return new c(this)}destroy(){this.removeAllListeners(r)}}class c{constructor(e){s()(this,"symbol",void 0),s()(this,"count",void 0),s()(this,"color",void 0),this.symbol=e.symbol,this.count=e.count,this.color=e.color}isDifferentFrom(e){const t={count:this.count,symbol:this.symbol,color:this.color},a={count:e.count,symbol:e.symbol,color:e.color};return JSON.stringify(t)!==JSON.stringify(a)}}},368:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return r})),a.d(t,"d",(function(){return c})),a.d(t,"e",(function(){return d})),a.d(t,"b",(function(){return m}));var n=a(185),s=a(126),i=a(103);function o(e,t,a,n){let i;return null!=e&&e.getMxcAvatarUrl()&&(i=Object(s.b)(e.getMxcAvatarUrl()).getThumbnailOfSourceHttp(t,a,n)),i||(i=c(e?e.userId:"")),i}function r(e,t,a,n){return e.avatarUrl?Object(s.b)(e.avatarUrl).getThumbnailOfSourceHttp(t,a,n):null}const l=new Map;function c(e){if(!e)return"";const t=["#0DBD8B","#368bd6","#ac3ba8"];let a=0;for(let t=0;t<e.length;++t)a+=e.charCodeAt(t);const n=a%t.length,s="--avatar-background-colors_"+n,i=document.body.style.getPropertyValue(s)||t[n];let o=l.get(i);return o||(!function(e){return"string"==typeof e&&(7===e.length||9===e.length)&&"#"===e.charAt(0)&&!e.substr(1).split("").some(e=>isNaN(parseInt(e,16)))}(i)?o="":(o=function(e){const t=document.createElement("canvas");t.width=40,t.height=40;const a=t.getContext("2d");return a?(a.fillStyle=e,a.fillRect(0,0,40,40),t.toDataURL()):""}(i),l.set(i,o))),o}function d(e){if(!e)return void console.trace("`name` argument to `getInitialLetter` not supplied");if(e.length<1)return;let t=0;const a=e[0];"@"!==a&&"#"!==a&&"+"!==a||!e[1]||t++;let n=1;const s=e.charCodeAt(t);if(s>=55296&&s<=56319&&e[t+1]){const a=e.charCodeAt(t+1);a>=56320&&a<=57343&&n++}return e.substring(t,t+n).toUpperCase()}function m(e,t,a,o){var r;if(!e)return null;if(e.getMxcAvatarUrl())return Object(s.b)(e.getMxcAvatarUrl()).getThumbnailOfSourceHttp(t,a,o);if(i.b.getValue("feature_spaces")&&e.isSpaceRoom())return null;let l=null;const c=n.a.shared().getUserIdForRoomId(e.roomId);return l=c?e.getMember(c):e.getAvatarFallbackMember(),null!==(r=l)&&void 0!==r&&r.getMxcAvatarUrl()?Object(s.b)(l.getMxcAvatarUrl()).getThumbnailOfSourceHttp(t,a,o):null}},369:function(e,t,a){"use strict";(function(e){class a{constructor(){this.keyRgb=["rgb(118, 207, 166)","rgb(234, 245, 240)","rgb(211, 239, 225)"],this.keyHex=["#76CFA6","#EAF5F0","#D3EFE1","#FFFFFF","#000000"],this.colors=[this.keyHex[0],this.keyHex[1],this.keyHex[2],this.keyHex[3],this.keyHex[4]],this.currentTint=[void 0,void 0,void 0,void 0,void 0],this.cssFixups=[],this.cssAttrs=["color","backgroundColor","borderColor","borderTopColor","borderBottomColor","borderLeftColor"],this.svgAttrs=["fill","stroke"],this.tintables=[],this.theme=void 0,this.forceTint=!1}registerTintable(e){this.tintables.push(e),e()}getKeyRgb(){return this.keyRgb}tint(e,t,a){}tintSvgWhite(e){this.currentTint[3]=e,e||(e=this.colors[3]),this.colors[3]!==e&&(this.colors[3]=e,this.tintables.forEach((function(e){e()})))}tintSvgBlack(e){this.currentTint[4]=e,e||(e=this.colors[4]),this.colors[4]!==e&&(this.colors[4]=e,this.tintables.forEach((function(e){e()})))}setTheme(e){this.theme=e,document.getElementById("mx_theme_accentColor")&&(this.keyRgb[0]=window.getComputedStyle(document.getElementById("mx_theme_accentColor")).color),document.getElementById("mx_theme_secondaryAccentColor")&&(this.keyRgb[1]=window.getComputedStyle(document.getElementById("mx_theme_secondaryAccentColor")).color),document.getElementById("mx_theme_tertiaryAccentColor")&&(this.keyRgb[2]=window.getComputedStyle(document.getElementById("mx_theme_tertiaryAccentColor")).color),this.calcCssFixups(),this.forceTint=!0,this.tint(this.currentTint[0],this.currentTint[1],this.currentTint[2]),"dark"===e?(this.tintSvgWhite("#2d2d2d"),this.tintSvgBlack("#dddddd")):(this.tintSvgWhite("#ffffff"),this.tintSvgBlack("#000000"))}calcCssFixups(){if(!this.cssFixups[this.theme]){0,this.cssFixups[this.theme]=[];for(let e=0;e<document.styleSheets.length;e++){const t=document.styleSheets[e];try{if(!t)continue;if(!t.href||!t.href.match(new RegExp("/theme-"+this.theme+".css$")))continue;if(t.disabled)continue;if(!t.cssRules)continue;0;for(let e=0;e<t.cssRules.length;e++){const a=t.cssRules[e];if(a.style&&(!a.selectorText||!a.selectorText.match(/#mx_theme/)))for(let e=0;e<this.cssAttrs.length;e++){const t=this.cssAttrs[e];for(let e=0;e<this.keyRgb.length;e++)a.style[t]===this.keyRgb[e]&&this.cssFixups[this.theme].push({style:a.style,attr:t,index:e})}}}catch(e){console.log("Failed to calculate CSS fixups for a stylesheet: "+t.href,e)}}0}}applyCssFixups(){for(let e=0;e<this.cssFixups[this.theme].length;e++){const t=this.cssFixups[this.theme][e];try{t.style[t.attr]=this.colors[t.index]}catch(e){console.error("Failed to apply cssFixup in Tinter! ",e.name)}}}calcSvgFixups(e){const t=[];for(let a=0;a<e.length;a++){let n;try{n=e[a].contentDocument}catch(t){let n="Failed to get svg.contentDocument of "+e[a].toString();t.message&&(n+=t.message),t.stack&&(n+=" | stack: "+t.stack),console.error(n)}if(!n)continue;const s=n.getElementsByTagName("*");for(let e=0;e<s.length;e++){const a=s[e];for(let e=0;e<this.svgAttrs.length;e++){const n=this.svgAttrs[e];for(let e=0;e<this.keyHex.length;e++)a.getAttribute(n)&&a.getAttribute(n).toUpperCase()===this.keyHex[e]&&t.push({node:a,attr:n,index:e})}}}return t}applySvgFixups(e){for(let t=0;t<e.length;t++){const a=e[t];a.node.setAttribute(a.attr,this.colors[a.index])}}}void 0===e.singletonTinter&&(e.singletonTinter=new a),t.a=e.singletonTinter}).call(this,a(7))},373:function(e,t){e.exports="img/warning.05cc423.svg"},374:function(e,t,a){"use strict";a.r(t),a.d(t,"containsEmoji",(function(){return n}));const n=(e,t)=>t.some(t=>e.body&&e.body.includes(t))},375:function(e,t,a){"use strict";function n(e){const t=e.embeddedPages;let a=null==t?void 0:t.homeUrl;return a||(a=e.welcomePageUrl),a}function s(e){const t=e.embeddedPages;let a=null==t?void 0:t.homeUrl;return a||(a=e.welcomePageUrl),a}function i(e){const t=e.embeddedPages;return!0===(null==t?void 0:t.loginForWelcome)}a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return i}))},377:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(92),l=a.n(r),c=a(97),d=a(93),m=a(102),u=a.n(m);class h extends o.a.Component{constructor(){super(...arguments),s()(this,"onFinished",()=>{this.props.onFinished()})}render(){const e=c.getComponent("views.dialogs.BaseDialog"),t=c.getComponent("views.elements.DialogButtons");return o.a.createElement(e,{className:"mx_InfoDialog",onFinished:this.props.onFinished,title:this.props.title,contentId:"mx_Dialog_content",hasCancel:this.props.hasCloseButton,onKeyDown:this.props.onKeyDown,fixedWidth:this.props.fixedWidth},o.a.createElement("div",{className:u()("mx_Dialog_content",this.props.className),id:"mx_Dialog_content"},this.props.description),!1!==this.props.button&&o.a.createElement(t,{primaryButton:this.props.button||Object(d.a)("OK"),onPrimaryButtonClick:this.onFinished,hasCancel:!1}))}}s()(h,"propTypes",{className:l.a.string,title:l.a.string,description:l.a.node,button:l.a.oneOfType([l.a.string,l.a.bool]),onFinished:l.a.func,hasCloseButton:l.a.bool,onKeyDown:l.a.func,fixedWidth:l.a.bool}),s()(h,"defaultProps",{title:"",description:"",hasCloseButton:!1})},382:function(e,t,a){"use strict";a.d(t,"a",(function(){return m})),a.d(t,"b",(function(){return u}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(418),l=a(93);var c=a(110);const d=[r.a.ERROR_INVALID_HOMESERVER,r.a.ERROR_INVALID_IDENTITY_SERVER];class m{constructor(){s()(this,"hsUrl",void 0),s()(this,"hsName",void 0),s()(this,"hsNameIsDifferent",void 0),s()(this,"isUrl",void 0),s()(this,"isDefault",void 0),s()(this,"isNameResolvable",void 0),s()(this,"warning",void 0)}}class u{static isLivelinessError(e){return!!e&&!!d.find(t=>"string"==typeof e?t===e:t===e.message)}static authComponentStateForError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"login";if(!e)return{serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:null};let a=Object(l.a)("Cannot reach homeserver"),n=Object(l.a)("Ensure you have a stable internet connection, or get in touch with the server admin");if(!u.isLivelinessError(e)){const e=c.a.get().brand;a=Object(l.a)("Your %(brand)s is misconfigured",{brand:e}),n=Object(l.a)("Ask your %(brand)s admin to check <a>your config</a> for incorrect or duplicate entries.",{brand:e},{a:e=>o.a.createElement("a",{href:"https://github.com/vector-im/element-web/blob/master/docs/config.md",target:"_blank",rel:"noreferrer noopener"},e)})}let s=!0;return("string"==typeof e?e:e.message)===r.a.ERROR_INVALID_IDENTITY_SERVER&&(s=!1,a=Object(l.a)("Cannot reach identity server"),n="register"===t?Object(l.a)("You can register, but some features will be unavailable until the identity server is back online. If you keep seeing this warning, check your configuration or contact a server admin."):"reset_password"===t?Object(l.a)("You can reset your password, but some features will be unavailable until the identity server is back online. If you keep seeing this warning, check your configuration or contact a server admin."):Object(l.a)("You can log in, but some features will be unavailable until the identity server is back online. If you keep seeing this warning, check your configuration or contact a server admin.")),{serverIsAlive:!1,serverErrorIsFatal:s,serverDeadError:o.a.createElement("div",null,o.a.createElement("strong",null,a),o.a.createElement("div",null,n))}}static async validateServerConfigWithStaticUrls(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)throw Object(l.h)(Object(l.b)("No homeserver URL provided"));const n={"m.homeserver":{base_url:e}};t&&(n["m.identity_server"]={base_url:t});const s=await r.a.fromDiscoveryConfig(n),i=new URL(e).hostname;return u.buildValidatedConfigFromDiscovery(i,s,a,!0)}static async validateServerName(e){const t=await r.a.findClientConfig(e);return u.buildValidatedConfigFromDiscovery(e,t)}static buildValidatedConfigFromDiscovery(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t||!t["m.homeserver"])throw console.error("Ended up in a state of not knowing which homeserver to connect to."),Object(l.h)(Object(l.b)("Unexpected error resolving homeserver configuration"));const s=t["m.homeserver"],i=t["m.identity_server"],o=c.a.get().validated_server_config;let d=o&&o.isUrl;if(i&&i.state===r.a.SUCCESS)d=i.base_url;else if(i&&i.state!==r.a.PROMPT){if(console.error("Error determining preferred identity server URL:",i),i.state===r.a.FAIL_ERROR){if(-1!==r.a.ALL_ERRORS.indexOf(i.error))throw Object(l.h)(i.error);throw Object(l.h)(Object(l.b)("Unexpected error resolving identity server configuration"))}s.error=r.a.ERROR_INVALID_IDENTITY_SERVER,i.base_url&&(d=i.base_url)}if(s.state!==r.a.SUCCESS&&(console.error("Error processing homeserver config:",s),!a||!u.isLivelinessError(s.error))){if(-1!==r.a.ALL_ERRORS.indexOf(s.error))throw Object(l.h)(s.error);throw Object(l.h)(Object(l.b)("Unexpected error resolving homeserver configuration"))}const h=s.base_url;let p=e||s.server_name;const g=new URL(h);if(p||(p=g.hostname),!p)throw console.error("Failed to parse homeserver name from homeserver URL"),Object(l.h)(Object(l.b)("Unexpected error resolving homeserver configuration"));return function(e,t){const a=new e;return Object.assign(a,t),a}(m,{hsUrl:h,hsName:p,hsNameIsDifferent:g.hostname!==p,isUrl:d,isDefault:!1,warning:s.error,isNameResolvable:!n})}}},383:function(e,t,a){"use strict";var n=a(19),s=a.n(n),i=a(156),o=a(99),r=a(257),l=a(256),c=a(211),d=a(103),m=a(8),u=a(123);class h extends m.EventEmitter{constructor(){super(),s()(this,"onSync",async(e,t,a)=>{const n=i.a.get().getEventIndexingManager();if("PREPARED"===t&&"SYNCING"===e){return await n.isEventIndexEmpty()&&await this.addInitialCheckpoints(),void this.startCrawler()}"SYNCING"!==t||"SYNCING"!==e||await n.commitLiveEvents()}),s()(this,"onRoomTimeline",async(e,t,a,n,s)=>{const i=o.a.get();i.isRoomEncrypted(t.roomId)&&!a&&s&&s.liveEvent&&!e.isRedacted()&&(await i.decryptEventIfNeeded(e),await this.addLiveEventToIndex(e))}),s()(this,"onRoomStateEvent",async(e,t)=>{o.a.get().isRoomEncrypted(t.roomId)&&("m.room.encryption"!==e.getType()||await this.isRoomIndexed(t.roomId)||(console.log("EventIndex: Adding a checkpoint for a newly encrypted room",t.roomId),this.addRoomCheckpoint(t.roomId,!0)))}),s()(this,"onEventDecrypted",async(e,t)=>{t||await this.addLiveEventToIndex(e)}),s()(this,"onRedaction",async(e,t)=>{if(!o.a.get().isRoomEncrypted(t.roomId))return;const a=i.a.get().getEventIndexingManager();try{await a.deleteEvent(e.getAssociatedId())}catch(e){console.log("EventIndex: Error deleting event from index",e)}}),s()(this,"onTimelineReset",async(e,t,a)=>{null!==e&&o.a.get().isRoomEncrypted(e.roomId)&&(console.log("EventIndex: Adding a checkpoint because of a limited timeline",e.roomId),this.addRoomCheckpoint(e.roomId,!1))}),this.crawlerCheckpoints=[],this._crawlerIdleTime=5e3,this._eventsPerCrawl=100,this._crawler=null,this._currentCheckpoint=null}async init(){const e=i.a.get().getEventIndexingManager();this.crawlerCheckpoints=await e.loadCheckpoints(),console.log("EventIndex: Loaded checkpoints",this.crawlerCheckpoints),this.registerListeners()}registerListeners(){const e=o.a.get();e.on("sync",this.onSync),e.on("Room.timeline",this.onRoomTimeline),e.on("Event.decrypted",this.onEventDecrypted),e.on("Room.timelineReset",this.onTimelineReset),e.on("Room.redaction",this.onRedaction),e.on("RoomState.events",this.onRoomStateEvent)}removeListeners(){const e=o.a.get();null!==e&&(e.removeListener("sync",this.onSync),e.removeListener("Room.timeline",this.onRoomTimeline),e.removeListener("Event.decrypted",this.onEventDecrypted),e.removeListener("Room.timelineReset",this.onTimelineReset),e.removeListener("Room.redaction",this.onRedaction),e.removeListener("RoomState.events",this.onRoomStateEvent))}async addInitialCheckpoints(){const e=i.a.get().getEventIndexingManager(),t=o.a.get(),a=t.getRooms().filter(e=>t.isRoomEncrypted(e.roomId));console.log("EventIndex: Adding initial crawler checkpoints"),await Promise.all(a.map(async t=>{const a=t.getLiveTimeline().getPaginationToken("b"),n={roomId:t.roomId,token:a,direction:"b",fullCrawl:!0},s={roomId:t.roomId,token:a,direction:"f"};try{n.token&&(await e.addCrawlerCheckpoint(n),this.crawlerCheckpoints.push(n)),s.token&&(await e.addCrawlerCheckpoint(s),this.crawlerCheckpoints.push(s))}catch(e){console.log("EventIndex: Error adding initial checkpoints for room",t.roomId,n,s,e)}}))}isValidEvent(e){const t=["m.room.message","m.room.name","m.room.topic"].includes(e.getType())&&!e.isRedacted()&&!e.isDecryptionFailure();let a=!0,n=!0;if("m.room.message"!==e.getType()||e.isRedacted())"m.room.topic"!==e.getType()||e.isRedacted()?"m.room.name"!==e.getType()||e.isRedacted()||e.getContent().name||(n=!1):e.getContent().topic||(n=!1);else{const t=e.getContent().msgtype;a=!!t&&!t.startsWith("m.key.verification"),e.getContent().body||(n=!1)}return t&&a&&n}eventToJson(e){const t=e.toJSON(),a=e.isEncrypted()?t.decrypted:t;return e.isEncrypted()?(a.curve25519Key=e.getSenderKey(),a.ed25519Key=e.getClaimedEd25519Key(),a.algorithm=e.getWireContent().algorithm,a.forwardingCurve25519KeyChain=e.getForwardingCurve25519KeyChain()):(delete a.curve25519Key,delete a.ed25519Key,delete a.algorithm,delete a.forwardingCurve25519KeyChain),a}async addLiveEventToIndex(e){const t=i.a.get().getEventIndexingManager();if(!this.isValidEvent(e))return;const a=this.eventToJson(e),n={displayname:e.sender.rawDisplayName,avatar_url:e.sender.getMxcAvatarUrl()};await t.addEventToIndex(a,n)}emitNewCheckpoint(){this.emit("changedCheckpoint",this.currentRoom())}async addEventsFromLiveTimeline(e){const t=e.getEvents();for(let e=0;e<t.length;e++){const a=t[e];await this.addLiveEventToIndex(a)}}async addRoomCheckpoint(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=i.a.get().getEventIndexingManager(),n=o.a.get().getRoom(e);if(!n)return;const s=n.getLiveTimeline(),r=s.getPaginationToken("b");if(!r)return void await this.addEventsFromLiveTimeline(s);const l={roomId:n.roomId,token:r,fullCrawl:t,direction:"b"};console.log("EventIndex: Adding checkpoint",l);try{await a.addCrawlerCheckpoint(l)}catch(e){console.log("EventIndex: Error adding new checkpoint for room",n.roomId,l,e)}this.crawlerCheckpoints.push(l)}async crawlerFunc(){let e=!1;const t=o.a.get(),a=i.a.get().getEventIndexingManager();this._crawler={},this._crawler.cancel=()=>{e=!0};let n=!1;for(;!e;){let s=d.b.getValueAt(u.a.DEVICE,"crawlerSleepTime");if(s=Math.max(s,100),n&&(s=this._crawlerIdleTime),null!==this._currentCheckpoint&&(this._currentCheckpoint=null,this.emitNewCheckpoint()),await Object(c.c)(s),e)break;const i=this.crawlerCheckpoints.shift();if(void 0===i){n=!0;continue}this._currentCheckpoint=i,this.emitNewCheckpoint(),n=!1;const o=t.getEventMapper({preventReEmit:!0});let r;try{r=await t.createMessagesRequest(i.roomId,i.token,this._eventsPerCrawl,i.direction)}catch(e){if(403===e.httpStatus){console.log("EventIndex: Removing checkpoint as we don't have ","permissions to fetch messages from this room.",i);try{await a.removeCrawlerCheckpoint(i)}catch(e){console.log("EventIndex: Error removing checkpoint",i,e)}continue}console.log("EventIndex: Error crawling using checkpoint:",i,",",e),this.crawlerCheckpoints.push(i);continue}if(e){this.crawlerCheckpoints.push(i);break}if(0===r.chunk.length){console.log("EventIndex: Done with the checkpoint",i);try{await a.removeCrawlerCheckpoint(i)}catch(e){console.log("EventIndex: Error removing checkpoint",i,e)}continue}const l=r.chunk.map(o);let m=[];void 0!==r.state&&(m=r.state.map(o));const h={};m.forEach(e=>{e.event.content&&"join"===e.event.content.membership&&(h[e.event.sender]={displayname:e.event.content.displayname,avatar_url:e.event.content.avatar_url})});const p=l.filter(e=>e.isEncrypted()).map(e=>t.decryptEventIfNeeded(e,{isRetry:!0,emit:!1}));await Promise.all(p);const g=l.filter(this.isValidEvent),f=l.filter(e=>"m.room.redaction"===e.getType()),v=g.map(e=>{const t=this.eventToJson(e);let a={};t.sender in h&&(a=h[t.sender]);return{event:t,profile:a}});let b;r.end&&(b={roomId:i.roomId,token:r.end,fullCrawl:i.fullCrawl,direction:i.direction});try{for(let e=0;e<f.length;e++){const t=f[e],n=t.getAssociatedId();n?await a.deleteEvent(n):console.warn("EventIndex: Redaction event doesn't contain a valid associated event id",t)}const e=await a.addHistoricEvents(v,b,i);if(!b){console.log("EventIndex: The server didn't return a valid ","new checkpoint, not continuing the crawl.",i);continue}!0===e&&!0!==b.fullCrawl?(console.log("EventIndex: Checkpoint had already all events","added, stopping the crawl",i),await a.removeCrawlerCheckpoint(b)):(!0===e&&console.log("EventIndex: Checkpoint had already all events","added, but continuing due to a full crawl",i),this.crawlerCheckpoints.push(b))}catch(e){console.log("EventIndex: Error durring a crawl",e),this.crawlerCheckpoints.push(i)}}this._crawler=null}startCrawler(){null===this._crawler&&this.crawlerFunc()}stopCrawler(){null!==this._crawler&&this._crawler.cancel()}async close(){const e=i.a.get().getEventIndexingManager();this.removeListeners(),this.stopCrawler(),await e.closeEventIndex()}async search(e){return i.a.get().getEventIndexingManager().searchEventIndex(e)}async loadFileEvents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.a.BACKWARDS;const s=o.a.get(),c=i.a.get().getEventIndexingManager(),d={roomId:e.roomId,limit:t};let m;a&&(d.fromEvent=a,d.direction=n);try{m=await c.loadFileEvents(d)}catch(e){return console.log("EventIndex: Error getting file events",e),[]}const u=s.getEventMapper();return m.map(t=>{const a=u(t.event),n=new r.a(e.roomId,a.getSender());n.name=t.profile.displayname+" ("+a.getSender()+")";const s=u({content:{membership:"join",avatar_url:t.profile.avatar_url,displayname:t.profile.displayname},type:"m.room.member",event_id:a.getId()+":eventIndex",room_id:a.getRoomId(),sender:a.getSender(),origin_server_ts:a.getTs(),state_key:a.getSender()});return n.events.member=s,a.sender=n,a})}async populateFileTimeline(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:l.a.BACKWARDS;const o=await this.loadFileEvents(a,n,s,i);null===s&&(o.reverse(),i=i==l.a.BACKWARDS?l.a.FORWARDS:l.a.BACKWARDS),o.forEach(a=>{e.eventIdToTimeline(a.getId())||e.addEventToTimeline(a,t,i==l.a.BACKWARDS)});let r=!1,c="";return o.length>0&&(c=o[o.length-1].getId(),r=!0),console.log("EventIndex: Populating file panel with",o.length,"events and setting the pagination token to",c),t.setPaginationToken(c,l.a.BACKWARDS),r}paginateTimelineWindow(e,t,a,n){const s=t.getTimelineIndex(a);if(!s)return Promise.resolve(!1);if(s.pendingPaginate)return s.pendingPaginate;if(t.extend(a,n))return Promise.resolve(!0);const i=(async(e,t,a,n,s)=>{const i=e._timelineSet,o=t.timeline.getPaginationToken(n),r=await this.populateFileTimeline(i,t.timeline,a,s,o,n);return t.pendingPaginate=null,e.extend(n,s),r})(t,s,e,a,n);return s.pendingPaginate=i,i}async getStats(){return i.a.get().getEventIndexingManager().getStats()}async isRoomIndexed(e){return i.a.get().getEventIndexingManager().isRoomIndexed(e)}currentRoom(){if(null===this._currentCheckpoint&&0===this.crawlerCheckpoints.length)return null;const e=o.a.get();return null!==this._currentCheckpoint?e.getRoom(this._currentCheckpoint.roomId):e.getRoom(this.crawlerCheckpoints[0].roomId)}crawlingRooms(){const e=new Set,t=new Set;this.crawlerCheckpoints.forEach((e,a)=>{t.add(e.roomId)}),null!==this._currentCheckpoint&&t.add(this._currentCheckpoint.roomId);const a=o.a.get();return a.getRooms().filter(e=>a.isRoomEncrypted(e.roomId)).forEach((t,a)=>{e.add(t.roomId)}),{crawlingRooms:t,totalRooms:e}}}class p{constructor(){s()(this,"index",null),s()(this,"error",null),s()(this,"_supportIsInstalled",!1)}async init(){const e=i.a.get().getEventIndexingManager();return e?(this._supportIsInstalled=await e.supportsEventIndexing(),this.supportIsInstalled()?d.b.getValueAt(u.a.DEVICE,"enableEventIndexing")?this.initEventIndex():(console.log("EventIndex: Event indexing is disabled, not initializing"),!1):(console.log("EventIndex: Event indexing isn't installed for the platform, not initializing."),!1)):(console.log("EventIndex: Platform doesn't support event indexing, not initializing."),!1)}async initEventIndex(){const e=new h,t=i.a.get().getEventIndexingManager(),a=o.a.get(),n=a.getUserId(),s=a.getDeviceId();try{await t.initEventIndex(n,s);const a=await t.getUserVersion(),i=await t.isEventIndexEmpty();i?await t.setUserVersion(1):0!==a||i||(await t.closeEventIndex(),await this.deleteEventIndex(),await t.initEventIndex(n,s),await t.setUserVersion(1)),console.log("EventIndex: Successfully initialized the event index"),await e.init()}catch(e){return console.log("EventIndex: Error initializing the event index",e),this.error=e,!1}return this.index=e,!0}platformHasSupport(){return null!==i.a.get().getEventIndexingManager()}supportIsInstalled(){return this._supportIsInstalled}get(){return this.index}start(){null!==this.index&&this.index.startCrawler()}stop(){null!==this.index&&this.index.stopCrawler()}async unset(){null!==this.index&&(await this.index.close(),this.index=null)}async deleteEventIndex(){const e=i.a.get().getEventIndexingManager();null!==e&&(await this.unset(),console.log("EventIndex: Deleting event index."),await e.deleteEventIndex())}}window.mxEventIndexPeg||(window.mxEventIndexPeg=new p);t.a=window.mxEventIndexPeg},384:function(e,t,a){"use strict";a.d(t,"a",(function(){return Y})),a.d(t,"b",(function(){return le}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(140),l=a(119),c=a(167),d=a(93),m=a(108),u=a(250),h=a(495),p=a(251),g=a(205),f=a(803),v=a(214),b=a(144),y=a(193),E=a(252),_=a(328),S=a(100),C=a(115),w=a(424),O=a(499),x=a(425),R=a(337),k=a(183);const I=(e,t)=>{const[a,n]=Object(i.useState)(()=>Array.isArray(t)?t:new Array(e).fill(t));return[a,(e,t)=>n(a=>{const n=[...a];return n[e]=t,n})]};var T,P=a(837),N=a(334),D=a(1419),j=a(278),A=a(839),M=a(175),U=a(1420),L=a(840),F=a(127),B=a(202),V=a(135),G=a(505),z=a(341),W=a(103),H=a(106),K=a(832),q=a(110);!function(e){e[e.Landing=0]="Landing",e[e.PublicCreateRooms=1]="PublicCreateRooms",e[e.PublicShare=2]="PublicShare",e[e.PrivateScope=3]="PrivateScope",e[e.PrivateInvite=4]="PrivateInvite",e[e.PrivateCreateRooms=5]="PrivateCreateRooms",e[e.PrivateExistingRooms=6]="PrivateExistingRooms"}(T||(T={}));const Y=e=>{let{onClick:t}=e;return q.a.get().bug_report_endpoint_url?o.a.createElement("div",{className:"mx_SpaceFeedbackPrompt"},o.a.createElement("hr",null),o.a.createElement("div",null,o.a.createElement("span",{className:"mx_SpaceFeedbackPrompt_text"},Object(d.a)("Spaces are a beta feature.")),o.a.createElement(m.a,{kind:"link",onClick:()=>{t&&t(),H.a.createTrackedDialog("Beta Feedback","feature_spaces",K.a,{featureId:"feature_spaces"})}},Object(d.a)("Feedback")))):null},$=e=>{let{room:t,children:a}=e;const n=Object(f.b)(t).length;return a?a(n):n},J=e=>{const[t,a]=Object(i.useState)(e.getMyMembership());return Object(y.a)(e,"Room.myMembership",()=>{a(e.getMyMembership())}),t},Q=e=>{let{space:t}=e;const a=t.getJoinRule();let n;return n="public"===a?o.a.createElement("span",{className:"mx_SpaceRoomView_info_public"},Object(d.a)("Public space")):o.a.createElement("span",{className:"mx_SpaceRoomView_info_private"},Object(d.a)("Private space")),o.a.createElement("div",{className:"mx_SpaceRoomView_info"},n,"public"===a&&o.a.createElement($,{room:t},e=>e>0?o.a.createElement(m.a,{kind:"link",onClick:()=>{S.a.dispatch({action:C.a.SetRightPanelPhase,phase:k.c.RoomMemberList,refireParams:{space:t}})}},Object(d.a)("%(count)s members",{count:e})):null))},X=()=>{S.a.dispatch({action:C.a.ViewUserSettings,initialTabId:z.a})},Z=e=>{let{space:t,onJoinButtonClicked:a,onRejectButtonClicked:n}=e;const s=Object(i.useContext)(l.a),r=J(t),[g,f]=Object(i.useState)(!1),v=W.b.getValue("feature_spaces");let b,y;if("join"===r)y=o.a.createElement(m.a,{kind:"danger_outline",onClick:()=>{S.a.dispatch({action:"leave_room",room_id:t.roomId})}},Object(d.a)("Leave"));else if("invite"===r){var E,_;const e=null===(E=t.getMember(s.getUserId()))||void 0===E||null===(_=E.events.member)||void 0===_?void 0:_.getSender(),i=e&&t.getMember(e);e&&(b=o.a.createElement("div",{className:"mx_SpaceRoomView_preview_inviter"},o.a.createElement(j.a,{member:i,width:32,height:32}),o.a.createElement("div",null,o.a.createElement("div",{className:"mx_SpaceRoomView_preview_inviter_name"},Object(d.a)("<inviter/> invites you",{},{inviter:()=>o.a.createElement("b",null,i.name||e)})),i?o.a.createElement("div",{className:"mx_SpaceRoomView_preview_inviter_mxid"},e):null))),y=o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,{kind:"secondary",onClick:()=>{f(!0),n()}},Object(d.a)("Reject")),o.a.createElement(m.a,{kind:"primary",onClick:()=>{f(!0),a()},disabled:!v},Object(d.a)("Accept")))}else y=o.a.createElement(m.a,{kind:"primary",onClick:()=>{f(!0),a()},disabled:!v},Object(d.a)("Join"));return g&&(y=o.a.createElement(p.a,null)),o.a.createElement("div",{className:"mx_SpaceRoomView_preview"},o.a.createElement(G.a,{onClick:X}),b,o.a.createElement(c.a,{room:t,height:80,width:80,viewAvatarOnClick:!0}),o.a.createElement("h1",{className:"mx_SpaceRoomView_preview_name"},o.a.createElement(u.a,{room:t})),o.a.createElement(Q,{space:t}),o.a.createElement(h.a,{room:t},(e,t)=>o.a.createElement("div",{className:"mx_SpaceRoomView_preview_topic",ref:t},e)),"public"===t.getJoinRule()&&o.a.createElement(U.a,{room:t}),o.a.createElement("div",{className:"mx_SpaceRoomView_preview_joinButtons"},y),!v&&o.a.createElement("div",{className:"mx_SpaceRoomView_preview_spaceBetaPrompt"},"join"===r?Object(d.a)("To view %(spaceName)s, turn on the <a>Spaces beta</a>",{spaceName:t.name},{a:e=>o.a.createElement(m.a,{onClick:X,kind:"link"},e)}):Object(d.a)("To join %(spaceName)s, turn on the <a>Spaces beta</a>",{spaceName:t.name},{a:e=>o.a.createElement(m.a,{onClick:X,kind:"link"},e)})))},ee=e=>{let{space:t,onNewRoomAdded:a}=e;const n=Object(i.useContext)(l.a),[s,r,c,m]=Object(F.q)();let u;if(s){const e=r.current.getBoundingClientRect();u=o.a.createElement(B.e,{left:e.left+window.pageXOffset+0,top:e.bottom+window.pageYOffset+8,chevronFace:F.a.None,onFinished:m,className:"mx_RoomTile_contextMenu",compact:!0},o.a.createElement(B.c,{first:!0},o.a.createElement(B.b,{label:Object(d.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:async e=>{e.preventDefault(),e.stopPropagation(),m(),await Object(N.d)(n,t)&&a()}}),o.a.createElement(B.b,{label:Object(d.a)("Add existing room"),iconClassName:"mx_RoomList_iconHash",onClick:async e=>{e.preventDefault(),e.stopPropagation(),m();const[s]=await Object(N.c)(n,t);s&&a()}})))}return o.a.createElement(o.a.Fragment,null,o.a.createElement(F.c,{kind:"primary",inputRef:r,onClick:c,isExpanded:s,label:Object(d.a)("Add")},Object(d.a)("Add")),u)},te=e=>{let{space:t}=e;const a=Object(i.useContext)(l.a),n=J(t),s=a.getUserId();let p;"join"===n&&t.canInvite(s)&&(p=o.a.createElement(m.a,{kind:"primary",className:"mx_SpaceRoomView_landing_inviteButton",onClick:()=>{Object(g.g)(t.roomId)}},Object(d.a)("Invite")));const f="join"===n&&t.currentState.maySendStateEvent(r.a.SpaceChild,s),[v,b]=Object(A.a)(!1);let y,E;f&&(y=o.a.createElement(ee,{space:t,onNewRoomAdded:b})),Object(N.b)(a,t)&&(E=o.a.createElement(V.a,{className:"mx_SpaceRoomView_landing_settingsButton",onClick:()=>{Object(N.f)(a,t)},title:Object(d.a)("Settings")}));return o.a.createElement("div",{className:"mx_SpaceRoomView_landing"},o.a.createElement(c.a,{room:t,height:80,width:80,viewAvatarOnClick:!0}),o.a.createElement("div",{className:"mx_SpaceRoomView_landing_name"},o.a.createElement(u.a,{room:t},e=>{const t={name:()=>o.a.createElement("div",{className:"mx_SpaceRoomView_landing_nameRow"},o.a.createElement("h1",null,e))};return Object(d.a)("Welcome to <name/>",{},t)})),o.a.createElement("div",{className:"mx_SpaceRoomView_landing_info"},o.a.createElement(Q,{space:t}),o.a.createElement(U.a,{room:t,onlyKnownUsers:!1,numShown:7,onClick:()=>{S.a.dispatch({action:C.a.SetRightPanelPhase,phase:k.c.RoomMemberList,refireParams:{space:t}})}}),p,E),o.a.createElement(h.a,{room:t},(e,t)=>o.a.createElement("div",{className:"mx_SpaceRoomView_landing_topic",ref:t},e)),o.a.createElement(Y,null),o.a.createElement("hr",null),o.a.createElement(D.a,{space:t,showRoom:D.c,refreshToken:v,additionalButtons:y}))},ae=e=>{let{space:t,title:a,description:n,onFinished:s}=e;const[r,l]=Object(i.useState)(!1),[c,u]=Object(i.useState)(""),h=[Object(d.a)("General"),Object(d.a)("Random"),Object(d.a)("Support")],[p,g]=I(3,[Object(d.a)("General"),Object(d.a)("Random"),""]),f=new Array(3).fill(0).map((e,t)=>{const a="roomName"+t;return o.a.createElement(b.a,{key:a,name:a,type:"text",label:Object(d.a)("Room name"),placeholder:h[t],value:p[t],onChange:e=>g(t,e.target.value),autoFocus:2===t,disabled:r})}),y=async e=>{if(e.preventDefault(),!r){u(""),l(!0);try{const e=p.map(e=>e.trim()).filter(Boolean);await Promise.all(e.map(e=>Object(v.d)({createOpts:{preset:"public"===t.getJoinRule()?v.a.PublicChat:v.a.PrivateChat,name:e},spinner:!1,encryption:!1,andView:!1,inlineErrors:!0,parentSpace:t}))),s(e.length>0)}catch(e){console.error("Failed to create initial space rooms",e),u(Object(d.a)("Failed to create initial space rooms"))}l(!1)}};let E=e=>{e.preventDefault(),s(!1)},_=Object(d.a)("Skip for now");return p.some(e=>e.trim())&&(E=y,_=r?Object(d.a)("Creating rooms..."):Object(d.a)("Continue")),o.a.createElement("div",null,o.a.createElement("h1",null,a),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},n),c&&o.a.createElement("div",{className:"mx_SpaceRoomView_errorText"},c),o.a.createElement("form",{onSubmit:E,id:"mx_SpaceSetupFirstRooms"},f),o.a.createElement("div",{className:"mx_SpaceRoomView_buttons"},o.a.createElement(m.a,{kind:"primary",disabled:r,onClick:E,element:"input",type:"submit",form:"mx_SpaceSetupFirstRooms",value:_})),o.a.createElement(Y,null))},ne=e=>{let{space:t,onFinished:a}=e;return o.a.createElement("div",null,o.a.createElement("h1",null,Object(d.a)("What do you want to organise?")),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(d.a)("Pick rooms or conversations to add. This is just a space for you, no one will be informed. You can add more later.")),o.a.createElement(L.a,{space:t,emptySelectionButton:o.a.createElement(m.a,{kind:"primary",onClick:a},Object(d.a)("Skip for now")),onFinished:a}),o.a.createElement("div",{className:"mx_SpaceRoomView_buttons"}),o.a.createElement(Y,null))},se=e=>{var t;let{justCreatedOpts:a,space:n,onFinished:s,createdRooms:i}=e;return o.a.createElement("div",{className:"mx_SpaceRoomView_publicShare"},o.a.createElement("h1",null,Object(d.a)("Share %(name)s",{name:(null==a||null===(t=a.createOpts)||void 0===t?void 0:t.name)||n.name})),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(d.a)("It's just you at the moment, it will be even better with others.")),o.a.createElement(P.a,{space:n}),o.a.createElement("div",{className:"mx_SpaceRoomView_buttons"},o.a.createElement(m.a,{kind:"primary",onClick:s},i?Object(d.a)("Go to my first room"):Object(d.a)("Go to my space"))),o.a.createElement(Y,null))},ie=e=>{var t;let{space:a,justCreatedOpts:n,onFinished:s}=e;return o.a.createElement("div",{className:"mx_SpaceRoomView_privateScope"},o.a.createElement("h1",null,Object(d.a)("Who are you working with?")),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(d.a)("Make sure the right people have access to %(name)s",{name:(null==n||null===(t=n.createOpts)||void 0===t?void 0:t.name)||a.name})),o.a.createElement(m.a,{className:"mx_SpaceRoomView_privateScope_justMeButton",onClick:()=>{s(!1)}},o.a.createElement("h3",null,Object(d.a)("Just me")),o.a.createElement("div",null,Object(d.a)("A private space to organise your rooms"))),o.a.createElement(m.a,{className:"mx_SpaceRoomView_privateScope_meAndMyTeammatesButton",onClick:()=>{s(!0)}},o.a.createElement("h3",null,Object(d.a)("Me and my teammates")),o.a.createElement("div",null,Object(d.a)("A private space for you and your teammates"))),o.a.createElement(Y,null))},oe=Object(E.a)({rules:[{key:"email",test:e=>{let{value:t}=e;return!t||_.a(t)},invalid:()=>Object(d.a)("Doesn't look like a valid email address")}]}),re=e=>{let{space:t,onFinished:a}=e;const[n,s]=Object(i.useState)(!1),[r,l]=Object(i.useState)(""),c=[Object(i.useRef)(),Object(i.useRef)(),Object(i.useRef)()],[u,h]=I(3,""),p=new Array(3).fill(0).map((e,t)=>{const a="emailAddress"+t;return o.a.createElement(b.a,{key:a,name:a,type:"text",label:Object(d.a)("Email address"),placeholder:Object(d.a)("Email"),value:u[t],onChange:e=>h(t,e.target.value),ref:c[t],onValidate:oe,autoFocus:0===t,disabled:n})}),f=async e=>{if(e.preventDefault(),n)return;l("");for(let e=0;e<c.length;e++){const t=c[e];if(!1===await t.current.validate({allowEmpty:!0}))return t.current.focus(),void t.current.validate({allowEmpty:!0,focused:!0})}s(!0);const i=u.map(e=>e.trim()).filter(Boolean);try{const e=await Object(g.a)(t.roomId,i),n=Object.keys(e.states).filter(t=>"error"===e.states[t]);n.length>0?(console.log("Failed to invite users to space: ",e),l(Object(d.a)("Failed to invite the following users to your space: %(csvUsers)s",{csvUsers:n.join(", ")}))):a()}catch(e){console.error("Failed to invite users to space: ",e),l(Object(d.a)("We couldn't invite those users. Please check the users you want to invite and try again."))}s(!1)};let v=e=>{e.preventDefault(),a()},y=Object(d.a)("Skip for now");return u.some(e=>e.trim())&&(v=f,y=n?Object(d.a)("Inviting..."):Object(d.a)("Continue")),o.a.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates"},o.a.createElement("h1",null,Object(d.a)("Invite your teammates")),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(d.a)("Make sure the right people have access. You can invite more later.")),o.a.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates_betaDisclaimer"},o.a.createElement(G.a,{onClick:X}),Object(d.a)("<b>This is an experimental feature.</b> For now, new users receiving an invite will have to open the invite on <link/> to actually join.",{},{b:e=>o.a.createElement("b",null,e),link:()=>o.a.createElement("a",{href:"https://app.element.io/",rel:"noreferrer noopener",target:"_blank"},"app.element.io")})),r&&o.a.createElement("div",{className:"mx_SpaceRoomView_errorText"},r),o.a.createElement("form",{onSubmit:v,id:"mx_SpaceSetupPrivateInvite"},p),o.a.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates_buttons"},o.a.createElement(m.a,{className:"mx_SpaceRoomView_inviteTeammates_inviteDialogButton",onClick:()=>Object(g.g)(t.roomId)},Object(d.a)("Invite by username"))),o.a.createElement("div",{className:"mx_SpaceRoomView_buttons"},o.a.createElement(m.a,{kind:"primary",disabled:n,onClick:v,element:"input",type:"submit",form:"mx_SpaceSetupPrivateInvite",value:y})),o.a.createElement(Y,null))};class le extends o.a.PureComponent{constructor(e,t){var a;super(e,t),s()(this,"creator",void 0),s()(this,"dispatcherRef",void 0),s()(this,"rightPanelStoreToken",void 0),s()(this,"onMyMembership",(e,t)=>{e.roomId===this.props.space.roomId&&this.setState({myMembership:t})}),s()(this,"onRightPanelStoreUpdate",()=>{this.setState({showRightPanel:R.a.getSharedInstance().isOpenForRoom})}),s()(this,"onAction",e=>{e.action!==C.a.ViewUser&&"view_3pid_invite"!==e.action||(e.action===C.a.ViewUser&&e.member?S.a.dispatch({action:C.a.SetRightPanelPhase,phase:k.c.SpaceMemberInfo,refireParams:{space:this.props.space,member:e.member}}):"view_3pid_invite"===e.action&&e.event?S.a.dispatch({action:C.a.SetRightPanelPhase,phase:k.c.Space3pidMemberInfo,refireParams:{space:this.props.space,event:e.event}}):S.a.dispatch({action:C.a.SetRightPanelPhase,phase:k.c.SpaceMemberList,refireParams:{space:this.props.space}}))}),s()(this,"goToFirstRoom",async()=>{const e=M.e.instance.getChildRooms(this.props.space.roomId);if(e.length){const t=e[0];return void S.a.dispatch({action:"view_room",room_id:t.roomId})}let t=M.e.instance.suggestedRooms;if(M.e.instance.activeSpace!==this.props.space&&(t=await M.e.instance.fetchSuggestedRooms(this.props.space,1)),t.length){var a,n;const e=t[0];S.a.dispatch({action:"view_room",room_id:e.room_id,room_alias:e.canonical_alias||(null===(a=e.aliases)||void 0===a?void 0:a[0]),via_servers:e.viaServers,oobData:{avatarUrl:e.avatar_url,name:e.name||e.canonical_alias||(null===(n=e.aliases)||void 0===n?void 0:n[0])||Object(d.a)("Empty room")}})}else this.setState({phase:T.Landing})});let n=T.Landing;this.creator=null===(a=this.props.space.currentState.getStateEvents(r.a.RoomCreate,""))||void 0===a?void 0:a.getSender();this.props.justCreatedOpts&&this.context.getUserId()===this.creator&&(n=this.props.justCreatedOpts.createOpts.preset===v.a.PublicChat?T.PublicCreateRooms:T.PrivateScope),this.state={phase:n,showRightPanel:R.a.getSharedInstance().isOpenForRoom,myMembership:this.props.space.getMyMembership()},this.dispatcherRef=S.a.register(this.onAction),this.rightPanelStoreToken=R.a.getSharedInstance().addListener(this.onRightPanelStoreUpdate),this.context.on("Room.myMembership",this.onMyMembership)}componentWillUnmount(){S.a.unregister(this.dispatcherRef),this.rightPanelStoreToken.remove(),this.context.off("Room.myMembership",this.onMyMembership)}renderBody(){var e,t;switch(this.state.phase){case T.Landing:return"join"===this.state.myMembership&&W.b.getValue("feature_spaces")?o.a.createElement(te,{space:this.props.space}):o.a.createElement(Z,{space:this.props.space,onJoinButtonClicked:this.props.onJoinButtonClicked,onRejectButtonClicked:this.props.onRejectButtonClicked});case T.PublicCreateRooms:return o.a.createElement(ae,{space:this.props.space,title:Object(d.a)("What are some things you want to discuss in %(spaceName)s?",{spaceName:(null===(e=this.props.justCreatedOpts)||void 0===e||null===(t=e.createOpts)||void 0===t?void 0:t.name)||this.props.space.name}),description:Object(d.a)("Let's create a room for each of them.")+"\n"+Object(d.a)("You can add more later too, including already existing ones."),onFinished:e=>this.setState({phase:T.PublicShare,createdRooms:e})});case T.PublicShare:return o.a.createElement(se,{justCreatedOpts:this.props.justCreatedOpts,space:this.props.space,onFinished:this.goToFirstRoom,createdRooms:this.state.createdRooms});case T.PrivateScope:return o.a.createElement(ie,{space:this.props.space,justCreatedOpts:this.props.justCreatedOpts,onFinished:e=>{this.setState({phase:e?T.PrivateInvite:T.PrivateExistingRooms})}});case T.PrivateInvite:return o.a.createElement(re,{space:this.props.space,onFinished:()=>this.setState({phase:T.PrivateCreateRooms})});case T.PrivateCreateRooms:return o.a.createElement(ae,{space:this.props.space,title:Object(d.a)("What projects are you working on?"),description:Object(d.a)("We'll create rooms for each of them. You can add more later too, including already existing ones."),onFinished:e=>this.setState({phase:T.Landing,createdRooms:e})});case T.PrivateExistingRooms:return o.a.createElement(ne,{space:this.props.space,onFinished:()=>this.setState({phase:T.Landing})})}}render(){const e=this.state.showRightPanel&&this.state.phase===T.Landing?o.a.createElement(x.a,{room:this.props.space,resizeNotifier:this.props.resizeNotifier}):null;return o.a.createElement("main",{className:"mx_SpaceRoomView"},o.a.createElement(O.a,null,o.a.createElement(w.a,{panel:e,resizeNotifier:this.props.resizeNotifier},this.renderBody())))}}s()(le,"contextType",l.a)},385:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));class n{}},412:function(e,t,a){"use strict";(function(e){var n=a(19),s=a.n(n),i=a(100),o=a(8),r=a.n(o),l=a(150),c=a(103),d=a(174),m=a(184),u=a(161),h=a(166);function p(e,t){const a=Math.min(e.length,t.length);let n;for(let s=0;s<a;++s)if(e.charAt(s)!==t.charAt(s)){n=e.substr(0,s);break}void 0===n&&(n=e.substr(0,a));const s=n.indexOf(" ");return-1!==s&&(n=n.substr(0,s+1)),n.length>=2?n:""}class g extends r.a{constructor(){super(),s()(this,"_onListsUpdated",()=>{const e=this._getUpdatedTags();this._state.tags&&!Object(h.c)(this._state.tags,e)||this._setState({tags:e})}),this._state={tags:{}},this._getUpdatedTags=Object(l.throttle)(this._getUpdatedTags,500,{leading:!0,trailing:!0}),d.b.instance.on(d.a,this._onListsUpdated),i.a.register(e=>this._onDispatch(e))}getTags(){return this._state.tags}_setState(e){this._state=Object.assign(this._state,e),this.emit("change")}addListener(e){return this.on("change",e),{remove:()=>{this.removeListener("change",e)}}}getSortedTags(){const e=Object.keys(this._state.tags).sort(),t=e.map((t,a)=>{const n=0===a,s=a===e.length-1,i=n?"":p(t,e[a-1]),o=s?"":p(t,e[a+1]);return i.length>o.length?i:o});return e.map((e,a)=>{const n=m.a.instance.getListState(e);let s;n.hasUnreadCount&&(s=n);const i=e.substr(t[a].length,1);return{name:e,avatarLetter:i,badgeNotifState:s,selected:this._state.tags[e]}})}_onDispatch(e){switch(e.action){case"select_custom_room_tag":{const t=this._state.tags;if(t.hasOwnProperty(e.tag)){const a={};a[e.tag]=!t[e.tag];const n=Object.assign({},t,a);this._setState({tags:n})}break}case"on_client_not_viable":case"on_logged_out":this._state={tags:{}},d.b.instance.off(d.a,this._onListsUpdated)}}_getUpdatedTags(){if(!c.b.getValue("feature_custom_tags"))return{};const e=Object.keys(d.b.instance.orderedLists).filter(e=>Object(u.d)(e)).sort(),t=this._state&&this._state.tags;return e.reduce((e,a)=>(e[a]=t&&t[a]||!1,e),{})}}void 0===e.singletonCustomRoomTagStore&&(e.singletonCustomRoomTagStore=new g),t.a=e.singletonCustomRoomTagStore}).call(this,a(7))},413:function(e,t,a){"use strict";a.d(t,"a",(function(){return k}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(97),d=a(93),m=a(92),u=a.n(m),h=a(100),p=a(222),g=a(146),f=a(155),v=a(103),b=a(245),y=a(2311),E=a.n(y),_=a(119),S=a(115),C=a(575),w=a.n(C),O=a(147),x=a(201),R=a(94);let k=Object(R.a)("views.elements.ReplyThread")((s=class e extends l.a.Component{constructor(e,t){super(e,t),o()(this,"updateForEventId",e=>{this.state.events.some(t=>t.getId()===e)&&this.forceUpdate()}),o()(this,"onEventReplaced",e=>{this.unmounted||this.updateForEventId(e.getId())}),o()(this,"onRoomRedaction",e=>{if(this.unmounted)return;const t=e.getAssociatedId();t&&this.updateForEventId(t)}),this.state={events:[],loadedEv:null,loading:!0,err:!1},this.unmounted=!1,this.context.on("Event.replaced",this.onEventReplaced),this.room=this.context.getRoom(this.props.parentEv.getRoomId()),this.room.on("Room.redaction",this.onRoomRedaction),this.room.on("Room.redactionCancelled",this.onRoomRedaction),this.onQuoteClick=this.onQuoteClick.bind(this),this.canCollapse=this.canCollapse.bind(this),this.collapse=this.collapse.bind(this)}static getParentEventId(e){if(!e||e.isRedacted())return;const t=e.getWireContent()["m.relates_to"];if(t&&t["m.in_reply_to"]){const e=t["m.in_reply_to"];if(e&&e.event_id)return e.event_id}}static stripPlainReply(e){const t=e.split("\n");for(;t.length&&t[0].startsWith("> ");)t.shift();return""===t[0]&&t.shift(),t.join("\n")}static stripHTMLReply(e){return w()(e,{allowedTags:!1,allowedAttributes:!1,allowedSchemes:[...x.a,"mxc"],exclusiveFilter:e=>"mx-reply"===e.tag})}static getNestedReplyText(e,t){if(!e)return null;let{body:a,formatted_body:n}=e.getContent();this.getParentEventId(e)&&a&&(a=this.stripPlainReply(a)),a||(a=""),n=n?this.stripHTMLReply(n):E()(a).replace(/\n/g,"<br/>");const s=t.forEvent(e.getId()),i=Object(f.h)(e.getSender()),o=e.getSender();switch(e.getContent().msgtype){case"m.text":case"m.notice":{n=`<mx-reply><blockquote><a href="${s}">In reply to</a> <a href="${i}">${o}</a><br>${n}</blockquote></mx-reply>`;const e=a.trim().split("\n");e.length>0&&(e[0]=`<${o}> ${e[0]}`,a=e.map(e=>"> "+e).join("\n")+"\n\n");break}case"m.image":n=`<mx-reply><blockquote><a href="${s}">In reply to</a> <a href="${i}">${o}</a><br>sent an image.</blockquote></mx-reply>`,a=`> <${o}> sent an image.\n\n`;break;case"m.video":n=`<mx-reply><blockquote><a href="${s}">In reply to</a> <a href="${i}">${o}</a><br>sent a video.</blockquote></mx-reply>`,a=`> <${o}> sent a video.\n\n`;break;case"m.audio":n=`<mx-reply><blockquote><a href="${s}">In reply to</a> <a href="${i}">${o}</a><br>sent an audio file.</blockquote></mx-reply>`,a=`> <${o}> sent an audio file.\n\n`;break;case"m.file":n=`<mx-reply><blockquote><a href="${s}">In reply to</a> <a href="${i}">${o}</a><br>sent a file.</blockquote></mx-reply>`,a=`> <${o}> sent a file.\n\n`;break;case"m.emote":{n=`<mx-reply><blockquote><a href="${s}">In reply to</a> * <a href="${i}">${o}</a><br>${n}</blockquote></mx-reply>`;const e=a.trim().split("\n");e.length>0&&(e[0]=`* <${o}> ${e[0]}`,a=e.map(e=>"> "+e).join("\n")+"\n\n");break}default:return null}return{body:a,html:n}}static makeReplyMixIn(e){return e?{"m.relates_to":{"m.in_reply_to":{event_id:e.getId()}}}:{}}static makeThread(t,a,n,s,i){return e.getParentEventId(t)?l.a.createElement(e,{parentEv:t,onHeightChanged:a,ref:s,permalinkCreator:n,layout:i}):null}componentDidMount(){this.initialize()}componentDidUpdate(){this.props.onHeightChanged()}componentWillUnmount(){this.unmounted=!0,this.context.removeListener("Event.replaced",this.onEventReplaced),this.room&&(this.room.removeListener("Room.redaction",this.onRoomRedaction),this.room.removeListener("Room.redactionCancelled",this.onRoomRedaction))}async initialize(){const{parentEv:t}=this.props,a=await this.getEvent(e.getParentEventId(t));if(!this.unmounted)if(a){const e=await this.getNextEvent(a);this.setState({events:[a],loadedEv:e,loading:!1})}else this.setState({err:!0})}async getNextEvent(t){try{const a=e.getParentEventId(t);return await this.getEvent(a)}catch(e){return null}}async getEvent(e){const t=this.room.findEventById(e);if(t)return t;try{await this.context.getEventTimeline(this.room.getUnfilteredTimelineSet(),e)}catch(e){return null}return this.room.findEventById(e)}canCollapse(){return this.state.events.length>1}collapse(){this.initialize()}async onQuoteClick(){const e=[this.state.loadedEv,...this.state.events];let t=null;e.length>0&&(t=await this.getNextEvent(e[0])),this.setState({loadedEv:t,events:e}),h.a.fire(S.a.FocusComposer)}render(){let e=null;if(this.state.err)e=l.a.createElement("blockquote",{className:"mx_ReplyThread mx_ReplyThread_error"},Object(d.a)("Unable to load event that was replied to, it either does not exist or you do not have permission to view it."));else if(this.state.loadedEv){const t=this.state.loadedEv,a=c.getComponent("elements.Pill"),n=this.context.getRoom(t.getRoomId());e=l.a.createElement("blockquote",{className:"mx_ReplyThread"},Object(d.a)("<a>In reply to</a> <pill>",{},{a:e=>l.a.createElement("a",{onClick:this.onQuoteClick,className:"mx_ReplyThread_show"},e),pill:l.a.createElement(a,{type:a.TYPE_USER_MENTION,room:n,url:Object(f.h)(t.getSender()),shouldShowPillAvatar:v.b.getValue("Pill.shouldShowPillAvatar")})}))}else if(this.state.loading){const t=c.getComponent("elements.Spinner");e=l.a.createElement(t,{w:16,h:16})}const t=c.getComponent("views.rooms.EventTile"),a=c.getComponent("messages.DateSeparator"),n=this.state.events.map(e=>{let n=null;return Object(p.f)(this.props.parentEv.getDate(),e.getDate())&&(n=l.a.createElement("a",{href:this.props.url},l.a.createElement(a,{ts:e.getTs()}))),l.a.createElement("blockquote",{className:"mx_ReplyThread",key:e.getId()},n,l.a.createElement(t,{mxEvent:e,tileShape:"reply",onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator,isRedacted:e.isRedacted(),isTwelveHour:v.b.getValue("showTwelveHourTimestamps"),layout:this.props.layout,enableFlair:v.b.getValue(O.a.Flair),replacingEventId:e.replacingEventId()}))});return l.a.createElement("div",{className:"mx_ReplyThread_wrapper"},l.a.createElement("div",null,e),l.a.createElement("div",null,n))}},o()(s,"propTypes",{parentEv:u.a.instanceOf(g.b),onHeightChanged:u.a.func.isRequired,permalinkCreator:u.a.instanceOf(f.a).isRequired,layout:b.b}),o()(s,"contextType",_.a),n=s))||n},416:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return o}));var n=a(223),s=a.n(n);function i(e){if(!e)return"";const t=s.a.parse(e);return t&&"/"===t.path?t.host:e}function o(e){if(!e)return"";let t=e;e.startsWith("https://")||(t="https://"+e);return null===s.a.parse(t).hostname?e:t}},417:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(1),s=a(8);function i(e){this.groupId=e,this.name=null,this.avatarUrl=null,this.myMembership=null,this.inviter=null}n.m(i,s.EventEmitter),i.prototype.setProfile=function(e,t){this.name===e&&this.avatarUrl===t||(this.name=e||this.groupId,this.avatarUrl=t,this.emit("Group.profile",this))},i.prototype.setMyMembership=function(e){this.myMembership!==e&&(this.myMembership=e,this.emit("Group.myMembership",this))},i.prototype.setInviter=function(e){this.inviter=e}},418:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(0),s=a(223);class i{static get ERROR_INVALID(){return"Invalid homeserver discovery response"}static get ERROR_GENERIC_FAILURE(){return"Failed to get autodiscovery configuration from server"}static get ERROR_INVALID_HS_BASE_URL(){return"Invalid base_url for m.homeserver"}static get ERROR_INVALID_HOMESERVER(){return"Homeserver URL does not appear to be a valid Matrix homeserver"}static get ERROR_INVALID_IS_BASE_URL(){return"Invalid base_url for m.identity_server"}static get ERROR_INVALID_IDENTITY_SERVER(){return"Identity server URL does not appear to be a valid identity server"}static get ERROR_INVALID_IS(){return"Invalid identity server discovery response"}static get ERROR_MISSING_WELLKNOWN(){return"No .well-known JSON file found"}static get ERROR_INVALID_JSON(){return"Invalid JSON"}static get ALL_ERRORS(){return[i.ERROR_INVALID,i.ERROR_GENERIC_FAILURE,i.ERROR_INVALID_HS_BASE_URL,i.ERROR_INVALID_HOMESERVER,i.ERROR_INVALID_IS_BASE_URL,i.ERROR_INVALID_IDENTITY_SERVER,i.ERROR_INVALID_IS,i.ERROR_MISSING_WELLKNOWN,i.ERROR_INVALID_JSON]}static get FAIL_ERROR(){return"FAIL_ERROR"}static get FAIL_PROMPT(){return"FAIL_PROMPT"}static get PROMPT(){return"PROMPT"}static get SUCCESS(){return"SUCCESS"}static async fromDiscoveryConfig(e){const t={"m.homeserver":{state:i.FAIL_ERROR,error:i.ERROR_INVALID,base_url:null},"m.identity_server":{state:i.PROMPT,error:null,base_url:null}};if(!e||!e["m.homeserver"])return n.a.error("No m.homeserver key in config"),t["m.homeserver"].state=i.FAIL_PROMPT,t["m.homeserver"].error=i.ERROR_INVALID,Promise.resolve(t);if(!e["m.homeserver"].base_url)return n.a.error("No m.homeserver base_url in config"),t["m.homeserver"].state=i.FAIL_PROMPT,t["m.homeserver"].error=i.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const a=this._sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!a)return n.a.error("Invalid base_url for m.homeserver"),t["m.homeserver"].error=i.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const s=await this._fetchWellKnownObject(a+"/_matrix/client/versions");if(!s||!s.raw.versions)return n.a.error("Invalid /versions response"),t["m.homeserver"].error=i.ERROR_INVALID_HOMESERVER,t["m.homeserver"].base_url=a,Promise.resolve(t);t["m.homeserver"]={state:i.SUCCESS,error:null,base_url:a};let o="";if(e["m.identity_server"]){const a={"m.homeserver":t["m.homeserver"],"m.identity_server":{state:i.FAIL_PROMPT,error:i.ERROR_INVALID_IS,base_url:null}};if(o=this._sanitizeWellKnownUrl(e["m.identity_server"].base_url),!o)return n.a.error("Invalid base_url for m.identity_server"),a["m.identity_server"].error=i.ERROR_INVALID_IS_BASE_URL,Promise.resolve(a);const s=await this._fetchWellKnownObject(o+"/_matrix/identity/api/v1");if(!s||!s.raw||"SUCCESS"!==s.action)return n.a.error("Invalid /api/v1 response"),a["m.identity_server"].error=i.ERROR_INVALID_IDENTITY_SERVER,a["m.identity_server"].base_url=o,Promise.resolve(a)}return o&&o.length>0&&(t["m.identity_server"]={state:i.SUCCESS,error:null,base_url:o}),Object.keys(e).map(a=>{if("m.homeserver"===a||"m.identity_server"===a){const n=["error","state","base_url"];for(const s of Object.keys(e[a]))n.includes(s)||(t[a][s]=e[a][s])}else t[a]=e[a]}),Promise.resolve(t)}static async findClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t={"m.homeserver":{state:i.FAIL_ERROR,error:i.ERROR_INVALID,base_url:null},"m.identity_server":{state:i.PROMPT,error:null,base_url:null}},a=await this._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return a&&"SUCCESS"===a.action?i.fromDiscoveryConfig(a.raw):(n.a.error("No response or error when parsing .well-known"),a.reason&&n.a.error(a.reason),"IGNORE"===a.action?t["m.homeserver"]={state:i.PROMPT,error:null,base_url:null}:(t["m.homeserver"].state=i.FAIL_PROMPT,t["m.homeserver"].error=i.ERROR_INVALID),Promise.resolve(t))}static async getRawClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t=await this._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return t&&t.raw||{}}static _sanitizeWellKnownUrl(e){if(!e)return!1;try{let t=null;try{t=s.URL?new s.URL(e):new URL(e)}catch(a){t=new URL(e)}if(!t||!t.hostname)return!1;if("http:"!==t.protocol&&"https:"!==t.protocol)return!1;const a=t.port?":"+t.port:"",n=t.pathname?t.pathname:"";let i=`${t.protocol}//${t.hostname}${a}${n}`;return i.endsWith("/")&&(i=i.substring(0,i.length-1)),i}catch(e){return n.a.error(e),!1}}static async _fetchWellKnownObject(e){return new Promise((function(t,n){const s=a(225).getRequest();if(!s)throw new Error("No request library available");s({method:"GET",uri:e,timeout:5e3},(e,a,n)=>{if(e||a&&(a.statusCode<200||a.statusCode>=300)){let n="FAIL_PROMPT",s=(e?e.message:null)||"General failure";return a&&404===a.statusCode&&(n="IGNORE",s=i.ERROR_MISSING_WELLKNOWN),void t({raw:{},action:n,reason:s,error:e})}try{t({raw:JSON.parse(n),action:"SUCCESS"})}catch(e){let a=i.ERROR_INVALID;"SyntaxError"===e.name&&(a=i.ERROR_INVALID_JSON),t({raw:{},action:"FAIL_PROMPT",reason:a,error:e})}})}))}}},419:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i})),a.d(t,"d",(function(){return o})),a.d(t,"c",(function(){return l}));var n=a(99);function s(){const e=n.a.get().getClientWellKnown();return null==e?void 0:e["io.element.call_behaviour"]}function i(){const e=n.a.get().getClientWellKnown();return e&&e["io.element.e2ee"]?e["io.element.e2ee"]:e&&e["im.vector.riot.e2ee"]?e["im.vector.riot.e2ee"]:null}function o(){const e=i();return e&&!0===e.secure_backup_required}let r;function l(){const e=i();return e&&e.secure_backup_setup_methods&&e.secure_backup_setup_methods.length&&(e.secure_backup_setup_methods.includes(r.Key)||e.secure_backup_setup_methods.includes(r.Passphrase))?e.secure_backup_setup_methods:[r.Key,r.Passphrase]}!function(e){e.Key="key",e.Passphrase="passphrase"}(r||(r={}))},420:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(19),s=a.n(n),i=a(237),o=a(100),r=a(591);class l extends i.a{constructor(){super(o.a),s()(this,"widgetMap",new r.a)}static get instance(){return l.internalInstance}async onAction(e){}async onReady(){this.widgetMap.clear()}storeMessaging(e,t){this.stopMessaging(e),this.widgetMap.set(e.id,t)}stopMessaging(e){var t;null===(t=this.widgetMap.remove(e.id))||void 0===t||t.stop()}getMessaging(e){return this.widgetMap.get(e.id)}stopMessagingById(e){var t;null===(t=this.widgetMap.remove(e))||void 0===t||t.stop()}getMessagingForId(e){return this.widgetMap.get(e)}}s()(l,"internalInstance",new l)},421:function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return d}));var n=a(93),s=a(301),i=a(268),o=a(217);const r=()=>{s.default.setEnabled(!0)},l=()=>{s.default.setPromptHidden(!0)},c=e=>{o.a.sharedInstance().addOrReplaceToast({key:"desktopnotifications",title:e?Object(n.a)("Don't miss a reply"):Object(n.a)("Notifications"),props:{description:Object(n.a)("Enable desktop notifications"),acceptLabel:Object(n.a)("Enable"),onAccept:r,rejectLabel:Object(n.a)("Dismiss"),onReject:l},component:i.a,priority:30})},d=()=>{o.a.sharedInstance().dismissToast("desktopnotifications")}},422:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(19),s=a.n(n);class i{constructor(e){this.timeout=e,s()(this,"timerHandle",void 0),s()(this,"startTs",void 0),s()(this,"promise",void 0),s()(this,"resolve",void 0),s()(this,"reject",void 0),s()(this,"onTimeout",()=>{const e=Date.now()-this.startTs;if(e>=this.timeout)this.resolve(),this.setNotStarted();else{const t=this.timeout-e;this.timerHandle=setTimeout(this.onTimeout,t)}}),this.setNotStarted()}setNotStarted(){this.timerHandle=null,this.startTs=null,this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t}).finally(()=>{this.timerHandle=null})}changeTimeout(e){if(e===this.timeout)return;const t=e<this.timeout;this.timeout=e,this.isRunning()&&t&&(clearTimeout(this.timerHandle),this.onTimeout())}start(){return this.isRunning()||(this.startTs=Date.now(),this.timerHandle=setTimeout(this.onTimeout,this.timeout)),this}restart(){return this.isRunning()?(this.startTs=Date.now(),this):this.start()}abort(){return this.isRunning()&&(clearTimeout(this.timerHandle),this.reject(new Error("Timer was aborted.")),this.setNotStarted()),this}finished(){return this.promise}isRunning(){return null!==this.timerHandle}}},423:function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return c}));var n=a(146),s=a(99),i=a(360);function o(e){const{status:t}=e;if((!t||t===n.a.SENT)&&!e.isRedacted())if("m.room.message"===e.getType()){const t=e.getContent();if(t.msgtype&&"m.bad.encrypted"!==t.msgtype&&t.hasOwnProperty("body"))return!0}else if("m.sticker"===e.getType())return!0;return!1}function r(e){if(e.status===n.a.CANCELLED||"m.room.message"!==e.getType()||e.isRedacted())return!1;const t=e.getOriginalContent(),{msgtype:a}=t;return("m.text"===a||"m.emote"===a)&&t.body&&"string"==typeof t.body&&e.getSender()===s.a.get().getUserId()}function l(e){return r(e)}function c(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const n=e.getLiveTimeline(),s=n.getEvents().concat(e.getPendingEvents()),o=s.length-1,r=t?1:-1,c=t?0:o;let d=t?o:0;a||(d=Math.min(Math.max(0,c+100*r),o));let m=!a;for(let e=c;e!==d+r;e+=r){const t=s[e];if(m||t.getId()!==a){if(m&&!Object(i.a)(t)&&l(t))return t}else m=!0,d=Math.min(Math.max(0,e+100*r),o)}}},424:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(370),c=a(94);let d=Object(c.a)("structures.MainSplit")(n=class extends r.a.Component{constructor(){super(...arguments),i()(this,"_onResizeStart",()=>{this.props.resizeNotifier.startResizing()}),i()(this,"_onResize",()=>{this.props.resizeNotifier.notifyRightHandleResized()}),i()(this,"_onResizeStop",(e,t,a,n)=>{this.props.resizeNotifier.stopResizing(),window.localStorage.setItem("mx_rhs_size",this._loadSidePanelSize().width+n.width)})}_loadSidePanelSize(){let e=parseInt(window.localStorage.getItem("mx_rhs_size"),10);return isNaN(e)&&(e=350),{height:"100%",width:e}}render(){const e=r.a.Children.only(this.props.children),t=this.props.panel;let a;return!this.props.collapsedRhs&&t&&(a=r.a.createElement(l.Resizable,{defaultSize:this._loadSidePanelSize(),minWidth:264,maxWidth:"50%",enable:{top:!1,right:!1,bottom:!1,left:!0,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},onResizeStart:this._onResizeStart,onResize:this._onResize,onResizeStop:this._onResizeStop,className:"mx_RightPanel_ResizeWrapper",handleClasses:{left:"mx_RightPanel_ResizeHandle"}},t)),r.a.createElement("div",{className:"mx_MainSplit"},e,a)}})||n},425:function(e,t,a){"use strict";a.d(t,"a",(function(){return P}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(100),d=a(302),m=a(192),u=a(183),h=a(337),p=a(119),g=a(115),f=a(804),v=a(1350),b=a(94),y=a(103),E=a(1360),_=a(1361),S=a(1362),C=a(1363),w=a(1364),O=a(1415),x=a(1416),R=a(1417),k=a(635);function I(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function T(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?I(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):I(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let P=Object(b.a)("structures.RightPanel")((s=class extends l.a.Component{constructor(e,t){super(e,t),o()(this,"delayedUpdate",void 0),o()(this,"dispatcherRef",void 0),o()(this,"onGroupStoreUpdated",()=>{this.setState({isUserPrivilegedInGroup:m.a.isUserPrivileged(this.props.groupId)})}),o()(this,"onRoomStateMember",(e,t,a)=>{this.props.room&&a.roomId===this.props.room.roomId&&(this.state.phase===u.c.RoomMemberList&&a.roomId===this.props.room.roomId||this.state.phase===u.c.RoomMemberInfo&&a.roomId===this.props.room.roomId&&a.userId===this.state.member.userId)&&this.delayedUpdate()}),o()(this,"onAction",e=>{e.action===g.a.AfterRightPanelPhaseChange&&this.setState({phase:e.phase,groupRoomId:e.groupRoomId,groupId:e.groupId,member:e.member,event:e.event,verificationRequest:e.verificationRequest,verificationRequestPromise:e.verificationRequestPromise,widgetId:e.widgetId,space:e.space})}),o()(this,"onClose",()=>{this.props.user?c.a.dispatch({action:"view_home_page"}):this.state.phase===u.c.EncryptionPanel&&this.state.verificationRequest&&this.state.verificationRequest.pending?this.state.verificationRequest.cancel():c.a.dispatch({action:g.a.ToggleRightPanel,type:this.props.groupId?"group":"room"})}),this.state=T(T({},h.a.getSharedInstance().roomPanelPhaseParams),{},{phase:this.getPhaseFromProps(),isUserPrivilegedInGroup:null,member:this.getUserForPanel()}),this.delayedUpdate=new d.a(()=>{this.forceUpdate()},500)}getUserForPanel(){if(this.state&&this.state.member)return this.state.member;const e=h.a.getSharedInstance().roomPanelPhaseParams;return this.props.user||e.member}getPhaseFromProps(){var e;const t=h.a.getSharedInstance(),a=this.getUserForPanel();return this.props.groupId?u.a.includes(t.groupPanelPhase)?t.groupPanelPhase:(c.a.dispatch({action:g.a.SetRightPanelPhase,phase:u.c.GroupMemberList}),u.c.GroupMemberList):y.b.getValue("feature_spaces")&&null!==(e=this.props.room)&&void 0!==e&&e.isSpaceRoom()&&!u.b.includes(t.roomPanelPhase)?u.c.SpaceMemberList:a?t.roomPanelPhaseParams.member&&a.userId===t.roomPanelPhaseParams.member.userId&&t.roomPanelPhaseParams.verificationRequest?t.roomPanelPhase:u.c.RoomMemberInfo:t.roomPanelPhase}componentDidMount(){this.dispatcherRef=c.a.register(this.onAction);this.context.on("RoomState.members",this.onRoomStateMember),this.initGroupStore(this.props.groupId)}componentWillUnmount(){c.a.unregister(this.dispatcherRef),this.context&&this.context.removeListener("RoomState.members",this.onRoomStateMember),this.unregisterGroupStore()}UNSAFE_componentWillReceiveProps(e){e.groupId!==this.props.groupId&&(this.unregisterGroupStore(),this.initGroupStore(e.groupId))}initGroupStore(e){e&&m.a.registerListener(e,this.onGroupStoreUpdated)}unregisterGroupStore(){m.a.unregisterListener(this.onGroupStoreUpdated)}render(){let e=l.a.createElement("div",null);const t=this.props.room?this.props.room.roomId:void 0;switch(this.state.phase){case u.c.RoomMemberList:t&&(e=l.a.createElement(E.a,{roomId:t,key:t,onClose:this.onClose}));break;case u.c.SpaceMemberList:e=l.a.createElement(E.a,{roomId:this.state.space?this.state.space.roomId:t,key:this.state.space?this.state.space.roomId:t,onClose:this.onClose});break;case u.c.GroupMemberList:this.props.groupId&&(e=l.a.createElement(_.a,{groupId:this.props.groupId,key:this.props.groupId}));break;case u.c.GroupRoomList:e=l.a.createElement(S.a,{groupId:this.props.groupId,key:this.props.groupId});break;case u.c.RoomMemberInfo:case u.c.SpaceMemberInfo:case u.c.EncryptionPanel:e=l.a.createElement(w.a,{user:this.state.member,room:this.state.phase===u.c.SpaceMemberInfo?this.state.space:this.props.room,key:t||this.state.member.userId,onClose:this.onClose,phase:this.state.phase,verificationRequest:this.state.verificationRequest,verificationRequestPromise:this.state.verificationRequestPromise});break;case u.c.Room3pidMemberInfo:case u.c.Space3pidMemberInfo:e=l.a.createElement(O.a,{event:this.state.event,key:t});break;case u.c.GroupMemberInfo:e=l.a.createElement(w.a,{user:this.state.member,groupId:this.props.groupId,key:this.state.member.userId,phase:this.state.phase,onClose:this.onClose});break;case u.c.GroupRoomInfo:e=l.a.createElement(C.a,{groupRoomId:this.state.groupRoomId,groupId:this.props.groupId,key:this.state.groupRoomId});break;case u.c.NotificationPanel:e=l.a.createElement(R.a,{onClose:this.onClose});break;case u.c.PinnedMessages:y.b.getValue("feature_pinning")&&(e=l.a.createElement(k.b,{room:this.props.room,onClose:this.onClose}));break;case u.c.FilePanel:e=l.a.createElement(x.a,{roomId:t,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose});break;case u.c.RoomSummary:e=l.a.createElement(f.a,{room:this.props.room,onClose:this.onClose});break;case u.c.Widget:e=l.a.createElement(v.a,{room:this.props.room,widgetId:this.state.widgetId,onClose:this.onClose})}return l.a.createElement("aside",{className:"mx_RightPanel dark-panel",id:"mx_RightPanel"},e)}},o()(s,"contextType",p.a),n=s))||n},426:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(92),l=a.n(r),c=a(97),d=a(99),m=a(266),u=a(93),h=a(279);class p extends o.a.PureComponent{constructor(e){super(e),s()(this,"_onCancel",()=>{this.props.onFinished(!1)}),s()(this,"_onDone",()=>{this.props.onFinished(!0)}),s()(this,"_onUseRecoveryKeyClick",()=>{this.setState({forceRecoveryKey:!0})}),s()(this,"_progressCallback",e=>{this.setState({progress:e})}),s()(this,"_onResetRecoveryClick",()=>{this.props.onFinished(!1),Object(h.b)(()=>{},!0)}),s()(this,"_onRecoveryKeyChange",e=>{this.setState({recoveryKey:e.target.value,recoveryKeyValid:d.a.get().isValidRecoveryKey(e.target.value)})}),s()(this,"_onPassPhraseNext",async()=>{this.setState({loading:!0,restoreError:null,restoreType:0});try{const e=await d.a.get().restoreKeyBackupWithPassword(this.state.passPhrase,void 0,void 0,this.state.backupInfo,{progressCallback:this._progressCallback});if(this.props.keyCallback){const e=await d.a.get().keyBackupKeyFromPassword(this.state.passPhrase,this.state.backupInfo);this.props.keyCallback(e)}if(!this.props.showSummary)return void this.props.onFinished(!0);this.setState({loading:!1,recoverInfo:e})}catch(e){console.log("Error restoring backup",e),this.setState({loading:!1,restoreError:e})}}),s()(this,"_onRecoveryKeyNext",async()=>{if(this.state.recoveryKeyValid){this.setState({loading:!0,restoreError:null,restoreType:1});try{const e=await d.a.get().restoreKeyBackupWithRecoveryKey(this.state.recoveryKey,void 0,void 0,this.state.backupInfo,{progressCallback:this._progressCallback});if(this.props.keyCallback){const e=d.a.get().keyBackupKeyFromRecoveryKey(this.state.recoveryKey);this.props.keyCallback(e)}if(!this.props.showSummary)return void this.props.onFinished(!0);this.setState({loading:!1,recoverInfo:e})}catch(e){console.log("Error restoring backup",e),this.setState({loading:!1,restoreError:e})}}}),s()(this,"_onPassPhraseChange",e=>{this.setState({passPhrase:e.target.value})}),this.state={backupInfo:null,backupKeyStored:null,loading:!1,loadError:null,restoreError:null,recoveryKey:"",recoverInfo:null,recoveryKeyValid:!1,forceRecoveryKey:!1,passPhrase:"",restoreType:null,progress:{stage:"prefetch"}}}componentDidMount(){this._loadBackupStatus()}async _restoreWithSecretStorage(){this.setState({loading:!0,restoreError:null,restoreType:2});try{const e=await Object(h.b)(async()=>d.a.get().restoreKeyBackupWithSecretStorage(this.state.backupInfo,void 0,void 0,{progressCallback:this._progressCallback}));this.setState({loading:!1,recoverInfo:e})}catch(e){console.log("Error restoring backup",e),this.setState({restoreError:e,loading:!1})}}async _restoreWithCachedKey(e){if(!e)return!1;try{const t=await d.a.get().restoreKeyBackupWithCache(void 0,void 0,e,{progressCallback:this._progressCallback});return this.setState({recoverInfo:t}),!0}catch(e){return console.log("restoreWithCachedKey failed:",e),!1}}async _loadBackupStatus(){this.setState({loading:!0,loadError:null});try{const e=d.a.get(),t=await e.getKeyBackupVersion(),a=await e.hasSecretStorageKey()&&await e.isKeyBackupKeyStored();this.setState({backupInfo:t,backupKeyStored:a});if(await this._restoreWithCachedKey(t))return console.log("RestoreKeyBackupDialog: found cached backup key"),void this.setState({loading:!1});if(a)return this._restoreWithSecretStorage();this.setState({loadError:null,loading:!1})}catch(e){console.log("Error loading backup status",e),this.setState({loadError:e,loading:!1})}}render(){const e=c.getComponent("views.dialogs.BaseDialog"),t=c.getComponent("elements.Spinner"),a=this.state.backupInfo&&this.state.backupInfo.auth_data&&this.state.backupInfo.auth_data.private_key_salt&&this.state.backupInfo.auth_data.private_key_iterations;let n,s;if(this.state.loading){let e;if(s=Object(u.a)("Restoring keys from backup"),"fetch"===this.state.progress.stage)e=Object(u.a)("Fetching keys from server...");else if("load_keys"===this.state.progress.stage){const{total:t,successes:a,failures:n}=this.state.progress;e=Object(u.a)("%(completed)s of %(total)s keys restored",{total:t,completed:a+n})}else"prefetch"===this.state.progress.stage&&(e=Object(u.a)("Fetching keys from server..."));n=o.a.createElement("div",null,o.a.createElement("div",null,e),o.a.createElement(t,null))}else if(this.state.loadError)s=Object(u.a)("Error"),n=Object(u.a)("Unable to load backup status");else if(this.state.restoreError)this.state.restoreError.errcode===m.b.RESTORE_BACKUP_ERROR_BAD_KEY?1===this.state.restoreType?(s=Object(u.a)("Security Key mismatch"),n=o.a.createElement("div",null,o.a.createElement("p",null,Object(u.a)("Backup could not be decrypted with this Security Key: please verify that you entered the correct Security Key.")))):(s=Object(u.a)("Incorrect Security Phrase"),n=o.a.createElement("div",null,o.a.createElement("p",null,Object(u.a)("Backup could not be decrypted with this Security Phrase: please verify that you entered the correct Security Phrase.")))):(s=Object(u.a)("Error"),n=Object(u.a)("Unable to restore backup"));else if(null===this.state.backupInfo)s=Object(u.a)("Error"),n=Object(u.a)("No backup found!");else if(this.state.recoverInfo){const e=c.getComponent("views.elements.DialogButtons");let t;s=Object(u.a)("Keys restored"),this.state.recoverInfo.total>this.state.recoverInfo.imported&&(t=o.a.createElement("p",null,Object(u.a)("Failed to decrypt %(failedCount)s sessions!",{failedCount:this.state.recoverInfo.total-this.state.recoverInfo.imported}))),n=o.a.createElement("div",null,o.a.createElement("p",null,Object(u.a)("Successfully restored %(sessionCount)s keys",{sessionCount:this.state.recoverInfo.imported})),t,o.a.createElement(e,{primaryButton:Object(u.a)("OK"),onPrimaryButtonClick:this._onDone,hasCancel:!1,focus:!0}))}else if(a&&!this.state.forceRecoveryKey){const e=c.getComponent("views.elements.DialogButtons"),t=c.getComponent("elements.AccessibleButton");s=Object(u.a)("Enter Security Phrase"),n=o.a.createElement("div",null,o.a.createElement("p",null,Object(u.a)("<b>Warning</b>: you should only set up key backup from a trusted computer.",{},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("p",null,Object(u.a)("Access your secure message history and set up secure messaging by entering your Security Phrase.")),o.a.createElement("form",{className:"mx_RestoreKeyBackupDialog_primaryContainer"},o.a.createElement("input",{type:"password",className:"mx_RestoreKeyBackupDialog_passPhraseInput",onChange:this._onPassPhraseChange,value:this.state.passPhrase,autoFocus:!0}),o.a.createElement(e,{primaryButton:Object(u.a)("Next"),onPrimaryButtonClick:this._onPassPhraseNext,primaryIsSubmit:!0,hasCancel:!0,onCancel:this._onCancel,focus:!1})),Object(u.a)("If you've forgotten your Security Phrase you can <button1>use your Security Key</button1> or <button2>set up new recovery options</button2>",{},{button1:e=>o.a.createElement(t,{className:"mx_linkButton",element:"span",onClick:this._onUseRecoveryKeyClick},e),button2:e=>o.a.createElement(t,{className:"mx_linkButton",element:"span",onClick:this._onResetRecoveryClick},e)}))}else{s=Object(u.a)("Enter Security Key");const e=c.getComponent("views.elements.DialogButtons"),t=c.getComponent("elements.AccessibleButton");let a;a=0===this.state.recoveryKey.length?o.a.createElement("div",{className:"mx_RestoreKeyBackupDialog_keyStatus"}):this.state.recoveryKeyValid?o.a.createElement("div",{className:"mx_RestoreKeyBackupDialog_keyStatus"},"👍 ",Object(u.a)("This looks like a valid Security Key!")):o.a.createElement("div",{className:"mx_RestoreKeyBackupDialog_keyStatus"},"👎 ",Object(u.a)("Not a valid Security Key")),n=o.a.createElement("div",null,o.a.createElement("p",null,Object(u.a)("<b>Warning</b>: You should only set up key backup from a trusted computer.",{},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("p",null,Object(u.a)("Access your secure message history and set up secure messaging by entering your Security Key.")),o.a.createElement("div",{className:"mx_RestoreKeyBackupDialog_primaryContainer"},o.a.createElement("input",{className:"mx_RestoreKeyBackupDialog_recoveryKeyInput",onChange:this._onRecoveryKeyChange,value:this.state.recoveryKey,autoFocus:!0}),a,o.a.createElement(e,{primaryButton:Object(u.a)("Next"),onPrimaryButtonClick:this._onRecoveryKeyNext,hasCancel:!0,onCancel:this._onCancel,focus:!1,primaryDisabled:!this.state.recoveryKeyValid})),Object(u.a)("If you've forgotten your Security Key you can <button>set up new recovery options</button>",{},{button:e=>o.a.createElement(t,{className:"mx_linkButton",element:"span",onClick:this._onResetRecoveryClick},e)}))}return o.a.createElement(e,{className:"mx_RestoreKeyBackupDialog",onFinished:this.props.onFinished,title:s},o.a.createElement("div",{className:"mx_RestoreKeyBackupDialog_content"},n))}}s()(p,"propTypes",{showSummary:l.a.bool,keyCallback:l.a.func}),s()(p,"defaultProps",{showSummary:!0})},427:function(e,t,a){"use strict";(function(e){a.d(t,"i",(function(){return M})),a.d(t,"b",(function(){return U})),a.d(t,"a",(function(){return L})),a.d(t,"e",(function(){return F})),a.d(t,"c",(function(){return V})),a.d(t,"k",(function(){return W})),a.d(t,"l",(function(){return K})),a.d(t,"f",(function(){return q})),a.d(t,"d",(function(){return X})),a.d(t,"m",(function(){return Z})),a.d(t,"h",(function(){return ee})),a.d(t,"g",(function(){return te})),a.d(t,"j",(function(){return ne})),a.d(t,"n",(function(){return ie}));var n=a(225),s=a(331),i=a(486),o=a(99),r=a(338),l=a(383),c=a(1376),d=a(181),m=a(301),u=a(796),h=a(2726),p=a(100),g=a(185),f=a(106),v=a(97),b=a(490),y=a(156),E=a(503),_=a(504),S=a(103),C=a(1377),w=a(217),O=a(283),x=a(801),R=a(8473),k=a(788),I=a(429),T=a(827),P=a(154),N=a(158),D=a(2728),j=a(186),A=a(93);async function M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=e.enableGuest||!1;const a=e.guestHsUrl,n=e.guestIsUrl,s=e.fragmentQueryParams||{},i=e.defaultDeviceDisplayName;if(t&&!a&&(console.warn("Cannot enable guest access: can't determine HS URL to use"),t=!1),t&&s.guest_user_id&&s.guest_access_token)return console.log("Using guest access credentials"),Y({userId:s.guest_user_id,accessToken:s.guest_access_token,homeserverUrl:a,identityServerUrl:n,guest:!0},!0).then(()=>!0);return!!await W({ignoreGuest:Boolean(e.ignoreGuest)})||!!t&&B(a,n,i)}catch(e){return!(e instanceof $)&&H(e)}}async function U(){const{hsUrl:e,userId:t,hasAccessToken:a,isGuest:n}=await V();return e&&t&&a?[t,n]:[null,null]}function L(e,t,a){if(!e.loginToken)return Promise.resolve(!1);const s=localStorage.getItem(I.a),i=localStorage.getItem(I.c);return s?Object(E.c)(s,i,"m.login.token",{token:e.loginToken,initial_device_display_name:t}).then((function(e){return console.log("Logged in with token"),se().then(async()=>(await J(e),sessionStorage.setItem("mx_fresh_login",String(!0)),!0))})).catch(e=>(f.a.createTrackedDialog("SSO","Token Rejected",j.a,{title:Object(A.a)("We couldn't log you in"),description:"ConnectionError"===e.name?Object(A.a)("Your homeserver was unreachable and was not able to log you in. Please try again. If this continues, please contact your homeserver administrator."):Object(A.a)("Your homeserver rejected your log in attempt. This could be due to things just taking too long. Please try again. If this continues, please contact your homeserver administrator."),button:Object(A.a)("Try again"),onFinished:e=>{if(e){const e=Object(n.createClient)({baseUrl:s,idBaseUrl:i}),t=localStorage.getItem(I.b)||void 0;y.a.get().startSingleSignOn(e,"sso",a,t)}}}),console.error("Failed to log in with login token:"),console.error(e),!1)):(console.warn("Cannot log in with token: can't determine HS URL to use"),f.a.createTrackedDialog("SSO","Unknown HS",j.a,{title:Object(A.a)("We couldn't log you in"),description:Object(A.a)("We asked the browser to remember which homeserver you use to let you sign in, but unfortunately your browser has forgotten it. Go to the sign in page and try again."),button:Object(A.a)("Try again")}),Promise.resolve(!1))}function F(e){if(e.reason===s.b.TOGGLED_LAZY_LOADING)return Promise.resolve().then(()=>{if(e.value){const e=v.getComponent("views.dialogs.LazyLoadingResyncDialog");return new Promise(t=>{f.a.createDialog(e,{onFinished:t})})}{const e=v.getComponent("views.dialogs.LazyLoadingDisabledDialog");return new Promise(t=>{f.a.createDialog(e,{onFinished:t,host:window.location.host})})}}).then(()=>o.a.get().store.deleteAllData()).then(()=>{y.a.get().reload()})}function B(e,t,a){console.log("Doing guest login on "+e);return Object(n.createClient)({baseUrl:e}).registerGuest({body:{initial_device_display_name:a}}).then(a=>(console.log("Registered as guest: "+a.user_id),Y({userId:a.user_id,deviceId:a.device_id,accessToken:a.access_token,homeserverUrl:e,identityServerUrl:t,guest:!0},!0).then(()=>!0)),e=>(console.error("Failed to register as guest",e),!1))}async function V(){const e=localStorage.getItem("mx_hs_url"),t=localStorage.getItem("mx_is_url");let a;try{a=await _.c("account","mx_access_token")}catch(e){}if(!a&&(a=localStorage.getItem("mx_access_token"),a))try{await _.d("account","mx_access_token",a),localStorage.removeItem("mx_access_token")}catch(e){}const n="true"===localStorage.getItem("mx_has_access_token")||!!a,s=localStorage.getItem("mx_user_id"),i=localStorage.getItem("mx_device_id");let o;return o=null!==localStorage.getItem("mx_is_guest")?"true"===localStorage.getItem("mx_is_guest"):"true"===localStorage.getItem("matrix-is-guest"),{hsUrl:e,isUrl:t,hasAccessToken:n,accessToken:a,userId:s,deviceId:i,isGuest:o}}async function G(e){const t=new Uint8Array(e.length);for(let a=0;a<e.length;a++)t[a]=e.charCodeAt(a);const a=await window.crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits"]);return t.fill(0),new Uint8Array(await window.crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",salt:new Uint8Array(32),info:new Uint8Array(0)},a,256))}async function z(){if(await function(){const e=v.getComponent("views.dialogs.StorageEvictedDialog");return new Promise(t=>{f.a.createTrackedDialog("Storage evicted","",e,{onFinished:t})})}())throw await se(),new $("Aborting login in progress because of storage inconsistency")}async function W(e){const t=null==e?void 0:e.ignoreGuest;if(!localStorage)return!1;const{hsUrl:a,isUrl:n,hasAccessToken:s,accessToken:o,userId:r,deviceId:l,isGuest:c}=await V();if(s&&!o&&z(),o&&r&&a){if(t&&c)return console.log("Ignoring stored guest account: "+r),!1;let e=o;const s=await y.a.get().getPickleKey(r,l);if(s){if(console.log("Got pickle key"),"string"!=typeof o){const t=await G(s);e=await Object(i.a)(o,t,"access_token"),t.fill(0)}}else console.log("No pickle key available");const d="true"===sessionStorage.getItem("mx_fresh_login");return sessionStorage.removeItem("mx_fresh_login"),console.log("Restoring session for "+r),await Y({userId:r,deviceId:l,accessToken:e,homeserverUrl:a,identityServerUrl:n,guest:c,pickleKey:s,freshLogin:d},!1),!0}return console.log("No previous session found."),!1}async function H(e){console.error("Unable to load session",e);const t=v.getComponent("views.dialogs.SessionRestoreErrorDialog"),a=f.a.createTrackedDialog("Session Restore Error","",t,{error:e.message}),[n]=await a.finished;return n?(await se(),!1):M()}async function K(e){e.freshLogin=!0,ie();const t=e.userId&&e.deviceId?await y.a.get().createPickleKey(e.userId,e.deviceId):null;return t?console.log("Created pickle key"):console.log("Pickle key not created"),Y(Object.assign({},e,{pickleKey:t}),!0)}function q(e){const t=o.a.get().getUserId(),a=o.a.get().getDeviceId();ie(),localStorage.removeItem("mx_soft_logout"),Q=!1;const n=e.userId!==t||e.deviceId!==a;return n&&console.warn("Clearing all data: Old session belongs to a different user/session"),Y(e,n)}async function Y(e,t){e.guest=Boolean(e.guest);const a=ee();console.log("setLoggedIn: mxid: "+e.userId+" deviceId: "+e.deviceId+" guest: "+e.guest+" hs: "+e.homeserverUrl+" softLogout: "+a," freshLogin: "+e.freshLogin),p.a.dispatch({action:"on_logging_in"},!0),t&&await se();const n=await _.a();n.dataInLocalStorage&&n.cryptoInited&&!n.dataInCryptoStore&&await z(),d.a.setLoggedIn(e.guest,e.homeserverUrl),o.a.replaceUsingCreds(e);const s=o.a.get();if(e.freshLogin&&S.b.getValue("feature_dehydration")){const t=await s.rehydrateDevice();t&&(e.deviceId=t),delete e.freshLogin}if(localStorage)try{await J(e),sessionStorage.removeItem("mx_fresh_login")}catch(e){console.warn("Error using local storage: can't persist session!",e)}else console.warn("No local storage available: can't persist session!");return p.a.dispatch({action:"on_logged_in"}),await ae(!a),s}class $ extends Error{}async function J(e){var t;if(localStorage.setItem("mx_hs_url",e.homeserverUrl),e.identityServerUrl&&localStorage.setItem("mx_is_url",e.identityServerUrl),localStorage.setItem("mx_user_id",e.userId),localStorage.setItem("mx_is_guest",JSON.stringify(e.guest)),e.accessToken?localStorage.setItem("mx_has_access_token","true"):localStorage.deleteItem("mx_has_access_token"),e.oauth2Token&&localStorage.setItem("globits_oauth2_access_token",e.oauth2Token),e.pickleKey){let t;try{const a=await G(e.pickleKey);t=await Object(i.b)(e.accessToken,a,"access_token"),a.fill(0)}catch(e){console.warn("Could not encrypt access token",e)}try{await _.d("account","mx_access_token",t||e.accessToken)}catch(t){localStorage.setItem("mx_access_token",e.accessToken)}localStorage.setItem("mx_has_pickle_key",String(!0))}else{try{await _.d("account","mx_access_token",e.accessToken)}catch(t){localStorage.setItem("mx_access_token",e.accessToken)}localStorage.getItem("mx_has_pickle_key")&&console.error("Expected a pickle key, but none provided.  Encryption may not work.")}e.deviceId&&localStorage.setItem("mx_device_id",e.deviceId),null===(t=r.a.persistCredentials)||void 0===t||t.call(r.a,e),console.log("Session persisted for "+e.userId)}let Q=!1;function X(t){if(!o.a.get())return;if(P.a.instance.disabled||P.a.instance.enable(!0),o.a.get().isGuest())return void e(()=>ne());Q=!0;const a=o.a.get();y.a.get().destroyPickleKey(a.getUserId(),a.getDeviceId()),a.globitsLogout(t).then(ne,e=>{console.log("Failed to call logout API: token will not be invalidated"),ne()})}function Z(){o.a.get()&&(localStorage.setItem("mx_soft_logout","true"),console.log("Soft logout initiated"),Q=!0,p.a.dispatch({action:"on_client_not_viable"}),ie(!1))}function ee(){return"true"===localStorage.getItem("mx_soft_logout")}function te(){return Q}async function ae(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.log("Lifecycle: Starting MatrixClient"),p.a.dispatch({action:"will_start_client"},!0),C.a.sharedInstance().reset(),w.a.sharedInstance().reset(),m.default.start(),u.a.sharedInstance().start(),g.a.makeShared().start(),O.a.sharedInstance().startWatching(),b.a.start(),N.d.sharedInstance().start(),x.a.sharedInstance().start(),e?(await l.a.init(),await o.a.start()):(console.warn("Caller requested only auxiliary services be started"),await o.a.assign()),R.a.sharedInstance().start(),S.b.getValue("lowBandwidth")||h.a.start(),await k.a.getInstance().start(),p.a.dispatch({action:"client_started"}),ee()&&Z()}async function ne(){var e;Q=!1,p.a.dispatch({action:"on_logged_out"},!0),ie(),await se({deleteEverything:!0}),null===(e=D.a.onLoggedOutAndStorageCleared)||void 0===e||e.call(D.a)}async function se(e){if(d.a.disable(),window.localStorage){const t=T.a.instance.getWireInvites();window.localStorage.clear();try{await _.b("account","mx_access_token")}catch(e){}null!=e&&e.deleteEverything||t.forEach(e=>{const t=e.roomId;delete e.roomId,T.a.instance.storeInvite(t,e)})}window.sessionStorage&&window.sessionStorage.clear();const t=Object(c.a)({baseUrl:""});await l.a.deleteEventIndex(),await t.clearStores()}function ie(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];m.default.stop(),N.d.sharedInstance().stop(),u.a.sharedInstance().stop(),C.a.sharedInstance().reset(),h.a.stop(),b.a.stop(),O.a.sharedInstance().stopWatching(),x.a.sharedInstance().stop(),R.a.sharedInstance().stop(),g.a.shared()&&g.a.shared().stop(),l.a.stop();const t=o.a.get();t&&(t.stopClient(),t.removeAllListeners(),e&&(o.a.unset(),l.a.unset()))}}).call(this,a(212).setImmediate)},428:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i}));var n=a(93);function s(e,t,a,s){let i=a[e];void 0===i&&(i=a[""]);const o=e=>t?React.createElement("a",{href:t,target:"_blank",rel:"noreferrer noopener"},e):e;return i.includes("<a>")?Object(n.a)(i,{},Object.assign({a:o},s)):Object(n.a)(i,{},s)}function i(e){if("M_RESOURCE_LIMIT_EXCEEDED"===e.errcode){const t=s(e.data.limit_type,e.data.admin_contact,{monthly_active_user:Object(n.b)("This homeserver has hit its Monthly Active User limit."),hs_blocked:Object(n.b)("This homeserver has been blocked by its administrator."),"":Object(n.b)("This homeserver has exceeded one of its resource limits.")}),a=s(e.data.limit_type,e.data.admin_contact,{"":Object(n.b)("Please <a>contact your service administrator</a> to continue using the service.")});return React.createElement("div",null,React.createElement("div",null,t),React.createElement("div",null,a))}return React.createElement("div",null,Object(n.a)("Unable to connect to Homeserver. Retrying..."))}},429:function(e,t,a){"use strict";a.d(t,"a",(function(){return m})),a.d(t,"c",(function(){return u})),a.d(t,"b",(function(){return h})),a.d(t,"d",(function(){return p})),a.d(t,"e",(function(){return g}));var n=a(19),s=a.n(n),i=a(213),o=a(100),r=a(115),l=a(830),c=a(99),d=a(504);const m="mx_sso_hs_url",u="mx_sso_is_url",h="mx_sso_idp_id";let p;!function(e){e.Checking="CHECKING",e.Error="ERROR",e.NotAvailable="NOTAVAILABLE",e.Downloading="DOWNLOADING",e.Ready="READY"}(p||(p={}));class g{constructor(){s()(this,"notificationCount",0),s()(this,"errorDidOccur",!1),s()(this,"onAction",e=>{switch(e.action){case"on_client_not_viable":case"on_logged_out":this.setNotificationCount(0)}}),o.a.register(this.onAction),this.startUpdateCheck=this.startUpdateCheck.bind(this)}setNotificationCount(e){this.notificationCount=e}setErrorStatus(e){this.errorDidOccur=e}async canSelfUpdate(){return!1}startUpdateCheck(){Object(l.a)(),localStorage.removeItem("mx_defer_update"),o.a.dispatch({action:r.a.CheckUpdates,status:p.Checking})}installUpdate(){}shouldShowUpdate(e){if(c.a.userRegisteredWithinLastHours(24))return!1;try{const[t,a]=JSON.parse(localStorage.getItem("mx_defer_update"));return e!==t||Date.now()>a}catch(e){return!0}}deferUpdate(e){const t=new Date(Date.now()+864e5);t.setHours(8,0,0,0),localStorage.setItem("mx_defer_update",JSON.stringify([e,t.getTime()])),Object(l.a)()}supportsMultiLanguageSpellCheck(){return!1}supportsNotifications(){return!1}maySendNotifications(){return!1}loudNotification(e,t){}clearNotification(e){e.close&&e.close()}screenCaptureErrorString(){return"Not implemented"}supportsAutoLaunch(){return!1}async getAutoLaunchEnabled(){return!1}async setAutoLaunchEnabled(e){throw new Error("Unimplemented")}supportsWarnBeforeExit(){return!1}async shouldWarnBeforeExit(){return!1}async setWarnBeforeExit(e){throw new Error("Unimplemented")}supportsAutoHideMenuBar(){return!1}async getAutoHideMenuBarEnabled(){return!1}async setAutoHideMenuBarEnabled(e){throw new Error("Unimplemented")}supportsMinimizeToTray(){return!1}async getMinimizeToTrayEnabled(){return!1}async setMinimizeToTrayEnabled(e){throw new Error("Unimplemented")}getEventIndexingManager(){return null}async setLanguage(e){}setSpellCheckLanguages(e){}getSpellCheckLanguages(){return null}getAvailableSpellCheckLanguages(){return null}getSSOCallbackUrl(e){const t=new URL(window.location.href);return t.hash=e||"",t}startSingleSignOn(e,t,a,n){localStorage.setItem(m,e.getHomeserverUrl()),e.getIdentityServerUrl()&&localStorage.setItem(u,e.getIdentityServerUrl()),n&&localStorage.setItem(h,n);const s=this.getSSOCallbackUrl(a);window.location.href=e.getSsoLoginUrl(s.toString(),t,n)}onKeyDown(e){return!1}async getPickleKey(e,t){if(!window.crypto||!window.crypto.subtle)return null;let a;try{a=await Object(d.c)("pickleKey",[e,t])}catch(e){}if(!a)return null;if(!a.encrypted||!a.iv||!a.cryptoKey)return console.error("Badly formatted pickle key"),null;const n=new Uint8Array(e.length+t.length+1);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);n[e.length]=124;for(let a=0;a<t.length;a++)n[e.length+1+a]=t.charCodeAt(a);try{const e=await crypto.subtle.decrypt({name:"AES-GCM",iv:a.iv,additionalData:n},a.cryptoKey,a.encrypted);return Object(i.encodeUnpaddedBase64)(e)}catch(e){return console.error("Error decrypting pickle key"),null}}async createPickleKey(e,t){if(!window.crypto||!window.crypto.subtle)return null;const a=window.crypto,n=new Uint8Array(32);a.getRandomValues(n);const s=await a.subtle.generateKey({name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),o=new Uint8Array(32);a.getRandomValues(o);const r=new Uint8Array(e.length+t.length+1);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);r[e.length]=124;for(let a=0;a<t.length;a++)r[e.length+1+a]=t.charCodeAt(a);const l=await a.subtle.encrypt({name:"AES-GCM",iv:o,additionalData:r},s,n);try{await Object(d.d)("pickleKey",[e,t],{encrypted:l,iv:o,cryptoKey:s})}catch(e){return null}return Object(i.encodeUnpaddedBase64)(n)}async destroyPickleKey(e,t){try{await Object(d.b)("pickleKey",[e,t])}catch(e){}}}},430:function(e,t,a){"use strict";var n=a(103),s=a(123),i=a(225);t.a={hasAnyLabeledDevices:async function(){return(await navigator.mediaDevices.enumerateDevices()).some(e=>!!e.label)},getDevices:function(){return navigator.mediaDevices.enumerateDevices().then((function(e){const t=[],a=[],n=[];return e.forEach(e=>{switch(e.kind){case"audiooutput":t.push(e);break;case"audioinput":a.push(e);break;case"videoinput":n.push(e)}}),{audiooutput:t,audioinput:a,videoinput:n}}),e=>{console.log("Unable to refresh WebRTC Devices: ",e)})},loadDevices:function(){const e=n.b.getValue("webrtc_audioinput"),t=n.b.getValue("webrtc_videoinput");Object(i.setMatrixCallAudioInput)(e),Object(i.setMatrixCallVideoInput)(t)},setAudioOutput:function(e){n.b.setValue("webrtc_audiooutput",null,s.a.DEVICE,e)},setAudioInput:function(e){n.b.setValue("webrtc_audioinput",null,s.a.DEVICE,e),Object(i.setMatrixCallAudioInput)(e)},setVideoInput:function(e){n.b.setValue("webrtc_videoinput",null,s.a.DEVICE,e),Object(i.setMatrixCallVideoInput)(e)},getAudioOutput:function(){return n.b.getValueAt(s.a.DEVICE,"webrtc_audiooutput")},getAudioInput:function(){return n.b.getValueAt(s.a.DEVICE,"webrtc_audioinput")},getVideoInput:function(){return n.b.getValueAt(s.a.DEVICE,"webrtc_videoinput")}}},431:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(19),s=a.n(n),i=a(150),o=a(1);function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]};s()(this,"_options",void 0),s()(this,"_items",void 0),this._options=t,this.setObjects(e),void 0===this._options.shouldMatchWordsOnly&&(this._options.shouldMatchWordsOnly=!0)}setObjects(e){this._items=new Map;for(const t of e){const e=Object(i.at)(t,this._options.keys);if(this._options.funcs)for(const a of this._options.funcs){const n=a(t);Array.isArray(n)?e.push(...n):e.push(n)}for(const[a,n]of Object.entries(e)){if(!n)continue;const e=this.processQuery(n);this._items.has(e)||this._items.set(e,[]),this._items.get(e).push({keyWeight:Number(a),object:t})}}}match(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if(e=this.processQuery(e),this._options.shouldMatchWordsOnly&&(e=e.replace(/[^\w]/g,"")),0===e.length)return[];const a=[];for(const[t,n]of this._items.entries()){let s=t;this._options.shouldMatchWordsOnly&&(s=s.replace(/[^\w]/g,""));const i=s.indexOf(e);-1!==i&&a.push(...n.map(e=>l({index:i},e)))}a.sort((e,t)=>{if(e.index<t.index)return-1;if(e.index===t.index){if(e.keyWeight<t.keyWeight)return-1;if(e.keyWeight===t.keyWeight)return 0}return 1});const n=Object(i.uniq)(a.map(e=>e.object)),s=-1===t?n.length:t;return n.slice(0,s)}processQuery(e){return!1!==this._options.fuzzy?Object(o.v)(e.toLowerCase()).toLowerCase():e.toLowerCase()}}},438:function(e,t,a){"use strict";var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(110),u=a(252),h=a(93),p=a(144),g=a(94);let f=Object(g.a)("views.auth.PassphraseField")((s=class extends r.PureComponent{constructor(){super(...arguments),o()(this,"validate",Object(u.a)({description:function(e){const t=e?e.score:0;return l.a.createElement("progress",{className:"mx_PassphraseField_progress",max:4,value:t})},deriveData:async e=>{let{value:t}=e;if(!t)return null;const{scorePassword:n}=await Promise.all([a.e(29),a.e(34)]).then(a.bind(null,8463));return n(t)},rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(h.a)(this.props.labelEnterPassword)},{key:"complexity",test:async function(e,t){let{value:a}=e;if(!a)return!1;const n=t.score>=this.props.minScore;return m.a.get().dangerously_allow_unsafe_and_insecure_passwords||n},valid:function(e){return e.score>=this.props.minScore?Object(h.a)(this.props.labelStrongPassword):Object(h.a)(this.props.labelAllowedButUnsafe)},invalid:function(e){if(!e)return null;const{feedback:t}=e;return t.warning||t.suggestions[0]||Object(h.a)("Keep going...")}}]})),o()(this,"onValidate",async e=>{const t=await this.validate(e);return this.props.onValidate(t),t})}render(){return l.a.createElement(p.a,{id:this.props.id,autoFocus:this.props.autoFocus,className:d()("mx_PassphraseField",this.props.className),ref:this.props.fieldRef,type:"password",autoComplete:"new-password",label:Object(h.a)(this.props.label),value:this.props.value,onChange:this.props.onChange,onValidate:this.onValidate})}},o()(s,"defaultProps",{label:Object(h.b)("Password"),labelEnterPassword:Object(h.b)("Enter password"),labelStrongPassword:Object(h.b)("Nice, strong password!"),labelAllowedButUnsafe:Object(h.b)("Password is allowed, but unsafe")}),n=s))||n;t.a=f},439:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n=a(258),s=a.n(n),i=a(8),o=a(633),r=a(256),l=a(444),c=a(1),d=a(146),m=a(257);function u(e,t){this.roomId=e,this.info=t}var h=a(0),p=a(775),g=a(140);function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const b=["1","2","3","4","5","6"];function y(e,t,a){const n={content:{},type:"m.receipt",room_id:t.getRoomId()};return n.content[t.getId()]={},n.content[t.getId()][a]={},n.content[t.getId()][a][e]={ts:t.getTs()},new d.b(n)}function E(e,t,a,n){if((n=n||{}).pendingEventOrdering=n.pendingEventOrdering||"chronological",this._client=t,this.setMaxListeners(100),this.reEmitter=new p.a(this),-1===["chronological","detached"].indexOf(n.pendingEventOrdering))throw new Error("opts.pendingEventOrdering MUST be either 'chronological' or 'detached'. Got: '"+n.pendingEventOrdering+"'");if(this.myUserId=a,this.roomId=e,this.name=e,this.tags={},this.accountData={},this.summary=null,this.storageToken=n.storageToken,this._opts=n,this._txnToEvent={},this._receipts={},this._receiptCacheByEventId={},this._realReceipts={},this._notificationCounts={},this._timelineSets=[new o.a(this,n)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),this._fixUpLegacyTimelineFields(),this._filteredTimelineSets={},"detached"==this._opts.pendingEventOrdering){this._pendingEventList=[];const e=t.sessionStore.store.getItem(_(this.roomId));e&&JSON.parse(e).forEach(async e=>{const t=new d.b(e);"m.room.encrypted"===t.getType()&&await t.attemptDecryption(this._client.crypto),t.setStatus(d.a.NOT_SENT),this.addPendingEvent(t,t.getTxnId())})}this._blacklistUnverifiedDevices=null,this._selfMembership=null,this._summaryHeroes=null,this._opts.lazyLoadMembers?this._membersPromise=null:this._membersPromise=Promise.resolve(),this.getTypeWarning=!1,this.getVersionWarning=!1}function _(e){return"mx_pending_events_"+e}c.m(E,i.EventEmitter),E.prototype.decryptCriticalEvents=function(){const e=this.getEventReadUpTo(this._client.getUserId(),!0),t=this.getLiveTimeline().getEvents(),a=t.findIndex(t=>t.event.event_id===e),n=t.slice(a).filter(e=>e.shouldAttemptDecryption()).reverse().map(e=>e.attemptDecryption(this._client.crypto,{isRetry:!0}));return Promise.allSettled(n)},E.prototype.decryptAllEvents=function(){const e=this.getUnfilteredTimelineSet().getLiveTimeline().getEvents().filter(e=>e.shouldAttemptDecryption()).reverse().map(e=>e.attemptDecryption(this._client.crypto,{isRetry:!0}));return Promise.allSettled(e)},E.prototype.getVersion=function(){const e=this.currentState.getStateEvents("m.room.create","");if(!e)return this.getVersionWarning||(h.a.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1";const t=e.getContent().room_version;return void 0===t?"1":t},E.prototype.shouldUpgradeToVersion=function(){return b.includes(this.getVersion())?null:"6"},E.prototype.getRecommendedVersion=async function(){let e=(await this._client.getCapabilities())["m.room_versions"];if(!e){e={default:"6",available:{}};for(const t of b)e.available[t]="stable"}let t=this._checkVersionAgainstCapability(e);if(t.urgent&&t.needsUpgrade){h.a.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");if(e=(await this._client.getCapabilities(!0))["m.room_versions"],!e)return h.a.warn("No room version capability - assuming upgrade required."),t;t=this._checkVersionAgainstCapability(e)}return t},E.prototype._checkVersionAgainstCapability=function(e){const t=this.getVersion();h.a.log(`[${this.roomId}] Current version: ${t}`),h.a.log(`[${this.roomId}] Version capability: `,e);const a={version:t,needsUpgrade:!1,urgent:!1};if(t===e.default)return a;return Object.keys(e.available).filter(t=>"stable"===e.available[t]).includes(t)||(a.version=e.default,a.needsUpgrade=!0,a.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),a.urgent?h.a.warn("URGENT upgrade required on "+this.roomId):h.a.warn("Non-urgent upgrade required on "+this.roomId)),a},E.prototype.userMayUpgradeRoom=function(e){return this.currentState.maySendStateEvent("m.room.tombstone",e)},E.prototype.getPendingEvents=function(){if("detached"!==this._opts.pendingEventOrdering)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this._opts.pendingEventOrdering);return this._pendingEventList},E.prototype.removePendingEvent=function(e){if("detached"!==this._opts.pendingEventOrdering)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this._opts.pendingEventOrdering);const t=c.u(this._pendingEventList,(function(t){return t.getId()==e}),!1);return this._savePendingEvents(),t},E.prototype.hasPendingEvent=function(e){return"detached"===this._opts.pendingEventOrdering&&this._pendingEventList.some(t=>t.getId()===e)},E.prototype.getPendingEvent=function(e){return"detached"!==this._opts.pendingEventOrdering?null:this._pendingEventList.find(t=>t.getId()===e)},E.prototype.getLiveTimeline=function(){return this.getUnfilteredTimelineSet().getLiveTimeline()},E.prototype.getLastActiveTimestamp=function(){const e=this.getLiveTimeline().getEvents();if(e.length){return e[e.length-1].getTs()}return Number.MIN_SAFE_INTEGER},E.prototype.getMyMembership=function(){return this._selfMembership},E.prototype.getDMInviter=function(){if(this.myUserId){const e=this.getMember(this.myUserId);if(e)return e.getDMInviter()}if("invite"===this._selfMembership){if(2==this.getInvitedAndJoinedMemberCount()&&this._summaryHeroes.length)return this._summaryHeroes[0]}},E.prototype.guessDMUserId=function(){const e=this.getMember(this.myUserId);if(e){const t=e.getDMInviter();if(t)return t}if(Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length)return this._summaryHeroes[0];const t=this.currentState.getMembers().find(e=>e.userId!==this.myUserId);return t?t.userId:this.myUserId},E.prototype.getAvatarFallbackMember=function(){if(this.getInvitedAndJoinedMemberCount()>2)return;const e=Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length;if(e){const e=this._summaryHeroes.map(e=>this.getMember(e)).find(e=>!!e);if(e)return e}const t=this.currentState.getMembers();if(t.length<=2){const e=t.find(e=>e.userId!==this.myUserId);if(e)return e}if(e){const e=this._summaryHeroes.map(e=>this._client.getUser(e)).find(e=>!!e);if(e){const t=new m.a(this.roomId,e.userId);return t.user=e,t}}},E.prototype.updateMyMembership=function(e){const t=this._selfMembership;this._selfMembership=e,t!==e&&("leave"===e&&this._cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,t))},E.prototype._loadMembersFromServer=async function(){const e=this._client.store.getSyncToken(),t=c.f({not_membership:"leave",at:e}),a=c.g("/rooms/$roomId/members?"+t,{$roomId:this.roomId}),n=this._client.http;return(await n.authedRequest(void 0,"GET",a)).chunk},E.prototype._loadMembers=async function(){let e=!1,t=await this._client.store.getOutOfBandMembers(this.roomId);null===t&&(e=!0,t=await this._loadMembersFromServer(),h.a.log(`LL: got ${t.length} members from server for room `+this.roomId));return{memberEvents:t.map(this._client.getEventMapper()),fromServer:e}},E.prototype.loadMembersIfNeeded=function(){if(this._membersPromise)return this._membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this._loadMembers().then(e=>(this.currentState.setOutOfBandMembers(e.memberEvents),this._client.isCryptoEnabled()&&this._client.isRoomEncrypted(this.roomId)&&this._client.crypto.trackRoomDevices(this.roomId),e.fromServer)).catch(e=>{throw this._membersPromise=null,this.currentState.markOutOfBandMembersFailed(),e});return e.then(e=>{if(e){const e=this.currentState.getMembers().filter(e=>e.isOutOfBand()).map(e=>e.events.member.event);h.a.log("LL: telling store to write "+e.length+" members for room "+this.roomId);return this._client.store.setOutOfBandMembers(this.roomId,e).catch(e=>{h.a.log("LL: storing OOB room members failed, oh well",e)})}}).catch(e=>{h.a.error(e)}),this._membersPromise=e,this._membersPromise},E.prototype.clearLoadedMembersIfNeeded=async function(){this._opts.lazyLoadMembers&&this._membersPromise&&(await this.loadMembersIfNeeded(),await this._client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this._membersPromise=null)},E.prototype._cleanupAfterLeaving=function(){this.clearLoadedMembersIfNeeded().catch(e=>{h.a.error(`error after clearing loaded members from room ${this.roomId} after leaving`),h.a.log(e)})},E.prototype.resetLiveTimeline=function(e,t){for(let a=0;a<this._timelineSets.length;a++)this._timelineSets[a].resetLiveTimeline(e,t);this._fixUpLegacyTimelineFields()},E.prototype._fixUpLegacyTimelineFields=function(){this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(r.a.BACKWARDS),this.currentState=this.getLiveTimeline().getState(r.a.FORWARDS)},E.prototype.hasUnverifiedDevices=async function(){if(!this._client.isRoomEncrypted(this.roomId))return!1;const e=await this.getEncryptionTargetMembers();for(const t of e){if(this._client.getStoredDevicesForUser(t.userId).some(e=>e.isUnverified()))return!0}return!1},E.prototype.getTimelineSets=function(){return this._timelineSets},E.prototype.getUnfilteredTimelineSet=function(){return this._timelineSets[0]},E.prototype.getTimelineForEvent=function(e){return this.getUnfilteredTimelineSet().getTimelineForEvent(e)},E.prototype.addTimeline=function(){return this.getUnfilteredTimelineSet().addTimeline()},E.prototype.findEventById=function(e){return this.getUnfilteredTimelineSet().findEventById(e)},E.prototype.getUnreadNotificationCount=function(e){return e=e||"total",this._notificationCounts[e]},E.prototype.setUnreadNotificationCount=function(e,t){this._notificationCounts[e]=t},E.prototype.setSummary=function(e){const t=e["m.heroes"],a=e["m.joined_member_count"],n=e["m.invited_member_count"];Number.isInteger(a)&&this.currentState.setJoinedMemberCount(a),Number.isInteger(n)&&this.currentState.setInvitedMemberCount(n),Array.isArray(t)&&(this._summaryHeroes=t.filter(e=>e!==this.myUserId))},E.prototype.setBlacklistUnverifiedDevices=function(e){this._blacklistUnverifiedDevices=e},E.prototype.getBlacklistUnverifiedDevices=function(){return this._blacklistUnverifiedDevices},E.prototype.getAvatarUrl=function(e,t,a,n,s){const i=this.currentState.getStateEvents(g.a.RoomAvatar,"");if(void 0===s&&(s=!0),!i&&!s)return null;const o=i?i.getContent().url:null;return o?Object(l.a)(e,o,t,a,n):null},E.prototype.getMxcAvatarUrl=function(){const e=this.currentState.getStateEvents(g.a.RoomAvatar,"");return e?e.getContent().url:null},E.prototype.getAliases=function(){const e=[],t=this.currentState.getStateEvents("m.room.aliases");if(t)for(let a=0;a<t.length;++a){const n=t[a];if(Array.isArray(n.getContent().aliases)){const t=n.getContent().aliases.filter(e=>"string"==typeof e&&("#"===e[0]&&!!e.endsWith(":"+n.getStateKey())));Array.prototype.push.apply(e,t)}}return e},E.prototype.getCanonicalAlias=function(){const e=this.currentState.getStateEvents("m.room.canonical_alias","");return e&&e.getContent().alias||null},E.prototype.getAltAliases=function(){const e=this.currentState.getStateEvents("m.room.canonical_alias","");return e&&e.getContent().alt_aliases||[]},E.prototype.addEventsToTimeline=function(e,t,a,n){a.getTimelineSet().addEventsToTimeline(e,t,a,n)},E.prototype.getMember=function(e){return this.currentState.getMember(e)},E.prototype.getMembers=function(){return this.currentState.getMembers()},E.prototype.getJoinedMembers=function(){return this.getMembersWithMembership("join")},E.prototype.getJoinedMemberCount=function(){return this.currentState.getJoinedMemberCount()},E.prototype.getInvitedMemberCount=function(){return this.currentState.getInvitedMemberCount()},E.prototype.getInvitedAndJoinedMemberCount=function(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()},E.prototype.getMembersWithMembership=function(e){return this.currentState.getMembers().filter((function(t){return t.membership===e}))},E.prototype.getEncryptionTargetMembers=async function(){await this.loadMembersIfNeeded();let e=this.getMembersWithMembership("join");return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership("invite"))),e},E.prototype.shouldEncryptForInvitedMembers=function(){const e=this.currentState.getStateEvents("m.room.history_visibility","");return e&&e.getContent()&&"joined"!==e.getContent().history_visibility},E.prototype.getDefaultRoomName=function(e){return C(this,e,!0)},E.prototype.hasMembershipState=function(e,t){const a=this.getMember(e);return!!a&&a.membership===t},E.prototype.getOrCreateFilteredTimelineSet=function(e){if(this._filteredTimelineSets[e.filterId])return this._filteredTimelineSets[e.filterId];const t=Object.assign({filter:e},this._opts),a=new o.a(this,t);this.reEmitter.reEmit(a,["Room.timeline","Room.timelineReset"]),this._filteredTimelineSets[e.filterId]=a,this._timelineSets.push(a);const n=this.getLiveTimeline();n.getEvents().forEach((function(e){a.addLiveEvent(e)}));let s=n;for(;s.getNeighbouringTimeline(r.a.BACKWARDS);)s=s.getNeighbouringTimeline(r.a.BACKWARDS);return a.getLiveTimeline().setPaginationToken(s.getPaginationToken(r.a.BACKWARDS),r.a.BACKWARDS),a},E.prototype.removeFilteredTimelineSet=function(e){const t=this._filteredTimelineSets[e.filterId];delete this._filteredTimelineSets[e.filterId];const a=this._timelineSets.indexOf(t);a>-1&&this._timelineSets.splice(a,1)},E.prototype._addLiveEvent=function(e,t,a){if(e.isRedaction()){const t=e.event.redacts,a=this.getUnfilteredTimelineSet().findEventById(t);if(a){if(a.makeRedacted(e),a.getStateKey()){this.currentState.getStateEvents(a.getType(),a.getStateKey()).getId()===a.getId()&&this.currentState.setStateEvents([a])}this.emit("Room.redaction",e,this)}}if(e.getUnsigned().transaction_id){const t=this._txnToEvent[e.getUnsigned().transaction_id];if(t)return void this._handleRemoteEcho(e,t)}for(let n=0;n<this._timelineSets.length;n++)this._timelineSets[n].addLiveEvent(e,t,a);e.sender&&"m.room.redaction"!==e.getType()&&this.addReceipt(y(e.sender.userId,e,"m.read"),!0)},E.prototype.addPendingEvent=function(e,t){if(e.status!==d.a.SENDING&&e.status!==d.a.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this._txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);if(r.a.setEventMetadata(e,this.getLiveTimeline().getState(r.a.FORWARDS),!1),this._txnToEvent[t]=e,"detached"==this._opts.pendingEventOrdering){if(this._pendingEventList.some(e=>e.status===d.a.NOT_SENT)&&(h.a.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(d.a.NOT_SENT)),this._pendingEventList.push(e),this._savePendingEvents(),e.isRelation()&&this._aggregateNonLiveRelation(e),e.isRedaction()){const t=e.event.redacts;let a=this._pendingEventList&&this._pendingEventList.find(e=>e.getId()===t);a||(a=this.getUnfilteredTimelineSet().findEventById(t)),a&&(a.markLocallyRedacted(e),this.emit("Room.redaction",e,this))}}else for(let t=0;t<this._timelineSets.length;t++){const a=this._timelineSets[t];a.getFilter()?a.getFilter().filterRoomTimeline([e]).length&&a.addEventToTimeline(e,a.getLiveTimeline(),!1):a.addEventToTimeline(e,a.getLiveTimeline(),!1)}this.emit("Room.localEchoUpdated",e,this,null,null)},E.prototype._savePendingEvents=function(){if(this._pendingEventList){const e=this._pendingEventList.map(e=>v(v({},e.event),{},{txn_id:e.getTxnId()})).filter(e=>{const t="m.room.encrypted"===e.type,a=this._client.isRoomEncrypted(this.roomId);return t||!a}),{store:t}=this._client.sessionStore;this._pendingEventList.length>0?t.setItem(_(this.roomId),JSON.stringify(e)):t.removeItem(_(this.roomId))}},E.prototype._aggregateNonLiveRelation=function(e){for(let t=0;t<this._timelineSets.length;t++){const a=this._timelineSets[t];a.getFilter()?a.getFilter().filterRoomTimeline([e]).length&&a.aggregateRelations(e):a.aggregateRelations(e)}},E.prototype._handleRemoteEcho=function(e,t){const a=t.getId(),n=e.getId(),s=t.status;h.a.debug(`Got remote echo for event ${a} -> ${n} old status `+s),delete this._txnToEvent[e.getUnsigned().transaction_id],this._pendingEventList&&this.removePendingEvent(a),t.handleRemoteEcho(e.event);for(let e=0;e<this._timelineSets.length;e++){this._timelineSets[e].handleRemoteEcho(t,a,n)}this.emit("Room.localEchoUpdated",t,this,a,s)};const S={};function C(e,t,a){if(!a){const t=e.currentState.getStateEvents("m.room.name","");if(t&&t.getContent()&&t.getContent().name)return t.getContent().name}let n=e.getCanonicalAlias();if(!n){const t=e.getAltAliases();t.length&&(n=t[0])}if(n)return n;const s=e.currentState.getJoinedMemberCount()+e.currentState.getInvitedMemberCount()-1;let i=null;if(e._summaryHeroes)i=e._summaryHeroes.map(t=>{const a=e.getMember(t);return a?a.name:t});else{let a=e.currentState.getMembers().filter(e=>e.userId!==t&&("invite"===e.membership||"join"===e.membership));a.sort((e,t)=>e.userId.localeCompare(t.userId)),a=a.slice(0,5),i=a.map(e=>e.name)}if(s)return w(i,s);if("join"==e.getMyMembership()){const t=e.currentState.getStateEvents("m.room.third_party_invite");if(t&&t.length){return"Inviting "+w(t.map(e=>e.getContent().display_name))}}let o=i;return o.length||(o=e.currentState.getMembers().filter(e=>e.userId!==t&&"invite"!==e.membership&&"join"!==e.membership).map(e=>e.name)),o.length?`Empty room (was ${w(o)})`:"Empty room"}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length+1;const a=t-1;if(e.length){if(1===e.length&&a<=1)return e[0];if(2===e.length&&a<=2)return`${e[0]} and ${e[1]}`;return a>1?`${e[0]} and ${a} others`:e[0]+" and 1 other"}return"Empty room"}S[d.a.ENCRYPTING]=[d.a.SENDING,d.a.NOT_SENT],S[d.a.SENDING]=[d.a.ENCRYPTING,d.a.QUEUED,d.a.NOT_SENT,d.a.SENT],S[d.a.QUEUED]=[d.a.SENDING,d.a.CANCELLED],S[d.a.SENT]=[],S[d.a.NOT_SENT]=[d.a.SENDING,d.a.QUEUED,d.a.CANCELLED],S[d.a.CANCELLED]=[],E.prototype.updatePendingEvent=function(e,t,a){if(h.a.log(`setting pendingEvent status to ${t} in ${e.getRoomId()} event ID ${e.getId()} -> ${a}`),t==d.a.SENT&&!a)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==d.a.SENT){if(this.getUnfilteredTimelineSet().eventIdToTimeline(a))return}const n=e.status,s=e.getId();if(!n)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const i=S[n];if(!i||i.indexOf(t)<0)throw new Error("Invalid EventStatus transition "+n+"->"+t);if(e.setStatus(t),t==d.a.SENT){e.replaceLocalEventId(a);for(let e=0;e<this._timelineSets.length;e++)this._timelineSets[e].replaceEventId(s,a)}else if(t==d.a.CANCELLED){if(this._pendingEventList){const e=this._pendingEventList.findIndex(e=>e.getId()===s);if(-1!==e){const[t]=this._pendingEventList.splice(e,1);t.isRedaction()&&this._revertRedactionLocalEcho(t)}}this.removeEvent(s)}this._savePendingEvents(),this.emit("Room.localEchoUpdated",e,this,s,n)},E.prototype._revertRedactionLocalEcho=function(e){const t=e.event.redacts;if(!t)return;const a=this.getUnfilteredTimelineSet().findEventById(t);a&&(a.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),a.isRelation()&&this._aggregateNonLiveRelation(a))},E.prototype.addLiveEvents=function(e,t,a){let n;if(t&&-1===["replace","ignore"].indexOf(t))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(n=0;n<this._timelineSets.length;n++){const e=this._timelineSets[n].getLiveTimeline();if(e.getPaginationToken(r.a.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a pagination token ("+e.getPaginationToken(r.a.FORWARDS)+")");if(e.getNeighbouringTimeline(r.a.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a neighbouring timeline")}for(n=0;n<e.length;n++)this._addLiveEvent(e[n],t,a)},E.prototype.addEphemeralEvents=function(e){for(const t of e)"m.typing"===t.getType()?this.currentState.setTypingEvent(t):"m.receipt"===t.getType()&&this.addReceipt(t)},E.prototype.removeEvents=function(e){for(let t=0;t<e.length;++t)this.removeEvent(e[t])},E.prototype.removeEvent=function(e){let t=!1;for(let a=0;a<this._timelineSets.length;a++){const n=this._timelineSets[a].removeEvent(e);n&&(n.isRedaction()&&this._revertRedactionLocalEcho(n),t=!0)}return t},E.prototype.recalculate=function(){const e=this,t=this.currentState.getStateEvents("m.room.member",this.myUserId);if(t&&"invite"===t.getContent().membership){(t.event.invite_room_state||[]).forEach((function(t){e.currentState.getStateEvents(t.type,t.state_key)||e.currentState.setStateEvents([new d.b({type:t.type,state_key:t.state_key,content:t.content,event_id:"$fake"+Date.now(),room_id:e.roomId,user_id:e.myUserId})])}))}const a=this.name;this.name=C(this,this.myUserId),this.normalizedName=Object(c.q)(this.name),this.summary=new u(this.roomId,{title:this.name}),a!==this.name&&this.emit("Room.name",this)},E.prototype.getUsersReadUpTo=function(e){return this.getReceiptsForEvent(e).filter((function(e){return"m.read"===e.type})).map((function(e){return e.userId}))},E.prototype.getEventReadUpTo=function(e,t){let a=this._receipts;return t&&(a=this._realReceipts),void 0===a["m.read"]||void 0===a["m.read"][e]?null:a["m.read"][e].eventId},E.prototype.hasUserReadEvent=function(e,t){const a=this.getEventReadUpTo(e,!1);if(a===t)return!0;if(this.timeline.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(let e=this.timeline.length-1;e>=0;--e){const n=this.timeline[e];if(n.getId()===t)return!1;if(n.getId()===a)return!0}return!1},E.prototype.getReceiptsForEvent=function(e){return this._receiptCacheByEventId[e.getId()]||[]},E.prototype.addReceipt=function(e,t){void 0===t&&(t=!1),t||this._addReceiptsToStructure(e,this._realReceipts),this._addReceiptsToStructure(e,this._receipts),this._receiptCacheByEventId=this._buildReceiptCache(this._receipts),this.emit("Room.receipt",e,this)},E.prototype._addReceiptsToStructure=function(e,t){const a=this;Object.keys(e.getContent()).forEach((function(n){Object.keys(e.getContent()[n]).forEach((function(s){Object.keys(e.getContent()[n][s]).forEach((function(i){const o=e.getContent()[n][s][i];t[s]||(t[s]={});const r=t[s][i];if(r){const e=a.getUnfilteredTimelineSet().compareEventOrdering(r.eventId,n);if(null!==e&&e>=0)return}else t[s][i]={};t[s][i]={eventId:n,data:o}}))}))}))},E.prototype._buildReceiptCache=function(e){const t={};return Object.keys(e).forEach((function(a){Object.keys(e[a]).forEach((function(n){const s=e[a][n];t[s.eventId]||(t[s.eventId]=[]),t[s.eventId].push({userId:n,type:a,data:s.data})}))})),t},E.prototype._addLocalEchoReceipt=function(e,t,a){this.addReceipt(y(e,t,a),!0)},E.prototype.addTags=function(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)},E.prototype.addAccountData=function(e){for(let t=0;t<e.length;t++){const a=e[t];"m.tag"===a.getType()&&this.addTags(a);const n=this.accountData[a.getType()];this.accountData[a.getType()]=a,this.emit("Room.accountData",a,this,n)}},E.prototype.getAccountData=function(e){return this.accountData[e]},E.prototype.maySendMessage=function(){return"join"===this.getMyMembership()&&this.currentState.maySendEvent("m.room.message",this.myUserId)},E.prototype.canInvite=function(e){let t="join"===this.getMyMembership();const a=this.currentState.getStateEvents(g.a.RoomPowerLevels,""),n=a&&a.getContent(),s=this.getMember(e);return n&&s&&n.invite>s.powerLevel&&(t=!1),t},E.prototype.getJoinRule=function(){return this.currentState.getJoinRule()},E.prototype.getType=function(){const e=this.currentState.getStateEvents("m.room.create","");if(e)return e.getContent()[g.c];this.getTypeWarning||(h.a.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)},E.prototype.isSpaceRoom=function(){return this.getType()===g.d.Space}},440:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(102),l=a.n(r),c=a(167),d=a(269),m=a(184),u=a(99),h=a(110);var p,g,f=a(93),v=a(339),b=a(185),y=a(94);function E(e){switch(e){case g.Globe:return Object(f.a)("This room is public");case g.PresenceOnline:return Object(f.a)("Online");case g.PresenceAway:return Object(f.a)("Away");case g.PresenceOffline:return Object(f.a)("Offline")}}!function(e){e.None="NONE",e.Globe="GLOBE",e.PresenceOnline="ONLINE",e.PresenceAway="AWAY",e.PresenceOffline="OFFLINE"}(g||(g={}));let _=Object(y.a)("views.avatars.DecoratedRoomAvatar")(p=class extends o.a.PureComponent{constructor(e){super(e),s()(this,"_dmUser",void 0),s()(this,"isUnmounted",!1),s()(this,"isWatchingTimeline",!1),s()(this,"onRoomTimeline",(e,t)=>{if(!this.isUnmounted&&t&&this.props.room.roomId===t.roomId&&("m.room.join_rules"===e.getType()||"m.room.member"===e.getType())){const e=this.calculateIcon();e!==this.state.icon&&this.setState({icon:e})}}),s()(this,"onPresenceUpdate",()=>{if(this.isUnmounted)return;const e=this.getPresenceIcon();e!==this.state.icon&&this.setState({icon:e})}),this.state={notificationState:m.a.instance.getRoomState(this.props.room),icon:this.calculateIcon()}}componentWillUnmount(){this.isUnmounted=!0,this.isWatchingTimeline&&this.props.room.off("Room.timeline",this.onRoomTimeline),this.dmUser=null}get isPublicRoom(){const e=this.props.room.currentState.getStateEvents("m.room.join_rules","");return"public"===(e&&e.getContent().join_rule)}get dmUser(){return this._dmUser}set dmUser(e){const t=this._dmUser;this._dmUser=e,t&&t!==this._dmUser&&(t.off("User.currentlyActive",this.onPresenceUpdate),t.off("User.presence",this.onPresenceUpdate)),this._dmUser&&t!==this._dmUser&&(this._dmUser.on("User.currentlyActive",this.onPresenceUpdate),this._dmUser.on("User.presence",this.onPresenceUpdate))}getPresenceIcon(){if(!this.dmUser)return g.None;let e=g.None;return this.dmUser.currentlyActive||"online"===this.dmUser.presence?e=g.PresenceOnline:"offline"===this.dmUser.presence?e=g.PresenceOffline:"unavailable"===this.dmUser.presence&&(e=g.PresenceAway),e}calculateIcon(){let e=g.None;const t=b.a.shared().getUserIdForRoomId(this.props.room.roomId);return t&&2===this.props.room.getJoinedMemberCount()?function(){const e=u.a.get().baseUrl,t=h.a.get().enable_presence_by_hs_url;return!t||!(!t[e]&&void 0!==t[e])}()&&t&&(this.dmUser=u.a.get().getUser(t),e=this.getPresenceIcon()):(e=this.isPublicRoom?g.Globe:g.None,this.isWatchingTimeline||(this.props.room.on("Room.timeline",this.onRoomTimeline),this.isWatchingTimeline=!0)),e}render(){let e,t;this.props.displayBadge&&(e=o.a.createElement(d.a,{notification:this.state.notificationState,forceCount:this.props.forceCount,roomId:this.props.room.roomId})),this.state.icon!==g.None&&(t=o.a.createElement(v.a,{tooltip:E(this.state.icon),class:"mx_DecoratedRoomAvatar_icon mx_DecoratedRoomAvatar_icon_"+this.state.icon.toLowerCase()}));const a=l()("mx_DecoratedRoomAvatar",{mx_DecoratedRoomAvatar_cutout:t});return o.a.createElement("div",{className:a},o.a.createElement(c.a,{room:this.props.room,width:this.props.avatarSize,height:this.props.avatarSize,oobData:this.props.oobData,viewAvatarOnClick:this.props.viewAvatarOnClick}),t,e)}})||p},441:function(e,t,a){"use strict";a.d(t,"c",(function(){return E})),a.d(t,"a",(function(){return _})),a.d(t,"b",(function(){return S})),a.d(t,"d",(function(){return C}));var n=a(19),s=a.n(n),i=a(2750),o=a(2751),r=a(430),l=a(206),c=a(9),d=a(8),m=a.n(d),u=a(591);const h=new u.a;class p{constructor(){}static for(e,t){if(!e||!t)throw new Error("An instance and key must be supplied");return new g(e,t)}static forgetAllFor(e){h.delete(e)}static forgetAll(){for(const e of h.keys())h.remove(e)}}s()(p,"Void",Symbol("void"));class g{constructor(e,t){this.instance=e,this.key=t}forget(){const e=h.get(this.instance);e&&(e.remove(this.key),e.size||h.remove(this.instance))}do(e){const t=h.getOrCreate(this.instance,new u.a);let a=t.get(this.key);return void 0===a&&(a=e(),t.set(this.key,a)),a}}var f=a(6),v=a(142),b=a(442),y=a(1439);const E=48e3,_=44;let S;!function(e){e.Started="started",e.EndingSoon="ending_soon",e.Ended="ended",e.Uploading="uploading",e.Uploaded="uploaded"}(S||(S={}));class C extends m.a{constructor(e){super(),this.client=e,s()(this,"recorder",void 0),s()(this,"recorderContext",void 0),s()(this,"recorderSource",void 0),s()(this,"recorderStream",void 0),s()(this,"recorderFFT",void 0),s()(this,"recorderWorklet",void 0),s()(this,"recorderProcessor",void 0),s()(this,"buffer",new Uint8Array(0)),s()(this,"mxc",void 0),s()(this,"recording",!1),s()(this,"observable",void 0),s()(this,"amplitudes",[]),s()(this,"playback",void 0),s()(this,"onAudioProcess",e=>{this.processAudioUpdate(e.playbackTime)}),s()(this,"processAudioUpdate",e=>{if(!this.recording)return;const t=new Float32Array(this.recorderFFT.fftSize);if(this.recorderFFT.getFloatTimeDomainData)this.recorderFFT.getFloatTimeDomainData(t);else{const e=new Uint8Array(this.recorderFFT.fftSize);this.recorderFFT.getByteTimeDomainData(e);for(let a=0;a<e.length;a++)t[a]=Object(c.d)(Object(c.c)(e[a],0,256),-1,1)}const a=[];for(let e=0;e<t.length;e++)a.push(Object(c.a)(t[e],0,1));this.observable.update({waveform:a,timeSeconds:e});const n=120-this.recorder.encodedSamplePosition/48e3;n<0?this.stop():n<=10&&p.for(this,"ending_soon").do(()=>(this.emit(S.EndingSoon,{secondsLeft:n}),p.Void))})}get contentType(){return"audio/ogg"}get contentLength(){return this.buffer.length}get durationSeconds(){if(!this.recorder)throw new Error("Duration not available without a recording");return this.recorderContext.currentTime}get isRecording(){return this.recording}emit(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];return super.emit(e,...a),super.emit(v.b,e,...a),!0}async makeRecorder(){try{this.recorderStream=await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,noiseSuppression:!0,deviceId:r.a.getAudioInput()}}),this.recorderContext=Object(y.a)({}),this.recorderSource=this.recorderContext.createMediaStreamSource(this.recorderStream),this.recorderFFT=this.recorderContext.createAnalyser(),this.recorderFFT.fftSize=64;const e=document.body.dataset.vectorRecorderWorkletScript;if(!e)throw new Error("Unable to create recorder: no worklet script registered");this.recorderSource.connect(this.recorderFFT),this.recorderContext.audioWorklet?(await this.recorderContext.audioWorklet.addModule(e),this.recorderWorklet=new AudioWorkletNode(this.recorderContext,f.b),this.recorderSource.connect(this.recorderWorklet),this.recorderWorklet.connect(this.recorderContext.destination),this.recorderWorklet.port.onmessage=e=>{switch(e.data.ev){case f.a.Timekeep:this.processAudioUpdate(e.data.timeSeconds);break;case f.a.AmplitudeMark:e.data.forSecond===this.amplitudes.length&&this.amplitudes.push(e.data.amplitude)}}):(this.recorderProcessor=this.recorderContext.createScriptProcessor(1024,1,1),this.recorderSource.connect(this.recorderProcessor),this.recorderProcessor.connect(this.recorderContext.destination),this.recorderProcessor.addEventListener("audioprocess",this.onAudioProcess)),this.recorder=new i({encoderPath:o.a,encoderSampleRate:E,encoderApplication:2048,streamPages:!0,encoderFrameSize:20,numberOfChannels:1,sourceNode:this.recorderSource,encoderBitRate:24e3,encoderComplexity:3,resampleQuality:3}),this.recorder.ondataavailable=e=>{const t=new Uint8Array(e),a=new Uint8Array(this.buffer.length+t.length);a.set(this.buffer,0),a.set(t,this.buffer.length),this.buffer=a}}catch(e){throw console.error("Error starting recording: ",e),e instanceof DOMException&&console.error(`${e.name} (${e.code}): ${e.message}`),this.recorderStream&&this.recorderStream.getTracks().forEach(e=>e.stop()),this.recorderSource&&this.recorderSource.disconnect(),this.recorder&&this.recorder.close(),this.recorderContext&&this.recorderContext.close(),e}}get audioBuffer(){return this.buffer.slice(0)}get liveData(){if(!this.recording)throw new Error("No observable when not recording");return this.observable}get isSupported(){return!!i.isRecordingSupported()}get hasRecording(){return this.buffer.length>0}get mxcUri(){if(!this.mxc)throw new Error("Recording has not been uploaded yet");return this.mxc}async start(){if(this.mxc||this.hasRecording)throw new Error("Recording already prepared");if(this.recording)throw new Error("Recording already in progress");this.observable&&this.observable.close(),this.observable=new l.SimpleObservable,await this.makeRecorder(),await this.recorder.start(),this.recording=!0,this.emit(S.Started)}async stop(){return p.for(this,"stop").do(async()=>{if(!this.recording)throw new Error("No recording to stop");return await this.recorder.stop(),this.recorderSource.disconnect(),this.recorderWorklet&&this.recorderWorklet.disconnect(),this.recorderProcessor&&(this.recorderProcessor.disconnect(),this.recorderProcessor.removeEventListener("audioprocess",this.onAudioProcess)),await this.recorderContext.close(),this.recorderStream.getTracks().forEach(e=>e.stop()),this.recording=!1,await this.recorder.close(),this.emit(S.Ended),this.audioBuffer})}getPlayback(){return this.playback=p.for(this,"playback").do(()=>new b.b(this.audioBuffer.buffer,this.amplitudes)),this.playback}destroy(){var e;this.stop(),this.removeAllListeners(),p.forgetAllFor(this),null===(e=this.playback)||void 0===e||e.destroy(),this.observable.close()}async upload(){if(!this.hasRecording)throw new Error("No recording available to upload");return this.mxc||(this.emit(S.Uploading),this.mxc=await this.client.uploadContent(new Blob([this.audioBuffer],{type:this.contentType}),{onlyContentUri:!1}).then(e=>e.content_uri),this.emit(S.Uploaded)),this.mxc}}},442:function(e,t,a){"use strict";a.d(t,"c",(function(){return h})),a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return f}));var n=a(19),s=a.n(n),i=a(8),o=a.n(i),r=a(142),l=a(153),c=a(206);class d{constructor(e){this.context=e,s()(this,"clipStart",0),s()(this,"stopped",!0),s()(this,"lastCheck",0),s()(this,"observable",new c.SimpleObservable),s()(this,"timerId",void 0),s()(this,"clipDuration",0),s()(this,"checkTime",()=>{const e=this.timeSeconds;this.lastCheck!==e&&(this.observable.update([e,this.durationSeconds]),this.lastCheck=e)})}get durationSeconds(){return this.clipDuration}set durationSeconds(e){this.clipDuration=e,this.observable.update([this.timeSeconds,this.clipDuration])}get timeSeconds(){return(this.context.currentTime-this.clipStart)%this.clipDuration}get liveData(){return this.observable}flagLoadTime(){this.clipStart=this.context.currentTime}flagStart(){this.stopped&&(this.clipStart=this.context.currentTime,this.stopped=!1),this.timerId||(this.timerId=setInterval(this.checkTime,100))}flagStop(){this.stopped=!0}destroy(){this.observable.close(),this.timerId&&clearInterval(this.timerId)}}var m=a(1439),u=a(9);let h;!function(e){e.Decoding="decoding",e.Stopped="stopped",e.Paused="paused",e.Playing="playing"}(h||(h={}));const p=39,g=Object(l.h)(0,p);class f extends o.a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g;super(),this.buf=e,s()(this,"context",void 0),s()(this,"source",void 0),s()(this,"state",h.Decoding),s()(this,"audioBuf",void 0),s()(this,"resampledWaveform",void 0),s()(this,"waveformObservable",new c.SimpleObservable),s()(this,"clock",void 0),s()(this,"onPlaybackEnd",async()=>{await this.context.suspend(),this.emit(h.Stopped)}),this.context=Object(m.a)(),this.resampledWaveform=Object(l.c)(null!=t?t:g,p),this.waveformObservable.update(this.resampledWaveform),this.clock=new d(this.context)}get waveform(){return this.resampledWaveform}get waveformData(){return this.waveformObservable}get clockInfo(){return this.clock}get currentState(){return this.state}get isPlaying(){return this.currentState===h.Playing}emit(e){this.state=e;for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];return super.emit(e,...a),super.emit(r.b,e,...a),!0}destroy(){this.stop(),this.removeAllListeners(),this.clock.destroy(),this.waveformObservable.close()}async prepare(){this.audioBuf=await new Promise((e,t)=>{this.context.decodeAudioData(this.buf,t=>e(t),async a=>{console.error("Error decoding recording: ",a),console.warn("Trying to re-encode to WAV instead...");const n=await Object(m.b)(this.buf);this.context.decodeAudioData(n,t=>e(t),e=>{console.error("Still failed to decode recording: ",e),t(e)})})});const e=Array.from(this.audioBuf.getChannelData(0));this.resampledWaveform=function(e){const t=e.map(e=>Math.abs(e)),a=Object(l.g)(Object(l.i)(t,p),0,1).map(e=>Object(u.a)(e,.1,.5));return Object(l.g)(a,0,1)}(e),this.waveformObservable.update(this.resampledWaveform),this.emit(h.Stopped),this.clock.flagLoadTime(),this.clock.durationSeconds=this.audioBuf.duration}async play(){this.state===h.Stopped&&(this.source&&(this.source.disconnect(),this.source.removeEventListener("ended",this.onPlaybackEnd)),this.source=this.context.createBufferSource(),this.source.connect(this.context.destination),this.source.buffer=this.audioBuf,this.source.start(),this.source.addEventListener("ended",this.onPlaybackEnd)),await this.context.resume(),this.clock.flagStart(),this.emit(h.Playing)}async pause(){await this.context.suspend(),this.emit(h.Paused)}async stop(){await this.onPlaybackEnd(),this.clock.flagStop()}async toggle(){this.isPlaying?await this.pause():await this.play()}}},443:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(346);function s(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}function i(e){e=e||{},this.rooms={},this.groups={},this.users={},this.syncToken=null,this.filters={},this.accountData={},this.localStorage=e.localStorage,this._oobMembers={},this._clientOptions={}}i.prototype={getSyncToken:function(){return this.syncToken},isNewlyCreated:function(){return Promise.resolve(!0)},setSyncToken:function(e){this.syncToken=e},storeGroup:function(e){this.groups[e.groupId]=e},getGroup:function(e){return this.groups[e]||null},getGroups:function(){return Object.values(this.groups)},storeRoom:function(e){this.rooms[e.roomId]=e,e.currentState.on("RoomState.members",this._onRoomMember.bind(this));const t=this;e.currentState.getMembers().forEach((function(a){t._onRoomMember(null,e.currentState,a)}))},_onRoomMember:function(e,t,a){if("invite"===a.membership)return;const s=this.users[a.userId]||new n.a(a.userId);a.name&&(s.setDisplayName(a.name),a.events.member&&s.setRawDisplayName(a.events.member.getDirectionalContent().displayname)),a.events.member&&a.events.member.getContent().avatar_url&&s.setAvatarUrl(a.events.member.getContent().avatar_url),this.users[s.userId]=s},getRoom:function(e){return this.rooms[e]||null},getRooms:function(){return Object.values(this.rooms)},removeRoom:function(e){this.rooms[e]&&this.rooms[e].removeListener("RoomState.members",this._onRoomMember),delete this.rooms[e]},getRoomSummaries:function(){return Object.values(this.rooms).map((function(e){return e.summary}))},storeUser:function(e){this.users[e.userId]=e},getUser:function(e){return this.users[e]||null},getUsers:function(){return Object.values(this.users)},scrollback:function(e,t){return[]},storeEvents:function(e,t,a,n){},storeFilter:function(e){e&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)},getFilter:function(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null},getFilterIdByName:function(e){if(!this.localStorage)return null;const t="mxjssdk_memory_filter_"+e;try{const e=this.localStorage.getItem(t);if(s(e))return e}catch(e){}return null},setFilterIdByName:function(e,t){if(!this.localStorage)return;const a="mxjssdk_memory_filter_"+e;try{s(t)?this.localStorage.setItem(a,t):this.localStorage.removeItem(a)}catch(e){}},storeAccountDataEvents:function(e){const t=this;e.forEach((function(e){t.accountData[e.getType()]=e}))},getAccountData:function(e){return this.accountData[e]},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(e){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()},getOutOfBandMembers:function(e){return Promise.resolve(this._oobMembers[e]||null)},setOutOfBandMembers:function(e,t){return this._oobMembers[e]=t,Promise.resolve()},clearOutOfBandMembers:function(){return this._oobMembers={},Promise.resolve()},getClientOptions:function(){return Promise.resolve(this._clientOptions)},storeClientOptions:function(e){return this._clientOptions=Object.assign({},e),Promise.resolve()}}},444:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(1);function s(e,t,a,s,i,o){if("string"!=typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return o?t:"";let r=t.slice(6),l="/_matrix/media/r0/download/";const c={};a&&(c.width=Math.round(a)),s&&(c.height=Math.round(s)),i&&(c.method=i),Object.keys(c).length>0&&(l="/_matrix/media/r0/thumbnail/");const d=r.indexOf("#");let m="";return d>=0&&(m=r.substr(d),r=r.substr(0,d)),e+l+r+(0===Object.keys(c).length?"":"?"+n.f(c))+m}},463:function(e,t,a){},475:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(1),s=a(0);const i=["override","content","room","sender","underride"],o=[{rule_id:".m.rule.tombstone",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.room.tombstone"},{kind:"event_match",key:"state_key",pattern:""}],actions:["notify",{set_tweak:"highlight",value:!0}]},{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.reaction"}],actions:["dont_notify"]}];function r(e){const t={},a=(e,t)=>{for(let a=0;a<i.length;++a){const n=i[a],o=t[n];if(o)for(let t=0;t<o.length;++t){const a=o[t];if(!a.enabled)continue;const i=s(n,a);if(i&&this.ruleMatchesEvent(i,e))return a.kind=n,a}}return null},s=function(e,t){const a={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case"underride":case"override":a.conditions=t.conditions;break;case"room":if(!t.rule_id)return null;a.conditions.push({kind:"event_match",key:"room_id",value:t.rule_id});break;case"sender":if(!t.rule_id)return null;a.conditions.push({kind:"event_match",key:"user_id",value:t.rule_id});break;case"content":if(!t.pattern)return null;a.conditions.push({kind:"event_match",key:"content.body",pattern:t.pattern})}return a},o=function(e,t){const a={event_match:m,contains_display_name:d,room_member_count:c,sender_notification_permission:l};return!!a[e.kind]&&a[e.kind](e,t)},l=function(t,a){const n=t.key;if(!n)return!1;const s=e.getRoom(a.getRoomId());return!(!s||!s.currentState)&&s.currentState.mayTriggerNotifOfType(n,a.getSender())},c=function(t,a){if(!t.is)return!1;const n=e.getRoom(a.getRoomId());if(!n||!n.currentState||!n.currentState.members)return!1;const s=n.currentState.getJoinedMemberCount(),i=t.is.match(/^([=<>]*)([0-9]*)$/);if(!i)return!1;const o=i[1],r=parseInt(i[2]);if(isNaN(r))return!1;switch(o){case"":case"==":return s==r;case"<":return s<r;case">":return s>r;case"<=":return s<=r;case">=":return s>=r;default:return!1}},d=function(t,a){let s=a.getContent();if(a.isEncrypted()&&a.getClearContent()&&(s=a.getClearContent()),!s||!s.body||"string"!=typeof s.body)return!1;const i=e.getRoom(a.getRoomId());if(!(i&&i.currentState&&i.currentState.members&&i.currentState.getMember(e.credentials.userId)))return!1;const o=i.currentState.getMember(e.credentials.userId).name,r=new RegExp("(^|\\W)"+Object(n.i)(o)+"(\\W|$)","i");return s.body.search(r)>-1},m=function(e,t){if(!e.key)return!1;const a=h(e.key,t);if("string"!=typeof a)return!1;if(e.value)return e.value===a;if("string"!=typeof e.pattern)return!1;let n;return n="content.body"==e.key?u("(^|\\W)",e.pattern,"(\\W|$)"):u("^",e.pattern,"$"),!!a.match(n)},u=function(e,a,s){return t[a]||(t[a]=new RegExp(e+Object(n.l)(a)+s,"i")),t[a]},h=function(e,t){const a=e.split(".");let s;const i=a[0];for("content"===i?(s=t.getContent(),a.shift()):"type"===i?(s=t.getType(),a.shift()):s=t.event;a.length>0;){const e=a.shift();if(Object(n.o)(s[e]))return null;s=s[e]}return s},p=function(t,n){const s=function(t,n){return n?t.getSender()===e.credentials.userId?null:a(t,n.global):null}(t,n);if(!s)return{};const i=r.actionListToActionsObject(s.actions);return void 0===i.tweaks.highlight&&(i.tweaks.highlight="content"==s.kind),i};this.ruleMatchesEvent=function(e,t){let a=!0;for(let n=0;n<e.conditions.length;++n){const s=e.conditions[n];a&=o(s,t)}return a},this.actionsForEvent=function(t){return p(t,e.pushRules)},this.getPushRuleById=function(t){for(const a of["global"])if(void 0!==e.pushRules[a])for(const n of i)if(void 0!==e.pushRules[a][n])for(const s of e.pushRules[a][n])if(s.rule_id===t)return s;return null}}r.actionListToActionsObject=function(e){const t={notify:!1,tweaks:{}};for(let a=0;a<e.length;++a){const n=e[a];"notify"===n?t.notify=!0:"object"==typeof n&&(void 0===n.value&&(n.value=!0),t.tweaks[n.set_tweak]=n.value)}return t},r.rewriteDefaultRules=function(e){let t=JSON.parse(JSON.stringify(e));t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]);const a=t.global.override;for(const e of o){const t=a.find(t=>t.rule_id===e.rule_id);if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{const t=e.rule_id;s.a.warn("Adding default global override for "+t),a.push(e)}}return t}},477:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return s}));const n="filter_changed";let s;!function(e){e[e.Prefilter=0]="Prefilter",e[e.Runtime=1]="Runtime"}(s||(s={}))},480:function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return o})),a.d(t,"e",(function(){return r})),a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return m}));var n=a(2380);const s=new Map,i=new Map,o=new Map,r=e=>s.get(d(e)),l=["people","people","control","nature","foods","places","activity","objects","symbols","flags"],c={people:[],nature:[],foods:[],places:[],activity:[],objects:[],symbols:[],flags:[]};function d(e){return e.replace(/[\uFE00-\uFE0F]$/,"")}n.forEach(e=>{const t=l[e.group];c.hasOwnProperty(t)&&c[t].push(e),e.filterString=(`${e.annotation}\n${e.shortcodes.join("\n")}}\n${e.emoticon||""}\n`+e.unicode.split("‍").join("\n")).toLowerCase(),s.set(d(e.unicode),e),e.emoticon&&i.set(e.emoticon,e),e.shortcodes&&e.shortcodes.forEach(t=>{o.set(t,e)})});const m=n},483:function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"d",(function(){return r})),a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c}));var n=a(329),s=a(110),i=a(99);function o(){return s.a.get().validated_server_config.isUrl}function r(){const e=o();i.a.get().setAccountData("m.identity_server",{base_url:e})}async function l(e){let t;try{t=await i.a.get().getTerms(n.a.IS,e)}catch(e){if(console.error(e),"rejected"!==e.cors&&404!==e.httpStatus)throw e;t=null}return t&&t.policies&&Object.keys(t.policies).length>0}function c(){const e=i.a.get().getAccountData("m.identity_server");return e&&e.getContent()&&e.getContent().base_url}},484:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(258),s=a.n(n),i=a(0),o=a(1);function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class c{constructor(){this._outgoingRoomKeyRequests=[],this._account=null,this._crossSigningKeys=null,this._privateKeys={},this._backupKeys={},this._sessions={},this._sessionProblems={},this._notifiedErrorDevices={},this._inboundGroupSessions={},this._inboundGroupSessionsWithheld={},this._deviceData=null,this._rooms={},this._sessionsNeedingBackup={},this._sharedHistoryInboundGroupSessions={}}async startup(){return this}deleteAllData(){return Promise.resolve()}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return o.t(()=>{const a=this._getOutgoingRoomKeyRequest(t);return a?(i.a.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),a):(i.a.log(`enqueueing key request for ${t.room_id} / `+t.session_id),this._outgoingRoomKeyRequests.push(e),e)})}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(const t of this._outgoingRoomKeyRequests)if(o.c(t.requestBody,e))return t;return null}getOutgoingRoomKeyRequestByState(e){for(const t of this._outgoingRoomKeyRequests)for(const a of e)if(t.state===a)return Promise.resolve(t);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(e){return Promise.resolve(this._outgoingRoomKeyRequests.filter(t=>t.state==e))}getOutgoingRoomKeyRequestsByTarget(e,t,a){const n=[];for(const s of this._outgoingRoomKeyRequests)for(const i of a)s.state===i&&s.recipients.includes({userId:e,deviceId:t})&&n.push(s);return Promise.resolve(n)}updateOutgoingRoomKeyRequest(e,t,a){for(const n of this._outgoingRoomKeyRequests)if(n.requestId===e)return n.state!=t?(i.a.warn(`Cannot update room key request from ${t} as it was already updated to `+n.state),Promise.resolve(null)):(Object.assign(n,a),Promise.resolve(n));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,t){for(let a=0;a<this._outgoingRoomKeyRequests.length;a++){const n=this._outgoingRoomKeyRequests[a];if(n.requestId===e)return n.state!=t?(i.a.warn(`Cannot delete room key request in state ${n.state} (expected ${t})`),Promise.resolve(null)):(this._outgoingRoomKeyRequests.splice(a,1),Promise.resolve(n))}return Promise.resolve(null)}getAccount(e,t){t(this._account)}storeAccount(e,t){this._account=t}getCrossSigningKeys(e,t){t(this._crossSigningKeys)}getSecretStorePrivateKey(e,t,a){return t(this._privateKeys[a]||null)}storeCrossSigningKeys(e,t){this._crossSigningKeys=t}storeSecretStorePrivateKey(e,t,a){this._privateKeys[t]=a}countEndToEndSessions(e,t){return Object.keys(this._sessions).length}getEndToEndSession(e,t,a,n){n((this._sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,a){a(this._sessions[e]||{})}getAllEndToEndSessions(e,t){Object.entries(this._sessions).forEach(e=>{let[a,n]=e;Object.entries(n).forEach(e=>{let[n,s]=e;t(l(l({},s),{},{deviceKey:a,sessionId:n}))})})}storeEndToEndSession(e,t,a,n){let s=this._sessions[e];void 0===s&&(s={},this._sessions[e]=s),s[t]=a}async storeEndToEndSessionProblem(e,t,a){const n=this._sessionProblems[e]=this._sessionProblems[e]||[];n.push({type:t,fixed:a,time:Date.now()}),n.sort((e,t)=>e.time-t.time)}async getEndToEndSessionProblem(e,t){const a=this._sessionProblems[e]||[];if(!a.length)return null;const n=a[a.length-1];for(const e of a)if(e.time>t)return Object.assign({},e,{fixed:n.fixed});return n.fixed?null:n}async filterOutNotifiedErrorDevices(e){const t=this._notifiedErrorDevices,a=[];for(const n of e){const{userId:e,deviceInfo:s}=n;e in t?s.deviceId in t[e]||(a.push(n),t[e][s.deviceId]=!0):(a.push(n),t[e]={[s.deviceId]:!0})}return a}getEndToEndInboundGroupSession(e,t,a,n){const s=e+"/"+t;n(this._inboundGroupSessions[s]||null,this._inboundGroupSessionsWithheld[s]||null)}getAllEndToEndInboundGroupSessions(e,t){for(const e of Object.keys(this._inboundGroupSessions))t({senderKey:e.substr(0,43),sessionId:e.substr(44),sessionData:this._inboundGroupSessions[e]});t(null)}addEndToEndInboundGroupSession(e,t,a,n){const s=e+"/"+t;void 0===this._inboundGroupSessions[s]&&(this._inboundGroupSessions[s]=a)}storeEndToEndInboundGroupSession(e,t,a,n){this._inboundGroupSessions[e+"/"+t]=a}storeEndToEndInboundGroupSessionWithheld(e,t,a,n){const s=e+"/"+t;this._inboundGroupSessionsWithheld[s]=a}getEndToEndDeviceData(e,t){t(this._deviceData)}storeEndToEndDeviceData(e,t){this._deviceData=e}storeEndToEndRoom(e,t,a){this._rooms[e]=t}getEndToEndRooms(e,t){t(this._rooms)}getSessionsNeedingBackup(e){const t=[];for(const a in this._sessionsNeedingBackup)if(this._inboundGroupSessions[a]&&(t.push({senderKey:a.substr(0,43),sessionId:a.substr(44),sessionData:this._inboundGroupSessions[a]}),e&&a.length>=e))break;return Promise.resolve(t)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this._sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;delete this._sessionsNeedingBackup[e]}return Promise.resolve()}markSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;this._sessionsNeedingBackup[e]=!0}return Promise.resolve()}addSharedHistoryInboundGroupSession(e,t,a){const n=this._sharedHistoryInboundGroupSessions[e]||[];n.push([t,a]),this._sharedHistoryInboundGroupSessions[e]=n}getSharedHistoryInboundGroupSessions(e){return Promise.resolve(this._sharedHistoryInboundGroupSessions[e]||[])}doTxn(e,t,a){return Promise.resolve(a(null))}}},485:function(e,t,a){"use strict";(function(e){a.d(t,"h",(function(){return m})),a.d(t,"i",(function(){return u})),a.d(t,"e",(function(){return h})),a.d(t,"f",(function(){return p})),a.d(t,"g",(function(){return g})),a.d(t,"d",(function(){return f})),a.d(t,"c",(function(){return b})),a.d(t,"b",(function(){return y})),a.d(t,"a",(function(){return E})),a.d(t,"j",(function(){return _}));var n=a(258),s=a.n(n),i=a(2406),o=a(1),r=a(0),l=a(2407);function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const m="/_matrix/client/r0",u="/_matrix/client/unstable",h="/_matrix/identity/api/v1",p="/_matrix/identity/v2",g="/_matrix/media/r0";function f(e,t){o.a(t,["baseUrl","request","prefix"]),t.onlyData=t.onlyData||!1,this.event_emitter=e,this.opts=t,this.useAuthorizationHeader=Boolean(t.useAuthorizationHeader),this.uploads=[]}f.prototype={setIdBaseUrl:function(e){this.opts.idBaseUrl=e},getContentUri:function(){const e={access_token:this.opts.accessToken};return{base:this.opts.baseUrl,path:"/_matrix/media/r0/upload",params:e}},uploadContent:function(t,a){o.n(a)?a={callback:a}:void 0===a&&(a={});const n=!1!==a.includeFilename,s=a.type||t.type||"application/octet-stream",i=a.name||t.name;let c=t;c.stream&&"function"!=typeof c.stream&&(r.a.warn("Using `file.stream` as the content to upload. Future versions of the js-sdk will change this to expect `file` to be the content directly."),c=c.stream);let d=a.rawResponse;void 0===d&&(e.XMLHttpRequest?d=!1:(r.a.warn("Returning the raw JSON from uploadContent(). Future versions of the js-sdk will change this default, to return the parsed object. Set opts.rawResponse=false to change this behaviour now."),d=!0));let m=a.onlyContentUri;d||void 0!==m||(e.XMLHttpRequest?(r.a.warn("Returning only the content-uri from uploadContent(). Future versions of the js-sdk will change this default, to return the whole response object. Set opts.onlyContentUri=false to change this behaviour now."),m=!0):m=!1);const u={loaded:0,total:0};let h,p=null;if(d||(p=function(e){let t=JSON.parse(e);if(m&&(t=t.content_uri,void 0===t))throw Error("Bad response");return t}),e.XMLHttpRequest){const t=o.e(),r=new e.XMLHttpRequest;u.xhr=r;const d=v(t,a.callback,this.opts.onlyData),m=function(){r.abort(),d(new Error("Timeout"))};r.timeout_timer=l.b(m,3e4),r.onreadystatechange=function(){let t;switch(r.readyState){case e.XMLHttpRequest.DONE:l.a(r.timeout_timer);try{if(0===r.status)throw new E;if(!r.responseText)throw new Error("No response body.");t=r.responseText,p&&(t=p(t))}catch(e){return e.http_status=r.status,void d(e)}d(void 0,r,t)}},r.upload.addEventListener("progress",(function(e){l.a(r.timeout_timer),u.loaded=e.loaded,u.total=e.total,r.timeout_timer=l.b(m,3e4),a.progressHandler&&a.progressHandler({loaded:e.loaded,total:e.total})}));let g=this.opts.baseUrl+"/_matrix/media/r0/upload";const f=[];n&&i&&f.push("filename="+encodeURIComponent(i)),this.useAuthorizationHeader||f.push("access_token="+encodeURIComponent(this.opts.accessToken)),f.length>0&&(g+="?"+f.join("&")),r.open("POST",g),this.useAuthorizationHeader&&r.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),r.setRequestHeader("Content-Type",s),r.send(c),h=t.promise,h.abort=r.abort.bind(r)}else{const e={};n&&i&&(e.filename=i),h=this.authedRequest(a.callback,"POST","/upload",e,c,{prefix:"/_matrix/media/r0",headers:{"Content-Type":s},json:!1,bodyParser:p})}const g=this,f=h.finally((function(){for(let e=0;e<g.uploads.length;++e)if(g.uploads[e]===u)return void g.uploads.splice(e,1)}));return f.abort=h.abort,u.promise=f,this.uploads.push(u),f},cancelUpload:function(e){return!!e.abort&&(e.abort(),!0)},getCurrentUploads:function(){return this.uploads},idServerRequest:function(e,t,a,n,s,i){if(!this.opts.idBaseUrl)throw new Error("No Identity Server base URL set");const r=this.opts.idBaseUrl+s+a;if(void 0!==e&&!o.n(e))throw Error("Expected callback to be a function but got "+typeof e);const l={uri:r,method:t,withCredentials:!1,json:!0,_matrix_opts:this.opts,headers:{}};"GET"===t?l.qs=n:"object"==typeof n&&(l.json=n),i&&(l.headers.Authorization="Bearer "+i);const c=o.e();return this.opts.request(l,v(c,e,this.opts.onlyData)),c.promise},authedRequest:function(e,t,a,n,s,i){n||(n={}),this.useAuthorizationHeader?(isFinite(i)&&(i={localTimeoutMs:i}),i||(i={}),i.headers||(i.headers={}),i.headers.Authorization||(i.headers.Authorization="Bearer "+this.opts.accessToken),n.access_token&&delete n.access_token):n.access_token||(n.access_token=this.opts.accessToken);const o=this.request(e,t,a,n,s,i),r=this;return o.catch((function(e){"M_UNKNOWN_TOKEN"==e.errcode?r.event_emitter.emit("Session.logged_out",e):"M_CONSENT_NOT_GIVEN"==e.errcode&&r.event_emitter.emit("no_consent",e.message,e.data.consent_uri)})),o},globitsAuthedRequest:function(e,t,a,n,s,i){n||(n={}),this.useAuthorizationHeader?(isFinite(i)&&(i={localTimeoutMs:i}),i||(i={}),i.headers||(i.headers={}),i.headers.Authorization||(i.headers.Authorization="Bearer "+this.opts.accessToken),n.access_token&&delete n.access_token):n.access_token||(n.access_token=this.opts.accessToken);const o=this.globitsRequest(e,t,a,n,s,i),r=this;return o.catch((function(e){"M_UNKNOWN_TOKEN"==e.errcode?r.event_emitter.emit("Session.logged_out",e):"M_CONSENT_NOT_GIVEN"==e.errcode&&r.event_emitter.emit("no_consent",e.message,e.data.consent_uri)})),o},request:function(e,t,a,n,s,i){const o=void 0!==(i=i||{}).prefix?i.prefix:this.opts.prefix,r=this.opts.baseUrl+o+a;return this.requestOtherUrl(e,t,r,n,s,i)},globitsRequest:function(e,t,a,n,s,i){void 0!==(i=i||{}).prefix?i.prefix:this.opts.prefix;const o=a;return this.requestOtherUrl(e,t,o,n,s,i)},requestOtherUrl:function(e,t,a,n,s,i){return null==i?i={}:isFinite(i)&&(i={localTimeoutMs:i}),this._request(e,t,a,n,s,i)},getUrl:function(e,t,a){let n="";return t&&(n="?"+o.f(t)),this.opts.baseUrl+a+e+n},_request:function(e,t,a,n,s,i){if(void 0!==e&&!o.n(e))throw Error("Expected callback to be a function but got "+typeof e);i=i||{};const r=this;this.opts.extraParams&&(n=d(d({},n),this.opts.extraParams));const c=o.j({},i.headers||{}),m=void 0===i.json||i.json;let u=i.bodyParser;m&&(s&&(s=JSON.stringify(s),c["content-type"]="application/json"),c.accept||(c.accept="application/json"),void 0===u&&(u=function(e){return JSON.parse(e)}));const h=o.e();let p,g,f=!1;const y=i.localTimeoutMs||this.opts.localTimeoutMs,E=()=>{y&&(p&&l.a(p),p=l.b((function(){f=!0,g&&g.abort&&g.abort(),h.reject(new b({error:"Locally timed out waiting for a response",errcode:"ORG.MATRIX.JSSDK_TIMEOUT",timeout:y}))}),y))};E();const _=h.promise;try{g=this.opts.request({uri:a,method:t,withCredentials:!1,qs:n,qsStringifyOptions:i.qsStringifyOptions,useQuerystring:!0,body:s,json:!1,timeout:y,headers:c||{},_matrix_opts:this.opts},(function(t,a,n){if(y&&(l.a(p),f))return;v(h,e,r.opts.onlyData,u)(t,a,n)})),g&&("onprogress"in g&&(g.onprogress=e=>{E()}),g.abort&&(_.abort=g.abort.bind(g)))}catch(t){h.reject(t),e&&e(t)}return _}};const v=function(e,t,a,n){return t=t||function(){},function(s,o,r){if(s){"AbortError"===s.name||"aborted"===s||s instanceof b||(s=new y("request failed",s))}if(!s)try{(o.status||o.statusCode)>=400?s=function(e,t){const a=e.status||e.statusCode,n=function(e){let t;e.getResponseHeader?t=e.getResponseHeader("Content-Type"):e.headers&&(t=e.headers["content-type"]||null);if(!t)return null;try{return Object(i.parse)(t)}catch(e){throw new Error(`Error parsing Content-Type '${t}': ${e}`)}}(e);let s;if(n)if("application/json"===n.type){const e="object"==typeof t?t:JSON.parse(t);s=new b(e)}else"text/plain"===n.type&&(s=new Error(`Server returned ${a} error: ${t}`));s||(s=new Error(`Server returned ${a} error`));return s.httpStatus=a,s}(o,r):n&&(r=n(r))}catch(e){s=new Error("Error parsing server response: "+e)}if(s)e.reject(s),t(s);else{const n={code:o.status||o.statusCode,headers:o.headers,data:r};e.resolve(a?r:n),t(null,a?r:n)}}};class b extends Error{constructor(e){super("MatrixError: "+(e=e||{}).errcode),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.message=e.error||"Unknown message",this.data=e}}class y extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;super(e+(t?": "+t.message:"")),this._cause=t}get name(){return"ConnectionError"}get cause(){return this._cause}}class E extends Error{constructor(){super("Operation aborted")}get name(){return"AbortError"}}async function _(e,t){let a=0,n=null;for(;a<e;)try{if(a>0){const e=1e3*Math.pow(2,a);r.a.log(`network operation failed ${a} times, retrying in ${e}ms...`),await new Promise(t=>setTimeout(t,e))}return await t()}catch(e){if(!(e instanceof y))throw e;a+=1,n=e}throw n}}).call(this,a(7))},486:function(e,t,a){"use strict";(function(e){a.d(t,"b",(function(){return h})),a.d(t,"a",(function(){return p}));var n=a(1),s=a(213);const i="undefined"!=typeof window&&window.crypto?window.crypto.subtle||window.crypto.webkitSubtle:null,o=new Uint8Array(8);async function r(e,t,a,i){const o=Object(n.k)();if(!o)throw new Error("No usable crypto implementation");let r;r=i?Object(s.decodeBase64)(i):o.randomBytes(16),r[8]&=127;const[l,d]=c(t,a),m=o.createCipheriv("aes-256-ctr",l,r),u=m.update(e,"utf-8","base64")+m.final("base64"),h=o.createHmac("sha256",d).update(u,"base64").digest("base64");return{iv:Object(s.encodeBase64)(r),ciphertext:u,mac:h}}async function l(e,t,a){const i=Object(n.k)();if(!i)throw new Error("No usable crypto implementation");const[o,r]=c(t,a);if(i.createHmac("sha256",r).update(e.ciphertext,"base64").digest("base64").replace(/=+$/g,"")!==e.mac.replace(/=+$/g,""))throw new Error(`Error decrypting secret ${a}: bad MAC`);const l=i.createDecipheriv("aes-256-ctr",o,Object(s.decodeBase64)(e.iv));return l.update(e.ciphertext,"base64","utf-8")+l.final("utf-8")}function c(t,a){const s=Object(n.k)(),i=s.createHmac("sha256",o).update(t).digest(),r=e.alloc(1,1),l=s.createHmac("sha256",i).update(a,"utf-8").update(r).digest();r[0]=2;return[l,s.createHmac("sha256",i).update(l).update(a,"utf-8").update(r).digest()]}async function d(e,t,a,n){let o;n?o=Object(s.decodeBase64)(n):(o=new Uint8Array(16),window.crypto.getRandomValues(o)),o[8]&=127;const[r,l]=await u(t,a),c=(new TextEncoder).encode(e),d=await i.encrypt({name:"AES-CTR",counter:o,length:64},r,c),m=await i.sign({name:"HMAC"},l,d);return{iv:Object(s.encodeBase64)(o),ciphertext:Object(s.encodeBase64)(d),mac:Object(s.encodeBase64)(m)}}async function m(e,t,a){const[n,o]=await u(t,a),r=Object(s.decodeBase64)(e.ciphertext);if(!await i.verify({name:"HMAC"},o,Object(s.decodeBase64)(e.mac),r))throw new Error(`Error decrypting secret ${a}: bad MAC`);const l=await i.decrypt({name:"AES-CTR",counter:Object(s.decodeBase64)(e.iv),length:64},n,r);return(new TextDecoder).decode(new Uint8Array(l))}async function u(e,t){const a=await i.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]),n=await i.deriveBits({name:"HKDF",salt:o,info:(new TextEncoder).encode(t),hash:"SHA-256"},a,512),s=n.slice(0,32),r=n.slice(32),l=i.importKey("raw",s,{name:"AES-CTR"},!1,["encrypt","decrypt"]),c=i.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return await Promise.all([l,c])}function h(){return i?d(...arguments):r(...arguments)}function p(){return i?m(...arguments):l(...arguments)}}).call(this,a(36).Buffer)},487:function(e,t,a){"use strict";(function(e,n){a.d(t,"d",(function(){return l})),a.d(t,"c",(function(){return c})),a.d(t,"b",(function(){return d})),a.d(t,"a",(function(){return p}));var s=a(777),i=a(488),o=a(213),r=a(0);const l="m.qr_code.show.v1",c="m.qr_code.scan.v1";class d extends s.b{static factory(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return new d(...t)}static get NAME(){return"m.reciprocate.v1"}async _doVerification(){if(!this.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");const{qrCodeData:e}=this.request;if(this.startEvent.getContent().secret!==e.encodedSharedSecret)throw Object(i.d)();await new Promise((e,t)=>{this.reciprocateQREvent={confirm:e,cancel:()=>t(Object(i.h)())},this.emit("show_reciprocate_qr",this.reciprocateQREvent)});const t={};switch(e.mode){case m:{const a=e.otherUserMasterKey;t["ed25519:"+a]=a;break}case u:{const a=this.request.targetDevice.deviceId;t["ed25519:"+a]=e.otherDeviceKey;break}case h:{const a=e.myMasterKey;t["ed25519:"+a]=a;break}}await this._verifyKeys(this.userId,t,(e,a,n)=>{const s=t[e];if(!s)throw Object(i.d)();if(n!==s)throw r.a.error("key ID from key info does not match"),Object(i.d)();for(const e in a.keys){if(!e.startsWith("ed25519"))continue;const n=t[e];if(!n)throw Object(i.d)();if(a.keys[e]!==n)throw r.a.error("master key does not match"),Object(i.d)()}})}}const m=0,u=1,h=2;class p{constructor(e,t,a,n,s,i){this._sharedSecret=t,this._mode=e,this._otherUserMasterKey=a,this._otherDeviceKey=n,this._myMasterKey=s,this._buffer=i}static async create(e,t){const a=p._generateSharedSecret(),n=p._determineMode(e,t);let s=null,i=null,o=null;if(n===m){s=t.getStoredCrossSigningForUser(e.otherUserId).getId("master")}else if(n===u)i=await p._getOtherDeviceKey(e,t);else if(n===h){const e=t.getUserId();o=t.getStoredCrossSigningForUser(e).getId("master")}const r=p._generateQrData(e,t,n,a,s,i,o),l=p._generateBuffer(r);return new p(n,a,s,i,o,l)}get buffer(){return this._buffer}get mode(){return this._mode}get otherDeviceKey(){return this._otherDeviceKey}get otherUserMasterKey(){return this._otherUserMasterKey}get myMasterKey(){return this._myMasterKey}get encodedSharedSecret(){return this._sharedSecret}static _generateSharedSecret(){const t=new Uint8Array(11);return e.crypto.getRandomValues(t),Object(o.encodeUnpaddedBase64)(t)}static async _getOtherDeviceKey(e,t){const a=t.getUserId(),n=e.targetDevice,s=n?n.deviceId:null,i=t.getStoredDevice(a,s);if(!i)throw new Error("could not find device "+s);return i.getFingerprint()}static _determineMode(e,t){const a=t.getUserId(),n=e.otherUserId;let s=m;if(a===n){s=t.checkUserTrust(a).isCrossSigningVerified()?u:h}return s}static _generateQrData(e,t,a,n,s,i,o){const r=t.getUserId(),l={prefix:"MATRIX",version:2,mode:a,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:n},c=t.getStoredCrossSigningForUser(r);return a===m?(l.firstKeyB64=c.getId("master"),l.secondKeyB64=s):a===u?(l.firstKeyB64=c.getId("master"),l.secondKeyB64=i):a===h&&(l.firstKeyB64=t.getDeviceEd25519Key(),l.secondKeyB64=o),l}static _generateBuffer(e){let t=n.alloc(0);const a=e=>{const a=n.from([e]);t=n.concat([t,a])},s=e=>{const a=n.alloc(2);a.writeInt16BE(e,0),t=n.concat([t,a])},i=function(e,a){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=n.from(e,a);i&&s(o.byteLength),t=n.concat([t,o])},r=e=>{const a=Object(o.decodeBase64)(e),s=n.from(a);t=n.concat([t,s])};return i(e.prefix,"ascii",!1),a(e.version),a(e.mode),i(e.transactionId,"utf-8"),r(e.firstKeyB64),r(e.secondKeyB64),r(e.secretB64),t}}}).call(this,a(7),a(36).Buffer)},488:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"h",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"g",(function(){return r})),a.d(t,"f",(function(){return l})),a.d(t,"d",(function(){return c})),a.d(t,"c",(function(){return d})),a.d(t,"b",(function(){return m}));var n=a(146);function s(e,t){return function(a){return function(e,t,a){const s=Object.assign({},{code:e,reason:t},a);return new n.b({type:"m.key.verification.cancel",content:s})}(e,t,a)}}const i=s("m.user","Cancelled by user"),o=s("m.timeout","Timed out"),r=(s("m.unknown_transaction","Unknown transaction"),s("m.unknown_method","Unknown method")),l=s("m.unexpected_message","Unexpected message"),c=s("m.key_mismatch","Key mismatch"),d=(s("m.user_error","User mismatch"),s("m.invalid_message","Invalid message"));function m(e){const t=e.getContent();if(t){const{code:e,reason:a}=t;return{code:e,reason:a}}return{code:"Unknown error",reason:"m.unknown"}}},489:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return c})),a.d(t,"d",(function(){return d})),a.d(t,"c",(function(){return m}));var n=a(102),s=a.n(n),i=a(99),o=a(97),r=a(106);class l extends Error{}class c{constructor(e,t,a){this.serviceType=e,this.baseUrl=t,this.accessToken=a}}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m;const a=e.map(e=>i.a.get().getTerms(e.serviceType,e.baseUrl)),n=await Promise.all(a),s=n.map((t,a)=>({service:e[a],policies:t.policies})),o=await i.a.get().getAccountData("m.accepted_terms");let r;r=o&&o.getContent()&&o.getContent().accepted?new Set(o.getContent().accepted):new Set;const l=[];for(const{service:e,policies:t}of s){const a={};for(const[e,n]of Object.entries(t)){let t=!1;for(const e of Object.keys(n))if("version"!==e&&r.has(n[e].url)){t=!0;break}t||(a[e]=n)}Object.keys(a).length>0&&l.push({service:e,policies:a})}const c=r.size;if(l.length>0){const e=await t(l,[...r]);console.log("User has agreed to URLs",e),e.forEach(e=>r.add(e))}else console.log("User has already agreed to all required policies");if(r.size!==c){const e={accepted:Array.from(r)};await i.a.get().setAccountData("m.accepted_terms",e)}const d=s.map(e=>{const t=Array.from(r).filter(t=>{for(const a of Object.values(e.policies))for(const e of Object.keys(a))if("version"!==e&&a[e].url===t)return!0;return!1});return 0===t.length?Promise.resolve():i.a.get().agreeToTerms(e.service.serviceType,e.service.baseUrl,e.service.accessToken,t)});return Promise.all(d)}function m(e,t,a){return new Promise((n,i)=>{console.log("Terms that need agreement",e);const c=o.getComponent("views.dialogs.TermsDialog");r.a.createTrackedDialog("Terms of Service","",c,{policiesAndServicePairs:e,agreedUrls:t,onFinished:(e,t)=>{e?n(t):i(new l)}},s()("mx_TermsDialog",a))})}},490:function(e,t,a){"use strict";(function(e){var n=a(8),s=a.n(n),i=a(99),o=a(420);class r extends s.a{constructor(){super(),this._persistentWidgetId=null,this._roomIdByWidgetId={},this.onRoomStateEvents=this.onRoomStateEvents.bind(this),this.dispatcherRef=null}start(){i.a.get().on("RoomState.events",this.onRoomStateEvents)}stop(){i.a.get()&&i.a.get().removeListener("RoomState.events",this.onRoomStateEvents),this._roomIdByWidgetId={}}onRoomStateEvents(e,t){"im.vector.modular.widgets"===e.getType()&&e.getStateKey()===this._persistentWidgetId&&this.destroyPersistentWidget(this._persistentWidgetId)}destroyPersistentWidget(e){if(e!==this._persistentWidgetId)return;const t=this._persistentWidgetId;o.a.instance.stopMessagingById(e),this.setWidgetPersistence(t,!1),this.delRoomId(t)}setWidgetPersistence(e,t){this._persistentWidgetId!==e||t?this._persistentWidgetId!==e&&t&&(this._persistentWidgetId=e):this._persistentWidgetId=null,this.emit("update")}getWidgetPersistence(e){return this._persistentWidgetId===e}getPersistentWidgetId(){return this._persistentWidgetId}getRoomId(e){return this._roomIdByWidgetId[e]}setRoomId(e,t){this._roomIdByWidgetId[e]=t,this.emit("update")}delRoomId(e){delete this._roomIdByWidgetId[e],this.emit("update")}}void 0===e.singletonActiveWidgetStore&&(e.singletonActiveWidgetStore=new r),t.a=e.singletonActiveWidgetStore}).call(this,a(7))},494:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return m}));var n=a(19),s=a.n(n),i=a(103),o=a(100),r=a(115),l=a(595),c=a(335),d=a(123);class m{constructor(){s()(this,"themeWatchRef",void 0),s()(this,"systemThemeWatchRef",void 0),s()(this,"dispatcherRef",void 0),s()(this,"preferDark",void 0),s()(this,"preferLight",void 0),s()(this,"currentTheme",void 0),s()(this,"onChange",()=>{this.recheck()}),s()(this,"onAction",e=>{e.action===r.a.RecheckTheme&&this.recheck(e.forceTheme)}),this.themeWatchRef=null,this.systemThemeWatchRef=null,this.dispatcherRef=null,this.preferDark=e.matchMedia("(prefers-color-scheme: dark)"),this.preferLight=e.matchMedia("(prefers-color-scheme: light)"),this.currentTheme=this.getEffectiveTheme()}start(){this.themeWatchRef=i.b.watchSetting("theme",null,this.onChange),this.systemThemeWatchRef=i.b.watchSetting("use_system_theme",null,this.onChange),this.preferDark.addEventListener&&(this.preferDark.addEventListener("change",this.onChange),this.preferLight.addEventListener("change",this.onChange)),this.dispatcherRef=o.a.register(this.onAction)}stop(){this.preferDark.addEventListener&&(this.preferDark.removeEventListener("change",this.onChange),this.preferLight.removeEventListener("change",this.onChange)),i.b.unwatchSetting(this.systemThemeWatchRef),i.b.unwatchSetting(this.themeWatchRef),o.a.unregister(this.dispatcherRef)}recheck(e){const t=this.currentTheme;this.currentTheme=void 0===e?this.getEffectiveTheme():e,t!==this.currentTheme&&Object(c.d)(this.currentTheme)}getEffectiveTheme(){if(l.a.isLogin)return"light";if(i.b.getValueAt(d.a.DEVICE,"use_system_theme",null,!1,!0)){if(console.log("returning explicit system theme"),this.preferDark.matches)return"dark";if(this.preferLight.matches)return"light"}const e=i.b.getValueAt(d.a.DEVICE,"theme",null,!1,!0);if(e)return console.log("returning explicit theme: "+e),e;if(i.b.getValue("use_system_theme")){if(this.preferDark.matches)return"dark";if(this.preferLight.matches)return"light"}return console.log("returning theme value"),i.b.getValue("theme")}isSystemThemeSupported(){return this.preferDark.matches||this.preferLight.matches}}}).call(this,a(7))},495:function(e,t,a){"use strict";a.d(t,"b",(function(){return l}));var n=a(88),s=a.n(n),i=a(140),o=a(193),r=a(201);const l=e=>{var t,a,n;return null==e||null===(t=e.currentState)||void 0===t||null===(a=t.getStateEvents(i.a.RoomTopic,""))||void 0===a||null===(n=a.getContent())||void 0===n?void 0:n.topic};t.a=e=>{let{room:t,children:a}=e;const[i,c]=Object(n.useState)(l(t));Object(o.a)(t.currentState,"RoomState.events",()=>{c(l(t))}),Object(n.useEffect)(()=>{c(l(t))},[t]);const d=e=>e&&Object(r.g)(e);return a?a(i,d):s.a.createElement("span",{ref:d},i)}},496:function(e,t,a){"use strict";var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(97);const u=["checked","disabled","onChange"];t.a=e=>{let{checked:t,disabled:a=!1,onChange:n}=e,i=o()(e,u);const r=d()({mx_ToggleSwitch:!0,mx_ToggleSwitch_on:t,mx_ToggleSwitch_enabled:!a}),c=m.getComponent("elements.AccessibleButton");return l.a.createElement(c,s()({},i,{className:r,onClick:()=>{a||n(!t)},role:"switch","aria-checked":t,"aria-disabled":a}),l.a.createElement("div",{className:"mx_ToggleSwitch_ball"}))}},497:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(135);const d=["isExpanded","children","onClick","onContextMenu"],m=e=>{let{isExpanded:t,children:a,onClick:n,onContextMenu:i}=e,r=o()(e,d);return l.a.createElement(c.a,s()({},r,{onClick:n,onContextMenu:i||n,"aria-haspopup":!0,"aria-expanded":t}),a)}},498:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(19),l=a.n(r),c=a(88),d=a.n(c),m=a(102),u=a.n(m),h=a(94);const p=["children","className","disabled","outlined"];var g,f;let v=Object(h.a)("views.elements.StyledRadioButton")((f=class extends d.a.PureComponent{render(){const e=this.props,{children:t,className:a,disabled:n,outlined:i}=e,r=o()(e,p),l=u()("mx_RadioButton",a,{mx_RadioButton_disabled:n,mx_RadioButton_enabled:!n,mx_RadioButton_checked:this.props.checked,mx_RadioButton_outlined:i});return d.a.createElement("label",{className:l},d.a.createElement("input",s()({type:"radio",disabled:n},r)),d.a.createElement("div",null,d.a.createElement("div",null)),d.a.createElement("div",{className:"mx_RadioButton_content"},t),d.a.createElement("div",{className:"mx_RadioButton_spacer"}))}},l()(f,"defaultProps",{className:""}),g=f))||g},499:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(97),c=a(93),d=a(99),m=a(156),u=a(106),h=a(110),p=a(94);let g=Object(p.a)("views.elements.ErrorBoundary")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"_onClearCacheAndReload",()=>{m.a.get()&&(d.a.get().stopClient(),d.a.get().store.deleteAllData().then(()=>{m.a.get().reload()}))}),i()(this,"_onBugReport",()=>{const e=l.getComponent("dialogs.BugReportDialog");e&&u.a.createTrackedDialog("Bug Report Dialog","",e,{label:"react-soft-crash"})}),this.state={error:null}}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e,t){let{componentStack:a}=t;console.error(e),console.error("The above error occured while React was rendering the following components:",a)}render(){if(this.state.error){const e=l.getComponent("elements.AccessibleButton"),t="https://github.com/vector-im/element-web/issues/new";let a;return h.a.get().bug_report_endpoint_url&&(a=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,Object(c.a)("Please <newIssueLink>create a new issue</newIssueLink> on GitHub so that we can investigate this bug.",{},{newIssueLink:e=>r.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:t},e)})),r.a.createElement("p",null,Object(c.a)("If you've submitted a bug via GitHub, debug logs can help us track down the problem. Debug logs contain application usage data including your username, the IDs or aliases of the rooms or groups you have visited and the usernames of other users. They do not contain messages.")),r.a.createElement(e,{onClick:this._onBugReport,kind:"primary"},Object(c.a)("Submit debug logs")))),r.a.createElement("div",{className:"mx_ErrorBoundary"},r.a.createElement("div",{className:"mx_ErrorBoundary_body"},r.a.createElement("h1",null,Object(c.a)("Something went wrong!")),a,r.a.createElement(e,{onClick:this._onClearCacheAndReload,kind:"danger"},Object(c.a)("Clear cache and reload"))))}return this.props.children}})||n},5:function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),function(e){e.ClientReady="im.vector.ready",e.HangupCall="im.vector.hangup",e.StartLiveStream="im.vector.start_live_stream",e.OpenIntegrationManager="integration_manager_open",e.ViewRoom="io.element.view_room"}(n||(n={}))},500:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i}));var n=a(185);let s;async function i(e,t){const a=(await t.getEncryptionTargetMembers()).map(e=>{let{userId:t}=e;return t}),i=!!n.a.shared().getUserIdForRoomId(t.roomId),o=[],r=[];a.filter(t=>t!==e.getUserId()).forEach(t=>{(e.checkUserTrust(t).isCrossSigningVerified()?o:r).push(t)});for(const t of r)if(e.checkUserTrust(t).wasCrossSigningVerified())return s.Warning;const l=o.length>0&&!i&&2!==a.length||1===a.length?[...o,e.getUserId()]:o;for(const t of l){if(e.getStoredDevicesForUser(t).some(a=>{let{deviceId:n}=a;return!e.checkDeviceTrust(t,n).isVerified()}))return s.Warning}return 0===r.length?s.Verified:s.Normal}!function(e){e.Warning="warning",e.Verified="verified",e.Normal="normal"}(s||(s={}))},501:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));var n,s=a(95),i=a.n(s),o=a(19),r=a.n(o),l=a(223),c=a.n(l),d=a(88),m=a.n(d),u=a(92),h=a.n(u),p=a(99),g=a(108),f=a(93),v=a(1351),b=a(1352),y=a(168),E=a(100),_=a(490),S=a(102),C=a.n(S),w=a(103),O=a(127),x=a(597),R=a(247),k=a(1545),I=a(5),T=a(206),P=a(636),N=a(808),D=a(94);let j=Object(D.a)("views.elements.AppTile")(n=class extends m.a.Component{constructor(e){super(e),r()(this,"hasPermissionToLoad",e=>{if(this._usingLocalWidget())return!0;if(!e.room)return!0;const t=w.b.getValue("allowedWidgets",e.room.roomId);return void 0===t[e.app.eventId]?e.userId===e.creatorUserId:!!t[e.app.eventId]}),r()(this,"onAllowedWidgetsChange",()=>{const e=this.hasPermissionToLoad(this.props);this.state.hasPermissionToLoad&&!e&&(_.a.destroyPersistentWidget(this.props.app.id),x.a.destroyElement(this._persistKey),this._sgWidget.stop()),this.setState({hasPermissionToLoad:e})}),r()(this,"_iframeRefChange",e=>{this.iframe=e,e?this._sgWidget.start(e):this._resetWidget(this.props)}),r()(this,"_onWidgetPrepared",()=>{this.setState({loading:!1})}),r()(this,"_onWidgetReady",()=>{R.a.JITSI.matches(this.props.app.type)&&this._sgWidget.widgetApi.transport.send(I.a.ClientReady,{})}),r()(this,"_onAction",e=>{if(e.widgetId===this.props.app.id)switch(e.action){case"m.sticker":this._sgWidget.widgetApi.hasCapability(T.MatrixCapabilities.StickerSending)?E.a.dispatch({action:"post_sticker_message",data:e.data}):console.warn("Ignoring sticker message. Invalid capability")}}),r()(this,"_grantWidgetPermission",()=>{const e=this.props.room.roomId;console.info("Granting permission for widget to load: "+this.props.app.eventId);const t=w.b.getValue("allowedWidgets",e);t[this.props.app.eventId]=!0;const a=w.b.firstSupportedLevel("allowedWidgets");w.b.setValue("allowedWidgets",e,a,t).then(()=>{this.setState({hasPermissionToLoad:!0}),this._startWidget()}).catch(e=>{console.error(e)})}),r()(this,"_onPopoutWidgetClick",()=>{R.a.JITSI.matches(this.props.app.type)&&this._endWidgetActions().then(()=>{this.iframe&&(this.iframe.src=this._sgWidget.embedUrl,this.setState({}))}),Object.assign(document.createElement("a"),{target:"_blank",href:this._sgWidget.popoutUrl,rel:"noreferrer noopener"}).click()}),r()(this,"_onContextMenuClick",()=>{this.setState({menuDisplayed:!0})}),r()(this,"_closeContextMenu",()=>{this.setState({menuDisplayed:!1})}),this._persistKey=Object(x.b)(this.props.app.id),this._sgWidget=new k.b(this.props),this._sgWidget.on("preparing",this._onWidgetPrepared),this._sgWidget.on("ready",this._onWidgetReady),this.iframe=null,this.state=this._getNewState(e),this._contextMenuButton=Object(d.createRef)(),this._allowedWidgetsWatchRef=w.b.watchSetting("allowedWidgets",null,this.onAllowedWidgetsChange)}_getNewState(e){return{initialising:!0,loading:this.props.waitForIframeLoad&&!x.a.isMounted(this._persistKey),hasPermissionToLoad:this.hasPermissionToLoad(e),error:null,widgetPageTitle:e.widgetPageTitle,menuDisplayed:!1}}isMixedContent(){const e=window.location.protocol,t=c.a.parse(this.props.app.url).protocol;return"https:"===e&&"https:"!==t&&(console.warn("Refusing to load mixed-content app:",e,t,window.location,this.props.app.url),!0)}componentDidMount(){this.state.hasPermissionToLoad&&this._startWidget(),this.dispatcherRef=E.a.register(this._onAction)}componentWillUnmount(){this.dispatcherRef&&E.a.unregister(this.dispatcherRef),_.a.getWidgetPersistence(this.props.app.id)||(_.a.destroyPersistentWidget(this.props.app.id),x.a.destroyElement(this._persistKey)),this._sgWidget&&this._sgWidget.stop(),w.b.unwatchSetting(this._allowedWidgetsWatchRef)}_resetWidget(e){this._sgWidget&&this._sgWidget.stop(),this._sgWidget=new k.b(e),this._sgWidget.on("preparing",this._onWidgetPrepared),this._sgWidget.on("ready",this._onWidgetReady),this._startWidget()}_startWidget(){this._sgWidget.prepare().then(()=>{this.setState({initialising:!1})})}UNSAFE_componentWillReceiveProps(e){e.app.url!==this.props.app.url&&(this._getNewState(e),this.state.hasPermissionToLoad&&this._resetWidget(e)),e.widgetPageTitle!==this.props.widgetPageTitle&&this.setState({widgetPageTitle:e.widgetPageTitle})}async _endWidgetActions(){this.iframe&&(this.iframe.src="about:blank"),R.a.JITSI.matches(this.props.app.type)&&E.a.dispatch({action:"hangup_conference"}),x.a.destroyElement(this._persistKey),this._sgWidget.stop({forceDestroy:!0})}formatAppTileName(){let e="No name";return this.props.app.name&&this.props.app.name.trim()&&(e=this.props.app.name.trim()),e}_usingLocalWidget(){return R.a.JITSI.matches(this.props.app.type)}_getTileTitle(){const e=this.formatAppTileName(),t=m.a.createElement("span",null," - ");let a="";return this.state.widgetPageTitle&&this.state.widgetPageTitle!==this.formatAppTileName()&&(a=this.state.widgetPageTitle),m.a.createElement("span",null,m.a.createElement(N.a,{app:this.props.app}),m.a.createElement("b",null,e),m.a.createElement("span",null,a?t:"",a))}render(){let e;const t="mx_AppTileBody"+(this.props.miniMode?"_mini  ":" "),a={};this.props.pointerEvents&&(a["pointer-events"]=this.props.pointerEvents);const n=m.a.createElement("div",{className:"mx_AppLoading_spinner_fadeIn"},m.a.createElement(y.a,{message:Object(f.a)("Loading...")}));if(this.state.hasPermissionToLoad)this.state.initialising?e=m.a.createElement("div",{className:t+(this.state.loading?"mx_AppLoading":""),style:a},n):this.isMixedContent()?e=m.a.createElement("div",{className:t,style:a},m.a.createElement(b.a,{errorMsg:"Error - Mixed content"})):(e=m.a.createElement("div",{className:t+(this.state.loading?"mx_AppLoading":""),style:a},this.state.loading&&n,m.a.createElement("iframe",{allow:"microphone; camera; encrypted-media; autoplay; display-capture; clipboard-write;",ref:this._iframeRefChange,src:this._sgWidget.embedUrl,allowFullScreen:!0,sandbox:"allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-presentation"})),this.props.userWidget||(e=m.a.createElement("div",{className:"mx_AppTile_persistedWrapper"},m.a.createElement(x.a,{persistKey:this._persistKey},e))));else{const n=p.a.get().isRoomEncrypted(this.props.room.roomId);e=m.a.createElement("div",{className:t,style:a},m.a.createElement(v.a,{roomId:this.props.room.roomId,creatorUserId:this.props.creatorUserId,url:this._sgWidget.embedUrl,isRoomEncrypted:n,onPermissionGranted:this._grantWidgetPermission}))}let s,o;return s=this.props.miniMode?{mx_AppTile_mini:!0}:this.props.fullWidth?{mx_AppTileFullWidth:!0}:{mx_AppTile:!0},s=C()(s),this.state.menuDisplayed&&(o=m.a.createElement(P.a,i()({},Object(O.k)(this._contextMenuButton.current.getBoundingClientRect(),null),{app:this.props.app,onFinished:this._closeContextMenu,showUnpin:!this.props.userWidget,userWidget:this.props.userWidget}))),m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:s,id:this.props.app.id},this.props.showMenubar&&m.a.createElement("div",{className:"mx_AppTileMenuBar"},m.a.createElement("span",{className:"mx_AppTileMenuBarTitle",style:{pointerEvents:!!this.props.handleMinimisePointerEvents&&"all"}},this.props.showTitle&&this._getTileTitle()),m.a.createElement("span",{className:"mx_AppTileMenuBarWidgets"},this.props.showPopout&&m.a.createElement(g.a,{className:"mx_AppTileMenuBar_iconButton mx_AppTileMenuBar_iconButton_popout",title:Object(f.a)("Popout widget"),onClick:this._onPopoutWidgetClick}),m.a.createElement(O.c,{className:"mx_AppTileMenuBar_iconButton mx_AppTileMenuBar_iconButton_menu",label:Object(f.a)("Options"),isExpanded:this.state.menuDisplayed,inputRef:this._contextMenuButton,onClick:this._onContextMenuClick}))),e),o)}})||n;j.displayName="AppTile",j.propTypes={app:h.a.object.isRequired,room:h.a.object,fullWidth:h.a.bool,miniMode:h.a.bool,userId:h.a.string.isRequired,creatorUserId:h.a.string,waitForIframeLoad:h.a.bool,showMenubar:h.a.bool,onEditClick:h.a.func,onDeleteClick:h.a.func,onMinimiseClick:h.a.func,showTitle:h.a.bool,handleMinimisePointerEvents:h.a.bool,showPopout:h.a.bool,userWidget:h.a.bool,pointerEvents:h.a.string},j.defaultProps={waitForIframeLoad:!0,showMenubar:!0,showTitle:!0,showPopout:!0,handleMinimisePointerEvents:!1,userWidget:!1,miniMode:!1}},502:function(e,t){e.exports="img/cancel.a090627.svg"},503:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return d})),a.d(t,"c",(function(){return m}));var n=a(19),s=a.n(n),i=a(225),o=a(338),r=a(112),l=a.n(r);let c;!function(e){e.Gitlab="gitlab",e.Github="github",e.Apple="apple",e.Google="google",e.Facebook="facebook",e.Twitter="twitter"}(c||(c={}));class d{constructor(e,t,a,n){s()(this,"hsUrl",void 0),s()(this,"isUrl",void 0),s()(this,"fallbackHsUrl",void 0),s()(this,"flows",void 0),s()(this,"defaultDeviceDisplayName",void 0),s()(this,"tempClient",void 0),this.hsUrl=e,this.isUrl=t,this.fallbackHsUrl=a,this.flows=[],this.defaultDeviceDisplayName=n.defaultDeviceDisplayName,this.tempClient=null}getHomeserverUrl(){return this.hsUrl}getIdentityServerUrl(){return this.isUrl}setHomeserverUrl(e){this.tempClient=null,this.hsUrl=e}setIdentityServerUrl(e){this.tempClient=null,this.isUrl=e}createTemporaryClient(){return this.tempClient?this.tempClient:this.tempClient=Object(i.createClient)({baseUrl:this.hsUrl,idBaseUrl:this.isUrl})}async getFlows(){const e=this.createTemporaryClient(),{flows:t}=await e.loginFlows();return this.flows=t,this.flows}loginViaPassword(e,t,a,n){const s=e.indexOf("@")>0;let i;i=t&&a?{type:"m.id.phone",country:t,phone:a,number:a}:s?{type:"m.id.thirdparty",medium:"email",address:e}:{type:"m.id.user",user:e};const o={password:n,identifier:i,initial_device_display_name:"demoprepclinic.globits.net (Chrome, Windows)"},r=e=>m(this.fallbackHsUrl,this.isUrl,"m.login.password",o).catch(t=>{throw console.log("fallback HS login failed",t),e});let l=null;return m(this.hsUrl,this.isUrl,"m.login.password",o).catch(e=>{if(l=e,403===e.httpStatus&&this.fallbackHsUrl)return r(l);throw l}).catch(e=>{throw console.log("Login failed",e),e})}}async function m(e,t,a,n){var s;const r=Object(i.createClient)({baseUrl:e,idBaseUrl:t}),c=await r.globitsLogin(l.a.API_ENPOINT+"/oauth/token",a,n);localStorage.setItem("oauth2Token",c.oauth2Token);const d=c.well_known;d&&(d["m.homeserver"]&&d["m.homeserver"].base_url&&(e=d["m.homeserver"].base_url,console.log(`Overrode homeserver setting with ${e} from login response`)),d["m.identity_server"]&&d["m.identity_server"].base_url&&(t=d["m.identity_server"].base_url,console.log(`Overrode IS setting with ${t} from login response`)));const m={homeserverUrl:e,identityServerUrl:t,userId:c.user_id,deviceId:c.device_id,accessToken:c.access_token,oauth2Token:c.oauth2Token};return null===(s=o.a.examineLoginResponse)||void 0===s||s.call(o.a,c,m),m}},504:function(e,t,a){"use strict";a.d(t,"g",(function(){return u})),a.d(t,"a",(function(){return h})),a.d(t,"f",(function(){return p})),a.d(t,"e",(function(){return g})),a.d(t,"c",(function(){return b})),a.d(t,"d",(function(){return y})),a.d(t,"b",(function(){return E}));var n=a(1298),s=a(181),i=a(590),o=a(246);const r=window.localStorage;let l;try{l=window.indexedDB}catch(e){}function c(e){console.log("StorageManager: "+e)}function d(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];console.error("StorageManager: "+e,...a)}function m(e){s.a.trackEvent("StorageManager",e)}function u(){navigator.storage&&navigator.storage.persist?navigator.storage.persist().then(e=>{console.log("StorageManager: Persistent?",e)}):document.requestStorageAccess?document.requestStorageAccess().then(()=>console.log("StorageManager: Persistent?",!0),()=>console.log("StorageManager: Persistent?",!1)):console.log("StorageManager: Persistence unsupported")}async function h(){c("Checking storage consistency"),c("Local storage supported? "+!!r),c("IndexedDB supported? "+!!l);let e=!1,t=!1,a=!1,s=!0;if(r?(e=r.length>0,c("Local storage contains data? "+e),a=!!r.getItem("mx_crypto_initialised"),c("Crypto initialised? "+a)):(s=!1,d("Local storage cannot be used on this browser"),m("Local storage disabled")),l&&r){(await async function(){let e=!1;try{return e=await i.a.exists(l,"riot-web-sync"),c("Sync store using IndexedDB contains data? "+e),{exists:e,healthy:!0}}catch(e){d("Sync store using IndexedDB inaccessible",e),m("Sync store using IndexedDB inaccessible")}return c("Sync store using memory only"),{exists:e,healthy:!1}}()).healthy||(s=!1)}else s=!1,d("Sync store cannot be used on this browser"),m("Sync store disabled");if(l){const e=await async function(){let e=!1;try{return e=await o.a.exists(l,"matrix-js-sdk:crypto"),c("Crypto store using IndexedDB contains data? "+e),{exists:e,healthy:!0}}catch(e){d("Crypto store using IndexedDB inaccessible",e),m("Crypto store using IndexedDB inaccessible")}try{return e=await n.a.exists(r),c("Crypto store using local storage contains data? "+e),{exists:e,healthy:!0}}catch(e){d("Crypto store using local storage inaccessible",e),m("Crypto store using local storage inaccessible")}return c("Crypto store using memory only"),{exists:e,healthy:!1}}();t=e.exists,e.healthy||(s=!1)}else s=!1,d("Crypto store cannot be used on this browser"),m("Crypto store disabled");return e&&a&&!t&&(s=!1,d("Data exists in local storage and crypto is marked as initialised  but no data found in crypto store. IndexedDB storage has likely been evicted by the browser!"),m("Crypto store evicted")),s?(c("Storage consistency checks passed"),m("Consistency checks passed")):(d("Storage consistency checks failed"),m("Consistency checks failed")),{dataInLocalStorage:e,dataInCryptoStore:t,cryptoInited:a,healthy:s}}function p(e){e.store&&e.store.on&&e.store.on("degraded",()=>{m("Sync store using IndexedDB degraded to memory")})}function g(e){r.setItem("mx_crypto_initialised",e)}let f=null;async function v(){if(!l)throw new Error("IndexedDB not available");f=await new Promise((e,t)=>{const a=l.open("matrix-react-sdk",1);a.onerror=t,a.onsuccess=t=>{e(a.result)},a.onupgradeneeded=e=>{const t=a.result;t.createObjectStore("pickleKey"),t.createObjectStore("account")}})}async function b(e,t){return f||await v(),new Promise((a,n)=>{const s=f.transaction([e],"readonly");s.onerror=n;const i=s.objectStore(e).get(t);i.onerror=n,i.onsuccess=e=>{a(i.result)}})}async function y(e,t,a){return f||await v(),new Promise((n,s)=>{const i=f.transaction([e],"readwrite");i.onerror=s;const o=i.objectStore(e).put(a,t);o.onerror=s,o.onsuccess=e=>{n()}})}async function E(e,t){return f||await v(),new Promise((a,n)=>{const s=f.transaction([e],"readwrite");s.onerror=n;const i=s.objectStore(e).delete(t);i.onerror=n,i.onsuccess=e=>{a()}})}},505:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n=a(88),s=a.n(n),i=a(102),o=a.n(i),r=a(93),l=a(108),c=a(103),d=a(123),m=a(339),u=a(106),h=a(832),p=a(110);const g=e=>{let{onClick:t}=e;return t?s.a.createElement(m.a,{class:o()("mx_BetaCard_betaPill",{mx_BetaCard_betaPill_clickable:!!t}),tooltip:s.a.createElement("div",null,s.a.createElement("div",{className:"mx_Tooltip_title"},Object(r.a)("Spaces is a beta feature")),s.a.createElement("div",{className:"mx_Tooltip_sub"},Object(r.a)("Tap for more info"))),onClick:t,tooltipProps:{yOffset:-10}},Object(r.a)("Beta")):s.a.createElement("span",{className:o()("mx_BetaCard_betaPill",{mx_BetaCard_betaPill_clickable:!!t}),onClick:t},Object(r.a)("Beta"))};t.b=e=>{let{title:t,featureId:a}=e;const n=c.b.getBetaInfo(a);if(!n)return null;const{title:i,caption:o,disclaimer:m,image:f,feedbackLabel:v,feedbackSubheading:b}=n,y=c.b.getValue(a);let E;return y&&v&&b&&p.a.get().bug_report_endpoint_url&&(E=s.a.createElement(l.a,{onClick:()=>{u.a.createTrackedDialog("Beta Feedback",a,h.a,{featureId:a})},kind:"primary"},Object(r.a)("Feedback"))),s.a.createElement("div",{className:"mx_BetaCard"},s.a.createElement("div",null,s.a.createElement("h3",{className:"mx_BetaCard_title"},t||Object(r.a)(i),s.a.createElement(g,null)),s.a.createElement("span",{className:"mx_BetaCard_caption"},Object(r.a)(o)),s.a.createElement("div",null,E,s.a.createElement(l.a,{onClick:()=>c.b.setValue(a,null,d.a.DEVICE,!y),kind:E?"primary_outline":"primary"},y?Object(r.a)("Leave the beta"):Object(r.a)("Join the beta"))),m&&s.a.createElement("div",{className:"mx_BetaCard_disclaimer"},m(y))),s.a.createElement("img",{src:f,alt:""}))}},506:function(e,t,a){"use strict";var n,s,i=a(19),o=a.n(i),r=a(103),l=a(245),c=a(88),d=a.n(c),m=a(129),u=a.n(m),h=a(92),p=a.n(h),g=a(256),f=a(778),v=a(93),b=a(99),y=a(796),E=a(106),_=a(100),S=a(97),C=a(131),w=a(422),O=a(360),x=a(1418),R=a(296),k=a(147),I=a(94),T=a(153);let P=function(){};let N=Object(I.a)("structures.TimelinePanel")((s=class e extends d.a.Component{constructor(t){var a;super(t),a=this,o()(this,"onMessageListUnfillRequest",(e,t)=>{const a=e?g.a.BACKWARDS:g.a.FORWARDS;P("TimelinePanel: unpaginating events in direction",a);const n=t,s=this.state.events.findIndex(e=>e.getId()===n),i=e?s+1:this.state.events.length-s;if(i>0){P("TimelinePanel: Unpaginating",i,"in direction",a),this._timelineWindow.unpaginate(i,e);const t=e?"canBackPaginate":"canForwardPaginate",{events:n,liveEvents:s,firstVisibleEventIndex:o}=this._getEvents();this.setState({[t]:!0,events:n,liveEvents:s,firstVisibleEventIndex:o})}}),o()(this,"onPaginationRequest",(e,t,a)=>this.props.onPaginationRequest?this.props.onPaginationRequest(e,t,a):e.paginate(t,a)),o()(this,"onMessageListFillRequest",e=>{if(!this._shouldPaginate())return Promise.resolve(!1);const t=e?g.a.BACKWARDS:g.a.FORWARDS,a=e?"canBackPaginate":"canForwardPaginate",n=e?"backPaginating":"forwardPaginating";return this.state[a]?this._timelineWindow.canPaginate(t)?e&&0!==this.state.firstVisibleEventIndex?(P("TimelinePanel: won't",t,"paginate past first visible event"),Promise.resolve(!1)):(P("TimelinePanel: Initiating paginate; backwards:"+e),this.setState({[n]:!0}),this.onPaginationRequest(this._timelineWindow,t,20).then(t=>{if(this.unmounted)return;P("TimelinePanel: paginate complete backwards:"+e+"; success:"+t);const{events:s,liveEvents:i,firstVisibleEventIndex:o}=this._getEvents(),r={[n]:!1,[a]:t,events:s,liveEvents:i,firstVisibleEventIndex:o},l=e?g.a.FORWARDS:g.a.BACKWARDS,c=e?"canForwardPaginate":"canBackPaginate";return!this.state[c]&&this._timelineWindow.canPaginate(l)&&(P("TimelinePanel: can now",l,"paginate again"),r[c]=!0),new Promise(a=>{this.setState(r,()=>{a(t&&(!e||0===o))})})})):(P("TimelinePanel: can't",t,"paginate any further"),this.setState({[a]:!1}),Promise.resolve(!1)):(P("TimelinePanel: have given up",t,"paginating this timeline"),Promise.resolve(!1))}),o()(this,"onMessageListScroll",e=>{if(this.props.onScroll&&this.props.onScroll(e),this.props.manageReadMarkers){const e=this.getReadMarkerPosition();e<0&&this.setState({readMarkerVisible:!0});const t=this._readMarkerTimeout(e);this._readMarkerActivityTimer.changeTimeout(t)}}),o()(this,"onAction",e=>{if("ignore_state_changed"===e.action&&this.forceUpdate(),"edit_event"===e.action){const t=e.event?new x.a(e.event):null;this.setState({editState:t},()=>{e.event&&this._messagePanel.current&&this._messagePanel.current.scrollToEventIfNeeded(e.event.getId())})}"scroll_to_bottom"===e.action&&this.jumpToLiveTimeline()}),o()(this,"onRoomTimeline",(e,t,a,n,s)=>{s.timeline.getTimelineSet()===this.props.timelineSet&&!a&&s&&s.liveEvent&&this._messagePanel.current&&(this._messagePanel.current.getScrollState().stuckAtBottom?this._timelineWindow.paginate(g.a.FORWARDS,1,!1).then(()=>{if(this.unmounted)return;const{events:t,liveEvents:a,firstVisibleEventIndex:n}=this._getEvents(),s=a[a.length-1],i={events:t,liveEvents:a,firstVisibleEventIndex:n};let o;if(this.props.manageReadMarkers){const t=b.a.get().credentials.userId,a=e.sender?e.sender.userId:null;o=!1,a==t||y.a.sharedInstance().userActiveRecently()?s&&0===this.getReadMarkerPosition()&&(this._setReadMarker(s.getId(),s.getTs(),!0),i.readMarkerVisible=!1,i.readMarkerEventId=s.getId(),o=!0):i.readMarkerVisible=!0}this.setState(i,()=>{this._messagePanel.current.updateTimelineMinHeight(),o&&this.props.onReadMarkerUpdated()})}):this.setState({canForwardPaginate:!0}))}),o()(this,"onRoomTimelineReset",(e,t)=>{t===this.props.timelineSet&&this._messagePanel.current&&this._messagePanel.current.isAtBottom()&&this._loadTimeline()}),o()(this,"canResetTimeline",()=>this._messagePanel.current&&this._messagePanel.current.isAtBottom()),o()(this,"onRoomRedaction",(e,t)=>{this.unmounted||t===this.props.timelineSet.room&&this.forceUpdate()}),o()(this,"onEventReplaced",(e,t)=>{this.unmounted||t===this.props.timelineSet.room&&this.forceUpdate()}),o()(this,"onRoomReceipt",(e,t)=>{this.unmounted||t===this.props.timelineSet.room&&this.forceUpdate()}),o()(this,"onLocalEchoUpdated",(e,t,a)=>{this.unmounted||t===this.props.timelineSet.room&&this._reloadEvents()}),o()(this,"onAccountData",(e,t)=>{this.unmounted||t===this.props.timelineSet.room&&"m.fully_read"===e.getType()&&this.setState({readMarkerEventId:e.getContent().event_id},this.props.onReadMarkerUpdated)}),o()(this,"onEventDecrypted",e=>{this.props.timelineSet.room&&e.getRoomId()===this.props.timelineSet.room.roomId&&this.forceUpdate()}),o()(this,"onSync",(e,t,a)=>{this.setState({clientSyncState:e})}),o()(this,"sendReadReceipt",()=>{if(r.b.getValue("lowBandwidth"))return;if(!this._messagePanel.current)return;if(!this.props.manageReadReceipts)return;const e=b.a.get();if(!e||e.isGuest())return;let t=!0;const a=this._getCurrentReadReceipt(!0),n=this._indexForEventId(a);a&&null===n&&this._timelineWindow.canPaginate(g.a.FORWARDS)&&(t=!1);const s=this._getLastDisplayedEventIndex({ignoreOwn:!0});null===s&&(t=!1);let i=this.state.events[s];t=t&&s>n&&this.lastRRSentEventId!=i.getId();const o=this.lastRMSentEventId!=this.state.readMarkerEventId;(t||o)&&(t?this.lastRRSentEventId=i.getId():i=null,this.lastRMSentEventId=this.state.readMarkerEventId,P("TimelinePanel: Sending Read Markers for ",this.props.timelineSet.room.roomId,"rm",this.state.readMarkerEventId,i?"rr "+i.getId():""),b.a.get().setRoomReadMarkers(this.props.timelineSet.room.roomId,this.state.readMarkerEventId,i,{}).catch(e=>{if("M_UNRECOGNIZED"===e.errcode&&i)return b.a.get().sendReadReceipt(i,{}).catch(e=>{console.error(e),this.lastRRSentEventId=void 0});console.error(e),this.lastRRSentEventId=void 0,this.lastRMSentEventId=void 0}),this.isAtEndOfLiveTimeline()&&(this.props.timelineSet.room.setUnreadNotificationCount("total",0),this.props.timelineSet.room.setUnreadNotificationCount("highlight",0),_.a.dispatch({action:"on_room_read",roomId:this.props.timelineSet.room.roomId})))}),o()(this,"updateReadMarker",()=>{if(!this.props.manageReadMarkers)return;if(1===this.getReadMarkerPosition())return;const e=this._getLastDisplayedEventIndex({allowPartial:!0});if(null===e)return;const t=this.state.events[e];this._setReadMarker(t.getId(),t.getTs()),this.state.readMarkerVisible&&this.setState({readMarkerVisible:!1}),this.sendReadReceipt()}),o()(this,"jumpToLiveTimeline",()=>{this._timelineWindow.canPaginate(g.a.FORWARDS)?this._loadTimeline():this._messagePanel.current&&this._messagePanel.current.scrollToBottom()}),o()(this,"jumpToReadMarker",()=>{if(!this.props.manageReadMarkers)return;if(!this._messagePanel.current)return;if(!this.state.readMarkerEventId)return;null===this._messagePanel.current.getReadMarkerPosition()?this._loadTimeline(this.state.readMarkerEventId,0,1/3):this._messagePanel.current.scrollToEvent(this.state.readMarkerEventId,0,1/3)}),o()(this,"forgetReadMarker",()=>{if(!this.props.manageReadMarkers)return;const e=this._getCurrentReadReceipt(),t=this.props.timelineSet.getTimelineForEvent(e);let a;if(t){const n=t.getEvents().find(t=>t.getId()==e);n&&(a=n.getTs())}this._setReadMarker(e,a)}),o()(this,"isAtEndOfLiveTimeline",()=>this._messagePanel.current&&this._messagePanel.current.isAtBottom()&&this._timelineWindow&&!this._timelineWindow.canPaginate(g.a.FORWARDS)),o()(this,"getScrollState",()=>this._messagePanel.current?this._messagePanel.current.getScrollState():null),o()(this,"getReadMarkerPosition",()=>{if(!this.props.manageReadMarkers)return null;if(!this._messagePanel.current)return null;const t=this._messagePanel.current.getReadMarkerPosition();if(null!==t)return t;const a=e.roomReadMarkerTsMap[this.props.timelineSet.room.roomId];return a&&this.state.events.length>0?a<this.state.events[0].getTs()?-1:1:null}),o()(this,"canJumpToReadMarker",()=>{const e=this.getReadMarkerPosition();return null!==this.state.readMarkerEventId&&(e<0||null===e)}),o()(this,"handleScrollKey",e=>{this._messagePanel.current&&(!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||e.key!==C.a.END?this._messagePanel.current.handleScrollKey(e):this.jumpToLiveTimeline())}),o()(this,"getRelationsForEvent",(function(){return a.props.timelineSet.getRelationsForEvent(...arguments)})),P("TimelinePanel: mounting"),this.lastRRSentEventId=void 0,this.lastRMSentEventId=void 0,this._messagePanel=Object(c.createRef)();let n=null;if(this.props.manageReadMarkers){const e=this.props.timelineSet.room.getAccountData("m.fully_read");n=e?e.getContent().event_id:this._getCurrentReadReceipt()}this.state={events:[],liveEvents:[],timelineLoading:!0,firstVisibleEventIndex:0,canBackPaginate:!1,canForwardPaginate:!1,readMarkerVisible:!0,readMarkerEventId:n,backPaginating:!1,forwardPaginating:!1,clientSyncState:b.a.get().getSyncState(),isTwelveHour:r.b.getValue("showTwelveHourTimestamps"),alwaysShowTimestamps:r.b.getValue("alwaysShowTimestamps"),readMarkerInViewThresholdMs:r.b.getValue("readMarkerInViewThresholdMs"),readMarkerOutOfViewThresholdMs:r.b.getValue("readMarkerOutOfViewThresholdMs")},this.dispatcherRef=_.a.register(this.onAction),b.a.get().on("Room.timeline",this.onRoomTimeline),b.a.get().on("Room.timelineReset",this.onRoomTimelineReset),b.a.get().on("Room.redaction",this.onRoomRedaction),b.a.get().on("Room.redactionCancelled",this.onRoomRedaction),b.a.get().on("Room.receipt",this.onRoomReceipt),b.a.get().on("Room.localEchoUpdated",this.onLocalEchoUpdated),b.a.get().on("Room.accountData",this.onAccountData),b.a.get().on("Event.decrypted",this.onEventDecrypted),b.a.get().on("Event.replaced",this.onEventReplaced),b.a.get().on("sync",this.onSync)}UNSAFE_componentWillMount(){this.props.manageReadReceipts&&this.updateReadReceiptOnUserActivity(),this.props.manageReadMarkers&&this.updateReadMarkerOnUserActivity(),this._initTimeline(this.props)}UNSAFE_componentWillReceiveProps(e){e.timelineSet!==this.props.timelineSet&&console.warn("Replacing timelineSet on a TimelinePanel - confusion may ensue");const t=e.eventId!=this.props.eventId,a=e.highlightedEventId!=this.props.highlightedEventId;if(t||a)return console.log("TimelinePanel switching to eventId "+e.eventId+" (was "+this.props.eventId+")"),this._initTimeline(e)}componentWillUnmount(){this.unmounted=!0,this._readReceiptActivityTimer&&(this._readReceiptActivityTimer.abort(),this._readReceiptActivityTimer=null),this._readMarkerActivityTimer&&(this._readMarkerActivityTimer.abort(),this._readMarkerActivityTimer=null),_.a.unregister(this.dispatcherRef);const e=b.a.get();e&&(e.removeListener("Room.timeline",this.onRoomTimeline),e.removeListener("Room.timelineReset",this.onRoomTimelineReset),e.removeListener("Room.redaction",this.onRoomRedaction),e.removeListener("Room.redactionCancelled",this.onRoomRedaction),e.removeListener("Room.receipt",this.onRoomReceipt),e.removeListener("Room.localEchoUpdated",this.onLocalEchoUpdated),e.removeListener("Room.accountData",this.onAccountData),e.removeListener("Event.decrypted",this.onEventDecrypted),e.removeListener("Event.replaced",this.onEventReplaced),e.removeListener("sync",this.onSync))}_readMarkerTimeout(e){return 0===e?this.state.readMarkerInViewThresholdMs:this.state.readMarkerOutOfViewThresholdMs}async updateReadMarkerOnUserActivity(){const e=this._readMarkerTimeout(this.getReadMarkerPosition());for(this._readMarkerActivityTimer=new w.a(e);this._readMarkerActivityTimer;){y.a.sharedInstance().timeWhileActiveRecently(this._readMarkerActivityTimer);try{await this._readMarkerActivityTimer.finished()}catch(e){continue}this.updateReadMarker()}}async updateReadReceiptOnUserActivity(){for(this._readReceiptActivityTimer=new w.a(500);this._readReceiptActivityTimer;){y.a.sharedInstance().timeWhileActiveNow(this._readReceiptActivityTimer);try{await this._readReceiptActivityTimer.finished()}catch(e){continue}this.sendReadReceipt()}}_advanceReadMarkerPastMyEvents(){if(!this.props.manageReadMarkers)return;const e=this._timelineWindow.getEvents();let t;for(t=0;t<e.length&&e[t].getId()!=this.state.readMarkerEventId;t++);if(t>=e.length)return;const a=b.a.get().credentials.userId;for(t++;t<e.length;t++){const n=e[t];if(!n.sender||n.sender.userId!=a)break}t--;const n=e[t];this._setReadMarker(n.getId(),n.getTs())}_initTimeline(e){const t=e.eventId,a=e.eventPixelOffset;let n=1;return null==a&&(n=.5),this._loadTimeline(t,a,n)}_loadTimeline(e,t,a){this._timelineWindow=new f.b(b.a.get(),this.props.timelineSet,{windowLimit:this.props.timelineCap});const n=()=>{this._messagePanel.current&&this._messagePanel.current.onTimelineReset(),this._reloadEvents(),this._advanceReadMarkerPastMyEvents(),this.setState({canBackPaginate:this._timelineWindow.canPaginate(g.a.BACKWARDS),canForwardPaginate:this._timelineWindow.canPaginate(g.a.FORWARDS),timelineLoading:!1},()=>{this._messagePanel.current?(e?this._messagePanel.current.scrollToEvent(e,t,a):this._messagePanel.current.scrollToBottom(),this.props.sendReadReceiptOnLoad&&this.sendReadReceipt()):console.log("can't initialise scroll state because messagePanel didn't load")})},s=t=>{this.setState({timelineLoading:!1}),console.error(`Error loading timeline panel at ${e}: ${t}`);const a=S.getComponent("dialogs.ErrorDialog");let n,s;e&&(n=()=>{_.a.dispatch({action:"view_room",room_id:this.props.timelineSet.room.roomId})}),s="M_FORBIDDEN"==t.errcode?Object(v.a)("Tried to load a specific point in this room's timeline, but you do not have permission to view the message in question."):Object(v.a)("Tried to load a specific point in this room's timeline, but was unable to find it."),E.a.createTrackedDialog("Failed to load timeline position","",a,{title:Object(v.a)("Failed to load timeline position"),description:s,onFinished:n})};if(this.props.timelineSet.getTimelineForEvent(e))this._timelineWindow.load(e,20),n();else{const t=this._timelineWindow.load(e,20);this.setState({events:[],liveEvents:[],canBackPaginate:!1,canForwardPaginate:!1,timelineLoading:!0}),t.then(n,s)}}_reloadEvents(){this.unmounted||this.setState(this._getEvents())}_getEvents(){const e=this._timelineWindow.getEvents();Object(T.b)(e).reverse().forEach(e=>{b.a.get().decryptEventIfNeeded(e)});const t=this._checkForPreJoinUISI(e),a=[...e];return this._timelineWindow.canPaginate(g.a.FORWARDS)||e.push(...this.props.timelineSet.getPendingEvents()),{events:e,liveEvents:a,firstVisibleEventIndex:t}}_checkForPreJoinUISI(e){const t=this.props.timelineSet.room;if(0===e.length||!t||!b.a.get().isRoomEncrypted(t.roomId))return 0;const a=b.a.get().credentials.userId;let n,s="leave";for(n=e.length-1;n>=0;n--){const i=t.getTimelineForEvent(e[n].getId());if(!i){console.warn(`Event ${e[n].getId()} in room ${t.roomId} is live, but it does not have a timeline`);continue}const o=i.getState(g.a.FORWARDS).getMember(a);s=o?o.membership:"leave";const r=i.getEvents();for(let t=r.length-1;t>=0;t--){const i=r[t];if(i.getId()===e[n].getId())break;if(i.getStateKey()===a&&"m.room.member"===i.getType()){s=i.getPrevContent().membership||"leave"}}break}for(;n>=0;n--){const t=e[n];if(t.getStateKey()===a&&"m.room.member"===t.getType()){s=t.getPrevContent().membership||"leave"}else if("leave"===s&&(t.isDecryptionFailure()||t.isBeingDecrypted()))return n+1}return 0}_indexForEventId(e){for(let t=0;t<this.state.events.length;++t)if(e==this.state.events[t].getId())return t;return null}_getLastDisplayedEventIndex(e){const t=(e=e||{}).ignoreOwn||!1,a=e.allowPartial||!1,n=this._messagePanel.current;if(!n)return null;const s=u.a.findDOMNode(n);if(!s)return null;const i=s.getBoundingClientRect(),o=b.a.get().credentials.userId,r=e=>{if(e){const t=e.getBoundingClientRect();if(a&&t.top<i.bottom||!a&&t.bottom<i.bottom)return!0}return!1};let l=0;for(let e=this.state.liveEvents.length-1;e>=0;--e){const a=this.state.liveEvents[e],s=n.getNodeForEventId(a.getId()),i=r(s);if(i&&0!==l)return e+l;s&&!i&&(l=0);const c=!!a.status||t&&a.sender&&a.sender.userId==o;if(!(!Object(R.b)(a)||Object(O.a)(a))&&s){if(!c&&i)return e}else(!c||c&&0!==l)&&++l}return null}_getCurrentReadReceipt(e){const t=b.a.get();if(null==t)return null;const a=t.credentials.userId;return this.props.timelineSet.room.getEventReadUpTo(a,e)}_setReadMarker(t,a,n){const s=this.props.timelineSet.room.roomId;t!==this.state.readMarkerEventId&&(e.roomReadMarkerTsMap[s]=a,n||this.setState({readMarkerEventId:t},this.props.onReadMarkerUpdated))}_shouldPaginate(){return!this.state.events.some(e=>e.isBeingDecrypted())}render(){const e=S.getComponent("structures.MessagePanel"),t=S.getComponent("elements.Spinner");if(this.state.timelineLoading)return d.a.createElement("div",{className:"mx_RoomView_messagePanelSpinner"},d.a.createElement(t,null));if(0==this.state.events.length&&!this.state.canBackPaginate&&this.props.empty)return d.a.createElement("div",{className:this.props.className+" mx_RoomView_messageListWrapper"},d.a.createElement("div",{className:"mx_RoomView_empty"},this.props.empty));const a=!this._timelineWindow.canPaginate(g.a.FORWARDS),n=this.state.forwardPaginating||["PREPARED","CATCHUP"].includes(this.state.clientSyncState),s=this.state.firstVisibleEventIndex?this.state.events.slice(this.state.firstVisibleEventIndex):this.state.events;return d.a.createElement(e,{ref:this._messagePanel,room:this.props.timelineSet.room,permalinkCreator:this.props.permalinkCreator,hidden:this.props.hidden,backPaginating:this.state.backPaginating,forwardPaginating:n,events:s,highlightedEventId:this.props.highlightedEventId,readMarkerEventId:this.state.readMarkerEventId,readMarkerVisible:this.state.readMarkerVisible,suppressFirstDateSeparator:this.state.canBackPaginate,showUrlPreview:this.props.showUrlPreview,showReadReceipts:this.props.showReadReceipts,ourUserId:b.a.get().credentials.userId,stickyBottom:a,onScroll:this.onMessageListScroll,onUserScroll:this.props.onUserScroll,onFillRequest:this.onMessageListFillRequest,onUnfillRequest:this.onMessageListUnfillRequest,isTwelveHour:this.state.isTwelveHour,alwaysShowTimestamps:this.state.alwaysShowTimestamps,className:this.props.className,tileShape:this.props.tileShape,resizeNotifier:this.props.resizeNotifier,getRelationsForEvent:this.getRelationsForEvent,editState:this.state.editState,showReactions:this.props.showReactions,layout:this.props.layout,enableFlair:r.b.getValue(k.a.Flair)})}},o()(s,"propTypes",{timelineSet:p.a.object.isRequired,showReadReceipts:p.a.bool,manageReadReceipts:p.a.bool,sendReadReceiptOnLoad:p.a.bool,manageReadMarkers:p.a.bool,hidden:p.a.bool,highlightedEventId:p.a.string,eventId:p.a.string,eventPixelOffset:p.a.number,showUrlPreview:p.a.bool,onScroll:p.a.func,onUserScroll:p.a.func,onReadMarkerUpdated:p.a.func,onPaginationRequest:p.a.func,timelineCap:p.a.number,className:p.a.string,tileShape:p.a.string,empty:p.a.node,showReactions:p.a.bool,layout:l.b}),o()(s,"roomReadMarkerTsMap",{}),o()(s,"defaultProps",{timelineCap:Number.MAX_VALUE,className:"mx_RoomView_messagePanel",sendReadReceiptOnLoad:!0}),n=s))||n;t.a=N},507:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(422),u=a(138),h=a(94),p=a(220);let g;g=function(){};let f=Object(h.a)("structures.ScrollPanel")((s=class extends l.a.Component{constructor(e){var t;super(e),t=this,o()(this,"onScroll",e=>{this.props.resizeNotifier&&this.props.resizeNotifier.isResizing||(g("onScroll",this._getScrollNode().scrollTop),this._scrollTimeout.restart(),this._saveScrollState(),this.updatePreventShrinking(),this.props.onScroll(e),this.checkFillState())}),o()(this,"onResize",()=>{g("onResize"),this.checkScroll(),this.preventShrinkingState&&this.preventShrinking()}),o()(this,"checkScroll",()=>{this.unmounted||(this._restoreSavedScrollState(),this.checkFillState())}),o()(this,"isAtBottom",()=>{const e=this._getScrollNode();return Math.abs(e.scrollHeight-(e.scrollTop+e.clientHeight))<=1}),o()(this,"checkFillState",(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t.unmounted)return;const a=0===e,n=t._getScrollNode();if(a){if(t._isFilling)return g("_isFilling: not entering while request is ongoing, marking for a subsequent request"),void(t._fillRequestWhileRunning=!0);g("_isFilling: setting"),t._isFilling=!0}const s=t._itemlist.current,i=s&&s.firstElementChild,o=i&&i.offsetTop,r=[];if((!i||n.scrollTop-o<n.clientHeight)&&r.push(t._maybeFill(e,!0)),n.scrollHeight-n.scrollTop<2*n.clientHeight&&r.push(t._maybeFill(e,!1)),r.length)try{await Promise.all(r)}catch(e){console.error(e)}a&&(g("_isFilling: clearing"),t._isFilling=!1),t._fillRequestWhileRunning&&(t._fillRequestWhileRunning=!1,t.checkFillState())})),o()(this,"getScrollState",()=>this.scrollState),o()(this,"resetScrollState",()=>{this.scrollState={stuckAtBottom:this.props.startAtBottom},this._bottomGrowth=0,this._pages=0,this._scrollTimeout=new m.a(100),this._heightUpdateInProgress=!1}),o()(this,"scrollToTop",()=>{this._getScrollNode().scrollTop=0,this._saveScrollState()}),o()(this,"scrollToBottom",()=>{const e=this._getScrollNode();e.scrollTop=e.scrollHeight,this._saveScrollState()}),o()(this,"scrollRelative",e=>{const t=this._getScrollNode(),a=e*t.clientHeight*.9;t.scrollBy(0,a),this._saveScrollState()}),o()(this,"handleScrollKey",e=>{let t=!1;switch(Object(p.f)().getRoomAction(e)){case p.d.ScrollUp:this.scrollRelative(-1),t=!0;break;case p.d.RoomScrollDown:this.scrollRelative(1),t=!0;break;case p.d.JumpToFirstMessage:this.scrollToTop(),t=!0;break;case p.d.JumpToLatestMessage:this.scrollToBottom(),t=!0}t&&this.props.onUserScroll&&this.props.onUserScroll(e)}),o()(this,"scrollToToken",(e,t,a)=>{t=t||0,a=a||0,this.scrollState={stuckAtBottom:!1,trackedScrollToken:e};const n=this._getTrackedNode(),s=this._getScrollNode();n&&(g("scrollToken: setting scrollTop",{offsetBase:a,pixelOffset:t,offsetTop:n.offsetTop}),s.scrollTop=n.offsetTop-s.clientHeight*a+t,this._saveScrollState())}),o()(this,"_collectScroll",e=>{this._divScroll=e}),o()(this,"preventShrinking",()=>{const e=this._itemlist.current,t=e&&e.children;if(!e)return;let a;for(let e=t.length-1;e>=0;e--){const n=t[e];if(n.dataset.scrollTokens){a=n;break}}if(!a)return;this.clearPreventShrinking();const n=e.clientHeight-(a.offsetTop+a.clientHeight);this.preventShrinkingState={offsetFromBottom:n,offsetNode:a},g("prevent shrinking, last tile ",n,"px from bottom")}),o()(this,"clearPreventShrinking",()=>{const e=this._itemlist.current,t=e&&e.parentElement;t&&(t.style.paddingBottom=null),this.preventShrinkingState=null,g("prevent shrinking cleared")}),o()(this,"updatePreventShrinking",()=>{if(this.preventShrinkingState){const e=this._getScrollNode(),t=this.scrollState,a=this._itemlist.current,{offsetNode:n,offsetFromBottom:s}=this.preventShrinkingState,i=a.parentElement;let o=!n.parentElement;if(!o&&!t.stuckAtBottom){o=e.scrollHeight-(e.scrollTop+e.clientHeight)>=200}if(!o){const e=s-(a.clientHeight-(n.offsetTop+n.clientHeight));e>0?(i.style.paddingBottom=e+"px",g("update prevent shrinking ",e,"px from bottom")):e<0&&(o=!0)}o&&this.clearPreventShrinking()}}),this._pendingFillRequests={b:null,f:null},this.props.resizeNotifier&&this.props.resizeNotifier.on("middlePanelResizedNoisy",this.onResize),this.resetScrollState(),this._itemlist=Object(r.createRef)()}componentDidMount(){this.checkScroll()}componentDidUpdate(){this.checkScroll(),this.updatePreventShrinking()}componentWillUnmount(){this.unmounted=!0,this.props.resizeNotifier&&this.props.resizeNotifier.removeListener("middlePanelResizedNoisy",this.onResize)}_getExcessHeight(e){const t=this._getScrollNode(),a=this._getMessagesHeight(),n=a-this._getListHeight(),s=t.scrollTop+n;return e?s-t.clientHeight-6e3:a-(s+2*t.clientHeight)-6e3}_checkUnfillState(e){let t=this._getExcessHeight(e);if(t<=0)return;const a=t,n=this._itemlist.current.children;let s,i=null;for(let a=0;a<n.length&&(s=n[e?a:n.length-1-a],t-=s.clientHeight,!(s.clientHeight>t));a++)s.dataset.scrollTokens&&(i=s.dataset.scrollTokens.split(",")[0]);i&&(this._unfillDebouncer&&clearTimeout(this._unfillDebouncer),this._unfillDebouncer=setTimeout(()=>{this._unfillDebouncer=null,g("unfilling now",e,a),this.props.onUnfillRequest(e,i)},200))}_maybeFill(e,t){const a=t?"b":"f";if(!this._pendingFillRequests[a])return g("starting "+a+" fill"),this._pendingFillRequests[a]=!0,new Promise(e=>setTimeout(e,1)).then(()=>this.props.onFillRequest(t)).finally(()=>{this._pendingFillRequests[a]=!1}).then(n=>{if(!this.unmounted)return this._checkUnfillState(!t),g(a+" fill complete; hasMoreResults:"+n),n?this.checkFillState(e+1):void 0});g("Already a "+a+" fill in progress - not starting another")}_saveScrollState(){if(this.props.stickyBottom&&this.isAtBottom())return this.scrollState={stuckAtBottom:!0},void g("saved stuckAtBottom state");const e=this._getScrollNode(),t=e.scrollHeight-(e.scrollTop+e.clientHeight),a=this._itemlist.current.children;let n=null;for(let e=a.length-1;e>=0&&!(a[e].dataset.scrollTokens&&(n=a[e],this._topFromBottom(n)>t));--e);if(!n)return void g("unable to save scroll state: found no children in the viewport");const s=n.dataset.scrollTokens.split(",")[0];g("saving anchored scroll state to message",n&&n.innerText,s);const i=this._topFromBottom(n);this.scrollState={stuckAtBottom:!1,trackedNode:n,trackedScrollToken:s,bottomOffset:i,pixelOffset:i-t}}async _restoreSavedScrollState(){const e=this.scrollState;if(e.stuckAtBottom){const e=this._getScrollNode();e.scrollTop!==e.scrollHeight&&(e.scrollTop=e.scrollHeight)}else if(e.trackedScrollToken){const t=this._itemlist.current,a=this._getTrackedNode();if(a){const n=this._topFromBottom(a),s=n-e.bottomOffset;this._bottomGrowth+=s,e.bottomOffset=n;const i="unset";t.style.height!==i&&(t.style.height=i),g("balancing height because messages below viewport grew by",s)}}if(this._heightUpdateInProgress)g("not updating height because request already in progress");else{this._heightUpdateInProgress=!0;try{await this._updateHeight()}finally{this._heightUpdateInProgress=!1}}}async _updateHeight(){if(this._scrollTimeout.isRunning()?(g("updateHeight waiting for scrolling to end ... "),await this._scrollTimeout.finished()):g("updateHeight getting straight to business, no scrolling going on."),this.unmounted)return;const e=this._getScrollNode(),t=this._itemlist.current,a=this._getMessagesHeight(),n=e.clientHeight,s=Math.max(n,a);this._pages=Math.ceil(s/400),this._bottomGrowth=0;const i=this.scrollState;if(i.stuckAtBottom)"unset"!==t.style.height&&(t.style.height="unset"),e.scrollTop!==e.scrollHeight&&(e.scrollTop=e.scrollHeight),g("updateHeight to","unset");else if(i.trackedScrollToken){const a=this._getTrackedNode();if(a){const n=a.offsetTop;"unset"!==t.style.height&&(t.style.height="unset");const s=a.offsetTop-n;e.scrollBy(0,s),g("updateHeight to",{newHeight:"unset",topDiff:s})}}}_getTrackedNode(){const e=this.scrollState,t=e.trackedNode;if(!t||!t.parentElement){let t;const a=this._itemlist.current.children,n=e.trackedScrollToken;for(let e=a.length-1;e>=0;--e){const s=a[e];if(s.dataset.scrollTokens&&-1!==s.dataset.scrollTokens.split(",").indexOf(n)){t=s;break}}t&&g("had to find tracked node again for "+e.trackedScrollToken),e.trackedNode=t}if(e.trackedNode)return e.trackedNode;g("No node with ; '"+e.trackedScrollToken+"'")}_getListHeight(){return this._bottomGrowth+400*this._pages}_getMessagesHeight(){const e=this._itemlist.current,t=e.lastElementChild;return(t?t.offsetTop+t.clientHeight:0)-(e.firstElementChild?e.firstElementChild.offsetTop:0)+36}_topFromBottom(e){return this._itemlist.current.clientHeight-e.offsetTop}_getScrollNode(){if(this.unmounted)throw new Error("ScrollPanel._getScrollNode called when unmounted");if(!this._divScroll)throw new Error("ScrollPanel._getScrollNode called before AutoHideScrollbar ref collected");return this._divScroll}render(){return l.a.createElement(u.a,{wrappedRef:this._collectScroll,onScroll:this.onScroll,onWheel:this.props.onUserScroll,className:"mx_ScrollPanel "+this.props.className,style:this.props.style},this.props.fixedChildren,l.a.createElement("div",{className:"mx_RoomView_messageListWrapper"},l.a.createElement("ol",{ref:this._itemlist,className:"mx_RoomView_MessageList","aria-live":"polite",role:"list"},this.props.children)))}},o()(s,"propTypes",{stickyBottom:d.a.bool,startAtBottom:d.a.bool,onFillRequest:d.a.func,onUnfillRequest:d.a.func,onScroll:d.a.func,onUserScroll:d.a.func,className:d.a.string,style:d.a.object,resizeNotifier:d.a.object,fixedChildren:d.a.node}),o()(s,"defaultProps",{stickyBottom:!0,startAtBottom:!0,onFillRequest:function(e){return Promise.resolve(!1)},onUnfillRequest:function(e,t){},onScroll:function(){}}),n=s))||n},514:function(e,t,a){"use strict";function n(e){this.filter_json=e,this.types=e.types||null,this.not_types=e.not_types||[],this.rooms=e.rooms||null,this.not_rooms=e.not_rooms||[],this.senders=e.senders||null,this.not_senders=e.not_senders||[],this.contains_url=e.contains_url||null}function s(e,t,a){const n=t.split(".");let s=e;for(let e=0;e<n.length-1;e++)s[n[e]]||(s[n[e]]={}),s=s[n[e]];s[n[n.length-1]]=a}function i(e,t){this.userId=e,this.filterId=t,this.definition={}}a.d(t,"a",(function(){return i})),n.prototype.check=function(e){return this._checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url)},n.prototype._checkFields=function(e,t,a,n){const s={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){const a=t.slice(0,-1);return e.substr(0,a.length)===a}return e===t}(a,e)}},i=this;for(let e=0;e<Object.keys(s).length;e++){const t=Object.keys(s)[e],a=s[t];if(i["not_"+t].filter(a).length>0)return!1;const n=i[t];if(n&&n.length>0){if(!n.some(a))return!1}}const o=this.filter_json.contains_url;return void 0===o||o===n},n.prototype.filter=function(e){return e.filter(this.check,this)},n.prototype.limit=function(){return void 0!==this.filter_json.limit?this.filter_json.limit:10},i.LAZY_LOADING_MESSAGES_FILTER={lazy_load_members:!0},i.prototype.getFilterId=function(){return this.filterId},i.prototype.getDefinition=function(){return this.definition},i.prototype.setDefinition=function(e){this.definition=e;const t=e.room,a={};t&&(t.rooms&&(a.rooms=t.rooms),t.rooms&&(a.not_rooms=t.not_rooms),this._include_leave=t.include_leave||!1),this._room_filter=new n(a),this._room_timeline_filter=new n(t&&t.timeline||{})},i.prototype.getRoomTimelineFilterComponent=function(){return this._room_timeline_filter},i.prototype.filterRoomTimeline=function(e){return this._room_timeline_filter.filter(this._room_filter.filter(e))},i.prototype.setTimelineLimit=function(e){s(this.definition,"room.timeline.limit",e)},i.prototype.setLazyLoadMembers=function(e){s(this.definition,"room.state.lazy_load_members",!!e)},i.prototype.setIncludeLeaveRooms=function(e){s(this.definition,"room.include_leave",e)},i.fromJson=function(e,t,a){const n=new i(e,t);return n.setDefinition(a),n}},570:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return c}));var n=a(92),s=a.n(n),i=a(93);const o=s.a.shape({userId:s.a.string.isRequired,displayname:s.a.string,avatarUrl:s.a.string}),r=s.a.shape({displayname:s.a.string,name:s.a.string,roomId:s.a.string.isRequired,canonicalAlias:s.a.string,avatarUrl:s.a.string});function l(e){return{userId:e.user_id,displayname:e.displayname,avatarUrl:e.avatar_url,isPrivileged:e.is_privileged}}function c(e){return{displayname:e.name||e.canonical_alias||Object(i.a)("Unnamed Room"),name:e.name,roomId:e.room_id,canonicalAlias:e.canonical_alias,avatarUrl:e.avatar_url,topic:e.topic,numJoinedMembers:e.num_joined_members,worldReadable:e.world_readable,guestCanJoin:e.guest_can_join,isPublic:!1!==e.is_public}}},571:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return r})),a.d(t,"d",(function(){return l})),a.d(t,"e",(function(){return h})),a.d(t,"f",(function(){return p})),a.d(t,"h",(function(){return g})),a.d(t,"g",(function(){return f}));var n=a(99),s=a(475);const i="all_messages_loud",o="all_messages",r="mentions_only",l="mute",c=[o,i],d=[...c,r];function m(e){return c.includes(e)}function u(e){return d.includes(e)}function h(e){return e.reduce((e,t)=>{const a=p(t.roomId),n=t.getUnreadNotificationCount("highlight")>0,s=f(t),i=s>0&&m(a),o=n&&u(a);return(i||o)&&(e.count+=s,n&&(e.highlight=!0)),e},{count:0,highlight:!1})}function p(e){if(n.a.get().isGuest())return o;if(v(e))return l;let t=null;try{t=n.a.get().getRoomPushRule("global",e)}catch(e){return null}if(!t||!t.enabled)return o;if(y(t))return r;return s.a.actionListToActionsObject(t.actions).tweaks.sound?i:null}function g(e,t){return t===l?function(e){const t=n.a.get(),a=[],s=t.getRoomPushRule("global",e);s&&a.push(t.deletePushRule("global","room",s.rule_id));return a.push(t.addPushRule("global","override",e,{conditions:[{kind:"event_match",key:"room_id",pattern:e}],actions:["dont_notify"]})),Promise.all(a)}(e):function(e,t){const a=n.a.get(),s=[],i=v(e);i&&s.push(a.deletePushRule("global","override",i.rule_id));if("all_messages"===t){const t=a.getRoomPushRule("global",e);t&&s.push(a.deletePushRule("global","room",t.rule_id))}else"mentions_only"===t?(s.push(a.addPushRule("global","room",e,{actions:["dont_notify"]})),s.push(a.setPushRuleEnabled("global","room",e,!0))):(s.push(a.addPushRule("global","room",e,{actions:["notify",{set_tweak:"sound",value:"default"}]})),s.push(a.setPushRuleEnabled("global","room",e,!0)));return Promise.all(s)}(e,t)}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=e.getUnreadNotificationCount(t);const s=e.currentState.getStateEvents("m.room.create","");if(s&&s.getContent().predecessor){const e=s.getContent().predecessor.room_id,t=n.a.get().getRoom(e);t&&(a+=t.getUnreadNotificationCount("highlight"))}return a}function v(e){const t=n.a.get();if(!t.pushRules||!t.pushRules.global||!t.pushRules.global.override)return null;for(const a of t.pushRules.global.override)if(b(e,a)&&y(a)&&a.enabled)return a;return null}function b(e,t){if(1!==t.conditions.length)return!1;const a=t.conditions[0];return"event_match"===a.kind&&"room_id"===a.key&&a.pattern===e}function y(e){return 1===e.actions.length&&"dont_notify"===e.actions[0]}},573:function(e,t,a){"use strict";var n=a(1248),s=a(155);function i(e){const t=e.scanner.TOKENS,a=e.parser.TOKENS.Base,n=e.parser.start;if(void 0===t.UNDERSCORE)throw new Error("linkify-matrix requires linkifyjs 2.1.1: this version is too old.");const s=function(e){a.call(this,e),this.type="roomalias",this.isLink=!0};s.prototype=new a;const i=n.jump(t.POUND),o=new e.parser.State,r=new e.parser.State,l=new e.parser.State(s),c=new e.parser.State,d=new e.parser.State(s),m=new e.parser.State,u=new e.parser.State(s),h=[t.DOT,t.PLUS,t.NUM,t.DOMAIN,t.TLD,t.UNDERSCORE,t.POUND,t.LOCALHOST];i.on(h,o),o.on(h,o),o.on(t.DOMAIN,o),o.on(t.COLON,r),r.on(t.DOMAIN,l),r.on(t.LOCALHOST,d),r.on(t.TLD,d),l.on(t.DOT,c),c.on(t.DOMAIN,l),c.on(t.TLD,d),d.on(t.DOT,c),d.on(t.COLON,m),m.on(t.NUM,u);const p=function(e){a.call(this,e),this.type="userid",this.isLink=!0};p.prototype=new a;const g=n.jump(t.AT),f=new e.parser.State,v=new e.parser.State,b=new e.parser.State(p),y=new e.parser.State,E=new e.parser.State(p),_=new e.parser.State,S=new e.parser.State(p),C=[t.DOT,t.UNDERSCORE,t.PLUS,t.NUM,t.DOMAIN,t.TLD,t.LOCALHOST];g.on(C,f),f.on(C,f),f.on(t.DOMAIN,f),f.on(t.COLON,v),v.on(t.DOMAIN,b),v.on(t.LOCALHOST,E),v.on(t.TLD,E),b.on(t.DOT,y),y.on(t.DOMAIN,b),y.on(t.TLD,E),E.on(t.DOT,y),E.on(t.COLON,_),_.on(t.NUM,S);const w=function(e){a.call(this,e),this.type="groupid",this.isLink=!0};w.prototype=new a;const O=n.jump(t.PLUS),x=new e.parser.State,R=new e.parser.State,k=new e.parser.State(w),I=new e.parser.State,T=new e.parser.State(w),P=new e.parser.State,N=new e.parser.State(w),D=[t.DOT,t.UNDERSCORE,t.PLUS,t.NUM,t.DOMAIN,t.TLD,t.LOCALHOST];O.on(D,x),x.on(D,x),x.on(t.DOMAIN,x),x.on(t.COLON,R),R.on(t.DOMAIN,k),R.on(t.LOCALHOST,T),R.on(t.TLD,T),k.on(t.DOT,I),I.on(t.DOMAIN,k),I.on(t.TLD,T),T.on(t.DOT,I),T.on(t.COLON,P),P.on(t.NUM,N)}i.onUserClick=function(e,t){e.preventDefault()},i.onAliasClick=function(e,t){e.preventDefault()},i.onGroupClick=function(e,t){e.preventDefault()};i.ELEMENT_URL_PATTERN="^(?:https?://)?(?:"+((window.location.host+window.location.pathname).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"|(?:www\\.)?(?:riot|vector)\\.im/(?:app|beta|staging|develop)/|(?:app|beta|staging|develop)\\.element\\.io/)(#.*)"),i.MATRIXTO_URL_PATTERN="^(?:https?://)?(?:www\\.)?matrix\\.to/#/(([#@!+]).*)",i.MATRIXTO_MD_LINK_PATTERN="\\[([^\\]]*)\\]\\((?:https?://)?(?:www\\.)?matrix\\.to/#/([#@!+][^\\)]*)\\)",i.MATRIXTO_BASE_URL=n.a,i.options={events:function(e,t){switch(t){case"url":try{const t=Object(s.j)(e);if(t&&t.userId)return{click:function(e){i.onUserClick(e,t.userId)}}}catch(e){}break;case"userid":return{click:function(t){i.onUserClick(t,e)}};case"roomalias":return{click:function(t){i.onAliasClick(t,e)}};case"groupid":return{click:function(t){i.onGroupClick(t,e)}}}},formatHref:function(e,t){switch(t){case"roomalias":case"userid":case"groupid":default:return Object(s.k)(e)}},linkAttributes:{rel:"noreferrer noopener"},target:function(e,t){if("url"===t)try{return Object(s.l)(e)!==e||decodeURIComponent(e).match(i.ELEMENT_URL_PATTERN)?null:"_blank"}catch(e){}return null}},t.a=i},581:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(99),s=a(93),i=a(773),o=a(205),r=a(103),l=a(632),c=a(267);function d(e){const t=e.getSender(),{entity:a}=e.getPrevContent(),{entity:n,recommendation:i,reason:o}=e.getContent();return n?i&&o?n===a?l.g.includes(e.getType())?Object(s.a)("%(senderName)s updated the rule banning users matching %(glob)s for %(reason)s",{senderName:t,glob:n,reason:o}):l.c.includes(e.getType())?Object(s.a)("%(senderName)s updated the rule banning rooms matching %(glob)s for %(reason)s",{senderName:t,glob:n,reason:o}):l.f.includes(e.getType())?Object(s.a)("%(senderName)s updated the rule banning servers matching %(glob)s for %(reason)s",{senderName:t,glob:n,reason:o}):Object(s.a)("%(senderName)s updated a ban rule matching %(glob)s for %(reason)s",{senderName:t,glob:n,reason:o}):a?l.g.includes(e.getType())?Object(s.a)("%(senderName)s changed a rule that was banning users matching %(oldGlob)s to matching %(newGlob)s for %(reason)s",{senderName:t,oldGlob:a,newGlob:n,reason:o}):l.c.includes(e.getType())?Object(s.a)("%(senderName)s changed a rule that was banning rooms matching %(oldGlob)s to matching %(newGlob)s for %(reason)s",{senderName:t,oldGlob:a,newGlob:n,reason:o}):l.f.includes(e.getType())?Object(s.a)("%(senderName)s changed a rule that was banning servers matching %(oldGlob)s to matching %(newGlob)s for %(reason)s",{senderName:t,oldGlob:a,newGlob:n,reason:o}):Object(s.a)("%(senderName)s updated a ban rule that was matching %(oldGlob)s to matching %(newGlob)s for %(reason)s",{senderName:t,oldGlob:a,newGlob:n,reason:o}):l.g.includes(e.getType())?Object(s.a)("%(senderName)s created a rule banning users matching %(glob)s for %(reason)s",{senderName:t,glob:n,reason:o}):l.c.includes(e.getType())?Object(s.a)("%(senderName)s created a rule banning rooms matching %(glob)s for %(reason)s",{senderName:t,glob:n,reason:o}):l.f.includes(e.getType())?Object(s.a)("%(senderName)s created a rule banning servers matching %(glob)s for %(reason)s",{senderName:t,glob:n,reason:o}):Object(s.a)("%(senderName)s created a ban rule matching %(glob)s for %(reason)s",{senderName:t,glob:n,reason:o}):Object(s.a)("%(senderName)s updated an invalid ban rule",{senderName:t}):l.g.includes(e.getType())?Object(s.a)("%(senderName)s removed the rule banning users matching %(glob)s",{senderName:t,glob:a}):l.c.includes(e.getType())?Object(s.a)("%(senderName)s removed the rule banning rooms matching %(glob)s",{senderName:t,glob:a}):l.f.includes(e.getType())?Object(s.a)("%(senderName)s removed the rule banning servers matching %(glob)s",{senderName:t,glob:a}):Object(s.a)("%(senderName)s removed a ban rule matching %(glob)s",{senderName:t,glob:a})}const m={"m.room.message":function(e){const t=e.sender&&e.sender.name?e.sender.name:e.getSender();let a=t+": "+e.getContent().body;return"m.emote"===e.getContent().msgtype?a="* "+t+" "+a:"m.image"===e.getContent().msgtype&&(a=Object(s.a)("%(senderDisplayName)s sent an image.",{senderDisplayName:t})),a},"m.call.invite":function(e){const t=e.sender?e.sender.name:Object(s.a)("Someone");let a=!0;e.getContent().offer&&e.getContent().offer.sdp&&-1!==e.getContent().offer.sdp.indexOf("m=video")&&(a=!1);const i=n.a.get().supportsVoip();return a&&i?Object(s.a)("%(senderName)s placed a voice call.",{senderName:t}):a&&!i?Object(s.a)("%(senderName)s placed a voice call. (not supported by this browser)",{senderName:t}):!a&&i?Object(s.a)("%(senderName)s placed a video call.",{senderName:t}):a||i?void 0:Object(s.a)("%(senderName)s placed a video call. (not supported by this browser)",{senderName:t})},"m.call.answer":function(e){const t=e.sender?e.sender.name:Object(s.a)("Someone"),a=n.a.get().supportsVoip()?"":Object(s.a)("(not supported by this browser)");return Object(s.a)("%(senderName)s answered the call.",{senderName:t})+" "+a},"m.call.hangup":function(e){const t=e.sender?e.sender.name:Object(s.a)("Someone"),a=e.getContent();let i="";return n.a.get().supportsVoip()?a.reason&&(i="ice_failed"===a.reason?Object(s.a)("(could not connect media)"):"ice_timeout"===a.reason?Object(s.a)("(connection failed)"):"user_media_failed"===a.reason?Object(s.a)("(their device couldn't start the camera / microphone)"):"unknown_error"===a.reason?Object(s.a)("(an error occurred)"):"invite_timeout"===a.reason?Object(s.a)("(no answer)"):"user hangup"===a.reason||"user_hangup"===a.reason?"":Object(s.a)("(unknown failure: %(reason)s)",{reason:a.reason})):i=Object(s.a)("(not supported by this browser)"),Object(s.a)("%(senderName)s ended the call.",{senderName:t})+" "+i},"m.call.reject":function(e){const t=e.sender?e.sender.name:Object(s.a)("Someone");return Object(s.a)("%(senderName)s declined the call.",{senderName:t})}},u={"m.room.canonical_alias":function(e){const t=e.sender&&e.sender.name?e.sender.name:e.getSender(),a=e.getPrevContent().alias,n=e.getPrevContent().alt_aliases||[],i=e.getContent().alias,o=e.getContent().alt_aliases||[],r=n.filter(e=>!o.includes(e)),l=o.filter(e=>!n.includes(e));if(r.length||l.length){if(i!==a)return Object(s.a)("%(senderName)s changed the main and alternative addresses for this room.",{senderName:t});if(l.length&&!r.length)return Object(s.a)("%(senderName)s added the alternative addresses %(addresses)s for this room.",{senderName:t,addresses:l.join(", "),count:l.length});if(r.length&&!l.length)return Object(s.a)("%(senderName)s removed the alternative addresses %(addresses)s for this room.",{senderName:t,addresses:r.join(", "),count:r.length});if(r.length&&l.length)return Object(s.a)("%(senderName)s changed the alternative addresses for this room.",{senderName:t})}else{if(i)return Object(s.a)("%(senderName)s set the main address for this room to %(address)s.",{senderName:t,address:e.getContent().alias});if(a)return Object(s.a)("%(senderName)s removed the main address for this room.",{senderName:t})}return Object(s.a)("%(senderName)s changed the addresses for this room.",{senderName:t})},"m.room.name":function(e){const t=e.sender&&e.sender.name?e.sender.name:e.getSender();return e.getContent().name&&0!==e.getContent().name.trim().length?e.getPrevContent().name?Object(s.a)("%(senderDisplayName)s changed the room name from %(oldRoomName)s to %(newRoomName)s.",{senderDisplayName:t,oldRoomName:e.getPrevContent().name,newRoomName:e.getContent().name}):Object(s.a)("%(senderDisplayName)s changed the room name to %(roomName)s.",{senderDisplayName:t,roomName:e.getContent().name}):Object(s.a)("%(senderDisplayName)s removed the room name.",{senderDisplayName:t})},"m.room.topic":function(e){const t=e.sender&&e.sender.name?e.sender.name:e.getSender();return Object(s.a)('%(senderDisplayName)s changed the topic to "%(topic)s".',{senderDisplayName:t,topic:e.getContent().topic})},"m.room.member":function(e){const t=e.sender?e.sender.name:e.getSender(),a=e.target?e.target.name:e.getStateKey(),n=e.getPrevContent(),i=e.getContent(),o=i.reason?Object(s.a)("Reason")+": "+i.reason:"";switch(i.membership){case"invite":{const e=i.third_party_invite;return e?e.display_name?Object(s.a)("%(targetName)s accepted the invitation for %(displayName)s.",{targetName:a,displayName:e.display_name}):Object(s.a)("%(targetName)s accepted an invitation.",{targetName:a}):Object(s.a)("%(senderName)s invited %(targetName)s.",{senderName:t,targetName:a})}case"ban":return Object(s.a)("%(senderName)s banned %(targetName)s.",{senderName:t,targetName:a})+" "+o;case"join":return n&&"join"===n.membership?n.displayname&&i.displayname&&n.displayname!==i.displayname?Object(s.a)("%(oldDisplayName)s changed their display name to %(displayName)s.",{oldDisplayName:n.displayname,displayName:i.displayname}):!n.displayname&&i.displayname?Object(s.a)("%(senderName)s set their display name to %(displayName)s.",{senderName:e.getSender(),displayName:i.displayname}):n.displayname&&!i.displayname?Object(s.a)("%(senderName)s removed their display name (%(oldDisplayName)s).",{senderName:t,oldDisplayName:n.displayname}):n.avatar_url&&!i.avatar_url?Object(s.a)("%(senderName)s removed their profile picture.",{senderName:t}):n.avatar_url&&i.avatar_url&&n.avatar_url!==i.avatar_url?Object(s.a)("%(senderName)s changed their profile picture.",{senderName:t}):!n.avatar_url&&i.avatar_url?Object(s.a)("%(senderName)s set a profile picture.",{senderName:t}):r.b.getValue("showHiddenEventsInTimeline")?Object(s.a)("%(senderName)s made no change.",{senderName:t}):"":(e.target||console.warn("Join message has no target! -- "+e.getContent().state_key),Object(s.a)("%(targetName)s joined the room.",{targetName:a}));case"leave":return e.getSender()===e.getStateKey()?"invite"===n.membership?Object(s.a)("%(targetName)s rejected the invitation.",{targetName:a}):Object(s.a)("%(targetName)s left the room.",{targetName:a}):"ban"===n.membership?Object(s.a)("%(senderName)s unbanned %(targetName)s.",{senderName:t,targetName:a}):"invite"===n.membership?Object(s.a)("%(senderName)s withdrew %(targetName)s's invitation.",{senderName:t,targetName:a})+" "+o:"join"===n.membership?Object(s.a)("%(senderName)s kicked %(targetName)s.",{senderName:t,targetName:a})+" "+o:""}},"m.room.third_party_invite":function(e){const t=e.sender?e.sender.name:e.getSender();if(!Object(o.c)(e)){const a=e.getPrevContent().display_name||Object(s.a)("Someone");return Object(s.a)("%(senderName)s revoked the invitation for %(targetDisplayName)s to join the room.",{senderName:t,targetDisplayName:a})}return Object(s.a)("%(senderName)s sent an invitation to %(targetDisplayName)s to join the room.",{senderName:t,targetDisplayName:e.getContent().display_name})},"m.room.history_visibility":function(e){const t=e.sender?e.sender.name:e.getSender();switch(e.getContent().history_visibility){case"invited":return Object(s.a)("%(senderName)s made future room history visible to all room members, from the point they are invited.",{senderName:t});case"joined":return Object(s.a)("%(senderName)s made future room history visible to all room members, from the point they joined.",{senderName:t});case"shared":return Object(s.a)("%(senderName)s made future room history visible to all room members.",{senderName:t});case"world_readable":return Object(s.a)("%(senderName)s made future room history visible to anyone.",{senderName:t});default:return Object(s.a)("%(senderName)s made future room history visible to unknown (%(visibility)s).",{senderName:t,visibility:e.getContent().history_visibility})}},"m.room.power_levels":function(e){const t=e.sender?e.sender.name:e.getSender();if(!(e.getPrevContent()&&e.getPrevContent().users&&e.getContent()&&e.getContent().users))return"";const a=e.getContent().users_default||0,n=[];Object.keys(e.getContent().users).forEach(e=>{-1===n.indexOf(e)&&n.push(e)}),Object.keys(e.getPrevContent().users).forEach(e=>{-1===n.indexOf(e)&&n.push(e)});const o=[];return n.forEach(t=>{const n=e.getPrevContent().users[t],r=e.getContent().users[t];r!==n&&o.push(Object(s.a)("%(userId)s from %(fromPowerLevel)s to %(toPowerLevel)s",{userId:t,fromPowerLevel:i.b(n,a),toPowerLevel:i.b(r,a)}))}),o.length?Object(s.a)("%(senderName)s changed the power level of %(powerLevelDiffText)s.",{senderName:t,powerLevelDiffText:o.join(", ")}):""},"m.room.pinned_events":function(e){const t=e.sender?e.sender.name:e.getSender();return Object(s.a)("%(senderName)s changed the pinned messages for the room.",{senderName:t})},"m.room.server_acl":function(e){const t=e.sender&&e.sender.name?e.sender.name:e.getSender(),a=e.getPrevContent(),n=e.getContent(),i=Array.isArray(a.deny)?a.deny:[],o=Array.isArray(a.allow)?a.allow:[];a.allow_ip_literals;let r="";return r=0===i.length&&0===o.length?Object(s.a)("%(senderDisplayName)s set the server ACLs for this room.",{senderDisplayName:t}):Object(s.a)("%(senderDisplayName)s changed the server ACLs for this room.",{senderDisplayName:t}),Array.isArray(n.allow)||(n.allow=[]),0===n.allow.length?r+" "+Object(s.a)("🎉 All servers are banned from participating! This room can no longer be used."):r},"m.room.tombstone":function(e){const t=e.sender&&e.sender.name?e.sender.name:e.getSender();return Object(s.a)("%(senderDisplayName)s upgraded this room.",{senderDisplayName:t})},"m.room.join_rules":function(e){const t=e.sender&&e.sender.name?e.sender.name:e.getSender();switch(e.getContent().join_rule){case"public":return Object(s.a)("%(senderDisplayName)s made the room public to whoever knows the link.",{senderDisplayName:t});case"invite":return Object(s.a)("%(senderDisplayName)s made the room invite only.",{senderDisplayName:t});default:return Object(s.a)("%(senderDisplayName)s changed the join rule to %(rule)s",{senderDisplayName:t,rule:e.getContent().join_rule})}},"m.room.guest_access":function(e){const t=e.sender&&e.sender.name?e.sender.name:e.getSender();switch(e.getContent().guest_access){case"can_join":return Object(s.a)("%(senderDisplayName)s has allowed guests to join the room.",{senderDisplayName:t});case"forbidden":return Object(s.a)("%(senderDisplayName)s has prevented guests from joining the room.",{senderDisplayName:t});default:return Object(s.a)("%(senderDisplayName)s changed guest access to %(rule)s",{senderDisplayName:t,rule:e.getContent().guest_access})}},"m.room.related_groups":function(e){const t=e.sender&&e.sender.name?e.sender.name:e.getSender(),a=e.getContent().groups||[],n=e.getPrevContent().groups||[],i=a.filter(e=>!n.includes(e)),o=n.filter(e=>!a.includes(e));return i.length&&!o.length?Object(s.a)("%(senderDisplayName)s enabled flair for %(groups)s in this room.",{senderDisplayName:t,groups:i.join(", ")}):!i.length&&o.length?Object(s.a)("%(senderDisplayName)s disabled flair for %(groups)s in this room.",{senderDisplayName:t,groups:o.join(", ")}):i.length&&o.length?Object(s.a)("%(senderDisplayName)s enabled flair for %(newGroups)s and disabled flair for %(oldGroups)s in this room.",{senderDisplayName:t,newGroups:i.join(", "),oldGroups:o.join(", ")}):""},"im.vector.modular.widgets":function(e){const t=e.getSender(),{name:a,type:n,url:i}=e.getPrevContent(),{name:o,type:r,url:l}=e.getContent()||{};let c=o||a||r||n||"";return c&&c.length>0&&(c=c[0].toUpperCase()+c.slice(1)),l?i?Object(s.a)("%(widgetName)s widget modified by %(senderName)s",{widgetName:c,senderName:t}):Object(s.a)("%(widgetName)s widget added by %(senderName)s",{widgetName:c,senderName:t}):Object(s.a)("%(widgetName)s widget removed by %(senderName)s",{widgetName:c,senderName:t})},[c.c]:function(e){var t;const a=(null===(t=e.sender)||void 0===t?void 0:t.name)||e.getSender();return Object(s.a)("%(senderName)s has updated the widget layout",{senderName:a})}};for(const e of l.a)u[e]=d;function h(e){const t=(e.isState()?u:m)[e.getType()];return t?t(e):""}},582:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(99),s=a(363),i=a(192),o=a(93),r=a(97),l=a(106),c=a(103),d=a(211);class m{constructor(e){"+"===e[0]?(this.roomId=null,this.groupId=e):(this.roomId=e,this.groupId=null),this.canceled=!1,this.addrs=[],this.busy=!1,this.completionStates={},this.errors={},this.deferred=null}invite(e,t){if(this.addrs.length>0)throw new Error("Already inviting/invited");this.addrs.push(...e),this.reason=t;for(const e of this.addrs)null===Object(s.c)(e)&&(this.completionStates[e]="error",this.errors[e]={errcode:"M_INVALID",errorText:Object(o.a)("Unrecognised address")});return this.deferred=Object(d.a)(),this._inviteMore(0),this.deferred.promise}cancel(){this.busy&&(this._canceled=!0,this.deferred.reject(new Error("canceled")))}getCompletionState(e){return this.completionStates[e]}getErrorText(e){return this.errors[e]?this.errors[e].errorText:null}async _inviteToRoom(e,t,a){const i=Object(s.c)(t);if("email"===i)return n.a.get().inviteByEmail(e,t);if("mx-user-id"===i){const s=n.a.get().getRoom(e);if(!s)throw new Error("Room not found");const i=s.getMember(t);if(i&&["join","invite"].includes(i.membership))throw{errcode:"RIOT.ALREADY_IN_ROOM",error:"Member already invited"};if(!a&&c.b.getValue("promptBeforeInviteUnknownUsers",this.roomId)){if(!await n.a.get().getProfileInfo(t))throw new Error("User has no profile")}return n.a.get().invite(e,t,void 0,this.reason)}throw new Error("Unsupported address")}_doInvite(e,t){return new Promise((a,n)=>{let s;console.log("Inviting "+e),s=null!==this.groupId?i.a.inviteUserToGroup(this.groupId,e):this._inviteToRoom(this.roomId,e,t),s.then(()=>{this._canceled||(this.completionStates[e]="invited",delete this.errors[e],a())}).catch(s=>{if(this._canceled)return;let i;console.error(s);let r=!1;if("M_FORBIDDEN"===s.errcode)r=!0,i=Object(o.a)("You do not have permission to invite people to this room.");else if("RIOT.ALREADY_IN_ROOM"===s.errcode)i=Object(o.a)("User %(userId)s is already in the room",{userId:e});else{if("M_LIMIT_EXCEEDED"===s.errcode)return void setTimeout(()=>{this._doInvite(e,t).then(a,n)},5e3);["M_NOT_FOUND","M_USER_NOT_FOUND"].includes(s.errcode)?i=Object(o.a)("User %(user_id)s does not exist",{user_id:e}):"M_PROFILE_UNDISCLOSED"===s.errcode?i=Object(o.a)("User %(user_id)s may or may not exist",{user_id:e}):"M_PROFILE_NOT_FOUND"!==s.errcode||t?i="M_BAD_STATE"===s.errcode?Object(o.a)("The user must be unbanned before they can be invited."):"M_UNSUPPORTED_ROOM_VERSION"===s.errcode?Object(o.a)("The user's homeserver does not support the version of the room."):Object(o.a)("Unknown server error"):(console.warn(`User ${e} does not have a profile - inviting anyways automatically`),this._doInvite(e,!0).then(a,n))}this.completionStates[e]="error",this.errors[e]={errorText:i,errcode:s.errcode},this.busy=!r,this.fatal=r,r?n():a()})})}_inviteMore(e,t){if(this._canceled)return;if(e===this.addrs.length){if(this.busy=!1,Object.keys(this.errors).length>0&&!this.groupId){const e=["M_NOT_FOUND","M_USER_NOT_FOUND","M_PROFILE_UNDISCLOSED","M_PROFILE_NOT_FOUND"],t=Object.keys(this.errors).filter(t=>e.includes(this.errors[t].errcode));if(t.length>0){const e=()=>{const e=t.map(e=>this._doInvite(e,!0));Promise.all(e).then(()=>this.deferred.resolve(this.completionStates))};if(!c.b.getValue("promptBeforeInviteUnknownUsers",this.roomId))return void e();const a=r.getComponent("dialogs.AskInviteAnywayDialog");return console.log("Showing failed to invite dialog..."),void l.a.createTrackedDialog("Failed to invite","",a,{unknownProfileUsers:t.map(e=>({userId:e,errorText:this.errors[e].errorText})),onInviteAnyways:()=>e(),onGiveUp:()=>{for(const e of t)this.completionStates[e]="invited";this.deferred.resolve(this.completionStates)}})}}return void this.deferred.resolve(this.completionStates)}const a=this.addrs[e];null!==Object(s.c)(a)&&"invited"!==this.completionStates[a]?this._doInvite(a,t).then(()=>{this._inviteMore(e+1,t)}).catch(()=>this.deferred.resolve(this.completionStates)):this._inviteMore(e+1)}}},584:function(e,t,a){"use strict";(function(e,n){a.d(t,"d",(function(){return A})),a.d(t,"c",(function(){return M})),a.d(t,"a",(function(){return U})),a.d(t,"b",(function(){return L}));var s=a(583),i=a.n(s),o=a(8),r=a(775),l=a(0),c=a(1),d=a(1299),m=a(213),u=a(2410),h=a(585),p=a(1541),g=a(586),f=a(2411),v=a(2412),b=a(2413),y=a(246),E=a(487),_=a(2414),S=a(587),C=a(588),w=a(364),O=a(2418),x=a(2419),R=a(2420),k=a(331),I=a(486),T=a(1300),P=a(146),N=a(1301);const D=h.a.DeviceVerification,j={[E.b.NAME]:E.b,[_.a.NAME]:_.a,[E.d]:R.a,[E.c]:R.a},A={RECIPROCATE_QR_CODE:E.b.NAME,SAS:_.a.NAME};function M(){return Boolean(e.Olm)}function U(e,t,a,n,s,i,o,c){if(this._onDeviceListUserCrossSigningUpdated=this._onDeviceListUserCrossSigningUpdated.bind(this),this._trustCrossSignedDevices=!0,this._reEmitter=new r.a(this),this._baseApis=e,this._sessionStore=t,this._userId=a,this._deviceId=n,this._clientStore=s,this._cryptoStore=i,this._roomList=o,c){this._verificationMethods=new Map;for(const e of c)"string"==typeof e?j[e]&&this._verificationMethods.set(e,j[e]):e.NAME?this._verificationMethods.set(e.NAME,e):l.a.warn("Excluding unknown verification method "+e)}else this._verificationMethods=j;this._backupManager=new N.a(e,async e=>{const t=await this.getSessionBackupPrivateKey();if(t)return t;const a=await this.getSecret("m.megolm_backup.v1");if(a){const e=L(a);if(e){const[t]=await this._crypto.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",e,[t])}return m.decodeBase64(e||a)}if(this._baseApis._cryptoCallbacks&&this._baseApis._cryptoCallbacks.getBackupKey)return await this._baseApis._cryptoCallbacks.getBackupKey(e);throw new Error("Unable to get private key")}),this._olmDevice=new d.a(i),this._deviceList=new u.a(e,i,this._olmDevice),this._deviceList.on("userCrossSigningUpdated",this._onDeviceListUserCrossSigningUpdated),this._reEmitter.reEmit(this._deviceList,["crypto.devicesUpdated","crypto.willUpdateDevices"]),this._lastOneTimeKeyCheck=null,this._oneTimeKeyCheckInProgress=!1,this._roomEncryptors={},this._roomDecryptors={},this._supportedAlgorithms=Object.keys(p.a),this._deviceKeys={},this._globalBlacklistUnverifiedDevices=!1,this._globalErrorOnUnknownDevices=!0,this._outgoingRoomKeyRequestManager=new b.a(e,this._deviceId,this._cryptoStore),this._receivedRoomKeyRequests=[],this._receivedRoomKeyRequestCancellations=[],this._processingRoomKeyRequests=!1,this._lazyLoadMembers=!1,this._roomDeviceTrackingState={},this._lastNewSessionForced={},this._toDeviceVerificationRequests=new x.b,this._inRoomVerificationRequests=new O.b,this._sendKeyRequestsImmediately=!1;const h=this._baseApis.cryptoCallbacks||{},f=Object(g.d)(i,this._olmDevice);this._crossSigningInfo=new g.a(a,h,f),this._secretStorage=new v.b(e,h),this._dehydrationManager=new T.b(this),!h.getCrossSigningKey&&h.getSecretStorageKey&&(h.getCrossSigningKey=async e=>g.a.getFromSecretStorage(e,this._secretStorage))}function L(e){if("string"!=typeof e||e.indexOf(",")<0)return null;const t=Uint8Array.from(e.split(","),e=>parseInt(e));return m.encodeBase64(t)}function F(e){if(e._oneTimeKeyCheckInProgress)return;const t=Date.now();if(null!==e._lastOneTimeKeyCheck&&t-e._lastOneTimeKeyCheck<6e4)return;e._lastOneTimeKeyCheck=t;const a=e._olmDevice.maxNumberOfOneTimeKeys(),n=Math.floor(a/2);e._oneTimeKeyCheckInProgress=!0,Promise.resolve().then(()=>void 0!==e._oneTimeKeyCount?Promise.resolve(e._oneTimeKeyCount):e._baseApis.uploadKeysRequest({}).then(e=>e.one_time_key_counts.signed_curve25519||0)).then(t=>async function(t){for(;n>t||e.getNeedsNewFallback();){if(n>t){l.a.info("generating oneTimeKeys");const a=Math.min(n-t,5);await e._olmDevice.generateOneTimeKeys(a)}e.getNeedsNewFallback()&&(l.a.info("generating fallback key"),await e._olmDevice.generateFallbackKey()),l.a.info("calling _uploadOneTimeKeys");const a=await B(e);if(!a.one_time_key_counts||!a.one_time_key_counts.signed_curve25519)throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");t=a.one_time_key_counts.signed_curve25519}}(t)).catch(e=>{l.a.error("Error uploading one-time keys",e.stack||e)}).finally(()=>{e._oneTimeKeyCount=void 0,e._oneTimeKeyCheckInProgress=!1})}async function B(e){const t=[],a={};if(e.getNeedsNewFallback()){const n=await e._olmDevice.getFallbackKey();for(const[s,i]of Object.entries(n.curve25519)){const n={key:i,fallback:!0};a["signed_curve25519:"+s]=n,t.push(e._signObject(n))}e.setNeedsNewFallback(!1)}const n=await e._olmDevice.getOneTimeKeys(),s={};for(const a in n.curve25519)if(n.curve25519.hasOwnProperty(a)){const i={key:n.curve25519[a]};s["signed_curve25519:"+a]=i,t.push(e._signObject(i))}await Promise.all(t);const i=await e._baseApis.uploadKeysRequest({one_time_keys:s,"org.matrix.msc2732.fallback_keys":a});return await e._olmDevice.markKeysAsPublished(),i}c.m(U,o.EventEmitter),U.prototype.init=async function(t){const{exportedOlmDevice:a,pickleKey:n}=t||{};l.a.log("Crypto: initialising Olm..."),await e.Olm.init(),l.a.log(a?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),await this._olmDevice.init({fromExportedDevice:a,pickleKey:n}),l.a.log("Crypto: loading device list..."),await this._deviceList.load(),this._deviceKeys["ed25519:"+this._deviceId]=this._olmDevice.deviceEd25519Key,this._deviceKeys["curve25519:"+this._deviceId]=this._olmDevice.deviceCurve25519Key,l.a.log("Crypto: fetching own devices...");let s=this._deviceList.getRawStoredDevicesForUser(this._userId);if(s||(s={}),!s[this._deviceId]){l.a.log("Crypto: adding this device to the store...");const e={keys:this._deviceKeys,algorithms:this._supportedAlgorithms,verified:D.VERIFIED,known:!0};s[this._deviceId]=e,this._deviceList.storeDevicesForUser(this._userId,s),this._deviceList.saveIfDirty()}await this._cryptoStore.doTxn("readonly",[y.a.STORE_ACCOUNT],e=>{this._cryptoStore.getCrossSigningKeys(e,e=>{e&&0!==Object.keys(e).length&&(l.a.log("Loaded cross-signing public keys from crypto store"),this._crossSigningInfo.setKeys(e))})}),this._deviceList.startTrackingDeviceList(this._userId),l.a.log("Crypto: checking for key backup..."),this._backupManager.checkAndStart()},U.prototype.getCryptoTrustCrossSignedDevices=function(){return this._trustCrossSignedDevices},U.prototype.setCryptoTrustCrossSignedDevices=function(e){this._trustCrossSignedDevices=e;for(const e of this._deviceList.getKnownUserIds()){const t=this._deviceList.getRawStoredDevicesForUser(e);for(const a of Object.keys(t)){const t=this.checkDeviceTrust(e,a);if(!t.isLocallyVerified()&&t.isCrossSigningVerified()){const t=this._deviceList.getStoredDevice(e,a);this.emit("deviceVerificationChanged",e,a,t)}}}},U.prototype.createRecoveryKeyFromPassphrase=async function(t){const a=new e.Olm.PkDecryption;try{const e={};if(t){const n=await Object(S.c)(t);e.passphrase={algorithm:"m.pbkdf2",iterations:n.iterations,salt:n.salt},e.pubkey=a.init_with_private_key(n.key)}else e.pubkey=a.generate_key();const n=a.get_private_key();return{keyInfo:e,encodedPrivateKey:Object(C.b)(n),privateKey:n}}finally{a&&a.free()}},U.prototype.isCrossSigningReady=async function(){const e=this._crossSigningInfo.getId(),t=await this._crossSigningInfo.isStoredInKeyCache()||await this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage);return!(!e||!t)},U.prototype.isSecretStorageReady=async function(){const e=await this._secretStorage.hasKey(),t=await this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage),a=!this._backupManager.getKeyBackupEnabled()||this._baseApis.isKeyBackupKeyStored();return!!(e&&t&&a)},U.prototype.bootstrapCrossSigning=async function(){let{authUploadDeviceSigningKeys:e,setupNewCrossSigning:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l.a.log("Bootstrapping cross-signing");const a=this._baseApis.cryptoCallbacks,n=new f.a(this._baseApis.store.accountData,a),s=new g.a(this._userId,n.crossSigningCallbacks,n.crossSigningCallbacks),i=async()=>{s.resetKeys(),await this._signObject(s.keys.master),n.addCrossSigningKeys(e,s.keys);const t=this._deviceList.getStoredDevice(this._userId,this._deviceId),a=await s.signDevice(this._userId,t);n.addKeySignature(this._userId,this._deviceId,a),this._backupManager.backupInfo&&(await s.signObject(this._backupManager.backupInfo.auth_data,"master"),n.addSessionBackup(this._backupManager.backupInfo))},o=this._crossSigningInfo.getId(),r=await this._crossSigningInfo.isStoredInKeyCache(),c=await this._crossSigningInfo.isStoredInSecretStorage(this._secretStorage),d=r||c;l.a.log({setupNewCrossSigning:t,publicKeysOnDevice:o,privateKeysInCache:r,privateKeysInStorage:c,privateKeysExistSomewhere:d}),!d||t?(l.a.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),await i()):o&&r?l.a.log("Cross-signing public keys trusted and private keys found locally"):c&&(l.a.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),await this.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0}));const m=n.crossSigningCallbacks.privateKeys;if(m.size&&!this._baseApis.cryptoCallbacks.saveCrossSigningKeys){const e=new v.b(n.accountDataClientAdapter,n.ssssCryptoCallbacks);await e.hasKey()&&(l.a.log("Storing new cross-signing private keys in secret storage"),await g.a.storeInSecretStorage(m,e))}const u=n.buildOperation();await u.apply(this),await n.persist(this),l.a.log("Cross-signing ready")},U.prototype.bootstrapSecretStorage=async function(){let{createSecretStorageKey:e=(async()=>({})),keyBackupInfo:t,setupNewKeyBackup:a,setupNewSecretStorage:n,getKeyBackupPassphrase:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l.a.log("Bootstrapping Secure Secret Storage");const i=this._baseApis.cryptoCallbacks,o=new f.a(this._baseApis.store.accountData,i),r=new v.b(o.accountDataClientAdapter,o.ssssCryptoCallbacks);let c=null;const d=async(e,t)=>{e=e||{},t&&(e.key=t);const{keyId:a,keyInfo:n}=await r.addKey(v.a,e);return t&&o.ssssCryptoCallbacks.addPrivateKey(a,n,t),await r.setDefaultKeyId(a),a},u=async(e,t)=>{if(!t.mac){const a=await this._baseApis.cryptoCallbacks.getSecretStorageKey({keys:{[e]:t}},"");if(a){const n=a[1];o.ssssCryptoCallbacks.addPrivateKey(e,t,n);const{iv:s,mac:i}=await v.b._calculateKeyCheck(n);t.iv=s,t.mac=i,await o.setAccountData("m.secret_storage.key."+e,t)}}},h=async e=>{if(this._crossSigningInfo.getId()&&await this._crossSigningInfo.isStoredInKeyCache("master"))try{l.a.log("Adding cross-signing signature to key backup"),await this._crossSigningInfo.signObject(e,"master")}catch(e){l.a.error("Signing key backup with cross-signing keys failed",e)}else l.a.warn("Cross-signing keys not available, skipping signature on key backup")},p=await this.getSecretStorageKey(),[b,y]=p||[null,null],E=!n&&y&&y.algorithm===v.a;if(l.a.log({keyBackupInfo:t,setupNewKeyBackup:a,setupNewSecretStorage:n,storageExists:E,oldKeyInfo:y}),E||t)if(!E&&t){l.a.log("Secret storage does not exist, using key backup key");const e=await this.getSessionBackupPrivateKey()||await s(),a={};t.auth_data.private_key_salt&&t.auth_data.private_key_iterations&&(a.passphrase={algorithm:"m.pbkdf2",iterations:t.auth_data.private_key_iterations,salt:t.auth_data.private_key_salt,bits:256}),c=await d(a,e),await r.store("m.megolm_backup.v1",m.encodeBase64(e),[c]),await h(t.auth_data),o.addSessionBackup(t)}else l.a.log("Secret storage exists"),y&&y.algorithm===v.a&&await u(b,y);else{l.a.log("Secret storage does not exist, creating new storage key");const{keyInfo:t,privateKey:a}=await e();c=await d(t,a)}if(!this._baseApis.cryptoCallbacks.saveCrossSigningKeys&&await this.isCrossSigningReady()&&(c||!await this._crossSigningInfo.isStoredInSecretStorage(r))){l.a.log("Copying cross-signing private keys from cache to secret storage");const e=await this._crossSigningInfo.getCrossSigningKeysFromCache();await g.a.storeInSecretStorage(e,r)}if(a&&!t){l.a.log("Creating new message key backup version");const e=await this._baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1}),t=Object(C.a)(e.recovery_key);await r.store("m.megolm_backup.v1",m.encodeBase64(t));const a={algorithm:e.algorithm,auth_data:e.auth_data};await h(a.auth_data),await this._signObject(a.auth_data),o.addSessionBackup(a)}const _=await r.get("m.megolm_backup.v1");if(_){l.a.info("Got session backup key from secret storage: caching");const e=L(_);e&&await r.store("m.megolm_backup.v1",e,[c||b]);const t=new Uint8Array(m.decodeBase64(e||_));await o.addSessionBackupPrivateKeyToCache(t)}const S=o.buildOperation();await S.apply(this),await o.persist(this),l.a.log("Secure Secret Storage ready")},U.prototype.addSecretStorageKey=function(e,t,a){return this._secretStorage.addKey(e,t,a)},U.prototype.hasSecretStorageKey=function(e){return this._secretStorage.hasKey(e)},U.prototype.getSecretStorageKey=function(e){return this._secretStorage.getKey(e)},U.prototype.storeSecret=function(e,t,a){return this._secretStorage.store(e,t,a)},U.prototype.getSecret=function(e){return this._secretStorage.get(e)},U.prototype.isSecretStored=function(e,t){return this._secretStorage.isStored(e,t)},U.prototype.requestSecret=function(e,t){return t||(t=Object.keys(this._deviceList.getRawStoredDevicesForUser(this._userId))),this._secretStorage.request(e,t)},U.prototype.getDefaultSecretStorageKeyId=function(){return this._secretStorage.getDefaultKeyId()},U.prototype.setDefaultSecretStorageKeyId=function(e){return this._secretStorage.setDefaultKeyId(e)},U.prototype.checkSecretStorageKey=function(e,t){return this._secretStorage.checkKey(e,t)},U.prototype.checkSecretStoragePrivateKey=function(t,a){let n=null;try{n=new e.Olm.PkDecryption;return n.init_with_private_key(t)===a}finally{n&&n.free()}},U.prototype.getSessionBackupPrivateKey=async function(){let e=await new Promise(e=>{this._cryptoStore.doTxn("readonly",[y.a.STORE_ACCOUNT],t=>{this._cryptoStore.getSecretStorePrivateKey(t,e,"m.megolm_backup.v1")})});if(e&&"string"==typeof e&&(e=new Uint8Array(m.decodeBase64(L(e)||e)),await this.storeSessionBackupPrivateKey(e)),e&&e.ciphertext){const t=n.from(this._olmDevice._pickleKey),a=await Object(I.a)(e,t,"m.megolm_backup.v1");e=m.decodeBase64(a)}return e},U.prototype.storeSessionBackupPrivateKey=async function(e){if(!(e instanceof Uint8Array))throw new Error("storeSessionBackupPrivateKey expects Uint8Array, got "+e);const t=n.from(this._olmDevice._pickleKey);return e=await Object(I.b)(m.encodeBase64(e),t,"m.megolm_backup.v1"),this._cryptoStore.doTxn("readwrite",[y.a.STORE_ACCOUNT],t=>{this._cryptoStore.storeSecretStorePrivateKey(t,"m.megolm_backup.v1",e)})},U.prototype.checkCrossSigningPrivateKey=function(t,a){let n=null;try{n=new e.Olm.PkSigning;return n.init_with_seed(t)===a}finally{n&&n.free()}},U.prototype._afterCrossSigningLocalKeyChange=async function(){l.a.info("Starting cross-signing key change post-processing");const e=this._deviceList.getStoredDevice(this._userId,this._deviceId),t=await this._crossSigningInfo.signDevice(this._userId,e);l.a.info("Starting background key sig upload for "+this._deviceId);const a=e=>{let{shouldEmit:n}=e;return this._baseApis.uploadKeySignatures({[this._userId]:{[this._deviceId]:t}}).then(e=>{const{failures:t}=e||{};if(Object.keys(t||[]).length>0)throw n&&this._baseApis.emit("crypto.keySignatureUploadFailure",t,"_afterCrossSigningLocalKeyChange",a),new k.c("Key upload failed",{failures:t});l.a.info("Finished background key sig upload for "+this._deviceId)}).catch(e=>{l.a.error("Error during background key sig upload for "+this._deviceId,e)})};a({shouldEmit:!0});const n=this._baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(n){l.a.info("Starting device verification upgrade");const e={};for(const[t,a]of Object.entries(this._deviceList._crossSigningInfo)){const n=await this._checkForDeviceVerificationUpgrade(t,g.a.fromStorage(a,t));n&&(e[t]=n)}if(Object.keys(e).length>0){l.a.info(`Found ${Object.keys(e).length} verif users to upgrade`);try{const t=await n({users:e});if(t)for(const a of t)a in e&&await this._baseApis.setDeviceVerified(a,e[a].crossSigningInfo.getId())}catch(e){l.a.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e)}}l.a.info("Finished device verification upgrade")}l.a.info("Finished cross-signing key change post-processing")},U.prototype._checkForDeviceVerificationUpgrade=async function(e,t){const a=this._crossSigningInfo.checkUserTrust(t);if(t.firstUse&&!a.verified){const a=this._deviceList.getRawStoredDevicesForUser(e),n=await this._checkForValidDeviceSignature(e,t.keys.master,a);if(n.length)return{devices:n.map(e=>h.a.fromStorage(a[e],e)),crossSigningInfo:t}}},U.prototype._checkForValidDeviceSignature=async function(e,t,a){const n=[];if(a&&t.signatures&&t.signatures[e])for(const s of Object.keys(t.signatures[e])){const[,i]=s.split(":",2);if(i in a&&a[i].verified===D.VERIFIED)try{await m.verifySignature(this._olmDevice,t,e,i,a[i].keys[s]),n.push(i)}catch(e){}}return n},U.prototype.getCrossSigningId=function(e){return this._crossSigningInfo.getId(e)},U.prototype.getStoredCrossSigningForUser=function(e){return this._deviceList.getStoredCrossSigningForUser(e)},U.prototype.checkUserTrust=function(e){const t=this._deviceList.getStoredCrossSigningForUser(e);return t?this._crossSigningInfo.checkUserTrust(t):new g.c(!1,!1,!1)},U.prototype.checkDeviceTrust=function(e,t){const a=this._deviceList.getStoredDevice(e,t);return this._checkDeviceInfoTrust(e,a)},U.prototype._checkDeviceInfoTrust=function(e,t){const a=!(!t||!t.isVerified()),n=this._deviceList.getStoredCrossSigningForUser(e);if(t&&n){const s=this._trustCrossSignedDevices||e===this._userId;return this._crossSigningInfo.checkDeviceTrust(n,t,a,s)}return new g.b(!1,!1,a,!1)},U.prototype._onDeviceListUserCrossSigningUpdated=async function(e){if(e===this._userId){const t=this._deviceList.getStoredCrossSigningForUser(e),a=t?t.getId():null,n=this._crossSigningInfo.getId(),s=n!==a;n&&a&&!s?await this.checkOwnCrossSigningTrust():(this._storeTrustedSelfKeys(null),this.emit("crossSigning.keysChanged",{}),this.emit("userTrustStatusChanged",this._userId,this.checkUserTrust(e)))}else{await this._checkDeviceVerifications(e);const t=this._deviceList.getStoredCrossSigningForUser(e);t&&(t.updateCrossSigningVerifiedBefore(this.checkUserTrust(e).isCrossSigningVerified()),this._deviceList.setRawStoredCrossSigningForUser(e,t.toStorage())),this.emit("userTrustStatusChanged",e,this.checkUserTrust(e))}},U.prototype.checkOwnCrossSigningTrust=async function(){let{allowPrivateKeyRequests:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this._userId;await this.downloadKeys([this._userId]);const a=await this._crossSigningInfo.getCrossSigningKeysFromCache(),n=this._deviceList.getStoredCrossSigningForUser(t);if(!n)return void l.a.error("Got cross-signing update event for user "+t+" but no new cross-signing information found!");const s=n.getId(),i=this._crossSigningInfo.getId()!==s,o=n.getId()&&!a.has("master");if(i&&l.a.info("Got new master public key",s),e&&(i||o)){l.a.info("Attempting to retrieve cross-signing master private key");let e=null;try{e=(await this._crossSigningInfo.getCrossSigningKey("master",s))[1],l.a.info("Got cross-signing master private key")}finally{e&&e.free()}}const r=this._crossSigningInfo.getId("self_signing"),c=this._crossSigningInfo.getId("user_signing");this._storeTrustedSelfKeys(n.keys);const d=r!==n.getId("self_signing"),m=c!==n.getId("user_signing"),u=n.getId("self_signing")&&!a.has("self_signing"),h=n.getId("user_signing")&&!a.has("user_signing"),p={};if(d&&l.a.info("Got new self-signing key",n.getId("self_signing")),e&&(d||u)){l.a.info("Attempting to retrieve cross-signing self-signing private key");let e=null;try{e=(await this._crossSigningInfo.getCrossSigningKey("self_signing",n.getId("self_signing")))[1],l.a.info("Got cross-signing self-signing private key")}finally{e&&e.free()}const t=this._deviceList.getStoredDevice(this._userId,this._deviceId),a=await this._crossSigningInfo.signDevice(this._userId,t);p[this._deviceId]=a}if(m&&l.a.info("Got new user-signing key",n.getId("user_signing")),e&&(m||h)){l.a.info("Attempting to retrieve cross-signing user-signing private key");let e=null;try{e=(await this._crossSigningInfo.getCrossSigningKey("user_signing",n.getId("user_signing")))[1],l.a.info("Got cross-signing user-signing private key")}finally{e&&e.free()}}if(i){const e=this._crossSigningInfo.keys.master;await this._signObject(e);const t=e.signatures[this._userId]["ed25519:"+this._deviceId];p[this._crossSigningInfo.getId()]=Object.assign({},e,{signatures:{[this._userId]:{["ed25519:"+this._deviceId]:t}}})}const g=Object.keys(p);if(g.length){const e=t=>{let{shouldEmit:a}=t;return l.a.info("Starting background key sig upload for "+g),this._baseApis.uploadKeySignatures({[this._userId]:p}).then(t=>{const{failures:n}=t||{};if(l.a.info("Finished background key sig upload for "+g),Object.keys(n||[]).length>0)throw a&&this._baseApis.emit("crypto.keySignatureUploadFailure",n,"checkOwnCrossSigningTrust",e),new k.c("Key upload failed",{failures:n})}).catch(e=>{l.a.error("Error during background key sig upload for "+g,e)})};e({shouldEmit:!0})}this.emit("userTrustStatusChanged",t,this.checkUserTrust(t)),i&&(this._baseApis.emit("crossSigning.keysChanged",{}),await this._afterCrossSigningLocalKeyChange()),await this._backupManager.checkKeyBackup()},U.prototype._storeTrustedSelfKeys=async function(e){e?this._crossSigningInfo.setKeys(e):this._crossSigningInfo.clearKeys(),await this._cryptoStore.doTxn("readwrite",[y.a.STORE_ACCOUNT],e=>{this._cryptoStore.storeCrossSigningKeys(e,this._crossSigningInfo.keys)})},U.prototype._checkDeviceVerifications=async function(e){const t=this._baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(t){if(l.a.info("Starting device verification upgrade for "+e),this._crossSigningInfo.keys.user_signing){const a=this._deviceList.getStoredCrossSigningForUser(e);if(a){const n=await this._checkForDeviceVerificationUpgrade(e,a);if(n){(await t({users:{[e]:n}})).includes(e)&&await this._baseApis.setDeviceVerified(e,a.getId())}}}l.a.info("Finished device verification upgrade for "+e)}},U.prototype.setTrustedBackupPubKey=async function(e){this._sessionStore.setLocalTrustedBackupPubKey(e),await this._backupManager.checkKeyBackup()},U.prototype.enableLazyLoading=function(){this._lazyLoadMembers=!0},U.prototype.registerEventHandlers=function(e){const t=this;e.on("RoomMember.membership",(function(e,a,n){try{t._onRoomMembership(e,a,n)}catch(e){l.a.error("Error handling membership change:",e)}})),e.on("toDeviceEvent",t._onToDeviceEvent.bind(t));const a=t._onTimelineEvent.bind(t);e.on("Room.timeline",a),e.on("Event.decrypted",a)},U.prototype.start=function(){this._outgoingRoomKeyRequestManager.start()},U.prototype.stop=function(){this._outgoingRoomKeyRequestManager.stop(),this._deviceList.stop(),this._dehydrationManager.stop()},U.getOlmVersion=function(){return d.a.getOlmVersion()},U.prototype.getDeviceEd25519Key=function(){return this._olmDevice.deviceEd25519Key},U.prototype.getDeviceCurve25519Key=function(){return this._olmDevice.deviceCurve25519Key},U.prototype.setGlobalBlacklistUnverifiedDevices=function(e){this._globalBlacklistUnverifiedDevices=e},U.prototype.getGlobalBlacklistUnverifiedDevices=function(){return this._globalBlacklistUnverifiedDevices},U.prototype.setGlobalErrorOnUnknownDevices=function(e){this._globalErrorOnUnknownDevices=e},U.prototype.getGlobalErrorOnUnknownDevices=function(){return this._globalErrorOnUnknownDevices},U.prototype.uploadDeviceKeys=function(){const e=this,t=e._userId,a=e._deviceId,n={algorithms:e._supportedAlgorithms,device_id:a,keys:e._deviceKeys,user_id:t};return e._signObject(n).then(()=>e._baseApis.uploadKeysRequest({device_keys:n}))},U.prototype.updateOneTimeKeyCount=function(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this._oneTimeKeyCount=e},U.prototype.setNeedsNewFallback=function(e){this._needsNewFallback=!!e},U.prototype.getNeedsNewFallback=function(){return this._needsNewFallback},U.prototype.downloadKeys=function(e,t){return this._deviceList.downloadKeys(e,t)},U.prototype.getStoredDevicesForUser=function(e){return this._deviceList.getStoredDevicesForUser(e)},U.prototype.getStoredDevice=function(e,t){return this._deviceList.getStoredDevice(e,t)},U.prototype.saveDeviceList=function(e){return this._deviceList.saveIfDirty(e)},U.prototype.setDeviceVerification=async function(e,t,a,n,s){void 0===a&&(a=null),void 0===n&&(n=null),void 0===s&&(s=null);const i=this._deviceList.getStoredCrossSigningForUser(e);if(i&&i.getId()===t){if(null!==n||null!==s)throw new Error("Cannot set blocked or known for a cross-signing key");if(!a)throw new Error("Cannot set a cross-signing key as unverified");if(this._crossSigningInfo.getId()||e!==this._crossSigningInfo.userId||(this._storeTrustedSelfKeys(i.keys),this.emit("userTrustStatusChanged",this._userId,this.checkUserTrust(e))),e!==this._userId){l.a.info("Master key "+i.getId()+" for "+e+" marked verified. Signing...");const a=await this._crossSigningInfo.signUser(i);if(a){const n=async s=>{let{shouldEmit:i}=s;l.a.info("Uploading signature for "+e+"...");const o=await this._baseApis.uploadKeySignatures({[e]:{[t]:a}}),{failures:r}=o||{};if(Object.keys(r||[]).length>0)throw i&&this._baseApis.emit("crypto.keySignatureUploadFailure",r,"setDeviceVerification",n),new k.c("Key upload failed",{failures:r})};await n({shouldEmit:!0})}return a}return i}const o=this._deviceList.getRawStoredDevicesForUser(e);if(!o||!o[t])throw new Error("Unknown device "+e+":"+t);const r=o[t];let c=r.verified;a?c=D.VERIFIED:null!==a&&c==D.VERIFIED&&(c=D.UNVERIFIED),n?c=D.BLOCKED:null!==n&&c==D.BLOCKED&&(c=D.UNVERIFIED);let d=r.known;if(null!==s&&(d=s),r.verified===c&&r.known===d||(r.verified=c,r.known=d,this._deviceList.storeDevicesForUser(e,o),this._deviceList.saveIfDirty()),a&&e===this._userId){let a;l.a.info("Own device "+t+" marked verified: signing");if(this.checkDeviceTrust(e,t).isCrossSigningVerified()?l.a.log(`Own device ${t} already cross-signing verified`):a=await this._crossSigningInfo.signDevice(e,h.a.fromStorage(r,t)),a){const n=async s=>{let{shouldEmit:i}=s;l.a.info("Uploading signature for "+t);const o=await this._baseApis.uploadKeySignatures({[e]:{[t]:a}}),{failures:r}=o||{};if(Object.keys(r||[]).length>0)throw i&&this._baseApis.emit("crypto.keySignatureUploadFailure",r,"setDeviceVerification",n),new k.c("Key upload failed",{failures:r})};await n({shouldEmit:!0})}}const m=h.a.fromStorage(r,t);return this.emit("deviceVerificationChanged",e,t,m),m},U.prototype.findVerificationRequestDMInProgress=function(e){return this._inRoomVerificationRequests.findRequestInProgress(e)},U.prototype.getVerificationRequestsToDeviceInProgress=function(e){return this._toDeviceVerificationRequests.getRequestsInProgress(e)},U.prototype.requestVerificationDM=function(e,t){const a=this._inRoomVerificationRequests.findRequestInProgress(t);if(a)return Promise.resolve(a);const n=new O.a(this._baseApis,t,e);return this._requestVerificationWithChannel(e,n,this._inRoomVerificationRequests)},U.prototype.requestVerification=function(e,t){t||(t=Object.keys(this._deviceList.getRawStoredDevicesForUser(e)));const a=this._toDeviceVerificationRequests.findRequestInProgress(e,t);if(a)return Promise.resolve(a);const n=new x.a(this._baseApis,e,t,x.a.makeTransactionId());return this._requestVerificationWithChannel(e,n,this._toDeviceVerificationRequests)},U.prototype._requestVerificationWithChannel=async function(e,t,a){let n=new w.k(t,this._verificationMethods,this._baseApis);t.transactionId&&a.setRequestByChannel(t,n),await n.sendRequest();const s=a.getRequestByChannel(t);return s?n=s:(l.a.log(`Crypto: adding new request to requestsByTxnId with id ${t.transactionId} ${t.roomId}`),a.setRequestByChannel(t,n)),n},U.prototype.beginKeyVerification=function(e,t,a){let n,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(s){if(n=this._toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,s),!n)throw new Error(`No request found for user ${t} with transactionId `+s)}else{s=x.a.makeTransactionId();const e=new x.a(this._baseApis,t,[a],s,a);n=new w.k(e,this._verificationMethods,this._baseApis),this._toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,s,n)}return n.beginKeyVerification(e,{userId:t,deviceId:a})},U.prototype.legacyDeviceVerification=async function(e,t,a){const n=x.a.makeTransactionId(),s=new x.a(this._baseApis,e,[t],n,t),i=new w.k(s,this._verificationMethods,this._baseApis);this._toDeviceVerificationRequests.setRequestBySenderAndTxnId(e,n,i);const o=i.beginKeyVerification(a,{userId:e,deviceId:t});return await Promise.race([o.verify(),i.waitFor(e=>e.started)]),i},U.prototype.getOlmSessionsForUser=async function(e){const t=this.getStoredDevicesForUser(e)||[],a={};for(let e=0;e<t.length;++e){const n=t[e],s=n.getIdentityKey(),i=await this._olmDevice.getSessionInfoForDevice(s);a[n.deviceId]={deviceIdKey:s,sessions:i}}return a},U.prototype.getEventSenderDeviceInfo=function(e){const t=e.getSenderKey(),a=e.getWireContent().algorithm;if(!t||!a)return null;if(e.getForwardingCurve25519KeyChain().length>0)return null;if(e.isKeySourceUntrusted())return null;const n=this._deviceList.getDeviceByIdentityKey(a,t);if(null===n)return null;const s=e.getClaimedEd25519Key();return s?s!==n.getFingerprint()?(l.a.warn("Event "+e.getId()+" claims ed25519 key "+s+" but sender device has key "+n.getFingerprint()),null):n:(l.a.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)},U.prototype.getEventEncryptionInfo=function(e){const t={};if(t.senderKey=e.getSenderKey(),t.algorithm=e.getWireContent().algorithm,!t.senderKey||!t.algorithm)return t.encrypted=!1,t;t.encrypted=!0;e.getForwardingCurve25519KeyChain().length>0||e.isKeySourceUntrusted()?t.authenticated=!1:t.authenticated=!0,t.sender=this._deviceList.getDeviceByIdentityKey(t.algorithm,t.senderKey);const a=e.getClaimedEd25519Key();return a||(l.a.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),t.mismatchedSender=!0),t.sender&&a!==t.sender.getFingerprint()&&(l.a.warn("Event "+e.getId()+" claims ed25519 key "+a+"but sender device has key "+t.sender.getFingerprint()),t.mismatchedSender=!0),t},U.prototype.forceDiscardSession=function(e){const t=this._roomEncryptors[e];if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()},U.prototype.setRoomEncryption=async function(e,t,a){if(!t.algorithm)return void l.a.log("Ignoring setRoomEncryption with no algorithm");const n=this._roomList.getRoomEncryption(e);if(n&&JSON.stringify(n)!=JSON.stringify(t))return void l.a.error("Ignoring m.room.encryption event which requests a change of config in "+e);if(this._roomEncryptors[e])return;let s=null;n||(s=this._roomList.setRoomEncryption(e,t));const i=p.c[t.algorithm];if(!i)throw new Error("Unable to encrypt with "+t.algorithm);const o=new i({userId:this._userId,deviceId:this._deviceId,crypto:this,olmDevice:this._olmDevice,baseApis:this._baseApis,roomId:e,config:t});this._roomEncryptors[e]=o,s&&await s,this._lazyLoadMembers?l.a.log("Enabling encryption in "+e):(l.a.log("Enabling encryption in "+e+"; starting to track device lists for all users therein"),await this.trackRoomDevices(e),this.inhibitDeviceQuery||this._deviceList.refreshOutdatedDeviceLists())},U.prototype.trackRoomDevices=function(e){const t=async()=>{if(!this._roomEncryptors[e])return;const t=this._clientStore.getRoom(e);if(!t)throw new Error("Unable to start tracking devices in unknown room "+e);l.a.log(`Starting to track devices for room ${e} ...`);(await t.getEncryptionTargetMembers()).forEach(e=>{this._deviceList.startTrackingDeviceList(e.userId)})};let a=this._roomDeviceTrackingState[e];return a||(a=t(),this._roomDeviceTrackingState[e]=a.catch(t=>{throw this._roomDeviceTrackingState[e]=null,t})),a},U.prototype.ensureOlmSessionsForUsers=function(e){const t={};for(let a=0;a<e.length;++a){const n=e[a];t[n]=[];const s=this.getStoredDevicesForUser(n)||[];for(let e=0;e<s.length;++e){const a=s[e];a.getIdentityKey()!=this._olmDevice.deviceCurve25519Key&&(a.verified!=D.BLOCKED&&t[n].push(a))}}return m.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,t)},U.prototype.exportRoomKeys=async function(){const e=[];return await this._cryptoStore.doTxn("readonly",[y.a.STORE_INBOUND_GROUP_SESSIONS],t=>{this._cryptoStore.getAllEndToEndInboundGroupSessions(t,t=>{if(null===t)return;const a=this._olmDevice.exportInboundGroupSession(t.senderKey,t.sessionId,t.sessionData);delete a.first_known_index,a.algorithm=m.MEGOLM_ALGORITHM,e.push(a)})}),e},U.prototype.importRoomKeys=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=0,n=0;const s=e.length;function i(){t.progressCallback({stage:"load_keys",successes:a,failures:n,total:s})}return Promise.all(e.map(e=>{if(!e.room_id||!e.algorithm)return l.a.warn("ignoring room key entry with missing fields",e),n++,t.progressCallback&&i(),null;return this._getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,t).finally(e=>{a++,t.progressCallback&&i()})}))},U.prototype.countSessionsNeedingBackup=function(){return this._backupManager.countSessionsNeedingBackup()},U.prototype.prepareToEncrypt=function(e){const t=e.roomId,a=this._roomEncryptors[t];a&&a.prepareToEncrypt(e)},U.prototype.encryptEvent=async function(e,t){if(!t)throw new Error("Cannot send encrypted messages in unknown rooms");const a=e.getRoomId(),n=this._roomEncryptors[a];if(!n)throw new Error("Room was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");this._roomDeviceTrackingState[a]||this.trackRoomDevices(a),await this._roomDeviceTrackingState[a];let s=e.getContent();const i=s["m.relates_to"];i&&(s=Object.assign({},s),delete s["m.relates_to"]);const o=await n.encryptMessage(t,e.getType(),s);i&&(o["m.relates_to"]=i),e.makeEncrypted("m.room.encrypted",o,this._olmDevice.deviceCurve25519Key,this._olmDevice.deviceEd25519Key)},U.prototype.decryptEvent=async function(e){if(e.isRedacted()){const t=new P.b(e.getUnsigned().redacted_because),a=await this.decryptEvent(t);return{clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:a.clearEvent}}}}{const t=e.getWireContent(),a=this._getRoomDecryptor(e.getRoomId(),t.algorithm);return await a.decryptEvent(e)}},U.prototype.handleDeviceListChanges=async function(e,t){e.oldSyncToken&&await this._evalDeviceListChanges(t)},U.prototype.requestRoomKey=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,a).then(()=>{this._sendKeyRequestsImmediately&&this._outgoingRoomKeyRequestManager.sendQueuedRequests()}).catch(e=>{l.a.error("Error requesting key for event",e)})},U.prototype.cancelRoomKeyRequest=function(e){this._outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch(e=>{l.a.warn("Error clearing pending room key requests",e)})},U.prototype.cancelAndResendAllOutgoingKeyRequests=function(){return this._outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()},U.prototype.onCryptoEvent=async function(e){const t=e.getRoomId(),a=e.getContent();try{await this.setRoomEncryption(t,a,!0)}catch(e){l.a.error("Error configuring encryption in room "+t+":",e)}},U.prototype.onSyncWillProcess=async function(e){e.oldSyncToken||(l.a.log("Initial sync performed - resetting device tracking state"),this._deviceList.stopTrackingAllDeviceLists(),this._deviceList.startTrackingDeviceList(this._userId),this._roomDeviceTrackingState={}),this._sendKeyRequestsImmediately=!1},U.prototype.onSyncCompleted=async function(e){const t=e.nextSyncToken;this._deviceList.setSyncToken(e.nextSyncToken),this._deviceList.saveIfDirty(),this._deviceList.lastKnownSyncToken=t,this._deviceList.startTrackingDeviceList(this._userId),this._deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(F(this),this._processReceivedRoomKeyRequests(),this._outgoingRoomKeyRequestManager.sendQueuedRequests(),this._sendKeyRequestsImmediately=!0)},U.prototype._evalDeviceListChanges=async function(e){if(e.changed&&Array.isArray(e.changed)&&e.changed.forEach(e=>{this._deviceList.invalidateUserDeviceList(e)}),e.left&&Array.isArray(e.left)&&e.left.length){const t=new Set(await this._getTrackedE2eUsers());e.left.forEach(e=>{t.has(e)||this._deviceList.stopTrackingDeviceList(e)})}},U.prototype._getTrackedE2eUsers=async function(){const e=[];for(const t of this._getTrackedE2eRooms()){const a=await t.getEncryptionTargetMembers();for(const t of a)e.push(t.userId)}return e},U.prototype._getTrackedE2eRooms=function(){return this._clientStore.getRooms().filter(e=>{if(!this._roomEncryptors[e.roomId])return!1;if(!this._roomDeviceTrackingState[e.roomId])return!1;const t=e.getMyMembership();return"join"===t||"invite"===t})},U.prototype._onToDeviceEvent=function(e){try{l.a.log(`received to_device ${e.getType()} from: ${e.getSender()} id: ${e.getId()}`),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?this._onRoomKeyEvent(e):"m.room_key_request"==e.getType()?this._onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?this._secretStorage._onRequestReceived(e):"m.secret.send"===e.getType()?this._secretStorage._onSecretReceived(e):"org.matrix.room_key.withheld"===e.getType()?this._onRoomKeyWithheldEvent(e):e.getContent().transaction_id?this._onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?this._onToDeviceBadEncrypted(e):(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&(e.isBeingDecrypted()||e.attemptDecryption(this),e.once("Event.decrypted",e=>{this._onToDeviceEvent(e)}))}catch(e){l.a.error("Error handling toDeviceEvent:",e)}},U.prototype._onRoomKeyEvent=function(e){const t=e.getContent();if(!t.room_id||!t.algorithm)return void l.a.error("key event is missing fields");this._backupManager.checkedForBackup||this._backupManager.checkAndStart();this._getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)},U.prototype._onRoomKeyWithheldEvent=function(e){const t=e.getContent();if(!(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key))return void l.a.error("key withheld event is missing fields");l.a.info(`Got room key withheld event from ${e.getSender()} (${t.sender_key}) for ${t.algorithm}/${t.room_id}/${t.session_id} with reason ${t.code} (${t.reason})`);const a=this._getRoomDecryptor(t.room_id,t.algorithm);if(a.onRoomKeyWithheldEvent&&a.onRoomKeyWithheldEvent(e),!t.room_id){const e=this._getRoomDecryptors(t.algorithm);for(const a of e)a.retryDecryptionFromSender(t.sender_key)}},U.prototype._onKeyVerificationMessage=function(e){if(!x.a.validateEvent(e,this._baseApis))return;this._handleVerificationEvent(e,this._toDeviceVerificationRequests,e=>{if(!x.a.canCreateRequest(x.a.getEventType(e)))return;const t=e.getContent(),a=t&&t.from_device;if(!a)return;const n=e.getSender(),s=new x.a(this._baseApis,n,[a]);return new w.k(s,this._verificationMethods,this._baseApis)})},U.prototype._onTimelineEvent=function(e,t,a,n){let{liveEvent:s}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!O.a.validateEvent(e,this._baseApis))return;const i=e=>{const t=new O.a(this._baseApis,e.getRoomId());return new w.k(t,this._verificationMethods,this._baseApis)};this._handleVerificationEvent(e,this._inRoomVerificationRequests,i,s)},U.prototype._handleVerificationEvent=async function(e,t,a){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=t.getRequest(e),i=!1;if(!s){if(s=a(e),!s)return void l.a.log("Crypto: could not find VerificationRequest for "+e.getType()+", and could not create one, so ignoring.");i=!0,t.setRequest(e,s)}e.setVerificationRequest(s);try{await s.channel.handleEvent(e,s,n)}catch(e){l.a.error("error while handling verification event: "+e.message)}const o=i&&!s.initiatedByMe&&!s.invalid&&!s.observeOnly;o&&this._baseApis.emit("crypto.verification.request",s)},U.prototype._onToDeviceBadEncrypted=async function(e){const t=e.getWireContent(),a=e.getSender(),n=t.algorithm,s=t.sender_key,i=()=>{const e=this._getRoomDecryptors(m.MEGOLM_ALGORITHM);for(const t of e)t.retryDecryptionFromSender(s)};if(void 0===a||void 0===s||void 0===s)return;this._lastNewSessionForced[a]=this._lastNewSessionForced[a]||{};const o=this._lastNewSessionForced[a][s]||0;if(o+36e5>Date.now())return l.a.debug("New session already forced with device "+a+":"+s+" at "+o+": not forcing another"),await this._olmDevice.recordSessionProblem(s,"wedged",!0),void i();let r=this._deviceList.getDeviceByIdentityKey(n,s);if(!r&&(await this.downloadKeys([a],!1),r=this._deviceList.getDeviceByIdentityKey(n,s),!r))return l.a.info("Couldn't find device for identity key "+s+": not re-establishing session"),await this._olmDevice.recordSessionProblem(s,"wedged",!1),void i();const c={};c[a]=[r],await m.ensureOlmSessionsForDevices(this._olmDevice,this._baseApis,c,!0),this._lastNewSessionForced[a][s]=Date.now();const d={algorithm:m.OLM_ALGORITHM,sender_key:this._olmDevice.deviceCurve25519Key,ciphertext:{}};await m.encryptMessageForDevice(d.ciphertext,this._userId,this._deviceId,this._olmDevice,a,r,{type:"m.dummy"}),await this._olmDevice.recordSessionProblem(s,"wedged",!0),i(),await this._baseApis.sendToDevice("m.room.encrypted",{[a]:{[r.deviceId]:d}});const u=await this._outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(a,r.deviceId);for(const e of u)this.requestRoomKey(e.requestBody,e.recipients,!0)},U.prototype._onRoomMembership=function(e,t,a){const n=t.roomId,s=this._roomEncryptors[n];s&&(this._roomDeviceTrackingState[n]&&("join"==t.membership?(l.a.log("Join event for "+t.userId+" in "+n),this._deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&this._clientStore.getRoom(n).shouldEncryptForInvitedMembers()&&(l.a.log("Invite event for "+t.userId+" in "+n),this._deviceList.startTrackingDeviceList(t.userId))),s.onRoomMembership(e,t,a))},U.prototype._onRoomKeyRequestEvent=function(e){const t=e.getContent();if("request"===t.action){const t=new V(e);this._receivedRoomKeyRequests.push(t)}else if("request_cancellation"===t.action){const t=new G(e);this._receivedRoomKeyRequestCancellations.push(t)}},U.prototype._processReceivedRoomKeyRequests=async function(){if(!this._processingRoomKeyRequests){this._processingRoomKeyRequests=!0;try{const e=this._receivedRoomKeyRequests;this._receivedRoomKeyRequests=[];const t=this._receivedRoomKeyRequestCancellations;this._receivedRoomKeyRequestCancellations=[],await Promise.all(e.map(e=>this._processReceivedRoomKeyRequest(e))),await Promise.all(t.map(e=>this._processReceivedRoomKeyRequestCancellation(e)))}catch(e){l.a.error("Error processing room key requsts: "+e)}finally{this._processingRoomKeyRequests=!1}}},U.prototype._processReceivedRoomKeyRequest=async function(e){const t=e.userId,a=e.deviceId,n=e.requestBody,s=n.room_id,i=n.algorithm;if(l.a.log(`m.room_key_request from ${t}:${a} for ${s} / ${n.session_id} (id ${e.requestId})`),t!==this._userId){if(!this._roomEncryptors[s])return void l.a.debug("room key request for unencrypted room "+s);const e=this._roomEncryptors[s],i=this._deviceList.getStoredDevice(t,a);if(!i)return void l.a.debug(`Ignoring keyshare for unknown device ${t}:${a}`);try{await e.reshareKeyWithDevice(n.sender_key,n.session_id,t,i)}catch(e){l.a.warn("Failed to re-share keys for session "+n.session_id+" with device "+t+":"+i.deviceId,e)}return}if(a===this._deviceId)return void l.a.log("Ignoring room key request from ourselves");if(!this._roomDecryptors[s])return void l.a.log("room key request for unencrypted room "+s);const o=this._roomDecryptors[s][i];if(o)if(await o.hasKeysForKeyRequest(e)){if(e.share=()=>{o.shareKeysWithDevice(e)},this.checkDeviceTrust(t,a).isVerified())return l.a.log("device is already verified: sharing keys"),void e.share();this.emit("crypto.roomKeyRequest",e)}else l.a.log(`room key request for unknown session ${s} / `+n.session_id);else l.a.log(`room key request for unknown alg ${i} in room ${s}`)},U.prototype._processReceivedRoomKeyRequestCancellation=async function(e){l.a.log(`m.room_key_request cancellation for ${e.userId}:${e.deviceId} (id ${e.requestId})`),this.emit("crypto.roomKeyRequestCancellation",e)},U.prototype._getRoomDecryptor=function(e,t){let a,n;if((e=e||null)&&(a=this._roomDecryptors[e],a||(this._roomDecryptors[e]=a={}),n=a[t],n))return n;const s=p.a[t];if(!s)throw new p.b("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return n=new s({userId:this._userId,crypto:this,olmDevice:this._olmDevice,baseApis:this._baseApis,roomId:e}),a&&(a[t]=n),n},U.prototype._getRoomDecryptors=function(e){const t=[];for(const a of Object.values(this._roomDecryptors))e in a&&t.push(a[e]);return t},U.prototype._signObject=async function(e){const t=e.signatures||{},a=e.unsigned;delete e.signatures,delete e.unsigned,t[this._userId]=t[this._userId]||{},t[this._userId]["ed25519:"+this._deviceId]=await this._olmDevice.sign(i.a.stringify(e)),e.signatures=t,void 0!==a&&(e.unsigned=a)};class V{constructor(e){const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id,this.requestBody=t.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}class G{constructor(e){const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id}}}).call(this,a(7),a(36).Buffer)},585:function(e,t,a){"use strict";function n(e){Object.defineProperty(this,"deviceId",{enumerable:!0,value:e}),this.algorithms=[],this.keys={},this.verified=s.UNVERIFIED,this.known=!1,this.unsigned={},this.signatures={}}a.d(t,"a",(function(){return n})),n.fromStorage=function(e,t){const a=new n(t);for(const t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);return a},n.prototype.toStorage=function(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}},n.prototype.getFingerprint=function(){return this.keys["ed25519:"+this.deviceId]},n.prototype.getIdentityKey=function(){return this.keys["curve25519:"+this.deviceId]},n.prototype.getDisplayName=function(){return this.unsigned.device_display_name||null},n.prototype.isBlocked=function(){return this.verified==s.BLOCKED},n.prototype.isVerified=function(){return this.verified==s.VERIFIED},n.prototype.isUnverified=function(){return this.verified==s.UNVERIFIED},n.prototype.isKnown=function(){return 1==this.known},n.DeviceVerification={VERIFIED:1,UNVERIFIED:0,BLOCKED:-1};const s=n.DeviceVerification},586:function(e,t,a){"use strict";(function(e,n){a.d(t,"a",(function(){return d})),a.d(t,"c",(function(){return u})),a.d(t,"b",(function(){return h})),a.d(t,"d",(function(){return p})),a.d(t,"e",(function(){return g}));var s=a(213),i=a(8),o=a(0),r=a(246),l=a(486);function c(e){return Object.values(e.keys)[0]}class d extends i.EventEmitter{constructor(e,t,a){super(),Object.defineProperty(this,"userId",{enumerable:!0,value:e}),this._callbacks=t||{},this._cacheCallbacks=a||{},this.keys={},this.firstUse=!0,this.crossSigningVerifiedBefore=!1}static fromStorage(e,t){const a=new d(t);for(const t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);return a}toStorage(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}async getCrossSigningKey(t,a){const n=["master","self_signing","user_signing"].indexOf(t)>=0;if(!this._callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");function s(t){if(!t)return;const n=new e.Olm.PkSigning,s=n.init_with_seed(t);if(s===a)return[s,n];n.free()}let i;void 0===a&&(a=this.getId(t)),this._cacheCallbacks.getCrossSigningKeyCache&&n&&(i=await this._cacheCallbacks.getCrossSigningKeyCache(t,a));const o=s(i);if(o)return o;i=await this._callbacks.getCrossSigningKey(t,a);const r=s(i);if(r)return this._cacheCallbacks.storeCrossSigningKeyCache&&n&&await this._cacheCallbacks.storeCrossSigningKeyCache(t,i),r;if(!i)throw new Error("getCrossSigningKey callback for "+t+" returned falsey");throw new Error("Key type "+t+" from getCrossSigningKey callback did not match")}async isStoredInSecretStorage(e){const t=await e.isStored("m.cross_signing.master",!1)||{};function a(e){for(const a of Object.keys(t))e[a]||delete t[a]}for(const t of["self_signing","user_signing"])a(await e.isStored("m.cross_signing."+t,!1)||{});return Object.keys(t).length?t:null}static async storeInSecretStorage(e,t){for(const[a,n]of e){const e=Object(s.encodeBase64)(n);await t.store("m.cross_signing."+a,e)}}static async getFromSecretStorage(e,t){const a=await t.get("m.cross_signing."+e);return a?Object(s.decodeBase64)(a):null}async isStoredInKeyCache(e){const t=this._cacheCallbacks;if(!t)return!1;const a=e?[e]:["master","self_signing","user_signing"];for(const e of a)if(!await t.getCrossSigningKeyCache(e))return!1;return!0}async getCrossSigningKeysFromCache(){const e=new Map,t=this._cacheCallbacks;if(!t)return e;for(const a of["master","self_signing","user_signing"]){const n=await t.getCrossSigningKeyCache(a);n&&e.set(a,n)}return e}getId(e){if(e=e||"master",!this.keys[e])return null;return c(this.keys[e])}async resetKeys(t){if(!this._callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===t||t&m.MASTER||!this.keys.master)t=m.MASTER|m.USER_SIGNING|m.SELF_SIGNING;else if(0===t)return;const a={},n={};let i,o;try{if(t&m.MASTER?(i=new e.Olm.PkSigning,a.master=i.generate_seed(),o=i.init_with_seed(a.master),n.master={user_id:this.userId,usage:["master"],keys:{["ed25519:"+o]:o}}):[o,i]=await this.getCrossSigningKey("master"),t&m.SELF_SIGNING){const t=new e.Olm.PkSigning;try{a.self_signing=t.generate_seed();const e=t.init_with_seed(a.self_signing);n.self_signing={user_id:this.userId,usage:["self_signing"],keys:{["ed25519:"+e]:e}},Object(s.pkSign)(n.self_signing,i,this.userId,o)}finally{t.free()}}if(t&m.USER_SIGNING){const t=new e.Olm.PkSigning;try{a.user_signing=t.generate_seed();const e=t.init_with_seed(a.user_signing);n.user_signing={user_id:this.userId,usage:["user_signing"],keys:{["ed25519:"+e]:e}},Object(s.pkSign)(n.user_signing,i,this.userId,o)}finally{t.free()}}Object.assign(this.keys,n),this._callbacks.saveCrossSigningKeys(a)}finally{i&&i.free()}}clearKeys(){this.keys={}}setKeys(e){const t={};if(e.master){if(e.master.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw o.a.error(t),new Error(t)}this.keys.master?c(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}const a=c(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw o.a.error(t),new Error(t)}try{Object(s.pkVerify)(e.user_signing,a,this.userId)}catch(e){throw o.a.error("invalid signature on user-signing key"),e}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw o.a.error(t),new Error(t)}try{Object(s.pkVerify)(e.self_signing,a,this.userId)}catch(e){throw o.a.error("invalid signature on self-signing key"),e}}e.master&&(this.keys.master=e.master,this.keys.self_signing=null,this.keys.user_signing=null),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}updateCrossSigningVerifiedBefore(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}async signObject(e,t){if(!this.keys[t])throw new Error("Attempted to sign with "+t+" key but no such key present");const[a,n]=await this.getCrossSigningKey(t);try{return Object(s.pkSign)(e,n,this.userId,a),e}finally{n.free()}}async signUser(e){if(this.keys.user_signing)return this.signObject(e.keys.master,"user_signing");o.a.info("No user signing key: not signing user")}async signDevice(e,t){if(e!==this.userId)throw new Error(`Trying to sign ${e}'s device; can only sign our own device`);if(this.keys.self_signing)return this.signObject({algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e},"self_signing");o.a.info("No self signing key: not signing device")}checkUserTrust(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new u(!0,!0,this.firstUse);if(!this.keys.user_signing)return new u(!1,!1,e.firstUse);let t;const a=e.keys.master,n=this.getId("user_signing");try{Object(s.pkVerify)(a,n,this.userId),t=!0}catch(e){t=!1}return new u(t,e.crossSigningVerifiedBefore,e.firstUse)}checkDeviceTrust(e,t,a,n){const i=this.checkUserTrust(e),o=e.keys.self_signing;if(!o)return new h(!1,!1,a,n);const r=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return Object(s.pkVerify)(o,e.getId(),e.userId),Object(s.pkVerify)(r,c(o),e.userId),h.fromUserTrustLevel(i,a,n)}catch(e){return new h(!1,!1,a,n)}}getCacheCallbacks(){return this._cacheCallbacks}}const m={MASTER:4,USER_SIGNING:2,SELF_SIGNING:1};class u{constructor(e,t,a){this._crossSigningVerified=e,this._crossSigningVerifiedBefore=t,this._tofu=a}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this._crossSigningVerified}wasCrossSigningVerified(){return this._crossSigningVerifiedBefore}isTofu(){return this._tofu}}class h{constructor(e,t,a,n){this._crossSigningVerified=e,this._tofu=t,this._localVerified=a,this._trustCrossSignedDevices=n}static fromUserTrustLevel(e,t,a){return new h(e._crossSigningVerified,e._tofu,t,a)}isVerified(){return Boolean(this.isLocallyVerified()||this._trustCrossSignedDevices&&this.isCrossSigningVerified())}isCrossSigningVerified(){return this._crossSigningVerified}isLocallyVerified(){return this._localVerified}isTofu(){return this._tofu}}function p(e,t){return{getCrossSigningKeyCache:async function(a,i){const o=await new Promise(t=>e.doTxn("readonly",[r.a.STORE_ACCOUNT],n=>{e.getSecretStorePrivateKey(n,t,a)}));if(o&&o.ciphertext){const e=n.from(t._pickleKey),i=await Object(l.a)(o,e,a);return Object(s.decodeBase64)(i)}return o},storeCrossSigningKeyCache:async function(a,i){if(!(i instanceof Uint8Array))throw new Error("storeCrossSigningKeyCache expects Uint8Array, got "+i);const o=n.from(t._pickleKey);return i=await Object(l.b)(Object(s.encodeBase64)(i),o,a),e.doTxn("readwrite",[r.a.STORE_ACCOUNT],t=>{e.storeSecretStorePrivateKey(t,a,i)})}}}async function g(e,t,a){if(e.getUserId()===t)return o.a.log("Cross-signing: Self-verification done; requesting keys"),new Promise((t,n)=>{const i=e,r=i.crypto._crossSigningInfo,l=new d(r.userId,{getCrossSigningKey:async e=>{o.a.debug("Cross-signing: requesting secret",e,a);const{promise:t}=i.requestSecret("m.cross_signing."+e,[a]),n=await t,r=Object(s.decodeBase64)(n);return Uint8Array.from(r)}},r._cacheCallbacks);l.keys=r.keys;const c=new Promise((e,t)=>{setTimeout(e,6e4,new Error("Timeout"))}),m=new Promise(async e=>{if(!await i.crypto.getSessionBackupPrivateKey()){o.a.info("No cached backup key found. Requesting...");const e=i.requestSecret("m.megolm_backup.v1",[a]),t=await e.promise;o.a.info("Got key backup key, decoding...");const n=Object(s.decodeBase64)(t);o.a.info("Decoded backup key, storing..."),i.crypto.storeSessionBackupPrivateKey(Uint8Array.from(n)),o.a.info("Backup key stored. Starting backup restore...");const r=await i.getKeyBackupVersion();i.restoreKeyBackupWithCache(void 0,void 0,r).then(()=>{o.a.info("Backup restored.")})}e()});return Promise.race([Promise.all([l.getCrossSigningKey("master"),l.getCrossSigningKey("self_signing"),l.getCrossSigningKey("user_signing"),m]),c]).then(t,n)}).catch(e=>{o.a.warn("Cross-signing: failure while requesting keys:",e)})}}).call(this,a(7),a(36).Buffer)},587:function(e,t,a){"use strict";(function(e){a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return o}));var n=a(294);async function s(t,a){if(!e.Olm)throw new Error("Olm is not available");if(!t.private_key_salt||!t.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return await o(a,t.private_key_salt,t.private_key_iterations,t.private_key_bits||256)}async function i(t){if(!e.Olm)throw new Error("Olm is not available");const a=Object(n.b)(32);return{key:await o(t,a,5e5,256),salt:a,iterations:5e5}}async function o(t,a,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:256;const i=e.crypto.subtle,o=e.TextEncoder;if(!i||!o)throw new Error("Password-based backup is not avaiable on this platform");const r=await i.importKey("raw",(new o).encode(t),{name:"PBKDF2"},!1,["deriveBits"]),l=await i.deriveBits({name:"PBKDF2",salt:(new o).encode(a),iterations:n,hash:"SHA-512"},r,s);return new Uint8Array(l)}}).call(this,a(7))},588:function(e,t,a){"use strict";(function(e,n){a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return l}));var s=a(2415),i=a.n(s);const o=[139,1];function r(t){const a=new e(o.length+t.length+1);a.set(o,0),a.set(t,o.length);let n=0;for(let e=0;e<a.length-1;++e)n^=a[e];a[a.length-1]=n;return i.a.encode(a).match(/.{1,4}/g).join(" ")}function l(e){const t=i.a.decode(e.replace(/ /g,""));let a=0;for(const e of t)a^=e;if(0!==a)throw new Error("Incorrect parity");for(let e=0;e<o.length;++e)if(t[e]!==o[e])throw new Error("Incorrect prefix");if(t.length!==o.length+n.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(t.slice(o.length,o.length+n.Olm.PRIVATE_KEY_LENGTH))}}).call(this,a(36).Buffer,a(7))},589:function(e,t,a){"use strict";function n(e,t){return{msgtype:"m.text",format:"org.matrix.custom.html",body:e,formatted_body:t}}function s(e,t){return{msgtype:"m.notice",format:"org.matrix.custom.html",body:e,formatted_body:t}}function i(e,t){return{msgtype:"m.emote",format:"org.matrix.custom.html",body:e,formatted_body:t}}function o(e){return{msgtype:"m.text",body:e}}function r(e){return{msgtype:"m.notice",body:e}}function l(e){return{msgtype:"m.emote",body:e}}a.r(t),a.d(t,"makeHtmlMessage",(function(){return n})),a.d(t,"makeHtmlNotice",(function(){return s})),a.d(t,"makeHtmlEmote",(function(){return i})),a.d(t,"makeTextMessage",(function(){return o})),a.d(t,"makeNotice",(function(){return r})),a.d(t,"makeEmoteMessage",(function(){return l}))},590:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return m}));var n=a(443),s=a(1),i=a(8),o=a(23),r=a(2424),l=a(346),c=a(146),d=a(0);function m(t){if(n.a.call(this,t),!t.indexedDB)throw new Error("Missing required option: indexedDB");if(t.workerScript){let a=t.workerApi;a||(a=e.Worker),this.backend=new r.a(t.workerScript,t.dbName,a)}else this.backend=new o.a(t.indexedDB,t.dbName);this.startedUp=!1,this._syncTs=0,this._userModifiedMap={}}function u(e,t){return async function(){for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];try{return await e.call(this,...s)}catch(e){d.a.error("IndexedDBStore failure, degrading to MemoryStore",e),this.emit("degraded",e);try{d.a.log("IndexedDBStore trying to delete degraded data"),await this.backend.clearDatabase(),d.a.log("IndexedDBStore delete after degrading succeeeded")}catch(e){d.a.warn("IndexedDBStore delete after degrading failed",e)}if(Object.setPrototypeOf(this,n.a.prototype),t)return await n.a.prototype[t].call(this,...s)}}}s.m(m,n.a),s.j(m.prototype,i.EventEmitter.prototype),m.exists=function(e,t){return o.a.exists(e,t)},m.prototype.startup=function(){return this.startedUp?(d.a.log("IndexedDBStore.startup: already started"),Promise.resolve()):(d.a.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then(()=>(d.a.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(e=>{d.a.log("IndexedDBStore.startup: processing presence events"),e.forEach(e=>{let[t,a]=e;const n=new l.a(t);a&&n.setPresenceEvent(new c.b(a)),this._userModifiedMap[n.userId]=n.getLastModifiedTime(),this.storeUser(n)})}))},m.prototype.getSavedSync=u((function(){return this.backend.getSavedSync()}),"getSavedSync"),m.prototype.isNewlyCreated=u((function(){return this.backend.isNewlyCreated()}),"isNewlyCreated"),m.prototype.getSavedSyncToken=u((function(){return this.backend.getNextBatchToken()}),"getSavedSyncToken"),m.prototype.deleteAllData=u((function(){return n.a.prototype.deleteAllData.call(this),this.backend.clearDatabase().then(()=>{d.a.log("Deleted indexeddb data.")},e=>{throw d.a.error("Failed to delete indexeddb data: "+e),e})})),m.prototype.wantsSave=function(){return Date.now()-this._syncTs>3e5},m.prototype.save=function(e){return e||this.wantsSave()?this._reallySave():Promise.resolve()},m.prototype._reallySave=u((function(){this._syncTs=Date.now();const e=[];for(const t of this.getUsers())this._userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this._userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)})),m.prototype.setSyncData=u((function(e){return this.backend.setSyncData(e)}),"setSyncData"),m.prototype.getOutOfBandMembers=u((function(e){return this.backend.getOutOfBandMembers(e)}),"getOutOfBandMembers"),m.prototype.setOutOfBandMembers=u((function(e,t){return n.a.prototype.setOutOfBandMembers.call(this,e,t),this.backend.setOutOfBandMembers(e,t)}),"setOutOfBandMembers"),m.prototype.clearOutOfBandMembers=u((function(e){return n.a.prototype.clearOutOfBandMembers.call(this),this.backend.clearOutOfBandMembers(e)}),"clearOutOfBandMembers"),m.prototype.getClientOptions=u((function(){return this.backend.getClientOptions()}),"getClientOptions"),m.prototype.storeClientOptions=u((function(e){return n.a.prototype.storeClientOptions.call(this,e),this.backend.storeClientOptions(e)}),"storeClientOptions")}).call(this,a(7))},591:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return i}));var n=a(153);function s(e,t){const a=[...e.keys()],s=[...t.keys()],i=Object(n.a)(a,s);return{changed:Object(n.k)(a,s).filter(a=>e.get(a)!==t.get(a)),added:i.added,removed:i.removed}}class i extends Map{constructor(e){super(e)}getOrCreate(e,t){return this.has(e)?this.get(e):(this.set(e,t),t)}remove(e){const t=this.get(e);return this.delete(e),t}}},595:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(248),o=a(335);class r extends i.a{getValueOverride(e,t,a,n){if(!a)return null;if(r.isLogin)return"light";return Object(o.b)()[a]?null:o.a}}s()(r,"isLogin",!1)},596:function(e,t,a){"use strict";function n(e){return e/10+"rem"}function s(e){return e+"px"}a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return s}))},597:function(e,t,a){"use strict";a.d(t,"a",(function(){return S})),a.d(t,"b",(function(){return C}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(129),d=a.n(c),m=a(92),u=a.n(m),h=a(150),p=a(741),g=a.n(p),f=a(100),v=a(119),b=a(99),y=a(1),E=a(94);function _(e){return document.getElementById(e)}let S=Object(E.a)("views.elements.PersistedElement")((s=class e extends l.a.Component{constructor(){super(),o()(this,"updateChildPosition",Object(h.throttle)((e,t)=>{if(!e||!t)return;const a=t.getBoundingClientRect();Object.assign(e.style,{zIndex:Object(y.o)(this.props.zIndex)?9:this.props.zIndex,position:"absolute",top:a.top+"px",left:a.left+"px",width:a.width+"px",height:a.height+"px"})},100,{trailing:!0,leading:!0})),this.collectChildContainer=this.collectChildContainer.bind(this),this.collectChild=this.collectChild.bind(this),this._repositionChild=this._repositionChild.bind(this),this._onAction=this._onAction.bind(this),this.resizeObserver=new g.a(this._repositionChild),window.addEventListener("resize",this._repositionChild),this._dispatcherRef=f.a.register(this._onAction)}static destroyElement(e){const t=_("mx_persistedElement_"+e);t&&t.remove()}static isMounted(e){return Boolean(_("mx_persistedElement_"+e))}collectChildContainer(e){this.childContainer&&this.resizeObserver.unobserve(this.childContainer),this.childContainer=e,e&&this.resizeObserver.observe(e)}collectChild(e){this.child=e,this.updateChild()}componentDidMount(){this.updateChild(),this.renderApp()}componentDidUpdate(){this.updateChild(),this.renderApp()}componentWillUnmount(){this.updateChildVisibility(this.child,!1),this.resizeObserver.disconnect(),window.removeEventListener("resize",this._repositionChild),f.a.unregister(this._dispatcherRef)}_onAction(t){"timeline_resize"===t.action?this._repositionChild():"logout"===t.action&&e.destroyElement(this.props.persistKey)}_repositionChild(){this.updateChildPosition(this.child,this.childContainer)}updateChild(){this.updateChildPosition(this.child,this.childContainer),this.updateChildVisibility(this.child,!0)}renderApp(){const e=l.a.createElement(v.a.Provider,{value:b.a.get()},l.a.createElement("div",{ref:this.collectChild,style:this.props.style},this.props.children));d.a.render(e,function(e){let t=_(e);return t||(t=document.createElement("div"),t.id=e,document.body.appendChild(t)),t}("mx_persistedElement_"+this.props.persistKey))}updateChildVisibility(e,t){e&&(e.style.display=t?"block":"none")}render(){return l.a.createElement("div",{ref:this.collectChildContainer})}},o()(s,"propTypes",{persistKey:u.a.string.isRequired,zIndex:u.a.number}),n=s))||n;const C=e=>"widget_"+e},598:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(102),o=a.n(i),r=a(498);t.a=function(e){let{name:t,definitions:a,value:n,className:i,outlined:l,onChange:c}=e;const d=e=>{c(e.target.value)};return s.a.createElement(s.a.Fragment,null,a.map(e=>s.a.createElement(s.a.Fragment,{key:e.value},s.a.createElement(r.a,{className:o()(i,e.className),onChange:d,checked:void 0!==e.checked?e.checked:e.value===n,name:t,value:e.value,disabled:e.disabled,outlined:l},e.label),e.description)))}},599:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return m})),a.d(t,"d",(function(){return E})),a.d(t,"c",(function(){return _}));var n=a(88),s=a(102),i=a.n(s),o=a(97),r=a(106),l=a(93),c=a(131);let d,m;Object(l.b)("Navigation"),Object(l.b)("Calls"),Object(l.b)("Composer"),Object(l.b)("Room List"),Object(l.b)("Autocomplete"),function(e){e.NAVIGATION="Navigation",e.CALLS="Calls",e.COMPOSER="Composer",e.ROOM_LIST="Room List",e.ROOM="Room",e.AUTOCOMPLETE="Autocomplete"}(d||(d={})),Object(l.b)("Alt"),Object(l.b)("Alt Gr"),Object(l.b)("Shift"),Object(l.b)("Super"),Object(l.b)("Ctrl"),function(e){e.ALT="Alt",e.ALT_GR="Alt Gr",e.SHIFT="Shift",e.SUPER="Super",e.COMMAND="Command",e.CONTROL="Ctrl"}(m||(m={}));const u=c.b?m.COMMAND:m.CONTROL,h={[d.COMPOSER]:[{keybinds:[{modifiers:[u],key:c.a.B}],description:Object(l.b)("Toggle Bold")},{keybinds:[{modifiers:[u],key:c.a.I}],description:Object(l.b)("Toggle Italics")},{keybinds:[{modifiers:[u],key:c.a.GREATER_THAN}],description:Object(l.b)("Toggle Quote")},{keybinds:[{modifiers:[m.SHIFT],key:c.a.ENTER}],description:Object(l.b)("New line")},{keybinds:[{key:c.a.ARROW_UP},{key:c.a.ARROW_DOWN}],description:Object(l.b)("Navigate recent messages to edit")},{keybinds:[{modifiers:[u],key:c.a.HOME},{modifiers:[u],key:c.a.END}],description:Object(l.b)("Jump to start/end of the composer")},{keybinds:[{modifiers:[m.CONTROL,m.ALT],key:c.a.ARROW_UP},{modifiers:[m.CONTROL,m.ALT],key:c.a.ARROW_DOWN}],description:Object(l.b)("Navigate composer history")},{keybinds:[{key:c.a.ESCAPE}],description:Object(l.b)("Cancel replying to a message")}],[d.CALLS]:[{keybinds:[{modifiers:[u],key:c.a.D}],description:Object(l.b)("Toggle microphone mute")},{keybinds:[{modifiers:[u],key:c.a.E}],description:Object(l.b)("Toggle video on/off")}],[d.ROOM]:[{keybinds:[{key:c.a.PAGE_UP},{key:c.a.PAGE_DOWN}],description:Object(l.b)("Scroll up/down in the timeline")},{keybinds:[{key:c.a.ESCAPE}],description:Object(l.b)("Dismiss read marker and jump to bottom")},{keybinds:[{modifiers:[m.SHIFT],key:c.a.PAGE_UP}],description:Object(l.b)("Jump to oldest unread message")},{keybinds:[{modifiers:[u,m.SHIFT],key:c.a.U}],description:Object(l.b)("Upload a file")},{keybinds:[{modifiers:[u],key:c.a.F}],description:Object(l.b)("Search (must be enabled)")}],[d.ROOM_LIST]:[{keybinds:[{modifiers:[u],key:c.a.K}],description:Object(l.b)("Jump to room search")},{keybinds:[{key:c.a.ARROW_UP},{key:c.a.ARROW_DOWN}],description:Object(l.b)("Navigate up/down in the room list")},{keybinds:[{key:c.a.ENTER}],description:Object(l.b)("Select room from the room list")},{keybinds:[{key:c.a.ARROW_LEFT}],description:Object(l.b)("Collapse room list section")},{keybinds:[{key:c.a.ARROW_RIGHT}],description:Object(l.b)("Expand room list section")},{keybinds:[{key:c.a.ESCAPE}],description:Object(l.b)("Clear room list filter field")}],[d.NAVIGATION]:[{keybinds:[{modifiers:[m.ALT,m.SHIFT],key:c.a.ARROW_UP},{modifiers:[m.ALT,m.SHIFT],key:c.a.ARROW_DOWN}],description:Object(l.b)("Previous/next unread room or DM")},{keybinds:[{modifiers:[m.ALT],key:c.a.ARROW_UP},{modifiers:[m.ALT],key:c.a.ARROW_DOWN}],description:Object(l.b)("Previous/next room or DM")},{keybinds:[{modifiers:[u],key:c.a.BACKTICK}],description:Object(l.b)("Toggle the top left menu")},{keybinds:[{key:c.a.ESCAPE}],description:Object(l.b)("Close dialog or context menu")},{keybinds:[{key:c.a.ENTER},{key:c.a.SPACE}],description:Object(l.b)("Activate selected button")},{keybinds:[{modifiers:[u],key:c.a.PERIOD}],description:Object(l.b)("Toggle right panel")},{keybinds:[{modifiers:[u],key:c.a.SLASH}],description:Object(l.b)("Toggle this dialog")},{keybinds:[{modifiers:[m.CONTROL,c.b?m.SHIFT:m.ALT],key:c.a.H}],description:Object(l.b)("Go to Home View")}],[d.AUTOCOMPLETE]:[{keybinds:[{key:c.a.ARROW_UP},{key:c.a.ARROW_DOWN}],description:Object(l.b)("Move autocomplete selection up/down")},{keybinds:[{key:c.a.ESCAPE}],description:Object(l.b)("Cancel autocomplete")}]},p=[d.COMPOSER,d.AUTOCOMPLETE,d.ROOM,d.ROOM_LIST,d.NAVIGATION,d.CALLS],g={[m.COMMAND]:"⌘"};c.b&&(g[m.ALT]="⌥");const f={[c.a.PAGE_UP]:Object(l.b)("Page Up"),[c.a.PAGE_DOWN]:Object(l.b)("Page Down"),[c.a.ESCAPE]:Object(l.b)("Esc"),[c.a.ENTER]:Object(l.b)("Enter"),[c.a.SPACE]:Object(l.b)("Space"),[c.a.HOME]:Object(l.b)("Home"),[c.a.END]:Object(l.b)("End")},v={[c.a.ARROW_UP]:"↑",[c.a.ARROW_DOWN]:"↓",[c.a.ARROW_LEFT]:"←",[c.a.ARROW_RIGHT]:"→"},b=e=>{let{shortcut:t}=e;const a=i()({mx_KeyboardShortcutsDialog_inline:t.keybinds.every(e=>!e.modifiers||0===e.modifiers.length)});return n.createElement("div",{className:a},n.createElement("h5",null,Object(l.a)(t.description)),t.keybinds.map(e=>{let t=e.key;return f[e.key]?t=Object(l.a)(f[e.key]):v[e.key]&&(t=v[e.key]),n.createElement("div",{key:e.key},e.modifiers&&e.modifiers.map(e=>n.createElement(n.Fragment,{key:e},n.createElement("kbd",null,g[e]||Object(l.a)(e)),"+")),n.createElement("kbd",null,t))}))};let y=null;const E=()=>{if(y)return y.close(),void(y=null);const e=p.map(e=>{const t=h[e];return n.createElement("div",{className:"mx_KeyboardShortcutsDialog_category",key:e},n.createElement("h3",null,Object(l.a)(e)),n.createElement("div",null,t.map(e=>n.createElement(b,{key:e.description,shortcut:e}))))}),t=o.getComponent("dialogs.InfoDialog");y=r.a.createTrackedDialog("Keyboard Shortcuts","",t,{className:"mx_KeyboardShortcutsDialog",title:Object(l.a)("Keyboard Shortcuts"),description:e,hasCloseButton:!0,onKeyDown:e=>{!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||e.key!==c.a.SLASH||(e.stopPropagation(),y.close())},onFinished:()=>{y=null}})},_=(e,t)=>{h[e].push(t)}},6:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return s}));const n="mx-voice-worklet";let s;!function(e){e.Timekeep="timekeep",e.AmplitudeMark="amplitude_mark"}(s||(s={}))},600:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return P})),a.d(t,"b",(function(){return N}));var n,s=a(19),i=a.n(s),o=a(88),r=a(1),l=a(102),c=a.n(l),d=a(194),m=a(93),u=a(108),h=a(845),p=a(127),g=a(174),f=a(324),v=a(161),b=a(100),y=a(269),E=a(135),_=a(131),S=a(370),C=a(849),w=a(184),O=a(637),x=a(153),R=a(166),k=a(202),I=a(220),T=a(94);const P=32;Object(C.a)();let N=Object(T.a)("views.rooms.RoomSublist")(n=class t extends o.Component{constructor(t){super(t),i()(this,"headerButton",Object(o.createRef)()),i()(this,"sublistRef",Object(o.createRef)()),i()(this,"tilesRef",Object(o.createRef)()),i()(this,"dispatcherRef",void 0),i()(this,"layout",void 0),i()(this,"heightAtStart",void 0),i()(this,"isBeingFiltered",void 0),i()(this,"notificationState",void 0),i()(this,"onListsUpdated",()=>{const e={};if(this.props.extraTiles){const t=g.b.instance.getFirstNameFilterCondition();t?e.filteredExtraTiles=this.props.extraTiles.filter(e=>t.matches(Object(r.q)(e.props.displayName||""))):this.state.filteredExtraTiles&&(e.filteredExtraTiles=null)}const t=this.state.rooms,a=Object(x.b)(g.b.instance.orderedLists[this.props.tagId]||[]);Object(x.e)(t,a)&&(e.rooms=a);const n=!!g.b.instance.getFirstNameFilterCondition();n!==this.isBeingFiltered&&(this.isBeingFiltered=n,e.isExpanded=!!n||!this.layout.isCollapsed),Object.keys(e).length>0&&this.setState(e)}),i()(this,"onAction",t=>{"view_room"===t.action&&t.show_room_tile&&this.state.rooms&&e(()=>{const e=this.state.rooms.findIndex(e=>e.roomId===t.room_id);!this.state.isExpanded&&e>-1&&this.toggleCollapsed(),e>=this.numVisibleTiles&&(this.layout.visibleTiles=this.layout.tilesWithPadding(e+1,32),this.forceUpdate())})}),i()(this,"onAddRoom",e=>{e.stopPropagation(),this.props.onAddRoom&&this.props.onAddRoom()}),i()(this,"onResize",(e,t,a,n)=>{const s=this.heightAtStart+n.height;this.applyHeightChange(s),this.setState({height:s})}),i()(this,"onResizeStart",()=>{this.heightAtStart=this.state.height,this.setState({isResizing:!0})}),i()(this,"onResizeStop",(e,t,a,n)=>{const s=this.heightAtStart+n.height;this.applyHeightChange(s),this.setState({isResizing:!1,height:s})}),i()(this,"onShowAllClick",()=>{const e=this.numVisibleTiles,t=this.layout.tilesToPixelsWithPadding(this.numTiles,this.padding);this.applyHeightChange(t),this.setState({height:t},()=>{this.focusRoomTile(e)})}),i()(this,"onShowLessClick",()=>{const e=this.layout.tilesToPixelsWithPadding(this.layout.defaultVisibleTiles,this.padding);this.applyHeightChange(e),this.setState({height:e})}),i()(this,"focusRoomTile",e=>{if(!this.sublistRef.current)return;const t=this.sublistRef.current.querySelectorAll(".mx_RoomTile"),a=t&&t[e];a&&a.focus()}),i()(this,"onOpenMenuClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})}),i()(this,"onContextMenu",e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{left:e.clientX,top:e.clientY,height:0}})}),i()(this,"onAddRoomContextMenu",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({addRoomContextMenuPosition:t.getBoundingClientRect()})}),i()(this,"onCloseMenu",()=>{this.setState({contextMenuPosition:null})}),i()(this,"onCloseAddRoomMenu",()=>{this.setState({addRoomContextMenuPosition:null})}),i()(this,"onUnreadFirstChanged",async()=>{const e=g.b.instance.getListOrder(this.props.tagId)===f.a.Importance?f.a.Natural:f.a.Importance;await g.b.instance.setListOrder(this.props.tagId,e),this.forceUpdate()}),i()(this,"onTagSortChanged",async e=>{await g.b.instance.setTagSorting(this.props.tagId,e)}),i()(this,"onMessagePreviewChanged",()=>{this.layout.showPreviews=!this.layout.showPreviews,this.forceUpdate()}),i()(this,"onBadgeClick",e=>{let t;e.preventDefault(),e.stopPropagation(),t=this.props.tagId===v.a.Invite?this.state.rooms&&this.state.rooms[0]:g.b.instance.unfilteredLists[this.props.tagId].find(e=>{const t=this.notificationState.getForRoom(e);return t.count>0&&t.color===this.notificationState.color}),t&&b.a.dispatch({action:"view_room",room_id:t.roomId,show_room_tile:!0})}),i()(this,"onHeaderClick",()=>{const t=this.headerButton.current.parentElement,a=t.parentElement.parentElement,n=a.parentElement.parentElement,s=n.scrollTop<=P,i=n.scrollTop>=n.scrollHeight-n.offsetHeight,o=t.classList.contains("mx_RoomSublist_headerContainer_stickyTop"),r=t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom");if(r&&!i||o&&!s)a.scrollIntoView({behavior:"smooth"});else{const t=this.state.isExpanded;this.toggleCollapsed(),!t&&r&&e(()=>{a.scrollIntoView({behavior:"smooth"})})}}),i()(this,"toggleCollapsed",()=>{this.layout.isCollapsed=this.state.isExpanded,this.setState({isExpanded:!this.layout.isCollapsed}),this.props.onListCollapse&&this.props.onListCollapse(!this.layout.isCollapsed)}),i()(this,"onHeaderKeyDown",e=>{switch(Object(I.f)().getRoomListAction(e)){case I.e.CollapseSection:e.stopPropagation(),this.state.isExpanded&&this.toggleCollapsed();break;case I.e.ExpandSection:if(e.stopPropagation(),this.state.isExpanded){if(this.sublistRef.current){const e=this.sublistRef.current.querySelector(".mx_RoomTile");e&&e.focus()}}else this.toggleCollapsed()}}),i()(this,"onKeyDown",e=>{switch(e.key){case _.a.ARROW_LEFT:e.stopPropagation(),this.headerButton.current.focus();break;case _.a.ARROW_RIGHT:e.stopPropagation()}}),this.layout=O.a.instance.getLayoutFor(this.props.tagId),this.heightAtStart=0,this.isBeingFiltered=!!g.b.instance.getFirstNameFilterCondition(),this.notificationState=w.a.instance.getListState(this.props.tagId),this.state={contextMenuPosition:null,addRoomContextMenuPosition:null,isResizing:!1,isExpanded:this.isBeingFiltered?this.isBeingFiltered:!this.layout.isCollapsed,height:0,rooms:Object(x.b)(g.b.instance.orderedLists[this.props.tagId]||[])},this.state=Object.assign(this.state,{height:this.calculateInitialHeight()})}calculateInitialHeight(){const e=Math.max(Math.floor(this.layout.visibleTiles),this.layout.minVisibleTiles),t=Math.min(this.numTiles,e);return this.layout.tilesToPixelsWithPadding(t,this.padding)}get padding(){let e=4;const t=this.numTiles>this.numVisibleTiles,a=this.numTiles>this.layout.defaultVisibleTiles;return(t||a)&&(e+=28),e}get extraTiles(){return this.state.filteredExtraTiles?this.state.filteredExtraTiles:this.props.extraTiles?this.props.extraTiles:null}get numTiles(){return t.calcNumTiles(this.state.rooms,this.extraTiles)}static calcNumTiles(e,t){return(e||[]).length+(t||[]).length}get numVisibleTiles(){const e=Math.ceil(this.layout.visibleTiles);return Math.min(e,this.numTiles)}componentDidUpdate(e,a){const n=a.filteredExtraTiles||e.extraTiles;t.calcNumTiles(a.rooms,n)!==this.numTiles&&this.setState({height:this.calculateInitialHeight()})}shouldComponentUpdate(e,a){if(Object(R.c)(this.props,e))return!0;const n=Object(R.b)(this.state,["rooms"]),s=Object(R.b)(a,["rooms"]);if(Object(R.c)(n,s))return!0;const i=this.props.extraTiles||[],o=a.filteredExtraTiles||e.extraTiles||[];if(i.length>0||o.length>0)return!0;if(t.calcNumTiles(a.rooms,o)!==this.numTiles)return!0;if(!a.isExpanded)return!1;if(this.state.rooms.length!==a.rooms.length)return!0;const r=this.state.rooms.slice(0,this.numVisibleTiles),l=a.rooms.slice(0,this.numVisibleTiles);return!!Object(x.e)(r,l)}componentDidMount(){var e;this.dispatcherRef=b.a.register(this.onAction),g.b.instance.on(g.a,this.onListsUpdated),null===(e=this.tilesRef.current)||void 0===e||e.addEventListener("scroll",this.onScrollPrevent,{passive:!0})}componentWillUnmount(){var e;b.a.unregister(this.dispatcherRef),g.b.instance.off(g.a,this.onListsUpdated),null===(e=this.tilesRef.current)||void 0===e||e.removeEventListener("scroll",this.onScrollPrevent)}applyHeightChange(e){const t=Math.ceil(this.layout.pixelsToTiles(e-this.padding));this.layout.visibleTiles=Math.min(this.numTiles,t)}renderVisibleTiles(){if(!this.state.isExpanded)return[];const e=[];if(this.state.rooms){const t=this.state.rooms.slice(0,this.numVisibleTiles);for(const a of t)e.push(o.createElement(h.a,{room:a,key:"room-"+a.roomId,showMessagePreview:this.layout.showPreviews,isMinimized:this.props.isMinimized,tag:this.props.tagId}))}return this.extraTiles&&e.push(...this.extraTiles),e.length>this.numVisibleTiles?e.slice(0,this.numVisibleTiles):e}renderMenu(){let e=null;if(this.state.contextMenuPosition){const t=g.b.instance.getTagSorting(this.props.tagId)===f.b.Alphabetic,a=g.b.instance.getListOrder(this.props.tagId)===f.a.Importance;let n=null;this.props.tagId!==v.a.Invite&&(n=o.createElement(o.Fragment,null,o.createElement("hr",null),o.createElement("div",null,o.createElement("div",{className:"mx_RoomSublist_contextMenu_title"},Object(m.a)("Appearance")),o.createElement(p.i,{onClose:this.onCloseMenu,onChange:this.onUnreadFirstChanged,checked:a},Object(m.a)("Show rooms with unread messages first")),o.createElement(p.i,{onClose:this.onCloseMenu,onChange:this.onMessagePreviewChanged,checked:this.layout.showPreviews},Object(m.a)("Show previews of messages"))))),e=o.createElement(p.b,{chevronFace:p.a.None,left:this.state.contextMenuPosition.left,top:this.state.contextMenuPosition.top+this.state.contextMenuPosition.height,onFinished:this.onCloseMenu},o.createElement("div",{className:"mx_RoomSublist_contextMenu"},o.createElement("div",null,o.createElement("div",{className:"mx_RoomSublist_contextMenu_title"},Object(m.a)("Sort by")),o.createElement(p.j,{onClose:this.onCloseMenu,onChange:()=>this.onTagSortChanged(f.b.Recent),checked:!t,name:`mx_${this.props.tagId}_sortBy`},Object(m.a)("Activity")),o.createElement(p.j,{onClose:this.onCloseMenu,onChange:()=>this.onTagSortChanged(f.b.Alphabetic),checked:t,name:`mx_${this.props.tagId}_sortBy`},Object(m.a)("A-Z"))),n))}else this.state.addRoomContextMenuPosition&&(e=o.createElement(k.e,{chevronFace:p.a.None,left:this.state.addRoomContextMenuPosition.left-7,top:this.state.addRoomContextMenuPosition.top+this.state.addRoomContextMenuPosition.height,onFinished:this.onCloseAddRoomMenu,compact:!0},this.props.addRoomContextMenu(this.onCloseAddRoomMenu)));return o.createElement(o.Fragment,null,o.createElement(p.d,{className:"mx_RoomSublist_menuButton",onClick:this.onOpenMenuClick,title:Object(m.a)("List options"),isExpanded:!!this.state.contextMenuPosition}),e)}renderHeader(){return o.createElement(d.d,{inputRef:this.headerButton},e=>{let{onFocus:t,isActive:a,ref:n}=e;const s=a?0:-1;let i=Object(m.a)("Jump to first unread room.");this.props.tagId===v.a.Invite&&(i=Object(m.a)("Jump to first invite."));const r=o.createElement(y.a,{forceCount:!0,notification:this.notificationState,onClick:this.onBadgeClick,tabIndex:s,"aria-label":i});let l=null;this.props.onAddRoom?l=o.createElement(E.a,{tabIndex:s,onClick:this.onAddRoom,className:"mx_RoomSublist_auxButton",tooltipClassName:"mx_RoomSublist_addRoomTooltip","aria-label":this.props.addRoomLabel||Object(m.a)("Add room"),title:this.props.addRoomLabel}):this.props.addRoomContextMenu&&(l=o.createElement(p.d,{tabIndex:s,onClick:this.onAddRoomContextMenu,className:"mx_RoomSublist_auxButton",tooltipClassName:"mx_RoomSublist_addRoomTooltip","aria-label":this.props.addRoomLabel||Object(m.a)("Add room"),title:this.props.addRoomLabel,isExpanded:!!this.state.addRoomContextMenuPosition}));const d=c()({mx_RoomSublist_collapseBtn:!0,mx_RoomSublist_collapseBtn_collapsed:!this.state.isExpanded}),h=c()({mx_RoomSublist_headerContainer:!0,mx_RoomSublist_headerContainer_withAux:!!l}),g=o.createElement("div",{className:"mx_RoomSublist_badgeContainer"},r);let f=u.a;return this.props.isMinimized&&(f=E.a),o.createElement("div",{className:h,onKeyDown:this.onHeaderKeyDown,onFocus:t,"aria-label":this.props.label},o.createElement("div",{className:"mx_RoomSublist_stickable"},o.createElement(f,{onFocus:t,inputRef:n,tabIndex:s,className:"mx_RoomSublist_headerText",role:"treeitem","aria-expanded":this.state.isExpanded,"aria-level":1,onClick:this.onHeaderClick,onContextMenu:this.onContextMenu,title:this.props.isMinimized?this.props.label:void 0},o.createElement("span",{className:d}),o.createElement("span",null,this.props.label)),this.renderMenu(),this.props.isMinimized?null:g,this.props.isMinimized?null:l),this.props.isMinimized?g:null,this.props.isMinimized?l:null)})}onScrollPrevent(e){e.target.scrollTop=0}render(){var e;const t=this.renderVisibleTiles(),a=c()({mx_RoomSublist:!0,mx_RoomSublist_hasMenuOpen:!!this.state.contextMenuPosition,mx_RoomSublist_minimized:this.props.isMinimized,mx_RoomSublist_hidden:!(this.state.rooms.length||null!==(e=this.props.extraTiles)&&void 0!==e&&e.length||!0===this.props.alwaysVisible)});let n=null;if(t.length>0){const e=this.layout,a=Math.min(e.minVisibleTiles,this.numTiles),s=4+(a<this.numTiles?28:0),i=e.tilesToPixelsWithPadding(a,s),r=e.tilesToPixelsWithPadding(this.numTiles,this.padding),l=c()({mx_RoomSublist_showNButton:!0});let u=null;if(r>this.state.height){const e=this.state.height-4-28,t=Math.floor(e/this.layout.tileHeight),a=this.numTiles-t,n=Object(m.a)("Show %(count)s more",{count:a});let s=o.createElement("span",{className:"mx_RoomSublist_showNButtonText"},n);this.props.isMinimized&&(s=null),u=o.createElement(d.a,{role:"treeitem",onClick:this.onShowAllClick,className:l,"aria-label":n},o.createElement("span",{className:"mx_RoomSublist_showMoreButtonChevron mx_RoomSublist_showNButtonChevron"}),s)}else if(this.numTiles>this.layout.defaultVisibleTiles){const e=Object(m.a)("Show less");let t=o.createElement("span",{className:"mx_RoomSublist_showNButtonText"},e);this.props.isMinimized&&(t=null),u=o.createElement(d.a,{role:"treeitem",onClick:this.onShowLessClick,className:l,"aria-label":e},o.createElement("span",{className:"mx_RoomSublist_showLessButtonChevron mx_RoomSublist_showNButtonChevron"}),t)}const h={bottom:!0,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1};e.visibleTiles>=this.numTiles&&this.numTiles<=e.minVisibleTiles&&(h.bottom=!1);const p=c()({mx_RoomSublist_resizerHandles:!0,mx_RoomSublist_resizerHandles_showNButton:!!u});n=o.createElement(o.Fragment,null,o.createElement(S.Resizable,{size:{height:this.state.height},minHeight:i,maxHeight:r,onResizeStart:this.onResizeStart,onResizeStop:this.onResizeStop,onResize:this.onResize,handleWrapperClass:p,handleClasses:{bottom:"mx_RoomSublist_resizerHandle"},className:"mx_RoomSublist_resizeBox",enable:h},o.createElement("div",{className:"mx_RoomSublist_tiles",ref:this.tilesRef},t),u))}else this.props.showSkeleton&&this.state.isExpanded&&(n=o.createElement("div",{className:"mx_RoomSublist_skeletonUI"}));return o.createElement("div",{ref:this.sublistRef,className:a,role:"group","aria-label":this.props.label,onKeyDown:this.onKeyDown},this.renderHeader(),n)}})||n}).call(this,a(212).setImmediate)},601:function(e,t,a){"use strict";a.d(t,"a",(function(){return w}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(97),u=a(99),h=a(100),p=a(102),g=a.n(p),f=a(93),v=a(110),b=a(330),y=a(203),E=a(142),_=a(94),S=a(1447);const C=Object.freeze({NotLoggedIn:"NotLoggedIn",Joining:"Joining",Loading:"Loading",Rejecting:"Rejecting",Kicked:"Kicked",Banned:"Banned",OtherThreePIDError:"OtherThreePIDError",InvitedEmailNotFoundInAccount:"InvitedEmailNotFoundInAccount",InvitedEmailNoIdentityServer:"InvitedEmailNoIdentityServer",InvitedEmailMismatch:"InvitedEmailMismatch",Invite:"Invite",ViewingRoom:"ViewingRoom",RoomNotFound:"RoomNotFound",OtherError:"OtherError"});let w=Object(_.a)("views.rooms.RoomPreviewBar")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"state",{busy:!1}),o()(this,"_onCommunityUpdate",e=>{this.props.room&&this.props.room.roomId!==e||this.forceUpdate()}),o()(this,"onLoginClick",()=>{h.a.dispatch({action:"start_login",screenAfterLogin:this._makeScreenAfterLogin()})}),o()(this,"onRegisterClick",()=>{h.a.dispatch({action:"start_registration",screenAfterLogin:this._makeScreenAfterLogin()})})}componentDidMount(){this._checkInvitedEmail(),y.a.instance.on(E.b,this._onCommunityUpdate)}componentDidUpdate(e,t){this.props.invitedEmail===e.invitedEmail&&this.props.inviterName===e.inviterName||this._checkInvitedEmail()}componentWillUnmount(){y.a.instance.off(E.b,this._onCommunityUpdate)}async _checkInvitedEmail(){if(this.props.inviterName&&this.props.invitedEmail){this.setState({busy:!0});try{const e=await u.a.get().getThreePids();if(this.setState({accountEmails:e.threepids.filter(e=>"email"===e.medium).map(e=>e.address)}),!u.a.get().getIdentityServerUrl())return void this.setState({busy:!1});const t=new b.a,a=await t.getAccessToken(),n=await u.a.get().lookupThreePid("email",this.props.invitedEmail,void 0,a);this.setState({invitedEmailMxid:n.mxid})}catch(e){this.setState({threePidFetchError:e})}this.setState({busy:!1})}}_getMessageCase(){if(u.a.get().isGuest())return C.NotLoggedIn;const e=this._getMyMember();if(e){if(e.isKicked())return C.Kicked;if("ban"===e.membership)return C.Banned}if(this.props.joining)return C.Joining;if(this.props.rejecting)return C.Rejecting;if(this.props.loading||this.state.busy)return C.Loading;if(this.props.inviterName){if(this.props.invitedEmail){if(this.state.threePidFetchError)return C.OtherThreePIDError;if(this.state.accountEmails&&!this.state.accountEmails.includes(this.props.invitedEmail))return C.InvitedEmailNotFoundInAccount;if(!u.a.get().getIdentityServerUrl())return C.InvitedEmailNoIdentityServer;if(this.state.invitedEmailMxid!=u.a.get().getUserId())return C.InvitedEmailMismatch}return C.Invite}return this.props.error?"M_NOT_FOUND"==this.props.error.errcode?C.RoomNotFound:C.OtherError:C.ViewingRoom}_getKickOrBanInfo(){const e=this._getMyMember();if(!e)return{};const t=this.props.room.currentState.getMember(e.events.member.getSender());return{memberName:t?t.name:e.events.member.getSender(),reason:e.events.member.getContent().reason}}_joinRule(){const e=this.props.room;if(e){const t=e.currentState.getStateEvents("m.room.join_rules","");if(t)return t.getContent().join_rule}}_communityProfile(){return this.props.room?y.a.instance.getInviteProfile(this.props.room.roomId):{displayName:null,avatarMxc:null}}_roomName(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.props.room?this.props.room.name:this.props.roomAlias;const a=this._communityProfile();return a.displayName&&(t=a.displayName),t||(e?Object(f.a)("This room"):Object(f.a)("this room"))}_getMyMember(){return this.props.room&&this.props.room.getMember(u.a.get().getUserId())}_getInviteMember(){const{room:e}=this.props;if(!e)return;const t=u.a.get().getUserId(),a=e.currentState.getMember(t);if(!a)return;const n=a.events.member.getSender();return e.currentState.getMember(n)}_isDMInvite(){const e=this._getMyMember();if(!e)return!1;const t=e.events.member.getContent();return"invite"===t.membership&&t.is_direct}_makeScreenAfterLogin(){return{screen:"room",params:{email:this.props.invitedEmail,signurl:this.props.signUrl,room_name:this.props.oobData?this.props.oobData.room_name:null,room_avatar_url:this.props.oobData?this.props.oobData.avatarUrl:null,inviter_name:this.props.oobData?this.props.oobData.inviterName:null}}}render(){const e=v.a.get().brand,t=m.getComponent("elements.Spinner"),a=m.getComponent("elements.AccessibleButton");let n,s,i,o,r,c,d,h,p=!1;const b=[],y=this._getMessageCase();switch(y){case C.Joining:n=Object(f.a)("Joining room …"),p=!0;break;case C.Loading:n=Object(f.a)("Loading …"),p=!0;break;case C.Rejecting:n=Object(f.a)("Rejecting invite …"),p=!0;break;case C.NotLoggedIn:n=Object(f.a)("Join the conversation with an account"),r=Object(f.a)("Sign Up"),o=this.onRegisterClick,d=Object(f.a)("Sign In"),c=this.onLoginClick,this.props.previewLoading&&(h=l.a.createElement("div",null,l.a.createElement(t,{w:20,h:20}),Object(f.a)("Loading room preview")));break;case C.Kicked:{const{memberName:e,reason:t}=this._getKickOrBanInfo();n=Object(f.a)("You were kicked from %(roomName)s by %(memberName)s",{memberName:e,roomName:this._roomName()}),s=t?Object(f.a)("Reason: %(reason)s",{reason:t}):null,"invite"===this._joinRule()?(r=Object(f.a)("Forget this room"),o=this.props.onForgetClick):(r=Object(f.a)("Re-join"),o=this.props.onJoinClick,d=Object(f.a)("Forget this room"),c=this.props.onForgetClick);break}case C.Banned:{const{memberName:e,reason:t}=this._getKickOrBanInfo();n=Object(f.a)("You were banned from %(roomName)s by %(memberName)s",{memberName:e,roomName:this._roomName()}),s=t?Object(f.a)("Reason: %(reason)s",{reason:t}):null,r=Object(f.a)("Forget this room"),o=this.props.onForgetClick;break}case C.OtherThreePIDError:{n=Object(f.a)("Something went wrong with your invite to %(roomName)s",{roomName:this._roomName()});const e=this._joinRule(),t=Object(f.a)("An error (%(errcode)s) was returned while trying to validate your invite. You could try to pass this information on to a room admin.",{errcode:this.state.threePidFetchError.errcode||Object(f.a)("unknown error code")});switch(e){case"invite":s=[Object(f.a)("You can only join it with a working invite."),t],r=Object(f.a)("Try to join anyway"),o=this.props.onJoinClick;break;case"public":s=Object(f.a)("You can still join it because this is a public room."),r=Object(f.a)("Join the discussion"),o=this.props.onJoinClick;break;default:s=t,r=Object(f.a)("Try to join anyway"),o=this.props.onJoinClick}break}case C.InvitedEmailNotFoundInAccount:n=Object(f.a)("This invite to %(roomName)s was sent to %(email)s which is not associated with your account",{roomName:this._roomName(),email:this.props.invitedEmail}),s=Object(f.a)("Link this email with your account in Settings to receive invites directly in %(brand)s.",{brand:e}),r=Object(f.a)("Join the discussion"),o=this.props.onJoinClick;break;case C.InvitedEmailNoIdentityServer:n=Object(f.a)("This invite to %(roomName)s was sent to %(email)s",{roomName:this._roomName(),email:this.props.invitedEmail}),s=Object(f.a)("Use an identity server in Settings to receive invites directly in %(brand)s.",{brand:e}),r=Object(f.a)("Join the discussion"),o=this.props.onJoinClick;break;case C.InvitedEmailMismatch:n=Object(f.a)("This invite to %(roomName)s was sent to %(email)s",{roomName:this._roomName(),email:this.props.invitedEmail}),s=Object(f.a)("Share this email in Settings to receive invites directly in %(brand)s.",{brand:e}),r=Object(f.a)("Join the discussion"),o=this.props.onJoinClick;break;case C.Invite:{const e=m.getComponent("views.avatars.RoomAvatar"),t=Object.assign({},this.props.oobData,{avatarUrl:this._communityProfile().avatarMxc}),h=l.a.createElement(e,{room:this.props.room,oobData:t}),p=this._getInviteMember();let g;g=p?l.a.createElement("span",null,l.a.createElement("span",{className:"mx_RoomPreviewBar_inviter"},p.rawDisplayName)," (",p.userId,")"):l.a.createElement("span",{className:"mx_RoomPreviewBar_inviter"},this.props.inviterName);this._isDMInvite()?(n=Object(f.a)("Do you want to chat with %(user)s?",{user:p.name}),s=[h,Object(f.a)("<userName/> wants to chat",{},{userName:()=>g})],r=Object(f.a)("Start chatting")):(n=Object(f.a)("Do you want to join %(roomName)s?",{roomName:this._roomName()}),s=[h,Object(f.a)("<userName/> invited you",{},{userName:()=>g})],r=Object(f.a)("Accept"));const v=u.a.get().getUserId(),y=this.props.room.currentState.getMember(v).events.member.event.content.reason;y&&(i=l.a.createElement(S.a,{reason:y})),o=this.props.onJoinClick,d=Object(f.a)("Reject"),c=this.props.onRejectClick,this.props.onRejectAndIgnoreClick&&b.push(l.a.createElement(a,{kind:"secondary",onClick:this.props.onRejectAndIgnoreClick,key:"ignore"},Object(f.a)("Reject & Ignore user")));break}case C.ViewingRoom:n=this.props.canPreview?Object(f.a)("You're previewing %(roomName)s. Want to join it?",{roomName:this._roomName()}):Object(f.a)("%(roomName)s can't be previewed. Do you want to join it?",{roomName:this._roomName(!0)}),r=Object(f.a)("Join the discussion"),o=this.props.onJoinClick;break;case C.RoomNotFound:n=Object(f.a)("%(roomName)s does not exist.",{roomName:this._roomName(!0)}),s=Object(f.a)("This room doesn't exist. Are you sure you're at the right place?");break;case C.OtherError:n=Object(f.a)("%(roomName)s is not accessible at this time.",{roomName:this._roomName(!0)}),s=[Object(f.a)("Try again later, or ask a room admin to check if you have access."),Object(f.a)("%(errcode)s was returned while trying to access the room. If you think you're seeing this message in error, please <issueLink>submit a bug report</issueLink>.",{errcode:this.props.error.errcode},{issueLink:e=>l.a.createElement("a",{href:"https://github.com/vector-im/element-web/issues/new/choose",target:"_blank",rel:"noreferrer noopener"},e)})]}let E,_,w,O;s&&(Array.isArray(s)||(s=[s]),E=s.map((e,t)=>l.a.createElement("p",{key:"subTitle"+t},e))),_=p?l.a.createElement("h3",{className:"mx_RoomPreviewBar_spinnerTitle"},l.a.createElement(t,null),n):l.a.createElement("h3",null,n),o&&(w=l.a.createElement(a,{kind:"primary",onClick:o},r)),c&&(O=l.a.createElement(a,{kind:"secondary",onClick:c},d));const x=g()("mx_RoomPreviewBar","dark-panel","mx_RoomPreviewBar_"+y,{mx_RoomPreviewBar_panel:this.props.canPreview,mx_RoomPreviewBar_dialog:!this.props.canPreview});return l.a.createElement("div",{className:x},l.a.createElement("div",{className:"mx_RoomPreviewBar_message"},_,E),i,l.a.createElement("div",{className:"mx_RoomPreviewBar_actions"},O,b,w),l.a.createElement("div",{className:"mx_RoomPreviewBar_footer"},h))}},o()(s,"propTypes",{onJoinClick:d.a.func,onRejectClick:d.a.func,onRejectAndIgnoreClick:d.a.func,onForgetClick:d.a.func,inviterName:d.a.string,invitedEmail:d.a.string,oobData:d.a.object,signUrl:d.a.string,error:d.a.object,canPreview:d.a.bool,previewLoading:d.a.bool,room:d.a.object,spinner:d.a.bool,spinnerState:d.a.oneOf(["joining"]),loading:d.a.bool,joining:d.a.bool,rejecting:d.a.bool,roomAlias:d.a.string}),o()(s,"defaultProps",{onJoinClick(){}}),n=s))||n},602:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(131),h=a(94);let p=Object(h.a)("views.rooms.ForwardMessage")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"_onKeyDown",e=>{switch(e.key){case u.a.ESCAPE:this.props.onCancelClick()}})}componentDidMount(){document.addEventListener("keydown",this._onKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this._onKeyDown)}render(){return l.a.createElement("div",{className:"mx_ForwardMessage"},l.a.createElement("h1",null,Object(m.a)("Please select the destination room for this message")))}},o()(s,"propTypes",{onCancelClick:d.a.func.isRequired}),n=s))||n},603:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(108),c=a(102),d=a.n(c),m=a(93),u=a(131),h=a(836),p=a(94);let g=Object(p.a)("views.rooms.SearchBar")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"onThisRoomClick",()=>{this.setState({scope:"Room"},()=>this._searchIfQuery())}),i()(this,"onAllRoomsClick",()=>{this.setState({scope:"All"},()=>this._searchIfQuery())}),i()(this,"onSearchChange",e=>{switch(e.key){case u.a.ENTER:this.onSearch();break;case u.a.ESCAPE:this.props.onCancelClick()}}),i()(this,"onSearch",()=>{this.props.onSearch(this._search_term.current.value,this.state.scope)}),this._search_term=Object(o.createRef)(),this.state={scope:"Room"}}_searchIfQuery(){this._search_term.current.value&&this.onSearch()}render(){const e=d()("mx_SearchBar_searchButton",{mx_SearchBar_searching:this.props.searchInProgress}),t=d()("mx_SearchBar_button",{mx_SearchBar_unselected:"Room"!==this.state.scope}),a=d()("mx_SearchBar_button",{mx_SearchBar_unselected:"All"!==this.state.scope});return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mx_SearchBar"},r.a.createElement("div",{className:"mx_SearchBar_buttons",role:"radiogroup"},r.a.createElement(l.a,{className:t,onClick:this.onThisRoomClick,"aria-checked":"Room"===this.state.scope,role:"radio"},Object(m.a)("This Room")),r.a.createElement(l.a,{className:a,onClick:this.onAllRoomsClick,"aria-checked":"All"===this.state.scope,role:"radio"},Object(m.a)("All Rooms"))),r.a.createElement("div",{className:"mx_SearchBar_input mx_textinput"},r.a.createElement("input",{ref:this._search_term,type:"text",autoFocus:!0,placeholder:Object(m.a)("Search…"),onKeyDown:this.onSearchChange}),r.a.createElement(l.a,{className:e,onClick:this.onSearch})),r.a.createElement(l.a,{className:"mx_SearchBar_cancel",onClick:this.props.onCancelClick})),r.a.createElement(h.b,{isRoomEncrypted:this.props.isRoomEncrypted,kind:h.a.Search}))}})||n},604:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(97),u=a(106),h=a(93),p=a(99),g=a(94);let f=Object(g.a)("views.rooms.RoomUpgradeWarningBar")((s=class extends l.a.Component{constructor(e){super(e),o()(this,"_onStateEvents",(e,t)=>{if(!this.props.room||e.getRoomId()!==this.props.room.roomId)return;if("m.room.tombstone"!==e.getType())return;const a=this.props.room.currentState.getStateEvents("m.room.tombstone","");this.setState({upgraded:a&&a.getContent().replacement_room})}),o()(this,"onUpgradeClick",()=>{const e=m.getComponent("dialogs.RoomUpgradeDialog");u.a.createTrackedDialog("Upgrade Room Version","",e,{room:this.props.room})}),this.state={}}componentDidMount(){const e=this.props.room.currentState.getStateEvents("m.room.tombstone","");this.setState({upgraded:e&&e.getContent().replacement_room}),p.a.get().on("RoomState.events",this._onStateEvents)}componentWillUnmount(){const e=p.a.get();e&&e.removeListener("RoomState.events",this._onStateEvents)}render(){const e=m.getComponent("elements.AccessibleButton");let t=l.a.createElement("div",null,l.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_body"},l.a.createElement("p",null,Object(h.a)("Upgrading this room will shut down the current instance of the room and create an upgraded room with the same name.")),l.a.createElement("p",null,Object(h.a)("<b>Warning</b>: Upgrading a room will <i>not automatically migrate room members to the new version of the room.</i> We'll post a link to the new room in the old version of the room - room members will have to click this link to join the new room.",{},{b:e=>l.a.createElement("b",null,e),i:e=>l.a.createElement("i",null,e)}))),l.a.createElement("p",{className:"mx_RoomUpgradeWarningBar_upgradelink"},l.a.createElement(e,{onClick:this.onUpgradeClick},Object(h.a)("Upgrade this room to the recommended room version"))));return this.state.upgraded&&(t=l.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_body"},l.a.createElement("p",null,Object(h.a)("This room has already been upgraded.")))),l.a.createElement("div",{className:"mx_RoomUpgradeWarningBar"},l.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_wrapped"},l.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_header"},Object(h.a)("This room is running room version <roomVersion />, which this homeserver has marked as <i>unstable</i>.",{},{roomVersion:()=>l.a.createElement("code",null,this.props.room.getVersion()),i:e=>l.a.createElement("i",null,e)})),t,l.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_small"},Object(h.a)("Only room administrators will see this warning"))))}},o()(s,"propTypes",{room:d.a.object.isRequired,recommendation:d.a.object.isRequired}),n=s))||n},605:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(99),d=a(100),m=a(1544),u=a(102),h=a.n(u),p=a(302),g=a(103),f=a(138),v=a(147),b=a(1450),y=a(166),E=a(94);let _=Object(E.a)("views.rooms.AuxPanel")((s=class extends l.a.Component{constructor(e){super(e),o()(this,"onConferenceNotificationClick",(e,t)=>{d.a.dispatch({action:"place_call",type:t,room_id:this.props.room.roomId}),e.stopPropagation(),e.preventDefault()}),o()(this,"_rateLimitedUpdate",new p.a(()=>{g.b.getValue("feature_state_counters")&&this.setState({counters:this._computeCounters()})},500)),this.state={counters:this._computeCounters()}}componentDidMount(){c.a.get().on("RoomState.events",this._rateLimitedUpdate)}componentWillUnmount(){const e=c.a.get();e&&e.removeListener("RoomState.events",this._rateLimitedUpdate)}shouldComponentUpdate(e,t){return Object(y.c)(this.props,e)||Object(y.c)(this.state,t)}componentDidUpdate(e,t){this.props.onResize&&this.props.onResize()}_computeCounters(){const e=[];if(this.props.room&&g.b.getValue("feature_state_counters")){const t=this.props.room.currentState.getStateEvents("re.jki.counter");t.sort((e,t)=>e.getStateKey()<t.getStateKey());for(const a of t){const t=a.getContent().title,n=a.getContent().value,s=a.getContent().link,i=a.getContent().severity||"normal",o=a.getStateKey();t&&void 0!==n&&e.push({title:t,value:n,link:s,severity:i,stateKey:o})}}return e}render(){const e=l.a.createElement(b.a,{roomId:this.props.room.roomId,maxVideoHeight:this.props.maxHeight,resizeNotifier:this.props.resizeNotifier});let t;g.b.getValue(v.a.Widgets)&&(t=l.a.createElement(m.a,{room:this.props.room,userId:this.props.userId,maxHeight:this.props.maxHeight,showApps:this.props.showApps,resizeNotifier:this.props.resizeNotifier}));let a=null;if(this.state.counters&&g.b.getValue("feature_state_counters")){const e=[];this.state.counters.forEach((t,a)=>{const n=t.title,s=t.value,i=t.link,o=t.severity,r=t.stateKey;let c=l.a.createElement("span",null,n,": ",s);i&&(c=l.a.createElement("a",{href:i,target:"_blank",rel:"noreferrer noopener"},c)),c=l.a.createElement("span",{className:"m_RoomView_auxPanel_stateViews_span","data-severity":o,key:"x-"+r},c),e.push(c),e.push(l.a.createElement("span",{className:"m_RoomView_auxPanel_stateViews_delim",key:"delim"+a}," ─ "))}),e.length>0&&(e.pop(),a=l.a.createElement("div",{className:"m_RoomView_auxPanel_stateViews"},e))}const n=h()({mx_RoomView_auxPanel:!0,mx_RoomView_auxPanel_fullHeight:this.props.fullHeight}),s={};return this.props.fullHeight||(s.maxHeight=this.props.maxHeight),l.a.createElement(f.a,{className:n,style:s},a,t,e,this.props.children)}},o()(s,"defaultProps",{showApps:!0}),n=s))||n},606:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(1449),o=a(1448);class r{static createItem(e,t,a){return new i.a(e,t,a)}static createSizer(e,t,a){return new o.a(e,t,a)}constructor(e){this.item=e,s()(this,"beforeOffset",void 0),this.beforeOffset=e.offset()}get size(){return this.item.getSize()}set size(e){this.item.setRawSize(e)}resize(e){this.item.setSize(e)}resizeFromContainerOffset(e){this.resize(e-this.beforeOffset)}start(){this.item.start()}finish(){this.item.finish()}}},607:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(100),o=a(282),r=a(200);t.a=e=>{let{roomWidth:t}=e;const l=Object(n.useRef)(null),c=Object(n.useRef)(new Map);return Object(n.useEffect)(()=>{const e=()=>{var e;l.current&&(null===(e=l.current)||void 0===e?void 0:e.height)!==r.b.instance.windowHeight&&(l.current.height=r.b.instance.windowHeight)},t=i.a.register(e=>{if(0===e.action.indexOf("effects.")){(async e=>{if(!e)return null;let t=c.current[e]||null;if(null===t){var n;const s=null===(n=o.CHAT_EFFECTS.find(t=>t.command===e))||void 0===n?void 0:n.options;try{const{default:n}=await a(2756)("./"+e);t=new n(s),c.current[e]=t}catch(t){console.warn(`Unable to load effect module at '../../../effects/${e}.`,t)}}return t})(e.action.substr("effects.".length)).then(e=>null==e?void 0:e.start(l.current))}});return l.current.height=r.b.instance.windowHeight,r.b.instance.on(r.a.Resize,e),()=>{i.a.unregister(t),r.b.instance.off(r.a.Resize,e);const a=c.current;for(const e in a){const t=a[e];t&&t.isRunning&&t.stop()}}},[]),s.a.createElement("canvas",{ref:l,width:t,style:{display:"block",zIndex:999999,pointerEvents:"none",position:"fixed",top:0,right:0}})}},627:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(19),s=a.n(n),i=a(385);class o extends i.a{static set matrixClient(e){const t=o._matrixClient;o._matrixClient=e;for(const a of o.instances)a.initMatrixClient(t,e)}constructor(){super(),o.instances.push(this)}get client(){return o._matrixClient}initMatrixClient(e,t){console.warn("initMatrixClient not overridden")}}s()(o,"_matrixClient",void 0),s()(o,"instances",[])},632:function(e,t,a){"use strict";a.d(t,"e",(function(){return u})),a.d(t,"d",(function(){return p})),a.d(t,"g",(function(){return g})),a.d(t,"c",(function(){return f})),a.d(t,"f",(function(){return v})),a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return E}));var n=a(19),s=a.n(n),i=a(2681),o=a.n(i);class r{constructor(e){s()(this,"_regex",void 0);const t=o()(e,{extended:!1,globstar:!1}).toString().replace(/\\\?/g,".");this._regex=new RegExp(t.substring(1,t.length-1))}test(e){return this._regex.test(e)}}const l=["m.ban","org.matrix.mjolnir.ban"];function c(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return l.includes(e)?t?l[l.length-1]:"m.ban":null}class d{constructor(e,t,a,n){s()(this,"_glob",void 0),s()(this,"_entity",void 0),s()(this,"_action",void 0),s()(this,"_reason",void 0),s()(this,"_kind",void 0),this._glob=new r(e),this._entity=e,this._action=c(t,!1),this._reason=a,this._kind=n}get entity(){return this._entity}get reason(){return this._reason}get kind(){return this._kind}get recommendation(){return this._action}isMatch(e){return this._glob.test(e)}}var m=a(99);const u="m.room.rule.user",h="m.room.rule.room",p="m.room.rule.server",g=[u,"org.matrix.mjolnir.rule.user"],f=[h,"org.matrix.mjolnir.rule.room"],v=[p,"org.matrix.mjolnir.rule.server"],b=[...g,...f,...v];function y(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return g.includes(e)?t?g[g.length-1]:u:f.includes(e)?t?f[f.length-1]:h:v.includes(e)?t?v[v.length-1]:p:null}class E{constructor(e){s()(this,"_rules",[]),s()(this,"_roomId",void 0),this._roomId=e,this.updateList()}get roomId(){return this._roomId}get serverRules(){return this._rules.filter(e=>e.kind===p)}get userRules(){return this._rules.filter(e=>e.kind===u)}get roomRules(){return this._rules.filter(e=>e.kind===h)}async banEntity(e,t,a){await m.a.get().sendStateEvent(this._roomId,y(e,!0),{entity:t,reason:a,recommendation:c("m.ban",!0)},"rule:"+t),this._rules.push(new d(t,"m.ban",a,y(e,!1)))}async unbanEntity(e,t){await m.a.get().sendStateEvent(this._roomId,y(e,!0),{},"rule:"+t),this._rules=this._rules.filter(a=>a.kind!==y(e,!1)||a.entity!==t)}updateList(){this._rules=[];const e=m.a.get().getRoom(this._roomId);if(e)for(const t of b){const a=e.currentState.getStateEvents(t,void 0);for(const e of a){if(!e.getStateKey())continue;const a=y(t,!1),n=e.getContent().entity,s=e.getContent().recommendation,i=e.getContent().reason;n&&s&&i&&this._rules.push(new d(n,s,i,a))}}}}},633:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(8),s=a(256),i=a(146),o=a(1),r=a(0),l=a(258),c=a.n(l);class d extends n.EventEmitter{constructor(e,t,a){super(),c()(this,"_onEventStatus",(e,t)=>{e.isSending()?t===i.a.CANCELLED&&(e.removeListener("Event.status",this._onEventStatus),this._removeEvent(e)):e.removeListener("Event.status",this._onEventStatus)}),c()(this,"_onBeforeRedaction",async e=>{if(this._relations.has(e)){if(this._relations.delete(e),"m.annotation"===this.relationType)this._removeAnnotationFromAggregation(e);else if("m.replace"===this.relationType&&this._targetEvent){const e=await this.getLastReplacement();this._targetEvent.makeReplaced(e)}e.removeListener("Event.beforeRedaction",this._onBeforeRedaction),this.emit("Relations.redaction",e)}}),this.relationType=e,this.eventType=t,this._relationEventIds=new Set,this._relations=new Set,this._annotationsByKey={},this._annotationsBySender={},this._sortedAnnotationsByKey=[],this._targetEvent=null,this._room=a,this._creationEmitted=!1}async addEvent(e){if(this._relationEventIds.has(e.getId()))return;const t=e.getRelation();if(!t)return void r.a.error("Event must have relation info");const a=t.rel_type,n=e.getType();if(this.relationType===a&&this.eventType===n){if(e.isSending()&&e.on("Event.status",this._onEventStatus),this._relations.add(e),this._relationEventIds.add(e.getId()),"m.annotation"===this.relationType)this._addAnnotationToAggregation(e);else if("m.replace"===this.relationType&&this._targetEvent){const e=await this.getLastReplacement();this._targetEvent.makeReplaced(e)}e.on("Event.beforeRedaction",this._onBeforeRedaction),this.emit("Relations.add",e),this._maybeEmitCreated()}else r.a.error("Event relation info doesn't match this container")}async _removeEvent(e){if(!this._relations.has(e))return;const t=e.getRelation();if(!t)return void r.a.error("Event must have relation info");const a=t.rel_type,n=e.getType();if(this.relationType===a&&this.eventType===n){if(this._relations.delete(e),"m.annotation"===this.relationType)this._removeAnnotationFromAggregation(e);else if("m.replace"===this.relationType&&this._targetEvent){const e=await this.getLastReplacement();this._targetEvent.makeReplaced(e)}this.emit("Relations.remove",e)}else r.a.error("Event relation info doesn't match this container")}getRelations(){return[...this._relations]}_addAnnotationToAggregation(e){const{key:t}=e.getRelation();if(!t)return;let a=this._annotationsByKey[t];a||(a=this._annotationsByKey[t]=new Set,this._sortedAnnotationsByKey.push([t,a])),a.add(e),this._sortedAnnotationsByKey.sort((e,t)=>{const a=e[1];return t[1].size-a.size});const n=e.getSender();let s=this._annotationsBySender[n];s||(s=this._annotationsBySender[n]=new Set),s.add(e)}_removeAnnotationFromAggregation(e){const{key:t}=e.getRelation();if(!t)return;const a=this._annotationsByKey[t];a&&(a.delete(e),this._sortedAnnotationsByKey.sort((e,t)=>{const a=e[1];return t[1].size-a.size}));const n=e.getSender(),s=this._annotationsBySender[n];s&&s.delete(e)}getSortedAnnotationsByKey(){return"m.annotation"!==this.relationType?null:this._sortedAnnotationsByKey}getAnnotationsBySender(){return"m.annotation"!==this.relationType?null:this._annotationsBySender}async getLastReplacement(){if("m.replace"!==this.relationType)return null;if(!this._targetEvent)return null;const e=this._targetEvent.getServerAggregatedRelation("m.replace"),t=e&&e.origin_server_ts,a=this.getRelations().reduce((e,a)=>a.getSender()!==this._targetEvent.getSender()||t&&t>a.getTs()||e&&e.getTs()>a.getTs()?e:a,null);return null!=a&&a.shouldAttemptDecryption()?await a.attemptDecryption(this._room._client.crypto):null!=a&&a.isBeingDecrypted()&&await a._decryptionPromise,a}async setTargetEvent(e){if(!this._targetEvent){if(this._targetEvent=e,"m.replace"===this.relationType){const e=await this.getLastReplacement();e&&this._targetEvent.makeReplaced(e)}this._maybeEmitCreated()}}_maybeEmitCreated(){this._creationEmitted||this._targetEvent&&this._relations.size&&(this._creationEmitted=!0,this._targetEvent.emit("Event.relationsCreated",this.relationType,this.eventType))}}let m;function u(e,t){this.room=e,this._timelineSupport=Boolean(t.timelineSupport),this._liveTimeline=new s.a(this),this._unstableClientRelationAggregation=!!t.unstableClientRelationAggregation,this._timelines=[this._liveTimeline],this._eventIdToTimeline={},this._filter=t.filter||null,this._unstableClientRelationAggregation&&(this._relations={})}m=r.a.log.bind(r.a),o.m(u,n.EventEmitter),u.prototype.getTimelines=function(){return this._timelines},u.prototype.getFilter=function(){return this._filter},u.prototype.setFilter=function(e){this._filter=e},u.prototype.getPendingEvents=function(){return this.room?this._filter?this._filter.filterRoomTimeline(this.room.getPendingEvents()):this.room.getPendingEvents():[]},u.prototype.getLiveTimeline=function(){return this._liveTimeline},u.prototype.eventIdToTimeline=function(e){return this._eventIdToTimeline[e]},u.prototype.replaceEventId=function(e,t){const a=this._eventIdToTimeline[e];a&&(delete this._eventIdToTimeline[e],this._eventIdToTimeline[t]=a)},u.prototype.resetLiveTimeline=function(e,t){const a=!this._timelineSupport||!t,n=this._liveTimeline,i=a?n.forkLive(s.a.FORWARDS):n.fork(s.a.FORWARDS);a?(this._timelines=[i],this._eventIdToTimeline={}):this._timelines.push(i),t&&n.setPaginationToken(t,s.a.FORWARDS),i.setPaginationToken(e,s.a.BACKWARDS),this._liveTimeline=i,this.emit("Room.timelineReset",this.room,this,a)},u.prototype.getTimelineForEvent=function(e){const t=this._eventIdToTimeline[e];return void 0===t?null:t},u.prototype.findEventById=function(e){const t=this.getTimelineForEvent(e);if(t)return t.getEvents().find((function(t){return t.getId()==e}))},u.prototype.addTimeline=function(){if(!this._timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new s.a(this);return this._timelines.push(e),e},u.prototype.addEventsToTimeline=function(e,t,a,n){if(!a)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&a==this._liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this._filter&&!(e=this._filter.filterRoomTimeline(e)).length)return;const i=t?s.a.BACKWARDS:s.a.FORWARDS,o=t?s.a.FORWARDS:s.a.BACKWARDS;let l=!1,c=!1;for(let n=0;n<e.length;n++){const d=e[n],u=d.getId(),h=this._eventIdToTimeline[u];if(!h){this.addEventToTimeline(d,a,t),c=!0,l=!0;continue}if(c=!1,h==a){m("Event "+u+" already in timeline "+a);continue}const p=a.getNeighbouringTimeline(i);if(p){m(h==p?"Event "+u+" in neighbouring timeline - switching to "+h:"Event "+u+" already in a different timeline "+h),a=h;continue}r.a.info("Already have timeline for "+u+" - joining timeline "+a+" to "+h);const g=h===this._liveTimeline,f=a===this._liveTimeline,v=i===s.a.BACKWARDS&&g,b=i===s.a.FORWARDS&&f;v||b?(v&&r.a.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+h+")"),b&&r.a.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+a+")")):(a.setNeighbouringTimeline(h,i),h.setNeighbouringTimeline(a,o),a=h,l=!0)}if(c||!l){if(i===s.a.FORWARDS&&a===this._liveTimeline)return r.a.warn({lastEventWasNew:c,didUpdate:l}),void r.a.warn(`Refusing to set forwards pagination token of live timeline ${a} to ${n}`);a.setPaginationToken(n,i)}},u.prototype.addLiveEvent=function(e,t,a){if(this._filter){if(!this._filter.filterRoomTimeline([e]).length)return}const n=this._eventIdToTimeline[e.getId()];if(n)if("replace"===t){m("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const t=n.getEvents();for(let a=0;a<t.length;a++)if(t[a].getId()===e.getId()){s.a.setEventMetadata(e,n.getState(s.a.FORWARDS),!1),t[a].encryptedType||(t[a]=e);break}}else m("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this._liveTimeline,!1,a)},u.prototype.addEventToTimeline=function(e,t,a,n){const s=e.getId();t.addEvent(e,a),this._eventIdToTimeline[s]=t,this.setRelationsTarget(e),this.aggregateRelations(e);const i={timeline:t,liveEvent:!a&&t==this._liveTimeline&&!n};this.emit("Room.timeline",e,this.room,Boolean(a),!1,i)},u.prototype.handleRemoteEcho=function(e,t,a){const n=this._eventIdToTimeline[t];n?(delete this._eventIdToTimeline[t],this._eventIdToTimeline[a]=n):this._filter?this._filter.filterRoomTimeline([e]).length&&this.addEventToTimeline(e,this._liveTimeline,!1):this.addEventToTimeline(e,this._liveTimeline,!1)},u.prototype.removeEvent=function(e){const t=this._eventIdToTimeline[e];if(!t)return null;const a=t.removeEvent(e);if(a){delete this._eventIdToTimeline[e];const n={timeline:t};this.emit("Room.timeline",a,this.room,void 0,!0,n)}return a},u.prototype.compareEventOrdering=function(e,t){if(e==t)return 0;const a=this._eventIdToTimeline[e],n=this._eventIdToTimeline[t];if(void 0===a)return null;if(void 0===n)return null;if(a===n){let n,s;const i=a.getEvents();for(let a=0;a<i.length&&(void 0===n||void 0===s);a++){const o=i[a].getId();o==e&&(n=a),o==t&&(s=a)}return n-s}let i=a;for(;i;){if(i===n)return-1;i=i.getNeighbouringTimeline(s.a.FORWARDS)}for(i=a;i;){if(i===n)return 1;i=i.getNeighbouringTimeline(s.a.BACKWARDS)}return null},u.prototype.getRelationsForEvent=function(e,t,a){if(!this._unstableClientRelationAggregation)throw new Error("Client-side relation aggregation is disabled");if(!e||!t||!a)throw new Error("Invalid arguments for `getRelationsForEvent`");return((this._relations[e]||{})[t]||{})[a]},u.prototype.setRelationsTarget=function(e){if(!this._unstableClientRelationAggregation)return;const t=this._relations[e.getId()];if(t)for(const a of Object.values(t))for(const t of Object.values(a))t.setTargetEvent(e)},u.prototype.aggregateRelations=function(e){if(!this._unstableClientRelationAggregation)return;if(e.isRedacted()||e.status===i.a.CANCELLED)return;if(e.isBeingDecrypted()||e.shouldAttemptDecryption())return void e.once("Event.decrypted",()=>{this.aggregateRelations(e)});const t=e.getRelation();if(!t)return;const a=t.event_id,n=t.rel_type,s=e.getType();let o=this._relations[a];o||(o=this._relations[a]={});let r=o[n];r||(r=o[n]={});let l,c=r[s];c||(c=r[s]=new d(n,s,this.room),l=this.findEventById(a)||this.room.getPendingEvent(a),l&&c.setTargetEvent(l)),c.addEvent(e)}},634:function(e,t,a){"use strict";a.d(t,"b",(function(){return U})),a.d(t,"c",(function(){return L})),a.d(t,"a",(function(){return F})),a.d(t,"d",(function(){return H}));var n=a(19),s=a.n(n),i=a(88),o=a.n(i),r=a(93),l=a(97),c=a(99),d=a(155),m=a(185),u=a(110),h=a(328),p=a(483),g=a(416),f=a(100),v=a(330),b=a(106);var y,E,_=a(214),S=a(205),C=a(131),w=a(115),O=a(161),x=a(174),R=a(203),k=a(103),I=a(147),T=a(154),P=a(94),N=a(126),D=a(363),j=a(227),A=a(108),M=a(226);const U="dm",L="invite",F="call_transfer";class B{}class V extends B{constructor(e){super(),s()(this,"_userId",void 0),s()(this,"displayName",void 0),s()(this,"avatarUrl",void 0),this._userId=e.user_id,this.displayName=e.display_name,this.avatarUrl=e.avatar_url}get name(){return this.displayName||this._userId}get userId(){return this._userId}getMxcAvatarUrl(){return this.avatarUrl}}class G extends B{constructor(e){super(),s()(this,"id",void 0),this.id=e}get isEmail(){return this.id.includes("@")}get name(){return this.id}get userId(){return this.id}getMxcAvatarUrl(){return null}}class z extends o.a.PureComponent{constructor(){super(...arguments),s()(this,"onRemove",e=>{e.preventDefault(),e.stopPropagation(),this.props.onRemove(this.props.member)})}render(){const e=this.props.member.isEmail?o.a.createElement("img",{className:"mx_InviteDialog_userTile_avatar mx_InviteDialog_userTile_threepidAvatar",src:a(1423),width:20,height:20}):o.a.createElement(j.a,{className:"mx_InviteDialog_userTile_avatar",url:this.props.member.getMxcAvatarUrl()?Object(N.b)(this.props.member.getMxcAvatarUrl()).getSquareThumbnailHttp(20):null,name:this.props.member.name,idName:this.props.member.userId,width:20,height:20});let t;return this.props.onRemove&&(t=o.a.createElement(A.a,{className:"mx_InviteDialog_userTile_remove",onClick:this.onRemove},o.a.createElement("img",{src:a(2740),alt:Object(r.a)("Remove"),width:8,height:8}))),o.a.createElement("span",{className:"mx_InviteDialog_userTile"},o.a.createElement("span",{className:"mx_InviteDialog_userTile_pill"},e,o.a.createElement("span",{className:"mx_InviteDialog_userTile_name"},this.props.member.name)),t)}}class W extends o.a.PureComponent{constructor(){super(...arguments),s()(this,"onClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onToggle(this.props.member)})}highlightName(e){if(!this.props.highlightWord)return e;const t=e.toLowerCase(),a=this.props.highlightWord.toLowerCase(),n=[];let s,i=0;for(;(s=t.indexOf(a,i))>=0;){s>i&&n.push(o.a.createElement("span",{key:i+"begin"},e.substring(i,s))),i=s;const t=e.substring(i,a.length+i);n.push(o.a.createElement("span",{className:"mx_InviteDialog_roomTile_highlight",key:i+"bold"},t)),i+=t.length}return i<e.length&&n.push(o.a.createElement("span",{key:i+"end"},e.substring(i))),n}render(){let e=null;if(this.props.lastActiveTs){const t=function(e){let t=(new Date).getTime()-e;const a=Math.abs(Math.ceil(t/6e4)),n=Math.ceil(a/60),s=Math.ceil(n/24);return t>=0?t<=15e3?Object(r.a)("a few seconds ago"):t<=75e3?Object(r.a)("about a minute ago"):a<=45?Object(r.a)("%(num)s minutes ago",{num:a}):a<=75?Object(r.a)("about an hour ago"):n<=23?Object(r.a)("%(num)s hours ago",{num:n}):n<=26?Object(r.a)("about a day ago"):Object(r.a)("%(num)s days ago",{num:s}):(t=Math.abs(t),t<=15e3?Object(r.a)("a few seconds from now"):t<=75e3?Object(r.a)("about a minute from now"):a<=45?Object(r.a)("%(num)s minutes from now",{num:a}):a<=75?Object(r.a)("about an hour from now"):n<=23?Object(r.a)("%(num)s hours from now",{num:n}):n<=26?Object(r.a)("about a day from now"):Object(r.a)("%(num)s days from now",{num:s}))}(this.props.lastActiveTs);e=o.a.createElement("span",{className:"mx_InviteDialog_roomTile_time"},t)}const t=this.props.member.isEmail?o.a.createElement("img",{src:a(1423),width:36,height:36}):o.a.createElement(j.a,{url:this.props.member.getMxcAvatarUrl()?Object(N.b)(this.props.member.getMxcAvatarUrl()).getSquareThumbnailHttp(36):null,name:this.props.member.name,idName:this.props.member.userId,width:36,height:36});let n=null;this.props.isSelected&&(n=o.a.createElement("div",{className:"mx_InviteDialog_roomTile_selected"}));const s=o.a.createElement("span",{className:"mx_InviteDialog_roomTile_avatarStack"},t,n),i=this.props.member.isEmail?Object(r.a)("Invite by email"):this.highlightName(this.props.member.userId);return o.a.createElement("div",{className:"mx_InviteDialog_roomTile",onClick:this.onClick},s,o.a.createElement("span",{className:"mx_InviteDialog_roomTile_nameStack"},o.a.createElement("div",{className:"mx_InviteDialog_roomTile_name"},this.highlightName(this.props.member.name)),o.a.createElement("div",{className:"mx_InviteDialog_roomTile_userId"},i)),e)}}let H=Object(P.a)("views.dialogs.InviteDialog")((E=class e extends o.a.PureComponent{constructor(t){if(super(t),s()(this,"debounceTimer",null),s()(this,"editorRef",Object(i.createRef)()),s()(this,"unmounted",!1),s()(this,"onConsultFirstChange",e=>{this.setState({consultFirst:e.target.checked})}),s()(this,"startDm",async()=>{this.setState({busy:!0});const e=c.a.get(),t=this.convertFilter(),a=t.map(e=>e.userId);let n;if(n=1===a.length?Object(_.g)(e,a[0]):m.a.shared().getDMRoomForIdentifiers(a),n)return f.a.dispatch({action:"view_room",room_id:n.roomId,should_peek:!1,joining:!1}),void this.props.onFinished();const s={inlineErrors:!0};if(Object(_.h)()){if(!t.some(e=>e instanceof G)){await Object(_.c)(e,a)&&(s.encryption=!0)}}try{const t=1===a.length&&a[0]===e.getUserId();1!==a.length||t||(s.dmUserId=a[0]),a.length>1&&(s.createOpts=a.reduce((t,a)=>{const n=Object(D.c)(a);if("email"===n){const n={id_server:e.getIdentityServerUrl(!0),medium:"email",address:a};t.invite_3pid.push(n)}else"mx-user-id"===n&&t.invite.push(a);return t},{invite:[],invite_3pid:[]})),await Object(_.d)(s),this.props.onFinished()}catch(e){console.error(e),this.setState({busy:!1,errorText:Object(r.a)("We couldn't create your DM.")})}}),s()(this,"inviteUsers",async()=>{const e=T.a.getTimestamp();this.setState({busy:!0}),this.convertFilter();const t=this.convertFilter().map(e=>e.userId),a=c.a.get(),n=a.getRoom(this.props.roomId);if(!n)return console.error("Failed to find the room to invite users to"),void this.setState({busy:!1,errorText:Object(r.a)("Something went wrong trying to invite the users.")});try{const s=await Object(S.a)(this.props.roomId,t);if(T.a.instance.trackSendInvite(e,this.props.roomId,t.length),this.shouldAbortAfterInviteError(s)||this.props.onFinished(),a.isRoomEncrypted(this.props.roomId)){const e=n.currentState.getStateEvents("m.room.history_visibility",""),t=e&&e.getContent()&&e.getContent().history_visibility;if("world_readable"==t||"shared"==t){const e=[];for(const[t,a]of Object.entries(s.states))"invited"===a&&"mx-user-id"===Object(D.c)(t)&&e.push(t);console.log("Sharing history with",e),a.sendSharedHistoryKeys(this.props.roomId,e)}}}catch(e){console.error(e),this.setState({busy:!1,errorText:Object(r.a)("We couldn't invite those users. Please check the users you want to invite and try again.")})}}),s()(this,"transferCall",async()=>{this.convertFilter();const e=this.convertFilter().map(e=>e.userId);if(e.length>1&&this.setState({errorText:Object(r.a)("A call can only be transferred to a single user.")}),this.state.consultFirst){const t=await Object(_.e)(c.a.get(),e[0]);f.a.dispatch({action:"place_call",type:this.props.call.type,room_id:t,transferee:this.props.call}),f.a.dispatch({action:"view_room",room_id:t,should_peek:!1,joining:!1}),this.props.onFinished()}else{this.setState({busy:!0});try{await this.props.call.transfer(e[0]),this.setState({busy:!1}),this.props.onFinished()}catch(e){this.setState({busy:!1,errorText:Object(r.a)("Failed to transfer call")})}}}),s()(this,"onKeyDown",e=>{if(this.state.busy)return;const t=e.target.value.trim(),a=e.ctrlKey||e.shiftKey||e.metaKey;!t&&this.state.targets.length>0&&e.key===C.a.BACKSPACE&&!a?(e.preventDefault(),this.removeMember(this.state.targets[this.state.targets.length-1])):(t&&e.key===C.a.ENTER&&!a||t&&e.key===C.a.SPACE&&!a&&t.includes("@")&&!t.includes(" "))&&(e.preventDefault(),this.convertFilter())}),s()(this,"updateSuggestions",async e=>{if(c.a.get().searchUserDirectory({term:e}).then(async t=>{if(e===this.state.filterText){if(t.results||(t.results=[]),"@"===e[0]&&e.indexOf(":")>1)try{const a=await c.a.get().getProfileInfo(e);a&&t.results.splice(0,0,{user_id:e,display_name:a.displayname,avatar_url:a.avatar_url})}catch(a){console.warn("Non-fatal error trying to make an invite for a user ID"),console.warn(a),t.results.splice(0,0,{user_id:e,display_name:e,avatar_url:null})}this.setState({serverResultsMixin:t.results.map(e=>({userId:e.user_id,user:new V(e)}))})}}).catch(e=>{console.error("Error searching user directory:"),console.error(e),this.setState({serverResultsMixin:[]})}),this.state.canUseIdentityServer){if(e.indexOf("@")>0&&h.a(e)&&k.b.getValue(I.a.IdentityServer)){this.setState({threepidResultsMixin:[{user:new G(e),userId:e}]});try{const t=new v.a,a=await t.getAccessToken();if(e!==this.state.filterText)return;const n=await c.a.get().lookupThreePid("email",e,void 0,a);if(e!==this.state.filterText)return;if(!n||!n.mxid)return;const s=await c.a.get().getProfileInfo(n.mxid);if(e!==this.state.filterText||!s)return;this.setState({threepidResultsMixin:[...this.state.threepidResultsMixin,{user:new V({user_id:n.mxid,display_name:s.displayname,avatar_url:s.avatar_url}),userId:n.mxid}]})}catch(e){console.error("Error searching identity server:"),console.error(e),this.setState({threepidResultsMixin:[]})}}}else this.setState({tryingIdentityServer:!0})}),s()(this,"updateFilter",e=>{const t=e.target.value;this.setState({filterText:t}),this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.updateSuggestions(t)},150)}),s()(this,"showMoreRecents",()=>{this.setState({numRecentsShown:this.state.numRecentsShown+5})}),s()(this,"showMoreSuggestions",()=>{this.setState({numSuggestionsShown:this.state.numSuggestionsShown+5})}),s()(this,"toggleMember",e=>{if(!this.state.busy){let t=this.state.filterText;const a=this.state.targets.map(e=>e),n=a.indexOf(e);n>=0?a.splice(n,1):(a.push(e),t=""),this.setState({targets:a,filterText:t}),this.editorRef&&this.editorRef.current&&this.editorRef.current.focus()}}),s()(this,"removeMember",e=>{const t=this.state.targets.map(e=>e),a=t.indexOf(e);a>=0&&(t.splice(a,1),this.setState({targets:t})),this.editorRef&&this.editorRef.current&&this.editorRef.current.focus()}),s()(this,"onPaste",async e=>{if(this.state.filterText)return;e.preventDefault();const t=e.clipboardData.getData("text"),a=[...this.state.recents,...this.state.suggestions,...this.state.serverResultsMixin,...this.state.threepidResultsMixin],n=[],s=[],i=t.split(/[\s,]+/).map(e=>e.trim()).filter(e=>!!e);for(const t of i){const i=a.find(e=>e.userId===t);if(i)n.push(i.user);else if(t.indexOf("@")>0&&h.a(t))n.push(new G(t));else if("@"===t[0])try{const e=await c.a.get().getProfileInfo(t),a=e?e.displayname:null,s=e?e.avatar_url:null;n.push(new V({user_id:t,display_name:a,avatar_url:s}))}catch(e){console.error("Error looking up profile for "+t),console.error(e),s.push(t)}else s.push(t)}if(!this.unmounted){if(s.length>0){const e=l.getComponent("dialogs.QuestionDialog");b.a.createTrackedDialog("Invite Paste Fail","",e,{title:Object(r.a)("Failed to find the following users"),description:Object(r.a)("The following users might not exist or are invalid, and cannot be invited: %(csvNames)s",{csvNames:s.join(", ")}),button:Object(r.a)("OK")})}this.setState({targets:[...this.state.targets,...n]})}}),s()(this,"onClickInputArea",e=>{e.preventDefault(),e.stopPropagation(),this.editorRef&&this.editorRef.current&&this.editorRef.current.focus()}),s()(this,"onUseDefaultIdentityServerClick",e=>{e.preventDefault(),Object(p.d)(),this.setState({canUseIdentityServer:!0,tryingIdentityServer:!1})}),s()(this,"onManageSettingsClick",e=>{e.preventDefault(),f.a.fire(w.a.ViewUserSettings),this.props.onFinished()}),s()(this,"onCommunityInviteClick",e=>{this.props.onFinished(),Object(S.e)(R.a.instance.getSelectedCommunityId())}),t.kind===L&&!t.roomId)throw new Error("When using KIND_INVITE a roomId is required for an InviteDialog");if(t.kind===F&&!t.call)throw new Error("When using KIND_CALL_TRANSFER a call is required for an InviteDialog");const a=new Set([c.a.get().getUserId(),u.a.get().welcomeUserId]);if(t.roomId){const e=c.a.get().getRoom(t.roomId);if(!e)throw new Error("Room ID given to InviteDialog does not look like a room");e.getMembersWithMembership("invite").forEach(e=>a.add(e.userId)),e.getMembersWithMembership("join").forEach(e=>a.add(e.userId)),e.getMembersWithMembership("ban").forEach(e=>a.add(e.userId)),T.a.instance.trackBeginInvite(t.roomId)}this.state={targets:[],filterText:this.props.initialText,recents:e.buildRecents(a),numRecentsShown:3,suggestions:this.buildSuggestions(a),numSuggestionsShown:3,serverResultsMixin:[],threepidResultsMixin:[],canUseIdentityServer:!!c.a.get().getIdentityServerUrl(),tryingIdentityServer:!1,consultFirst:!1,busy:!1,errorText:null}}componentDidMount(){this.props.initialText&&this.updateSuggestions(this.props.initialText)}componentWillUnmount(){this.unmounted=!0}static buildRecents(e){const t=m.a.shared().getUniqueRoomsWithIndividuals(),a=x.b.instance.orderedLists[O.a.DM]||[],n=c.a.get().getUserId();for(const e of a){const a=e.getJoinedMembers().filter(e=>e.userId!==n);for(const n of a)t[n.userId]||(console.warn(`Adding DM room for ${n.userId} as ${e.roomId} from tag, not DM map`),t[n.userId]=e)}const s=[];for(const a in t){if(e.has(a)){console.warn(`[Invite:Recents] Excluding ${a} from recents`);continue}const n=t[a],i=n.getMember(a);if(!i){console.warn(`[Invite:Recents] ${a} is missing a member object in their own DM (${n.roomId})`);continue}const o=["m.room.message","m.room.encrypted","m.sticker"],r=20;let l=0;if(n.timeline&&n.timeline.length)for(let e=n.timeline.length-1;e>=0;e--){const t=n.timeline[e];if(o.includes(t.getType())){l=t.getTs();break}if(n.timeline.length-e>r)break}l?s.push({userId:a,user:i,lastActive:l}):console.warn(`[Invite:Recents] ${a} (${n.roomId}) has a weird last timestamp: ${l}`)}return s||console.warn("[Invite:Recents] No recents to suggest!"),s.sort((e,t)=>t.lastActive-e.lastActive),s}buildSuggestions(e){const t=c.a.get().getRooms().filter(e=>"join"===e.getMyMembership()&&e.getJoinedMemberCount()<=200).reduce((t,a)=>{if(m.a.shared().getUserIdForRoomId(a.roomId))return t;const n=a.getJoinedMembers().filter(t=>!e.has(t.userId));for(const s of n)e.has(s.userId)||(t[s.userId]||(t[s.userId]={member:s,pickedMemberRoomSize:a.getJoinedMemberCount(),rooms:[]}),t[s.userId].rooms.push(a),a.getJoinedMemberCount()<t[s.userId].pickedMemberRoomSize&&(t[s.userId].member=s,t[s.userId].pickedMemberRoomSize=a.getJoinedMemberCount()));return t},{}),a=Object.values(t).reduce((e,t)=>{const a=t.rooms.reduce((e,t)=>e+t.getJoinedMemberCount(),0),n=200*t.rooms.length;return e[t.member.userId]={member:t.member,numRooms:t.rooms.length,score:Math.max(0,Math.pow(1-a/n,5))},e},{}),n=c.a.get().getRooms().filter(e=>"join"===e.getMyMembership()),s=(new Date).getTime(),i=s-36e5,o={},r={};for(const t of n){const a=m.a.shared().getUserIdForRoomId(t.roomId);if(Object.keys(t.tags).includes("m.lowpriority")||a)continue;const n=t.getLiveTimeline().getEvents();for(let a=n.length-1;a>=Math.max(0,n.length-50);a--){const s=n[a];if(!e.has(s.getSender())){if(s.getTs()<=i)break;(!o[s.getSender()]||o[s.getSender()]<s.getTs())&&(o[s.getSender()]=s.getTs(),r[s.getSender()]=t.getMember(s.getSender()))}}}for(const e in o){const t=o[e],n=r[e];if(!n)continue;const l=s-i-Math.abs(s-t),c=Math.max(1,l/9e5);let d=a[e];d||(d=a[e]={score:0}),d.member=n,d.score+=c}const l=Object.values(a);return l.sort((e,t)=>e.score===t.score?e.numRooms===t.numRooms?Object(M.a)(e.member.userId,t.member.userId):t.numRooms-e.numRooms:t.score-e.score),l.map(e=>({userId:e.member.userId,user:e.member}))}shouldAbortAfterInviteError(e){const t=Object.keys(e.states).filter(t=>"error"===e.states[t]);return t.length>0&&(console.log("Failed to invite users: ",e),this.setState({busy:!1,errorText:Object(r.a)("Failed to invite the following users to chat: %(csvUsers)s",{csvUsers:t.join(", ")})}),!0)}convertFilter(){if(!this.state.filterText||!this.state.filterText.includes("@"))return this.state.targets||[];let e;this.state.filterText.startsWith("@")?e=new V({user_id:this.state.filterText,display_name:null,avatar_url:null}):k.b.getValue(I.a.IdentityServer)&&(e=new G(this.state.filterText));const t=[...this.state.targets||[],e];return this.setState({targets:t,filterText:""}),t}renderSection(e){let t="recents"===e?this.state.recents:this.state.suggestions,a="recents"===e?this.state.numRecentsShown:this.state.numSuggestionsShown;const n="recents"===e?this.showMoreRecents.bind(this):this.showMoreSuggestions.bind(this);let s="recents"===e?Object(r.a)("Recent Conversations"):Object(r.a)("Suggestions"),i=null;if("suggestions"===e&&R.a.instance.getSelectedCommunityId()){const e=R.a.instance.getSelectedCommunityName();i=Object(r.a)("May include members not in %(communityName)s",{communityName:e})}this.props.kind===L&&(s="recents"===e?Object(r.a)("Recently Direct Messaged"):Object(r.a)("Suggestions"));let c=[],d=[];const m=this.state.serverResultsMixin||this.state.threepidResultsMixin;if(this.state.filterText&&m&&"suggestions"===e){const e=e=>!t.some(t=>t.userId===e.userId)&&!c.some(t=>t.userId===e.userId)&&!d.some(t=>t.userId===e.userId);d=this.state.serverResultsMixin.filter(e),c=this.state.threepidResultsMixin.filter(e)}const u=c.length>0||d.length>0;if(0===t.length&&!u)return null;if(this.state.filterText){const e=this.state.filterText.toLowerCase();if(t=t.filter(t=>t.user.name.toLowerCase().includes(e)||t.userId.toLowerCase().includes(e)),0===t.length&&!u)return o.a.createElement("div",{className:"mx_InviteDialog_section"},o.a.createElement("h3",null,s),o.a.createElement("p",null,Object(r.a)("No results")))}t=[...c,...t,...d],a===t.length-1&&a++;const h=t.slice(0,a),p=h.length<t.length,g=l.getComponent("elements.AccessibleButton");let f=null;p&&(f=o.a.createElement(g,{onClick:n,kind:"link"},Object(r.a)("Show more")));const v=h.map(t=>{return o.a.createElement(W,{member:t.user,lastActiveTs:(a=t,"recents"===e?a.lastActive:null),key:t.userId,onToggle:this.toggleMember,highlightWord:this.state.filterText,isSelected:this.state.targets.some(e=>e.userId===t.userId)});var a});return o.a.createElement("div",{className:"mx_InviteDialog_section"},o.a.createElement("h3",null,s),i?o.a.createElement("p",{className:"mx_InviteDialog_subname"},i):null,v,f)}renderEditor(){const e=this.state.targets.map(e=>o.a.createElement(z,{member:e,onRemove:!this.state.busy&&this.removeMember,key:e.userId})),t=o.a.createElement("input",{type:"text",onKeyDown:this.onKeyDown,onChange:this.updateFilter,value:this.state.filterText,ref:this.editorRef,onPaste:this.onPaste,autoFocus:!0,disabled:this.state.busy,autoComplete:"off"});return o.a.createElement("div",{className:"mx_InviteDialog_editor",onClick:this.onClickInputArea},e,t)}renderIdentityServerWarning(){if(!this.state.tryingIdentityServer||this.state.canUseIdentityServer||!k.b.getValue(I.a.IdentityServer))return null;const e=Object(p.c)();return e?o.a.createElement("div",{className:"mx_AddressPickerDialog_identityServer"},Object(r.a)("Use an identity server to invite by email. <default>Use the default (%(defaultIdentityServerName)s)</default> or manage in <settings>Settings</settings>.",{defaultIdentityServerName:Object(g.a)(e)},{default:e=>o.a.createElement("a",{href:"#",onClick:this.onUseDefaultIdentityServerClick},e),settings:e=>o.a.createElement("a",{href:"#",onClick:this.onManageSettingsClick},e)})):o.a.createElement("div",{className:"mx_AddressPickerDialog_identityServer"},Object(r.a)("Use an identity server to invite by email. Manage in <settings>Settings</settings>.",{},{settings:e=>o.a.createElement("a",{href:"#",onClick:this.onManageSettingsClick},e)}))}render(){const e=l.getComponent("views.dialogs.BaseDialog"),t=l.getComponent("elements.AccessibleButton"),n=l.getComponent("elements.Spinner");let s,i,m,u,h,p=null;this.state.busy&&(p=o.a.createElement(n,{w:20,h:20}));let g=o.a.createElement("span",null);const f=k.b.getValue(I.a.IdentityServer),v=c.a.get(),b=v.getUserId();if(this.props.kind===U){if(s=Object(r.a)("Direct Messages"),i=f?Object(r.a)("Start a conversation with someone using their name, email address or username (like <userId/>).",{},{userId:()=>o.a.createElement("a",{href:Object(d.h)(b),rel:"noreferrer noopener",target:"_blank"},b)}):Object(r.a)("Start a conversation with someone using their name or username (like <userId/>).",{},{userId:()=>o.a.createElement("a",{href:Object(d.h)(b),rel:"noreferrer noopener",target:"_blank"},b)}),R.a.instance.getSelectedCommunityId()){const e=R.a.instance.getSelectedCommunityName(),a=Object(r.a)("This won't invite them to %(communityName)s. To invite someone to %(communityName)s, click <a>here</a>",{communityName:e},{userId:()=>o.a.createElement("a",{href:Object(d.h)(b),rel:"noreferrer noopener",target:"_blank"},b),a:e=>o.a.createElement(t,{kind:"link",onClick:this.onCommunityInviteClick},e)});i=o.a.createElement(o.a.Fragment,null,i," ",a)}m=Object(r.a)("Go"),u=this.startDm}else if(this.props.kind===L){var y;const e=null===(y=c.a.get())||void 0===y?void 0:y.getRoom(this.props.roomId),t=k.b.getValue("feature_spaces")&&(null==e?void 0:e.isSpaceRoom());let n;if(s=t?Object(r.a)("Invite to %(spaceName)s",{spaceName:e.name||Object(r.a)("Unnamed Space")}):Object(r.a)("Invite to %(roomName)s",{roomName:e.name||Object(r.a)("Unnamed Room")}),n=t?f?Object(r.b)("Invite someone using their name, email address, username (like <userId/>) or <a>share this space</a>."):Object(r.b)("Invite someone using their name, username (like <userId/>) or <a>share this space</a>."):f?Object(r.b)("Invite someone using their name, email address, username (like <userId/>) or <a>share this room</a>."):Object(r.b)("Invite someone using their name, username (like <userId/>) or <a>share this room</a>."),i=Object(r.a)(n,{},{userId:()=>o.a.createElement("a",{href:Object(d.h)(b),rel:"noreferrer noopener",target:"_blank"},b),a:e=>o.a.createElement("a",{href:Object(d.g)(this.props.roomId),rel:"noreferrer noopener",target:"_blank"},e)}),m=Object(r.a)("Invite"),u=this.inviteUsers,v.isRoomEncrypted(this.props.roomId)){const e=v.getRoom(this.props.roomId).currentState.getStateEvents("m.room.history_visibility",""),t=e&&e.getContent()&&e.getContent().history_visibility;"world_readable"!==t&&"shared"!==t||(g=o.a.createElement("p",{className:"mx_InviteDialog_helpText"},o.a.createElement("img",{src:a(2741),width:14,height:14})," "+Object(r.a)("Invited people will be able to read old messages.")))}}else this.props.kind===F?(s=Object(r.a)("Transfer"),m=Object(r.a)("Transfer"),u=this.transferCall,h=o.a.createElement("div",null,o.a.createElement("label",null,o.a.createElement("input",{type:"checkbox",checked:this.state.consultFirst,onChange:this.onConsultFirstChange}),Object(r.a)("Consult first")))):console.error("Unknown kind of InviteDialog: "+this.props.kind);const E=this.state.targets.length>0||this.state.filterText&&this.state.filterText.includes("@");return o.a.createElement(e,{className:"mx_InviteDialog",hasCancel:!0,onFinished:this.props.onFinished,title:s},o.a.createElement("div",{className:"mx_InviteDialog_content"},o.a.createElement("p",{className:"mx_InviteDialog_helpText"},i),o.a.createElement("div",{className:"mx_InviteDialog_addressBar"},this.renderEditor(),o.a.createElement("div",{className:"mx_InviteDialog_buttonAndSpinner"},o.a.createElement(t,{kind:"primary",onClick:u,className:"mx_InviteDialog_goButton",disabled:this.state.busy||!E},m),p)),g,this.renderIdentityServerWarning(),o.a.createElement("div",{className:"error"},this.state.errorText),o.a.createElement("div",{className:"mx_InviteDialog_userSections"},this.renderSection("recents"),this.renderSection("suggestions")),h))}},s()(E,"defaultProps",{kind:U,initialText:""}),y=E))||y},635:function(e,t,a){"use strict";a.d(t,"c",(function(){return p})),a.d(t,"a",(function(){return g})),a.d(t,"d",(function(){return f}));var n=a(88),s=a.n(n),i=a(146),o=a(140),r=a(93),l=a(336),c=a(168),d=a(119),m=a(193);var u=a(800),h=a(1338);const p=e=>{const[t,a]=Object(n.useState)([]),s=Object(n.useCallback)(t=>{var n,s;e&&(t&&t.getType()!==o.a.RoomPinnedEvents||a((null===(n=e.currentState.getStateEvents(o.a.RoomPinnedEvents,""))||void 0===n||null===(s=n.getContent())||void 0===s?void 0:s.pinned)||[]))},[e]);return Object(m.a)(null==e?void 0:e.currentState,"RoomState.events",s),Object(n.useEffect)(()=>(s(),()=>{a([])}),[s]),t},g="im.vector.room.read_pins",f=e=>{const[t,a]=Object(n.useState)(new Set),s=Object(n.useCallback)(t=>{var n,s;if(!e)return;if(t&&t.getType()!==g)return;const i=null===(n=e.getAccountData(g))||void 0===n||null===(s=n.getContent())||void 0===s?void 0:s.event_ids;a(new Set(i||[]))},[e]);return Object(m.a)(e,"Room.accountData",s),Object(n.useEffect)(()=>(s(),()=>{a(new Set)}),[s]),t};t.b=e=>{let{room:t,onClose:a}=e;const v=Object(n.useContext)(d.a),b=((e,t)=>{const[a,s]=Object(n.useState)(e?t(e.currentState):void 0),i=Object(n.useCallback)(()=>{e&&s(t(e.currentState))},[e,t]);return Object(m.a)(null==e?void 0:e.currentState,"RoomState.events",i),Object(n.useEffect)(()=>(i(),()=>{s(void 0)}),[i]),a})(t,e=>e.mayClientSendStateEvent(o.a.RoomPinnedEvents,v)),y=p(t),E=f(t);Object(n.useEffect)(()=>{y.filter(e=>!E.has(e)).length>0&&v.setRoomAccountData(t.roomId,g,{event_ids:y})},[v,t.roomId,y,E]);const _=Object(u.a)(()=>{const e=y.map(async e=>{var a;const n=t.getUnfilteredTimelineSet(),s=null==n||null===(a=n.getTimelineForEvent(e))||void 0===a?void 0:a.getEvents().find(t=>t.getId()===e);if(s)return s;try{const a=await v.fetchRoomEvent(t.roomId,e),n=new i.b(a);if(n.isEncrypted()&&await v.decryptEventIfNeeded(n),n&&class{static isPinnable(e){return!!e&&("m.room.message"===e.getType()&&!e.isRedacted())}}.isPinnable(n))return n}catch(a){console.error("Error looking up pinned event "+e+" in room "+t.roomId),console.error(a)}return null});return Promise.all(e)},[v,t,y],null);let S;if(_)if(_.length>0){let e;b&&(e=async e=>{var a;const n=t.currentState.getStateEvents(o.a.RoomPinnedEvents,"");if(null!=n&&null!==(a=n.getContent())&&void 0!==a&&a.pinned){const a=n.getContent().pinned,s=a.indexOf(e.getId());-1!==s&&(a.splice(s,1),await v.sendStateEvent(t.roomId,o.a.RoomPinnedEvents,{pinned:a},""))}}),S=_.filter(Boolean).reverse().map(a=>s.a.createElement(h.a,{key:a.getId(),room:t,event:a,onUnpinClicked:e}))}else S=s.a.createElement("div",{className:"mx_RightPanel_empty mx_PinnedMessagesCard_empty"},s.a.createElement("h2",null,Object(r.a)("You’re all caught up")),s.a.createElement("p",null,Object(r.a)("You have no visible notifications.")));else S=s.a.createElement(c.a,null);return s.a.createElement(l.b,{header:s.a.createElement("h2",null,Object(r.a)("Pinned messages")),className:"mx_PinnedMessagesCard",onClose:a},S)}},636:function(e,t,a){"use strict";var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(206),d=a(202),m=a(127),u=a(93),h=a(215),p=a(420),g=a(340),f=a(100),v=a(103),b=a(106),y=a(216),E=a(186),_=a(247),S=a(119),C=a(267),w=a(99),O=a(110),x=a(5);function R(){return O.a.get().audioStreamUrl}async function k(e,t){const a=await async function(e){const t=await w.a.get().getOpenIdToken(),a=R()+"/createStream",n=await window.fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:e,openid_token:t})});return(await n.json()).stream_id}(t);await e.transport.send(x.a.StartLiveStream,{rtmpStreamKey:"rtmp://audiostream.dummy/"+a})}const I=["onFinished","app","userWidget","onDeleteClick","showUnpin"];t.a=e=>{let{onFinished:t,app:a,userWidget:n,onDeleteClick:i,showUnpin:w}=e,O=o()(e,I);const x=Object(r.useContext)(S.a),{room:T,roomId:P}=Object(r.useContext)(g.a),N=p.a.instance.getMessagingForId(a.id),D=n||h.a.canUserModifyWidgets(P);let j,A,M,U,L;if(R()&&_.a.JITSI.matches(a.type)){const e=async()=>{try{await k(N,P)}catch(e){console.error("Failed to start livestream",e);const t=e.message||Object(u.a)("Unable to start audio streaming.");b.a.createTrackedDialog("WidgetContext Menu","Livestream failed",E.a,{title:Object(u.a)("Failed to start livestream"),description:t})}t()};j=l.a.createElement(d.b,{onClick:e,label:Object(u.a)("Start audio stream")})}if(w){const e=()=>{C.d.instance.moveToContainer(T,a,C.a.Right),t()};A=l.a.createElement(d.b,{onClick:e,label:Object(u.a)("Unpin")})}if(D&&h.a.isManagedByManager(a)){const e=()=>{h.a.editWidget(T,a),t()};M=l.a.createElement(d.b,{onClick:e,label:Object(u.a)("Edit")})}if(null!=N&&N.hasCapability(c.MatrixCapabilities.Screenshots)){const e=()=>{null==N||N.takeScreenshot().then(e=>{f.a.dispatch({action:"picture_snapshot",file:e.screenshot})}).catch(e=>{console.error("Failed to take screenshot: ",e)}),t()};U=l.a.createElement(d.b,{onClick:e,label:Object(u.a)("Take a picture")})}if(i||D){const e=()=>{b.a.createTrackedDialog("Delete Widget","",y.a,{title:Object(u.a)("Delete Widget"),description:Object(u.a)("Deleting a widget removes it for all users in this room. Are you sure you want to delete this widget?"),button:Object(u.a)("Delete widget"),onFinished:e=>{e&&h.a.setRoomWidget(P,a.id)}}),t()};L=l.a.createElement(d.b,{onClick:i||e,label:n?Object(u.a)("Remove"):Object(u.a)("Remove for everyone")})}let F=v.b.getValue("allowedWidgets",P)[a.eventId];void 0===F&&(F=a.creatorUserId===x.getUserId());const B=_.a.JITSI.matches(a.type);let V;if(!n&&!B&&F){const e=()=>{console.info("Revoking permission for widget to load: "+a.eventId);const e=v.b.getValue("allowedWidgets",P);e[a.eventId]=!1;const n=v.b.firstSupportedLevel("allowedWidgets");v.b.setValue("allowedWidgets",P,n,e).catch(e=>{console.error(e)}),t()};V=l.a.createElement(d.b,{onClick:e,label:Object(u.a)("Revoke permissions")})}const G=C.d.instance.getContainerWidgets(T,C.a.Top),z=G.findIndex(e=>e.id===a.id);let W,H;if(w&&z>0){const e=()=>{C.d.instance.moveWithinContainer(T,C.a.Top,a,-1),t()};W=l.a.createElement(d.b,{onClick:e,label:Object(u.a)("Move left")})}if(w&&z<G.length-1){const e=()=>{C.d.instance.moveWithinContainer(T,C.a.Top,a,1),t()};H=l.a.createElement(d.b,{onClick:e,label:Object(u.a)("Move right")})}return l.a.createElement(d.e,s()({},O,{chevronFace:m.a.None,onFinished:t}),l.a.createElement(d.c,null,j,M,V,L,U,W,H,A))}},637:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(19),s=a.n(n);class i{constructor(e){this.tagId=e,s()(this,"_n",0),s()(this,"_previews",!1),s()(this,"_collapsed",!1);const t=localStorage.getItem(this.key);if(t){const e=JSON.parse(t);this._n=e.numTiles,this._previews=e.showPreviews,this._collapsed=e.collapsed}}get isCollapsed(){return this._collapsed}set isCollapsed(e){this._collapsed=e,this.save()}get showPreviews(){return this._previews}set showPreviews(e){this._previews=e,this.save()}get tileHeight(){return 44}get key(){return`mx_sublist_layout_${this.tagId}_boxed`}get visibleTiles(){return 0===this._n?this.defaultVisibleTiles:Math.max(this._n,this.minVisibleTiles)}set visibleTiles(e){this._n=e,this.save()}get minVisibleTiles(){return 1}get defaultVisibleTiles(){return 8}tilesWithPadding(e,t){return this.pixelsToTiles(this.tilesToPixelsWithPadding(e,t))}tilesToPixelsWithPadding(e,t){return this.tilesToPixels(e)+t}tilesToPixels(e){return e*this.tileHeight}pixelsToTiles(e){return e/this.tileHeight}reset(){localStorage.removeItem(this.key)}save(){localStorage.setItem(this.key,JSON.stringify(this.serialize()))}serialize(){return{numTiles:this.visibleTiles,showPreviews:this.showPreviews,collapsed:this.isCollapsed}}}var o=a(237),r=a(100);class l extends o.a{constructor(){super(r.a),s()(this,"layoutMap",new Map)}static get instance(){return l.internalInstance||(l.internalInstance=new l),l.internalInstance}ensureLayoutExists(e){this.layoutMap.has(e)||this.layoutMap.set(e,new i(e))}getLayoutFor(e){return this.layoutMap.has(e)||this.layoutMap.set(e,new i(e)),this.layoutMap.get(e)}async resetLayouts(){console.warn("Resetting layouts for room list");for(const e of this.layoutMap.values())e.reset()}async onNotReady(){this.layoutMap.clear()}async onAction(e){return Promise.resolve()}}s()(l,"internalInstance",void 0),window.mxRoomListLayoutStore=l.instance},639:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(8),s=a(257),i=a(0),o=a(1),r=a(140);function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.roomId=e,this.members={},this.events=new Map,this.paginationToken=null,this._sentinels={},this._updateModifiedTime(),this._displayNameToUserIds={},this._userIdsToDisplayNames={},this._tokenToInvite={},this._joinedMemberCount=null,this._summaryJoinedMemberCount=null,this._invitedMemberCount=null,this._summaryInvitedMemberCount=null,t||(t={status:1}),this._oobMemberFlags=t}function c(e,t,a){const n=e._userIdsToDisplayNames[t];if(delete e._userIdsToDisplayNames[t],n){const a=o.v(n),s=e._displayNameToUserIds[a];if(s){const n=s.filter(e=>e!==t);e._displayNameToUserIds[a]=n}}e._userIdsToDisplayNames[t]=a;const s=a&&o.v(a);s&&(e._displayNameToUserIds[s]||(e._displayNameToUserIds[s]=[]),e._displayNameToUserIds[s].push(t))}o.m(l,n.EventEmitter),l.prototype.getJoinedMemberCount=function(){return null!==this._summaryJoinedMemberCount?this._summaryJoinedMemberCount:(null===this._joinedMemberCount&&(this._joinedMemberCount=this.getMembers().reduce((e,t)=>"join"===t.membership?e+1:e,0)),this._joinedMemberCount)},l.prototype.setJoinedMemberCount=function(e){this._summaryJoinedMemberCount=e},l.prototype.getInvitedMemberCount=function(){return null!==this._summaryInvitedMemberCount?this._summaryInvitedMemberCount:(null===this._invitedMemberCount&&(this._invitedMemberCount=this.getMembers().reduce((e,t)=>"invite"===t.membership?e+1:e,0)),this._invitedMemberCount)},l.prototype.setInvitedMemberCount=function(e){this._summaryInvitedMemberCount=e},l.prototype.getMembers=function(){return Object.values(this.members)},l.prototype.getMembersExcept=function(e){return Object.values(this.members).filter(t=>!e.includes(t.userId))},l.prototype.getMember=function(e){return this.members[e]||null},l.prototype.getSentinelMember=function(e){if(!e)return null;let t=this._sentinels[e];if(void 0===t){t=new s.a(this.roomId,e);const a=this.members[e];a&&t.setMembershipEvent(a.events.member,this),this._sentinels[e]=t}return t},l.prototype.getStateEvents=function(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());const a=this.events.get(e).get(t);return a||null},l.prototype.clone=function(){const e=new l(this.roomId,this._oobMemberFlags),t=this._oobMemberFlags.status;return this._oobMemberFlags.status=1,Array.from(this.events.values()).forEach(t=>{e.setStateEvents(Array.from(t.values()))}),this._oobMemberFlags.status=t,null!==this._summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this._summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),3==this._oobMemberFlags.status&&this.getMembers().forEach(t=>{if(t.isOutOfBand()){e.getMember(t.userId).markOutOfBand()}}),e},l.prototype.setUnknownStateEvents=function(e){const t=e.filter(e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey()));this.setStateEvents(t)},l.prototype.setStateEvents=function(e){const t=this;this._updateModifiedTime(),e.forEach((function(e){if(e.getRoomId()!==t.roomId)return;if(!e.isState())return;const a=t._getStateEventMatching(e);t._setStateEvent(e),"m.room.member"===e.getType()&&(c(t,e.getStateKey(),e.getContent().displayname),function(e,t){if(!t.getContent().third_party_invite)return;const a=(t.getContent().third_party_invite.signed||{}).token;if(!a)return;if(!e.getStateEvents("m.room.third_party_invite",a))return;e._tokenToInvite[a]=t}(t,e)),t.emit("RoomState.events",e,t,a)})),e.forEach((function(e){if(e.getRoomId()===t.roomId&&e.isState())if("m.room.member"===e.getType()){const a=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);const n=t._getOrCreateMember(a,e);n.setMembershipEvent(e,t),t._updateMember(n),t.emit("RoomState.members",e,t,n)}else if("m.room.power_levels"===e.getType()){if(""!==e.getStateKey())return;Object.values(t.members).forEach((function(a){const n=a.getLastModifiedTime();a.setPowerLevelEvent(e),n!==a.getLastModifiedTime()&&t.emit("RoomState.members",e,t,a)})),t._sentinels={}}}))},l.prototype._getOrCreateMember=function(e,t){let a=this.members[e];return a||(a=new s.a(this.roomId,e),this.members[e]=a,this.emit("RoomState.newMember",t,this,a)),a},l.prototype._setStateEvent=function(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)},l.prototype._getStateEventMatching=function(e){return this.events.has(e.getType())?this.events.get(e.getType()).get(e.getStateKey()):null},l.prototype._updateMember=function(e){const t=this.getStateEvents("m.room.power_levels","");t&&e.setPowerLevelEvent(t),delete this._sentinels[e.userId],this.members[e.userId]=e,this._joinedMemberCount=null,this._invitedMemberCount=null},l.prototype.needsOutOfBandMembers=function(){return 1===this._oobMemberFlags.status},l.prototype.markOutOfBandMembersStarted=function(){1===this._oobMemberFlags.status&&(this._oobMemberFlags.status=2)},l.prototype.markOutOfBandMembersFailed=function(){2===this._oobMemberFlags.status&&(this._oobMemberFlags.status=1)},l.prototype.clearOutOfBandMembers=function(){let e=0;Object.keys(this.members).forEach(t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])}),i.a.log(`LL: RoomState removed ${e} members...`),this._oobMemberFlags.status=1},l.prototype.setOutOfBandMembers=function(e){i.a.log(`LL: RoomState about to set ${e.length} OOB members ...`),2===this._oobMemberFlags.status&&(i.a.log("LL: RoomState put in OOB_STATUS_FINISHED state ..."),this._oobMemberFlags.status=3,e.forEach(e=>this._setOutOfBandMember(e)))},l.prototype._setOutOfBandMember=function(e){if("m.room.member"!==e.getType())return;const t=e.getStateKey(),a=this.getMember(t);if(a&&!a.isOutOfBand())return;const n=this._getOrCreateMember(t,e);n.setMembershipEvent(e,this),n.markOutOfBand(),c(this,n.userId,n.name),this._setStateEvent(e),this._updateMember(n),this.emit("RoomState.members",e,this,n)},l.prototype.setTypingEvent=function(e){Object.values(this.members).forEach((function(t){t.setTypingEvent(e)}))},l.prototype.getInviteForThreePidToken=function(e){return this._tokenToInvite[e]||null},l.prototype._updateModifiedTime=function(){this._modified=Date.now()},l.prototype.getLastModifiedTime=function(){return this._modified},l.prototype.getUserIdsWithDisplayName=function(e){return this._displayNameToUserIds[o.v(e)]||[]},l.prototype.maySendRedactionForEvent=function(e,t){const a=this.getMember(t);if(!a||"leave"===a.membership)return!1;if(e.status||e.isRedacted())return!1;const n=this.maySendEvent("m.room.redaction",t);return e.getSender()===t?n:this._hasSufficientPowerLevelFor("redact",a.powerLevel)},l.prototype._hasSufficientPowerLevelFor=function(e,t){const a=this.getStateEvents("m.room.power_levels","");let n={};a&&(n=a.getContent());let s=50;return o.p(n[e])&&(s=n[e]),t>=s},l.prototype.maySendMessage=function(e){return this._maySendEventOfType("m.room.message",e,!1)},l.prototype.maySendEvent=function(e,t){return this._maySendEventOfType(e,t,!1)},l.prototype.mayClientSendStateEvent=function(e,t){return!t.isGuest()&&this.maySendStateEvent(e,t.credentials.userId)},l.prototype.maySendStateEvent=function(e,t){return this._maySendEventOfType(e,t,!0)},l.prototype._maySendEventOfType=function(e,t,a){const n=this.getStateEvents("m.room.power_levels","");let s,i={},o=0,r=0,l=0;if(n){s=n.getContent(),i=s.events||{},o=Number.isFinite(s.state_default)?s.state_default:50;const e=s.users&&s.users[t];Number.isFinite(e)?l=e:Number.isFinite(s.users_default)&&(l=s.users_default),Number.isFinite(s.events_default)&&(r=s.events_default)}let c=a?o:r;return Number.isFinite(i[e])&&(c=i[e]),l>=c},l.prototype.mayTriggerNotifOfType=function(e,t){const a=this.getMember(t);if(!a)return!1;const n=this.getStateEvents("m.room.power_levels","");let s=50;return n&&n.getContent()&&n.getContent().notifications&&o.p(n.getContent().notifications[e])&&(s=n.getContent().notifications[e]),a.powerLevel>=s},l.prototype.getJoinRule=function(){const e=this.getStateEvents(r.a.RoomJoinRules,"");return(e?e.getContent():{}).join_rule||"invite"}},739:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(19),s=a.n(n);class i{get action(){return"NOT_USED"}constructor(e){s()(this,"fn",void 0),this.fn=e}}},740:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(739);function s(e,t,a){return new n.a(n=>{n({action:e+".pending",request:"function"==typeof a?a():void 0}),t().then(t=>{n({action:e+".success",result:t})}).catch(t=>{n({action:e+".failure",err:t})})})}},744:function(e,t,a){"use strict";function n(e,t){return e.size!==t.size||(!!Array.from(t).some(t=>!e.has(t))||!!Array.from(e).some(e=>!t.has(e)))}a.d(t,"a",(function(){return n}))},745:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return i}));const n=new Map;function s(e,t){n.set(e,t)}function i(e){return n.get(e)}},766:function(e,t){},767:function(e,t){},773:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i}));var n=a(93);function s(e){return{undefined:Object(n.a)("Default"),0:Object(n.a)("Restricted"),[e]:Object(n.a)("Default"),50:Object(n.a)("Moderator"),100:Object(n.a)("Admin")}}function i(e,t){const a=s(t);return a[e]?a[e]:Object(n.a)("Custom (%(level)s)",{level:e})}},774:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(1);a(0);function s(e,t){this.retryAlgorithm=e||s.RETRY_BACKOFF_RATELIMIT,this.queueAlgorithm=t||s.QUEUE_MESSAGES,this._queues={},this._activeQueues=[],this._procFn=null}function i(e){e._procFn&&Object.keys(e._queues).filter((function(t){return-1===e._activeQueues.indexOf(t)&&e._queues[t].length>0})).forEach((function(t){e._activeQueues.push(t),r("Spinning up queue: '%s'",t),function e(t,a){const n=function(e,t){const a=e._queues[t];if(!Array.isArray(a))return null;return a[0]}(t,a);if(!n){const e=t._activeQueues.indexOf(a);return e>=0&&t._activeQueues.splice(e,1),void r("Stopping queue '%s' as it is now empty",a)}r("Queue '%s' has %s pending events",a,t._queues[a].length),Promise.resolve().then(()=>t._procFn(n.event)).then((function(s){o(t,a),r("Queue '%s' sent event %s",a,n.event.getId()),n.defer.resolve(s),e(t,a)}),(function(s){n.attempts+=1;const i=t.retryAlgorithm(n.event,n.attempts,s);r("retry(%s) err=%s event_id=%s waitTime=%s",n.attempts,s,n.event.getId(),i),-1===i?(r("Queue '%s' giving up on event %s",a,n.event.getId()),o(t,a),n.defer.reject(s),e(t,a)):setTimeout((function(){e(t,a)}),i)}))}(e,t)}))}function o(e,t){const a=e._queues[t];return Array.isArray(a)?a.shift():null}function r(){0}s.prototype.getQueueForEvent=function(e){const t=this.queueAlgorithm(e);return t&&this._queues[t]?this._queues[t].map((function(e){return e.event})):null},s.prototype.removeEventFromQueue=function(e){const t=this.queueAlgorithm(e);if(!t||!this._queues[t])return!1;let a=!1;return n.u(this._queues[t],(function(t){if(t.event.getId()===e.getId())return a=!0,!0})),a},s.prototype.setProcessFunction=function(e){this._procFn=e,i(this)},s.prototype.queueEvent=function(e){const t=this.queueAlgorithm(e);if(!t)return null;this._queues[t]||(this._queues[t]=[]);const a=n.e();return this._queues[t].push({event:e,defer:a,attempts:0}),r("Queue algorithm dumped event %s into queue '%s'",e.getId(),t),i(this),a.promise},s.RETRY_BACKOFF_RATELIMIT=function(e,t,a){if(400===a.httpStatus||403===a.httpStatus||401===a.httpStatus)return-1;if("rejected"===a.cors)return-1;if("M_TOO_LARGE"===a.name)return-1;if("M_LIMIT_EXCEEDED"===a.name){const e=a.data.retry_after_ms;if(e>0)return e}return t>4?-1:1e3*Math.pow(2,t)},s.QUEUE_MESSAGES=function(e){return"m.room.message"===e.getType()||e.hasAssocation()?"message":null}},775:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(258),s=a.n(n);class i{constructor(e){s()(this,"target",void 0),this.target=e}reEmit(e,t){var a=this;for(const n of t){const t=function(){if("error"!==n||0!==a.target.listenerCount("error")){for(var t=arguments.length,s=new Array(t),i=0;i<t;i++)s[i]=arguments[i];a.target.emit(n,...s,e)}};e.on(n,t)}}}},776:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o}));var n=a(8),s=a.n(n);let i;!function(e){e.NewStream="new_stream"}(i||(i={}));class o extends s.a{constructor(e,t,a,n,s){super(),this.stream=e,this.userId=t,this.purpose=a,this.client=n,this.roomId=s}getMember(){return this.client.getRoom(this.roomId).getMember(this.userId)}isLocal(){return this.userId===this.client.getUserId()}isAudioMuted(){return 0===this.stream.getAudioTracks().length}isVideoMuted(){return 0===this.stream.getVideoTracks().length}setNewStream(e){this.stream=e,this.emit(i.NewStream,this.stream)}}},777:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return m}));var n=a(146),s=a(8),i=a(0),o=a(585),r=a(488),l=a(586);const c=new Error("Verification timed out");class d extends Error{constructor(e){super(),this.startEvent=e}}class m extends s.EventEmitter{constructor(e,t,a,n,s,i){super(),this._channel=e,this._baseApis=t,this.userId=a,this.deviceId=n,this.startEvent=s,this.request=i,this.cancelled=!1,this._done=!1,this._promise=null,this._transactionTimeoutTimer=null}get initiatedByMe(){if(!this.startEvent)return!0;const e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this._baseApis.getUserId()&&t.from_device===this._baseApis.getDeviceId()}_resetTimer(){i.a.info("Refreshing/starting the verification transaction timeout timer"),null!==this._transactionTimeoutTimer&&clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=setTimeout(()=>{this._done||this.cancelled||(i.a.info("Triggering verification timeout"),this.cancel(c))},6e5)}_endTimer(){null!==this._transactionTimeoutTimer&&(clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=null)}_send(e,t){return this._channel.send(e,t)}_waitForEvent(e){if(this._done)return Promise.reject(new Error("Verification is already done"));const t=this.request.getEventFromOtherParty(e);return t?Promise.resolve(t):(this._expectedEvent=e,new Promise((e,t)=>{this._resolveEvent=e,this._rejectEvent=t}))}canSwitchStartEvent(){return!1}switchStartEvent(e){if(this.canSwitchStartEvent(e))if(i.a.log("Verification Base: switching verification start event",{restartingFlow:!!this._rejectEvent}),this._rejectEvent){const t=this._rejectEvent;this._rejectEvent=void 0,t(new d(e))}else this.startEvent=e}handleEvent(e){if(!this._done)if(e.getType()===this._expectedEvent)"m.key.verification.done"!==this._expectedEvent&&(this._expectedEvent=void 0,this._rejectEvent=void 0,this._resetTimer(),this._resolveEvent(e));else if("m.key.verification.cancel"===e.getType()){const t=this._reject;if(this._reject=void 0,t){const a=e.getContent(),{reason:n,code:s}=a;t(new Error(`Other side cancelled verification because ${n} (${s})`))}}else if(this._expectedEvent){const t=new Error("Unexpected message: expecting "+this._expectedEvent+" but got "+e.getType());if(this._expectedEvent=void 0,this._rejectEvent){const e=this._rejectEvent;this._rejectEvent=void 0,e(t)}this.cancel(t)}}done(){if(this._endTimer(),!this._done)return this.request.onVerifierFinished(),this._resolve(),Object(l.e)(this._baseApis,this.userId,this.deviceId)}cancel(e){if(this._endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===c){const e=Object(r.e)();this._send(e.getType(),e.getContent())}else if(e instanceof n.b){if(e.getSender()!==this.userId){const t=e.getContent();"m.key.verification.cancel"===e.getType()?(t.code=t.code||"m.unknown",t.reason=t.reason||t.body||"Unknown reason",this._send("m.key.verification.cancel",t)):this._send("m.key.verification.cancel",{code:"m.unknown",reason:t.body||"Unknown reason"})}}else this._send("m.key.verification.cancel",{code:"m.unknown",reason:e.toString()});null!==this._promise?this._reject&&this._reject(e):this._promise=Promise.reject(e),this.emit("cancel",e)}}verify(){var e=this;return this._promise||(this._promise=new Promise((t,a)=>{this._resolve=function(){e._done=!0,e._endTimer(),t(...arguments)},this._reject=function(){e._done=!0,e._endTimer(),a(...arguments)}}),this._doVerification&&!this._started&&(this._started=!0,this._resetTimer(),Promise.resolve(this._doVerification()).then(this.done.bind(this),this.cancel.bind(this)))),this._promise}async _verifyKeys(e,t,a){const n=[];for(const[s,r]of Object.entries(t)){const t=s.split(":",2)[1],l=this._baseApis.getStoredDevice(e,t);if(l)await a(s,l,r),n.push(t);else{const l=this._baseApis.crypto._deviceList.getStoredCrossSigningForUser(e);l&&l.getId()===t?(await a(s,o.a.fromStorage({keys:{[s]:t}},t),r),n.push(t)):i.a.warn(`verification: Could not find device ${t} to verify`)}}if(!n.length)throw new Error("No devices could be verified");i.a.info("Verification completed! Marking devices verified: ",n);for(const t of n)await this._baseApis.setDeviceVerified(e,t)}}},778:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o}));var n=a(256);a(0);const s=function(){};function i(e,t,a){a=a||{},this._client=e,this._timelineSet=t,this._start=null,this._end=null,this._eventCount=0,this._windowLimit=a.windowLimit||1e3}function o(e,t){this.timeline=e,this.index=t}i.prototype.load=function(e,t){const a=this;t=t||20;const n=function(n){let s;const i=n.getEvents();if(e){for(let t=0;t<i.length;t++)if(i[t].getId()==e){s=t;break}if(void 0===s)throw new Error("getEventTimeline result didn't include requested event")}else s=i.length;const r=Math.min(i.length,s+Math.ceil(t/2)),l=Math.max(0,r-t);a._start=new o(n,l-n.getBaseIndex()),a._end=new o(n,r-n.getBaseIndex()),a._eventCount=r-l};if(e){const t=this._timelineSet.getTimelineForEvent(e);if(t)return n(t),Promise.resolve(t);return this._client.getEventTimeline(this._timelineSet,e).then(n)}return n(this._timelineSet.getLiveTimeline()),Promise.resolve()},i.prototype.getTimelineIndex=function(e){if(e==n.a.BACKWARDS)return this._start;if(e==n.a.FORWARDS)return this._end;throw new Error("Invalid direction '"+e+"'")},i.prototype.extend=function(e,t){const a=this.getTimelineIndex(e);if(!a)return s("TimelineWindow: no timeline yet"),!1;const i=e==n.a.BACKWARDS?a.retreat(t):a.advance(t);if(i){this._eventCount+=i,s("TimelineWindow: increased cap by "+i+" (now "+this._eventCount+")");const t=this._eventCount-this._windowLimit;return t>0&&this.unpaginate(t,e!=n.a.BACKWARDS),!0}return!1},i.prototype.canPaginate=function(e){const t=this.getTimelineIndex(e);if(!t)return s("TimelineWindow: no timeline yet"),!1;if(e==n.a.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;return Boolean(t.timeline.getNeighbouringTimeline(e)||t.timeline.getPaginationToken(e))},i.prototype.paginate=function(e,t,a,i){void 0===a&&(a=!0),void 0===i&&(i=5);const o=this.getTimelineIndex(e);if(!o)return s("TimelineWindow: no timeline yet"),Promise.resolve(!1);if(o.pendingPaginate)return o.pendingPaginate;if(this.extend(e,t))return Promise.resolve(!0);if(!a||0===i)return Promise.resolve(!1);if(!o.timeline.getPaginationToken(e))return s("TimelineWindow: no token"),Promise.resolve(!1);s("TimelineWindow: starting request");const r=this,l=this._client.paginateEventTimeline(o.timeline,{backwards:e==n.a.BACKWARDS,limit:t}).finally((function(){o.pendingPaginate=null})).then((function(a){return s("TimelineWindow: request completed with result "+a),!!a&&r.paginate(e,t,!0,i-1)}));return o.pendingPaginate=l,l},i.prototype.unpaginate=function(e,t){const a=t?this._start:this._end;if(e>this._eventCount||e<0)throw new Error("Attemting to unpaginate "+e+" events, but only have "+this._eventCount+" in the timeline");for(;e>0;){const n=t?a.advance(e):a.retreat(e);if(n<=0)throw new Error("Unable to unpaginate any further, but still have "+this._eventCount+" events");e-=n,this._eventCount-=n,s("TimelineWindow.unpaginate: dropped "+n+" (now "+this._eventCount+")")}},i.prototype.getEvents=function(){if(!this._start)return[];const e=[];let t=this._start.timeline;for(;;){const a=t.getEvents();let s=0,i=a.length;t===this._start.timeline&&(s=this._start.index+t.getBaseIndex()),t===this._end.timeline&&(i=this._end.index+t.getBaseIndex());for(let t=s;t<i;t++)e.push(a[t]);if(t===this._end.timeline)break;t=t.getNeighbouringTimeline(n.a.FORWARDS)}return e},o.prototype.minIndex=function(){return-1*this.timeline.getBaseIndex()},o.prototype.maxIndex=function(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()},o.prototype.advance=function(e){if(!e)return 0;let t;if(e<0){if(t=Math.max(e,this.minIndex()-this.index),t<0)return this.index+=t,t}else if(t=Math.min(e,this.maxIndex()-this.index),t>0)return this.index+=t,t;const a=this.timeline.getNeighbouringTimeline(e<0?n.a.BACKWARDS:n.a.FORWARDS);return a?(this.timeline=a,this.index=e<0?this.maxIndex():this.minIndex(),s("paginate: switched to new neighbour"),this.advance(e)):0},o.prototype.retreat=function(e){return-1*this.advance(-1*e)}},779:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(223),s=a.n(n),i=a(1),o=a(0);function r(e){this._matrixClient=e.matrixClient,this._data=e.authData||{},this._requestCallback=e.doRequest,this._busyChangedCallback=e.busyChanged,this._stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this._resolveFunc=null,this._rejectFunc=null,this._inputs=e.inputs||{},this._requestEmailTokenCallback=e.requestEmailToken,e.sessionId&&(this._data.session=e.sessionId),this._clientSecret=e.clientSecret||this._matrixClient.generateClientSecret(),this._emailSid=e.emailSid,void 0===this._emailSid&&(this._emailSid=null),this._requestingEmailToken=!1,this._chosenFlow=null,this._currentStage=null,this._submitPromise=null}r.prototype={attemptAuth:function(){return new Promise((e,t)=>{this._resolveFunc=e,this._rejectFunc=t;if(this._data&&this._data.flows)this._startNextAuthStage();else{this._busyChangedCallback&&this._busyChangedCallback(!0);let e=null;this._data.session&&(e={session:this._data.session}),this._doRequest(e).finally(()=>{this._busyChangedCallback&&this._busyChangedCallback(!1)})}})},poll:async function(){if(!this._data.session)return;if(!this._resolveFunc)return;if(this._submitPromise)return;let e={};if("m.login.email.identity"==this._currentStage&&this._emailSid){const t={sid:this._emailSid,client_secret:this._clientSecret};if(await this._matrixClient.doesServerRequireIdServerParam()){const e=s.a.parse(this._matrixClient.getIdentityServerUrl());t.id_server=e.host}e={type:"m.login.email.identity",threepid_creds:t,threepidCreds:t}}this.submitAuthDict(e,!0)},getSessionId:function(){return this._data?this._data.session:void 0},getClientSecret:function(){return this._clientSecret},getStageParams:function(e){let t={};return this._data&&this._data.params&&(t=this._data.params),t[e]},getChosenFlow(){return this._chosenFlow},submitAuthDict:async function(e,t){if(!this._resolveFunc)throw new Error("submitAuthDict() called before attemptAuth()");for(!t&&this._busyChangedCallback&&this._busyChangedCallback(!0);this._submitPromise;)try{await this._submitPromise}catch(e){}let a;this._data.session?(a={session:this._data.session},i.j(a,e)):a=e;try{this._submitPromise=this._doRequest(a,t),await this._submitPromise}finally{this._submitPromise=null,!t&&this._busyChangedCallback&&this._busyChangedCallback(!1)}},getEmailSid:function(){return this._emailSid},setEmailSid:function(e){this._emailSid=e},_doRequest:async function(e,t){try{const a=await this._requestCallback(e,t);this._resolveFunc(a),this._resolveFunc=null,this._rejectFunc=null}catch(e){const a=e.data?e.data.flows:null,n=this._data.flows||Boolean(a);401===e.httpStatus&&e.data&&n||(t?o.a.log("Background poll request failed doing UI auth: ignoring",e):this._rejectFunc(e)),e.data.flows||e.data.completed||e.data.session||(e.data.flows=this._data.flows,e.data.completed=this._data.completed,e.data.session=this._data.session),this._data=e.data;try{this._startNextAuthStage()}catch(e){this._rejectFunc(e),this._resolveFunc=null,this._rejectFunc=null}if(!this._emailSid&&!this._requestingEmailToken&&this._chosenFlow.stages.includes("m.login.email.identity")){this._requestingEmailToken=!0;try{const e=await this._requestEmailTokenCallback(this._inputs.emailAddress,this._clientSecret,1,this._data.session);this._emailSid=e.sid}catch(e){this._rejectFunc(e),this._resolveFunc=null,this._rejectFunc=null}finally{this._requestingEmailToken=!1}}}},_startNextAuthStage:function(){const e=this._chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this._currentStage=e,"m.login.dummy"===e)return void this.submitAuthDict({type:"m.login.dummy"});if(this._data&&this._data.errcode||this._data.error)return void this._stateUpdatedCallback(e,{errcode:this._data.errcode||"",error:this._data.error||""});const t={};"m.login.email.identity"==e&&(t.emailSid=this._emailSid),this._stateUpdatedCallback(e,t)},_chooseStage:function(){null===this._chosenFlow&&(this._chosenFlow=this._chooseFlow()),o.a.log("Active flow => %s",JSON.stringify(this._chosenFlow));const e=this._firstUncompletedStage(this._chosenFlow);return o.a.log("Next stage: %s",e),e},_chooseFlow:function(){const e=this._data.flows||[],t=Boolean(this._inputs.emailAddress)||Boolean(this._emailSid),a=Boolean(this._inputs.phoneCountry)&&Boolean(this._inputs.phoneNumber);for(const n of e){let e=!1,s=!1;for(const t of n.stages)"m.login.email.identity"===t?e=!0:"m.login.msisdn"==t&&(s=!0);if(e==t&&s==a)return n}const n=new Error("No appropriate authentication flow found");throw n.name="NoAuthFlowFoundError",n.required_stages=[],t&&n.required_stages.push("m.login.email.identity"),a&&n.required_stages.push("m.login.msisdn"),n.available_flows=e,n},_firstUncompletedStage:function(e){const t=(this._data||{}).completed||[];for(let a=0;a<e.stages.length;++a){const n=e.stages[a];if(-1===t.indexOf(n))return n}}}},780:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(1);a(0);const s="session.e2e.";function i(e){if(this.store=e,!(n.n(e.getItem)&&n.n(e.setItem)&&n.n(e.removeItem)&&n.n(e.key)&&"number"==typeof e.length))throw new Error("Supplied webStore does not meet the WebStorage API interface")}i.prototype={removeEndToEndAccount:function(){this.store.removeItem(o)},getEndToEndAccount:function(){return this.store.getItem(o)},getAllEndToEndDevices:function(){const e=d(""),t={};for(let a=0;a<this.store.length;++a){const n=this.store.key(a),s=n.substr(e.length);n.startsWith(e)&&(t[s]=h(this.store,n))}return t},getEndToEndDeviceTrackingStatus:function(){return h(this.store,l)},getEndToEndDeviceSyncToken:function(){return h(this.store,r)},removeEndToEndDeviceData:function(){g(this.store,d("")),g(this.store,l),g(this.store,r)},getEndToEndSessions:function(e){return h(this.store,m(e))},getAllEndToEndSessions:function(){const e=p(this.store,m("")),t={};for(const a of e){t[a.substr(m("").length)]=h(this.store,a)}return t},removeAllEndToEndSessions:function(){g(this.store,m(""))},getAllEndToEndInboundGroupSessionKeys:function(){const e=s+"inboundgroupsessions/",t=[];for(let a=0;a<this.store.length;a++){const n=this.store.key(a);n.startsWith(e)&&t.push({senderKey:n.substr(e.length,43),sessionId:n.substr(e.length+44)})}return t},getEndToEndInboundGroupSession:function(e,t){const a=function(e,t){return s+"inboundgroupsessions/"+e+"/"+t}(e,t);return this.store.getItem(a)},removeAllEndToEndInboundGroupSessions:function(){g(this.store,s+"inboundgroupsessions/")},getAllEndToEndRooms:function(){const e=p(this.store,u("")),t={};for(const a of e){t[a.substr(u("").length)]=h(this.store,a)}return t},removeAllEndToEndRooms:function(){g(this.store,u(""))},setLocalTrustedBackupPubKey:function(e){this.store.setItem(c,e)},getLocalTrustedBackupPubKey:function(){return this.store.getItem(c)}};const o=s+"account",r=s+"device_sync_token",l=s+"device_tracking",c=s+"trusted_backup_pubkey";function d(e){return s+"devices/"+e}function m(e){return s+"sessions/"+e}function u(e){return s+"rooms/"+e}function h(e,t){try{return JSON.parse(e.getItem(t))}catch(e){f("Failed to get key %s: %s",t,e),f(e.stack)}return null}function p(e,t){const a=[];for(let n=0;n<e.length;++n){const s=e.key(n);s.startsWith(t)&&a.push(s)}return a}function g(e,t){const a=[];for(let n=0;n<e.length;++n){const s=e.key(n);s.startsWith(t)&&a.push(s)}for(const t of a)e.removeItem(t)}function f(){0}},788:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(110),o=a(99);class r{constructor(){s()(this,"domain",void 0),s()(this,"update",async e=>{let t=(i.a.get().jitsi||{}).preferredDomain||"jitsi.riot.im";if(console.log("Attempting to get Jitsi conference information from homeserver"),e&&e["im.vector.riot.jitsi"]){const a=e["im.vector.riot.jitsi"].preferredDomain;a&&(t=a)}this.domain=t,console.log("Jitsi conference domain:",this.preferredDomain)})}get preferredDomain(){return this.domain||"jitsi.riot.im"}async getJitsiAuth(){if(!this.preferredDomain)return null;let e;try{const t=await fetch(`https://${this.preferredDomain}/.well-known/element/jitsi`);e=await t.json()}catch(e){return null}return e.auth?e.auth:null}start(){const e=o.a.get();e.on("WellKnown.client",this.update),this.update(e.getClientWellKnown())}parsePreferredConferenceUrl(e){const t=new URL(e);return t.hostname!==this.preferredDomain?null:{conferenceId:t.pathname,domain:t.hostname,isAudioOnly:!1}}static getInstance(){return r.instance||(r.instance=new r),r.instance}}s()(r,"instance",void 0)},793:function(e,t,a){"use strict";a.d(t,"a",(function(){return C})),a.d(t,"b",(function(){return A}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(97),c=a(794),d=a(93),m=a(144),u=a(119),h=a(193),p=a(364),g=a(299),f=a(142),v=a(1540),b=a(103),y=a(106),E=a(186),_=a(94);class S extends r.a.PureComponent{constructor(){super(...arguments),i()(this,"onBack",()=>{this.state.message?this.setState({message:null}):this.props.onBack()}),i()(this,"onChange",e=>{this.setState({[e.target.id]:"checkbox"===e.target.type?e.target.checked:e.target.value})})}buttons(){return r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back")),!this.state.message&&r.a.createElement("button",{onClick:this.send},Object(d.a)("Send")))}textInput(e,t){return r.a.createElement(m.a,{id:e,label:t,size:42,autoFocus:!0,type:"text",autoComplete:"on",value:this.state[e],onChange:this.onChange})}}class C extends S{static getLabel(){return Object(d.a)("Send Custom Event")}constructor(e){super(e),i()(this,"send",async()=>{if(""===this.state.eventType)return void this.setState({message:Object(d.a)("You must specify an event type!")});let e;try{const t=JSON.parse(this.state.evContent);await this.doSend(t),e=Object(d.a)("Event sent!")}catch(t){e=Object(d.a)("Failed to send custom event.")+" ("+t.toString()+")"}this.setState({message:e})});const{eventType:t,stateKey:a,evContent:n}=Object.assign({eventType:"",stateKey:"",evContent:"{\n\n}"},this.props.inputs);this.state={isStateEvent:Boolean(this.props.forceStateEvent),eventType:t,stateKey:a,evContent:n}}doSend(e){const t=this.context;return this.state.isStateEvent?t.sendStateEvent(this.props.room.roomId,this.state.eventType,e,this.state.stateKey):t.sendEvent(this.props.room.roomId,this.state.eventType,e)}render(){if(this.state.message)return r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content"},this.state.message),this.buttons());const e=!this.state.message&&!this.props.forceStateEvent&&!this.props.forceGeneralEvent;return r.a.createElement("div",null,r.a.createElement("div",{className:"mx_DevTools_content"},r.a.createElement("div",{className:"mx_DevTools_eventTypeStateKeyGroup"},this.textInput("eventType",Object(d.a)("Event Type")),this.state.isStateEvent&&this.textInput("stateKey",Object(d.a)("State Key"))),r.a.createElement("br",null),r.a.createElement(m.a,{id:"evContent",label:Object(d.a)("Event Content"),type:"text",className:"mx_DevTools_textarea",autoComplete:"off",value:this.state.evContent,onChange:this.onChange,element:"textarea"})),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back")),!this.state.message&&r.a.createElement("button",{onClick:this.send},Object(d.a)("Send")),e&&r.a.createElement("div",{style:{float:"right"}},r.a.createElement("input",{id:"isStateEvent",className:"mx_DevTools_tgl mx_DevTools_tgl-flip",type:"checkbox",checked:this.state.isStateEvent,onChange:this.onChange}),r.a.createElement("label",{className:"mx_DevTools_tgl-btn","data-tg-off":"Event","data-tg-on":"State Event",htmlFor:"isStateEvent"}))))}}i()(C,"contextType",u.a);class w extends S{static getLabel(){return Object(d.a)("Send Account Data")}constructor(e){super(e),i()(this,"send",async()=>{if(""===this.state.eventType)return void this.setState({message:Object(d.a)("You must specify an event type!")});let e;try{const t=JSON.parse(this.state.evContent);await this.doSend(t),e=Object(d.a)("Event sent!")}catch(t){e=Object(d.a)("Failed to send custom event.")+" ("+t.toString()+")"}this.setState({message:e})});const{eventType:t,evContent:a}=Object.assign({eventType:"",evContent:"{\n\n}"},this.props.inputs);this.state={isRoomAccountData:Boolean(this.props.isRoomAccountData),eventType:t,evContent:a}}doSend(e){const t=this.context;return this.state.isRoomAccountData?t.setRoomAccountData(this.props.room.roomId,this.state.eventType,e):t.setAccountData(this.state.eventType,e)}render(){return this.state.message?r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content"},this.state.message),this.buttons()):r.a.createElement("div",null,r.a.createElement("div",{className:"mx_DevTools_content"},this.textInput("eventType",Object(d.a)("Event Type")),r.a.createElement("br",null),r.a.createElement(m.a,{id:"evContent",label:Object(d.a)("Event Content"),type:"text",className:"mx_DevTools_textarea",autoComplete:"off",value:this.state.evContent,onChange:this.onChange,element:"textarea"})),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back")),!this.state.message&&r.a.createElement("button",{onClick:this.send},Object(d.a)("Send")),!this.state.message&&r.a.createElement("div",{style:{float:"right"}},r.a.createElement("input",{id:"isRoomAccountData",className:"mx_DevTools_tgl mx_DevTools_tgl-flip",type:"checkbox",checked:this.state.isRoomAccountData,disabled:this.props.forceMode,onChange:this.onChange}),r.a.createElement("label",{className:"mx_DevTools_tgl-btn","data-tg-off":"Account Data","data-tg-on":"Room Data",htmlFor:"isRoomAccountData"}))))}}i()(w,"contextType",u.a);class O extends r.a.PureComponent{static filterChildren(e,t){if(!t)return e;const a=t.toLowerCase();return e.filter(e=>e.key.toString().toLowerCase().includes(a))}constructor(e){super(e),i()(this,"showAll",()=>{this.setState({truncateAt:this.state.truncateAt+50})}),i()(this,"createOverflowElement",(e,t)=>r.a.createElement("button",{className:"mx_DevTools_RoomStateExplorer_button",onClick:this.showAll},Object(d.a)("and %(count)s others...",{count:e}))),i()(this,"onQuery",e=>{this.props.onChange&&this.props.onChange(e.target.value)}),i()(this,"getChildren",(e,t)=>this.state.filteredChildren.slice(e,t)),i()(this,"getChildCount",()=>this.state.filteredChildren.length),this.state={filteredChildren:O.filterChildren(this.props.children,this.props.query),truncateAt:20}}UNSAFE_componentWillReceiveProps(e){this.props.children===e.children&&this.props.query===e.query||this.setState({filteredChildren:O.filterChildren(e.children,e.query),truncateAt:20})}render(){const e=l.getComponent("elements.TruncatedList");return r.a.createElement("div",null,r.a.createElement(m.a,{label:Object(d.a)("Filter results"),autoFocus:!0,size:64,type:"text",autoComplete:"off",value:this.props.query,onChange:this.onQuery,className:"mx_TextInputDialog_input mx_DevTools_RoomStateExplorer_query",key:this.props.children[0]?this.props.children[0].key:""}),r.a.createElement(e,{getChildren:this.getChildren,getChildCount:this.getChildCount,truncateAt:this.state.truncateAt,createOverflowElement:this.createOverflowElement}))}}class x extends r.a.PureComponent{static getLabel(){return Object(d.a)("Explore Room State")}constructor(e){super(e),i()(this,"roomStateEvents",void 0),i()(this,"onBack",()=>{this.state.editing?this.setState({editing:!1}):this.state.event?this.setState({event:null}):this.state.eventType?this.setState({eventType:null}):this.props.onBack()}),i()(this,"editEv",()=>{this.setState({editing:!0})}),i()(this,"onQueryEventType",e=>{this.setState({queryEventType:e})}),i()(this,"onQueryStateKey",e=>{this.setState({queryStateKey:e})}),this.roomStateEvents=this.props.room.currentState.events,this.state={eventType:null,event:null,editing:!1,queryEventType:"",queryStateKey:""}}browseEventType(e){return()=>{this.setState({eventType:e})}}onViewSourceClick(e){return()=>{this.setState({event:e})}}render(){if(this.state.event)return this.state.editing?r.a.createElement(C,{room:this.props.room,forceStateEvent:!0,onBack:this.onBack,inputs:{eventType:this.state.event.getType(),evContent:JSON.stringify(this.state.event.getContent(),null,"\t"),stateKey:this.state.event.getStateKey()}}):r.a.createElement("div",{className:"mx_ViewSource"},r.a.createElement("div",{className:"mx_Dialog_content"},r.a.createElement(c.a,{className:"json"},JSON.stringify(this.state.event.event,null,2))),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back")),r.a.createElement("button",{onClick:this.editEv},Object(d.a)("Edit"))));let e=null;const t="mx_DevTools_RoomStateExplorer_button";if(null===this.state.eventType)e=r.a.createElement(O,{query:this.state.queryEventType,onChange:this.onQueryEventType},Array.from(this.roomStateEvents.entries()).map(e=>{let a,[n,s]=e;return a=1===s.size&&s.has("")?this.onViewSourceClick(s.get("")):this.browseEventType(n),r.a.createElement("button",{className:t,key:n,onClick:a},n)}));else{const a=this.roomStateEvents.get(this.state.eventType);e=r.a.createElement(O,{query:this.state.queryStateKey,onChange:this.onQueryStateKey},Array.from(a.entries()).map(e=>{let[a,n]=e;return r.a.createElement("button",{className:t,key:a,onClick:this.onViewSourceClick(n)},a)}))}return r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content"},e),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back"))))}}i()(x,"contextType",u.a);class R extends r.a.PureComponent{static getLabel(){return Object(d.a)("Explore Account Data")}constructor(e){super(e),i()(this,"onBack",()=>{this.state.editing?this.setState({editing:!1}):this.state.event?this.setState({event:null}):this.props.onBack()}),i()(this,"onChange",e=>{this.setState({[e.target.id]:"checkbox"===e.target.type?e.target.checked:e.target.value})}),i()(this,"editEv",()=>{this.setState({editing:!0})}),i()(this,"onQueryEventType",e=>{this.setState({queryEventType:e})}),this.state={isRoomAccountData:!1,event:null,editing:!1,queryEventType:""}}getData(){return this.state.isRoomAccountData?this.props.room.accountData:this.context.store.accountData}onViewSourceClick(e){return()=>{this.setState({event:e})}}render(){if(this.state.event)return this.state.editing?r.a.createElement(w,{room:this.props.room,isRoomAccountData:this.state.isRoomAccountData,onBack:this.onBack,inputs:{eventType:this.state.event.getType(),evContent:JSON.stringify(this.state.event.getContent(),null,"\t")},forceMode:!0}):r.a.createElement("div",{className:"mx_ViewSource"},r.a.createElement("div",{className:"mx_DevTools_content"},r.a.createElement(c.a,{className:"json"},JSON.stringify(this.state.event.event,null,2))),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back")),r.a.createElement("button",{onClick:this.editEv},Object(d.a)("Edit"))));const e=[],t=this.getData();return Object.keys(t).forEach(a=>{const n=t[a];e.push(r.a.createElement("button",{className:"mx_DevTools_RoomStateExplorer_button",key:a,onClick:this.onViewSourceClick(n)},a))}),r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content"},r.a.createElement(O,{query:this.state.queryEventType,onChange:this.onQueryEventType},e)),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back")),r.a.createElement("div",{style:{float:"right"}},r.a.createElement("input",{id:"isRoomAccountData",className:"mx_DevTools_tgl mx_DevTools_tgl-flip",type:"checkbox",checked:this.state.isRoomAccountData,onChange:this.onChange}),r.a.createElement("label",{className:"mx_DevTools_tgl-btn","data-tg-off":"Account Data","data-tg-on":"Room Data",htmlFor:"isRoomAccountData"}))))}}i()(R,"contextType",u.a);class k extends r.a.PureComponent{static getLabel(){return Object(d.a)("View Servers in Room")}constructor(e){super(e),i()(this,"servers",void 0),i()(this,"onQuery",e=>{this.setState({query:e})});const t=this.props.room,a=new Set;t.currentState.getStateEvents("m.room.member").forEach(e=>a.add(e.getSender().split(":")[1])),this.servers=Array.from(a).map(e=>r.a.createElement("button",{key:e,className:"mx_DevTools_ServersInRoomList_button"},e)),this.state={query:""}}render(){return r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content"},r.a.createElement(O,{query:this.state.query,onChange:this.onQuery},this.servers)),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.props.onBack},Object(d.a)("Back"))))}}i()(k,"contextType",u.a);const I={[p.g]:"unsent",[p.e]:"requested",[p.d]:"ready",[p.c]:"done",[p.f]:"started",[p.b]:"cancelled"},T=e=>{let{txnId:t,request:a}=e;const[,n]=Object(o.useState)(),[s,i]=Object(o.useState)(a.timeout);return Object(h.a)(a,"change",n),Object(o.useEffect)(()=>{if(0==a.timeout)return;const e=setInterval(()=>{i(a.timeout)},500);return()=>{clearInterval(e)}},[a]),r.a.createElement("div",{className:"mx_DevTools_VerificationRequest"},r.a.createElement("dl",null,r.a.createElement("dt",null,"Transaction"),r.a.createElement("dd",null,t),r.a.createElement("dt",null,"Phase"),r.a.createElement("dd",null,I[a.phase]||a.phase),r.a.createElement("dt",null,"Timeout"),r.a.createElement("dd",null,Math.floor(s/1e3)),r.a.createElement("dt",null,"Methods"),r.a.createElement("dd",null,a.methods&&a.methods.join(", ")),r.a.createElement("dt",null,"requestingUserId"),r.a.createElement("dd",null,a.requestingUserId),r.a.createElement("dt",null,"observeOnly"),r.a.createElement("dd",null,JSON.stringify(a.observeOnly))))};class P extends r.a.PureComponent{constructor(){super(...arguments),i()(this,"onNewRequest",()=>{this.forceUpdate()})}static getLabel(){return Object(d.a)("Verification Requests")}componentDidMount(){this.context.on("crypto.verification.request",this.onNewRequest)}componentWillUnmount(){this.context.off("crypto.verification.request",this.onNewRequest)}render(){const e=this.context,t=this.props.room,a=(e.crypto._inRoomVerificationRequests._requestsByRoomId||new Map).get(t.roomId)||new Map;return r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content"},Array.from(a.entries()).reverse().map(e=>{let[t,a]=e;return r.a.createElement(T,{txnId:t,request:a,key:t})})),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.props.onBack},Object(d.a)("Back"))))}}i()(P,"contextType",u.a);class N extends r.a.Component{static getLabel(){return Object(d.a)("Active Widgets")}constructor(e){super(e),i()(this,"onWidgetStoreUpdate",()=>{this.forceUpdate()}),i()(this,"onQueryChange",e=>{this.setState({query:e})}),i()(this,"onEditWidget",e=>{this.setState({editWidget:e})}),i()(this,"onBack",()=>{const e=g.a.instance.getApps(this.props.room.roomId);this.state.editWidget&&e.includes(this.state.editWidget)?this.setState({editWidget:null}):this.props.onBack()}),this.state={query:"",editWidget:null}}componentDidMount(){g.a.instance.on(f.b,this.onWidgetStoreUpdate)}componentWillUnmount(){g.a.instance.off(f.b,this.onWidgetStoreUpdate)}render(){const e=this.props.room,t=this.state.editWidget,a=g.a.instance.getApps(e.roomId);if(t&&a.includes(t)){const a=Array.from(Array.from(e.currentState.events.values()).map(e=>e.values())).reduce((e,t)=>(e.push(...t),e),[]).find(e=>e.getId()===t.eventId);return a?r.a.createElement(C,{onBack:this.onBack,room:e,forceStateEvent:!0,inputs:{eventType:a.getType(),evContent:JSON.stringify(a.getContent(),null,"\t"),stateKey:a.getStateKey()}}):r.a.createElement("div",null,Object(d.a)("There was an error finding this widget."),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back"))))}return r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content"},r.a.createElement(O,{query:this.state.query,onChange:this.onQueryChange},a.map(e=>r.a.createElement("button",{className:"mx_DevTools_RoomStateExplorer_button",key:e.url+e.eventId,onClick:()=>this.onEditWidget(e)},e.url)))),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back"))))}}class D extends r.a.PureComponent{static getLabel(){return Object(d.a)("Settings Explorer")}constructor(e){super(e),i()(this,"onQueryChange",e=>{this.setState({query:e.target.value})}),i()(this,"onExplValuesEdit",e=>{this.setState({explicitValues:e.target.value})}),i()(this,"onExplRoomValuesEdit",e=>{this.setState({explicitRoomValues:e.target.value})}),i()(this,"onBack",()=>{this.state.editSetting?this.setState({editSetting:null}):this.state.viewSetting?this.setState({viewSetting:null}):this.props.onBack()}),i()(this,"onViewClick",(e,t)=>{e.preventDefault(),this.setState({viewSetting:t})}),i()(this,"onEditClick",(e,t)=>{e.preventDefault(),this.setState({editSetting:t,explicitValues:this.renderExplicitSettingValues(t,null),explicitRoomValues:this.renderExplicitSettingValues(t,this.props.room.roomId)})}),i()(this,"onSaveClick",async()=>{try{const e=this.state.editSetting,t=JSON.parse(this.state.explicitValues),a=JSON.parse(this.state.explicitRoomValues);for(const a of Object.keys(t)){console.log(`[Devtools] Setting value of ${e} at ${a} from user input`);try{const n=t[a];await b.b.setValue(e,null,a,n)}catch(e){console.warn(e)}}const n=this.props.room.roomId;for(const s of Object.keys(t)){console.log(`[Devtools] Setting value of ${e} at ${s} in ${n} from user input`);try{const t=a[s];await b.b.setValue(e,n,s,t)}catch(e){console.warn(e)}}this.setState({viewSetting:e,editSetting:null})}catch(e){y.a.createTrackedDialog("Devtools - Failed to save settings","",E.a,{title:Object(d.a)("Failed to save settings"),description:e.message})}}),this.state={query:"",editSetting:null,viewSetting:null,explicitValues:null,explicitRoomValues:null}}renderSettingValue(e){return["boolean","number"].includes(typeof e)?e.toString():JSON.stringify(e)}renderExplicitSettingValues(e,t){const a={};for(const n of b.a)try{a[n]=b.b.getValueAt(n,e,t,!0,!0),void 0===a[n]&&(a[n]=null)}catch(e){console.warn(e)}return JSON.stringify(a,null,4)}renderCanEditLevel(e,t){const a=b.b.canSetValue(this.state.editSetting,e,t),n=a?"mx_DevTools_SettingsExplorer_mutable":"mx_DevTools_SettingsExplorer_immutable";return r.a.createElement("td",{className:n},r.a.createElement("code",null,a.toString()))}render(){const e=this.props.room;if(!this.state.viewSetting&&!this.state.editSetting){const t=Object.keys(v.a).filter(e=>!this.state.query||e.toLowerCase().includes(this.state.query.toLowerCase()));return r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content mx_DevTools_SettingsExplorer"},r.a.createElement(m.a,{label:Object(d.a)("Filter results"),autoFocus:!0,size:64,type:"text",autoComplete:"off",value:this.state.query,onChange:this.onQueryChange,className:"mx_TextInputDialog_input mx_DevTools_RoomStateExplorer_query"}),r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,Object(d.a)("Setting ID")),r.a.createElement("th",null,Object(d.a)("Value")),r.a.createElement("th",null,Object(d.a)("Value in this room")))),r.a.createElement("tbody",null,t.map(t=>r.a.createElement("tr",{key:t},r.a.createElement("td",null,r.a.createElement("a",{href:"",onClick:e=>this.onViewClick(e,t)},r.a.createElement("code",null,t)),r.a.createElement("a",{href:"",onClick:e=>this.onEditClick(e,t),className:"mx_DevTools_SettingsExplorer_edit"},"✏")),r.a.createElement("td",null,r.a.createElement("code",null,this.renderSettingValue(b.b.getValue(t)))),r.a.createElement("td",null,r.a.createElement("code",null,this.renderSettingValue(b.b.getValue(t,e.roomId))))))))),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back"))))}return this.state.editSetting?r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content mx_DevTools_SettingsExplorer"},r.a.createElement("h3",null,Object(d.a)("Setting:")," ",r.a.createElement("code",null,this.state.editSetting)),r.a.createElement("div",{className:"mx_DevTools_SettingsExplorer_warning"},r.a.createElement("b",null,Object(d.a)("Caution:"))," ",Object(d.a)("This UI does NOT check the types of the values. Use at your own risk.")),r.a.createElement("div",null,Object(d.a)("Setting definition:"),r.a.createElement("pre",null,r.a.createElement("code",null,JSON.stringify(v.a[this.state.editSetting],null,4)))),r.a.createElement("div",null,r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,Object(d.a)("Level")),r.a.createElement("th",null,Object(d.a)("Settable at global")),r.a.createElement("th",null,Object(d.a)("Settable at room")))),r.a.createElement("tbody",null,b.a.map(t=>r.a.createElement("tr",{key:t},r.a.createElement("td",null,r.a.createElement("code",null,t)),this.renderCanEditLevel(null,t),this.renderCanEditLevel(e.roomId,t)))))),r.a.createElement("div",null,r.a.createElement(m.a,{id:"valExpl",label:Object(d.a)("Values at explicit levels"),type:"text",className:"mx_DevTools_textarea",element:"textarea",autoComplete:"off",value:this.state.explicitValues,onChange:this.onExplValuesEdit})),r.a.createElement("div",null,r.a.createElement(m.a,{id:"valExpl",label:Object(d.a)("Values at explicit levels in this room"),type:"text",className:"mx_DevTools_textarea",element:"textarea",autoComplete:"off",value:this.state.explicitRoomValues,onChange:this.onExplRoomValuesEdit}))),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onSaveClick},Object(d.a)("Save setting values")),r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back")))):this.state.viewSetting?r.a.createElement("div",null,r.a.createElement("div",{className:"mx_Dialog_content mx_DevTools_SettingsExplorer"},r.a.createElement("h3",null,Object(d.a)("Setting:")," ",r.a.createElement("code",null,this.state.viewSetting)),r.a.createElement("div",null,Object(d.a)("Setting definition:"),r.a.createElement("pre",null,r.a.createElement("code",null,JSON.stringify(v.a[this.state.viewSetting],null,4)))),r.a.createElement("div",null,Object(d.a)("Value:")," ",r.a.createElement("code",null,this.renderSettingValue(b.b.getValue(this.state.viewSetting)))),r.a.createElement("div",null,Object(d.a)("Value in this room:")," ",r.a.createElement("code",null,this.renderSettingValue(b.b.getValue(this.state.viewSetting,e.roomId)))),r.a.createElement("div",null,Object(d.a)("Values at explicit levels:"),r.a.createElement("pre",null,r.a.createElement("code",null,this.renderExplicitSettingValues(this.state.viewSetting,null)))),r.a.createElement("div",null,Object(d.a)("Values at explicit levels in this room:"),r.a.createElement("pre",null,r.a.createElement("code",null,this.renderExplicitSettingValues(this.state.viewSetting,e.roomId))))),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:e=>this.onEditClick(e,this.state.viewSetting)},Object(d.a)("Edit Values")),r.a.createElement("button",{onClick:this.onBack},Object(d.a)("Back")))):void 0}}const j=[C,x,w,R,k,P,N,D];let A=Object(_.a)("views.dialogs.DevtoolsDialog")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"onBack",()=>{this.setState({mode:null})}),i()(this,"onCancel",()=>{this.props.onFinished(!1)}),this.state={mode:null}}setMode(e){return()=>{this.setState({mode:e})}}render(){let e;if(this.state.mode)e=r.a.createElement(u.a.Consumer,null,e=>r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mx_DevTools_label_left"},this.state.mode.getLabel()),r.a.createElement("div",{className:"mx_DevTools_label_right"},"Room ID: ",this.props.roomId),r.a.createElement("div",{className:"mx_DevTools_label_bottom"}),r.a.createElement(this.state.mode,{onBack:this.onBack,room:e.getRoom(this.props.roomId)})));else{const t="mx_DevTools_RoomStateExplorer_button";e=r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("div",{className:"mx_DevTools_label_left"},Object(d.a)("Toolbox")),r.a.createElement("div",{className:"mx_DevTools_label_right"},"Room ID: ",this.props.roomId),r.a.createElement("div",{className:"mx_DevTools_label_bottom"}),r.a.createElement("div",{className:"mx_Dialog_content"},j.map(e=>{const a=e.getLabel(),n=this.setMode(e);return r.a.createElement("button",{className:t,key:a,onClick:n},a)}))),r.a.createElement("div",{className:"mx_Dialog_buttons"},r.a.createElement("button",{onClick:this.onCancel},Object(d.a)("Cancel"))))}const t=l.getComponent("views.dialogs.BaseDialog");return r.a.createElement(t,{className:"mx_QuestionDialog",onFinished:this.props.onFinished,title:Object(d.a)("Developer Tools")},e)}})||n},794:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(1328),u=a(94);let h=Object(u.a)("views.elements.SyntaxHighlight")((s=class extends l.a.Component{constructor(e){super(e),this._ref=this._ref.bind(this)}componentDidUpdate(){this._el&&Object(m.highlightBlock)(this._el)}_ref(e){this._el=e,this.componentDidUpdate()}render(){const{className:e,children:t}=this.props;return l.a.createElement("pre",{className:e+" mx_SyntaxHighlight",ref:this._ref},l.a.createElement("code",null,t))}},o()(s,"propTypes",{className:d.a.string,children:d.a.node}),n=s))||n},795:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(98),s=a.n(n),i=a(88),o=a.n(i),r=a(108);const l=["className","label","kind"];function c(e){const{className:t,label:a,kind:n}=e,i=s()(e,l),c=(t||"")+" mx_FormButton",d=Object.assign({},i,{className:c,kind:n||"primary",children:[a]});return o.a.createElement(r.a,d)}c.propTypes=r.a.propTypes},796:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(100),o=a(422);class r{constructor(e,t){this.window=e,this.document=t,s()(this,"activeNowTimeout",void 0),s()(this,"activeRecentlyTimeout",void 0),s()(this,"attachedActiveNowTimers",[]),s()(this,"attachedActiveRecentlyTimers",[]),s()(this,"lastScreenX",0),s()(this,"lastScreenY",0),s()(this,"onPageVisibilityChanged",e=>{"hidden"===this.document.visibilityState?(this.activeNowTimeout.abort(),this.activeRecentlyTimeout.abort()):this.onUserActivity(e)}),s()(this,"onWindowBlurred",()=>{this.activeNowTimeout.abort(),this.activeRecentlyTimeout.abort()}),s()(this,"onUserActivity",e=>{if(this.document.hasFocus()){if(e.screenX&&"mousemove"===e.type){if(e.screenX===this.lastScreenX&&e.screenY===this.lastScreenY)return;this.lastScreenX=e.screenX,this.lastScreenY=e.screenY}i.a.dispatch({action:"user_activity"}),this.activeNowTimeout.isRunning()?this.activeNowTimeout.restart():(this.activeNowTimeout.start(),i.a.dispatch({action:"user_activity_start"}),r.runTimersUntilTimeout(this.attachedActiveNowTimers,this.activeNowTimeout)),this.activeRecentlyTimeout.isRunning()?this.activeRecentlyTimeout.restart():(this.activeRecentlyTimeout.start(),r.runTimersUntilTimeout(this.attachedActiveRecentlyTimers,this.activeRecentlyTimeout))}}),this.activeNowTimeout=new o.a(700),this.activeRecentlyTimeout=new o.a(12e4)}static sharedInstance(){return void 0===window.mxUserActivity&&(window.mxUserActivity=new r(window,document)),window.mxUserActivity}timeWhileActiveNow(e){this.timeWhile(e,this.attachedActiveNowTimers),this.userActiveNow()&&e.start()}timeWhileActiveRecently(e){this.timeWhile(e,this.attachedActiveRecentlyTimers),this.userActiveRecently()&&e.start()}timeWhile(e,t){-1===t.indexOf(e)&&(t.push(e),e.finished().finally(()=>{const a=t.indexOf(e);-1!==a&&t.splice(a,1)}).catch(e=>{}))}start(){this.document.addEventListener("mousedown",this.onUserActivity),this.document.addEventListener("mousemove",this.onUserActivity),this.document.addEventListener("keydown",this.onUserActivity),this.document.addEventListener("visibilitychange",this.onPageVisibilityChanged),this.window.addEventListener("blur",this.onWindowBlurred),this.window.addEventListener("focus",this.onUserActivity),this.window.addEventListener("wheel",this.onUserActivity,{passive:!0,capture:!0})}stop(){this.document.removeEventListener("mousedown",this.onUserActivity),this.document.removeEventListener("mousemove",this.onUserActivity),this.document.removeEventListener("keydown",this.onUserActivity),this.window.removeEventListener("wheel",this.onUserActivity,{capture:!0}),this.document.removeEventListener("visibilitychange",this.onPageVisibilityChanged),this.window.removeEventListener("blur",this.onWindowBlurred),this.window.removeEventListener("focus",this.onUserActivity)}userActiveNow(){return this.activeNowTimeout.isRunning()}userActiveRecently(){return this.activeRecentlyTimeout.isRunning()}static async runTimersUntilTimeout(e,t){e.forEach(e=>e.start());try{await t.finished()}catch(e){}e.forEach(e=>e.abort())}}},797:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(88),s=a.n(n),i=a(93),o=a(108),r=a(144);const l=e=>{let{avatarUrl:t,avatarDisabled:a=!1,setAvatar:r}=e;const l=Object(n.useRef)(),[c,d]=Object(n.useState)(t);let m;return m=a?c?s.a.createElement("img",{className:"mx_SpaceBasicSettings_avatar",src:c,alt:""}):s.a.createElement("div",{className:"mx_SpaceBasicSettings_avatar"}):c?s.a.createElement(s.a.Fragment,null,s.a.createElement(o.a,{className:"mx_SpaceBasicSettings_avatar",onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},element:"img",src:c,alt:""}),s.a.createElement(o.a,{onClick:()=>{l.current.value="",d(void 0),r(void 0)},kind:"link",className:"mx_SpaceBasicSettings_avatar_remove"},Object(i.a)("Delete"))):s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_SpaceBasicSettings_avatar",onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()}}),s.a.createElement(o.a,{onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},kind:"link"},Object(i.a)("Upload"))),s.a.createElement("div",{className:"mx_SpaceBasicSettings_avatarContainer"},m,s.a.createElement("input",{type:"file",ref:l,onChange:e=>{var t;if(null===(t=e.target.files)||void 0===t||!t.length)return;const a=e.target.files[0];r(a);const n=new FileReader;n.onload=e=>{d(e.target.result)},n.readAsDataURL(a)},accept:"image/*"}))};t.b=e=>{let{avatarUrl:t,avatarDisabled:a=!1,setAvatar:n,name:o="",nameDisabled:c=!1,setName:d,topic:m="",topicDisabled:u=!1,setTopic:h}=e;return s.a.createElement("div",{className:"mx_SpaceBasicSettings"},s.a.createElement(l,{avatarUrl:t,avatarDisabled:a,setAvatar:n}),s.a.createElement(r.a,{name:"spaceName",label:Object(i.a)("Name"),autoFocus:!0,value:o,onChange:e=>d(e.target.value),disabled:c}),s.a.createElement(r.a,{name:"spaceTopic",element:"textarea",label:Object(i.a)("Description"),value:m,onChange:e=>h(e.target.value),rows:3,disabled:u}))}},798:function(e,t,a){"use strict";a.d(t,"a",(function(){return O})),a.d(t,"b",(function(){return x}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(146),u=a(99),h=a(100),p=a(97),g=a(93),f=a(106),v=a(799),b=a(103),y=a(201),E=a(423),_=a(127),S=a(140),C=a(94),w=a(635);function O(e){return e===m.a.QUEUED||e===m.a.NOT_SENT}let x=Object(C.a)("views.context_menus.MessageContextMenu")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"state",{canRedact:!1,canPin:!1}),o()(this,"_checkPermissions",()=>{const e=u.a.get(),t=e.getRoom(this.props.mxEvent.getRoomId()),a=t.currentState.maySendRedactionForEvent(this.props.mxEvent,e.credentials.userId)&&this.props.mxEvent.getType()!==S.a.RoomServerAcl&&this.props.mxEvent.getType()!==S.a.RoomEncryption;let n=t.currentState.mayClientSendStateEvent(S.a.RoomPinnedEvents,e);b.b.getValue("feature_pinning")||(n=!1),this.setState({canRedact:a,canPin:n})}),o()(this,"onResendReactionsClick",()=>{for(const e of this._getUnsentReactions())v.a.resend(e);this.closeMenu()}),o()(this,"onReportEventClick",()=>{const e=p.getComponent("dialogs.ReportEventDialog");f.a.createTrackedDialog("Report Event","",e,{mxEvent:this.props.mxEvent},"mx_Dialog_reportEvent"),this.closeMenu()}),o()(this,"onViewSourceClick",()=>{const e=p.getComponent("structures.ViewSource");f.a.createTrackedDialog("View Event Source","",e,{mxEvent:this.props.mxEvent},"mx_Dialog_viewsource"),this.closeMenu()}),o()(this,"onRedactClick",()=>{const e=p.getComponent("dialogs.ConfirmRedactDialog");f.a.createTrackedDialog("Confirm Redact Dialog","",e,{onFinished:async(e,t)=>{if(!e)return;const a=u.a.get();try{this.props.onCloseDialog&&this.props.onCloseDialog(),await a.redactEvent(this.props.mxEvent.getRoomId(),this.props.mxEvent.getId(),void 0,t?{reason:t}:{})}catch(e){const t=e.errcode||e.statusCode;if(void 0!==t){const e=p.getComponent("dialogs.ErrorDialog");f.a.createTrackedDialog("You cannot delete this message","",e,{title:Object(g.a)("Error"),description:Object(g.a)("You cannot delete this message. (%(code)s)",{code:t})})}}}},"mx_Dialog_confirmredact"),this.closeMenu()}),o()(this,"onForwardClick",()=>{this.props.onCloseDialog&&this.props.onCloseDialog(),h.a.dispatch({action:"forward_event",event:this.props.mxEvent}),this.closeMenu()}),o()(this,"onPinClick",()=>{var e,t;const a=u.a.get(),n=a.getRoom(this.props.mxEvent.getRoomId()),s=this.props.mxEvent.getId(),i=(null==n||null===(e=n.currentState)||void 0===e||null===(t=e.getStateEvents(S.a.RoomPinnedEvents,""))||void 0===t?void 0:t.pinned)||[];var o,r;i.includes(s)?i.splice(i.indexOf(s),1):(i.push(s),a.setRoomAccountData(n.roomId,w.a,{event_ids:[...null===(o=n.getAccountData(w.a))||void 0===o||null===(r=o.getContent())||void 0===r?void 0:r.event_ids,s]}));a.sendStateEvent(this.props.mxEvent.getRoomId(),S.a.RoomPinnedEvents,{pinned:i},""),this.closeMenu()}),o()(this,"closeMenu",()=>{this.props.onFinished&&this.props.onFinished()}),o()(this,"onUnhidePreviewClick",()=>{this.props.eventTileOps&&this.props.eventTileOps.unhideWidget(),this.closeMenu()}),o()(this,"onQuoteClick",()=>{h.a.dispatch({action:"quote",event:this.props.mxEvent}),this.closeMenu()}),o()(this,"onPermalinkClick",e=>{e.preventDefault();const t=p.getComponent("dialogs.ShareDialog");f.a.createTrackedDialog("share room message dialog","",t,{target:this.props.mxEvent,permalinkCreator:this.props.permalinkCreator}),this.closeMenu()}),o()(this,"onCollapseReplyThreadClick",()=>{this.props.collapseReplyThread(),this.closeMenu()})}componentDidMount(){u.a.get().on("RoomMember.powerLevel",this._checkPermissions),this._checkPermissions()}componentWillUnmount(){const e=u.a.get();e&&e.removeListener("RoomMember.powerLevel",this._checkPermissions)}_isPinned(){const e=u.a.get().getRoom(this.props.mxEvent.getRoomId()).currentState.getStateEvents(S.a.RoomPinnedEvents,"");if(!e)return!1;const t=e.getContent();return t.pinned&&Array.isArray(t.pinned)&&t.pinned.includes(this.props.mxEvent.getId())}_getReactions(e){const t=u.a.get().getRoom(this.props.mxEvent.getRoomId()),a=this.props.mxEvent.getId();return t.getPendingEvents().filter(t=>{const n=t.getRelation();return n&&"m.annotation"===n.rel_type&&n.event_id===a&&e(t)})}_getPendingReactions(){return this._getReactions(e=>O(e.status))}_getUnsentReactions(){return this._getReactions(e=>e.status===m.a.NOT_SENT)}render(){const e=u.a.get().getUserId(),t=this.props.mxEvent,a=t.status,n=this._getUnsentReactions().length;let s,i,o,r,c,d,h,p;const f=!a||a===m.a.SENT;t.isRedacted()||0!==n&&(s=l.a.createElement(_.f,{className:"mx_MessageContextMenu_field",onClick:this.onResendReactionsClick},Object(g.a)("Resend %(unsentCount)s reaction(s)",{unsentCount:n}))),f&&this.state.canRedact&&(i=l.a.createElement(_.f,{className:"mx_MessageContextMenu_field",onClick:this.onRedactClick},Object(g.a)("Remove"))),Object(E.c)(t)&&(o=l.a.createElement(_.f,{className:"mx_MessageContextMenu_field",onClick:this.onForwardClick},Object(g.a)("Forward Message")),this.state.canPin&&(r=l.a.createElement(_.f,{className:"mx_MessageContextMenu_field",onClick:this.onPinClick},this._isPinned()?Object(g.a)("Unpin Message"):Object(g.a)("Pin Message"))));const v=l.a.createElement(_.f,{className:"mx_MessageContextMenu_field",onClick:this.onViewSourceClick},Object(g.a)("View Source"));let b;this.props.eventTileOps&&this.props.eventTileOps.isWidgetHidden()&&(c=l.a.createElement(_.f,{className:"mx_MessageContextMenu_field",onClick:this.onUnhidePreviewClick},Object(g.a)("Unhide Preview"))),this.props.permalinkCreator&&(b=this.props.permalinkCreator.forEvent(this.props.mxEvent.getId()));const S=l.a.createElement(_.f,{element:"a",className:"mx_MessageContextMenu_field",onClick:this.onPermalinkClick,href:b,target:"_blank",rel:"noreferrer noopener"},t.isRedacted()||"m.room.message"!==t.getType()?Object(g.a)("Share Permalink"):Object(g.a)("Share Message"));let C;return this.props.eventTileOps&&(h=l.a.createElement(_.f,{className:"mx_MessageContextMenu_field",onClick:this.onQuoteClick},Object(g.a)("Quote"))),"string"==typeof t.event.content.external_url&&Object(y.e)(t.event.content.external_url)&&(d=l.a.createElement(_.f,{element:"a",className:"mx_MessageContextMenu_field",target:"_blank",rel:"noreferrer noopener",onClick:this.closeMenu,href:t.event.content.external_url},Object(g.a)("Source URL"))),this.props.collapseReplyThread&&(p=l.a.createElement(_.f,{className:"mx_MessageContextMenu_field",onClick:this.onCollapseReplyThreadClick},Object(g.a)("Collapse Reply Thread"))),t.getSender()!==e&&(C=l.a.createElement(_.f,{className:"mx_MessageContextMenu_field",onClick:this.onReportEventClick},Object(g.a)("Report Content"))),l.a.createElement("div",{className:"mx_MessageContextMenu"},s,i,o,r,v,c,S,h,d,p,C)}},o()(s,"propTypes",{mxEvent:d.a.object.isRequired,eventTileOps:d.a.object,collapseReplyThread:d.a.func,onFinished:d.a.func,onCloseDialog:d.a.func}),n=s))||n},799:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(99),s=a(100),i=a(146);class o{static resendUnsentEvents(e){return Promise.all(e.getPendingEvents().filter((function(e){return e.status===i.a.NOT_SENT})).map((function(e){return o.resend(e)})))}static cancelUnsentEvents(e){e.getPendingEvents().filter((function(e){return e.status===i.a.NOT_SENT})).forEach((function(e){o.removeFromQueue(e)}))}static resend(e){const t=n.a.get().getRoom(e.getRoomId());return n.a.get().resendEvent(e,t).then((function(t){s.a.dispatch({action:"message_sent",event:e})}),(function(t){console.log("Resend got send failure: "+t.name+"("+t+")"),s.a.dispatch({action:"message_send_failed",event:e})}))}static removeFromQueue(e){n.a.get().cancelPendingEvent(e)}}},800:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(88);const s=(e,t,a)=>{const[s,i]=Object(n.useState)(a);return Object(n.useEffect)(()=>{let t=!1;return e().then(e=>{t||i(e)}),()=>{t=!0}},t),s}},801:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(19),s=a.n(n),i=a(99),o=a(632),r=a(103),l=a(93),c=a(100),d=a(123);class m{constructor(){s()(this,"_lists",[]),s()(this,"_roomIds",[]),s()(this,"_mjolnirWatchRef",null),s()(this,"_dispatcherRef",null),s()(this,"_onAction",e=>{"setup_mjolnir"===e.action&&(console.log("Setting up Mjolnir: after sync"),this.setup())}),s()(this,"_onEvent",e=>{i.a.get()&&this._roomIds.includes(e.getRoomId())&&o.a.includes(e.getType())&&this._updateLists(this._roomIds)})}get roomIds(){return this._roomIds}get lists(){return this._lists}start(){this._mjolnirWatchRef=r.b.watchSetting("mjolnirRooms",null,this._onListsChanged.bind(this)),this._dispatcherRef=c.a.register(this._onAction),c.a.dispatch({action:"do_after_sync_prepared",deferred_action:{action:"setup_mjolnir"}})}setup(){i.a.get()&&(this._updateLists(r.b.getValue("mjolnirRooms")),i.a.get().on("RoomState.events",this._onEvent))}stop(){this._mjolnirWatchRef&&(r.b.unwatchSetting(this._mjolnirWatchRef),this._mjolnirWatchRef=null),this._dispatcherRef&&(c.a.unregister(this._dispatcherRef),this._dispatcherRef=null),i.a.get()&&i.a.get().removeListener("RoomState.events",this._onEvent)}async getOrCreatePersonalList(){let e=r.b.getValue("mjolnirPersonalRoom");if(!e){const t=await i.a.get().createRoom({name:Object(l.a)("My Ban List"),topic:Object(l.a)("This is your list of users/servers you have blocked - don't leave the room!"),preset:"private_chat"});e=t.room_id,await r.b.setValue("mjolnirPersonalRoom",null,d.a.ACCOUNT,e),await r.b.setValue("mjolnirRooms",null,d.a.ACCOUNT,[e,...this._roomIds])}if(!e)throw new Error("Error finding a room ID to use");let t=this._lists.find(t=>t.roomId===e);return t||(t=new o.b(e)),t}getPersonalList(){const e=r.b.getValue("mjolnirPersonalRoom");if(!e)return null;let t=this._lists.find(t=>t.roomId===e);return t||(t=new o.b(e)),t}async subscribeToList(e){const t=[...this._roomIds,e];await r.b.setValue("mjolnirRooms",null,d.a.ACCOUNT,t),this._lists.push(new o.b(e))}async unsubscribeFromList(e){const t=this._roomIds.filter(t=>t!==e);await r.b.setValue("mjolnirRooms",null,d.a.ACCOUNT,t),this._lists=this._lists.filter(t=>t.roomId!==e)}_onListsChanged(e,t,a,n){this._updateLists(n)}_updateLists(e){if(i.a.get()&&(console.log("Updating Mjolnir ban lists to: "+e),this._lists=[],this._roomIds=e||[],e))for(const t of e)this._lists.push(new o.b(t))}isServerBanned(e){for(const t of this._lists)for(const a of t.serverRules)if(a.isMatch(e))return!0;return!1}isUserBanned(e){for(const t of this._lists)for(const a of t.userRules)if(a.isMatch(e))return!0;return!1}static sharedInstance(){return m._instance||(m._instance=new m),m._instance}}s()(m,"_instance",null)},802:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(93),o=a(119),r=a(222),l=a(103);const c=s.a.forwardRef((e,t)=>{let{mxEvent:a}=e;const c=Object(n.useContext)(o.a);let d=Object(i.a)("Message deleted");const m=a.getUnsigned(),u=m&&m.redacted_because&&m.redacted_because.sender;if(u&&u!==a.getSender()){const e=c.getRoom(a.getRoomId()),t=e&&e.getMember(u);d=Object(i.a)("Message deleted by %(name)s",{name:t?t.name:u})}const h=l.b.getValue("showTwelveHourTimestamps"),p=Object(r.b)(new Date(m.redacted_because.origin_server_ts),h),g=Object(i.a)("Message deleted on %(date)s",{date:p});return s.a.createElement("span",{className:"mx_RedactedBody",ref:t,title:g},d)});t.a=c},803:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return r}));var n=a(88),s=a(193),i=a(150);const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;const[a,o]=Object(n.useState)(e.getJoinedMembers());return Object(s.a)(e.currentState,"RoomState.members",Object(i.throttle)(()=>{o(e.getJoinedMembers())},t,{leading:!0,trailing:!0})),a},r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;const[a,o]=Object(n.useState)(e.getJoinedMemberCount());return Object(s.a)(e.currentState,"RoomState.members",Object(i.throttle)(()=>{o(e.getJoinedMemberCount())},t,{leading:!0,trailing:!0})),a}},804:function(e,t,a){"use strict";a.d(t,"b",(function(){return M}));var n=a(88),s=a.n(n),i=a(102),o=a.n(i),r=a(119),l=a(1345),c=a(336),d=a(93),m=a(167),u=a(108),h=a(100),p=a(115),g=a(183),f=a(106),v=a(805),b=a(193),y=a(215),E=a(283),_=a(103),S=a(339),C=a(808),w=a(135),O=a(299),x=a(500),R=a(340),k=a(147),I=a(127),T=a(636),P=a(803),N=a(267),D=a(250),j=a(200);const A=e=>{let{children:t,className:a,onClick:n}=e;return s.a.createElement(u.a,{className:o()("mx_BaseCard_Button mx_RoomSummaryCard_Button",a),onClick:n},t)},M=e=>{const[t,a]=Object(n.useState)(O.a.instance.getApps(e.roomId)),s=Object(n.useCallback)(()=>{a([...O.a.instance.getApps(e.roomId)])},[e]);return Object(n.useEffect)(s,[e,s]),Object(b.a)(O.a.instance,e.roomId,s),Object(b.a)(N.d.instance,N.d.emissionForRoom(e),s),t},U=e=>{let{app:t,room:a}=e;const n=y.a.getWidgetName(t),i=y.a.getWidgetDataTitle(t),r=i&&" - "+i,l=N.d.instance.isInContainer(a,t,N.a.Top),c=l?()=>{N.d.instance.moveToContainer(a,t,N.a.Right)}:()=>{N.d.instance.moveToContainer(a,t,N.a.Top)},[m,u,f,v]=Object(I.q)();let b;if(m){const e=u.current.getBoundingClientRect();b=s.a.createElement(T.a,{chevronFace:I.a.None,right:j.b.instance.windowWidth-e.right,bottom:j.b.instance.windowHeight-e.top,onFinished:v,app:t})}const E=!l&&!N.d.instance.canAddToContainer(a,N.a.Top);let _;_=E?Object(d.a)("You can only pin up to %(count)s widgets",{count:N.b}):l?Object(d.a)("Unpin"):Object(d.a)("Pin");const S=o()("mx_BaseCard_Button mx_RoomSummaryCard_Button",{mx_RoomSummaryCard_Button_pinned:l});return s.a.createElement("div",{className:S,ref:u},s.a.createElement(w.a,{className:"mx_RoomSummaryCard_icon_app",onClick:()=>{h.a.dispatch({action:p.a.SetRightPanelPhase,phase:g.c.Widget,refireParams:{widgetId:t.id}})},title:l?Object(d.a)("Unpin a widget to view it in this panel"):"",forceHide:!l,disabled:l,yOffset:-48},s.a.createElement(C.a,{app:t}),s.a.createElement("span",null,n),r),s.a.createElement(I.d,{className:"mx_RoomSummaryCard_app_options",isExpanded:m,onClick:f,title:Object(d.a)("Options"),yOffset:-24}),s.a.createElement(w.a,{className:"mx_RoomSummaryCard_app_pinToggle",onClick:c,title:_,disabled:E,yOffset:-24}),b)},L=e=>{let{room:t}=e;const a=M(t);let n=null;return a.length>0&&N.d.instance.canCopyLayoutToRoom(t)&&(n=s.a.createElement(u.a,{kind:"link",onClick:()=>N.d.instance.copyLayoutToRoom(t)},Object(d.a)("Set my room layout for everyone"))),s.a.createElement(c.a,{className:"mx_RoomSummaryCard_appsGroup",title:Object(d.a)("Widgets")},a.map(e=>s.a.createElement(U,{key:e.id,app:e,room:t})),n,s.a.createElement(u.a,{kind:"link",onClick:()=>{const e=E.a.sharedInstance();e.hasManager()?_.b.getValue("feature_many_integration_managers")?e.openAll(t):e.getPrimaryManager().open(t):e.openNoManagerDialog()}},a.length>0?Object(d.a)("Edit widgets, bridges & bots"):Object(d.a)("Add widgets, bridges & bots")))},F=()=>{h.a.dispatch({action:p.a.SetRightPanelPhase,phase:g.c.RoomMemberList})},B=()=>{h.a.dispatch({action:p.a.SetRightPanelPhase,phase:g.c.FilePanel})},V=()=>{h.a.dispatch({action:"open_room_settings"})};t.a=e=>{let{room:t,onClose:a}=e;const i=Object(n.useContext)(r.a),u=Object(l.a)(i,t),h=Object(n.useContext)(R.a).e2eStatus,p=t.getCanonicalAlias()||t.getAltAliases()[0]||"",g=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_RoomSummaryCard_avatar",role:"presentation"},s.a.createElement(m.a,{room:t,height:54,width:54,viewAvatarOnClick:!0}),s.a.createElement(S.a,{tooltip:u?Object(d.a)("Encrypted"):Object(d.a)("Not encrypted"),class:o()("mx_RoomSummaryCard_e2ee",{mx_RoomSummaryCard_e2ee_normal:u,mx_RoomSummaryCard_e2ee_warning:u&&h===x.a.Warning,mx_RoomSummaryCard_e2ee_verified:u&&h===x.a.Verified})})),s.a.createElement(D.a,{room:t},e=>s.a.createElement("h2",{title:e},e)),s.a.createElement("div",{className:"mx_RoomSummaryCard_alias",title:p},p)),b=Object(P.a)(t);return s.a.createElement(c.b,{header:g,className:"mx_RoomSummaryCard",onClose:a},s.a.createElement(c.a,{title:Object(d.a)("About"),className:"mx_RoomSummaryCard_aboutGroup"},s.a.createElement(A,{className:"mx_RoomSummaryCard_icon_people",onClick:F},Object(d.a)("%(count)s people",{count:b})),s.a.createElement(A,{className:"mx_RoomSummaryCard_icon_files",onClick:B},Object(d.a)("Show files")),s.a.createElement(A,{className:"mx_RoomSummaryCard_icon_share",onClick:()=>{f.a.createTrackedDialog("share room dialog","",v.a,{target:t})}},Object(d.a)("Share room")),s.a.createElement(A,{className:"mx_RoomSummaryCard_icon_settings",onClick:V},Object(d.a)("Room settings"))),_.b.getValue(k.a.Widgets)&&s.a.createElement(L,{room:t}))}},805:function(e,t,a){"use strict";a.d(t,"a",(function(){return k}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a(92),c=a(439),d=a(346),m=a(417),u=a(257),h=a(146),p=a(97),g=a(93),f=a(806),v=a(155),b=a(127),y=a(226),E=a(228),_=a(135),S=a(103),C=a(147),w=a(94);function O(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function x(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?O(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):O(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const R=[{name:"Facebook",img:a(2704),url:e=>"https://www.facebook.com/sharer/sharer.php?u="+e},{name:"Twitter",img:a(2705),url:e=>"https://twitter.com/home?status="+e},{name:"LinkedIn",img:a(2706),url:e=>"https://www.linkedin.com/shareArticle?mini=true&url="+e},{name:"Reddit",img:a(2707),url:e=>"http://www.reddit.com/submit?url="+e},{name:"email",img:a(2708),url:e=>"mailto:?body="+e}];let k=Object(w.a)("views.dialogs.ShareDialog")((s=class e extends r.PureComponent{constructor(e){super(e),o()(this,"closeCopiedTooltip",void 0),this.onCopyClick=this.onCopyClick.bind(this),this.onLinkSpecificEventCheckboxClick=this.onLinkSpecificEventCheckboxClick.bind(this);let t=null;e.target instanceof c.a&&(t=new v.a(e.target),t.load()),this.state={linkSpecificEvent:this.props.target instanceof h.b,permalinkCreator:t}}static onLinkClick(e){e.preventDefault(),Object(y.d)(e.target)}async onCopyClick(e){e.preventDefault();const t=e.target,a=await Object(y.c)(this.getUrl()),n=t.getBoundingClientRect(),s=p.getComponent("context_menus.GenericTextContextMenu"),{close:i}=b.n(s,x(x({},Object(b.p)(n,2)),{},{message:a?Object(g.a)("Copied!"):Object(g.a)("Failed to copy")}));this.closeCopiedTooltip=t.onmouseleave=i}onLinkSpecificEventCheckboxClick(){this.setState({linkSpecificEvent:!this.state.linkSpecificEvent})}componentWillUnmount(){this.closeCopiedTooltip&&this.closeCopiedTooltip()}getUrl(){let e;if(this.props.target instanceof c.a)if(this.state.linkSpecificEvent){const t=this.props.target.getLiveTimeline().getEvents();e=this.state.permalinkCreator.forEvent(t[t.length-1].getId())}else e=this.state.permalinkCreator.forShareableRoom();else this.props.target instanceof d.a||this.props.target instanceof u.a?e=Object(v.h)(this.props.target.userId):this.props.target instanceof m.a?e=Object(v.f)(this.props.target.groupId):this.props.target instanceof h.b&&(e=this.state.linkSpecificEvent?this.props.permalinkCreator.forEvent(this.props.target.getId()):this.props.permalinkCreator.forRoom());return e}render(){let t,a;if(this.props.target instanceof c.a){t=Object(g.a)("Share Room");this.props.target.getLiveTimeline().getEvents().length>0&&(a=r.createElement("div",null,r.createElement(E.a,{checked:this.state.linkSpecificEvent,onChange:this.onLinkSpecificEventCheckboxClick},Object(g.a)("Link to most recent message"))))}else this.props.target instanceof d.a||this.props.target instanceof u.a?t=Object(g.a)("Share User"):this.props.target instanceof m.a?t=Object(g.a)("Share Community"):this.props.target instanceof h.b&&(t=Object(g.a)("Share Room Message"),a=r.createElement("div",null,r.createElement(E.a,{checked:this.state.linkSpecificEvent,onClick:this.onLinkSpecificEventCheckboxClick},Object(g.a)("Link to selected message"))));const n=this.getUrl(),s=encodeURIComponent(n),i=S.b.getValue(C.a.ShareQRCode),o=S.b.getValue(C.a.ShareSocial);let l;(i||o)&&(l=r.createElement(r.Fragment,null,r.createElement("hr",null),r.createElement("div",{className:"mx_ShareDialog_split"},i&&r.createElement("div",{className:"mx_ShareDialog_qrcode_container"},r.createElement(f.a,{data:n,width:256})),o&&r.createElement("div",{className:"mx_ShareDialog_social_container"},R.map(e=>r.createElement("a",{rel:"noreferrer noopener",target:"_blank",key:e.name,title:e.name,href:e.url(s),className:"mx_ShareDialog_social_icon"},r.createElement("img",{src:e.img,alt:e.name,height:64,width:64})))))));const v=p.getComponent("views.dialogs.BaseDialog");return r.createElement(v,{title:t,className:"mx_ShareDialog",contentId:"mx_Dialog_content",onFinished:this.props.onFinished},r.createElement("div",{className:"mx_ShareDialog_content"},r.createElement("div",{className:"mx_ShareDialog_matrixto"},r.createElement("a",{href:n,onClick:e.onLinkClick,className:"mx_ShareDialog_matrixto_link"},n),r.createElement(_.a,{title:Object(g.a)("Copy"),onClick:this.onCopyClick,className:"mx_ShareDialog_matrixto_copy"})),a,l))}},o()(s,"propTypes",{onFinished:l.func.isRequired,target:l.oneOfType([l.instanceOf(c.a),l.instanceOf(d.a),l.instanceOf(m.a),l.instanceOf(u.a),l.instanceOf(h.b)]).isRequired}),n=s))||n},806:function(e,t,a){"use strict";var n=a(19),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a(2682),c=a(102),d=a.n(c),m=a(93),u=a(168);const h=["data","className"];function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const f={errorCorrectionLevel:"L"};t.a=e=>{let{data:t,className:a}=e,n=o()(e,h);const[s,i]=r.useState(null);return r.useEffect(()=>{let e=!1;return Object(l.toDataURL)(t,g(g({},f),n)).then(t=>{e||i(t)}),()=>{e=!0}},[JSON.stringify(t),n]),r.createElement("div",{className:d()("mx_QRCode",a)},s?r.createElement("img",{src:s,className:"mx_VerificationQRCode",alt:Object(m.a)("QR Code")}):r.createElement(u.a,null))}},808:function(e,t,a){"use strict";var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(227),u=a(126);const h=["app","className","width","height"];t.a=e=>{let{app:t,className:n,width:i=20,height:r=20}=e,c=o()(e,h),p=[a(2709)];return t.type.includes("jitsi")?p=[a(2710)]:t.type.includes("meeting")||t.type.includes("calendar")?p=[a(2711)]:t.type.includes("pad")||t.type.includes("doc")||t.type.includes("calc")?p=[a(2712)]:t.type.includes("clock")&&(p=[a(2713)]),l.a.createElement(m.a,s()({},c,{name:t.id,className:d()("mx_WidgetAvatar",n),url:t.avatar_url?Object(u.b)(t.avatar_url).getSquareThumbnailHttp(20):void 0,urls:p,width:i,height:r}))}},809:function(e,t){e.exports="img/ellipsis.6f84086.svg"},810:function(e,t,a){"use strict";a.d(t,"b",(function(){return u})),a.d(t,"a",(function(){return h}));var n=a(88),s=a.n(n),i=a(106),o=a(97),r=a(582),l=a(93),c=a(99),d=a(192),m=a(228);function u(e){return new Promise((t,a)=>{const n=s.a.createElement("div",null,s.a.createElement("div",null,Object(l.a)("Who would you like to add to this community?")),s.a.createElement("div",{className:"warning"},Object(l.a)("Warning: any person you add to a community will be publicly visible to anyone who knows the community ID"))),c=o.getComponent("dialogs.AddressPickerDialog");i.a.createTrackedDialog("Group Invite","",c,{title:Object(l.a)("Invite new community members"),description:n,placeholder:Object(l.a)("Name or Matrix ID"),button:Object(l.a)("Invite to Community"),validAddressTypes:["mx-user-id"],onFinished:(n,s)=>{n&&function(e,t){const a=new r.a(e),n=t.map(e=>e.address);return a.invite(n).then(a=>{const n=[];for(const e of Object.keys(a))"error"===t[e]&&n.push(e);if(n.length>0){const t=o.getComponent("dialogs.ErrorDialog");i.a.createTrackedDialog("Failed to invite the following users to the group","",t,{title:Object(l.a)("Failed to invite the following users to %(groupId)s:",{groupId:e}),description:n.join(", ")})}}).catch(t=>{const a=o.getComponent("dialogs.ErrorDialog");i.a.createTrackedDialog("Failed to invite users to group","",a,{title:Object(l.a)("Failed to invite users to community"),description:Object(l.a)("Failed to invite users to %(groupId)s",{groupId:e})})})}(e,s).then(t,a)}},null,!1,!0)})}function h(e){return new Promise((t,a)=>{let n=!1;const r=s.a.createElement("div",null,s.a.createElement("div",null,Object(l.a)("Which rooms would you like to add to this community?"))),u=s.a.createElement(m.a,{className:"mx_GroupAddressPicker_checkboxContainer",onChange:e=>{n=e.target.checked}},Object(l.a)("Show these rooms to non-members on the community page and room list?")),h=o.getComponent("dialogs.AddressPickerDialog");i.a.createTrackedDialog("Add Rooms to Group","",h,{title:Object(l.a)("Add rooms to the community"),description:r,extraNode:u,placeholder:Object(l.a)("Room name or address"),button:Object(l.a)("Add to community"),pickerType:"room",validAddressTypes:["mx-room-id"],onFinished:(s,r)=>{s&&function(e,t,a){const n=c.a.get(),s=[];return Promise.allSettled(t.map(t=>d.a.addRoomToGroup(e,t.address,a).catch(()=>{s.push(t.address)}).then(()=>{const a=t.address,s=n.getRoom(a);if(!s||!s.currentState.mayClientSendStateEvent("m.room.related_groups",n))return;const i=s.currentState.getStateEvents("m.room.related_groups",""),o=i&&i.getContent().groups||[];return o.includes(e)?void 0:(o.push(e),c.a.get().sendStateEvent(a,"m.room.related_groups",{groups:o},""))}))).then(()=>{if(0===s.length)return;const t=o.getComponent("dialogs.ErrorDialog");i.a.createTrackedDialog("Failed to add the following room to the group","",t,{title:Object(l.a)("Failed to add the following rooms to %(groupId)s:",{groupId:e}),description:s.join(", ")})})}(e,r,n).then(t,a)}},null,!1,!0)})}},811:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(88),s=a.n(n),i=a(97),o=a(93);const r=e=>{let{text:t}=e;const a=i.getComponent("elements.Spinner");return s.a.createElement("div",{className:"mx_EncryptionInfo_spinner"},s.a.createElement(a,null),t)};t.b=e=>{let t,a,{waitingForOtherParty:n,waitingForNetwork:l,member:c,onStartVerification:d,isRoomEncrypted:m,inDialog:u,isSelfVerification:h}=e;if(n||l){let e;e=n?h?Object(o.a)("Accept on your other login…"):Object(o.a)("Waiting for %(displayName)s to accept…",{displayName:c.displayName||c.name||c.userId}):Object(o.a)("Accepting…"),t=s.a.createElement(r,{text:e})}else{const e=i.getComponent("elements.AccessibleButton");t=s.a.createElement(e,{kind:"primary",className:"mx_UserInfo_wideButton",onClick:d},Object(o.a)("Start Verification"))}return a=m?s.a.createElement("div",null,s.a.createElement("p",null,Object(o.a)("Messages in this room are end-to-end encrypted.")),s.a.createElement("p",null,Object(o.a)("Your messages are secured and only you and the recipient have the unique keys to unlock them."))):s.a.createElement("div",null,s.a.createElement("p",null,Object(o.a)("Messages in this room are not end-to-end encrypted.")),s.a.createElement("p",null,Object(o.a)("In encrypted rooms, your messages are secured and only you and the recipient have the unique keys to unlock them."))),u?t:s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_UserInfo_container"},s.a.createElement("h3",null,Object(o.a)("Encryption")),a),s.a.createElement("div",{className:"mx_UserInfo_container"},s.a.createElement("h3",null,Object(o.a)("Verify User")),s.a.createElement("div",null,s.a.createElement("p",null,Object(o.a)("For extra security, verify this user by checking a one-time code on both of your devices.")),s.a.createElement("p",null,Object(o.a)("To be secure, do this in person or use a trusted way to communicate.")),t)))}},812:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(94),u=a(806);let h=Object(m.a)("views.elements.crypto.VerificationQRCode")((s=class extends l.a.PureComponent{render(){return l.a.createElement(u.a,{data:[{data:this.props.qrCodeData.buffer,mode:"byte"}],className:"mx_VerificationQRCode",width:196})}},o()(s,"propTypes",{qrCodeData:d.a.object.isRequired}),n=s))||n},813:function(e,t){e.exports="img/e2e/warning.53a9e82.svg"},814:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return d}));var n,s=a(88),i=a(93),o=a(97),r=a(138),l=a(94);class c{constructor(e,t,a,n){this.id=e,this.label=t,this.icon=a,this.body=n}}let d=Object(l.a)("structures.TabbedView")(n=class extends s.Component{constructor(e){super(e);let t=0;if(e.initialTabId){const a=e.tabs.findIndex(t=>t.id===e.initialTabId);a>=0&&(t=a)}this.state={activeTabIndex:t}}_getActiveTabIndex(){return this.state&&this.state.activeTabIndex?this.state.activeTabIndex:0}_setActiveTab(e){const t=this.props.tabs.indexOf(e);-1!==t?this.setState({activeTabIndex:t}):console.error("Could not find tab "+e.label+" in tabs")}_renderTabLabel(e){const t=o.getComponent("elements.AccessibleButton");let a="mx_TabbedView_tabLabel ";this.props.tabs.indexOf(e)===this._getActiveTabIndex()&&(a+="mx_TabbedView_tabLabel_active");let n=null;e.icon&&(n=s.createElement("span",{className:"mx_TabbedView_maskedIcon "+e.icon}));const r=Object(i.a)(e.label);return s.createElement(t,{className:a,key:"tab_label_"+e.label,onClick:()=>this._setActiveTab(e)},n,s.createElement("span",{className:"mx_TabbedView_tabLabel_text"},r))}_renderTabPanel(e){return s.createElement("div",{className:"mx_TabbedView_tabPanel",key:"mx_tabpanel_"+e.label},s.createElement(r.a,{className:"mx_TabbedView_tabPanelContent"},e.body))}render(){const e=this.props.tabs.map(e=>this._renderTabLabel(e)),t=this._renderTabPanel(this.props.tabs[this._getActiveTabIndex()]);return s.createElement("div",{className:"mx_TabbedView"},s.createElement("div",{className:"mx_TabbedView_tabLabels"},e),t)}})||n},818:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(92),c=a.n(l),d=a(102),m=a.n(d),u=a(108),h=a(93),p=a(131),g=a(94);class f extends r.a.Component{constructor(e){super(e),this._onMouseEnter=this._onMouseEnter.bind(this),this._onClick=this._onClick.bind(this)}_onMouseEnter(){this.props.onMouseEnter(this.props.dropdownKey)}_onClick(e){e.preventDefault(),e.stopPropagation(),this.props.onClick(this.props.dropdownKey)}render(){const e=m()({mx_Dropdown_option:!0,mx_Dropdown_option_highlight:this.props.highlighted});return r.a.createElement("div",{id:this.props.id,className:e,onClick:this._onClick,onMouseEnter:this._onMouseEnter,role:"option","aria-selected":this.props.highlighted,ref:this.props.inputRef},this.props.children)}}i()(f,"defaultProps",{disabled:!1}),f.propTypes={children:c.a.oneOfType([c.a.arrayOf(c.a.node),c.a.node]),highlighted:c.a.bool,dropdownKey:c.a.string,onClick:c.a.func.isRequired,onMouseEnter:c.a.func.isRequired,inputRef:c.a.any};let v=Object(g.a)("views.elements.Dropdown")(n=class extends r.a.Component{constructor(e){super(e),i()(this,"_onInputKeyDown",e=>{let t=!0;switch(e.key){case p.a.ENTER:this.props.onOptionChange(this.state.highlightedOption);case p.a.ESCAPE:this._close();break;case p.a.ARROW_DOWN:this.setState({highlightedOption:this._nextOption(this.state.highlightedOption)});break;case p.a.ARROW_UP:this.setState({highlightedOption:this._prevOption(this.state.highlightedOption)});break;default:t=!1}t&&(e.preventDefault(),e.stopPropagation())}),this.dropdownRootElement=null,this.ignoreEvent=null,this._onInputClick=this._onInputClick.bind(this),this._onRootClick=this._onRootClick.bind(this),this._onDocumentClick=this._onDocumentClick.bind(this),this._onMenuOptionClick=this._onMenuOptionClick.bind(this),this._onInputChange=this._onInputChange.bind(this),this._collectRoot=this._collectRoot.bind(this),this._collectInputTextBox=this._collectInputTextBox.bind(this),this._setHighlightedOption=this._setHighlightedOption.bind(this),this.inputTextBox=null,this._reindexChildren(this.props.children);const t=r.a.Children.toArray(e.children)[0];this.state={expanded:!1,highlightedOption:t?t.key:null,searchQuery:""}}UNSAFE_componentWillMount(){this._button=Object(o.createRef)(),document.addEventListener("click",this._onDocumentClick,!1)}componentWillUnmount(){document.removeEventListener("click",this._onDocumentClick,!1)}UNSAFE_componentWillReceiveProps(e){if(!e.children||0===e.children.length)return;this._reindexChildren(e.children);const t=e.children[0];this.setState({highlightedOption:t?t.key:null})}_reindexChildren(e){this.childrenByKey={},r.a.Children.forEach(e,e=>{this.childrenByKey[e.key]=e})}_onDocumentClick(e){e!==this.ignoreEvent&&this.setState({expanded:!1})}_onRootClick(e){this.ignoreEvent=e}_onInputClick(e){this.props.disabled||this.state.expanded||(this.setState({expanded:!0}),e.preventDefault())}_close(){this.setState({expanded:!1}),this._button.current&&this._button.current.focus()}_onMenuOptionClick(e){this._close(),this.props.onOptionChange(e)}_onInputChange(e){this.setState({searchQuery:e.target.value}),this.props.onSearchChange&&this.props.onSearchChange(e.target.value)}_collectRoot(e){this.dropdownRootElement&&this.dropdownRootElement.removeEventListener("click",this._onRootClick,!1),e&&e.addEventListener("click",this._onRootClick,!1),this.dropdownRootElement=e}_collectInputTextBox(e){this.inputTextBox=e,e&&e.focus()}_setHighlightedOption(e){this.setState({highlightedOption:e})}_nextOption(e){const t=Object.keys(this.childrenByKey),a=t.indexOf(e);return t[(a+1)%t.length]}_prevOption(e){const t=Object.keys(this.childrenByKey),a=t.indexOf(e);return t[(a-1)%t.length]}_scrollIntoView(e){e&&e.scrollIntoView({block:"nearest",behavior:"auto"})}_getMenuOptions(){const e=r.a.Children.map(this.props.children,e=>{const t=this.state.highlightedOption===e.key;return r.a.createElement(f,{id:`${this.props.id}__${e.key}`,key:e.key,dropdownKey:e.key,highlighted:t,onMouseEnter:this._setHighlightedOption,onClick:this._onMenuOptionClick,inputRef:t?this._scrollIntoView:void 0},e)});return 0===e.length?[r.a.createElement("div",{key:"0",className:"mx_Dropdown_option",role:"option"},Object(h.a)("No results"))]:e}render(){let e;const t={};let a;if(this.props.menuWidth&&(t.width=this.props.menuWidth),this.state.expanded&&(this.props.searchEnabled&&(e=r.a.createElement("input",{type:"text",className:"mx_Dropdown_option",ref:this._collectInputTextBox,onKeyDown:this._onInputKeyDown,onChange:this._onInputChange,value:this.state.searchQuery,role:"combobox","aria-autocomplete":"list","aria-activedescendant":`${this.props.id}__${this.state.highlightedOption}`,"aria-owns":this.props.id+"_listbox","aria-disabled":this.props.disabled,"aria-label":this.props.label})),a=r.a.createElement("div",{className:"mx_Dropdown_menu",style:t,role:"listbox",id:this.props.id+"_listbox"},this._getMenuOptions())),!e){const t=this.props.getShortOption?this.props.getShortOption(this.props.value):this.childrenByKey[this.props.value];e=r.a.createElement("div",{className:"mx_Dropdown_option",id:this.props.id+"_value"},t)}const n={mx_Dropdown:!0,mx_Dropdown_disabled:this.props.disabled};return this.props.className&&(n[this.props.className]=!0),r.a.createElement("div",{className:m()(n),ref:this._collectRoot},r.a.createElement(u.a,{className:"mx_Dropdown_input mx_no_textinput",onClick:this._onInputClick,"aria-haspopup":"listbox","aria-expanded":this.state.expanded,disabled:this.props.disabled,inputRef:this._button,"aria-label":this.props.label,"aria-describedby":this.props.id+"_value"},e,r.a.createElement("span",{className:"mx_Dropdown_arrow"}),a))}})||n;v.propTypes={id:c.a.string.isRequired,menuWidth:c.a.number,onOptionChange:c.a.func.isRequired,onSearchChange:c.a.func,searchEnabled:c.a.bool,getShortOption:c.a.func,value:c.a.string,disabled:c.a.bool,label:c.a.string.isRequired}},819:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(99),h=a(106),p=a(820),g=a(97),f=a(821),v=a(94);let b=Object(v.a)("structures.auth.SetupEncryptionBody")((s=class extends l.a.Component{constructor(){super(),o()(this,"_onStoreUpdate",()=>{const e=f.g.sharedInstance();e.phase!==f.d?this.setState({phase:e.phase,verificationRequest:e.verificationRequest,backupInfo:e.backupInfo}):this.props.onFinished()}),o()(this,"_onUsePassphraseClick",async()=>{f.g.sharedInstance().usePassPhrase()}),o()(this,"_onVerifyClick",()=>{const e=u.a.get(),t=e.getUserId(),a=e.requestVerification(t);this.props.onFinished(!0),h.a.createTrackedDialog("New Session Verification","Starting dialog",p.a,{verificationRequestPromise:a,member:e.getUser(t),onFinished:async()=>{(await a).cancel()}})}),o()(this,"onSkipClick",()=>{f.g.sharedInstance().skip()}),o()(this,"onSkipConfirmClick",()=>{f.g.sharedInstance().skipConfirm()}),o()(this,"onSkipBackClick",()=>{f.g.sharedInstance().returnAfterSkip()}),o()(this,"onDoneClick",()=>{f.g.sharedInstance().done()});const e=f.g.sharedInstance();e.on("update",this._onStoreUpdate),e.start(),this.state={phase:e.phase,verificationRequest:e.verificationRequest,backupInfo:e.backupInfo}}componentWillUnmount(){const e=f.g.sharedInstance();e.off("update",this._onStoreUpdate),e.stop()}render(){const e=g.getComponent("elements.AccessibleButton"),{phase:t}=this.state;if(this.state.verificationRequest){const e=g.getComponent("views.right_panel.EncryptionPanel");return l.a.createElement(e,{layout:"dialog",verificationRequest:this.state.verificationRequest,onClose:this.props.onFinished,member:u.a.get().getUser(this.state.verificationRequest.otherUserId)})}if(t===f.e){const t=f.g.sharedInstance();let n,s,i;return t.keyInfo&&((a=t.keyInfo).passphrase&&a.passphrase.salt&&a.passphrase.iterations)?n=Object(m.a)("Use Security Key or Phrase"):t.keyInfo&&(n=Object(m.a)("Use Security Key")),n&&(s=l.a.createElement(e,{kind:"link",onClick:this._onUsePassphraseClick},n)),t.hasDevicesToVerifyAgainst&&(i=l.a.createElement(e,{kind:"primary",onClick:this._onVerifyClick},Object(m.a)("Use another login"))),l.a.createElement("div",null,l.a.createElement("p",null,Object(m.a)("Verify your identity to access encrypted messages and prove your identity to others.")),l.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},i,s,l.a.createElement(e,{kind:"danger",onClick:this.onSkipClick},Object(m.a)("Skip"))))}if(t===f.c){let t;return t=this.state.backupInfo?l.a.createElement("p",null,Object(m.a)("Your new session is now verified. It has access to your encrypted messages, and other users will see it as trusted.")):l.a.createElement("p",null,Object(m.a)("Your new session is now verified. Other users will see it as trusted.")),l.a.createElement("div",null,l.a.createElement("div",{className:"mx_CompleteSecurity_heroIcon mx_E2EIcon_verified"}),t,l.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},l.a.createElement(e,{kind:"primary",onClick:this.onDoneClick},Object(m.a)("Done"))))}if(t===f.b)return l.a.createElement("div",null,l.a.createElement("p",null,Object(m.a)("Without verifying, you won’t have access to all your messages and may appear as untrusted to others.")),l.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},l.a.createElement(e,{className:"warning",kind:"secondary",onClick:this.onSkipConfirmClick},Object(m.a)("Skip")),l.a.createElement(e,{kind:"danger",onClick:this.onSkipBackClick},Object(m.a)("Go Back"))));if(t===f.a||t===f.f){const e=g.getComponent("views.elements.Spinner");return l.a.createElement(e,null)}var a;console.log("SetupEncryptionBody: Unknown phase "+t)}},o()(s,"propTypes",{onFinished:d.a.func.isRequired}),n=s))||n},820:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(99),u=a(97),h=a(93),p=a(94);let g=Object(p.a)("views.dialogs.VerificationRequestDialog")((s=class extends l.a.Component{constructor(){super(...arguments),this.state={},this.props.verificationRequest?this.state.verificationRequest=this.props.verificationRequest:this.props.verificationRequestPromise&&this.props.verificationRequestPromise.then(e=>{this.setState({verificationRequest:e})})}render(){const e=u.getComponent("views.dialogs.BaseDialog"),t=u.getComponent("views.right_panel.EncryptionPanel"),a=this.state.verificationRequest,n=a&&a.otherUserId,s=this.props.member||n&&m.a.get().getUser(n),i=a&&a.isSelfVerification?Object(h.a)("Verify other login"):Object(h.a)("Verification Request");return l.a.createElement(e,{className:"mx_InfoDialog",onFinished:this.props.onFinished,contentId:"mx_Dialog_content",title:i,hasCancel:!0},l.a.createElement(t,{layout:"dialog",verificationRequest:this.props.verificationRequest,verificationRequestPromise:this.props.verificationRequestPromise,onClose:this.props.onFinished,member:s}))}},o()(s,"propTypes",{verificationRequest:d.a.object,verificationRequestPromise:d.a.object,onFinished:d.a.func.isRequired,member:d.a.string}),n=s))||n},821:function(e,t,a){"use strict";(function(e){a.d(t,"f",(function(){return d})),a.d(t,"e",(function(){return m})),a.d(t,"a",(function(){return u})),a.d(t,"c",(function(){return h})),a.d(t,"b",(function(){return p})),a.d(t,"d",(function(){return g})),a.d(t,"g",(function(){return f}));var n=a(19),s=a.n(n),i=a(8),o=a.n(i),r=a(99),l=a(279),c=a(364);const d=0,m=1,u=2,h=3,p=4,g=5;class f extends o.a{constructor(){super(...arguments),s()(this,"_onUserTrustStatusChanged",e=>{if(e!==r.a.get().getUserId())return;r.a.get().getCrossSigningId()&&(this.phase=h,this.emit("update"))}),s()(this,"onVerificationRequest",e=>{this._setActiveVerificationRequest(e)}),s()(this,"onVerificationRequestChange",()=>{if(this.verificationRequest.cancelled)this.verificationRequest.off("change",this.onVerificationRequestChange),this.verificationRequest=null,this.emit("update");else if(this.verificationRequest.phase===c.c){this.verificationRequest.off("change",this.onVerificationRequestChange),this.verificationRequest=null;const e=r.a.get().getCrossSigningId();this.phase=e?h:u,this.emit("update")}})}static sharedInstance(){return e.mx_SetupEncryptionStore||(e.mx_SetupEncryptionStore=new f),e.mx_SetupEncryptionStore}start(){if(this._started)return;this._started=!0,this.phase=d,this.verificationRequest=null,this.backupInfo=null,this.keyId=null,this.keyInfo=null;const e=r.a.get();e.on("crypto.verification.request",this.onVerificationRequest),e.on("userTrustStatusChanged",this._onUserTrustStatusChanged);const t=e.getVerificationRequestsToDeviceInProgress(e.getUserId());t.length&&this._setActiveVerificationRequest(t[t.length-1]),this.fetchKeyInfo()}stop(){this._started&&(this._started=!1,this.verificationRequest&&this.verificationRequest.off("change",this.onVerificationRequestChange),r.a.get()&&(r.a.get().removeListener("crypto.verification.request",this.onVerificationRequest),r.a.get().removeListener("userTrustStatusChanged",this._onUserTrustStatusChanged)))}async fetchKeyInfo(){const e=r.a.get(),t=await e.isSecretStored("m.cross_signing.master",!1);null===t||0===Object.keys(t).length?(this.keyId=null,this.keyInfo=null):(this.keyId=Object.keys(t)[0],this.keyInfo=t[this.keyId]);const a=await e.getDehydratedDevice();this.hasDevicesToVerifyAgainst=e.getStoredDevicesForUser(e.getUserId()).some(e=>e.getIdentityKey()&&(!a||e.deviceId!=a.device_id)),this.hasDevicesToVerifyAgainst||this.keyInfo?this.phase=m:this.phase=g,this.emit("update")}async usePassPhrase(){this.phase=u,this.emit("update");const e=r.a.get();try{const t=await e.getKeyBackupVersion();this.backupInfo=t,this.emit("update"),await new Promise((a,n)=>{Object(l.b)(async()=>{await e.checkOwnCrossSigningTrust(),a(),t&&await e.restoreKeyBackupWithSecretStorage(t)}).catch(n)}),e.getCrossSigningId()&&(this.phase=h,this.emit("update"))}catch(e){e instanceof l.a||console.log(e),this.phase=m,this.emit("update")}}skip(){this.phase=p,this.emit("update")}skipConfirm(){this.phase=g,this.emit("update")}returnAfterSkip(){this.phase=m,this.emit("update")}done(){this.phase=g,this.emit("update"),r.a.get().crypto.cancelAndResendAllOutgoingKeyRequests()}async _setActiveVerificationRequest(e){e.otherUserId===r.a.get().getUserId()&&(this.verificationRequest&&this.verificationRequest.off("change",this.onVerificationRequestChange),this.verificationRequest=e,await e.accept(),e.on("change",this.onVerificationRequestChange),this.emit("update"))}}}).call(this,a(7))},822:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return l}));var n=a(100),s=a(97),i=a(106),o=a(93);const r=/^[a-z0-9=_\-./]+$/;async function l(e){void 0===e&&(e={});const t=s.getComponent("dialogs.QuestionDialog"),a=i.a.createTrackedDialog("Registration required","",t,{hasCancelButton:!0,quitOnly:!0,title:Object(o.a)("Sign In or Create Account"),description:Object(o.a)("Use your account or create a new one to continue."),button:Object(o.a)("Create Account"),extraButtons:[React.createElement("button",{key:"start_login",onClick:()=>{a.close(),n.a.dispatch({action:"start_login",screenAfterLogin:e.screen_after})}},Object(o.a)("Sign In"))],onFinished:t=>{t?n.a.dispatch({action:"start_registration",screenAfterLogin:e.screen_after}):e.go_home_on_cancel?n.a.dispatch({action:"view_home_page"}):e.go_welcome_on_cancel&&n.a.dispatch({action:"view_welcome_page"})}})}},823:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(8),s=a(150);class i extends n.EventEmitter{constructor(){super(),this._throttledMiddlePanel=Object(s.throttle)(()=>this.emit("middlePanelResized"),200),this._isResizing=!1}get isResizing(){return this._isResizing}startResizing(){this._isResizing=!0,this.emit("isResizing",!0)}stopResizing(){this._isResizing=!1,this.emit("isResizing",!1)}_noisyMiddlePanel(){this.emit("middlePanelResizedNoisy")}_updateMiddlePanel(){this._throttledMiddlePanel(),this._noisyMiddlePanel()}notifyLeftHandleResized(){this._updateMiddlePanel()}notifyRightHandleResized(){this._updateMiddlePanel()}notifyTimelineHeightChanged(){this._updateMiddlePanel()}notifyWindowResized(){this._updateMiddlePanel()}}},824:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(19),s=a.n(n),i=a(100),o=a(103),r=a(596),l=a(115),c=a(123);class d{constructor(){s()(this,"dispatcherRef",void 0),s()(this,"onAction",e=>{e.action===l.a.UpdateFontSize?this.setRootFontSize(e.size):e.action===l.a.UpdateSystemFont&&this.setSystemFont(e)}),s()(this,"setRootFontSize",e=>{const t=Math.max(Math.min(d.MAX_SIZE,e),d.MIN_SIZE);t!==e&&o.b.setValue("baseFontSize",null,c.a.DEVICE,t),document.querySelector(":root").style.fontSize=Object(r.a)(t)}),s()(this,"setSystemFont",e=>{let{useSystemFont:t,font:a}=e;document.body.style.fontFamily=t?a:""}),this.dispatcherRef=null}start(){this.setRootFontSize(o.b.getValue("baseFontSize")),this.setSystemFont({useSystemFont:o.b.getValue("useSystemFont"),font:o.b.getValue("systemFont")}),this.dispatcherRef=i.a.register(this.onAction)}stop(){i.a.unregister(this.dispatcherRef)}}s()(d,"MIN_SIZE",8),s()(d,"MAX_SIZE",15),s()(d,"SIZE_DIFF",5)},825:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(182),c=a(93),d=a(144),m=a(108),u=a(99),h=a(826),p=a(100),g=a(205),f=a(192),v=a(94);let b=Object(v.a)("views.dialogs.CreateCommunityPrototypeDialog")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"avatarUploadRef",r.a.createRef()),i()(this,"onNameChange",e=>{const t=(e.target.value||"").toLowerCase().replace(/[^a-z0-9.\-_]/g,"-");this.setState({name:e.target.value,localpart:t})}),i()(this,"onSubmit",async e=>{if(e.preventDefault(),e.stopPropagation(),!this.state.busy){this.setState({busy:!0});try{let e="";this.state.avatarFile&&(e=await u.a.get().uploadContent(this.state.avatarFile));const t=await u.a.get().createGroup({localpart:this.state.localpart,profile:{name:this.state.name,avatar_url:e}});p.a.dispatch({action:"deselect_tags"},!0),p.a.dispatch({action:"select_tag",tag:t.group_id}),this.props.onFinished(!0),t.room_id?(await f.a.refreshGroupRooms(t.group_id),p.a.dispatch({action:"view_room",room_id:t.room_id}),Object(g.f)(t.room_id,this.state.name)):p.a.dispatch({action:"view_group",group_id:t.group_id,group_is_new:!0})}catch(e){console.error(e),this.setState({busy:!1,error:Object(c.a)("There was an error creating your community. The name may be taken or the server is unable to process your request.")})}}}),i()(this,"onAvatarChanged",e=>{if(e.target.files&&e.target.files.length){this.setState({busy:!0});const t=e.target.files[0],a=new FileReader;a.onload=e=>{this.setState({avatarFile:t,busy:!1,avatarPreview:e.target.result})},a.readAsDataURL(t)}else this.setState({avatarFile:null})}),i()(this,"onChangeAvatar",()=>{this.avatarUploadRef.current&&this.avatarUploadRef.current.click()}),this.state={name:"",localpart:"",error:null,busy:!1,avatarFile:null,avatarPreview:null}}render(){let e=null;this.state.localpart&&(e=r.a.createElement("span",{className:"mx_CreateCommunityPrototypeDialog_communityId"},Object(c.a)("Community ID: +<localpart />:%(domain)s",{domain:u.a.getHomeserverName()},{localpart:()=>r.a.createElement("u",null,this.state.localpart)}),r.a.createElement(h.a,{tooltip:Object(c.a)("Use this when referencing your community to others. The community ID cannot be changed.")})));let t=r.a.createElement("span",{className:"mx_CreateCommunityPrototypeDialog_subtext"},Object(c.a)("You can change this later if needed."));if(this.state.error){const e="mx_CreateCommunityPrototypeDialog_subtext mx_CreateCommunityPrototypeDialog_subtext_error";t=r.a.createElement("span",{className:e},this.state.error)}let a=r.a.createElement("img",{src:this.state.avatarPreview,className:"mx_CreateCommunityPrototypeDialog_avatar"});return this.state.avatarPreview||(a=r.a.createElement("div",{className:"mx_CreateCommunityPrototypeDialog_placeholderAvatar"})),r.a.createElement(l.a,{className:"mx_CreateCommunityPrototypeDialog",onFinished:this.props.onFinished,title:Object(c.a)("What's the name of your community or team?")},r.a.createElement("form",{onSubmit:this.onSubmit},r.a.createElement("div",{className:"mx_Dialog_content"},r.a.createElement("div",{className:"mx_CreateCommunityPrototypeDialog_colName"},r.a.createElement(d.a,{value:this.state.name,onChange:this.onNameChange,placeholder:Object(c.a)("Enter name"),label:Object(c.a)("Enter name")}),t,r.a.createElement("span",{className:"mx_CreateCommunityPrototypeDialog_subtext"}," ",e),r.a.createElement(m.a,{kind:"primary",onClick:this.onSubmit,disabled:this.state.busy},Object(c.a)("Create"))),r.a.createElement("div",{className:"mx_CreateCommunityPrototypeDialog_colAvatar"},r.a.createElement("input",{type:"file",style:{display:"none"},ref:this.avatarUploadRef,accept:"image/*",onChange:this.onAvatarChanged}),r.a.createElement(m.a,{onClick:this.onChangeAvatar,className:"mx_CreateCommunityPrototypeDialog_avatarContainer"},a),r.a.createElement("div",{className:"mx_CreateCommunityPrototypeDialog_tip"},r.a.createElement("b",null,Object(c.a)("Add image (optional)")),r.a.createElement("span",null,Object(c.a)("An image will help people identify your community.")))))))}})||n},8259:function(e,t){e.exports="fonts/Twemoji_Mozilla/TwemojiMozilla-colr.5bb743a.woff2"},826:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(102),c=a.n(l),d=a(293),m=a(93),u=a(94);let h=Object(u.a)("views.elements.InfoTooltip")(n=class extends r.a.PureComponent{constructor(e){super(e),i()(this,"onMouseOver",()=>{this.setState({hover:!0})}),i()(this,"onMouseLeave",()=>{this.setState({hover:!1})}),this.state={hover:!1}}render(){const{tooltip:e,children:t,tooltipClassName:a}=this.props,n=Object(m.a)("Information"),s=this.state.hover?r.a.createElement(d.b,{className:"mx_InfoTooltip_container",tooltipClassName:c()("mx_InfoTooltip_tooltip",a),label:e||n,alignment:d.a.Right}):r.a.createElement("div",null);return r.a.createElement("div",{onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave,className:"mx_InfoTooltip"},r.a.createElement("span",{className:"mx_InfoTooltip_icon","aria-label":n}),t,s)}})||n},8260:function(e,t){e.exports="fonts/Twemoji_Mozilla/TwemojiMozilla-sbix.fb38407.woff2"},827:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return c}));var n=a(19),s=a.n(n),i=a(8),o=a.n(i),r=a(1314);function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}class c extends o.a{static get instance(){return c._instance||(c._instance=new c),c._instance}storeInvite(e,t){const a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({roomId:e},t),n=this.generateIdOf(a);return localStorage.setItem("mx_threepid_invite_"+n,JSON.stringify(a)),this.translateInvite(a)}getWireInvites(){const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a.startsWith("mx_threepid_invite_")&&e.push(JSON.parse(localStorage.getItem(a)))}return e}getInvites(){return this.getWireInvites().map(e=>this.translateInvite(e))}pickBestInvite(){return this.getInvites()[0]}resolveInvite(e){localStorage.removeItem("mx_threepid_invite_"+e.id)}generateIdOf(t){return r.base32.stringify(e.from(JSON.stringify(t)))}translateInvite(e){return{id:this.generateIdOf(e),roomId:e.roomId,toEmail:e.email,signUrl:e.signurl,roomName:e.room_name,roomAvatarUrl:e.room_avatar_url,inviterName:e.inviter_name}}translateToWireFormat(e){return{email:e.toEmail,signurl:e.signUrl,room_name:e.roomName,room_avatar_url:e.roomAvatarUrl,inviter_name:e.inviterName}}}s()(c,"_instance",void 0)}).call(this,a(36).Buffer)},8272:function(e,t,a){},8278:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return ce}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(360),u=a(93),h=a(155),p=a(343),g=a(106),f=a(97),v=a(158),b=a(100),y=a(369),E=a(302),_=a(298),S=a(861),C=a(424),w=a(425),O=a(165),x=a(862),R=a(332),k=a(103),I=a(245),T=a(108),P=a(337),N=a(296),D=a(340),j=a(119),A=a(500),M=a(115),U=a(507),L=a(506),F=a(499),B=a(601),V=a(602),G=a(603),z=a(604),W=a(605),H=a(881),K=a(607),q=a(374),Y=a(282),$=a(299),J=a(142),Q=a(301),X=a(421),Z=a(184),ee=a(267),te=a(220),ae=a(166),ne=a(384),se=a(94),ie=a(150),oe=a(200);let re=function(e){};const le="sandbox"in document.createElement("iframe");let ce=Object(se.a)("structures.GlobitsRoomView")((s=class extends l.a.Component{constructor(t,a){super(t,a),o()(this,"dispatcherRef",void 0),o()(this,"roomStoreToken",void 0),o()(this,"rightPanelStoreToken",void 0),o()(this,"showReadReceiptsWatchRef",void 0),o()(this,"layoutWatcherRef",void 0),o()(this,"unmounted",!1),o()(this,"permalinkCreators",{}),o()(this,"searchId",void 0),o()(this,"roomView",Object(r.createRef)()),o()(this,"searchResultsPanel",Object(r.createRef)()),o()(this,"messagePanel",void 0),o()(this,"onWidgetStoreUpdate",()=>{this.state.room&&this.checkWidgets(this.state.room)}),o()(this,"checkWidgets",e=>{this.setState({hasPinnedWidgets:ee.d.instance.getContainerWidgets(e,ee.a.Top).length>0,showApps:this.shouldShowApps(e)})}),o()(this,"onReadReceiptsChange",()=>{this.setState({showReadReceipts:k.b.getValue("showReadReceipts",this.state.roomId)})}),o()(this,"onRoomViewStoreUpdate",e=>{if(this.unmounted)return;const t=this.props.roomId,a={roomId:t,roomAlias:O.a.getRoomAlias(),roomLoading:O.a.isRoomLoading(),roomLoadError:O.a.getRoomLoadError(),joining:O.a.isJoining(),initialEventId:O.a.getInitialEventId(),isInitialEventHighlighted:O.a.isInitialEventHighlighted(),replyToEvent:O.a.getQuotingEvent(),forwardingEvent:O.a.getForwardingEvent(),shouldPeek:this.state.matrixClientIsReady&&O.a.shouldPeek(),showReadReceipts:k.b.getValue("showReadReceipts",t),wasContextSwitch:O.a.getWasContextSwitch()};if(e||!this.state.shouldPeek||a.shouldPeek||this.context.stopPeeking(),console.log("RVS update:",a.roomId,a.roomAlias,"loading?",a.roomLoading,"joining?",a.joining,"initial?",e,"shouldPeek?",a.shouldPeek),e&&(a.room=this.context.getRoom(a.roomId),a.room&&(a.showApps=this.shouldShowApps(a.room),this.onRoomLoaded(a.room))),null===this.state.roomId&&null!==a.roomId&&!a.initialEventId){const e=x.a.getScrollState(a.roomId);e&&(a.initialEventId=e.focussedEvent,a.initialEventPixelOffset=e.pixelOffset)}this.state.initialEventId!==a.initialEventId&&(a.searchResults=null),this.setState(a),e&&this.setupRoom(a.room,a.roomId,a.joining,a.shouldPeek)}),o()(this,"getRoomId",()=>this.state.room?this.state.room.roomId:this.state.roomId),o()(this,"onWidgetEchoStoreUpdate",()=>{this.state.room&&this.setState({hasPinnedWidgets:ee.d.instance.getContainerWidgets(this.state.room,ee.a.Top).length>0,showApps:this.shouldShowApps(this.state.room)})}),o()(this,"onWidgetLayoutChange",()=>{this.onWidgetEchoStoreUpdate()}),o()(this,"onUserScroll",()=>{this.state.initialEventId&&this.state.isInitialEventHighlighted&&b.a.dispatch({action:"view_room",room_id:this.state.room.roomId,event_id:this.state.initialEventId,highlighted:!1})}),o()(this,"onLayoutChange",()=>{this.setState({layout:k.b.getValue("layout")})}),o()(this,"onRightPanelStoreUpdate",()=>{this.setState({showRightPanel:P.a.getSharedInstance().isOpenForRoom})}),o()(this,"onPageUnload",e=>p.a.sharedInstance().getCurrentUploads().length>0?e.returnValue=Object(u.a)("You seem to be uploading files, are you sure you want to quit?"):this.getCallForRoom()&&"ended"!==this.state.callState?e.returnValue=Object(u.a)("You seem to be in a call, are you sure you want to quit?"):void 0),o()(this,"onReactKeyDown",e=>{let t=!1;switch(Object(te.f)().getRoomAction(e)){case te.d.DismissReadMarker:this.messagePanel.forgetReadMarker(),this.jumpToLiveTimeline(),t=!0;break;case te.d.JumpToOldestUnread:this.jumpToReadMarker(),t=!0;break;case te.d.UploadFile:b.a.dispatch({action:"upload_file"},!0),t=!0}t&&(e.stopPropagation(),e.preventDefault())}),o()(this,"onAction",t=>{switch(t.action){case"message_sent":this.checkDesktopNotifications();break;case"post_sticker_message":this.injectSticker(t.data.content.url,t.data.content.info,t.data.description||t.data.name);break;case"picture_snapshot":p.a.sharedInstance().sendContentListToRoom([t.file],this.state.room.roomId,this.context);break;case"notifier_enabled":case M.a.UploadStarted:case M.a.UploadFinished:case M.a.UploadCanceled:this.forceUpdate();break;case"call_state":{if(!t.room_id)return;const e=this.getCallForRoom();this.setState({callState:e?e.state:null});break}case"appsDrawer":this.setState({showApps:t.show});break;case"reply_to_event":this.state.searchResults&&t.event.getRoomId()===this.state.roomId&&!this.unmounted&&this.onCancelSearchClick();break;case"quote":if(this.state.searchResults){const a=t.event.getRoomId();a===this.state.roomId&&this.onCancelSearchClick(),e(()=>{b.a.dispatch({action:"view_room",room_id:a,deferred_action:t})})}break;case"sync_state":this.state.matrixClientIsReady||this.setState({matrixClientIsReady:this.context&&this.context.isInitialSyncComplete()},()=>{this.onRoomViewStoreUpdate(!0)});break;case"focus_search":this.onSearchClick()}}),o()(this,"onRoomTimeline",(e,t,a,n,s)=>{this.unmounted||t&&this.state.room&&t.roomId==this.state.room.roomId&&s.timeline.getTimelineSet()===t.getUnfilteredTimelineSet()&&("org.matrix.room.preview_urls"===e.getType()&&this.updatePreviewUrlVisibility(t),"m.room.encryption"===e.getType()&&this.updateE2EStatus(t),!a&&s&&s.liveEvent&&(this.state.joining||e.getSender()!==this.context.credentials.userId&&(!this.state.searchResults&&this.state.atEndOfLiveTimeline||Object(m.a)(e)||this.setState((e,t)=>({numUnreadMessages:e.numUnreadMessages+1})))))}),o()(this,"onEventDecrypted",e=>{e.isDecryptionFailure()||this.handleEffects(e)}),o()(this,"onEvent",e=>{e.isBeingDecrypted()||e.isDecryptionFailure()||this.handleEffects(e)}),o()(this,"handleEffects",e=>{if(!this.state.room||!this.state.matrixClientIsReady)return;if(e.getRoomId()!==this.state.room.roomId)return;Z.a.instance.getRoomState(this.state.room).isUnread&&Y.CHAT_EFFECTS.forEach(t=>{(Object(q.containsEmoji)(e.getContent(),t.emojis)||e.getContent().msgtype===t.msgType)&&b.a.dispatch({action:"effects."+t.command})})}),o()(this,"onRoomName",e=>{this.state.room&&e.roomId==this.state.room.roomId&&this.forceUpdate()}),o()(this,"onKeyBackupStatus",()=>{this.forceUpdate()}),o()(this,"canResetTimeline",()=>!this.messagePanel||this.messagePanel.canResetTimeline()),o()(this,"onRoomLoaded",e=>{ee.d.instance.on(ee.d.emissionForRoom(e),this.onWidgetLayoutChange),this.onWidgetLayoutChange(),this.calculatePeekRules(e),this.updatePreviewUrlVisibility(e),this.loadMembersIfJoined(e),this.calculateRecommendedVersion(e),this.updateE2EStatus(e),this.updatePermissions(e),this.checkWidgets(e)}),o()(this,"onRoom",e=>{e&&e.roomId===this.state.roomId&&(this.state.room&&ee.d.instance.off(ee.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),this.setState({room:e},()=>{this.onRoomLoaded(e)}))}),o()(this,"onDeviceVerificationChanged",(e,t)=>{const a=this.state.room;a.currentState.getMember(e)&&this.updateE2EStatus(a)}),o()(this,"onUserVerificationChanged",(e,t)=>{const a=this.state.room;a&&a.currentState.getMember(e)&&this.updateE2EStatus(a)}),o()(this,"onCrossSigningKeysChanged",()=>{const e=this.state.room;e&&this.updateE2EStatus(e)}),o()(this,"onAccountData",e=>{const t=e.getType();"org.matrix.preview_urls"!==t&&"im.vector.web.settings"!==t||!this.state.room||this.updatePreviewUrlVisibility(this.state.room)}),o()(this,"onRoomAccountData",(e,t)=>{if(t.roomId==this.state.roomId){const a=e.getType();if("org.matrix.room.color_scheme"===a){const t=e.getContent();console.log("Tinter.tint from onRoomAccountData"),y.a.tint(t.primary_color,t.secondary_color)}else"org.matrix.room.preview_urls"!==a&&"im.vector.web.settings"!==a||this.updatePreviewUrlVisibility(t)}}),o()(this,"onRoomStateEvents",(e,t)=>{this.state.room&&this.state.room.roomId===t.roomId&&this.updatePermissions(this.state.room)}),o()(this,"onRoomStateMember",(e,t,a)=>{this.state.room&&a.roomId===this.state.room.roomId&&this.updateRoomMembers(a)}),o()(this,"onMyMembership",(e,t,a)=>{e.roomId===this.state.roomId&&(this.forceUpdate(),this.loadMembersIfJoined(e),this.updatePermissions(e))}),o()(this,"updateRoomMembers",Object(E.a)(()=>{this.updateDMState(),this.updateE2EStatus(this.state.room)},500)),o()(this,"onSearchResultsFillRequest",e=>{if(!e)return Promise.resolve(!1);if(this.state.searchResults.next_batch){re("requesting more search results");const e=Object(S.b)(this.state.searchResults);return this.handleSearchResult(e)}return re("no more search results"),Promise.resolve(!1)}),o()(this,"onInviteButtonClick",()=>{b.a.dispatch({action:"view_invite",roomId:this.state.room.roomId})}),o()(this,"onJoinButtonClicked",()=>{this.context&&this.context.isGuest()?(b.a.dispatch({action:"do_after_sync_prepared",deferred_action:{action:"view_room",room_id:this.getRoomId()}}),b.a.dispatch({action:"require_registration"})):Promise.resolve().then(()=>{var e;const t=null===(e=this.props.threepidInvite)||void 0===e?void 0:e.signUrl;return b.a.dispatch({action:M.a.JoinRoom,roomId:this.getRoomId(),opts:{inviteSignUrl:t},_type:"unknown"}),Promise.resolve()})}),o()(this,"onMessageListScroll",e=>{this.messagePanel.isAtEndOfLiveTimeline()?this.setState({numUnreadMessages:0,atEndOfLiveTimeline:!0}):this.setState({atEndOfLiveTimeline:!1}),this.updateTopUnreadMessagesBar()}),o()(this,"onDragEnter",e=>{e.stopPropagation(),e.preventDefault(),this.setState({dragCounter:this.state.dragCounter+1}),(e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"))&&this.setState({draggingFile:!0})}),o()(this,"onDragLeave",e=>{e.stopPropagation(),e.preventDefault(),this.setState({dragCounter:this.state.dragCounter-1}),0===this.state.dragCounter&&this.setState({draggingFile:!1})}),o()(this,"onDragOver",e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="none",(e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"))&&(e.dataTransfer.dropEffect="copy")}),o()(this,"onDrop",e=>{e.stopPropagation(),e.preventDefault(),p.a.sharedInstance().sendContentListToRoom(e.dataTransfer.files,this.state.room.roomId,this.context),b.a.fire(M.a.FocusComposer),this.setState({draggingFile:!1,dragCounter:this.state.dragCounter-1})}),o()(this,"onSearch",(e,t)=>{let a;this.setState({searchTerm:e,searchScope:t,searchResults:{},searchHighlights:[]}),this.searchResultsPanel.current&&this.searchResultsPanel.current.resetScrollState(),this.searchId=(new Date).getTime(),"Room"===t&&(a=this.state.room.roomId),re("sending search request");const n=Object(S.a)(e,a);this.handleSearchResult(n)}),o()(this,"onCallPlaced",e=>{b.a.dispatch({action:"place_call",type:e,room_id:this.state.room.roomId})}),o()(this,"onSettingsClick",()=>{b.a.dispatch({action:"open_room_settings"})}),o()(this,"onCancelClick",()=>{console.log("updateTint from onCancelClick"),this.updateTint(),this.state.forwardingEvent&&b.a.dispatch({action:"forward_event",event:null}),b.a.fire(M.a.FocusComposer)}),o()(this,"onAppsClick",()=>{b.a.dispatch({action:"appsDrawer",show:!this.state.showApps})}),o()(this,"onLeaveClick",()=>{b.a.dispatch({action:"leave_room",room_id:this.state.room.roomId})}),o()(this,"onForgetClick",()=>{b.a.dispatch({action:"forget_room",room_id:this.state.room.roomId})}),o()(this,"onRejectButtonClicked",()=>{this.setState({rejecting:!0}),this.context.leave(this.state.roomId).then(()=>{b.a.dispatch({action:"view_home_page"}),this.setState({rejecting:!1})},e=>{console.error("Failed to reject invite: %s",e);const t=e.message?e.message:JSON.stringify(e),a=f.getComponent("dialogs.ErrorDialog");g.a.createTrackedDialog("Failed to reject invite","",a,{title:Object(u.a)("Failed to reject invite"),description:t}),this.setState({rejecting:!1,rejectError:e})})}),o()(this,"onRejectAndIgnoreClick",async()=>{this.setState({rejecting:!0});try{const e=this.state.room.getMember(this.context.getUserId()).events.member,t=this.context.getIgnoredUsers();t.push(e.getSender()),await this.context.setIgnoredUsers(t),await this.context.leave(this.state.roomId),b.a.dispatch({action:"view_home_page"}),this.setState({rejecting:!1})}catch(e){console.error("Failed to reject invite: %s",e);const t=e.message?e.message:JSON.stringify(e),a=f.getComponent("dialogs.ErrorDialog");g.a.createTrackedDialog("Failed to reject invite","",a,{title:Object(u.a)("Failed to reject invite"),description:t}),this.setState({rejecting:!1,rejectError:e})}}),o()(this,"onRejectThreepidInviteButtonClicked",()=>{b.a.fire(M.a.ViewRoomDirectory)}),o()(this,"onSearchClick",()=>{this.setState({searching:!this.state.searching})}),o()(this,"onCancelSearchClick",()=>{this.setState({searching:!1,searchResults:null})}),o()(this,"jumpToLiveTimeline",()=>{b.a.dispatch({action:"view_room",room_id:this.state.room.roomId})}),o()(this,"jumpToReadMarker",()=>{this.messagePanel.jumpToReadMarker()}),o()(this,"forgetReadMarker",e=>{e.stopPropagation(),this.messagePanel.forgetReadMarker()}),o()(this,"updateTopUnreadMessagesBar",()=>{if(!this.messagePanel)return;const e=this.messagePanel.canJumpToReadMarker();this.state.showTopUnreadMessagesBar!=e&&this.setState({showTopUnreadMessagesBar:e})}),o()(this,"onResize",()=>{let e=oe.b.instance.windowHeight-261;e<50&&(e=50),this.setState({auxPanelMaxHeight:e})}),o()(this,"onStatusBarVisible",()=>{this.unmounted||this.setState({statusBarVisible:!0})}),o()(this,"onStatusBarHidden",()=>{this.unmounted||this.setState({statusBarVisible:!1})}),o()(this,"gatherTimelinePanelRef",e=>{this.messagePanel=e,e&&(console.log("updateTint from RoomView.gatherTimelinePanelRef"),this.updateTint())}),o()(this,"onHiddenHighlightsClick",()=>{const e=this.getOldRoom();e&&b.a.dispatch({action:"view_room",room_id:e.roomId})});const n=this.context.hasLazyLoadMembersEnabled();this.state={roomId:null,roomLoading:!0,peekLoading:!1,shouldPeek:!0,membersLoaded:!n,numUnreadMessages:0,draggingFile:!1,searching:!1,searchResults:null,callState:null,guestsCanJoin:!1,canPeek:!1,showApps:!1,isPeeking:!1,showReadReceipts:!0,showRightPanel:P.a.getSharedInstance().isOpenForRoom,joining:!1,atEndOfLiveTimeline:!0,atEndOfLiveTimelineInit:!1,showTopUnreadMessagesBar:!1,statusBarVisible:!1,canReact:!1,canReply:!1,layout:k.b.getValue("layout"),matrixClientIsReady:this.context&&this.context.isInitialSyncComplete(),dragCounter:0},this.dispatcherRef=b.a.register(this.onAction),this.context.on("Room",this.onRoom),this.context.on("Room.timeline",this.onRoomTimeline),this.context.on("Room.name",this.onRoomName),this.context.on("Room.accountData",this.onRoomAccountData),this.context.on("RoomState.events",this.onRoomStateEvents),this.context.on("RoomState.members",this.onRoomStateMember),this.context.on("Room.myMembership",this.onMyMembership),this.context.on("accountData",this.onAccountData),this.context.on("crypto.keyBackupStatus",this.onKeyBackupStatus),this.context.on("deviceVerificationChanged",this.onDeviceVerificationChanged),this.context.on("userTrustStatusChanged",this.onUserVerificationChanged),this.context.on("crossSigning.keysChanged",this.onCrossSigningKeysChanged),this.context.on("Event.decrypted",this.onEventDecrypted),this.context.on("event",this.onEvent),this.roomStoreToken=O.a.addListener(this.onRoomViewStoreUpdate),this.rightPanelStoreToken=P.a.getSharedInstance().addListener(this.onRightPanelStoreUpdate),R.a.on(J.b,this.onWidgetEchoStoreUpdate),$.a.instance.on(J.b,this.onWidgetStoreUpdate),this.showReadReceiptsWatchRef=k.b.watchSetting("showReadReceipts",null,this.onReadReceiptsChange),this.layoutWatcherRef=k.b.watchSetting("layout",null,this.onLayoutChange)}getPermalinkCreatorForRoom(e){return this.permalinkCreators[e.roomId]||(this.permalinkCreators[e.roomId]=new h.a(e),this.state.room&&e.roomId===this.state.room.roomId?this.permalinkCreators[e.roomId].start():this.permalinkCreators[e.roomId].load()),this.permalinkCreators[e.roomId]}stopAllPermalinkCreators(){if(this.permalinkCreators)for(const e of Object.keys(this.permalinkCreators))this.permalinkCreators[e].stop()}setupRoom(e,t,a,n){!a&&t&&(!e&&n?(console.info("Attempting to peek into room %s",t),this.setState({peekLoading:!0,isPeeking:!0}),this.context.peekInRoom(t).then(e=>{this.unmounted||(this.setState({room:e,peekLoading:!1}),this.onRoomLoaded(e))}).catch(e=>{if(!this.unmounted){if(this.setState({isPeeking:!1}),"M_GUEST_ACCESS_FORBIDDEN"!==e.errcode&&"M_FORBIDDEN"!==e.errcode)throw e;this.setState({peekLoading:!1})}})):e&&(this.context.stopPeeking(),this.setState({isPeeking:!1})))}shouldShowApps(e){if(!le||!e)return!1;const t="false"===localStorage.getItem(e.roomId+"_hide_widget_drawer");return ee.d.instance.getContainerWidgets(e,ee.a.Top).length>0||t}componentDidMount(){this.onRoomViewStoreUpdate(!0);const e=this.getCallForRoom(),t=e?e.state:null;this.setState({callState:t}),window.addEventListener("beforeunload",this.onPageUnload),this.props.resizeNotifier&&this.props.resizeNotifier.on("middlePanelResized",this.onResize),this.onResize()}shouldComponentUpdate(e,t){const a=Object(ae.c)(this.props,e),n=t.upgradeRecommendation||{},s=Object(ie.omit)(this.state,["upgradeRecommendation"]),i=Object(ie.omit)(t,["upgradeRecommendation"]),o=Object(ae.c)(s,i)||!0===n.needsUpgrade;return a||o}componentDidUpdate(){if(this.roomView.current){const e=this.roomView.current;e.ondrop||(e.addEventListener("drop",this.onDrop),e.addEventListener("dragover",this.onDragOver),e.addEventListener("dragenter",this.onDragEnter),e.addEventListener("dragleave",this.onDragLeave))}this.messagePanel&&!this.state.atEndOfLiveTimelineInit&&this.setState({atEndOfLiveTimelineInit:!0,atEndOfLiveTimeline:this.messagePanel.isAtEndOfLiveTimeline()})}componentWillUnmount(){if(this.unmounted=!0,this.state.roomId&&x.a.setScrollState(this.state.roomId,this.getScrollState()),this.state.shouldPeek&&this.context.stopPeeking(),this.stopAllPermalinkCreators(),this.roomView.current){const e=this.roomView.current;e.removeEventListener("drop",this.onDrop),e.removeEventListener("dragover",this.onDragOver),e.removeEventListener("dragenter",this.onDragEnter),e.removeEventListener("dragleave",this.onDragLeave)}b.a.unregister(this.dispatcherRef),this.context&&(this.context.removeListener("Room",this.onRoom),this.context.removeListener("Room.timeline",this.onRoomTimeline),this.context.removeListener("Room.name",this.onRoomName),this.context.removeListener("Room.accountData",this.onRoomAccountData),this.context.removeListener("RoomState.events",this.onRoomStateEvents),this.context.removeListener("Room.myMembership",this.onMyMembership),this.context.removeListener("RoomState.members",this.onRoomStateMember),this.context.removeListener("accountData",this.onAccountData),this.context.removeListener("crypto.keyBackupStatus",this.onKeyBackupStatus),this.context.removeListener("deviceVerificationChanged",this.onDeviceVerificationChanged),this.context.removeListener("userTrustStatusChanged",this.onUserVerificationChanged),this.context.removeListener("crossSigning.keysChanged",this.onCrossSigningKeysChanged),this.context.removeListener("Event.decrypted",this.onEventDecrypted),this.context.removeListener("event",this.onEvent)),window.removeEventListener("beforeunload",this.onPageUnload),this.props.resizeNotifier&&this.props.resizeNotifier.removeListener("middlePanelResized",this.onResize),this.roomStoreToken&&this.roomStoreToken.remove(),this.rightPanelStoreToken&&this.rightPanelStoreToken.remove(),R.a.removeListener(J.b,this.onWidgetEchoStoreUpdate),$.a.instance.removeListener(J.b,this.onWidgetStoreUpdate),this.state.room&&ee.d.instance.off(ee.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),this.showReadReceiptsWatchRef&&k.b.unwatchSetting(this.showReadReceiptsWatchRef),this.updateRoomMembers.cancelPendingCall(),k.b.unwatchSetting(this.layoutWatcherRef)}async calculateRecommendedVersion(e){this.setState({upgradeRecommendation:await e.getRecommendedVersion()})}async loadMembersIfJoined(e){if(this.context.hasLazyLoadMembersEnabled()&&e&&"join"===e.getMyMembership())try{await e.loadMembersIfNeeded(),this.unmounted||this.setState({membersLoaded:!0})}catch(t){const a=`Fetching room members for ${e.roomId} failed. Room members will appear incomplete.`;console.error(a),console.error(t)}}calculatePeekRules(e){const t=e.currentState.getStateEvents("m.room.guest_access","");t&&"can_join"===t.getContent().guest_access&&this.setState({guestsCanJoin:!0});const a=e.currentState.getStateEvents("m.room.history_visibility","");a&&"world_readable"===a.getContent().history_visibility&&this.setState({canPeek:!0})}updatePreviewUrlVisibility(e){let{roomId:t}=e;const a=this.context.isRoomEncrypted(t)?"urlPreviewsEnabled_e2ee":"urlPreviewsEnabled";this.setState({showUrlPreview:k.b.getValue(a,t)})}async updateE2EStatus(e){this.context.isRoomEncrypted(e.roomId)&&(this.context.isCryptoEnabled()?this.setState({e2eStatus:await Object(A.b)(this.context,e)}):this.setState({e2eStatus:A.a.Warning}))}updateTint(){const e=this.state.room;if(!e)return;console.log("Tinter.tint from updateTint");const t=k.b.getValue("roomColor",e.roomId);y.a.tint(t.primary_color,t.secondary_color)}updatePermissions(e){if(e){const t=this.context.getUserId(),a="join"===e.getMyMembership()&&e.currentState.maySendEvent("m.reaction",t),n=e.maySendMessage();this.setState({canReact:a,canReply:n})}}checkDesktopNotifications(){this.state.room.getJoinedMemberCount()+this.state.room.getInvitedMemberCount()>1&&Q.default.shouldShowPrompt()&&Object(X.b)(!0)}updateDMState(){const e=this.state.room;if("join"!=e.getMyMembership())return;const t=e.getDMInviter();t&&_.c(e.roomId,t)}injectSticker(e,t,a){this.context.isGuest()?b.a.dispatch({action:"require_registration"}):p.a.sharedInstance().sendStickerContentToRoom(e,this.state.room.roomId,t,a,this.context).then(void 0,e=>{e.name})}handleSearchResult(e){const t=this.searchId;return this.setState({searchInProgress:!0}),e.then(e=>{if(re("search complete"),this.unmounted||!this.state.searching||this.searchId!=t)return void console.error("Discarding stale search results");let a=e.highlights;a.indexOf(this.state.searchTerm)<0&&(a=a.concat(this.state.searchTerm)),a=a.sort((function(e,t){return t.length-e.length})),this.setState({searchHighlights:a,searchResults:e})},e=>{const t=f.getComponent("dialogs.ErrorDialog");console.error("Search failed",e),g.a.createTrackedDialog("Search failed","",t,{title:Object(u.a)("Search failed"),description:e&&e.message?e.message:Object(u.a)("Server may be unavailable, overloaded, or search timed out :(")})}).finally(()=>{this.setState({searchInProgress:!1})})}getSearchResultTiles(){const e=f.getComponent("rooms.SearchResultTile"),t=f.getComponent("elements.Spinner"),a=[];var n,s;(this.state.searchInProgress&&a.push(l.a.createElement("li",{key:"search-spinner"},l.a.createElement(t,null))),this.state.searchResults.next_batch)||(null!==(n=this.state.searchResults)&&void 0!==n&&null!==(s=n.results)&&void 0!==s&&s.length?a.push(l.a.createElement("li",{key:"search-top-marker"},l.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(u.a)("No more results")))):a.push(l.a.createElement("li",{key:"search-top-marker"},l.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(u.a)("No results")))));const i=()=>{const e=this.searchResultsPanel.current;e&&e.checkScroll()};let o;for(let t=((null===(r=this.state.searchResults)||void 0===r||null===(c=r.results)||void 0===c?void 0:c.length)||0)-1;t>=0;t--){var r,c;const n=this.state.searchResults.results[t],s=n.context.getEvent(),d=s.getRoomId(),m=this.context.getRoom(d);if(!m){console.log("Hiding search result from an unknown room",d);continue}if(!Object(N.b)(s))continue;"All"===this.state.searchScope&&d!==o&&(a.push(l.a.createElement("li",{key:s.getId()+"-room"},l.a.createElement("h2",null,Object(u.a)("Room"),": ",m.name))),o=d);const h="#/room/"+d+"/"+s.getId();a.push(l.a.createElement(e,{key:s.getId(),searchResult:n,searchHighlights:this.state.searchHighlights,resultLink:h,permalinkCreator:this.getPermalinkCreatorForRoom(m),onHeightChanged:i}))}return a}getScrollState(){const e=this.messagePanel;if(!e)return null;if(this.state.atEndOfLiveTimeline)return null;const t=e.getScrollState();return!t||t.stuckAtBottom?null:{focussedEvent:t.trackedScrollToken,pixelOffset:t.pixelOffset}}getCallForRoom(){return this.state.room?v.d.sharedInstance().getCallForRoom(this.state.room.roomId):null}getOldRoom(){const e=this.state.room.currentState.getStateEvents("m.room.create","");return e&&e.getContent().predecessor?this.context.getRoom(e.getContent().predecessor.room_id):null}getHiddenHighlightCount(){const e=this.getOldRoom();return e?e.getUnreadNotificationCount("highlight"):0}render(){var e;if(!this.state.room){const e=!this.state.matrixClientIsReady||this.state.roomLoading||this.state.peekLoading;if(e){const t=!this.state.matrixClientIsReady||!this.state.roomId||this.state.peekLoading;return l.a.createElement("div",{className:"mx_RoomView"},l.a.createElement(F.a,null,l.a.createElement(B.a,{canPreview:!1,previewLoading:t&&!this.state.roomLoadError,error:this.state.roomLoadError,loading:e,joining:this.state.joining,oobData:this.props.oobData})))}{var t,n;let e=void 0;this.props.oobData&&(e=this.props.oobData.inviterName);const a=null===(t=this.props.threepidInvite)||void 0===t?void 0:t.toEmail,s=this.state.roomAlias;return l.a.createElement("div",{className:"mx_RoomView"},l.a.createElement(F.a,null,l.a.createElement(B.a,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,canPreview:!1,error:this.state.roomLoadError,roomAlias:s,joining:this.state.joining,inviterName:e,invitedEmail:a,oobData:this.props.oobData,signUrl:null===(n=this.props.threepidInvite)||void 0===n?void 0:n.signUrl,room:this.state.room})))}}const s=this.state.room.getMyMembership();if(!("invite"!==s||k.b.getValue("feature_spaces")&&this.state.room.isSpaceRoom())){if(this.state.joining||this.state.rejecting)return l.a.createElement(F.a,null,l.a.createElement(B.a,{canPreview:!1,error:this.state.roomLoadError,joining:this.state.joining,rejecting:this.state.rejecting}));{const e=this.context.credentials.userId,t=this.state.room.getMember(e),a=t?t.events.member:null;let n=Object(u.a)("Unknown");return a&&(n=a.sender?a.sender.name:a.getSender()),l.a.createElement("div",{className:"mx_RoomView"},l.a.createElement(F.a,null,l.a.createElement(B.a,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectButtonClicked,onRejectAndIgnoreClick:this.onRejectAndIgnoreClick,inviterName:n,canPreview:!1,joining:this.state.joining,room:this.state.room})))}}let i=null;this.state.draggingFile&&(i=l.a.createElement("div",{className:"mx_RoomView_fileDropTarget"},l.a.createElement("img",{src:a(867),className:"mx_RoomView_fileDropTarget_image"}),Object(u.a)("Drop file here to upload")));let o=null;{const e=this.getCallForRoom();e&&"ended"!==this.state.callState&&"ringing"!==this.state.callState&&(o=e)}const r=d()({mx_RoomView_scrollheader:!0});let c,m=!0;if(p.a.sharedInstance().getCurrentUploads().length>0){const e=f.getComponent("structures.UploadBar");c=l.a.createElement(e,{room:this.state.room})}else if(!this.state.searchResults){const e=f.getComponent("structures.RoomStatusBar");m=this.state.statusBarVisible,c=l.a.createElement(e,{room:this.state.room,isPeeking:"join"!==s,onInviteClick:this.onInviteButtonClick,onVisible:this.onStatusBarVisible,onHidden:this.onStatusBarHidden})}const h=this.state.upgradeRecommendation,g=h&&h.needsUpgrade&&this.state.room.userMayUpgradeRoom(this.context.credentials.userId),v=this.getHiddenHighlightCount();let b,y=null,E=!1;if(this.state.forwardingEvent)y=l.a.createElement(V.a,{onCancelClick:this.onCancelClick});else if(this.state.searching)E=!0,y=l.a.createElement(G.a,{searchInProgress:this.state.searchInProgress,onCancelClick:this.onCancelSearchClick,onSearch:this.onSearch,isRoomEncrypted:this.context.isRoomEncrypted(this.state.room.roomId)});else if(g)y=l.a.createElement(z.a,{room:this.state.room,recommendation:h}),E=!0;else if("join"!==s){var _,S;let e=void 0;this.props.oobData&&(e=this.props.oobData.inviterName);const t=null===(_=this.props.threepidInvite)||void 0===_?void 0:_.toEmail;if(E=!0,b=l.a.createElement(B.a,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,joining:this.state.joining,inviterName:e,invitedEmail:t,oobData:this.props.oobData,canPreview:this.state.canPeek,room:this.state.room}),!(this.state.canPeek||k.b.getValue("feature_spaces")&&null!==(S=this.state.room)&&void 0!==S&&S.isSpaceRoom()))return l.a.createElement("div",{className:"mx_RoomView"},b)}else v>0&&(y=l.a.createElement(T.a,{element:"div",className:"mx_RoomView_auxPanel_hiddenHighlights",onClick:this.onHiddenHighlightsClick},Object(u.a)("You have %(count)s unread notifications in a prior version of this room.",{count:v})));if(null!==(e=this.state.room)&&void 0!==e&&e.isSpaceRoom())return l.a.createElement(ne.b,{space:this.state.room,justCreatedOpts:this.props.justCreatedOpts,resizeNotifier:this.props.resizeNotifier,onJoinButtonClicked:this.onJoinButtonClicked,onRejectButtonClicked:this.props.threepidInvite?this.onRejectThreepidInviteButtonClicked:this.onRejectButtonClicked});const O=l.a.createElement(W.a,{room:this.state.room,fullHeight:!1,userId:this.context.credentials.userId,maxHeight:this.state.auxPanelMaxHeight,showApps:this.state.showApps,onResize:this.onResize,resizeNotifier:this.props.resizeNotifier},y);let x,R;if("join"===s&&!this.state.searchResults){const e=f.getComponent("rooms.MessageComposer");x=l.a.createElement(e,{room:this.state.room,callState:this.state.callState,showApps:this.state.showApps,e2eStatus:this.state.e2eStatus,resizeNotifier:this.props.resizeNotifier,replyToEvent:this.state.replyToEvent,permalinkCreator:this.getPermalinkCreatorForRoom(this.state.room)})}let P;this.state.searchResults&&(R={searchTerm:this.state.searchTerm,searchScope:this.state.searchScope,searchCount:this.state.searchResults.count});let N=!1;this.state.searchResults&&(P=void 0===this.state.searchResults.count?l.a.createElement("div",{className:"mx_RoomView_messagePanel mx_RoomView_messagePanelSearchSpinner"}):l.a.createElement(U.a,{ref:this.searchResultsPanel,className:"mx_RoomView_messagePanel mx_RoomView_searchResultsPanel mx_GroupLayout",onFillRequest:this.onSearchResultsFillRequest,resizeNotifier:this.props.resizeNotifier},l.a.createElement("li",{className:r}),this.getSearchResultTiles()),N=!0);const j=this.state.isInitialEventHighlighted;let A=null;this.state.forwardingEvent?A=this.state.forwardingEvent.getId():j&&(A=this.state.initialEventId);const M=d()("mx_RoomView_messagePanel",{mx_IRCLayout:this.state.layout==I.a.IRC,mx_GroupLayout:this.state.layout==I.a.Group}),q=l.a.createElement(L.a,{ref:this.gatherTimelinePanelRef,timelineSet:this.state.room.getUnfilteredTimelineSet(),showReadReceipts:this.state.showReadReceipts,manageReadReceipts:!this.state.isPeeking,sendReadReceiptOnLoad:!this.state.wasContextSwitch,manageReadMarkers:!this.state.isPeeking,hidden:N,highlightedEventId:A,eventId:this.state.initialEventId,eventPixelOffset:this.state.initialEventPixelOffset,onScroll:this.onMessageListScroll,onUserScroll:this.onUserScroll,onReadMarkerUpdated:this.updateTopUnreadMessagesBar,showUrlPreview:this.state.showUrlPreview,className:M,membersLoaded:this.state.membersLoaded,permalinkCreator:this.getPermalinkCreatorForRoom(this.state.room),resizeNotifier:this.props.resizeNotifier,showReactions:!0,layout:this.state.layout});let Y,$=null;if(this.state.showTopUnreadMessagesBar&&!this.state.searchResults){const e=f.getComponent("rooms.TopUnreadMessagesBar");$=l.a.createElement(e,{onScrollUpClick:this.jumpToReadMarker,onCloseClick:this.forgetReadMarker})}if(!this.state.atEndOfLiveTimeline&&!this.state.searchResults){const e=f.getComponent("rooms.JumpToBottomButton");Y=l.a.createElement(e,{highlight:this.state.room.getUnreadNotificationCount("highlight")>0,numUnreadMessages:this.state.numUnreadMessages,onScrollToBottomClick:this.jumpToLiveTimeline,roomId:this.state.roomId})}const J=d()("mx_RoomView_statusArea",{mx_RoomView_statusArea_expanded:m}),Q=this.state.room&&this.state.showRightPanel?l.a.createElement(w.a,{room:this.state.room,resizeNotifier:this.props.resizeNotifier}):null,X=d()("mx_RoomView_timeline",{mx_RoomView_timeline_rr_enabled:this.state.showReadReceipts}),Z=d()("mx_RoomView",{mx_RoomView_inCall:Boolean(o)}),ee=k.b.getValue("showChatEffects");return l.a.createElement(D.a.Provider,{value:this.state},l.a.createElement("main",{className:Z,ref:this.roomView,onKeyDown:this.onReactKeyDown},ee&&this.roomView.current&&l.a.createElement(K.a,{roomWidth:this.roomView.current.offsetWidth}),l.a.createElement(F.a,null,l.a.createElement(H.a,{room:this.state.room,searchInfo:R,oobData:this.props.oobData,inRoom:"join"===s,onSearchClick:this.onSearchClick,onSettingsClick:this.onSettingsClick,onCancelClick:y&&!E?this.onCancelClick:null,onForgetClick:"leave"===s?this.onForgetClick:null,onLeaveClick:"join"===s?this.onLeaveClick:null,e2eStatus:this.state.e2eStatus,onAppsClick:this.state.hasPinnedWidgets?this.onAppsClick:null,appsShown:this.state.showApps,onCallPlaced:this.onCallPlaced}),l.a.createElement(C.a,{panel:Q,resizeNotifier:this.props.resizeNotifier},l.a.createElement("div",{className:"mx_RoomView_body"},O,l.a.createElement("div",{className:X},i,$,Y,q,P),l.a.createElement("div",{className:J},l.a.createElement("div",{className:"mx_RoomView_statusAreaBox"},l.a.createElement("div",{className:"mx_RoomView_statusAreaBox_line"}),c)),b,x)))))}},o()(s,"contextType",j.a),n=s))||n}).call(this,a(212).setImmediate)},828:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n,s=a(19),i=a.n(s),o=a(88),r=a(93),l=a(108),c=a(144),d=a(829),m=a(100),u=a(94),h=a(115);let p=Object(u.a)("views.voip.DialPadModal")(n=class extends o.PureComponent{constructor(e){super(e),i()(this,"onCancelClick",()=>{this.props.onFinished(!1)}),i()(this,"onChange",e=>{this.setState({value:e.target.value})}),i()(this,"onFormSubmit",e=>{e.preventDefault(),this.onDialPress()}),i()(this,"onDigitPress",e=>{this.setState({value:this.state.value+e})}),i()(this,"onDeletePress",()=>{0!==this.state.value.length&&this.setState({value:this.state.value.slice(0,-1)})}),i()(this,"onDialPress",async()=>{const e={action:h.a.DialNumber,number:this.state.value};m.a.dispatch(e),this.props.onFinished(!0)}),this.state={value:""}}render(){return o.createElement("div",{className:"mx_DialPadModal"},o.createElement("div",{className:"mx_DialPadModal_header"},o.createElement("div",null,o.createElement("span",{className:"mx_DialPadModal_title"},Object(r.a)("Dial pad")),o.createElement(l.a,{className:"mx_DialPadModal_cancel",onClick:this.onCancelClick})),o.createElement("form",{onSubmit:this.onFormSubmit},o.createElement(c.a,{className:"mx_DialPadModal_field",id:"dialpad_number",value:this.state.value,autoFocus:!0,onChange:this.onChange}))),o.createElement("div",{className:"mx_DialPadModal_horizSep"}),o.createElement("div",{className:"mx_DialPadModal_dialPad"},o.createElement(d.a,{hasDialAndDelete:!0,onDigitPress:this.onDigitPress,onDeletePress:this.onDeletePress,onDialPress:this.onDialPress})))}})||n},829:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,s=a(19),i=a.n(s),o=a(88),r=a(108),l=a(94);const c=["1","2","3","4","5","6","7","8","9","*","0","#"];var d;!function(e){e[e.Digit=0]="Digit",e[e.Delete=1]="Delete",e[e.Dial=2]="Dial"}(d||(d={}));class m extends o.PureComponent{constructor(){super(...arguments),i()(this,"onClick",()=>{this.props.onButtonPress(this.props.digit)})}render(){switch(this.props.kind){case d.Digit:return o.createElement(r.a,{className:"mx_DialPad_button",onClick:this.onClick},this.props.digit);case d.Delete:return o.createElement(r.a,{className:"mx_DialPad_button mx_DialPad_deleteButton",onClick:this.onClick});case d.Dial:return o.createElement(r.a,{className:"mx_DialPad_button mx_DialPad_dialButton",onClick:this.onClick})}}}let u=Object(l.a)("views.voip.DialPad")(n=class extends o.PureComponent{render(){const e=[];for(const t of c)e.push(o.createElement(m,{key:t,kind:d.Digit,digit:t,onButtonPress:this.props.onDigitPress}));return this.props.hasDialAndDelete&&(e.push(o.createElement(m,{key:"del",kind:d.Delete,onButtonPress:this.props.onDeletePress})),e.push(o.createElement(m,{key:"dial",kind:d.Dial,onButtonPress:this.props.onDialPress}))),o.createElement("div",{className:"mx_DialPad"},e)}})||n},830:function(e,t,a){"use strict";a.d(t,"b",(function(){return g})),a.d(t,"a",(function(){return f}));var n=a(88),s=a.n(n),i=a(93),o=a(110),r=a(268),l=a(217),c=a(216),d=a(1387),m=a(156),u=a(106);function h(e){const t=e.split("-");return 5===t.length&&"react"===t[1]&&"js"===t[3]}function p(){m.a.get().installUpdate()}const g=(e,t,a)=>{let n,g=Object(i.a)("What's new?");a?n=()=>{u.a.createTrackedDialog("Display release notes","",c.a,{title:Object(i.a)("What's New"),description:s.a.createElement("pre",null,a),button:Object(i.a)("Update"),onFinished:e=>{e&&m.a.get()&&m.a.get().installUpdate()}})}:h(e)&&h(t)?n=()=>{u.a.createTrackedDialog("Display Changelog","",d.a,{version:e,newVersion:t,onFinished:e=>{e&&m.a.get()&&m.a.get().installUpdate()}})}:(n=p,g=Object(i.a)("Update"));const f=o.a.get().brand;l.a.sharedInstance().addOrReplaceToast({key:"update",title:Object(i.a)("Update %(brand)s",{brand:f}),props:{description:Object(i.a)("New version of %(brand)s is available",{brand:f}),acceptLabel:g,onAccept:n,rejectLabel:Object(i.a)("Dismiss"),onReject:function(){m.a.get().deferUpdate(t)}},component:r.a,priority:20})},f=()=>{l.a.sharedInstance().dismissToast("update")}},831:function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"b",(function(){return f}));var n,s,i=a(19),o=a.n(i),r=a(779),l=a(88),c=a.n(l),d=a(92),m=a.n(d),u=a(342),h=a(97),p=a(94);const g=new Error("User cancelled auth session");let f=Object(p.a)("structures.InteractiveAuthComponent")((s=class extends c.a.Component{constructor(e){var t;super(e),t=this,o()(this,"_requestEmailToken",(async function(){t.setState({busy:!0});try{return await t.props.requestEmailToken(...arguments)}finally{t.setState({busy:!1})}})),o()(this,"tryContinue",()=>{this._stageComponent.current&&this._stageComponent.current.tryContinue&&this._stageComponent.current.tryContinue()}),o()(this,"_authStateUpdated",(e,t)=>{const a=this.state.authStage;this.setState({busy:!1,authStage:e,stageState:t,errorText:t.error},()=>{a!==e?this._setFocus():!t.error&&this._stageComponent.current&&this._stageComponent.current.attemptFailed&&this._stageComponent.current.attemptFailed()})}),o()(this,"_requestCallback",e=>this.props.makeRequest(e)),o()(this,"_onBusyChanged",e=>{e&&this.setState({busy:!0,errorText:null,stageErrorText:null})}),o()(this,"_submitAuthDict",e=>{this._authLogic.submitAuthDict(e)}),o()(this,"_onPhaseChange",e=>{this.props.onStagePhaseChange&&this.props.onStagePhaseChange(this.state.authStage,e||0)}),o()(this,"_onStageCancel",()=>{this.props.onAuthFinished(!1,g)}),o()(this,"_onAuthStageFailed",e=>{this.props.onAuthFinished(!1,e)}),o()(this,"_setEmailSid",e=>{this._authLogic.setEmailSid(e)}),this.state={authStage:null,busy:!1,errorText:null,stageErrorText:null,submitButtonEnabled:!1},this._unmounted=!1,this._authLogic=new r.a({authData:this.props.authData,doRequest:this._requestCallback,busyChanged:this._onBusyChanged,inputs:this.props.inputs,stateUpdated:this._authStateUpdated,matrixClient:this.props.matrixClient,sessionId:this.props.sessionId,clientSecret:this.props.clientSecret,emailSid:this.props.emailSid,requestEmailToken:this._requestEmailToken}),this._intervalId=null,this.props.poll&&(this._intervalId=setInterval(()=>{this._authLogic.poll()},2e3)),this._stageComponent=Object(l.createRef)()}UNSAFE_componentWillMount(){this._authLogic.attemptAuth().then(e=>{const t={emailSid:this._authLogic.getEmailSid(),clientSecret:this._authLogic.getClientSecret()};this.props.onAuthFinished(!0,e,t)}).catch(e=>{if(this.props.onAuthFinished(!1,e),console.error("Error during user-interactive auth:",e),this._unmounted)return;const t=e.message||e.toString();this.setState({errorText:t})})}componentWillUnmount(){this._unmounted=!0,null!==this._intervalId&&clearInterval(this._intervalId)}_setFocus(){this._stageComponent.current&&this._stageComponent.current.focus&&this._stageComponent.current.focus()}_renderCurrentStage(){const e=this.state.authStage;if(!e){if(this.state.busy){const e=h.getComponent("elements.Spinner");return c.a.createElement(e,null)}return null}const t=Object(u.d)(e);return c.a.createElement(t,{ref:this._stageComponent,loginType:e,matrixClient:this.props.matrixClient,authSessionId:this._authLogic.getSessionId(),clientSecret:this._authLogic.getClientSecret(),stageParams:this._authLogic.getStageParams(e),submitAuthDict:this._submitAuthDict,errorText:this.state.stageErrorText,busy:this.state.busy,inputs:this.props.inputs,stageState:this.state.stageState,fail:this._onAuthStageFailed,setEmailSid:this._setEmailSid,showContinue:!this.props.continueIsManaged,onPhaseChange:this._onPhaseChange,continueText:this.props.continueText,continueKind:this.props.continueKind,onCancel:this._onStageCancel})}render(){let e=null;return this.state.errorText&&(e=c.a.createElement("div",{className:"error"},this.state.errorText)),c.a.createElement("div",null,c.a.createElement("div",null,this._renderCurrentStage(),e))}},o()(s,"propTypes",{matrixClient:m.a.object.isRequired,authData:m.a.shape({flows:m.a.array,params:m.a.object,session:m.a.string}),makeRequest:m.a.func.isRequired,onAuthFinished:m.a.func.isRequired,inputs:m.a.object,requestEmailToken:m.a.func,sessionId:m.a.string,clientSecret:m.a.string,emailSid:m.a.string,poll:m.a.bool,continueIsManaged:m.a.bool,onStagePhaseChange:m.a.func,continueText:m.a.string,continueKind:m.a.string}),n=s))||n},8311:function(e,t){},8312:function(e,t,a){},832:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(216),o=a(93),r=a(144),l=a(110),c=a(103),d=a(833),m=a(228),u=a(106),h=a(377),p=a(108),g=a(100),f=a(115),v=a(341);t.a=e=>{let{featureId:t,onFinished:a}=e;const b=c.b.getBetaInfo(t),[y,E]=Object(n.useState)(""),[_,S]=Object(n.useState)(!1);return s.a.createElement(i.a,{className:"mx_BetaFeedbackDialog",hasCancelButton:!0,title:Object(o.a)("%(featureName)s beta feedback",{featureName:b.title}),description:s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_BetaFeedbackDialog_subheading"},Object(o.a)(b.feedbackSubheading)," ",Object(o.a)("Your platform and username will be noted to help us use your feedback as much as we can."),s.a.createElement(p.a,{kind:"link",onClick:()=>{a(!1),g.a.dispatch({action:f.a.ViewUserSettings,initialTabId:v.a})}},Object(o.a)("To leave the beta, visit your settings."))),s.a.createElement(r.a,{id:"feedbackComment",label:Object(o.a)("Feedback"),type:"text",autoComplete:"off",value:y,element:"textarea",onChange:e=>{E(e.target.value)},autoFocus:!0}),s.a.createElement(m.a,{checked:_,onClick:e=>S(e.target.checked)},Object(o.a)("You may contact me if you have any follow up questions"))),button:Object(o.a)("Send feedback"),buttonDisabled:!y,onFinished:async e=>{if(!e)return a(!1);Object(d.c)(l.a.get().bug_report_endpoint_url,b.feedbackLabel,y,_),a(!0),u.a.createTrackedDialog("Beta Dialog Sent",t,h.a,{title:Object(o.a)("Beta feedback"),description:Object(o.a)("Thank you for your feedback, we really appreciate it."),button:Object(o.a)("Done"),hasCloseButton:!1,fixedWidth:!1})}})}},833:function(e,t,a){"use strict";a.d(t,"a",(function(){return f})),a.d(t,"b",(function(){return v})),a.d(t,"c",(function(){return y}));var n=a(2729),s=a.n(n),i=a(99),o=a(156),r=a(93),l=a(2738),c=a.n(l),d=a(835),m=a(572),u=a(103),h=a(110);let p=window.TextEncoder;async function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const a=e.progressCallback||(()=>{});a(Object(r.a)("Collecting app version information"));let n="UNKNOWN";try{n=await o.a.get().getAppVersion()}catch(e){}let l="UNKNOWN";window.navigator&&window.navigator.userAgent&&(l=window.navigator.userAgent);let c="UNKNOWN";try{c=String(window.matchMedia("(display-mode: standalone)").matches)}catch(e){}let m="UNKNOWN";try{m=String(window.matchMedia("(pointer: coarse)").matches)}catch(e){}const h=i.a.get();console.log("Sending bug report.");const g=new FormData;if(g.append("text",e.userText||"User did not supply any additional text."),g.append("app","element-web"),g.append("version",n),g.append("user_agent",l),g.append("installed_pwa",c),g.append("touch_input",m),h&&(g.append("user_id",h.credentials.userId),g.append("device_id",h.deviceId),h.isCryptoEnabled())){const e=["ed25519:"+h.getDeviceEd25519Key()];h.getDeviceCurve25519Key&&e.push("curve25519:"+h.getDeviceCurve25519Key()),g.append("device_keys",e.join(", ")),g.append("cross_signing_key",h.getCrossSigningId());const t=h.crypto._crossSigningInfo,a=h.crypto._secretStorage;g.append("cross_signing_ready",String(await h.isCrossSigningReady())),g.append("cross_signing_supported_by_hs",String(await h.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing"))),g.append("cross_signing_key",t.getId()),g.append("cross_signing_pk_in_secret_storage",String(!!await t.isStoredInSecretStorage(a)));const n=h.getCrossSigningCacheCallbacks();g.append("cross_signing_master_pk_cached",String(!(!n||!await n.getCrossSigningKeyCache("master")))),g.append("cross_signing_self_signing_pk_cached",String(!(!n||!await n.getCrossSigningKeyCache("self_signing")))),g.append("cross_signing_user_signing_pk_cached",String(!(!n||!await n.getCrossSigningKeyCache("user_signing")))),g.append("secret_storage_ready",String(await h.isSecretStorageReady())),g.append("secret_storage_key_in_account",String(!!await a.hasKey())),g.append("session_backup_key_in_secret_storage",String(!!await h.isKeyBackupKeyStored()));const s=await h.crypto.getSessionBackupPrivateKey();g.append("session_backup_key_cached",String(!!s)),g.append("session_backup_key_well_formed",String(s instanceof Uint8Array))}e.label&&g.append("label",e.label);const f=u.b.getFeatureSettingNames().filter(e=>u.b.getValue(e));if(f.length&&g.append("enabled_labs",f.join(", ")),u.b.getValue("lowBandwidth")&&g.append("lowBandwidth","enabled"),navigator.storage&&navigator.storage.persisted)try{g.append("storageManager_persisted",String(await navigator.storage.persisted()))}catch(e){}else if(document.hasStorageAccess)try{g.append("storageManager_persisted",String(await document.hasStorageAccess()))}catch(e){}if(navigator.storage&&navigator.storage.estimate)try{const e=await navigator.storage.estimate();g.append("storageManager_quota",String(e.quota)),g.append("storageManager_usage",String(e.usage)),e.usageDetails&&Object.keys(e.usageDetails).forEach(t=>{g.append("storageManager_usage_"+t,String(e.usageDetails[t]))})}catch(e){}if(window.Modernizr){const e=Object.keys(window.Modernizr).filter(e=>!1===window.Modernizr[e]);e.length>0&&g.append("modernizr_missing_features",e.join(", "))}if(g.append("mx_local_settings",localStorage.getItem("mx_local_settings")),e.sendLogs){a(Object(r.a)("Collecting logs"));const e=await d.c();for(const a of e){let e=(new p).encode(a.lines);t&&(e=s.a.gzip(e)),g.append("compressed-log",new Blob([e]),a.id)}}return g}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("No bug report endpoint has been set.");const a=t.progressCallback||(()=>{}),n=await g(t);a(Object(r.a)("Uploading logs")),await E(e,n,a)}async function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=e.progressCallback||(()=>{}),a=await g(e,!1);t(Object(r.a)("Downloading logs"));let n="";const s=new c.a;let i=0;for(const[e,t]of a.entries())"compressed-log"===e?await new Promise(e=>{const a=new FileReader;a.addEventListener("loadend",t=>{s.append(`log-${i++}.log`,(new TextDecoder).decode(t.target.result)),e()}),a.readAsArrayBuffer(t)}):n+=`${e} = ${t}\n`;s.append("issue.txt",n);const o=document.createElement("a");o.href="data:application/octet-stream;base64,"+btoa(b(s.out)),o.download="rageshake.tar",document.body.appendChild(o),o.click(),document.body.removeChild(o)}function b(e){let t="";for(let a=0;a<e.length;a+=1)t+=String.fromCharCode(e[a]);return t}async function y(e,t,a){var n;let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r="UNKNOWN";try{r=await o.a.get().getAppVersion()}catch(e){}const l=new FormData;l.append("label",t),l.append("text",a),l.append("can_contact",s?"yes":"no"),l.append("app","element-web"),l.append("version",r),l.append("platform",o.a.get().getHumanReadableName()),l.append("user_id",null===(n=i.a.get())||void 0===n?void 0:n.getUserId()),await E(h.a.get().bug_report_endpoint_url,l,()=>{})}function E(e,t,a){return new Promise((n,s)=>{const i=new XMLHttpRequest;i.open("POST",e),i.timeout=3e5,i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.LOADING)a(Object(r.a)("Waiting for response from server"));else if(i.readyState===XMLHttpRequest.DONE){if(i.status<200||i.status>=400)return void s(new Error("HTTP "+i.status));n()}},i.send(t)})}p||(p=m.TextEncoder)},835:function(e,t,a){"use strict";(function(e){a.d(t,"d",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return c}));class n{constructor(){this.logs=""}monkeyPatch(e){var t=this;const a={log:"I",info:"I",warn:"W",error:"E"};Object.keys(a).forEach(n=>{const s=a[n],i=e[n].bind(e);e[n]=function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];t.log(s,...a),i(...a)}})}log(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];let s=`${(new Date).toISOString()} ${e} ${(a=a.map(e=>{if(e instanceof DOMException)return e.message+` (${e.name} | ${e.code}) `+(e.stack?"\n"+e.stack:"");if(e instanceof Error)return e.message+(e.stack?"\n"+e.stack:"");if("object"!=typeof e)return e;try{return JSON.stringify(e)}catch(t){return JSON.stringify(e,(e,t)=>e&&"object"==typeof t?"<object>":t)}})).join(" ")}\n`;s=s.replace(/token=[a-zA-Z0-9-]+/gm,"token=xxxxx"),this.logs+=s}flush(e){if(e)return this.logs;const t=this.logs;return this.logs="",t}}class s{constructor(e,t){this.indexedDB=e,this.logger=t,this.id="instance-"+Math.random()+Date.now(),this.index=0,this.db=null,this.flushPromise=null,this.flushAgainPromise=null}connect(){const e=this.indexedDB.open("logs");return new Promise((t,a)=>{e.onsuccess=e=>{this.db=e.target.result,setInterval(this.flush.bind(this),3e4),t()},e.onerror=e=>{const t="Failed to open log database: "+e.target.error.name;console.error(t),a(new Error(t))},e.onupgradeneeded=e=>{const t=e.target.result,a=t.createObjectStore("logs",{keyPath:["id","index"]});a.createIndex("id","id",{unique:!1}),a.add(this._generateLogEntry(new Date+" ::: Log database was created."));t.createObjectStore("logslastmod",{keyPath:"id"}).add(this._generateLastModifiedTime())}})}flush(){return this.flushPromise?(this.flushAgainPromise||(this.flushAgainPromise=this.flushPromise.then(()=>this.flush()).then(()=>{this.flushAgainPromise=null})),this.flushAgainPromise):(this.flushPromise=new Promise((e,t)=>{if(!this.db)return void t(new Error("No connected database"));const a=this.logger.flush();if(0===a.length)return void e();const n=this.db.transaction(["logs","logslastmod"],"readwrite"),s=n.objectStore("logs");n.oncomplete=t=>{e()},n.onerror=e=>{console.error("Failed to flush logs : ",e),t(new Error("Failed to write logs: "+e.target.errorCode))},s.add(this._generateLogEntry(a));n.objectStore("logslastmod").put(this._generateLastModifiedTime())}).then(()=>{this.flushPromise=null}),this.flushPromise)}async consume(){const e=this.db;function t(t,a){const n=e.transaction("logs","readonly").objectStore("logs");return new Promise((e,s)=>{const i=n.index("id").openCursor(IDBKeyRange.only(t),"prev");let o="";i.onerror=e=>{s(new Error("Query failed: "+e.target.errorCode))},i.onsuccess=t=>{const n=t.target.result;n?(o=n.value.lines+o,o.length>=a?e(o):n.continue()):e(o)}})}const a=await function(e,t,a){const n=e.openCursor(t);return new Promise((e,t)=>{const s=[];n.onerror=e=>{t(new Error("Query failed: "+e.target.errorCode))},n.onsuccess=t=>{const n=t.target.result;n?(s.push(a(n)),n.continue()):e(s)}})}(e.transaction("logslastmod","readonly").objectStore("logslastmod"),void 0,e=>({id:e.value.id,ts:e.value.ts})).then(e=>e.sort((e,t)=>t.ts-e.ts).map(e=>e.id));let n=[];const s=[];let i=0;for(let e=0;e<a.length;e++){const o=await t(a[e],5242880-i);if(s.push({lines:o,id:a[e]}),i+=o.length,i>=5242880){n=a.slice(e+1);break}}return n.length>0&&(console.log("Removing logs: ",n),Promise.all(n.map(t=>function(t){return new Promise((a,n)=>{const s=e.transaction(["logs","logslastmod"],"readwrite"),i=s.objectStore("logs");i.index("id").openKeyCursor(IDBKeyRange.only(t)).onsuccess=e=>{const t=e.target.result;t&&(i.delete(t.primaryKey),t.continue())},s.oncomplete=()=>{a()},s.onerror=e=>{n(new Error(`Failed to delete logs for '${t}' : ${e.target.errorCode}`))};s.objectStore("logslastmod").delete(t)})}(t))).then(()=>{console.log(`Removed ${n.length} old logs.`)},e=>{console.error(e)})),s}_generateLogEntry(e){return{id:this.id,lines:e,index:this.index++}}_generateLastModifiedTime(){return{id:this.id,ts:Date.now()}}}function i(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e.mx_rage_initPromise?e.mx_rage_initPromise:(e.mx_rage_logger=new n,e.mx_rage_logger.monkeyPatch(window.console),t?o():(e.mx_rage_initPromise=Promise.resolve(),e.mx_rage_initPromise))}function o(){if(e.mx_rage_initStoragePromise)return e.mx_rage_initStoragePromise;let t;console.log("Configuring rageshake persistence...");try{t=window.indexedDB}catch(e){}return t?(e.mx_rage_store=new s(t,e.mx_rage_logger),e.mx_rage_initStoragePromise=e.mx_rage_store.connect(),e.mx_rage_initStoragePromise):(e.mx_rage_initStoragePromise=Promise.resolve(),e.mx_rage_initStoragePromise)}function r(){e.mx_rage_store&&e.mx_rage_store.flush()}async function l(){e.mx_rage_store&&await e.mx_rage_store.consume()}async function c(){if(!e.mx_rage_logger)throw new Error("No console logger, did you forget to call init()?");return e.mx_rage_store?(await e.mx_rage_store.flush(),await e.mx_rage_store.consume()):[{lines:e.mx_rage_logger.flush(!0),id:"-"}]}}).call(this,a(7))},836:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return c}));var n=a(383),s=a(93),i=a(110),o=a(88),r=a.n(o);let l;function c(e){let{isRoomEncrypted:t,kind:a}=e;if(!t)return null;if(n.a.get())return null;const{desktopBuilds:o,brand:c}=i.a.get();let d=null,m=null;if(o.available)switch(m=r.a.createElement("img",{src:o.logo}),a){case l.Files:d=Object(s.a)("Use the <a>Desktop app</a> to see all encrypted files",{},{a:e=>r.a.createElement("a",{href:o.url,target:"_blank",rel:"noreferrer noopener"},e)});break;case l.Search:d=Object(s.a)("Use the <a>Desktop app</a> to search encrypted messages",{},{a:e=>r.a.createElement("a",{href:o.url,target:"_blank",rel:"noreferrer noopener"},e)})}else switch(a){case l.Files:d=Object(s.a)("This version of %(brand)s does not support viewing some encrypted files",{brand:c});break;case l.Search:d=Object(s.a)("This version of %(brand)s does not support searching encrypted messages",{brand:c})}return d?r.a.createElement("div",{className:"mx_DesktopBuildsNotice"},m,r.a.createElement("span",null,d)):(console.warn("Unknown desktop builds warning kind: ",a),null)}!function(e){e[e.Files=0]="Files",e[e.Search=1]="Search"}(l||(l={}))},837:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(93),o=a(108),r=a(226),l=a(211),c=a(155),d=a(205),m=a(99);t.a=e=>{var t;let{space:a,onFinished:u}=e;const[h,p]=Object(n.useState)(Object(i.a)("Click to copy"));return s.a.createElement("div",{className:"mx_SpacePublicShare"},s.a.createElement(o.a,{className:"mx_SpacePublicShare_shareButton",onClick:async()=>{const e=new c.a(a);e.load();const t=await Object(r.c)(e.forRoom())?Object(i.a)("Copied!"):Object(i.a)("Failed to copy");p(t),await Object(l.c)(5e3),h===t&&p(Object(i.a)("Click to copy"))}},s.a.createElement("h3",null,Object(i.a)("Share invite link")),s.a.createElement("span",null,h)),a.canInvite(null===(t=m.a.get())||void 0===t?void 0:t.getUserId())?s.a.createElement(o.a,{className:"mx_SpacePublicShare_inviteButton",onClick:()=>{Object(d.g)(a.roomId),u&&u()}},s.a.createElement("h3",null,Object(i.a)("Invite people")),s.a.createElement("span",null,Object(i.a)("Invite with email or username"))):null)}},838:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(131),u=a(100),h=a(150),p=a(108),g=a(102),f=a.n(g),v=a(94);let b=Object(v.a)("structures.SearchBox")((s=class extends l.a.Component{constructor(e){super(e),o()(this,"onAction",e=>{if(this.props.enableRoomSearchFocus)switch(e.action){case"view_room":this._search.current&&e.clear_search&&this._clearSearch();break;case"focus_room_filter":this._search.current&&this._search.current.focus()}}),o()(this,"onChange",()=>{this._search.current&&(this.setState({searchTerm:this._search.current.value}),this.onSearch())}),o()(this,"onSearch",Object(h.throttle)(()=>{this.props.onSearch(this._search.current.value)},200,{trailing:!0,leading:!0})),o()(this,"_onKeyDown",e=>{switch(e.key){case m.a.ESCAPE:this._clearSearch("keyboard")}this.props.onKeyDown&&this.props.onKeyDown(e)}),o()(this,"_onFocus",e=>{this.setState({blurred:!1}),e.target.select(),this.props.onFocus&&this.props.onFocus(e)}),o()(this,"_onBlur",e=>{this.setState({blurred:!0}),this.props.onBlur&&this.props.onBlur(e)}),this._search=Object(r.createRef)(),this.state={searchTerm:this.props.initialValue||"",blurred:!0}}componentDidMount(){this.dispatcherRef=u.a.register(this.onAction)}componentWillUnmount(){u.a.unregister(this.dispatcherRef)}_clearSearch(e){this._search.current.value="",this.onChange(),this.props.onCleared&&this.props.onCleared(e)}render(){if(this.props.collapsed)return null;const e=!this.state.blurred||this.state.searchTerm?l.a.createElement(p.a,{key:"button",tabIndex:-1,className:"mx_SearchBox_closeButton",onClick:()=>{this._clearSearch("button")}}):void 0,t=this.state.blurred&&this.props.blurredPlaceholder||this.props.placeholder,a=this.props.className||"";return l.a.createElement("div",{className:f()("mx_SearchBox","mx_textinput",{mx_SearchBox_blurred:this.state.blurred})},l.a.createElement("input",{key:"searchfield",type:"text",ref:this._search,className:"mx_textinput_icon mx_textinput_search "+a,value:this.state.searchTerm,onFocus:this._onFocus,onChange:this.onChange,onKeyDown:this._onKeyDown,onBlur:this._onBlur,placeholder:t,autoComplete:"off",autoFocus:this.props.autoFocus}),e)}},o()(s,"propTypes",{onSearch:d.a.func,onCleared:d.a.func,onKeyDown:d.a.func,className:d.a.string,placeholder:d.a.string.isRequired,autoFocus:d.a.bool,initialValue:d.a.string,enableRoomSearchFocus:d.a.bool}),o()(s,"defaultProps",{enableRoomSearchFocus:!1}),n=s))||n},839:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(88);const s=e=>{const[t,a]=Object(n.useState)(e);return[t,()=>{a(!t)},a]}},840:function(e,t,a){"use strict";a.d(t,"a",(function(){return R}));var n=a(88),s=a.n(n),i=a(102),o=a.n(i),r=a(93),l=a(182),c=a(818),d=a(838),m=a(175),u=a(167),h=a(298),p=a(108),g=a(138),f=a(211),v=a(185),b=a(155),y=a(228),E=a(119),_=a(1246),S=a(841),C=a(384),w=a(440),O=a(431);const x=e=>{let{room:t,checked:a,onChange:n}=e;return s.a.createElement("label",{className:"mx_AddExistingToSpace_entry"},null!=t&&t.isSpaceRoom()?s.a.createElement(u.a,{room:t,height:32,width:32}):s.a.createElement(w.a,{room:t,avatarSize:32}),s.a.createElement("span",{className:"mx_AddExistingToSpace_entry_name"},t.name),s.a.createElement(y.a,{onChange:n?e=>n(e.target.checked):null,checked:a,disabled:!n}))},R=e=>{let{space:t,footerPrompt:i,emptySelectionButton:o,onFinished:l}=e;const c=Object(n.useContext)(E.a),u=Object(n.useMemo)(()=>c.getVisibleRooms().filter(e=>"join"===e.getMyMembership()),[c]),[h,y]=Object(n.useState)(new Set),[C,w]=Object(n.useState)(null),[R,k]=Object(n.useState)(null),[I,T]=Object(n.useState)(""),P=I.toLowerCase().trim(),N=Object(n.useMemo)(()=>new Set(m.e.instance.getChildSpaces(t.roomId)),[t]),D=Object(n.useMemo)(()=>new Set(m.e.instance.getChildRooms(t.roomId)),[t]),[j,A,M]=Object(n.useMemo)(()=>{let e=u;if(P){e=new O.a(u,{keys:["name"],funcs:[e=>[e.getCanonicalAlias(),...e.getAltAliases()].filter(Boolean)],shouldMatchWordsOnly:!1}).match(P)}const a=t.getJoinRule();return Object(_.b)(e).reduce((e,n)=>(n.isSpaceRoom()?n===t||N.has(n)||e[0].push(n):D.has(n)||(v.a.shared().getUserIdForRoomId(n.roomId)?"public"!==a&&e[2].push(n):e[1].push(n)),e),[[],[],[]])},[u,t,P,D,N]),U=async()=>{let e;k(null),w(0);for(const a of h){const n=Object(b.b)(a);try{await m.e.instance.addRoomToSpace(t,a.roomId,n).catch(async e=>{if("M_LIMIT_EXCEEDED"===e.errcode)return await Object(f.c)(e.data.retry_after_ms),m.e.instance.addRoomToSpace(t,a.roomId,n);throw e}),w(e=>e+1)}catch(t){console.error("Failed to add rooms to space",t),k(e=t);break}}e||l(!0)},L=null!==C;let F;if(R)F=s.a.createElement(s.a.Fragment,null,s.a.createElement("img",{src:a(1359),height:"24",width:"24",alt:""}),s.a.createElement("span",{className:"mx_AddExistingToSpaceDialog_error"},s.a.createElement("div",{className:"mx_AddExistingToSpaceDialog_errorHeading"},Object(r.a)("Not all selected were added")),s.a.createElement("div",{className:"mx_AddExistingToSpaceDialog_errorCaption"},Object(r.a)("Try again"))),s.a.createElement(p.a,{className:"mx_AddExistingToSpaceDialog_retryButton",onClick:U},Object(r.a)("Retry")));else if(L)F=s.a.createElement("span",null,s.a.createElement(S.a,{value:C,max:h.size}),s.a.createElement("div",{className:"mx_AddExistingToSpaceDialog_progressText"},Object(r.a)("Adding rooms... (%(progress)s out of %(count)s)",{count:h.size,progress:C})));else{let e=o;(!e||h.size>0)&&(e=s.a.createElement(p.a,{kind:"primary",disabled:h.size<1,onClick:U},Object(r.a)("Add"))),F=s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,i),e)}const B=L||R?null:(e,t)=>{e?h.add(t):h.delete(t),y(new Set(h))};return s.a.createElement("div",{className:"mx_AddExistingToSpace"},s.a.createElement(d.a,{className:"mx_textinput_icon mx_textinput_search",placeholder:Object(r.a)("Filter your rooms and spaces"),onSearch:T,autoComplete:!0,autoFocus:!0}),s.a.createElement(g.a,{className:"mx_AddExistingToSpace_content"},A.length>0?s.a.createElement("div",{className:"mx_AddExistingToSpace_section"},s.a.createElement("h3",null,Object(r.a)("Rooms")),A.map(e=>s.a.createElement(x,{key:e.roomId,room:e,checked:h.has(e),onChange:B?t=>{B(t,e)}:null}))):void 0,j.length>0?s.a.createElement("div",{className:"mx_AddExistingToSpace_section mx_AddExistingToSpace_section_spaces"},s.a.createElement("h3",null,Object(r.a)("Spaces")),s.a.createElement("div",{className:"mx_AddExistingToSpace_section_experimental"},s.a.createElement("div",null,Object(r.a)("Feeling experimental?")),s.a.createElement("div",null,Object(r.a)("You can add existing spaces to a space."))),j.map(e=>s.a.createElement(x,{key:e.roomId,room:e,checked:h.has(e),onChange:B?t=>{B(t,e)}:null}))):null,M.length>0?s.a.createElement("div",{className:"mx_AddExistingToSpace_section"},s.a.createElement("h3",null,Object(r.a)("Direct Messages")),M.map(e=>s.a.createElement(x,{key:e.roomId,room:e,checked:h.has(e),onChange:B?t=>{B(t,e)}:null}))):null,j.length+A.length+M.length<1?s.a.createElement("span",{className:"mx_AddExistingToSpace_noResults"},Object(r.a)("No results")):void 0),s.a.createElement("div",{className:"mx_AddExistingToSpace_footer"},F))};t.b=e=>{let{matrixClient:t,space:a,onCreateRoomClick:i,onFinished:d}=e;const[g,f]=Object(n.useState)(a),v=m.e.instance.getChildSpaces(a.roomId);let b;if(v.length>0){const e=[a,...v].map(e=>{const t=o()("mx_AddExistingToSpaceDialog_dropdownOption",{mx_AddExistingToSpaceDialog_dropdownOptionActive:e===g});return s.a.createElement("div",{key:e.roomId,className:t},s.a.createElement(u.a,{room:e,width:24,height:24}),e.name||Object(h.a)(e)||e.roomId)});b=s.a.createElement(c.a,{id:"mx_SpaceSelectDropdown",onOptionChange:e=>{f(v.find(t=>t.roomId===e)||a)},value:g.roomId,label:Object(r.a)("Space selection")},e)}else b=s.a.createElement("div",{className:"mx_AddExistingToSpaceDialog_onlySpace"},a.name||Object(h.a)(a)||a.roomId);const y=s.a.createElement(s.a.Fragment,null,s.a.createElement(u.a,{room:g,height:40,width:40}),s.a.createElement("div",null,s.a.createElement("h1",null,Object(r.a)("Add existing rooms")),b));return s.a.createElement(l.a,{title:y,className:"mx_AddExistingToSpaceDialog",contentId:"mx_AddExistingToSpace",onFinished:d,fixedWidth:!1},s.a.createElement(E.a.Provider,{value:t},s.a.createElement(R,{space:a,onFinished:d,footerPrompt:s.a.createElement(s.a.Fragment,null,s.a.createElement("div",null,Object(r.a)("Want to add a new room instead?")),s.a.createElement(p.a,{onClick:()=>i(t,a),kind:"link"},Object(r.a)("Create a new room")))})),s.a.createElement(C.a,{onClick:()=>d(!1)}))}},8404:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return ce}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(360),u=a(93),h=a(155),p=a(343),g=a(106),f=a(97),v=a(158),b=a(100),y=a(369),E=a(302),_=a(298),S=a(861),C=a(424),w=a(425),O=a(165),x=a(862),R=a(332),k=a(103),I=a(245),T=a(108),P=a(337),N=a(296),D=a(340),j=a(119),A=a(500),M=a(115),U=a(507),L=a(506),F=a(499),B=a(601),V=a(602),G=a(603),z=a(604),W=a(605),H=a(881),K=a(607),q=a(374),Y=a(282),$=a(299),J=a(142),Q=a(301),X=a(421),Z=a(184),ee=a(267),te=a(220),ae=a(166),ne=a(384),se=a(94),ie=a(150),oe=a(200);let re=function(e){};const le="sandbox"in document.createElement("iframe");let ce=Object(se.a)("structures.RoomView")((s=class extends l.a.Component{constructor(t,a){super(t,a),o()(this,"dispatcherRef",void 0),o()(this,"roomStoreToken",void 0),o()(this,"rightPanelStoreToken",void 0),o()(this,"showReadReceiptsWatchRef",void 0),o()(this,"layoutWatcherRef",void 0),o()(this,"unmounted",!1),o()(this,"permalinkCreators",{}),o()(this,"searchId",void 0),o()(this,"roomView",Object(r.createRef)()),o()(this,"searchResultsPanel",Object(r.createRef)()),o()(this,"messagePanel",void 0),o()(this,"onWidgetStoreUpdate",()=>{this.state.room&&this.checkWidgets(this.state.room)}),o()(this,"checkWidgets",e=>{this.setState({hasPinnedWidgets:ee.d.instance.getContainerWidgets(e,ee.a.Top).length>0,showApps:this.shouldShowApps(e)})}),o()(this,"onReadReceiptsChange",()=>{this.setState({showReadReceipts:k.b.getValue("showReadReceipts",this.state.roomId)})}),o()(this,"onRoomViewStoreUpdate",e=>{if(this.unmounted)return;if(!e&&this.state.roomId!==O.a.getRoomId())return;const t=O.a.getRoomId(),a={roomId:t,roomAlias:O.a.getRoomAlias(),roomLoading:O.a.isRoomLoading(),roomLoadError:O.a.getRoomLoadError(),joining:O.a.isJoining(),initialEventId:O.a.getInitialEventId(),isInitialEventHighlighted:O.a.isInitialEventHighlighted(),replyToEvent:O.a.getQuotingEvent(),forwardingEvent:O.a.getForwardingEvent(),shouldPeek:this.state.matrixClientIsReady&&O.a.shouldPeek(),showReadReceipts:k.b.getValue("showReadReceipts",t),wasContextSwitch:O.a.getWasContextSwitch()};if(e||!this.state.shouldPeek||a.shouldPeek||this.context.stopPeeking(),console.log("RVS update:",a.roomId,a.roomAlias,"loading?",a.roomLoading,"joining?",a.joining,"initial?",e,"shouldPeek?",a.shouldPeek),e&&(a.room=this.context.getRoom(a.roomId),a.room&&(a.showApps=this.shouldShowApps(a.room),this.onRoomLoaded(a.room))),null===this.state.roomId&&null!==a.roomId&&!a.initialEventId){const e=x.a.getScrollState(a.roomId);e&&(a.initialEventId=e.focussedEvent,a.initialEventPixelOffset=e.pixelOffset)}this.state.initialEventId!==a.initialEventId&&(a.searchResults=null),this.setState(a),e&&this.setupRoom(a.room,a.roomId,a.joining,a.shouldPeek)}),o()(this,"getRoomId",()=>this.state.room?this.state.room.roomId:this.state.roomId),o()(this,"onWidgetEchoStoreUpdate",()=>{this.state.room&&this.setState({hasPinnedWidgets:ee.d.instance.getContainerWidgets(this.state.room,ee.a.Top).length>0,showApps:this.shouldShowApps(this.state.room)})}),o()(this,"onWidgetLayoutChange",()=>{this.onWidgetEchoStoreUpdate()}),o()(this,"onUserScroll",()=>{this.state.initialEventId&&this.state.isInitialEventHighlighted&&b.a.dispatch({action:"view_room",room_id:this.state.room.roomId,event_id:this.state.initialEventId,highlighted:!1})}),o()(this,"onLayoutChange",()=>{this.setState({layout:k.b.getValue("layout")})}),o()(this,"onRightPanelStoreUpdate",()=>{this.setState({showRightPanel:P.a.getSharedInstance().isOpenForRoom})}),o()(this,"onPageUnload",e=>p.a.sharedInstance().getCurrentUploads().length>0?e.returnValue=Object(u.a)("You seem to be uploading files, are you sure you want to quit?"):this.getCallForRoom()&&"ended"!==this.state.callState?e.returnValue=Object(u.a)("You seem to be in a call, are you sure you want to quit?"):void 0),o()(this,"onReactKeyDown",e=>{let t=!1;switch(Object(te.f)().getRoomAction(e)){case te.d.DismissReadMarker:this.messagePanel.forgetReadMarker(),this.jumpToLiveTimeline(),t=!0;break;case te.d.JumpToOldestUnread:this.jumpToReadMarker(),t=!0;break;case te.d.UploadFile:b.a.dispatch({action:"upload_file"},!0),t=!0}t&&(e.stopPropagation(),e.preventDefault())}),o()(this,"onAction",t=>{switch(t.action){case"message_sent":this.checkDesktopNotifications();break;case"post_sticker_message":this.injectSticker(t.data.content.url,t.data.content.info,t.data.description||t.data.name);break;case"picture_snapshot":p.a.sharedInstance().sendContentListToRoom([t.file],this.state.room.roomId,this.context);break;case"notifier_enabled":case M.a.UploadStarted:case M.a.UploadFinished:case M.a.UploadCanceled:this.forceUpdate();break;case"call_state":{if(!t.room_id)return;const e=this.getCallForRoom();this.setState({callState:e?e.state:null});break}case"appsDrawer":this.setState({showApps:t.show});break;case"reply_to_event":this.state.searchResults&&t.event.getRoomId()===this.state.roomId&&!this.unmounted&&this.onCancelSearchClick();break;case"quote":if(this.state.searchResults){const a=t.event.getRoomId();a===this.state.roomId&&this.onCancelSearchClick(),e(()=>{b.a.dispatch({action:"view_room",room_id:a,deferred_action:t})})}break;case"sync_state":this.state.matrixClientIsReady||this.setState({matrixClientIsReady:this.context&&this.context.isInitialSyncComplete()},()=>{this.onRoomViewStoreUpdate(!0)});break;case"focus_search":this.onSearchClick()}}),o()(this,"onRoomTimeline",(e,t,a,n,s)=>{this.unmounted||t&&this.state.room&&t.roomId==this.state.room.roomId&&s.timeline.getTimelineSet()===t.getUnfilteredTimelineSet()&&("org.matrix.room.preview_urls"===e.getType()&&this.updatePreviewUrlVisibility(t),"m.room.encryption"===e.getType()&&this.updateE2EStatus(t),!a&&s&&s.liveEvent&&(this.state.joining||e.getSender()!==this.context.credentials.userId&&(!this.state.searchResults&&this.state.atEndOfLiveTimeline||Object(m.a)(e)||this.setState((e,t)=>({numUnreadMessages:e.numUnreadMessages+1})))))}),o()(this,"onEventDecrypted",e=>{e.isDecryptionFailure()||this.handleEffects(e)}),o()(this,"onEvent",e=>{e.isBeingDecrypted()||e.isDecryptionFailure()||this.handleEffects(e)}),o()(this,"handleEffects",e=>{if(!this.state.room||!this.state.matrixClientIsReady)return;if(e.getRoomId()!==this.state.room.roomId)return;Z.a.instance.getRoomState(this.state.room).isUnread&&Y.CHAT_EFFECTS.forEach(t=>{(Object(q.containsEmoji)(e.getContent(),t.emojis)||e.getContent().msgtype===t.msgType)&&b.a.dispatch({action:"effects."+t.command})})}),o()(this,"onRoomName",e=>{this.state.room&&e.roomId==this.state.room.roomId&&this.forceUpdate()}),o()(this,"onKeyBackupStatus",()=>{this.forceUpdate()}),o()(this,"canResetTimeline",()=>!this.messagePanel||this.messagePanel.canResetTimeline()),o()(this,"onRoomLoaded",e=>{ee.d.instance.on(ee.d.emissionForRoom(e),this.onWidgetLayoutChange),this.onWidgetLayoutChange(),this.calculatePeekRules(e),this.updatePreviewUrlVisibility(e),this.loadMembersIfJoined(e),this.calculateRecommendedVersion(e),this.updateE2EStatus(e),this.updatePermissions(e),this.checkWidgets(e)}),o()(this,"onRoom",e=>{e&&e.roomId===this.state.roomId&&(this.state.room&&ee.d.instance.off(ee.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),this.setState({room:e},()=>{this.onRoomLoaded(e)}))}),o()(this,"onDeviceVerificationChanged",(e,t)=>{const a=this.state.room;a.currentState.getMember(e)&&this.updateE2EStatus(a)}),o()(this,"onUserVerificationChanged",(e,t)=>{const a=this.state.room;a&&a.currentState.getMember(e)&&this.updateE2EStatus(a)}),o()(this,"onCrossSigningKeysChanged",()=>{const e=this.state.room;e&&this.updateE2EStatus(e)}),o()(this,"onAccountData",e=>{const t=e.getType();"org.matrix.preview_urls"!==t&&"im.vector.web.settings"!==t||!this.state.room||this.updatePreviewUrlVisibility(this.state.room)}),o()(this,"onRoomAccountData",(e,t)=>{if(t.roomId==this.state.roomId){const a=e.getType();if("org.matrix.room.color_scheme"===a){const t=e.getContent();console.log("Tinter.tint from onRoomAccountData"),y.a.tint(t.primary_color,t.secondary_color)}else"org.matrix.room.preview_urls"!==a&&"im.vector.web.settings"!==a||this.updatePreviewUrlVisibility(t)}}),o()(this,"onRoomStateEvents",(e,t)=>{this.state.room&&this.state.room.roomId===t.roomId&&this.updatePermissions(this.state.room)}),o()(this,"onRoomStateMember",(e,t,a)=>{this.state.room&&a.roomId===this.state.room.roomId&&this.updateRoomMembers(a)}),o()(this,"onMyMembership",(e,t,a)=>{e.roomId===this.state.roomId&&(this.forceUpdate(),this.loadMembersIfJoined(e),this.updatePermissions(e))}),o()(this,"updateRoomMembers",Object(E.a)(()=>{this.updateDMState(),this.updateE2EStatus(this.state.room)},500)),o()(this,"onSearchResultsFillRequest",e=>{if(!e)return Promise.resolve(!1);if(this.state.searchResults.next_batch){re("requesting more search results");const e=Object(S.b)(this.state.searchResults);return this.handleSearchResult(e)}return re("no more search results"),Promise.resolve(!1)}),o()(this,"onInviteButtonClick",()=>{b.a.dispatch({action:"view_invite",roomId:this.state.room.roomId})}),o()(this,"onJoinButtonClicked",()=>{this.context&&this.context.isGuest()?(b.a.dispatch({action:"do_after_sync_prepared",deferred_action:{action:"view_room",room_id:this.getRoomId()}}),b.a.dispatch({action:"require_registration"})):Promise.resolve().then(()=>{var e;const t=null===(e=this.props.threepidInvite)||void 0===e?void 0:e.signUrl;return b.a.dispatch({action:M.a.JoinRoom,roomId:this.getRoomId(),opts:{inviteSignUrl:t},_type:"unknown"}),Promise.resolve()})}),o()(this,"onMessageListScroll",e=>{this.messagePanel.isAtEndOfLiveTimeline()?this.setState({numUnreadMessages:0,atEndOfLiveTimeline:!0}):this.setState({atEndOfLiveTimeline:!1}),this.updateTopUnreadMessagesBar()}),o()(this,"onDragEnter",e=>{e.stopPropagation(),e.preventDefault(),this.setState({dragCounter:this.state.dragCounter+1}),(e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"))&&this.setState({draggingFile:!0})}),o()(this,"onDragLeave",e=>{e.stopPropagation(),e.preventDefault(),this.setState({dragCounter:this.state.dragCounter-1}),0===this.state.dragCounter&&this.setState({draggingFile:!1})}),o()(this,"onDragOver",e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="none",(e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"))&&(e.dataTransfer.dropEffect="copy")}),o()(this,"onDrop",e=>{e.stopPropagation(),e.preventDefault(),p.a.sharedInstance().sendContentListToRoom(e.dataTransfer.files,this.state.room.roomId,this.context),b.a.fire(M.a.FocusComposer),this.setState({draggingFile:!1,dragCounter:this.state.dragCounter-1})}),o()(this,"onSearch",(e,t)=>{let a;this.setState({searchTerm:e,searchScope:t,searchResults:{},searchHighlights:[]}),this.searchResultsPanel.current&&this.searchResultsPanel.current.resetScrollState(),this.searchId=(new Date).getTime(),"Room"===t&&(a=this.state.room.roomId),re("sending search request");const n=Object(S.a)(e,a);this.handleSearchResult(n)}),o()(this,"onCallPlaced",e=>{b.a.dispatch({action:"place_call",type:e,room_id:this.state.room.roomId})}),o()(this,"onSettingsClick",()=>{b.a.dispatch({action:"open_room_settings"})}),o()(this,"onCancelClick",()=>{console.log("updateTint from onCancelClick"),this.updateTint(),this.state.forwardingEvent&&b.a.dispatch({action:"forward_event",event:null}),b.a.fire(M.a.FocusComposer)}),o()(this,"onAppsClick",()=>{b.a.dispatch({action:"appsDrawer",show:!this.state.showApps})}),o()(this,"onLeaveClick",()=>{b.a.dispatch({action:"leave_room",room_id:this.state.room.roomId})}),o()(this,"onForgetClick",()=>{b.a.dispatch({action:"forget_room",room_id:this.state.room.roomId})}),o()(this,"onRejectButtonClicked",()=>{this.setState({rejecting:!0}),this.context.leave(this.state.roomId).then(()=>{b.a.dispatch({action:"view_home_page"}),this.setState({rejecting:!1})},e=>{console.error("Failed to reject invite: %s",e);const t=e.message?e.message:JSON.stringify(e),a=f.getComponent("dialogs.ErrorDialog");g.a.createTrackedDialog("Failed to reject invite","",a,{title:Object(u.a)("Failed to reject invite"),description:t}),this.setState({rejecting:!1,rejectError:e})})}),o()(this,"onRejectAndIgnoreClick",async()=>{this.setState({rejecting:!0});try{const e=this.state.room.getMember(this.context.getUserId()).events.member,t=this.context.getIgnoredUsers();t.push(e.getSender()),await this.context.setIgnoredUsers(t),await this.context.leave(this.state.roomId),b.a.dispatch({action:"view_home_page"}),this.setState({rejecting:!1})}catch(e){console.error("Failed to reject invite: %s",e);const t=e.message?e.message:JSON.stringify(e),a=f.getComponent("dialogs.ErrorDialog");g.a.createTrackedDialog("Failed to reject invite","",a,{title:Object(u.a)("Failed to reject invite"),description:t}),this.setState({rejecting:!1,rejectError:e})}}),o()(this,"onRejectThreepidInviteButtonClicked",()=>{b.a.fire(M.a.ViewRoomDirectory)}),o()(this,"onSearchClick",()=>{this.setState({searching:!this.state.searching})}),o()(this,"onCancelSearchClick",()=>{this.setState({searching:!1,searchResults:null})}),o()(this,"jumpToLiveTimeline",()=>{b.a.dispatch({action:"view_room",room_id:this.state.room.roomId})}),o()(this,"jumpToReadMarker",()=>{this.messagePanel.jumpToReadMarker()}),o()(this,"forgetReadMarker",e=>{e.stopPropagation(),this.messagePanel.forgetReadMarker()}),o()(this,"updateTopUnreadMessagesBar",()=>{if(!this.messagePanel)return;const e=this.messagePanel.canJumpToReadMarker();this.state.showTopUnreadMessagesBar!=e&&this.setState({showTopUnreadMessagesBar:e})}),o()(this,"onResize",()=>{let e=oe.b.instance.windowHeight-261;e<50&&(e=50),this.setState({auxPanelMaxHeight:e})}),o()(this,"onStatusBarVisible",()=>{this.unmounted||this.setState({statusBarVisible:!0})}),o()(this,"onStatusBarHidden",()=>{this.unmounted||this.setState({statusBarVisible:!1})}),o()(this,"gatherTimelinePanelRef",e=>{this.messagePanel=e,e&&(console.log("updateTint from RoomView.gatherTimelinePanelRef"),this.updateTint())}),o()(this,"onHiddenHighlightsClick",()=>{const e=this.getOldRoom();e&&b.a.dispatch({action:"view_room",room_id:e.roomId})});const n=this.context.hasLazyLoadMembersEnabled();this.state={roomId:null,roomLoading:!0,peekLoading:!1,shouldPeek:!0,membersLoaded:!n,numUnreadMessages:0,draggingFile:!1,searching:!1,searchResults:null,callState:null,guestsCanJoin:!1,canPeek:!1,showApps:!1,isPeeking:!1,showReadReceipts:!0,showRightPanel:P.a.getSharedInstance().isOpenForRoom,joining:!1,atEndOfLiveTimeline:!0,atEndOfLiveTimelineInit:!1,showTopUnreadMessagesBar:!1,statusBarVisible:!1,canReact:!1,canReply:!1,layout:k.b.getValue("layout"),matrixClientIsReady:this.context&&this.context.isInitialSyncComplete(),dragCounter:0},this.dispatcherRef=b.a.register(this.onAction),this.context.on("Room",this.onRoom),this.context.on("Room.timeline",this.onRoomTimeline),this.context.on("Room.name",this.onRoomName),this.context.on("Room.accountData",this.onRoomAccountData),this.context.on("RoomState.events",this.onRoomStateEvents),this.context.on("RoomState.members",this.onRoomStateMember),this.context.on("Room.myMembership",this.onMyMembership),this.context.on("accountData",this.onAccountData),this.context.on("crypto.keyBackupStatus",this.onKeyBackupStatus),this.context.on("deviceVerificationChanged",this.onDeviceVerificationChanged),this.context.on("userTrustStatusChanged",this.onUserVerificationChanged),this.context.on("crossSigning.keysChanged",this.onCrossSigningKeysChanged),this.context.on("Event.decrypted",this.onEventDecrypted),this.context.on("event",this.onEvent),this.roomStoreToken=O.a.addListener(this.onRoomViewStoreUpdate),this.rightPanelStoreToken=P.a.getSharedInstance().addListener(this.onRightPanelStoreUpdate),R.a.on(J.b,this.onWidgetEchoStoreUpdate),$.a.instance.on(J.b,this.onWidgetStoreUpdate),this.showReadReceiptsWatchRef=k.b.watchSetting("showReadReceipts",null,this.onReadReceiptsChange),this.layoutWatcherRef=k.b.watchSetting("layout",null,this.onLayoutChange)}getPermalinkCreatorForRoom(e){return this.permalinkCreators[e.roomId]||(this.permalinkCreators[e.roomId]=new h.a(e),this.state.room&&e.roomId===this.state.room.roomId?this.permalinkCreators[e.roomId].start():this.permalinkCreators[e.roomId].load()),this.permalinkCreators[e.roomId]}stopAllPermalinkCreators(){if(this.permalinkCreators)for(const e of Object.keys(this.permalinkCreators))this.permalinkCreators[e].stop()}setupRoom(e,t,a,n){!a&&t&&(!e&&n?(console.info("Attempting to peek into room %s",t),this.setState({peekLoading:!0,isPeeking:!0}),this.context.peekInRoom(t).then(e=>{this.unmounted||(this.setState({room:e,peekLoading:!1}),this.onRoomLoaded(e))}).catch(e=>{if(!this.unmounted){if(this.setState({isPeeking:!1}),"M_GUEST_ACCESS_FORBIDDEN"!==e.errcode&&"M_FORBIDDEN"!==e.errcode)throw e;this.setState({peekLoading:!1})}})):e&&(this.context.stopPeeking(),this.setState({isPeeking:!1})))}shouldShowApps(e){if(!le||!e)return!1;const t="false"===localStorage.getItem(e.roomId+"_hide_widget_drawer");return ee.d.instance.getContainerWidgets(e,ee.a.Top).length>0||t}componentDidMount(){this.onRoomViewStoreUpdate(!0);const e=this.getCallForRoom(),t=e?e.state:null;this.setState({callState:t}),window.addEventListener("beforeunload",this.onPageUnload),this.props.resizeNotifier&&this.props.resizeNotifier.on("middlePanelResized",this.onResize),this.onResize()}shouldComponentUpdate(e,t){const a=Object(ae.c)(this.props,e),n=t.upgradeRecommendation||{},s=Object(ie.omit)(this.state,["upgradeRecommendation"]),i=Object(ie.omit)(t,["upgradeRecommendation"]),o=Object(ae.c)(s,i)||!0===n.needsUpgrade;return a||o}componentDidUpdate(){if(this.roomView.current){const e=this.roomView.current;e.ondrop||(e.addEventListener("drop",this.onDrop),e.addEventListener("dragover",this.onDragOver),e.addEventListener("dragenter",this.onDragEnter),e.addEventListener("dragleave",this.onDragLeave))}this.messagePanel&&!this.state.atEndOfLiveTimelineInit&&this.setState({atEndOfLiveTimelineInit:!0,atEndOfLiveTimeline:this.messagePanel.isAtEndOfLiveTimeline()})}componentWillUnmount(){if(this.unmounted=!0,this.state.roomId&&x.a.setScrollState(this.state.roomId,this.getScrollState()),this.state.shouldPeek&&this.context.stopPeeking(),this.stopAllPermalinkCreators(),this.roomView.current){const e=this.roomView.current;e.removeEventListener("drop",this.onDrop),e.removeEventListener("dragover",this.onDragOver),e.removeEventListener("dragenter",this.onDragEnter),e.removeEventListener("dragleave",this.onDragLeave)}b.a.unregister(this.dispatcherRef),this.context&&(this.context.removeListener("Room",this.onRoom),this.context.removeListener("Room.timeline",this.onRoomTimeline),this.context.removeListener("Room.name",this.onRoomName),this.context.removeListener("Room.accountData",this.onRoomAccountData),this.context.removeListener("RoomState.events",this.onRoomStateEvents),this.context.removeListener("Room.myMembership",this.onMyMembership),this.context.removeListener("RoomState.members",this.onRoomStateMember),this.context.removeListener("accountData",this.onAccountData),this.context.removeListener("crypto.keyBackupStatus",this.onKeyBackupStatus),this.context.removeListener("deviceVerificationChanged",this.onDeviceVerificationChanged),this.context.removeListener("userTrustStatusChanged",this.onUserVerificationChanged),this.context.removeListener("crossSigning.keysChanged",this.onCrossSigningKeysChanged),this.context.removeListener("Event.decrypted",this.onEventDecrypted),this.context.removeListener("event",this.onEvent)),window.removeEventListener("beforeunload",this.onPageUnload),this.props.resizeNotifier&&this.props.resizeNotifier.removeListener("middlePanelResized",this.onResize),this.roomStoreToken&&this.roomStoreToken.remove(),this.rightPanelStoreToken&&this.rightPanelStoreToken.remove(),R.a.removeListener(J.b,this.onWidgetEchoStoreUpdate),$.a.instance.removeListener(J.b,this.onWidgetStoreUpdate),this.state.room&&ee.d.instance.off(ee.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),this.showReadReceiptsWatchRef&&k.b.unwatchSetting(this.showReadReceiptsWatchRef),this.updateRoomMembers.cancelPendingCall(),k.b.unwatchSetting(this.layoutWatcherRef)}async calculateRecommendedVersion(e){this.setState({upgradeRecommendation:await e.getRecommendedVersion()})}async loadMembersIfJoined(e){if(this.context.hasLazyLoadMembersEnabled()&&e&&"join"===e.getMyMembership())try{await e.loadMembersIfNeeded(),this.unmounted||this.setState({membersLoaded:!0})}catch(t){const a=`Fetching room members for ${e.roomId} failed. Room members will appear incomplete.`;console.error(a),console.error(t)}}calculatePeekRules(e){const t=e.currentState.getStateEvents("m.room.guest_access","");t&&"can_join"===t.getContent().guest_access&&this.setState({guestsCanJoin:!0});const a=e.currentState.getStateEvents("m.room.history_visibility","");a&&"world_readable"===a.getContent().history_visibility&&this.setState({canPeek:!0})}updatePreviewUrlVisibility(e){let{roomId:t}=e;const a=this.context.isRoomEncrypted(t)?"urlPreviewsEnabled_e2ee":"urlPreviewsEnabled";this.setState({showUrlPreview:k.b.getValue(a,t)})}async updateE2EStatus(e){this.context.isRoomEncrypted(e.roomId)&&(this.context.isCryptoEnabled()?this.setState({e2eStatus:await Object(A.b)(this.context,e)}):this.setState({e2eStatus:A.a.Warning}))}updateTint(){const e=this.state.room;if(!e)return;console.log("Tinter.tint from updateTint");const t=k.b.getValue("roomColor",e.roomId);y.a.tint(t.primary_color,t.secondary_color)}updatePermissions(e){if(e){const t=this.context.getUserId(),a="join"===e.getMyMembership()&&e.currentState.maySendEvent("m.reaction",t),n=e.maySendMessage();this.setState({canReact:a,canReply:n})}}checkDesktopNotifications(){this.state.room.getJoinedMemberCount()+this.state.room.getInvitedMemberCount()>1&&Q.default.shouldShowPrompt()&&Object(X.b)(!0)}updateDMState(){const e=this.state.room;if("join"!=e.getMyMembership())return;const t=e.getDMInviter();t&&_.c(e.roomId,t)}injectSticker(e,t,a){this.context.isGuest()?b.a.dispatch({action:"require_registration"}):p.a.sharedInstance().sendStickerContentToRoom(e,this.state.room.roomId,t,a,this.context).then(void 0,e=>{e.name})}handleSearchResult(e){const t=this.searchId;return this.setState({searchInProgress:!0}),e.then(e=>{if(re("search complete"),this.unmounted||!this.state.searching||this.searchId!=t)return void console.error("Discarding stale search results");let a=e.highlights;a.indexOf(this.state.searchTerm)<0&&(a=a.concat(this.state.searchTerm)),a=a.sort((function(e,t){return t.length-e.length})),this.setState({searchHighlights:a,searchResults:e})},e=>{const t=f.getComponent("dialogs.ErrorDialog");console.error("Search failed",e),g.a.createTrackedDialog("Search failed","",t,{title:Object(u.a)("Search failed"),description:e&&e.message?e.message:Object(u.a)("Server may be unavailable, overloaded, or search timed out :(")})}).finally(()=>{this.setState({searchInProgress:!1})})}getSearchResultTiles(){const e=f.getComponent("rooms.SearchResultTile"),t=f.getComponent("elements.Spinner"),a=[];var n,s;(this.state.searchInProgress&&a.push(l.a.createElement("li",{key:"search-spinner"},l.a.createElement(t,null))),this.state.searchResults.next_batch)||(null!==(n=this.state.searchResults)&&void 0!==n&&null!==(s=n.results)&&void 0!==s&&s.length?a.push(l.a.createElement("li",{key:"search-top-marker"},l.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(u.a)("No more results")))):a.push(l.a.createElement("li",{key:"search-top-marker"},l.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(u.a)("No results")))));const i=()=>{const e=this.searchResultsPanel.current;e&&e.checkScroll()};let o;for(let t=((null===(r=this.state.searchResults)||void 0===r||null===(c=r.results)||void 0===c?void 0:c.length)||0)-1;t>=0;t--){var r,c;const n=this.state.searchResults.results[t],s=n.context.getEvent(),d=s.getRoomId(),m=this.context.getRoom(d);if(!m){console.log("Hiding search result from an unknown room",d);continue}if(!Object(N.b)(s))continue;"All"===this.state.searchScope&&d!==o&&(a.push(l.a.createElement("li",{key:s.getId()+"-room"},l.a.createElement("h2",null,Object(u.a)("Room"),": ",m.name))),o=d);const h="#/room/"+d+"/"+s.getId();a.push(l.a.createElement(e,{key:s.getId(),searchResult:n,searchHighlights:this.state.searchHighlights,resultLink:h,permalinkCreator:this.getPermalinkCreatorForRoom(m),onHeightChanged:i}))}return a}getScrollState(){const e=this.messagePanel;if(!e)return null;if(this.state.atEndOfLiveTimeline)return null;const t=e.getScrollState();return!t||t.stuckAtBottom?null:{focussedEvent:t.trackedScrollToken,pixelOffset:t.pixelOffset}}getCallForRoom(){return this.state.room?v.d.sharedInstance().getCallForRoom(this.state.room.roomId):null}getOldRoom(){const e=this.state.room.currentState.getStateEvents("m.room.create","");return e&&e.getContent().predecessor?this.context.getRoom(e.getContent().predecessor.room_id):null}getHiddenHighlightCount(){const e=this.getOldRoom();return e?e.getUnreadNotificationCount("highlight"):0}render(){var e;if(!this.state.room){const e=!this.state.matrixClientIsReady||this.state.roomLoading||this.state.peekLoading;if(e){const t=!this.state.matrixClientIsReady||!this.state.roomId||this.state.peekLoading;return l.a.createElement("div",{className:"mx_RoomView"},l.a.createElement(F.a,null,l.a.createElement(B.a,{canPreview:!1,previewLoading:t&&!this.state.roomLoadError,error:this.state.roomLoadError,loading:e,joining:this.state.joining,oobData:this.props.oobData})))}{var t,n;let e=void 0;this.props.oobData&&(e=this.props.oobData.inviterName);const a=null===(t=this.props.threepidInvite)||void 0===t?void 0:t.toEmail,s=this.state.roomAlias;return l.a.createElement("div",{className:"mx_RoomView"},l.a.createElement(F.a,null,l.a.createElement(B.a,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,canPreview:!1,error:this.state.roomLoadError,roomAlias:s,joining:this.state.joining,inviterName:e,invitedEmail:a,oobData:this.props.oobData,signUrl:null===(n=this.props.threepidInvite)||void 0===n?void 0:n.signUrl,room:this.state.room})))}}const s=this.state.room.getMyMembership();if(!("invite"!==s||k.b.getValue("feature_spaces")&&this.state.room.isSpaceRoom())){if(this.state.joining||this.state.rejecting)return l.a.createElement(F.a,null,l.a.createElement(B.a,{canPreview:!1,error:this.state.roomLoadError,joining:this.state.joining,rejecting:this.state.rejecting}));{const e=this.context.credentials.userId,t=this.state.room.getMember(e),a=t?t.events.member:null;let n=Object(u.a)("Unknown");return a&&(n=a.sender?a.sender.name:a.getSender()),l.a.createElement("div",{className:"mx_RoomView"},l.a.createElement(F.a,null,l.a.createElement(B.a,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectButtonClicked,onRejectAndIgnoreClick:this.onRejectAndIgnoreClick,inviterName:n,canPreview:!1,joining:this.state.joining,room:this.state.room})))}}let i=null;this.state.draggingFile&&(i=l.a.createElement("div",{className:"mx_RoomView_fileDropTarget"},l.a.createElement("img",{src:a(867),className:"mx_RoomView_fileDropTarget_image"}),Object(u.a)("Drop file here to upload")));let o=null;{const e=this.getCallForRoom();e&&"ended"!==this.state.callState&&"ringing"!==this.state.callState&&(o=e)}const r=d()({mx_RoomView_scrollheader:!0});let c,m=!0;if(p.a.sharedInstance().getCurrentUploads().length>0){const e=f.getComponent("structures.UploadBar");c=l.a.createElement(e,{room:this.state.room})}else if(!this.state.searchResults){const e=f.getComponent("structures.RoomStatusBar");m=this.state.statusBarVisible,c=l.a.createElement(e,{room:this.state.room,isPeeking:"join"!==s,onInviteClick:this.onInviteButtonClick,onVisible:this.onStatusBarVisible,onHidden:this.onStatusBarHidden})}const h=this.state.upgradeRecommendation,g=h&&h.needsUpgrade&&this.state.room.userMayUpgradeRoom(this.context.credentials.userId),v=this.getHiddenHighlightCount();let b,y=null,E=!1;if(this.state.forwardingEvent)y=l.a.createElement(V.a,{onCancelClick:this.onCancelClick});else if(this.state.searching)E=!0,y=l.a.createElement(G.a,{searchInProgress:this.state.searchInProgress,onCancelClick:this.onCancelSearchClick,onSearch:this.onSearch,isRoomEncrypted:this.context.isRoomEncrypted(this.state.room.roomId)});else if(g)y=l.a.createElement(z.a,{room:this.state.room,recommendation:h}),E=!0;else if("join"!==s){var _,S;let e=void 0;this.props.oobData&&(e=this.props.oobData.inviterName);const t=null===(_=this.props.threepidInvite)||void 0===_?void 0:_.toEmail;if(E=!0,b=l.a.createElement(B.a,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,joining:this.state.joining,inviterName:e,invitedEmail:t,oobData:this.props.oobData,canPreview:this.state.canPeek,room:this.state.room}),!(this.state.canPeek||k.b.getValue("feature_spaces")&&null!==(S=this.state.room)&&void 0!==S&&S.isSpaceRoom()))return l.a.createElement("div",{className:"mx_RoomView"},b)}else v>0&&(y=l.a.createElement(T.a,{element:"div",className:"mx_RoomView_auxPanel_hiddenHighlights",onClick:this.onHiddenHighlightsClick},Object(u.a)("You have %(count)s unread notifications in a prior version of this room.",{count:v})));if(null!==(e=this.state.room)&&void 0!==e&&e.isSpaceRoom())return l.a.createElement(ne.b,{space:this.state.room,justCreatedOpts:this.props.justCreatedOpts,resizeNotifier:this.props.resizeNotifier,onJoinButtonClicked:this.onJoinButtonClicked,onRejectButtonClicked:this.props.threepidInvite?this.onRejectThreepidInviteButtonClicked:this.onRejectButtonClicked});const O=l.a.createElement(W.a,{room:this.state.room,fullHeight:!1,userId:this.context.credentials.userId,maxHeight:this.state.auxPanelMaxHeight,showApps:this.state.showApps,onResize:this.onResize,resizeNotifier:this.props.resizeNotifier},y);let x,R;if("join"===s&&!this.state.searchResults){const e=f.getComponent("rooms.MessageComposer");x=l.a.createElement(e,{room:this.state.room,callState:this.state.callState,showApps:this.state.showApps,e2eStatus:this.state.e2eStatus,resizeNotifier:this.props.resizeNotifier,replyToEvent:this.state.replyToEvent,permalinkCreator:this.getPermalinkCreatorForRoom(this.state.room)})}let P;this.state.searchResults&&(R={searchTerm:this.state.searchTerm,searchScope:this.state.searchScope,searchCount:this.state.searchResults.count});let N=!1;this.state.searchResults&&(P=void 0===this.state.searchResults.count?l.a.createElement("div",{className:"mx_RoomView_messagePanel mx_RoomView_messagePanelSearchSpinner"}):l.a.createElement(U.a,{ref:this.searchResultsPanel,className:"mx_RoomView_messagePanel mx_RoomView_searchResultsPanel mx_GroupLayout",onFillRequest:this.onSearchResultsFillRequest,resizeNotifier:this.props.resizeNotifier},l.a.createElement("li",{className:r}),this.getSearchResultTiles()),N=!0);const j=this.state.isInitialEventHighlighted;let A=null;this.state.forwardingEvent?A=this.state.forwardingEvent.getId():j&&(A=this.state.initialEventId);const M=d()("mx_RoomView_messagePanel",{mx_IRCLayout:this.state.layout==I.a.IRC,mx_GroupLayout:this.state.layout==I.a.Group}),q=l.a.createElement(L.a,{ref:this.gatherTimelinePanelRef,timelineSet:this.state.room.getUnfilteredTimelineSet(),showReadReceipts:this.state.showReadReceipts,manageReadReceipts:!this.state.isPeeking,sendReadReceiptOnLoad:!this.state.wasContextSwitch,manageReadMarkers:!this.state.isPeeking,hidden:N,highlightedEventId:A,eventId:this.state.initialEventId,eventPixelOffset:this.state.initialEventPixelOffset,onScroll:this.onMessageListScroll,onUserScroll:this.onUserScroll,onReadMarkerUpdated:this.updateTopUnreadMessagesBar,showUrlPreview:this.state.showUrlPreview,className:M,membersLoaded:this.state.membersLoaded,permalinkCreator:this.getPermalinkCreatorForRoom(this.state.room),resizeNotifier:this.props.resizeNotifier,showReactions:!0,layout:this.state.layout});let Y,$=null;if(this.state.showTopUnreadMessagesBar&&!this.state.searchResults){const e=f.getComponent("rooms.TopUnreadMessagesBar");$=l.a.createElement(e,{onScrollUpClick:this.jumpToReadMarker,onCloseClick:this.forgetReadMarker})}if(!this.state.atEndOfLiveTimeline&&!this.state.searchResults){const e=f.getComponent("rooms.JumpToBottomButton");Y=l.a.createElement(e,{highlight:this.state.room.getUnreadNotificationCount("highlight")>0,numUnreadMessages:this.state.numUnreadMessages,onScrollToBottomClick:this.jumpToLiveTimeline,roomId:this.state.roomId})}const J=d()("mx_RoomView_statusArea",{mx_RoomView_statusArea_expanded:m}),Q=this.state.room&&this.state.showRightPanel?l.a.createElement(w.a,{room:this.state.room,resizeNotifier:this.props.resizeNotifier}):null,X=d()("mx_RoomView_timeline",{mx_RoomView_timeline_rr_enabled:this.state.showReadReceipts}),Z=d()("mx_RoomView",{mx_RoomView_inCall:Boolean(o)}),ee=k.b.getValue("showChatEffects");return l.a.createElement(D.a.Provider,{value:this.state},l.a.createElement("main",{className:Z,ref:this.roomView,onKeyDown:this.onReactKeyDown},ee&&this.roomView.current&&l.a.createElement(K.a,{roomWidth:this.roomView.current.offsetWidth}),l.a.createElement(F.a,null,l.a.createElement(H.a,{room:this.state.room,searchInfo:R,oobData:this.props.oobData,inRoom:"join"===s,onSearchClick:this.onSearchClick,onSettingsClick:this.onSettingsClick,onCancelClick:y&&!E?this.onCancelClick:null,onForgetClick:"leave"===s?this.onForgetClick:null,onLeaveClick:"join"===s?this.onLeaveClick:null,e2eStatus:this.state.e2eStatus,onAppsClick:this.state.hasPinnedWidgets?this.onAppsClick:null,appsShown:this.state.showApps,onCallPlaced:this.onCallPlaced}),l.a.createElement(C.a,{panel:Q,resizeNotifier:this.props.resizeNotifier},l.a.createElement("div",{className:"mx_RoomView_body"},O,l.a.createElement("div",{className:X},i,$,Y,q,P),l.a.createElement("div",{className:J},l.a.createElement("div",{className:"mx_RoomView_statusAreaBox"},l.a.createElement("div",{className:"mx_RoomView_statusAreaBox_line"}),c)),b,x)))))}},o()(s,"contextType",j.a),n=s))||n}).call(this,a(212).setImmediate)},8405:function(e,t){e.exports="img/element-icons/brands/apple.b8012bc.svg"},8406:function(e,t){e.exports="img/element-icons/brands/facebook.f7f0321.svg"},8407:function(e,t){e.exports="img/element-icons/brands/github.bf74bfd.svg"},8408:function(e,t){e.exports="img/element-icons/brands/gitlab.f35856c.svg"},8409:function(e,t){e.exports="img/element-icons/brands/google.3afbcce.svg"},841:function(e,t,a){"use strict";var n=a(88),s=a.n(n);t.a=e=>{let{value:t,max:a}=e;return s.a.createElement("progress",{className:"mx_ProgressBar",max:a,value:t})}},8410:function(e,t){e.exports="img/element-icons/brands/twitter.cea396d.svg"},8412:function(e,t){e.exports="img/feather-customised/files.a484b40.svg"},8413:function(e,t){e.exports="img/download.c281461.svg"},842:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(108),d=a(194);const m=["inputRef"],u=e=>{let{inputRef:t}=e,a=o()(e,m);const[n,i,r]=Object(d.e)(t);return l.a.createElement(c.a,s()({},a,{onFocus:n,inputRef:r,tabIndex:i?0:-1}))}},8427:function(e,t){e.exports="img/icons-room-add.9e8d369.svg"},8428:function(e,t){e.exports="img/camera.3d903f1.svg"},8429:function(e,t){e.exports="img/icons-groups.870fab1.svg"},843:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(88),l=a.n(r),c=a(135),d=a(194);const m=["inputRef"],u=e=>{let{inputRef:t}=e,a=o()(e,m);const[n,i,r]=Object(d.e)(t);return l.a.createElement(c.a,s()({},a,{onFocus:n,inputRef:r,tabIndex:i?0:-1}))}},8430:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return p}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(93),u=a(154),h=a(94);let p=Object(h.a)("views.auth.CaptchaForm")((s=class extends l.a.Component{constructor(e){super(e),this.state={errorText:null},this._captchaWidgetId=null,this._recaptchaContainer=Object(r.createRef)(),u.a.instance.track("onboarding_grecaptcha_begin")}componentDidMount(){if(e.grecaptcha)this._onCaptchaLoaded();else{console.log("Loading recaptcha script..."),window.mx_on_recaptcha_loaded=()=>{this._onCaptchaLoaded()};const e=document.createElement("script");e.setAttribute("src","https://www.recaptcha.net/recaptcha/api.js?onload=mx_on_recaptcha_loaded&render=explicit"),this._recaptchaContainer.current.appendChild(e)}}componentWillUnmount(){this._resetRecaptcha()}_renderRecaptcha(t){if(!e.grecaptcha)throw console.error("grecaptcha not loaded!"),new Error("Recaptcha did not load successfully");const a=this.props.sitePublicKey;if(!a)throw console.error("No public key for recaptcha!"),new Error("This server has not supplied enough information for Recaptcha authentication");console.info("Rendering to %s",t),this._captchaWidgetId=e.grecaptcha.render(t,{sitekey:a,callback:this.props.onCaptchaResponse})}_resetRecaptcha(){null!==this._captchaWidgetId&&e.grecaptcha.reset(this._captchaWidgetId)}_onCaptchaLoaded(){console.log("Loaded recaptcha script.");try{this._renderRecaptcha("mx_recaptcha"),this.setState({errorText:null}),u.a.instance.track("onboarding_grecaptcha_loaded")}catch(e){this.setState({errorText:e.toString()}),u.a.instance.track("onboarding_grecaptcha_error",{error:e.toString()})}}render(){let e=null;return this.state.errorText&&(e=l.a.createElement("div",{className:"error"},this.state.errorText)),l.a.createElement("div",{ref:this._recaptchaContainer},l.a.createElement("p",null,Object(m.a)("This homeserver would like to make sure you are not a robot.")),l.a.createElement("div",{id:"mx_recaptcha"}),e)}},o()(s,"propTypes",{sitePublicKey:d.a.string,onCaptchaResponse:d.a.func}),o()(s,"defaultProps",{onCaptchaResponse:()=>{}}),n=s))||n}).call(this,a(7))},8431:function(e,t){e.exports="img/icon_context_delete.2ee531e.svg"},8433:function(e,t){e.exports="img/search-icon-vector.c463bb6.svg"},8434:function(e,t){e.exports="img/icon-email-user.4f6a544.svg"},8435:function(e,t){e.exports="img/icon-address-delete.3ce3a36.svg"},8438:function(e,t){e.exports="img/icons-show-stickers.4e420bf.svg"},8439:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return D}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(129),d=a.n(c),m=a(92),u=a.n(m),h=a(1328),p=a.n(h),g=a(201),f=a(222),v=a(97),b=a(106),y=a(100),E=a(93),_=a(127),S=a(103),C=a(413),w=a(1534),O=a(283),x=a(155),R=a(226),k=a(135),I=a(94),T=a(200);function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function N(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let D=Object(I.a)("views.messages.TextualBody")((s=class extends l.a.Component{constructor(t){super(t),o()(this,"onCancelClick",t=>{this.setState({widgetHidden:!0}),e.localStorage&&e.localStorage.setItem("hide_preview_"+this.props.mxEvent.getId(),"1"),this.forceUpdate()}),o()(this,"onEmoteSenderClick",e=>{const t=this.props.mxEvent;y.a.dispatch({action:"insert_mention",user_id:t.getSender()})}),o()(this,"getEventTileOps",()=>({isWidgetHidden:()=>this.state.widgetHidden,unhideWidget:()=>{this.setState({widgetHidden:!1}),e.localStorage&&e.localStorage.removeItem("hide_preview_"+this.props.mxEvent.getId())}})),o()(this,"onStarterLinkClick",(e,t)=>{t.preventDefault();const a=O.a.sharedInstance();if(!a.hasManager())return void a.openNoManagerDialog();const n=a.getPrimaryManager(),s=n.getScalarClient();s.connect().then(()=>{const t=s.getStarterLink(e),a=v.getComponent("dialogs.QuestionDialog"),i=n.uiUrl;b.a.createTrackedDialog("Add an integration","",a,{title:Object(E.a)("Add an Integration"),description:l.a.createElement("div",null,Object(E.a)("You are about to be taken to a third-party site so you can authenticate your account for use with %(integrationsUrl)s. Do you wish to continue?",{integrationsUrl:i})),button:Object(E.a)("Continue"),onFinished(e){if(!e)return;const a=window.screen.width>1024?1024:window.screen.width,n=window.screen.height>800?800:window.screen.height,s=(window.screen.width-a)/2,i=`height=${n}, width=${a}, top=${(window.screen.height-n)/2}, left=${s},`;window.open(t,"_blank",i).opener=null}})})}),o()(this,"_openHistoryDialog",async()=>{const e=v.getComponent("views.dialogs.MessageEditHistoryDialog");b.a.createDialog(e,{mxEvent:this.props.mxEvent})}),this._content=Object(r.createRef)(),this.state={links:[],widgetHidden:!1}}componentDidMount(){this._unmounted=!1,this._pills=[],this.props.editState||this._applyFormatting()}_applyFormatting(){const e=S.b.getValue("showCodeLineNumbers");if(this.activateSpoilers([this._content.current]),Object(w.a)([this._content.current],this.props.mxEvent,this._pills),g.g(this._content.current),this.calculateUrlPreview(),"org.matrix.custom.html"===this.props.mxEvent.getContent().format){const t=d.a.findDOMNode(this).getElementsByTagName("pre");if(t.length>0)for(let a=0;a<t.length;a++){if("mx_EventTile_pre_container"==t[a].parentNode.className)continue;0==t[a].getElementsByTagName("code").length&&this._addCodeElement(t[a]);const n=this._wrapInDiv(t[a]);this._handleCodeBlockExpansion(t[a]),this._addCodeExpansionButton(n,t[a]),this._addCodeCopyButton(n),e&&this._addLineNumbers(t[a])}const a=d.a.findDOMNode(this).getElementsByTagName("code");a.length>0&&setTimeout(()=>{if(!this._unmounted)for(let e=0;e<a.length;e++)a[e].className.includes("hljs")||this._highlightCode(a[e])},10)}}_addCodeElement(e){const t=document.createElement("code");t.append(...e.childNodes),e.appendChild(t)}_addCodeExpansionButton(e,t){if(t.offsetHeight/T.b.instance.windowHeight*100<30)return;const a=document.createElement("span");a.className="mx_EventTile_button ","mx_EventTile_collapsedCodeBlock"==t.className?a.className+="mx_EventTile_expandButton":a.className+="mx_EventTile_collapseButton",a.onclick=async()=>{a.className="mx_EventTile_button ","mx_EventTile_collapsedCodeBlock"==t.className?(t.className="",a.className+="mx_EventTile_collapseButton"):(t.className="mx_EventTile_collapsedCodeBlock",a.className+="mx_EventTile_expandButton"),this.props.onHeightChanged()},e.appendChild(a)}_addCodeCopyButton(e){const t=document.createElement("span");t.className="mx_EventTile_button mx_EventTile_copyButton ";e.getElementsByClassName("mx_EventTile_button").length>0&&(t.className+="mx_EventTile_buttonBottom"),t.onclick=async()=>{const e=t.parentNode.getElementsByTagName("code")[0],a=await Object(R.c)(e.textContent),n=t.getBoundingClientRect(),s=v.getComponent("context_menus.GenericTextContextMenu"),{close:i}=_.n(s,N(N({},Object(_.p)(n,2)),{},{message:a?Object(E.a)("Copied!"):Object(E.a)("Failed to copy")}));t.onmouseleave=i},e.appendChild(t)}_wrapInDiv(e){const t=document.createElement("div");return t.className="mx_EventTile_pre_container",e.parentNode.replaceChild(t,e),t.appendChild(e),t}_handleCodeBlockExpansion(e){S.b.getValue("expandCodeByDefault")||(e.className="mx_EventTile_collapsedCodeBlock")}_addLineNumbers(e){const t=e.innerHTML.replace(/\n(<\/code>)?$/,"").split(/\n/).length;e.innerHTML='<span class="mx_EventTile_lineNumbers"></span>'+e.innerHTML+"<span></span>";const a=e.getElementsByClassName("mx_EventTile_lineNumbers")[0];for(let e=1;e<=t;e++)a.innerHTML+='<span class="mx_EventTile_lineNumber">'+e+"</span>"}_highlightCode(e){if(S.b.getValue("enableSyntaxHighlightLanguageDetection"))p.a.highlightBlock(e);else{0!=e.className.split(/\s+/).filter((function(e){return e.startsWith("language-")&&!e.startsWith("language-_")})).length&&p.a.highlightBlock(e)}}componentDidUpdate(e){if(!this.props.editState){const t=e.editState&&!this.props.editState;(e.replacingEventId!==this.props.replacingEventId||t)&&this._applyFormatting()}}componentWillUnmount(){this._unmounted=!0,Object(w.b)(this._pills)}shouldComponentUpdate(e,t){return e.mxEvent.getId()!==this.props.mxEvent.getId()||e.highlights!==this.props.highlights||e.replacingEventId!==this.props.replacingEventId||e.highlightLink!==this.props.highlightLink||e.showUrlPreview!==this.props.showUrlPreview||e.editState!==this.props.editState||t.links!==this.state.links||t.widgetHidden!==this.state.widgetHidden}calculateUrlPreview(){if(this.props.showUrlPreview){let t=this.findLinks([this._content.current]);if(t.length){if(t=Array.from(new Set(t.map(e=>{const t=new URL(e);return t.hash="",t.toString()}))),this.setState({links:t}),e.localStorage){const t=e.localStorage.getItem("hide_preview_"+this.props.mxEvent.getId());this.setState({widgetHidden:t})}}else this.state.links.length&&this.setState({links:[]})}}activateSpoilers(e){let t=e[0];for(;t;){if("SPAN"===t.tagName&&"string"==typeof t.getAttribute("data-mx-spoiler")){const e=document.createElement("span"),a=t.getAttribute("data-mx-spoiler"),n=v.getComponent("elements.Spoiler");t.removeAttribute("data-mx-spoiler");const s=l.a.createElement(n,{reason:a,contentHtml:t.outerHTML});d.a.render(s,e),t.parentNode.replaceChild(e,t),t=e}t.childNodes&&t.childNodes.length&&this.activateSpoilers(t.childNodes),t=t.nextSibling}}findLinks(e){let t=[];for(let a=0;a<e.length;a++){const n=e[a];if("A"===n.tagName&&n.getAttribute("href"))this.isLinkPreviewable(n)&&t.push(n.getAttribute("href"));else{if("PRE"===n.tagName||"CODE"===n.tagName||"BLOCKQUOTE"===n.tagName)continue;n.children&&n.children.length&&(t=t.concat(this.findLinks(n.children)))}}return t}isLinkPreviewable(e){if(!e.getAttribute("href").startsWith("http://")&&!e.getAttribute("href").startsWith("https://"))return!1;if(e.textContent.indexOf("/")>-1)return!0;{const t=e.getAttribute("href").match(/^https?:\/\/(.*?)(\/|$)/)[1];return!Object(x.d)(t)&&!e.textContent.toLowerCase().trim().startsWith(t.toLowerCase())}}_renderEditedMarker(){const e=this.props.mxEvent.replacingEventDate(),t=e&&Object(f.a)(e),a=l.a.createElement("div",null,l.a.createElement("div",{className:"mx_Tooltip_title"},Object(E.a)("Edited at %(date)s",{date:t})),l.a.createElement("div",{className:"mx_Tooltip_sub"},Object(E.a)("Click to view edits")));return l.a.createElement(k.a,{className:"mx_EventTile_edited",onClick:this._openHistoryDialog,title:Object(E.a)("Edited at %(date)s. Click to view edits.",{date:t}),tooltip:a},l.a.createElement("span",null,`(${Object(E.a)("edited")})`))}render(){if(this.props.editState){const e=v.getComponent("rooms.EditMessageComposer");return l.a.createElement(e,{editState:this.props.editState,className:"mx_EventTile_content"})}const e=this.props.mxEvent,t=e.getContent(),a=!e.replacingEvent()&&C.a.getParentEventId(e);let n,s=g.b(t,this.props.highlights,{disableBigEmoji:"m.emote"===t.msgtype||!S.b.getValue("TextualBody.enableBigEmoji"),stripReplyFallback:a,ref:this._content});if(this.props.replacingEventId&&(s=l.a.createElement(l.a.Fragment,null,s,this._renderEditedMarker())),this.props.highlightLink?s=l.a.createElement("a",{href:this.props.highlightLink},s):t.data&&"string"==typeof t.data["org.matrix.neb.starter_link"]&&(s=l.a.createElement("a",{href:"#",onClick:this.onStarterLinkClick.bind(this,t.data["org.matrix.neb.starter_link"])},s)),this.state.links.length&&!this.state.widgetHidden&&this.props.showUrlPreview){const e=v.getComponent("rooms.LinkPreviewWidget");n=this.state.links.map(t=>l.a.createElement(e,{key:t,link:t,mxEvent:this.props.mxEvent,onCancelClick:this.onCancelClick,onHeightChanged:this.props.onHeightChanged}))}switch(t.msgtype){case"m.emote":return l.a.createElement("span",{className:"mx_MEmoteBody mx_EventTile_content"},"* ",l.a.createElement("span",{className:"mx_MEmoteBody_sender",onClick:this.onEmoteSenderClick},e.sender?e.sender.name:e.getSender())," ",s,n);case"m.notice":return l.a.createElement("span",{className:"mx_MNoticeBody mx_EventTile_content"},s,n);default:return l.a.createElement("span",{className:"mx_MTextBody mx_EventTile_content"},s,n)}}},o()(s,"propTypes",{mxEvent:u.a.object.isRequired,highlights:u.a.array,highlightLink:u.a.string,showUrlPreview:u.a.bool,onHeightChanged:u.a.func,tileShape:u.a.string}),n=s))||n}).call(this,a(7))},844:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return P}));var n,s=a(19),i=a.n(s),o=a(88),r=a(1),l=a(102),c=a.n(l),d=a(194),m=a(93),u=a(108),h=a(845),p=a(127),g=a(174),f=a(324),v=a(161),b=a(100),y=a(269),E=a(135),_=a(131),S=a(370),C=a(849),w=a(184),O=a(637),x=a(153),R=a(166),k=a(202),I=a(220),T=a(94);Object(C.a)();let P=Object(T.a)("views.rooms.RoomSublist")(n=class t extends o.Component{constructor(t){super(t),i()(this,"headerButton",Object(o.createRef)()),i()(this,"sublistRef",Object(o.createRef)()),i()(this,"tilesRef",Object(o.createRef)()),i()(this,"dispatcherRef",void 0),i()(this,"layout",void 0),i()(this,"heightAtStart",void 0),i()(this,"isBeingFiltered",void 0),i()(this,"notificationState",void 0),i()(this,"onListsUpdated",()=>{const e={};if(this.props.extraTiles){const t=g.b.instance.getFirstNameFilterCondition();t?e.filteredExtraTiles=this.props.extraTiles.filter(e=>t.matches(Object(r.q)(e.props.displayName||""))):this.state.filteredExtraTiles&&(e.filteredExtraTiles=null)}const t=this.state.rooms,a=Object(x.b)(g.b.instance.orderedLists[this.props.tagId]||[]);Object(x.e)(t,a)&&(e.rooms=a);const n=!!g.b.instance.getFirstNameFilterCondition();n!==this.isBeingFiltered&&(this.isBeingFiltered=n,e.isExpanded=!!n||!this.layout.isCollapsed),Object.keys(e).length>0&&this.setState(e)}),i()(this,"onAction",t=>{"view_room"===t.action&&t.show_room_tile&&this.state.rooms&&e(()=>{const e=this.state.rooms.findIndex(e=>e.roomId===t.room_id);!this.state.isExpanded&&e>-1&&this.toggleCollapsed(),e>=this.numVisibleTiles&&(this.layout.visibleTiles=this.layout.tilesWithPadding(e+1,32),this.forceUpdate())})}),i()(this,"onAddRoom",e=>{e.stopPropagation(),this.props.onAddRoom&&this.props.onAddRoom()}),i()(this,"onResize",(e,t,a,n)=>{const s=this.heightAtStart+n.height;this.applyHeightChange(s),this.setState({height:s})}),i()(this,"onResizeStart",()=>{this.heightAtStart=this.state.height,this.setState({isResizing:!0})}),i()(this,"onResizeStop",(e,t,a,n)=>{const s=this.heightAtStart+n.height;this.applyHeightChange(s),this.setState({isResizing:!1,height:s})}),i()(this,"onShowAllClick",()=>{const e=this.numVisibleTiles,t=this.layout.tilesToPixelsWithPadding(this.numTiles,this.padding);this.applyHeightChange(t),this.setState({height:t},()=>{this.focusRoomTile(e)})}),i()(this,"onShowLessClick",()=>{const e=this.layout.tilesToPixelsWithPadding(this.layout.defaultVisibleTiles,this.padding);this.applyHeightChange(e),this.setState({height:e})}),i()(this,"focusRoomTile",e=>{if(!this.sublistRef.current)return;const t=this.sublistRef.current.querySelectorAll(".mx_RoomTile"),a=t&&t[e];a&&a.focus()}),i()(this,"onOpenMenuClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})}),i()(this,"onContextMenu",e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{left:e.clientX,top:e.clientY,height:0}})}),i()(this,"onAddRoomContextMenu",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({addRoomContextMenuPosition:t.getBoundingClientRect()})}),i()(this,"onCloseMenu",()=>{this.setState({contextMenuPosition:null})}),i()(this,"onCloseAddRoomMenu",()=>{this.setState({addRoomContextMenuPosition:null})}),i()(this,"onUnreadFirstChanged",async()=>{const e=g.b.instance.getListOrder(this.props.tagId)===f.a.Importance?f.a.Natural:f.a.Importance;await g.b.instance.setListOrder(this.props.tagId,e),this.forceUpdate()}),i()(this,"onTagSortChanged",async e=>{await g.b.instance.setTagSorting(this.props.tagId,e)}),i()(this,"onMessagePreviewChanged",()=>{this.layout.showPreviews=!this.layout.showPreviews,this.forceUpdate()}),i()(this,"onBadgeClick",e=>{let t;e.preventDefault(),e.stopPropagation(),t=this.props.tagId===v.a.Invite?this.state.rooms&&this.state.rooms[0]:g.b.instance.unfilteredLists[this.props.tagId].find(e=>{const t=this.notificationState.getForRoom(e);return t.count>0&&t.color===this.notificationState.color}),t&&b.a.dispatch({action:"view_room",room_id:t.roomId,show_room_tile:!0})}),i()(this,"onHeaderClick",()=>{const t=this.headerButton.current.parentElement,a=t.parentElement.parentElement,n=a.parentElement.parentElement,s=n.scrollTop<=32,i=n.scrollTop>=n.scrollHeight-n.offsetHeight,o=t.classList.contains("mx_RoomSublist_headerContainer_stickyTop"),r=t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom");if(r&&!i||o&&!s)a.scrollIntoView({behavior:"smooth"});else{const t=this.state.isExpanded;this.toggleCollapsed(),!t&&r&&e(()=>{a.scrollIntoView({behavior:"smooth"})})}}),i()(this,"toggleCollapsed",()=>{this.layout.isCollapsed=this.state.isExpanded,this.setState({isExpanded:!this.layout.isCollapsed}),this.props.onListCollapse&&this.props.onListCollapse(!this.layout.isCollapsed)}),i()(this,"onHeaderKeyDown",e=>{switch(Object(I.f)().getRoomListAction(e)){case I.e.CollapseSection:e.stopPropagation(),this.state.isExpanded&&this.toggleCollapsed();break;case I.e.ExpandSection:if(e.stopPropagation(),this.state.isExpanded){if(this.sublistRef.current){const e=this.sublistRef.current.querySelector(".mx_RoomTile");e&&e.focus()}}else this.toggleCollapsed()}}),i()(this,"onKeyDown",e=>{switch(e.key){case _.a.ARROW_LEFT:e.stopPropagation(),this.headerButton.current.focus();break;case _.a.ARROW_RIGHT:e.stopPropagation()}}),this.layout=O.a.instance.getLayoutFor(this.props.tagId),this.heightAtStart=0,this.isBeingFiltered=!!g.b.instance.getFirstNameFilterCondition(),this.notificationState=w.a.instance.getListState(this.props.tagId),this.state={contextMenuPosition:null,addRoomContextMenuPosition:null,isResizing:!1,isExpanded:this.isBeingFiltered?this.isBeingFiltered:!this.layout.isCollapsed,height:0,rooms:Object(x.b)(g.b.instance.orderedLists[this.props.tagId]||[])},this.state=Object.assign(this.state,{height:this.calculateInitialHeight()})}calculateInitialHeight(){const e=Math.max(Math.floor(this.layout.visibleTiles),this.layout.minVisibleTiles),t=Math.min(this.numTiles,e);return this.layout.tilesToPixelsWithPadding(t,this.padding)}get padding(){let e=4;const t=this.numTiles>this.numVisibleTiles,a=this.numTiles>this.layout.defaultVisibleTiles;return(t||a)&&(e+=28),e}get extraTiles(){return this.state.filteredExtraTiles?this.state.filteredExtraTiles:this.props.extraTiles?this.props.extraTiles:null}get numTiles(){return t.calcNumTiles(this.state.rooms,this.extraTiles)}static calcNumTiles(e,t){return(e||[]).length+(t||[]).length}get numVisibleTiles(){const e=Math.ceil(this.layout.visibleTiles);return Math.min(e,this.numTiles)}componentDidUpdate(e,a){const n=a.filteredExtraTiles||e.extraTiles;t.calcNumTiles(a.rooms,n)!==this.numTiles&&this.setState({height:this.calculateInitialHeight()})}shouldComponentUpdate(e,a){if(Object(R.c)(this.props,e))return!0;const n=Object(R.b)(this.state,["rooms"]),s=Object(R.b)(a,["rooms"]);if(Object(R.c)(n,s))return!0;const i=this.props.extraTiles||[],o=a.filteredExtraTiles||e.extraTiles||[];if(i.length>0||o.length>0)return!0;if(t.calcNumTiles(a.rooms,o)!==this.numTiles)return!0;if(!a.isExpanded)return!1;if(this.state.rooms.length!==a.rooms.length)return!0;const r=this.state.rooms.slice(0,this.numVisibleTiles),l=a.rooms.slice(0,this.numVisibleTiles);return!!Object(x.e)(r,l)}componentDidMount(){var e;this.dispatcherRef=b.a.register(this.onAction),g.b.instance.on(g.a,this.onListsUpdated),null===(e=this.tilesRef.current)||void 0===e||e.addEventListener("scroll",this.onScrollPrevent,{passive:!0})}componentWillUnmount(){var e;b.a.unregister(this.dispatcherRef),g.b.instance.off(g.a,this.onListsUpdated),null===(e=this.tilesRef.current)||void 0===e||e.removeEventListener("scroll",this.onScrollPrevent)}applyHeightChange(e){const t=Math.ceil(this.layout.pixelsToTiles(e-this.padding));this.layout.visibleTiles=Math.min(this.numTiles,t)}renderVisibleTiles(){if(!this.state.isExpanded)return[];const e=[];if(this.state.rooms){const t=this.state.rooms.slice(0,this.numVisibleTiles);for(const a of t)e.push(o.createElement(h.a,{room:a,key:"room-"+a.roomId,showMessagePreview:this.layout.showPreviews,isMinimized:this.props.isMinimized,tag:this.props.tagId}))}return this.extraTiles&&e.push(...this.extraTiles),e.length>this.numVisibleTiles?e.slice(0,this.numVisibleTiles):e}renderMenu(){let e=null;if(this.state.contextMenuPosition){const t=g.b.instance.getTagSorting(this.props.tagId)===f.b.Alphabetic,a=g.b.instance.getListOrder(this.props.tagId)===f.a.Importance;let n=null;this.props.tagId!==v.a.Invite&&(n=o.createElement(o.Fragment,null,o.createElement("hr",null),o.createElement("div",null,o.createElement("div",{className:"mx_RoomSublist_contextMenu_title"},Object(m.a)("Appearance")),o.createElement(p.i,{onClose:this.onCloseMenu,onChange:this.onUnreadFirstChanged,checked:a},Object(m.a)("Show rooms with unread messages first")),o.createElement(p.i,{onClose:this.onCloseMenu,onChange:this.onMessagePreviewChanged,checked:this.layout.showPreviews},Object(m.a)("Show previews of messages"))))),e=o.createElement(p.b,{chevronFace:p.a.None,left:this.state.contextMenuPosition.left,top:this.state.contextMenuPosition.top+this.state.contextMenuPosition.height,onFinished:this.onCloseMenu},o.createElement("div",{className:"mx_RoomSublist_contextMenu"},o.createElement("div",null,o.createElement("div",{className:"mx_RoomSublist_contextMenu_title"},Object(m.a)("Sort by")),o.createElement(p.j,{onClose:this.onCloseMenu,onChange:()=>this.onTagSortChanged(f.b.Recent),checked:!t,name:`mx_${this.props.tagId}_sortBy`},Object(m.a)("Activity")),o.createElement(p.j,{onClose:this.onCloseMenu,onChange:()=>this.onTagSortChanged(f.b.Alphabetic),checked:t,name:`mx_${this.props.tagId}_sortBy`},Object(m.a)("A-Z"))),n))}else this.state.addRoomContextMenuPosition&&(e=o.createElement(k.e,{chevronFace:p.a.None,left:this.state.addRoomContextMenuPosition.left-7,top:this.state.addRoomContextMenuPosition.top+this.state.addRoomContextMenuPosition.height,onFinished:this.onCloseAddRoomMenu,compact:!0},this.props.addRoomContextMenu(this.onCloseAddRoomMenu)));return o.createElement(o.Fragment,null,o.createElement(p.d,{className:"mx_RoomSublist_menuButton",onClick:this.onOpenMenuClick,title:Object(m.a)("List options"),isExpanded:!!this.state.contextMenuPosition}),e)}renderHeader(){return o.createElement(d.d,{inputRef:this.headerButton},e=>{let{onFocus:t,isActive:a,ref:n}=e;const s=a?0:-1;let i=Object(m.a)("Jump to first unread room.");this.props.tagId===v.a.Invite&&(i=Object(m.a)("Jump to first invite."));const r=o.createElement(y.a,{forceCount:!0,notification:this.notificationState,onClick:this.onBadgeClick,tabIndex:s,"aria-label":i});let l=null;this.props.onAddRoom?l=o.createElement(E.a,{tabIndex:s,onClick:this.onAddRoom,className:"mx_RoomSublist_auxButton",tooltipClassName:"mx_RoomSublist_addRoomTooltip","aria-label":this.props.addRoomLabel||Object(m.a)("Add room"),title:this.props.addRoomLabel}):this.props.addRoomContextMenu&&(l=o.createElement(p.d,{tabIndex:s,onClick:this.onAddRoomContextMenu,className:"mx_RoomSublist_auxButton",tooltipClassName:"mx_RoomSublist_addRoomTooltip","aria-label":this.props.addRoomLabel||Object(m.a)("Add room"),title:this.props.addRoomLabel,isExpanded:!!this.state.addRoomContextMenuPosition}));const d=c()({mx_RoomSublist_collapseBtn:!0,mx_RoomSublist_collapseBtn_collapsed:!this.state.isExpanded}),h=c()({mx_RoomSublist_headerContainer:!0,mx_RoomSublist_headerContainer_withAux:!!l}),g=o.createElement("div",{className:"mx_RoomSublist_badgeContainer"},r);let f=u.a;return this.props.isMinimized&&(f=E.a),o.createElement("div",{className:h,onKeyDown:this.onHeaderKeyDown,onFocus:t,"aria-label":this.props.label},o.createElement("div",{className:"mx_RoomSublist_stickable"},o.createElement(f,{onFocus:t,inputRef:n,tabIndex:s,className:"mx_RoomSublist_headerText",role:"treeitem","aria-expanded":this.state.isExpanded,"aria-level":1,onClick:this.onHeaderClick,onContextMenu:this.onContextMenu,title:this.props.isMinimized?this.props.label:void 0},o.createElement("span",{className:d}),o.createElement("span",null,this.props.label)),this.renderMenu(),this.props.isMinimized?null:g,this.props.isMinimized?null:l),this.props.isMinimized?g:null,this.props.isMinimized?l:null)})}onScrollPrevent(e){e.target.scrollTop=0}render(){var e;const t=this.renderVisibleTiles(),a=c()({mx_RoomSublist:!0,mx_RoomSublist_hasMenuOpen:!!this.state.contextMenuPosition,mx_RoomSublist_minimized:this.props.isMinimized,mx_RoomSublist_hidden:!(this.state.rooms.length||null!==(e=this.props.extraTiles)&&void 0!==e&&e.length||!0===this.props.alwaysVisible)});let n=null;if(t.length>0){const e=this.layout,a=Math.min(e.minVisibleTiles,this.numTiles),s=4+(a<this.numTiles?28:0),i=e.tilesToPixelsWithPadding(a,s),r=e.tilesToPixelsWithPadding(this.numTiles,this.padding),l=c()({mx_RoomSublist_showNButton:!0});let u=null;if(r>this.state.height){const e=this.state.height-4-28,t=Math.floor(e/this.layout.tileHeight),a=this.numTiles-t,n=Object(m.a)("Show %(count)s more",{count:a});let s=o.createElement("span",{className:"mx_RoomSublist_showNButtonText"},n);this.props.isMinimized&&(s=null),u=o.createElement(d.a,{role:"treeitem",onClick:this.onShowAllClick,className:l,"aria-label":n},o.createElement("span",{className:"mx_RoomSublist_showMoreButtonChevron mx_RoomSublist_showNButtonChevron"}),s)}else if(this.numTiles>this.layout.defaultVisibleTiles){const e=Object(m.a)("Show less");let t=o.createElement("span",{className:"mx_RoomSublist_showNButtonText"},e);this.props.isMinimized&&(t=null),u=o.createElement(d.a,{role:"treeitem",onClick:this.onShowLessClick,className:l,"aria-label":e},o.createElement("span",{className:"mx_RoomSublist_showLessButtonChevron mx_RoomSublist_showNButtonChevron"}),t)}const h={bottom:!0,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1};e.visibleTiles>=this.numTiles&&this.numTiles<=e.minVisibleTiles&&(h.bottom=!1);const p=c()({mx_RoomSublist_resizerHandles:!0,mx_RoomSublist_resizerHandles_showNButton:!!u});n=o.createElement(o.Fragment,null,o.createElement(S.Resizable,{size:{height:this.state.height},minHeight:i,maxHeight:r,onResizeStart:this.onResizeStart,onResizeStop:this.onResizeStop,onResize:this.onResize,handleWrapperClass:p,handleClasses:{bottom:"mx_RoomSublist_resizerHandle"},className:"mx_RoomSublist_resizeBox",enable:h},o.createElement("div",{className:"mx_RoomSublist_tiles",ref:this.tilesRef},t),u))}else this.props.showSkeleton&&this.state.isExpanded&&(n=o.createElement("div",{className:"mx_RoomSublist_skeletonUI"}));return o.createElement("div",{ref:this.sublistRef,className:a,role:"group","aria-label":this.props.label,onKeyDown:this.onKeyDown},this.renderHeader(),n)}})||n}).call(this,a(212).setImmediate)},8440:function(e,t){e.exports="img/plus.c04dc9a.svg"},8441:function(e,t,a){"use strict";(function(e){var t=a(225),n=a(8442),s=a.n(n),i=a(8443),o=a.n(i);let r;t.request((function(e,t){return e.qs=o.a.stringify(e.qs||{},e.qsStringifyOptions),s()(e,t)}));try{r=e.indexedDB}catch(e){}r&&t.setCryptoStoreFactory((function(){return new t.IndexedDBCryptoStore(r,"matrix-js-sdk:crypto")}));e.matrixcs=t}).call(this,a(7))},845:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return B}));var n,s=a(95),i=a.n(s),o=a(19),r=a.n(o),l=a(88),c=a.n(l),d=a(102),m=a.n(d),u=a(194),h=a(108),p=a(100),g=a(131),f=a(1353),v=a(93),b=a(127),y=a(161),E=a(8471),_=a(440),S=a(571),C=a(99),w=a(269),O=a(174),x=a(846),R=a(184),k=a(367),I=a(135),T=a(2745),P=a(847),N=a(1427),D=a(202),j=a(203),A=a(94),M=a(1434),U=a(304);const L=e=>"mx_RoomTile_messagePreview_"+e,F=e=>({left:e.left+window.pageXOffset-9,top:e.bottom+window.pageYOffset+17,chevronFace:b.a.None});let B=Object(A.a)("views.rooms.RoomTile")(n=class extends c.a.PureComponent{constructor(t){super(t),r()(this,"dispatcherRef",void 0),r()(this,"roomTileRef",Object(l.createRef)()),r()(this,"notificationState",void 0),r()(this,"roomProps",void 0),r()(this,"onRoomNameUpdate",e=>{this.forceUpdate()}),r()(this,"onNotificationUpdate",()=>{this.forceUpdate()}),r()(this,"onLocalEchoUpdated",(e,t)=>{!(null!=t&&t.roomId)!==this.props.room.roomId&&this.setState({hasUnsentEvents:this.countUnsentEvents()>0})}),r()(this,"onRoomPropertyUpdate",e=>{e===P.a.NotificationVolume&&this.onNotificationUpdate()}),r()(this,"onAction",t=>{"view_room"===t.action&&t.room_id===this.props.room.roomId&&t.show_room_tile&&e(()=>{this.scrollIntoView()})}),r()(this,"onCommunityUpdate",e=>{e===this.props.room.roomId&&this.forceUpdate()}),r()(this,"onRoomPreviewChanged",e=>{this.props.room&&e.roomId===this.props.room.roomId&&this.generatePreview()}),r()(this,"scrollIntoView",()=>{this.roomTileRef.current&&this.roomTileRef.current.scrollIntoView({block:"nearest",behavior:"auto"})}),r()(this,"onTileClick",e=>{e.preventDefault(),e.stopPropagation(),p.a.dispatch({action:"view_room",show_room_tile:!0,room_id:this.props.room.roomId,clear_search:e&&(e.key===g.a.ENTER||e.key===g.a.SPACE)})}),r()(this,"onActiveRoomUpdate",e=>{this.setState({selected:e})}),r()(this,"onNotificationsMenuOpenClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({notificationsMenuPosition:t.getBoundingClientRect()})}),r()(this,"onCloseNotificationsMenu",()=>{this.setState({notificationsMenuPosition:null})}),r()(this,"onGeneralMenuOpenClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({generalMenuPosition:t.getBoundingClientRect()})}),r()(this,"onContextMenu",e=>{this.showContextMenu&&(e.preventDefault(),e.stopPropagation(),this.setState({generalMenuPosition:{left:e.clientX,bottom:e.clientY}}))}),r()(this,"onCloseGeneralMenu",()=>{this.setState({generalMenuPosition:null})}),r()(this,"onTagRoom",(e,t)=>{if(e.preventDefault(),e.stopPropagation(),t===y.a.Favourite||t===y.a.LowPriority){const e=t===y.a.Favourite?y.a.LowPriority:y.a.Favourite,a=O.b.instance.getTagsForRoom(this.props.room).includes(t),n=a?t:e,s=a?null:t;p.a.dispatch(x.a.tagRoom(C.a.get(),this.props.room,n,s,void 0,0))}else console.warn(`Unexpected tag ${t} applied to ${this.props.room.room_id}`);e.key===g.a.ENTER&&this.setState({generalMenuPosition:null})}),r()(this,"onLeaveRoomClick",e=>{e.preventDefault(),e.stopPropagation(),p.a.dispatch({action:"leave_room",room_id:this.props.room.roomId}),this.setState({generalMenuPosition:null})}),r()(this,"onForgetRoomClick",e=>{e.preventDefault(),e.stopPropagation(),p.a.dispatch({action:"forget_room",room_id:this.props.room.roomId}),this.setState({generalMenuPosition:null})}),r()(this,"onOpenRoomSettings",e=>{e.preventDefault(),e.stopPropagation(),p.a.dispatch({action:"open_room_settings",room_id:this.props.room.roomId}),this.setState({generalMenuPosition:null})}),r()(this,"onInviteClick",e=>{e.preventDefault(),e.stopPropagation(),p.a.dispatch({action:"view_invite",roomId:this.props.room.roomId}),this.setState({generalMenuPosition:null})}),r()(this,"onClickAllNotifs",e=>this.saveNotifState(e,S.a)),r()(this,"onClickAlertMe",e=>this.saveNotifState(e,S.b)),r()(this,"onClickMentions",e=>this.saveNotifState(e,S.c)),r()(this,"onClickMute",e=>this.saveNotifState(e,S.d)),this.state={selected:f.a.activeRoomId===this.props.room.roomId,notificationsMenuPosition:null,generalMenuPosition:null,hasUnsentEvents:this.countUnsentEvents()>0,messagePreview:""},this.generatePreview(),this.notificationState=R.a.instance.getRoomState(this.props.room),this.roomProps=T.a.forRoom(this.props.room)}countUnsentEvents(){return Object(M.b)(this.props.room).length}get showContextMenu(){return this.props.tag!==y.a.Invite}get showMessagePreview(){return!this.props.isMinimized&&this.props.showMessagePreview}componentDidUpdate(e,t){var a,n;const s=e.showMessagePreview!==this.props.showMessagePreview,i=e.isMinimized!==this.props.isMinimized;var o,r,l,c;((s||i)&&this.generatePreview(),(null===(a=e.room)||void 0===a?void 0:a.roomId)!==(null===(n=this.props.room)||void 0===n?void 0:n.roomId))&&(E.a.instance.off(E.a.getPreviewChangedEventName(e.room),this.onRoomPreviewChanged),E.a.instance.on(E.a.getPreviewChangedEventName(this.props.room),this.onRoomPreviewChanged),j.a.instance.off(j.a.getUpdateEventName(null===(o=e.room)||void 0===o?void 0:o.roomId),this.onCommunityUpdate),j.a.instance.on(j.a.getUpdateEventName(null===(r=this.props.room)||void 0===r?void 0:r.roomId),this.onCommunityUpdate),null===(l=e.room)||void 0===l||l.off("Room.name",this.onRoomNameUpdate),null===(c=this.props.room)||void 0===c||c.on("Room.name",this.onRoomNameUpdate))}componentDidMount(){this.state.selected&&this.scrollIntoView(),f.a.addListener(this.props.room.roomId,this.onActiveRoomUpdate),this.dispatcherRef=p.a.register(this.onAction),E.a.instance.on(E.a.getPreviewChangedEventName(this.props.room),this.onRoomPreviewChanged),this.notificationState.on(k.a,this.onNotificationUpdate),this.roomProps.on(N.b,this.onRoomPropertyUpdate),this.roomProps.on("Room.name",this.onRoomNameUpdate),j.a.instance.on(j.a.getUpdateEventName(this.props.room.roomId),this.onCommunityUpdate),C.a.get().on("Room.localEchoUpdated",this.onLocalEchoUpdated)}componentWillUnmount(){var e;this.props.room&&(f.a.removeListener(this.props.room.roomId,this.onActiveRoomUpdate),E.a.instance.off(E.a.getPreviewChangedEventName(this.props.room),this.onRoomPreviewChanged),j.a.instance.off(j.a.getUpdateEventName(this.props.room.roomId),this.onCommunityUpdate),this.props.room.off("Room.name",this.onRoomNameUpdate)),f.a.removeListener(this.props.room.roomId,this.onActiveRoomUpdate),p.a.unregister(this.dispatcherRef),this.notificationState.off(k.a,this.onNotificationUpdate),this.roomProps.off(N.b,this.onRoomPropertyUpdate),this.roomProps.off("Room.name",this.onRoomNameUpdate),j.a.instance.off(j.a.getUpdateEventName(this.props.room.roomId),this.onCommunityUpdate),null===(e=C.a.get())||void 0===e||e.removeListener("Room.localEchoUpdated",this.onLocalEchoUpdated)}async generatePreview(){if(!this.showMessagePreview)return null;const e=await E.a.instance.getPreviewForRoom(this.props.room,this.props.tag);this.setState({messagePreview:e})}async saveNotifState(e,t){if(e.preventDefault(),e.stopPropagation(),C.a.get().isGuest())return;this.roomProps.notificationVolume=t;e.key===g.a.ENTER&&this.setState({notificationsMenuPosition:null})}renderNotificationsMenu(e){if(C.a.get().isGuest()||this.props.tag===y.a.Archived||!this.showContextMenu||this.props.isMinimized)return null;const t=this.roomProps.notificationVolume;let a=null;this.state.notificationsMenuPosition&&(a=c.a.createElement(D.e,i()({},F(this.state.notificationsMenuPosition),{onFinished:this.onCloseNotificationsMenu,className:"mx_RoomTile_contextMenu",compact:!0}),c.a.createElement(D.c,{first:!0},c.a.createElement(D.d,{label:Object(v.a)("Use default"),active:t===S.a,iconClassName:"mx_RoomTile_iconBell",onClick:this.onClickAllNotifs}),c.a.createElement(D.d,{label:Object(v.a)("All messages"),active:t===S.b,iconClassName:"mx_RoomTile_iconBellDot",onClick:this.onClickAlertMe}),c.a.createElement(D.d,{label:Object(v.a)("Mentions & Keywords"),active:t===S.c,iconClassName:"mx_RoomTile_iconBellMentions",onClick:this.onClickMentions}),c.a.createElement(D.d,{label:Object(v.a)("None"),active:t===S.d,iconClassName:"mx_RoomTile_iconBellCrossed",onClick:this.onClickMute}))));const n=m()("mx_RoomTile_notificationsButton",{mx_RoomTile_iconBell:t===S.a,mx_RoomTile_iconBellDot:t===S.b,mx_RoomTile_iconBellMentions:t===S.c,mx_RoomTile_iconBellCrossed:t===S.d,mx_RoomTile_notificationsButton_show:t===S.d});return c.a.createElement(c.a.Fragment,null,c.a.createElement(b.d,{className:n,onClick:this.onNotificationsMenuOpenClick,title:Object(v.a)("Notification options"),isExpanded:!!this.state.notificationsMenuPosition,tabIndex:e?0:-1}),a)}renderGeneralMenu(){if(!this.showContextMenu)return null;let e=null;if(this.state.generalMenuPosition&&this.props.tag===y.a.Archived)e=c.a.createElement(D.e,i()({},F(this.state.generalMenuPosition),{onFinished:this.onCloseGeneralMenu,className:"mx_RoomTile_contextMenu",compact:!0}),c.a.createElement(D.c,{red:!0},c.a.createElement(D.b,{iconClassName:"mx_RoomTile_iconSignOut",label:Object(v.a)("Forget Room"),onClick:this.onForgetRoomClick})));else if(this.state.generalMenuPosition){const t=O.b.instance.getTagsForRoom(this.props.room),a=t.includes(y.a.Favourite),n=a?Object(v.a)("Favourited"):Object(v.a)("Favourite"),s=t.includes(y.a.LowPriority),o=Object(v.a)("Low Priority"),r=C.a.get().getUserId(),l=this.props.room.canInvite(r);e=c.a.createElement(D.e,i()({},F(this.state.generalMenuPosition),{onFinished:this.onCloseGeneralMenu,className:"mx_RoomTile_contextMenu",compact:!0}),c.a.createElement(D.c,null,c.a.createElement(D.a,{onClick:e=>this.onTagRoom(e,y.a.Favourite),active:a,label:n,iconClassName:"mx_RoomTile_iconStar"}),c.a.createElement(D.a,{onClick:e=>this.onTagRoom(e,y.a.LowPriority),active:s,label:o,iconClassName:"mx_RoomTile_iconArrowDown"}),l?c.a.createElement(D.b,{onClick:this.onInviteClick,label:Object(v.a)("Invite People"),iconClassName:"mx_RoomTile_iconInvite"}):null,c.a.createElement(D.b,{onClick:this.onOpenRoomSettings,label:Object(v.a)("Settings"),iconClassName:"mx_RoomTile_iconSettings"})),c.a.createElement(D.c,{red:!0},c.a.createElement(D.b,{onClick:this.onLeaveRoomClick,label:Object(v.a)("Leave Room"),iconClassName:"mx_RoomTile_iconSignOut"})))}return c.a.createElement(c.a.Fragment,null,c.a.createElement(b.d,{className:"mx_RoomTile_menuButton",onClick:this.onGeneralMenuOpenClick,title:Object(v.a)("Room options"),isExpanded:!!this.state.generalMenuPosition}),e)}render(){const e=m()({mx_RoomTile:!0,mx_RoomTile_selected:this.state.selected,mx_RoomTile_hasMenuOpen:!(!this.state.generalMenuPosition&&!this.state.notificationsMenuPosition),mx_RoomTile_minimized:this.props.isMinimized});let t={displayName:null,avatarMxc:null};this.props.tag===y.a.Invite&&(t=j.a.instance.getInviteProfile(this.props.room.roomId));let a=t.displayName||this.props.room.name;"string"!=typeof a&&(a=""),a=a.replace(":",":​");const n=c.a.createElement(_.a,{room:this.props.room,avatarSize:32,displayBadge:this.props.isMinimized,oobData:{avatarUrl:t.avatarMxc}});let s;this.props.isMinimized||(this.state.hasUnsentEvents?s=c.a.createElement("div",{className:"mx_RoomTile_badgeContainer","aria-hidden":"true"},c.a.createElement(w.a,{notification:U.a.RED_EXCLAMATION,forceCount:!1,roomId:this.props.room.roomId})):this.notificationState&&(s=c.a.createElement("div",{className:"mx_RoomTile_badgeContainer","aria-hidden":"true"},c.a.createElement(w.a,{notification:this.notificationState,forceCount:!1,roomId:this.props.room.roomId}))));let o=null;this.showMessagePreview&&this.state.messagePreview&&(o=c.a.createElement("div",{className:"mx_RoomTile_messagePreview",id:L(this.props.room.roomId),title:this.state.messagePreview},this.state.messagePreview));const r=m()({mx_RoomTile_name:!0,mx_RoomTile_nameWithPreview:!!o,mx_RoomTile_nameHasUnreadEvents:this.notificationState.isUnread});let l=c.a.createElement("div",{className:"mx_RoomTile_nameContainer"},c.a.createElement("div",{title:a,className:r,tabIndex:-1,dir:"auto"},a),o);this.props.isMinimized&&(l=null);let d,p=a;this.props.tag===y.a.Invite||(this.notificationState.hasMentions?p+=" "+Object(v.a)("%(count)s unread messages including mentions.",{count:this.notificationState.count}):this.notificationState.hasUnreadCount?p+=" "+Object(v.a)("%(count)s unread messages.",{count:this.notificationState.count}):this.notificationState.isUnread&&(p+=" "+Object(v.a)("Unread messages."))),this.showMessagePreview&&(d=L(this.props.room.roomId));const g={};let f=h.a;return this.props.isMinimized&&(f=I.a,g.title=a,g.forceHide=!!this.state.generalMenuPosition),c.a.createElement(c.a.Fragment,null,c.a.createElement(u.d,{inputRef:this.roomTileRef},t=>{let{onFocus:a,isActive:o,ref:r}=t;return c.a.createElement(f,i()({},g,{onFocus:a,tabIndex:o?0:-1,inputRef:r,className:e,onClick:this.onTileClick,onContextMenu:this.onContextMenu,role:"treeitem","aria-label":p,"aria-selected":this.state.selected,"aria-describedby":d}),n,l,s,this.renderGeneralMenu(),this.renderNotificationsMenu(o))}))}})||n}).call(this,a(212).setImmediate)},8453:function(e,t){},8455:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return l}));var n=a(381),s=a.n(n);function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const r={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontWeight:"bold",isUp:!1,isLeft:!1};class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s()(this,"browser",{ff:void 0!==window.InstallTrigger,opera:!!window.opera||navigator.userAgent.includes("Opera")}),s()(this,"params",void 0),s()(this,"canvas",void 0),s()(this,"baseImage",void 0),s()(this,"context",void 0),s()(this,"icons",void 0),s()(this,"isReady",!1),s()(this,"readyCb",()=>{}),this.params=o(o({},r),e),this.icons=l.getIcons(),this.canvas=document.createElement("canvas"),this.baseImage=document.createElement("img");const t=this.icons[this.icons.length-1];t.hasAttribute("href")?(this.baseImage.setAttribute("crossOrigin","anonymous"),this.baseImage.onload=()=>{this.canvas.height=this.baseImage.height>0?this.baseImage.height:32,this.canvas.width=this.baseImage.width>0?this.baseImage.width:32,this.context=this.canvas.getContext("2d"),this.ready()},this.baseImage.setAttribute("src",t.getAttribute("href"))):(this.canvas.height=this.baseImage.height=32,this.canvas.width=this.baseImage.width=32,this.context=this.canvas.getContext("2d"),this.ready())}reset(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height)}options(e,t){const a={n:"number"==typeof e?Math.abs(e):e,len:(""+e).length,x:.4,y:.4,w:.6,h:.6};return t.isUp&&(a.y<.6?a.y=a.y-.4:a.y=a.y-2*a.y+(1-a.w)),t.isLeft&&(a.x<.6?a.x=a.x-.4:a.x=a.x-2*a.x+(1-a.h)),a.x=this.canvas.width*a.x,a.y=this.canvas.height*a.y,a.w=this.canvas.width*a.w,a.h=this.canvas.height*a.h,a}circle(e,t){const a=o(o({},this.params),t),n=this.options(e,a);let s=!1;2===n.len?(n.x=n.x-.4*n.w,n.w=1.4*n.w,s=!0):n.len>=3&&(n.x=n.x-.65*n.w,n.w=1.65*n.w,s=!0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height),this.context.beginPath();const i=Math.floor(n.h*(n.n>99?.85:1))+"px";if(this.context.font=`${a.fontWeight} ${i} ${a.fontFamily}`,this.context.textAlign="center",s?(this.context.moveTo(n.x+n.w/2,n.y),this.context.lineTo(n.x+n.w-n.h/2,n.y),this.context.quadraticCurveTo(n.x+n.w,n.y,n.x+n.w,n.y+n.h/2),this.context.lineTo(n.x+n.w,n.y+n.h-n.h/2),this.context.quadraticCurveTo(n.x+n.w,n.y+n.h,n.x+n.w-n.h/2,n.y+n.h),this.context.lineTo(n.x+n.h/2,n.y+n.h),this.context.quadraticCurveTo(n.x,n.y+n.h,n.x,n.y+n.h-n.h/2),this.context.lineTo(n.x,n.y+n.h/2),this.context.quadraticCurveTo(n.x,n.y,n.x+n.h/2,n.y)):this.context.arc(n.x+n.w/2,n.y+n.h/2,n.h/2,0,2*Math.PI),this.context.fillStyle=a.bgColor,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.stroke(),this.context.fillStyle=a.textColor,"number"==typeof n.n&&n.n>999){const e=(n.n>9999?9:Math.floor(n.n/1e3))+"k+";this.context.fillText(e,Math.floor(n.x+n.w/2),Math.floor(n.y+n.h-.2*n.h))}else this.context.fillText(""+n.n,Math.floor(n.x+n.w/2),Math.floor(n.y+n.h-.15*n.h));this.context.closePath()}ready(){this.isReady||(this.isReady=!0,this.readyCb())}setIcon(t){e(()=>{this.setIconSrc(t.toDataURL("image/png"))})}setIconSrc(e){if(this.browser.ff||this.browser.opera){const t=this.icons[this.icons.length-1],a=window.document.createElement("link");this.icons=[a],a.setAttribute("rel","icon"),a.setAttribute("type","image/png"),window.document.getElementsByTagName("head")[0].appendChild(a),a.setAttribute("href",e),t.parentNode&&t.parentNode.removeChild(t)}else this.icons.forEach(t=>{t.setAttribute("href",e)})}badge(e,t){this.isReady?("string"==typeof e||e>0?this.circle(e,t):this.reset(),this.setIcon(this.canvas)):this.readyCb=()=>{this.badge(e,t)}}static getLinks(){const e=[],t=window.document.getElementsByTagName("head")[0].getElementsByTagName("link");for(let a=0;a<t.length;a++)/(^|\s)icon(\s|$)/i.test(t[a].getAttribute("rel"))&&e.push(t[a]);return e}static getIcons(){let e=l.getLinks();return 0===e.length&&(e=[window.document.createElement("link")],e[0].setAttribute("rel","icon"),window.document.getElementsByTagName("head")[0].appendChild(e[0])),e.forEach(e=>{e.setAttribute("type","image/png")}),e}}}).call(this,a(212).setImmediate)},846:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(740),s=a(106),i=a(298),o=a(93),r=a(97),l=a(174),c=a(324),d=a(161);class m{static tagRoom(e,t,a,m,u,h){let p=null;const g=l.b.instance;if(m&&g.getTagSorting(m)===c.b.Manual){const e=[...g.orderedLists[m]];e.sort((e,t)=>e.tags[m].order-t.tags[m].order);const t=m===a&&u<h?1:0,n=t+h-1,s=t+h,i=n<=0?0:e[n].tags[m].order,o=s>=e.length?1:e[s].tags[m].order;p={order:(i+o)/2}}return Object(n.a)("RoomListActions.tagRoom",()=>{const n=[],l=t.roomId;if(void 0===a&&m===d.a.DM||a===d.a.DM&&void 0===m)return i.b(t,m===d.a.DM).catch(e=>{const t=r.getComponent("dialogs.ErrorDialog");console.error("Failed to set direct chat tag "+e),s.a.createTrackedDialog("Failed to set direct chat tag","",t,{title:Object(o.a)("Failed to set direct chat tag"),description:e&&e.message?e.message:Object(o.a)("Operation failed")})});const c=a!==m;if(a&&a!==d.a.DM&&c){const t=e.deleteRoomTag(l,a).catch((function(e){const t=r.getComponent("dialogs.ErrorDialog");console.error("Failed to remove tag "+a+" from room: "+e),s.a.createTrackedDialog("Failed to remove tag from room","",t,{title:Object(o.a)("Failed to remove tag %(tagName)s from room",{tagName:a}),description:e&&e.message?e.message:Object(o.a)("Operation failed")})}));n.push(t)}if(m&&m!==d.a.DM&&(c||p)){p=p||{};const t=e.setRoomTag(l,m,p).catch((function(e){const t=r.getComponent("dialogs.ErrorDialog");throw console.error("Failed to add tag "+m+" to room: "+e),s.a.createTrackedDialog("Failed to add tag to room","",t,{title:Object(o.a)("Failed to add tag %(tagName)s to room",{tagName:m}),description:e&&e.message?e.message:Object(o.a)("Operation failed")}),e}));n.push(t)}return Promise.all(n)},()=>({room:t,oldTag:a,newTag:m,metaData:p}))}}},847:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return c}));var n=a(19),s=a.n(n),i=a(1427),o=a(571),r=a(93);let l;!function(e){e[e.NotificationVolume=0]="NotificationVolume"}(l||(l={}));class c extends i.a{constructor(e){super(e,e=>this.properties.get(e)),s()(this,"properties",new Map),s()(this,"onAccountData",e=>{if("m.push_rules"===e.getType()){this.properties.get(l.NotificationVolume)!==Object(o.f)(this.context.room.roomId)&&this.updateNotificationVolume()}})}onClientChanged(e,t){this.properties.clear(),e&&e.removeListener("accountData",this.onAccountData),t&&(t.on("accountData",this.onAccountData),this.updateNotificationVolume())}updateNotificationVolume(){this.properties.set(l.NotificationVolume,Object(o.f)(this.context.room.roomId)),this.markEchoReceived(l.NotificationVolume),this.emit(i.b,l.NotificationVolume)}get notificationVolume(){return this.getValue(l.NotificationVolume)}set notificationVolume(e){this.setValue(Object(r.a)("Change notification settings"),l.NotificationVolume,e,async()=>Object(o.h)(this.context.room.roomId,e),i.c)}}},8470:function(e,t,a){"use strict";a.r(t),a.d(t,"components",(function(){return oF}));var n=a(96),s=a(88),i=a.n(s);function o(e){return i.a.createElement(n.TextField,{InputProps:{readOnly:e.readOnly},variant:"outlined",fullWidth:!0,defaultValue:e.defaultValue,size:"small",label:e.label})}const r=Object(n.makeStyles)(e=>({dialog_wrapper:{padding:"20px"},capitalize:{textTransform:"uppercase",fontSize:"18px",color:"#0E9594",marginTop:"5px",fontWeight:700},mr_12:{marginRight:"12px"}}));var l=e=>{const t=r(),{open:a,onConfirmDialogClose:s,text:o,title:l,agree:c,cancel:d,onYesClick:m,loading:u}=e;return i.a.createElement(n.Dialog,{maxWidth:"xs",fullWidth:!0,open:a,onClose:s},i.a.createElement("div",{className:t.dialog_wrapper},i.a.createElement("p",{className:t.capitalize},l),i.a.createElement("p",null,o),i.a.createElement(n.DialogActions,null,i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{className:t.mr_12+" primary-button",variant:"contained",onClick:m,disabled:u||!1},c,u&&i.a.createElement(n.CircularProgress,{style:{marginLeft:"8px",color:"#fff"},size:17,color:"inherit"})),i.a.createElement(n.Button,{variant:"contained",className:"secondary-button",onClick:s},d)))))};const c=Object(n.makeStyles)(e=>({root:{fontFamily:"initial",textAlign:"center",padding:"0 0 64px"},textItalic:{fontStyle:"italic",marginBottom:"24px"},textHeader:{textAlign:"center",textTransform:"uppercase",margin:"6px 0",fontWeight:"bold",fontSize:"1.7rem"},textJustify:{textAlign:"justify"},col6:{width:"46%",display:"flex",flexDirection:"column",justifyContent:"space-between"},mt36:{marginTop:"36px"}}));function d(e){const{initialValues:t}=e,a=c();return i.a.createElement(i.a.Fragment,null,console.log("Propsss: ",e),i.a.createElement("div",{className:a.root},i.a.createElement("div",{className:a.textHeader},"PHIẾU ĐỒNG THUẬN"),i.a.createElement("div",{className:a.textItalic},"(Sử dụng trước khi kê đơn)"),i.a.createElement("div",{style:{display:"flex",justifyContent:"space-around"}},i.a.createElement("div",{className:a.col6},i.a.createElement("div",null,i.a.createElement("div",{className:a.textHeader},"Bác sĩ đồng ý"),i.a.createElement("div",{className:a.textJustify},"  Bằng việc ký tên dưới đây, tôi khẳng định tôi đã hiểu đầy đủ những lợi ích và rủi ro có thể có khi thăm khám và sử dụng thuốc. Là người kê đơn, tôi đã cung cấp thông tin cho khách hàng về những rủi ro có thể gặp khi sử dụng thuốc và đã tư vấn cho khách hàng, việc tái khám và xét nhiệm định kỳ và ghi chép đầy đủ các tác dụng phụ xảy ra. Đặc biệt tôi cam kết thực hiện các việc sau:"),i.a.createElement("div",{className:a.textJustify},"  - Đảm bảo khách hàng có kết quả xét nghiệm, thăm khám trước khi kê đơn;"),i.a.createElement("div",{className:a.textJustify},"  - Đã đọc và hiểu đầy đủ các thông tin, kể cả những CẢNH BÁO;"),i.a.createElement("div",{className:a.textJustify},"  - Đã thảo luận với khách hàng những rủi ro có thể phát sinh khi sử dụng thuốc đã kê; về tầm quan trọng của việc thực hiện thăm khám và sử dụng đúng theo chỉ định;"),i.a.createElement("div",{className:a.textJustify},"  - Hướng dẫn sử dụng khách hàng trước khi kê đơn.")),i.a.createElement("div",{className:a.mt36},i.a.createElement("hr",null),i.a.createElement("div",null,i.a.createElement("b",null,"NVYT/ Bác sĩ ký")," ",i.a.createElement("i",null,"(ghi rõ họ tên)")))),i.a.createElement("div",{className:a.col6},i.a.createElement("div",null,i.a.createElement("div",{className:a.textHeader},"Khách hàng đồng ý"),i.a.createElement("div",{className:a.textJustify},"  Bằng việc ký tên dưới đây, tôi khẳng định rằng tôi đã trao đổi với Nhân viên y tế/Bác sĩ và hiểu rõ về những lợi ích và rủi ro có thể có của việc thăm khám sử dụng thuốc. Đặc biệt tôi cam kết thực hiện các việc sau khi được nhân viên y tế trao đổi:"),i.a.createElement("div",{className:a.textJustify},"  - Tôi đồng ý sẽ thực hiện đúng theo chỉ dẫn bác sĩ;"),i.a.createElement("div",{className:a.textJustify},"  - Tôi hiểu một số tác dụng phụ đã cảnh báo khi sử dụng thuốc,"),i.a.createElement("div",{className:a.textJustify},"  - Tôi hiểu rằng cần  thăm khám định kỳ và thwucj hiện theo chỉ dẫn bác sĩ;"),i.a.createElement("div",{className:a.textJustify},"  - Tôi sẽ hỏi nhân viên y tế nếu tôi có bất cứ băn khoăn hay câu hỏi nào.")),i.a.createElement("div",{className:a.mt36},i.a.createElement("hr",null),i.a.createElement("div",null,i.a.createElement("b",null,"Khách hàng ký")," ",i.a.createElement("i",null,"(ghi rõ họ tên)")))))))}var m=a(95),u=a.n(m),h=a(351),p=a.n(h);function g(e){const{formik:t,field:a,label:s,options:o,variant:r,multiple:l,required:c,size:d,displayData:m,disabled:h,classes:g}=e;return i.a.createElement(p.a,{classes:g,multiple:l||!1,disabled:h||!1,value:t.values[a]?t.values[a]:e.defaultValue?e.defaultValue:null,id:a,onChange:(e,n)=>{t.setFieldValue(a,n)},options:o,getOptionLabel:e=>e[m||"name"]?e[m||"name"]:"",getOptionSelected:(e,t)=>e.id===t.id,filterSelectedOptions:!0,renderInput:e=>i.a.createElement(n.TextField,u()({},e,{required:c||!1,size:d,variant:r,label:s,error:t.touched[a]&&Boolean(t.errors[a]),helperText:t.touched[a]&&t.errors[a]}))})}var f=a(117),v=a.n(f),b=a(112),y=a.n(b);const E="/api/administrative-unit";var _=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+E+"/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+E+"/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+E;return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+E+"/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+E+"/"+e;return v.a.delete(a)}async getRootUnit(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+E+"/getRootUnit";return v.a.get(t)}async getAllChildByParentId(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+E+"/getAllChildByParentId/"+e;return v.a.get(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+E+"/checkCode";return v.a.post(a,e)}};function S(e){const{formik:t,field:a,label:o,variant:r,required:l,size:c,classes:d,disabled:m,type:h,unit:p,multiline:g,rows:f}=e,[v,b]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{b(t.values[a])}),i.a.createElement(i.a.Fragment,null,i.a.createElement(n.TextField,u()({disabled:m||!1,fullWidth:!0,classes:d,id:a,size:c,name:a,label:o,variant:r,value:v||(e.defaultValue?e.defaultValue:""),onChange:e=>{b(e.target.value),t.setFieldValue(a,e.target.value)},required:l||!1,error:t.touched[a]&&Boolean(t.errors[a]),helperText:t.touched[a]&&t.errors[a],type:h||"text",InputProps:{endAdornment:i.a.createElement(n.InputAdornment,{position:"end"},p||""),readOnly:e.readOnly},multiline:g,rows:f,minRows:e.minRows,className:e.className},e)),t.errors[a]&&t.touched[a]?i.a.createElement("div",{style:{color:"red"}},t.errors[a]):null)}const C=Object(n.makeStyles)(()=>({root:{}}));function w(e){C();const[t,a]=i.a.useState(""),[o,r]=i.a.useState(""),[l,c]=i.a.useState(""),[d,m]=i.a.useState(null),[u,h]=i.a.useState(null),{formik:p,type:f,disabled:v}=e;return Object(s.useEffect)(()=>{null!=e.formik.values[f+"City"]&&null!=e.formik.values[f+"City"].id?(a(e.formik.values[f+"City"]?e.formik.values[f+"City"].code:null),_.getAllChildByParentId(e.formik.values[f+"City"].id).then(e=>{let{data:t}=e;m(t)})):(a(""),e.formik.values[f+"District"]=null,e.formik.values[f+"Commune"]=null)},[e.formik.values[f+"City"]]),Object(s.useEffect)(()=>{null!=e.formik.values[f+"District"]&&null!=e.formik.values[f+"District"].id?(r(e.formik.values[f+"District"]?e.formik.values[f+"District"].code:null),_.getAllChildByParentId(e.formik.values[f+"District"].id).then(e=>{let{data:t}=e;h(t)})):(r(""),e.formik.values[f+"Commune"]=null)},[e.formik.values[f+"District"]]),Object(s.useEffect)(()=>{null!=e.formik.values[f+"Commune"]&&null!=e.formik.values[f+"Commune"].id?c(e.formik.values[f+"Commune"]?e.formik.values[f+"Commune"].code:null):c("")},[e.formik.values[f+"Commune"]]),i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:3,md:3,xs:12,sm:12},i.a.createElement(g,{formik:p,field:f+"City",label:"Tỉnh/thành phố",options:e.listRootUnit?e.listRootUnit:[],variant:"outlined",size:"small",disabled:v})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,xs:12,sm:12},i.a.createElement(g,{formik:p,field:f+"District",label:"Quận/huyện",options:d||[],variant:"outlined",size:"small",disabled:v})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,xs:12,sm:12},i.a.createElement(g,{formik:p,field:f+"Commune",label:"Xã/phường",options:u||[],variant:"outlined",size:"small",disabled:v})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,xs:12,sm:12},i.a.createElement(S,{formik:p,field:f+"DetailResidence",size:"small",label:"Địa chỉ chi tiết",variant:"outlined",disabled:v})))}var O=a(124);const x=Object(O.makeStyles)(e=>({clearSelect:{marginRight:"10px"}}));function R(e){x();const{formik:t,field:a,label:o,disabled:r,action:l}=e,[c,d]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{null!=l&&l(c),t.setFieldValue(a,c)},[c]),Object(s.useEffect)(()=>{null!=l&&l(t.values[a]),d(t.values[a])},[]),i.a.createElement(n.FormControlLabel,{value:c,onChange:e=>{d(e.target.checked)},control:i.a.createElement(n.Checkbox,{checked:c}),label:o,disabled:r})}var k=a(273),I=a(241),T=a.n(I);function P(e){const{formik:t,label:a,format:n,size:o,inputVariant:r,field:l,disabled:c,readOnly:d,disableFuture:m,disablePast:h}=e,[p,g]=Object(s.useState)(t.values[l]);return Object(s.useEffect)(()=>{g(t.values[l])},[]),Object(s.useEffect)(()=>{t.values[l]=p},[p]),i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,u()({disabled:c||!1,fullWidth:!0,id:l,name:l,autoOk:!0,variant:"inline",inputVariant:r,label:a,format:n,size:o,InputAdornmentProps:{position:"end"},onChange:e=>g(e),value:p||null,error:t.touched[l]&&Boolean(t.errors[l]),helperText:t.touched[l]&&t.errors[l],readOnly:d||!1,disableFuture:m||!1,disablePast:h||!1,InputProps:{readOnly:d}},e)))}var N=a(530),D=a.n(N),j=a(1002),A=a.n(j);const M=Object(O.makeStyles)({close:{float:"right",cursor:"pointer"}});var U=e=>{let{visiable:t,note:a,onClose:n}=e;const s=M();return i.a.createElement(D.a,null,i.a.createElement("div",{className:"doctor-note-tooltip "+(t?"":"disapper")},i.a.createElement("div",null,i.a.createElement("div",{className:s.close,onClick:()=>n()},i.a.createElement(A.a,{fontSize:"medium"}))),i.a.createElement("div",null,i.a.createElement("b",null,null==a?void 0:a.title)),i.a.createElement("div",{dangerouslySetInnerHTML:{__html:null==a?void 0:a.html}})))},L=a(198),F=a.n(L);const B=Object(O.makeStyles)(e=>({clearSelect:{marginRight:"10px"}}));function V(e){B();const{formik:t,optionList:a,field:o,variant:r,size:l,label:c,disabled:d}=e,[m,u]=i.a.useState(t.values[o]);return Object(s.useEffect)(()=>{t.values[o]=m},[m]),Object(s.useEffect)(()=>{u(t.values[o])}),i.a.createElement(n.FormControl,{fullWidth:!0,variant:r,size:l},i.a.createElement(n.InputLabel,{id:o},c),i.a.createElement(n.Select,{labelId:o,id:o,value:m,onChange:e=>{u(e.target.value)},label:o},a.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e},e.firstName+" "+e.lastName))))}const G=Object(O.makeStyles)(e=>({clearSelect:{marginRight:"10px"}}));function z(e){G();const{formik:t,optionList:a,field:s,variant:o,size:r,label:l,disabled:c}=e;return i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:o,size:r},i.a.createElement(n.InputLabel,{id:s},l),i.a.createElement(n.Select,{labelId:s,id:s,value:t.values[s],onChange:e=>{t.setFieldValue(s,e.target.value)},label:l,readOnly:e.readOnly},a.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))}function W(e){const{formik:t,label:a,format:n,size:o,inputVariant:r,field:l,disabled:c,container:d,index:m,autoOk:h}=e,p=d?t.values[d]:null,[g,f]=Object(s.useState)(p&&p[m][l]?p[m][l]:null),[v,b]=Object(s.useState)(p);return Object(s.useEffect)(()=>{null!=p&&(p[m][l]=g,b(v),t.setFieldValue(d,v))},[g]),Object(s.useEffect)(()=>{f(p[m][l])}),i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,u()({disabled:c||!1,fullWidth:!0,id:l,name:l,autoOk:h||!0,variant:"inline",inputVariant:r,label:a,format:n,size:o,InputAdornmentProps:{position:"end"},onChange:e=>(e=>{f(e)})(e),value:g,error:t.touched[l]&&Boolean(t.errors[l]),helperText:t.touched[l]&&t.errors[l]},e)))}function H(e){const{formik:t,label:a,format:n,size:o,inputVariant:r,field:l,disabled:c,container:d,index:m,autoOk:h,length:p}=e,g=d?t.values[d]:null,[f,v]=Object(s.useState)(g&&g[m][l]?g[m][l]:null),[b,y]=Object(s.useState)(g);return Object(s.useEffect)(()=>{var e;if(null!=g){for(e=0;e<p;e++)g[e][l]=f;y(b),t.setFieldValue(d,b)}},[f]),Object(s.useEffect)(()=>{v(g[m][l])}),i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,u()({disabled:c||!1,fullWidth:!0,id:l,name:l,autoOk:h||!0,variant:"inline",inputVariant:r,label:a,format:n,size:o,InputAdornmentProps:{position:"end"},onChange:e=>(e=>{v(e)})(e),value:f,error:t.touched[l]&&Boolean(t.errors[l]),helperText:t.touched[l]&&t.errors[l]},e)))}function K(e){const{formik:t,field:a,label:o,variant:r,required:l,size:c,classes:d,disabled:m,type:u,container:h,index:p}=e,g=h?t.values[h]:null,[f,v]=i.a.useState((g?g[p][a]:new Date)?g[p][a]:null),[b,y]=i.a.useState(g);return Object(s.useEffect)(()=>{null!=g&&(g[p][a]=f,y(b),t.setFieldValue(h,b))},[f]),Object(s.useEffect)(()=>{v(g[p][a])}),i.a.createElement(n.TextField,{disabled:m||!1,fullWidth:!0,classes:d,id:a,size:c,name:a,label:o,variant:r,value:f,onChange:e=>(e=>{v(e)})(e.target.value),required:l||!1,error:t.touched[a]&&Boolean(t.errors[a]),helperText:t.touched[a]&&t.errors[a],type:u||"text"})}Object(n.makeStyles)(()=>({root:{}}));function q(e){const{formik:t,listRootUnit:a}=e,[o,r]=i.a.useState(t.values.syncAddress),[l,c]=i.a.useState(!1),[d,m]=i.a.useState("Giống địa chỉ thường trú");return Object(s.useEffect)(()=>{o?(t.values.currentCity=t.values.permanentCity?t.values.permanentCity:null,t.values.currentDistrict=t.values.permanentDistrict?t.values.permanentDistrict:null,t.values.currentCommune=t.values.permanentCommune?t.values.permanentCommune:null,t.values.currentDetailResidence=t.values.permanentDetailResidence?t.values.permanentDetailResidence:null,m("Khác địa chỉ thường trú")):m("Giống địa chỉ thường trú")},[t.values.permanentCity,t.values.permanentDistrict,t.values.permanentCommune,t.values.permanentDetailResidence,o]),i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15"},i.a.createElement("h3",{className:"text-white m-0"},"Địa chỉ thường trú")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(w,{formik:t,listRootUnit:a,type:"permanent"}))),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15"},i.a.createElement("h3",{className:"text-white m-0"},"Địa chỉ hiện tại")),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControlLabel,{value:o,onChange:()=>(r(!o),void(o?(t.values.currentCity=null,t.values.currentDistrict=null,t.values.currentCommune=null,t.values.currentDetailResidence=null,m("Giống địa chỉ thường trú")):(t.values.currentCity=t.values.permanentCity?t.values.permanentCity:null,t.values.currentDistrict=t.values.permanentDistrict?t.values.permanentDistrict:null,t.values.currentCommune=t.values.permanentCommune?t.values.permanentCommune:null,t.values.currentDetailResidence=t.values.permanentDetailResidence?t.values.permanentDetailResidence:null,m("Khác địa chỉ thường trú")))),control:i.a.createElement(n.Checkbox,{checked:o}),label:d})),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(w,{formik:t,listRootUnit:a,type:"current",disabled:o}))))}var Y=a(121);a(463);function $(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(p.a,{id:e.name,options:e.options,getOptionLabel:e=>e.name,onChange:(t,a)=>{e.setFieldValue(e.name,a||null),e.updateParent&&e.updateParent(a)},value:e.value,size:"small",defaultValue:e.defaultValue?e.defaultValue:void 0,disabled:e.disabled,renderInput:t=>i.a.createElement(n.TextField,u()({className:"font-inherit",label:e.label,fullWidth:!0,name:e.name,variant:"outlined"},t)),getOptionSelected:(e,t)=>t.id===e.id}),i.a.createElement(Y.ErrorMessage,{component:"div",name:e.name,className:"color-red"}))}function J(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.FormControlLabel,{defaultValue:e.value,onChange:t=>{var a;e.setFieldValue(e.name,null==t||null===(a=t.target)||void 0===a?void 0:a.checked)},control:i.a.createElement(n.Checkbox,{checked:e.value}),label:e.label,disabled:e.disabled}),i.a.createElement(Y.ErrorMessage,{component:"div",name:e.name,className:"color-red"}))}function Q(e){const[t,a]=Object(s.useState)(e.value?e.value:e.defaultValue?e.defaultValue:null);return i.a.createElement(i.a.Fragment,null,i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,{fullWidth:!0,autoOk:!0,className:"font-inherit",id:e.name,name:e.name,label:e.label,inputVariant:"outlined",InputAdornmentProps:{position:"end"},variant:"inline",placeholder:"dd/MM/yyyy",format:"dd/MM/yyyy",openTo:e.openTo,views:e.views,value:t,defaultValue:e.defaultValue,onChange:t=>{a(t),e.setFieldValue(e.name,t)},disabled:e.disabled})),i.a.createElement(Y.ErrorMessage,{component:"div",name:e.name,className:"color-red"}))}function X(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(Y.Field,{id:e.name,component:n.TextField,className:"font-inherit",type:"text",name:e.name,select:!0,SelectProps:{multiple:!1},size:"small",label:e.label,fullWidth:!0,defaultValue:e.defaultValue?e.options.find(t=>t.value===e.defaultValue).value:"",onChange:t=>e.setFieldValue(e.name,t.target.value),variant:"outlined"},e.options.map((t,a)=>i.a.createElement(n.MenuItem,{disabled:e.disabled,id:`${e.name}-${a}`,value:t.value},t.name))),i.a.createElement(Y.ErrorMessage,{component:"div",name:e.name,className:"color-red"}))}function Z(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(Y.Field,{id:e.name,className:"font-inherit",InputProps:{className:""+(e.disabled?"color-black":"")},component:n.TextField,name:e.name,size:"small",label:e.label,variant:"outlined",type:e.type,fullWidth:!0,defaultValue:e.defaultValue,value:e.value,multiline:e.multiline,minRows:e.minRows,onChange:t=>e.setFieldValue(e.name,t.target.value),disabled:e.disabled}),i.a.createElement(Y.ErrorMessage,{component:"div",name:e.name,className:"color-red"}))}var ee=a(98),te=a.n(ee),ae=a(540),ne=a.n(ae);const se=["inputRef","onChange"];function ie(e){const{inputRef:t,onChange:a}=e,n=te()(e,se);return i.a.createElement(ne.a,u()({},n,{getInputRef:t,onValueChange:t=>{a({target:{name:e.name,value:t.value}})},thousandSeparator:!0,isNumericString:!0,suffix:" VND"}))}function oe(e){return i.a.createElement(n.TextField,{select:!0,label:e.label,name:e.name,value:e.value?e.value:"",onChange:e.onChange,fullWidth:!0,size:"small"},e.options.map((t,a)=>i.a.createElement(n.MenuItem,{key:`${e.name}-${a}`,value:t},"Đợt ",e.options.length-a)))}const re=y.a.API_ENPOINT+"/public/api";var le=new class{async getRootUnit(){const e=re+"/getRootUnit";return v.a.get(e)}async getAllChildByParentId(e){const t=`${re}/getAllChildByParentId/${e}`;return v.a.get(t)}};function ce(e){const[t,a]=Object(s.useState)([]),[o,r]=Object(s.useState)([]),[l,c]=Object(s.useState)([]),[d,m]=Object(s.useState)(null),[u,h]=Object(s.useState)(null),[p,g]=Object(s.useState)(null);Object(s.useEffect)(()=>{b()},[]),Object(s.useEffect)(()=>{v()},[e.defaultWard,e.defaultDistrict,e.defaultProvince]),Object(s.useEffect)(()=>{f()},[e.province,e.district,e.ward]);const f=async()=>{e.ward&&(m(e.province),await le.getAllChildByParentId(e.province.id).then(t=>{let{data:a}=t;r(a),h(e.district)}),await le.getAllChildByParentId(e.district.id).then(t=>{let{data:a}=t;c(a),g(e.ward)}))},v=async()=>{e.defaultWard&&(m(e.defaultProvince),await le.getAllChildByParentId(e.defaultProvince.id).then(t=>{let{data:a}=t;r(a),h(e.defaultDistrict)}),await le.getAllChildByParentId(e.defaultDistrict.id).then(t=>{let{data:a}=t;c(a),g(e.defaultWard)}))},b=async()=>{await le.getRootUnit().then(e=>{let{data:t}=e;a(t)})};return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement($,{name:""+(e.prefix?e.prefix+"Province":"currentProvince"),label:"Tỉnh/Thành phố",defaultValue:e.defaultProvince,value:d,setFieldValue:e.setFieldValue,options:t,updateParent:async e=>{m(e),h(null),g(null),e?await le.getAllChildByParentId(e.id).then(e=>{let{data:t}=e;r(t)}):r([])},disabled:e.disabled})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement($,{name:""+(e.prefix?e.prefix+"District":"currentDistrict"),label:"Quận/Huyện",setFieldValue:e.setFieldValue,options:o,value:u,updateParent:async e=>{h(e),g(null),e?await le.getAllChildByParentId(e.id).then(e=>{let{data:t}=e;c(t)}):c([])},disabled:e.disabled})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement($,{name:""+(e.prefix?e.prefix+"Ward":"currentWard"),label:"Phường/Xã",setFieldValue:e.setFieldValue,options:l,value:p,updateParent:e=>{g(e)},disabled:e.disabled})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(Z,{name:""+(e.prefix?e.prefix+"DetailResidence":"currentDetailResidence"),label:"Địa chỉ chi tiết",defaultValue:e.defaultDetailResidence,value:e.detailResidence,setFieldValue:e.setFieldValue,disabled:e.disabled})))}function de(e){var t,a,o,r,l,c;const{defaultValue:d,values:m,readOnly:u}=e,[h,p]=Object(s.useState)("Giống địa chỉ thường trú"),[g,f]=Object(s.useState)(!1);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15 mt-16"},i.a.createElement("h3",{className:"text-white m-0"},"Địa chỉ thường trú")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(ce,{defaultProvince:null===(t=d.permanentResidence)||void 0===t||null===(a=t.parent)||void 0===a?void 0:a.parent,defaultDistrict:null===(o=d.permanentResidence)||void 0===o?void 0:o.parent,defaultWard:d.permanentResidence,defaultDetailResidence:d.permanentDetailResidence,setFieldValue:e.setFieldValue,prefix:"permanent",disabled:u})),i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15 mt-16"},i.a.createElement("h3",{className:"text-white m-0"},"Địa chỉ hiện tại")),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControlLabel,{onChange:(t,a)=>{a?(p("Khác địa chỉ thường trú"),e.setFieldValue("currentProvince",m.permanentProvince),e.setFieldValue("currentDistrict",m.permanentDistrict),e.setFieldValue("currentWard",m.permanentWard),e.setFieldValue("currentDetailResidence",m.permanentDetailResidence)):p("Giống địa chỉ thường trú"),f(a)},checked:g,control:i.a.createElement(n.Checkbox,null),label:h,disabled:u})),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(ce,{province:m.currentProvince?m.currentProvince:null===(r=d.currentResidence)||void 0===r||null===(l=r.parent)||void 0===l?void 0:l.parent,district:m.currentDistrict?m.currentDistrict:null===(c=d.currentResidence)||void 0===c?void 0:c.parent,ward:m.currentWard?m.currentWard:d.currentResidence,detailResidence:m.currentDetailResidence?m.currentDetailResidence:d.currentDetailResidence?d.currentDetailResidence:"",setFieldValue:e.setFieldValue,prefix:"current",disabled:g||u})))}const me=Object(n.makeStyles)(e=>({dialog_wrapper:{padding:"20px"},capitalize:{textTransform:"uppercase",fontSize:"1.8rem",color:"#3366ff",marginBottom:"0.75rem"},mr_12:{marginRight:"12px"},content:{whiteSpace:"pre-line"}}));var ue=e=>{let{open:t,onClose:a,text:s,title:o,cancel:r}=e;const l=me();return i.a.createElement(n.Dialog,{maxWidth:"xs",fullWidth:!0,open:t,onClose:a},i.a.createElement("div",{className:l.dialog_wrapper},i.a.createElement("h4",{className:l.capitalize},o),i.a.createElement("p",{className:l.content},i.a.createElement("div",{dangerouslySetInnerHTML:{__html:s}})),i.a.createElement(n.DialogActions,null,i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{variant:"contained",className:l.mr_12+" btn btn-primary",color:"primary",onClick:a},r)))))};const he=e=>(console.log(e),i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"dropdown-container "+(e.openFilter?"":"disappear")},i.a.createElement(n.Grid,{container:!0,spacing:2,className:"dropdown-children  "+(e.openFilter?"":"disappear")},e.children))));var pe=i.a.memo(he),ge=a(287),fe=a.n(ge),ve=a(350),be=a.n(ve),ye=a(910);const Ee=Object(O.makeStyles)(e=>({root:{display:"flex",alignItems:"center"},wrapper:{margin:e.spacing(1),position:"relative"},buttonSuccess:{backgroundColor:ye.blue[500],"&:hover":{backgroundColor:ye.blue[700]}},fabProgress:{color:ye.blue[500],position:"absolute",top:-6,left:-6,zIndex:1},buttonProgress:{color:ye.blue[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}}));function _e(e){const{loading:t}=e;Ee(),i.a.useRef();return i.a.createElement(fe.a,u()({startIcon:e.icon&&t?i.a.createElement(be.a,{size:e.size?e.size:22}):e.icon?e.icon:"",variant:"contained",color:"primary",disabled:t},e),e.children)}var Se=a(354),Ce=(a(1985),a(111)),we=(a(109),a(105)),Oe=a.n(we);function xe(e){let{handleChangePage:t,totalPages:a,setRowsPerPage:s,pageSizeOption:o,totalElements:r,page:l}=e;const[c,d]=i.a.useState(e.pageSize),[m,u]=i.a.useState(l);return r>=0&&i.a.createElement("div",{className:"nice-pagination-bar"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{className:"row-per-page-selector ml-auto",item:!0},i.a.createElement("p",null,"Rows per page:"),i.a.createElement(n.TextField,{select:!0,value:c,className:"text-field",onChange:e=>{s(e),d(e.target.value)}},o.map((e,t)=>i.a.createElement(n.MenuItem,{value:e},e)))),i.a.createElement(n.Grid,{className:"page-selector ml-auto",item:!0},i.a.createElement(Se.Pagination,{count:a,shape:"rounded",page:l,color:"primary",onChange:t,boundaryCount:1,siblingCount:0,showFirstButton:!0,showLastButton:!0})),a>7&&i.a.createElement(n.Grid,{className:"page-goto ml-auto",item:!0},i.a.createElement("p",null,"Đến trang"),i.a.createElement(n.TextField,{className:"text-field",type:"number",name:"pageIndex",value:m,onChange:e=>u(e.target.value),onKeyDown:e=>{var n;"Enter"===e.key&&(n=e,m<1||m>a?Ce.toast.error("Hãy nhập số từ 1 dến "+a,Oe.a.TOAST_CONFIGURE):t(n,Number(m)))}}))))}const Re=y.a.API_ENPOINT+"/api/treatmentperiod";var ke=new class{async stopTreatmentPeriod(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=`${Re}/treatmentStopped/${e}`;return v.a.get(a)}async getByPatientId(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=`${Re}/get-by?patient-id=${e}`;return v.a.get(a)}async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/searchByPage";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/update/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/create";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/getOne/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/delete/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/checkDuplicateCode";return v.a.post(a,e)}async updateTreatmentPeriodStatus(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/updateStatus/"+e.status+"/"+e.id+"/"+e.encounterId;return v.a.get(a)}async updateConfirmationDate(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-period-prep-screening/updateConfirmationDate/"+e;return v.a.get(a)}},Ie=a(101),Te=a.n(Ie);var Pe=function(e){var t,a,n,o,r,l,c,d,m,u,h,p,g,f,v,b,y,E,_,S,C,w,O,x,R,k,I,T,P,N,D,j,A,M,U,L,F,B;const[V,G]=Object(s.useState)(null);return Object(s.useEffect)(()=>{(async()=>{let t=await ke.getByPatientId(e.patientId);t.data&&G(t.data[0].patient)})()},[]),i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("table",null,i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement("div",null,i.a.createElement("p",null,i.a.createElement("a",null,"Sở Y tế:")),i.a.createElement("p",null,"Bệnh viện: ",i.a.createElement("i",null,"Ghi tên cơ sở y tế/PK")))),i.a.createElement("td",{style:{width:"320px",textAlign:"center"}},i.a.createElement("div",null,i.a.createElement("h2",null,"BỆNH ÁN NGOẠI TRÚ"),i.a.createElement("p",null,"KHOA: ",i.a.createElement("i",null,"Ghi tên khoa/phòng/đơn vị điều trị")))),i.a.createElement("td",null,i.a.createElement("div",null,i.a.createElement("p",null,"Số ngoại trú:"),i.a.createElement("p",null,"Số lưu trữ: …………………..."))))),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("div",{style:{width:"100%"}},i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",null,i.a.createElement("b",null,"I. "),i.a.createElement("b",null,"HÀNH CHÍNH: "))),i.a.createElement("td",null,i.a.createElement("p",{style:{direction:"rtl"}},"Tuổi: "+(e=>{if(null!=e){return Te()().diff(Te()(e),"years")}return 0})(null==V?void 0:V.birthDate))))),i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",width:"100%",margin:"0px"}},` 1. Họ và tên: ${null==V?void 0:V.displayName} `)),i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",margin:"0px",width:"100%"}}," 2. Sinh ngày: "+Te()(null==V?void 0:V.birthDate).format("DD/MM/YYYY")))),i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",{style:{width:"100%"}},`3. Giới: ${"M"===(null==V?void 0:V.gender)?"Nam":""} ${"F"===(null==V?void 0:V.gender)?"Nữ":""} ${null==V||V.gender,""}`)),i.a.createElement("td",null,i.a.createElement("p",{style:{width:"100%"}},"4. Nghề nghiệp:"))),i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",margin:" 0px",width:"100%"}},`5. Dân tộc: ${null==V||null===(t=V.ethnicity)||void 0===t?void 0:t.name} (mã: ${null==V||null===(a=V.ethnicity)||void 0===a?void 0:a.code}) `)),i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",margin:" 0px",width:"100%"}},"6. Ngoại kiều:"))),i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",width:"100%",margin:"0px"}},"7. Địa chỉ: "+(null!=V&&V.currentDetailResidence?null==V?void 0:V.currentDetailResidence:""))),i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",width:"100%",margin:"0px"}},"Xã, phường: "+(null==V||null===(n=V.currentResidence)||void 0===n?void 0:n.name)))),i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",width:"100%",margin:"0px"}},"Huyện (Q, TX): "+(null!=V&&V.currentResidence.parent.name?null==V||null===(o=V.currentResidence)||void 0===o?void 0:o.parent.name:""))),i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",width:"100%",margin:"0px"}},"Tỉnh, thành phố: "+(null!=V&&V.currentResidence.parent.parent.name?null==V||null===(r=V.currentResidence)||void 0===r?void 0:r.parent.parent.name:"")))),i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",width:"100%",margin:"0px"}},"8. Nơi làm việc:")),i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block",width:"100%",margin:"0px"}},`9. Đối tượng: ${1===(null==V?void 0:V.serviceType)?"Thu phí":""} ${2===(null==V?void 0:V.serviceType)?"Miễn phí":""} `))),i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",null," 10. BHYT giá trị đến ngày .......tháng......\n                        năm.....")),i.a.createElement("td",null,i.a.createElement("p",null,"Số thẻ BHYT: "+(null!=V&&V.healthInsuranceNumber?null==V?void 0:V.healthInsuranceNumber:"")))),i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",{style:{width:"100%",margin:"0px"}},`11. Họ tên, địa chỉ người nhà khi cần báo tin: ${null!=V&&V.supporterName?null==V?void 0:V.supporterName:""} ${null!=V&&V.supporterAddress?", "+(null==V?void 0:V.supporterAddress):""}  Điện thoại số: ${null!=V&&V.supporterPhoneNumber?null==V?void 0:V.supporterPhoneNumber:""}`)))),i.a.createElement("p",null,"12. Đến khám bệnh lúc: ......... giờ ....... phút ngày ........ tháng ........ năm .........."),i.a.createElement("p",null,"13. Chẩn đoán của nơi giới thiệu: .................................................................... 1. Y tế 2. Tự đến"),i.a.createElement("p",null,i.a.createElement("b",null,i.a.createElement("i",null,"II. ")),i.a.createElement("b",null,"LÝ DO VÀO VIỆN"),i.a.createElement("b",null,": ",i.a.createElement("i",null,"Điều trị ")),i.a.createElement("b",null,i.a.createElement("i",null))),i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement("p",null,i.a.createElement("b",null,"III. "),i.a.createElement("b",null,"HỎI BỆNH:"),i.a.createElement("b",null)),i.a.createElement("p",null,i.a.createElement("i",null,"1. "),i.a.createElement("b",null,"Quá trình bệnh lý:"),i.a.createElement("b",null," "),i.a.createElement("i",null)),(null===(l=e.state)||void 0===l?void 0:l.pathologicalProcess)&&i.a.createElement("div",{dangerouslySetInnerHTML:{__html:"<div>"+(null===(c=e.state)||void 0===c||null===(d=c.pathologicalProcess)||void 0===d?void 0:d.replace(/\n/g,"<br />"))+"</div>"}}),i.a.createElement("p",null,i.a.createElement("b",null,"2. "),i.a.createElement("b",null,"Tiền sử bệnh:"),i.a.createElement("b",null)),(null===(m=e.state)||void 0===m?void 0:m.anamnesis)&&i.a.createElement("div",{dangerouslySetInnerHTML:{__html:"<div>"+(null===(u=e.state)||void 0===u||null===(h=u.anamnesis)||void 0===h?void 0:h.replace(/\n/g,"<br />"))+"</div>"}}),i.a.createElement("p",null,i.a.createElement("b",null,"IV. "),i.a.createElement("b",null,"KHÁM BỆNH:"),i.a.createElement("b",null)),i.a.createElement("p",null,i.a.createElement("b",null,"1. Toàn thân: "),i.a.createElement("b",null)),(null===(p=e.state)||void 0===p?void 0:p.fullBodyTestResults)&&i.a.createElement("div",{dangerouslySetInnerHTML:{__html:"<div>"+(null===(g=e.state)||void 0===g||null===(f=g.fullBodyTestResults)||void 0===f?void 0:f.replace(/\n/g,"<br />"))+"</div>"}}),i.a.createElement("p",null,i.a.createElement("b",null,"2. "),i.a.createElement("b",null,"Các bộ phận"),i.a.createElement("b",null,":"),i.a.createElement("b",null)),(null===(v=e.state)||void 0===v?void 0:v.parts)&&i.a.createElement("div",{dangerouslySetInnerHTML:{__html:"<div>"+(null===(b=e.state)||void 0===b||null===(y=b.parts)||void 0===y?void 0:y.replace(/\n/g,"<br />"))+"</div>"}})),i.a.createElement("td",{style:{width:"29%"}},i.a.createElement("div",{style:{right:"0px",border:"1px solid black",margin:"0px"}},i.a.createElement("table",{style:{border:"1px solid black"}},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",{width:"188",height:"124"},i.a.createElement("table",null,i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement("div",null,i.a.createElement("p",{style:{marginTop:"1px",marginBottom:"1px"}},i.a.createElement("i",null,`Mạch ${null!==(E=e.state)&&void 0!==E&&E.pulse?null===(_=e.state)||void 0===_?void 0:_.pulse:""}\n                                                                        lần/ph`),i.a.createElement("i",null)),i.a.createElement("p",{style:{marginTop:"1px",marginBottom:"1px"}},i.a.createElement("i",null,`Nhiệt\n                                                                        độ ${e.state.temperature?e.state.temperature:""} `,"                                                      ",i.a.createElement("sup",null,"0"),"C"),i.a.createElement("i",null)),i.a.createElement("p",{style:{marginTop:"1px",marginBottom:"1px"}},i.a.createElement("i",null,`Huyết áp TT\n                                                                         ${null!==(S=e.state)&&void 0!==S&&S.minimumBloodPressure?null===(C=e.state)||void 0===C?void 0:C.minimumBloodPressure:""}/ mmHg`),i.a.createElement("i",null)),i.a.createElement("p",{style:{marginTop:"1px",marginBottom:"1px"}},i.a.createElement("i",null,`Huyết áp TĐ\n                                                                         ${null!==(w=e.state)&&void 0!==w&&w.maximumBloodPressure?null===(O=e.state)||void 0===O?void 0:O.maximumBloodPressure:""}/ mmHg`),i.a.createElement("i",null)),i.a.createElement("p",{style:{marginTop:"1px",marginBottom:"1px"}},i.a.createElement("i",null,`Nhịp\n                                                                        thở ${null!==(x=e.state)&&void 0!==x&&x.breathing?null===(R=e.state)||void 0===R?void 0:R.breathing:""}\n                                                                        lần/ph `),i.a.createElement("i",null)),i.a.createElement("p",{style:{marginTop:"1px",marginBottom:"1px"}},i.a.createElement("i",null,` Cân\n                                                                        nặng ${null!==(k=e.state)&&void 0!==k&&k.weight?null===(I=e.state)||void 0===I?void 0:I.weight:""}\n                                                                        kg `),i.a.createElement("i",null))))))))))))))),i.a.createElement("p",null,i.a.createElement("b",null,i.a.createElement("i",null,"3. ")),i.a.createElement("b",null,"Tóm tắt kết quả cận lâm sàng:"),i.a.createElement("b",null," "),i.a.createElement("i",null,"(mục này có thể link từ phần Kết quả Xét nghiệm sang và kèm cảnh báo nguy hiểm các trường hợp chống chỉ định)")),null===(T=e.state)||void 0===T||null===(P=T.labTestOrder[0])||void 0===P?void 0:P.items.map((e,t)=>{var a,n,s,o;return i.a.createElement(i.a.Fragment,null,0!==t?i.a.createElement("p",null,i.a.createElement("i",null,`- Kết quả ${null==e?void 0:e.labTestName.toLowerCase()}: ${1==(null==e||null===(a=e.labTest)||void 0===a?void 0:a.resultType)?null!=e&&e.numericResult?null==e?void 0:e.numericResult:"":null!=e&&e.stringResult?null==e?void 0:e.stringResult:""}`),"  "):i.a.createElement("p",null,i.a.createElement("b",null,"-",i.a.createElement("i",null,` Kết quả XN nhanh: ${1==(null==e||null===(n=e.labTest)||void 0===n?void 0:n.resultType)?null!=e&&e.numericResult?null==e?void 0:e.numericResult:"":null!=e&&e.stringResult?null==e?void 0:e.stringResult:""}/ ngày XN: ${null!=e&&e.performedDate?Te()(null==e?void 0:e.performedDate).format("DD/MM/YYYY"):""}/ sử dụng sinh phẩm XN: ${null!=e&&null!==(s=e.biologicalTest)&&void 0!==s&&s.name?null==e||null===(o=e.biologicalTest)||void 0===o?void 0:o.name:""}\n                                `))))}),i.a.createElement("p",null,i.a.createElement("b",null,i.a.createElement("i",null,"4. ")),i.a.createElement("b",null,"Chẩn đoán ban đầu: "),".......... ",i.a.createElement("i",null)),i.a.createElement("p",null,"• ",i.a.createElement("i",null,"KH điều trị"),i.a.createElement("i",null," (điều trị từ xa HOẶC điều trị tại cơ sở y tế nào)? "),"                ",i.a.createElement("i",null)),i.a.createElement("p",null,"•",i.a.createElement("i",null,"KH có chẩn đoán các bệnh khác kèm theo: "+(null!==(N=e.state)&&void 0!==N&&N.otherDiseases?null===(D=e.state)||void 0===D?void 0:D.otherDiseases:""))),i.a.createElement("p",null,i.a.createElement("b",null,"5. "),i.a.createElement("b",null,"Đã xử "),i.a.createElement("b",null,"trí"),i.a.createElement("b",null," "),i.a.createElement("i",null,"(thuốc, chăm sóc"),"): ........."),i.a.createElement("p",null,"•",i.a.createElement("i",null,"KH & bác si cùng ký phiếu đồng thuận (đính kèm phiếu đồng thuận đã ký trong Hồ sơ bệnh án)"),i.a.createElement("i",null)),i.a.createElement("p",null,"• ",i.a.createElement("i",null,"Ghi rõ "),i.a.createElement("i",null,"phác đồ được chỉ định (uống hàng ngày hoặc uống theo tình huống),"),i.a.createElement("i",null,"loại thuốc "),i.a.createElement("i",null,"được kê và số lượng thuốc cấp phát (lọ)"),i.a.createElement("i",null)),i.a.createElement("p",null,"•",i.a.createElement("i",null,"Các nội dung chính đã tư vấn cho KH (Hiệu quả bảo vệ, tuân thủ điều trị và lịch tái khám, xử trí các tác dụng phụ hoặc quên thuốc khi dùng thuốc, chuyển đổi cách dùng PrthuốcEP(hàng ngày"),i.a.createElement("i",null,"ó"),i.a.createElement("i",null,"tình huống nếu phù hợp, xử trí các vấn đề phát sinh khi dùng thuốc (VD: Có kết quả XN bất thường, có các vấn đề sức khỏe khác…), tương tác thuốc?"),i.a.createElement("i",null,"Lịch tái khám? Thông tin liên lạc trợ giúp KH trong quá trình dùng thuốc"),i.a.createElement("i",null)),i.a.createElement("p",null,"•",i.a.createElement("i",null,"Các xử trí khác (nếu có): Chuyển gửi KH khám trực tiếp tại PK/ khám chuyên khoa khác"),i.a.createElement("i",null,"…")),i.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tr",{style:{width:"100%"}},i.a.createElement("td",null,i.a.createElement("p",{style:{display:"inline-block"}}," ",i.a.createElement("b",null,"6. Chẩn đoán khi ra viện:"))),i.a.createElement("td",null,i.a.createElement("p",{style:{direction:"rtl"}},"Mã"))))),i.a.createElement("br",null),null!==(j=e.state)&&void 0!==j&&j.summaryExamination?i.a.createElement("div",{dangerouslySetInnerHTML:{__html:"<div>"+(null===(A=e.state)||void 0===A||null===(M=A.summaryExamination)||void 0===M?void 0:M.replace(/\n/g,"<br />"))+"</div>"}}):i.a.createElement("div",null),i.a.createElement("span",null,i.a.createElement("span",{style:{display:"inline-block"}}," ",i.a.createElement("b",null,"7. Điều trị ngoại trú từ ngày ")," "),i.a.createElement("span",{style:{display:"inline-block"}},""+(null!==(U=e.state)&&void 0!==U&&U.startDate?Te()(null===(L=e.state)||void 0===L?void 0:L.startDate).format("DD/MM/YYYY"):" ")," "),i.a.createElement("b",{style:{display:"inline-block"}},"  đến ngày  "),i.a.createElement("span",{style:{display:"inline-block"}},(null!==(F=e.state)&&void 0!==F&&F.endDate?Te()(null===(B=e.state)||void 0===B?void 0:B.endDate).format("DD/MM/YYYY"):" ")+" ")),i.a.createElement("div",{style:{width:"100%"}},i.a.createElement("p",{style:{direction:"rtl"}},i.a.createElement("i",null,"Ngày ....... tháng ........ năm ........."))),i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tr",null,i.a.createElement("td",{style:{width:"50%"}},i.a.createElement("div",{style:{width:"100%",textAlign:"center"}},i.a.createElement("b",null,"Giám đốc bệnh viện/"),i.a.createElement("b",null,"Phụ trách chuyên môn của CSYT"),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("p",null,"Họ và tên........................................."))),i.a.createElement("td",{style:{width:"50%"}},i.a.createElement("div",{style:{width:"100%",textAlign:"center"}},i.a.createElement("b",null,"Bác sỹ khám bệnh"),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("p",null,"Họ và tên........................................."))))))))},Ne=a(118),De=a.n(Ne),je=a(132),Ae=a.n(je);function Me(e){return i.a.createElement(n.Paper,e)}var Ue=function(e){return i.a.createElement(n.Dialog,{open:e.open,fullWidth:!0,PaperComponent:Me,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},e.title),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>e.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},e.children)),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"mr-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit",onClick:()=>e.handleSubmit(e.children)},"Lưu")))))},Le=a(19),Fe=a.n(Le),Be=a(1215),Ve=a.n(Be),Ge=a(292),ze=a.n(Ge),We=a(400),He=a.n(We),Ke=a(113),qe=a.n(Ke),Ye=a(125);a(1214);var $e=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-temp/searchByPage";return v.a.post(a,e)}getFirsttesttemplate(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/lab-test-temp/firsttesttemplate";return v.a.get(t)}getByTempCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/getByTempCode/"+e;return v.a.get(a)}async getLabTestOderItem(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestOrderItem/searchByDto";return v.a.post(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/"+e.id;return v.a.put(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/file/labTestOrderDocument/deleteattachment/"+e;return v.a.delete(a)}getLabTestOrderByRecentDays(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/lab-test-order/getLabTestOrderByRecentDays";return v.a.get(t)}async updateTreatmentPeriodStatus(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/updateStatus/"+e.status+"/"+e.id+"/"+e.encounterId;return v.a.get(a)}};Object(O.withStyles)(e=>({tooltip:{backgroundColor:e.palette.common.white,color:"rgba(0, 0, 0, 0.87)",boxShadow:e.shadows[1],fontSize:11,position:"absolute",top:"-15px",left:"-30px",width:"80px"}}))(n.Tooltip);var Je=function(e){return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{className:"labtest-result-table",item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:e.data?e.data:[],columns:[{title:"Ngày lấy mẫu",field:"specimenDate",render:e=>!e.refuse&&e.specimenDate?Te()(e.specimenDate).format("DD/MM/YYYY"):null,cellStyle:{padding:"2px"}},{title:"Ngày có kết quả",field:"performedDate",render:e=>!e.refuse&&e.performedDate?Te()(e.performedDate).format("DD/MM/YYYY"):null,cellStyle:{padding:"2px"}},{title:"Tên xét nghiệm",field:"labTestName",cellStyle:{padding:"2px"}},{title:"Kết quả",field:"numericResult",render:e=>e.refuse?"Từ chối xét nghiệm":e.numericResult?e.numericResult:e.stringResult,cellStyle:{padding:"2px"}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",padding:"6px"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})))},Qe=a(450),Xe=a.n(Qe),Ze=a(451),et=a.n(Ze),tt=a(197),at=a.n(tt),nt=a(210),st=a.n(nt),it=a(523),ot=a.n(it);const rt=i.a.forwardRef((function(e,t){return i.a.createElement(ot.a,u()({direction:"down",ref:t},e))}));function lt(e){const{open:t,handleClose:a,description:s,title:o,label:r,multiline:l,minRows:c,variant:d}=e;return i.a.createElement(Xe.a,{open:t,TransitionComponent:rt,keepMounted:!0,onClose:a,"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description",fullWidth:!0,maxWidth:"sm"},i.a.createElement(st.a,{id:"alert-dialog-slide-title",className:"dialog-header bgc-primary-d1"},i.a.createElement("span",{className:"mb-20 text-white"},o||"Mô tả file đính kèm"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(at.a,null,i.a.createElement(n.TextField,{style:{marginTop:"12px"},autoFocus:!0,id:"content",label:r||"",disabled:!0,fullWidth:!0,defaultValue:s,multiline:l||!1,minRows:c||1,variant:d||"standard"})),i.a.createElement(et.a,null,i.a.createElement(n.Button,{variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",onClick:()=>a()},"Đóng")))}var ct=a(409),dt=a.n(ct),mt=function(e){var t,a,n,s,o,r,l;const{item:c}=e;console.log(c);new Date;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{id:"content-print"},i.a.createElement("div",{style:{width:"100vw"}},i.a.createElement("div",{style:{width:"90%",margin:"0 auto"}},i.a.createElement("table",{style:{width:"100%",borderCollapse:"collapse"}},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",{colSpan:5},"Ngày chỉ định xét nghiệm: ",c.requestDate?Te()(c.requestDate).format("DD/MM/YYYY"):"")),i.a.createElement("tr",null,i.a.createElement("td",{colSpan:5},"Đơn vị xét nghiệm: ",null!==(t=c.receivingUnit)&&void 0!==t&&t.name?null===(a=c.receivingUnit)||void 0===a?void 0:a.name:"...................")),i.a.createElement("tr",null,i.a.createElement("td",{colSpan:5},i.a.createElement("span",null,"Khách hàng: ",null==c||null===(n=c.patient)||void 0===n?void 0:n.displayName),i.a.createElement("span",null,"  Giới tính:  ",null!==(s=c.patient)&&void 0!==s&&s.gender?Oe.a.GENDER.find(e=>e.value==c.patient.gender).name:"......"),i.a.createElement("span",null," Ngày sinh: ",null!==(o=c.patient)&&void 0!==o&&o.birthDate?Te()(new Date).diff(c.patient.birthDate,"y"):"......."))),i.a.createElement("tr",null,i.a.createElement("td",{colSpan:5},"Dịch vụ sử dụng: ",null!=c&&null!==(r=c.patient)&&void 0!==r&&r.serviceType?Oe.a.SERVICE_TYPE.find(e=>{var t;return e.value==(null==c||null===(t=c.patient)||void 0===t?void 0:t.serviceType)}).name:"............")),i.a.createElement("tr",null,i.a.createElement("td",{colSpan:5},"Kết quả sàng lọc: ",null!=c&&null!==(l=c.periodPrepScreening)&&void 0!==l&&l.statusResult?Oe.a.ANSWER_SCORE.find(e=>{var t;return e.value==(null==c||null===(t=c.periodPrepScreening)||void 0===t?void 0:t.statusResult)}).name:"..........")),i.a.createElement("tr",null,i.a.createElement("td",{colSpan:5,style:{textAlign:"center"}},i.a.createElement("h2",null,"Danh sách xét nghiệm"))),i.a.createElement("tr",{style:{border:"1px solid black"}},i.a.createElement("th",{style:{border:"1px solid black"}},"Mã xét nghiệm"),i.a.createElement("th",{style:{border:"1px solid black"}},"Ngày lấy mẫu"),i.a.createElement("th",{style:{border:"1px solid black"}},"Ngày có kết quả"),i.a.createElement("th",{style:{border:"1px solid black"}},"Tên xét nghiệm"),i.a.createElement("th",{style:{border:"1px solid black"}},"Dịch vụ xét nghiệm"),i.a.createElement("th",{style:{border:"1px solid black"}},"Kết quả")),null!=c&&c.items?c.items.map(e=>{var t,a,n,s,o;return i.a.createElement("tr",{style:{border:"1px solid black"}},i.a.createElement("td",{style:{border:"1px solid black"}},null===(t=e.labTest)||void 0===t?void 0:t.code),i.a.createElement("td",{style:{border:"1px solid black"}},e.specimenDate?Te()(e.specimenDate).format("DD/MM/YYY"):""),i.a.createElement("td",{style:{border:"1px solid black"}},e.performedDate?Te()(e.performedDate).format("DD/MM/YYY"):""),i.a.createElement("td",{style:{border:"1px solid black"}},null===(a=e.labTest)||void 0===a?void 0:a.name),i.a.createElement("td",{style:{border:"1px solid black"}},null===(n=e.labTestAndService)||void 0===n||null===(s=n.service)||void 0===s?void 0:s.name),i.a.createElement("td",{style:{border:"1px solid black"}},1==(null==e||null===(o=e.labTest)||void 0===o?void 0:o.resultType)?e.numericResult:e.stringResult))}):""))))))},ut=a(272),ht=a.n(ut);const pt=Object(O.makeStyles)(e=>({tooltip:{fontSize:"15px"}}));var gt=e=>{const t=pt();return i.a.createElement(i.a.Fragment,null,i.a.createElement(ht.a,{classes:{tooltip:t.tooltip},title:e.title},e.children))},ft=a(114),vt=a.n(ft);function bt(e){return i.a.createElement(vt.a,e)}var yt=Object(s.memo)(e=>{let{url:t,open:a,handleClose:o,type:r}=e;const[l,c]=Object(s.useState)(null);return Object(s.useEffect)(()=>{const e=window.innerHeight-80;c(e)},[]),i.a.createElement(n.Dialog,{className:"dialog-container",open:a,PaperComponent:bt,fullScreen:!0,PaperProps:{style:{backgroundColor:"rgba(0, 0, 0, 0.7)",boxShadow:"none",display:"flex",justifyContent:"center"}}},i.a.createElement("div",{onClick:()=>o(),style:{display:"flex",justifyContent:"center",height:"100vh"}},i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px",color:"white"},onClick:()=>o()},i.a.createElement(De.a,{style:{fontSize:"30px"}})),"img"===r?i.a.createElement("img",{src:t,onClick:e=>function(e){e.stopPropagation()}(e),className:"default__view-image",style:{maxHeight:"100vh",maxWidth:"100vw",objectFit:"contain"}}):"pdf"===r?i.a.createElement("iframe",{src:t,height:"100%",width:"86%"}):void 0))});function Et(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function _t(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Et(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const St=Object(O.withStyles)(e=>({tooltip:{backgroundColor:e.palette.common.white,color:"rgba(0, 0, 0, 0.87)",boxShadow:e.shadows[1],fontSize:11,position:"absolute",top:"-15px",left:"-30px",width:"80px"}}))(n.Tooltip),Ct=Object(n.makeStyles)(e=>({root:{overflow:"auto"}}));function wt(e){const t=Ct(),{initialValues:a,handleSubmit:s,handleClose:o}=e,[r,c]=i.a.useState(!1),[d,m]=i.a.useState(null),[h,g]=i.a.useState(!1),[f,b]=i.a.useState(""),[E,_]=i.a.useState(!1),[S,C]=i.a.useState(!1),[w,O]=i.a.useState(null),[x,R]=i.a.useState(null),k=Ye.object({}),I=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:k,onSubmit:e=>{s(e)}}),T=()=>{c(!1)},N=["Âm tính","Dương tính"],D=["Âm tính","Dương tính","Nghi ngờ"],j=["Có phản ứng","Không phản ứng","Không xác định"],A=e=>"56888-1"==e||"75409-3"==e||"75886-2"==e||"XN-006"==e||"XN-005"==e||"XN-005"==e||"XN-007"==e,M=()=>{g(!1),C(!1)};return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:I.handleSubmit},i.a.createElement("div",null,i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(P,{formik:I,label:"Ngày chỉ định xét nghiệm",format:"dd/MM/yyyy",field:"requestDate",inputVariant:"outlined",disabled:!0,size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.Button,{variant:"contained",className:"mr-12 btn btn-primary d-inline-flex",onClick:()=>(()=>{let e={pageIndex:1,pageSize:1e3,isIntermediateServer:!0,labTestOrderId:I.values.id};$e.getLabTestOderItem(e).then(e=>{let{data:t}=e;m(t.content),c(!0)})})()},"CN-KQ từ PXN liên kết")),E&&i.a.createElement(l,{open:E,onConfirmDialogClose:()=>{_(!1)},onYesClick:()=>{s(I.values)},title:"Xác nhận lưu",text:"Bạn chưa cập nhật đủ các kết quả xét nghiệm, bạn có chắc chắn lưu?",agree:"Có",cancel:"Không"}),r&&i.a.createElement(Ue,{children:i.a.createElement(Je,{data:d}),handleClose:T,open:r,title:"Đồng bộ kết quả xét nghiệm",handleSubmit:async e=>{const t=e.props.data;let a=I.values.items;await t.forEach(e=>{let t=a.findIndex(t=>t.id==e.id);-1!==t&&(a[t]=_t(_t({},a[t]),{},{performedDate:e.performedDate,specimenDate:e.specimenDate,numericResult:e.numericResult,stringResult:e.stringResult}))}),I.setFieldValue("items",a),T()}}),i.a.createElement(n.Grid,{className:"labtest-result-table",item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:I.values.items?I.values.items:[],columns:[{title:"Ngày lấy mẫu",field:"specimenDate",render:e=>{let t=e.tableData.id,a=i.a.createElement(H,{formik:I,format:"dd/MM/yyyy",field:"specimenDate",length:I.values.items?I.values.items.length:0,size:"small",container:"items",index:t,minDate:I.values.requestDate,minDateMessage:"Ngày lấy mẫu không thể chọn trước ngày yêu cầu xét nghiệm"}),n=i.a.createElement(W,{formik:I,format:"dd/MM/yyyy",field:"specimenDate",size:"small",container:"items",index:t,minDate:I.values.requestDate,minDateMessage:"Ngày lấy mẫu không thể chọn trước ngày yêu cầu xét nghiệm"}),s=1==e.refuse?"":n,o=1==e.refuse?"":a;return 0==t?o:s},cellStyle:{padding:"0px 10px 15px 10px",minWidth:"150px"}},{title:"Ngày có kết quả",field:"performedDate",render:e=>{let t=e.tableData.id,a=i.a.createElement(W,{formik:I,format:"dd/MM/yyyy",field:"performedDate",size:"small",container:"items",index:t,minDate:I.values.requestDate,minDateMessage:"Ngày Thực hiện không thể chọn trước ngày yêu cầu xét nghiệm"}),n=i.a.createElement(H,{formik:I,format:"dd/MM/yyyy",field:"performedDate",length:I.values.items?I.values.items.length:0,size:"small",container:"items",index:t,minDate:I.values.requestDate,minDateMessage:"Ngày Thực hiện không thể chọn trước ngày yêu cầu xét nghiệm"}),s=1==e.refuse?"":a,o=1==e.refuse?"":n;return 0==t?o:s},cellStyle:{padding:"0px 10px 15px 10px",minWidth:"150px"}},{title:"Tên xét nghiệm",field:"labTest.name",cellStyle:{padding:"8px 10px 13px 10px",minWidth:"300px"},headerStyle:{minWidth:"300px"},render:e=>{var t,a,n;return i.a.createElement("div",null,i.a.createElement("p",{style:{margin:0}},null==e||null===(t=e.labTest)||void 0===t?void 0:t.name),i.a.createElement("p",{style:{margin:0,color:"#3366ff",fontSize:"1.4rem"}},"Dịch vụ: ",null===(a=e.labTestAndService)||void 0===a||null===(n=a.service)||void 0===n?void 0:n.name))}},{title:"Kết quả",field:"numericResult",cellStyle:{padding:"0px 10px 15px 10px"},render:e=>{var t,a,s;let o=e.tableData.id,r=1==(null==e||null===(t=e.labTest)||void 0===t?void 0:t.resultType)?i.a.createElement(K,{formik:I,field:"numericResult",size:"small",container:"items",index:o,type:"number"}):A(null==e||null===(a=e.labTest)||void 0===a?void 0:a.code)?((e,t)=>{var a,s,o;let r=N;null===(a=I.values)||void 0===a||a.items[t];return"XN-006"!=e&&"XN-007"!=e||(r=D),"56888-1"==e&&(r=j),i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},size:"small"},i.a.createElement(p.a,{options:r,id:"stringResult-select",value:null===(s=I.values)||void 0===s||null===(o=s.items[t])||void 0===o?void 0:o.stringResult,onChange:(e,a)=>{var n,s;null!=(null===(n=I.values)||void 0===n?void 0:n.items)&&(I.values.items[t].stringResult=a,I.setFieldValue("items",null===(s=I.values)||void 0===s?void 0:s.items))},renderInput:e=>i.a.createElement(n.TextField,u()({},e,{margin:"normal"}))}))})(null==e||null===(s=e.labTest)||void 0===s?void 0:s.code,o):i.a.createElement(K,{formik:I,field:"stringResult",size:"small",container:"items",index:o});return 1==e.refuse?"Từ chối xét nghiệm":r}},{title:"Thao tác",field:"custom",align:"center",cellStyle:{padding:"0px 0px 0px 0px"},render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Xuất file"},i.a.createElement(n.IconButton,{size:"medium",onClick:()=>(e=>{const t=y.a.API_ENPOINT+"/api/download/pdf/lab-test-order-item/"+e.id;v.a.get(t,{responseType:"arraybuffer"}).then(e=>{let t=e.data,a=new Blob([t],{type:"PDF"});return He.a.saveAs(a,"Phiếu xét nghiệm.pdf")})})(e)},i.a.createElement(Ve.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,sorting:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",padding:"6px"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},"Danh sách tệp tải lên"),i.a.createElement(n.Grid,{className:"labtest-result-table",item:!0,lg:12,md:12,sm:12,xs:12},h&&i.a.createElement(lt,{open:h,onConfirmDialogClose:M,handleClose:M,description:f}),S&&i.a.createElement(yt,{url:x,open:S,handleClose:()=>{M()},type:w}),i.a.createElement(qe.a,{data:I.values.documents?I.values.documents:[],columns:[{title:"Thao tác",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(St,{title:"Tải xuống",placement:"top",enterDelay:300,leaveDelay:200},i.a.createElement(n.IconButton,{size:"medium",onClick:()=>(e=>{e.file;let t=e.file.contentType,a=e.file.name;const n=y.a.API_ENPOINT+"/api/fileDownload/document/"+e.file.id;v.a.get(n,{responseType:"arraybuffer"}).then(e=>{let n=e.data,s=new Blob([n],{type:t});return He.a.saveAs(s,a)})})(e)},i.a.createElement(Ve.a,{fontSize:"medium",color:"primary"}))),i.a.createElement(St,{title:"Xem file",placement:"top",enterDelay:300,leaveDelay:200},i.a.createElement(n.IconButton,{size:"medium",onClick:()=>(e=>{let t=e.file,a=t.contentType;const n=y.a.API_ENPOINT+"/api/fileDownload/document/"+t.id;v.a.get(n,{responseType:"arraybuffer"}).then(e=>{let t=e.data,n=null;if(n=new Blob([t],{type:a}),"image/jpg"==n.type||"image/jpeg"==n.type||"image/png"==n.type){let e=URL.createObjectURL(n);R(e),O("img"),C(!0)}else if("application/pdf"==n.type){let e=URL.createObjectURL(n);O("pdf"),R(e),C(!0)}else Ce.toast.warning("Định dạng tệp tin không thể xem. Hãy tải xuống",Oe.a.TOAST_CONFIGURE)})})(e)},i.a.createElement(ze.a,{fontSize:"medium",color:"primary"})))),cellStyle:{padding:"2px",maxWidth:"80px"},headerStyle:{maxWidth:"80px"}},{title:"Tên file",field:"file.name",align:"left",cellStyle:{padding:"2px",minWidth:"500px"},headerStyle:{minWidth:"500px"}},{title:"Mô tả",field:"description",cellStyle:{padding:"2px",minWidth:"500px"},headerStyle:{minWidth:"500px"}}],options:{draggable:!1,sorting:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"640px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",padding:"6px"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgba(63, 81, 181, 0.08)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})))),i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(dt.a,null),onClick:()=>{let e=document.getElementById("content-print"),t=document.getElementById("printable").contentWindow;t.document.open(),t.document.write(e.innerHTML),t.document.close(),t.focus(),t.print()},className:"mr-12 btn btn-primary d-inline-flex",variant:"contained",color:"primary"},"In Yêu cầu xét nghiệm"),i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"mr-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",loading:e.loading,onClick:()=>(()=>{let e=!1,t=!1,a=!1;I.values.items.forEach((t,a)=>Te()(t.specimenDate).isBefore(I.values.requestDate,"day")||Te()(t.specimenDate).isSame(I.values.requestDate)?(Ce.toast.error("Ngày lấy mẫu không thể chọn trước ngày yêu cầu xét nghiệm"),void(e=!0)):Te()(t.performedDate).isBefore(I.values.requestDate,"day")||Te()(t.performedDate).isSame(I.values.requestDate)?(Ce.toast.error("Ngày thực hiện không thể chọn trước ngày yêu cầu xét nghiệm"),void(e=!0)):void 0),e||(console.log(I.values),I.values.items&&I.values.items.forEach((e,a)=>{if(e.compulsoryToDoNewTest){if(2===e.resultType&&(null===e.stringResult||""===e.stringResult||void 0===e.stringResult))return Ce.toast.warning(`Kết quả xét nghiệm "${e.labTestName}" không được trống`),void(t=!0);if(1===e.resultType&&(null===e.numericResult||""===e.numericResult||void 0===e.numericResult))return Ce.toast.warning(`Kết quả xét nghiệm "${e.labTestName}" không được trống`),void(t=!0)}})),I.values.items.forEach((e,t)=>{var n,s;(1!=(null==e?void 0:e.resultType)||null!==(null==e?void 0:e.numericResult)&&""!==(null==e?void 0:e.numericResult))&&(1===(null==e?void 0:e.resultType)||A(null==e||null===(n=e.labTest)||void 0===n?void 0:n.code)||null!==(null==e?void 0:e.stringResult)&&""!==(null==e?void 0:e.stringResult))&&(1===(null==e?void 0:e.resultType)||!A(null==e||null===(s=e.labTest)||void 0===s?void 0:s.code)||null!==(null==e?void 0:e.stringResult)&&""!==(null==e?void 0:e.stringResult))||(a=!0)}),e||t||a||s(I.values),e||t||!a||_(!0)})()},"Lưu"))))),i.a.createElement("iframe",{id:"printable",width:"100%",loading:"lazy",hidden:!0},i.a.createElement(mt,{item:e.item})))}var Ot=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/users/"+e.pageIndex+"/"+e.pageSize;return v.a.get(a)}async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/user/search-by-dto";return v.a.post(a,e)}async findUserByUserName(e,t,a){var n=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+n;let s=y.a.API_ENPOINT+"/api/users/username/"+e+"/"+t+"/"+a;return v.a.get(s)}async getAllRoles(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/user/getAllRole";return v.a.get(t)}async getItemById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/users/"+e;return v.a.get(a)}async saveUser(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/g-com-user/save";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/g-com-user/update";return v.a.post(a,e)}async getAllInfoByUserLogin(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/user/getAllInfoByUserLogin";return v.a.get(t)}async duplicatedUserName(e){let t="";return t=y.a.API_ENPOINT+"/api/user/checkDuplicateUserName",v.a.post(t,e)}async checkDuplicatedPhone(e){let t="";return t=y.a.API_ENPOINT+"/api/user/checkDuplicatedPhone",v.a.post(t,e)}};function xt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Rt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xt(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function kt(e){return i.a.createElement(vt.a,e)}class It extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"handleFormSubmit",async e=>{var t,a,n;let{id:s}=this.state;this.setState({loading:!0});let i=Rt(Rt({id:s},this.state),{},{encounter:e.encounter,items:e.items,template:e.template,requestDate:e.requestDate,resultFilePath:e.resultFilePath,documents:e.documents}),o={id:null===(t=this.props.item.encounter)||void 0===t||null===(a=t.treatmentPeriod)||void 0===a?void 0:a.id,encounterId:null===(n=e.encounter)||void 0===n?void 0:n.id,status:4};s&&await $e.update(i).then(()=>{$e.updateTreatmentPeriodStatus(o).then(()=>{this.props.handleClose(),Ce.toast.success("Đã cập nhật xét nghiệm!",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.error("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})}).finally(()=>{this.setState({loading:!1})})}),this.state={id:null,items:[],encounter:{},template:{},requestDate:null,resultFilePath:"",isLoad:!1,documents:[],loading:!1}}async componentDidMount(){let{item:e}=this.props;e&&this.setState(Rt({},e)),this.setState({isLoad:!0}),await Ot.getAllInfoByUserLogin().then(e=>{let{data:t}=e;this.setState({user:t})})}render(){let{isLoad:e}=this.state;return e&&i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:kt,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," Cập nhật kết quả xét nghiệm "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(wt,{initialValues:{id:this.state.id,items:this.state.items,encounter:this.state.encounter,template:this.state.template,requestDate:(this.state.requestDate,this.state.requestDate),resultFilePath:this.state.resultFilePath,documents:this.state.documents},item:this.props.item,handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,loading:this.state.loading}))}}const Tt=i.a.forwardRef((function(e,t){return i.a.createElement(ot.a,u()({direction:"down",ref:t},e))}));function Pt(e){const{open:t,handleClose:a,handleSubmit:s,content:o,title:r,label:l,multiline:c,minRows:d,variant:m,required:u,readOnly:h,agreeButton:p}=e,[g,f]=i.a.useState(o),[v,b]=i.a.useState("");return i.a.createElement(Xe.a,{open:t,TransitionComponent:Tt,keepMounted:!0,onClose:a,"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description",fullWidth:!0,maxWidth:"sm"},i.a.createElement(st.a,{id:"alert-dialog-slide-title",className:"dialog-header bgc-primary-d1"},i.a.createElement("span",{className:"mb-20 text-white"},r),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>a()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(at.a,null,i.a.createElement(n.TextField,{style:{marginTop:"12px"},autoFocus:!0,id:"content",label:l,fullWidth:!0,value:g,onChange:e=>{f(e.target.value),""===e.target.value&&u?b("Trường này là bắt buộc"):b("")},multiline:c||!1,minRows:d||1,variant:m||"standard",error:""!==v,helperText:v,InputProps:{readOnly:h||!1}})),i.a.createElement(et.a,null,i.a.createElement("div",{style:{padding:"0px 18px"}},i.a.createElement(n.Button,{color:"primary",className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",onClick:()=>{""===g&&u?b("Trường này là bắt buộc"):s(g)}},p||"Đồng ý"))))}var Nt=function(e){var t,a,n,s,o;const{item:r,encounter:l,clinicCode:c,clinicName:d}=e,m=new Date;return i.a.createElement("div",{id:"content-print",style:{width:820,margin:"auto",lineHeight:24}},console.log("Item: ",r),i.a.createElement("div",{style:{margin:"100px 50px 0px 60px",fontSize:18}},i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("span",null,"Tên phòng khám: "),i.a.createElement("span",{style:{marginLeft:5}},i.a.createElement("b",null,d||"................."))),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("span",null,"Mã phòng khám: "),i.a.createElement("span",{style:{marginLeft:5}},i.a.createElement("b",null,c||".................."))),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("span",null,"Mã bệnh án: "),i.a.createElement("span",{style:{marginLeft:5}},i.a.createElement("b",null,r.code?r.code:".................")))),i.a.createElement("div",{style:{display:"flex",fontSize:24,margin:20,justifyContent:"center"}},i.a.createElement("b",null,"ĐƠN THUỐC")),i.a.createElement("div",{style:{margin:"0px 50px 0px 60px",fontSize:18}},i.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"space-between"}},i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("span",null,i.a.createElement("b",null,"Họ tên: ")),i.a.createElement("span",{style:{marginLeft:5}},null!==(t=r.patient)&&void 0!==t&&t.displayName?r.patient.displayName:"...................")),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("span",null,"Tuổi: "),i.a.createElement("span",{style:{marginLeft:5}},r.patient.birthDate?Te()(new Date).diff(r.patient.birthDate,"y"):"...............")),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("span",null,"Cân nặng: "),i.a.createElement("span",{style:{marginLeft:5}},l||"...............")),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("span",null,"Nam/nữ: "),i.a.createElement("span",{style:{marginLeft:5}},r.patient.gender?Oe.a.GENDER.find(e=>e.value==r.patient.gender).name:".............."))),i.a.createElement("div",null,i.a.createElement("span",null,i.a.createElement("b",null,"Mã số thẻ BHYT"),i.a.createElement("span",{style:{marginLeft:3}},"(nếu có):")),i.a.createElement("span",{style:{marginLeft:5}},r.patient.healthInsuranceNumber?r.patient.healthInsuranceNumber:"...............")),i.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},i.a.createElement("div",null,i.a.createElement("span",null,i.a.createElement("b",null,"Địa chỉ liên hệ: ")),i.a.createElement("span",{style:{marginLeft:5}},r.receiveAddress?r.receiveAddress:"..............."))),i.a.createElement("div",null,i.a.createElement("span",null,i.a.createElement("b",null,"ĐT:")),i.a.createElement("span",{style:{marginLeft:5}},null!=r&&r.receivePhoneNumber?null==r?void 0:r.receivePhoneNumber:"...................")),i.a.createElement("div",null,i.a.createElement("span",null,i.a.createElement("b",null,"Chẩn đoán: ")," ",`Điều trị tại ${null!=r&&null!==(a=r.encounter)&&void 0!==a&&a.templateCorrespondingTo?null==r||null===(n=r.encounter)||void 0===n?void 0:n.templateCorrespondingTo:"T0"} `),i.a.createElement("span",{style:{marginLeft:5,color:"red"}},null!=r&&r.drugsByRegimen&&null!=r&&r.drugsByRegimen[0].regimenName?`(${null==r?void 0:r.drugsByRegimen[0].regimenName})`:"")),i.a.createElement("div",null,i.a.createElement("span",null,i.a.createElement("b",null,"Thuốc điều trị: ")," ",i.a.createElement("span",null,i.a.createElement("i",{style:{color:"red",marginLeft:5}},"(Thuốc cấp miễn phí):")))),i.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},i.a.createElement("span",{style:{marginLeft:5,color:"red"}},i.a.createElement("i",null,r.drugsByRegimen?r.drugsByRegimen.map(e=>{var t;return i.a.createElement("span",{style:{margin:0}},e.drugName," ",(null===(t=e.drugsByRegimen)||void 0===t?void 0:t.length)>0?",":"")}):""))),i.a.createElement("div",null,i.a.createElement("i",null,i.a.createElement("div",null,i.a.createElement("b",null,"Note:"),i.a.createElement("span",{style:{marginLeft:"3px"}},r.drugsByRegimen?r.drugsByRegimen.map(e=>{var t;return i.a.createElement("span",{style:{margin:0}},e.note," ",(null===(t=e.drugsByRegimen)||void 0===t?void 0:t.length)>0?",":"")}):"")),i.a.createElement("div",null,i.a.createElement("b",null,"Lời dặn: ")),i.a.createElement("div",{style:{marginLeft:40}},i.a.createElement("div",null,"- Ngày hẹn khám lại"),i.a.createElement("div",null,"- ĐT hỗ trợ KH:"),i.a.createElement("div",null,"- Khám lại xin mang theo đơn này.")),i.a.createElement("div",null,i.a.createElement("b",null,"Cam kết sử ụng thuốc theo đơn, không bán thuốc")))),i.a.createElement("br",null),i.a.createElement("table",{style:{border:"1px solid black",fontSize:18,borderCollapse:"collapse",width:"100%",marginBottom:120}},i.a.createElement("tbody",null,i.a.createElement("tr",{style:{border:"1px solid black"}},i.a.createElement("td",{style:{border:"1px solid black"}},i.a.createElement("div",{style:{margin:"5px 3px"}},i.a.createElement("span",null,i.a.createElement("span",null,i.a.createElement("i",null,"Ngày")),i.a.createElement("span",{style:{marginLeft:2}},i.a.createElement("i",null,m.getDate()))),i.a.createElement("span",{style:{marginLeft:3}},i.a.createElement("span",null,i.a.createElement("i",null,"tháng")),i.a.createElement("span",{style:{marginLeft:2}},i.a.createElement("i",null,m.getMonth()+1))),i.a.createElement("span",{style:{marginLeft:3}},i.a.createElement("span",null,i.a.createElement("i",null,"năm")),i.a.createElement("span",{style:{marginLeft:2}},i.a.createElement("i",null,m.getFullYear())))),i.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},i.a.createElement("b",null,"Khách hàng")),i.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},i.a.createElement("i",null,"(Ký, ghi rõ họ tên)")),i.a.createElement("div",{style:{height:"140px",textAlign:"center"}},i.a.createElement("b",{style:{alignItems:"center",lineHeight:"80px"}},null!==(s=r.patient)&&void 0!==s&&s.displayName?r.patient.displayName:"..................."))),i.a.createElement("td",{style:{border:"1px solid black"}},i.a.createElement("div",{style:{margin:"5px 3px"}},i.a.createElement("span",null,i.a.createElement("span",null,i.a.createElement("i",null,"Ngày")),i.a.createElement("span",{style:{marginLeft:2}},i.a.createElement("i",null,m.getDate()))),i.a.createElement("span",{style:{marginLeft:3}},i.a.createElement("span",null,i.a.createElement("i",null,"tháng")),i.a.createElement("span",{style:{marginLeft:2}},i.a.createElement("i",null,m.getMonth()+1))),i.a.createElement("span",{style:{marginLeft:3}},i.a.createElement("span",null,i.a.createElement("i",null,"năm")),i.a.createElement("span",{style:{marginLeft:2}},i.a.createElement("i",null,m.getFullYear())))),i.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},i.a.createElement("b",null,"Người phát thuốc")),i.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},i.a.createElement("i",null,"(Ký, ghi rõ họ tên)")),i.a.createElement("div",{style:{height:"140px",textAlign:"center"}},i.a.createElement("b",{style:{alignItems:"center",lineHeight:"80px"}}))),i.a.createElement("td",{style:{border:"1px solid black"}},i.a.createElement("div",{style:{margin:"5px 3px"}},i.a.createElement("span",null,i.a.createElement("span",null,i.a.createElement("i",null,"Ngày")),i.a.createElement("span",{style:{marginLeft:2}},i.a.createElement("i",null,m.getDate()))),i.a.createElement("span",{style:{marginLeft:3}},i.a.createElement("span",null,i.a.createElement("i",null,"tháng")),i.a.createElement("span",{style:{marginLeft:2}},i.a.createElement("i",null,m.getMonth()+1))),i.a.createElement("span",{style:{marginLeft:3}},i.a.createElement("span",null,i.a.createElement("i",null,"năm")),i.a.createElement("span",{style:{marginLeft:2}},i.a.createElement("i",null,m.getFullYear())))),i.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},i.a.createElement("b",null,"Bác sĩ khám bệnh")),i.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},i.a.createElement("i",null,"(Ký, ghi rõ họ tên)")),i.a.createElement("div",{style:{height:"140px",textAlign:"center"}},i.a.createElement("b",{style:{alignItems:"center",lineHeight:"80px"}},null!==(o=r.practitioner)&&void 0!==o&&o.displayName?r.practitioner.displayName:""))))))))};a(410);function Dt(e){const{formik:t,optionList:a,field:o,variant:r,size:l,listLabelValue:c,disabled:d,action:m,required:u,readOnly:h}=e,[p,g]=i.a.useState(t.values[o]);return Object(s.useEffect)(()=>{t.values[o]=p},[p]),Object(s.useEffect)(()=>{g(t.values[o]),null!=m&&(1==t.values[o]?m(!0):m(!1))}),i.a.createElement(n.FormControl,{fullWidth:!0,variant:r,required:u||!1,disabled:h},i.a.createElement(n.RadioGroup,{row:!0,"aria-label":o,name:o,value:p,onChange:e=>{g(e.target.value)}},c.map(e=>i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:3,xs:12,className:"align-center"},i.a.createElement(n.FormControlLabel,{value:e.value,control:i.a.createElement(n.Radio,{disabled:h,color:"primary",size:"medium",checked:p==e.value}),label:e.label,"aria-describedby":o})))),i.a.createElement(n.FormHelperText,{id:o},t.touched[o]&&t.errors[o]))}var jt=a(92),At=a.n(jt),Mt=a(1216),Ut=a.n(Mt);a(1225);const Lt=e=>{const t=i.a.useRef(null);return i.a.useEffect(()=>{var e;null===(e=t.current)||void 0===e||e.editor.root.setAttribute("spellcheck","false")},[]),i.a.createElement(Ut.a,u()({theme:"snow",onChange:e.handleContentChange,defaultValue:e.content,modules:Lt.modules,formats:Lt.formats,placeholder:e.placeholder},e))};Lt.modules={toolbar:[[{font:[]}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike"],["blockquote","code-block","link"],[{script:"sub"},{script:"super"}],[{color:[]},{background:[]}],[{align:[]}],["image","video"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],["clean"]],clipboard:{matchVisual:!0}},Lt.formats=["align","background","bold","blockquote","bullet","color","code","code-block","clean","direction","font","header","italic","indent","image","list","link","size","strike","script","underline","video"],Lt.propTypes={placeholder:At.a.string};var Ft=Lt,Bt=a(149),Vt=a.n(Bt);a(120);function Gt(e){const[t,a]=Object(s.useState)(""),o=()=>{e.search(t)};return i.a.createElement(n.FormControl,{className:"float-right",fullWidth:!0},i.a.createElement(n.Input,{fullWidth:!0,onChange:e=>{a(e.target.value)},name:"text",placeholder:"Nhập từ khóa",onKeyDown:e=>{"Enter"===e.key&&o()},endAdornment:i.a.createElement(n.InputAdornment,{position:"end"},i.a.createElement(n.IconButton,{type:"submit","aria-label":"search",onClick:o},i.a.createElement(Vt.a,null)))}))}a(2256);function zt(e){return i.a.createElement(vt.a,e)}class Wt extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await _.searchByPage(e);this.setState({itemList:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClick",(e,t)=>{null==this.state.selectedValue?this.setState({selectedValue:t.id,selectedItem:t}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"onClickRow",e=>{null==this.state.selectedValue?this.setState({selectedValue:e.id,selectedItem:e}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"renderLevel",e=>{let t="";return y.a.ADMINISTRATIVE_UNIT_LEVEL.map(a=>{a.value==e&&(t=a.name)}),t}),Fe()(this,"search",e=>{this.setState({text:e},()=>this.updatePageData())}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:{},text:"",itemList:[],selectedValue:""}}componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props;this.setState({selectedValue:e.id,selectedItem:e})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:zt,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20"},"Chọn đơn vị quản lý")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(Gt,{search:this.search}))),i.a.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},i.a.createElement(qe.a,{data:s,columns:[{title:"Chọn",field:"custom",align:"left",width:"250",render:e=>i.a.createElement(n.Radio,{id:"radio"+e.id,name:"radSelected",value:e.id,checked:this.state.selectedValue===e.id,onClick:t=>this.handleClick(t,e)})},{title:"Mã",field:"code",align:"left",width:"150"},{title:"Tên",field:"name",width:"150"},{title:"Cấp hành chính",field:"level",width:"150",render:e=>this.renderLevel(e.level)},{title:"Đơn vị quản lý",field:"parent.name",width:"150"}],onRowClick:(e,t)=>this.onClickRow(t),options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e(),style:{marginRight:"12px"}},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Chọn")))}}var Ht=Wt;function Kt(e){const{formik:t,field:a,size:o,required:r,variant:l,label:c,disabled:d,classes:m,tree:u}=e,[h,p]=i.a.useState(!1),[g,f]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{t.values[a]=g},[g]),Object(s.useEffect)(()=>{f(t.values[a])},[t.values,a,g]),i.a.createElement("div",{className:"input-popup-container"},i.a.createElement(n.TextField,{disabled:!0,fullWidth:!0,classes:m,id:a,size:o,name:a,label:c,value:g&&g.name?g.name:"",onChange:t.handleChange,required:!0,variant:l,error:t.touched[a]&&Boolean(t.errors[a]),helperText:t.touched[a]&&t.errors[a]}),!d&&i.a.createElement(n.Button,{size:"small",className:"btn btn-primary",style:{float:"right",height:"100%"},variant:"contained",onClick:()=>p(!0)},"Chọn"),h&&i.a.createElement(Ht,{open:h,handleSelect:e=>{p(!1),f(e)},selectedItem:g||{},handleClose:()=>p(!1)}))}var qt=a(2257),Yt=a.n(qt);a(2258);var $t=new class{async createBioProduct(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestBiologicalTest";return v.a.post(a,e)}async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestBiologicalTest/searchByDto";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestBiologicalTest/"+e;return v.a.get(a)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestBiologicalTest";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestBiologicalTest/"+e.id;return v.a.put(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestBiologicalTest/"+e;return v.a.delete(a)}},Jt=a(567),Qt=a.n(Jt);function Xt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Zt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Xt(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Xt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ea(e){return i.a.createElement(vt.a,e)}class ta extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,labTestId:this.props.item.id},t=await $t.searchByDto(e),{selectedItem:a}=this.state,n=t.data.content,s=a;if(s&&s.length>0)for(let e=0;e<n.length;e++)for(let t=0;t<s.length;t++)if(n[e].id==s[t].service.id){let t={checked:!0};n[e].tableData=t;break}this.setState({itemList:n,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleEditItem",e=>{this.setState({shouldOpenEditorDialog:!0})}),Fe()(this,"handleIndexData",e=>e.map((e,t)=>Zt(Zt({},e),{},{index:t+1}))),Fe()(this,"handleConfirmDeleteItem",()=>{$t.deleteById(this.state.idBioProduct).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({idBioProduct:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleSubmit",()=>{let e={name:this.state.name,labTest:{id:this.props.item.id}};""==this.state.name||null==this.state.name?Ce.toast.warning("Chưa điền tên sinh phẩm",Oe.a.TOAST_CONFIGURE):$t.createBioProduct(e).then(()=>{this.updatePageData(),Ce.toast.success("Thêm sinh phẩm thành công",Oe.a.TOAST_CONFIGURE),this.setState({name:""})})}),Fe()(this,"handleChange",e=>{this.setState({name:e.target.value})}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:[],itemList:[],selectedValue:"",name:"",idBioProduct:""}}componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props;this.setState({selectedItem:e})}render(){const{handleClose:e,handleSelect:t,open:a,item:s}=this.props;let{itemList:o,shouldOpenConfirmationDialog:r}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:ea,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20"},"Thêm sinh phẩm")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:6},i.a.createElement(n.TextField,{fullWidth:!0,onChange:this.handleChange,size:"small",label:"Tên",variant:"outlined",value:this.state.name}))),i.a.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},r&&i.a.createElement(l,{open:r,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(qe.a,{data:o?this.handleIndexData(o):[],columns:[{title:"STT",field:"index",width:"20"},{title:"Tên",field:"name",width:"150"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qt.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e(),style:{marginRight:"12px"}},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>this.handleSubmit()},"Thêm")))}}var aa=ta;function na(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function sa(e){const{formik:t,field:a,size:o,required:r,variant:l,label:c,disabled:d,classes:m,tree:u,item:h}=e,[p,g]=i.a.useState(!1),[f,v]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{t.values[a]=f},[f]),Object(s.useEffect)(()=>{v(t.values[a])},[t.values,a,f]),i.a.createElement("div",{className:""},!d&&i.a.createElement(n.Button,{size:"small",className:"btn btn-primary-d",variant:"contained",onClick:()=>g(!0)},"Thêm sinh phẩm"),p&&i.a.createElement(aa,{item:h,open:p,handleSelect:e=>{if(e&&e.length>0){let n=[];e.forEach(e=>{n.push(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?na(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):na(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}),v(n),t.setFieldValue(a,n),g(!1)}else Ce.toast.warning("Chưa chọn dịch vụ",Oe.a.TOAST_CONFIGURE)},selectedItem:f||[],handleClose:()=>g(!1)}))}a(2259);var ia=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug/checkCode";return v.a.post(a,e)}};function oa(e){return i.a.createElement(vt.a,e)}class ra extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await ia.searchByPage(e),{selectedItem:a}=this.state,n=t.data.content,s=a;if(s&&s.length>0)for(let e=0;e<n.length;e++)for(let t=0;t<s.length;t++)if(n[e].id==s[t].id){let t={checked:!0};n[e].tableData=t;break}this.setState({itemList:n,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleRowClick",(e,t)=>{e.persist();let{selectedItem:a,itemList:n}=this.state,s=n;const i=s.indexOf(t);s[i].tableData.checked=!s[i].tableData.checked;let o=a;s[i].tableData.checked?o.push(s[i]):o=o.filter(e=>e.id!==s[i].id),this.setState({itemList:s,selectedItem:o},()=>{})}),Fe()(this,"handleClickCheckBox",e=>{var t,a;console.log(e);let{selectedItem:n,itemList:s}=this.state,i=s;const o=i.indexOf(e);let r=n;null!==(t=i[o])&&void 0!==t&&null!==(a=t.tableData)&&void 0!==a&&a.checked?r.push(i[o]):r=-1==o?0==r.length||0==r?s:[]:r.filter(e=>e.id!==i[o].id),this.setState({itemList:i,selectedItem:r})}),Fe()(this,"renderLabTestType",e=>{let t="",a=Oe.a.LABTEST_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"search",e=>{this.setState({text:e},()=>this.updatePageData())}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:[],item:null,itemList:[],selectedValue:"",text:""}}async componentDidMount(){await this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props,t=[];e&&e.length>0&&e.forEach(e=>{t.push(e.drug)}),this.setState({selectedItem:t})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s}=this.state;return console.log(s),i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:oa,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,null,i.a.createElement("h3",{className:"m-0 mb-20 "},"Chọn thuốc")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(Gt,{search:this.search}))),i.a.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},i.a.createElement(qe.a,{data:s,columns:[{title:"Mã thuốc",field:"code"},{title:"Tên thương mại",field:"name"},{title:"Nhà sản xuất",field:"manufacturer"}],onRowClick:this.handleRowClick,onSelectionChange:(e,t)=>{this.handleClickCheckBox(t)},options:{draggable:!1,selection:!0,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"}),selectionProps:e=>({color:"primary"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e()},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Chọn")))}}var la=ra;function ca(e){const{formik:t,field:a,size:o,required:r,variant:l,label:c,disabled:d,classes:m}=e,[u,h]=i.a.useState(!1),[p,g]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{t.values[a]=p},[p]),Object(s.useEffect)(()=>{g(t.values[a])},[t.values,a,p]),i.a.createElement("div",{className:""},!d&&i.a.createElement(n.Button,{className:"btn btn-primary",variant:"contained",color:"primary",onClick:()=>h(!0)},"Chọn thuốc"),u&&i.a.createElement(la,{open:u,handleSelect:e=>{if(e&&e.length>0){let a=[];e.forEach(e=>{a.push({drug:e})}),g(a),t.setFieldValue("drugs",a),h(!1)}else Ce.toast.warning("Chưa chọn thuốc",Oe.a.TOAST_CONFIGURE)},selectedItem:p||[],handleClose:()=>h(!1)}))}function da(e){return i.a.createElement(vt.a,e)}class ma extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,regimenId:this.props.regimenId,except:this.props.selectedItems.map(e=>{var t;return null===(t=e.drug)||void 0===t?void 0:t.id})},t=await ia.searchByPage(e);this.setState({itemList:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClick",(e,t)=>{null==this.state.selectedValue?this.setState({selectedValue:t.id,selectedItem:t}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"onClickRow",e=>{null==this.state.selectedValue?this.setState({selectedValue:e.id,selectedItem:e}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"search",e=>{this.setState({text:e},()=>this.updatePageData())}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:{},text:"",itemList:[],selectedValue:""}}componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props;this.setState({selectedValue:e.id,selectedItem:e})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:da,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20"},"Chọn thuốc")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(Gt,{search:this.search}))),i.a.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},i.a.createElement(qe.a,{data:s,columns:[{title:"Chọn",field:"custom",align:"left",width:"250",render:e=>i.a.createElement(n.Radio,{id:"radio"+e.id,name:"radSelected",value:e.id,checked:this.state.selectedValue===e.id,onClick:t=>this.handleClick(t,e)})},{title:"Mã thuốc",field:"code"},{title:"Tên thương mại",field:"name"},{title:"Nhà sản xuất",field:"manufacturer"}],onRowClick:(e,t)=>this.onClickRow(t),options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,tableLayout:"fixed",maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e(),style:{marginRight:"12px"}},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Chọn")))}}Fe()(ma,"defaultProps",{selectedItems:[]});var ua=ma;a(2260);var ha=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter/";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter/"+e;return v.a.delete(a)}async checkCode(e,t){let a=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+a;const n={params:{id:e,code:t}};let s=y.a.API_ENPOINT+"/api/encounter/checkCode";return v.a.get(s,n)}};function pa(e){return i.a.createElement(vt.a,e)}class ga extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage},t=await ha.searchByPage(e);this.setState({itemList:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClick",(e,t)=>{null==this.state.selectedValue?this.setState({selectedValue:t.id,selectedItem:t}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"onClickRow",e=>{null==this.state.selectedValue?this.setState({selectedValue:e.id,selectedItem:e}):this.setState({selectedValue:null,selectedItem:null})}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:{id:""},text:"",itemList:[],selectedValue:""}}componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props;this.setState({selectedValue:e.id,selectedItem:e})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:pa,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20"},"Select Encounter")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(qe.a,{data:s,columns:[{title:"Select",field:"custom",align:"left",width:"250",render:e=>i.a.createElement(n.Radio,{id:"radio"+e.id,name:"radSelected",value:e.id,checked:this.state.selectedValue===e.id,onClick:t=>this.handleClick(t,e)})},{title:"Ngày thăm khám",field:"encounterDate",align:"left",width:"150",render:e=>e.encounterDate?i.a.createElement("span",null,Te()(e.encounterDate).format("DD/MM/YYYY")):""},{title:"Giai đoạn điều trị",field:"treatmentPeriod.name",width:"150"}],onRowClick:(e,t)=>this.onClickRow(t),options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e()},"Cancel"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Select")))}}var fa=ga;function va(e){const{formik:t,field:a,size:o,required:r,variant:l,label:c,disabled:d,classes:m,tree:u}=e,[h,p]=i.a.useState(!1),[g,f]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{t.values[a]=g},[g]),Object(s.useEffect)(()=>{f(t.values[a])},[t.values,a,g]),i.a.createElement("div",{className:"input-popup-container"},i.a.createElement(n.TextField,{disabled:!0,fullWidth:!0,classes:m,id:a,size:o,name:a,label:c,value:g&&g.encounter&&g.encounter.name?g.encounter.name:"",onChange:t.handleChange,required:!0,variant:l,error:t.touched[a]&&Boolean(t.errors[a]),helperText:t.touched[a]&&t.errors[a]}),!d&&i.a.createElement(n.Button,{size:"small",className:"btn btn-primary-d",style:{float:"right"},variant:"contained",onClick:()=>p(!0)},"Select"),h&&i.a.createElement(fa,{open:h,handleSelect:e=>{p(!1),f(e)},selectedItem:g||{},handleClose:()=>p(!1)}))}a(2261);const ba=y.a.API_ENPOINT+"/api/health-organization";var ya=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/health-organization/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/health-organization/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/health-organization";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/health-organization/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/health-organization/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/health-organization/checkCode";return v.a.post(a,e)}async getListLinkOrgByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=ba+"/getListLinkOrgByDto";return v.a.post(a,e)}async updateListHealthOrg(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/health-organization/updateListHealthOrg";return v.a.get(t)}};function Ea(e){return i.a.createElement(vt.a,e)}class _a extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await ya.searchByPage(e);this.setState({itemList:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClick",(e,t)=>{null==this.state.selectedValue?this.setState({selectedValue:t.id,selectedItem:t}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"onClickRow",e=>{null==this.state.selectedValue?this.setState({selectedValue:e.id,selectedItem:e}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"search",e=>{this.setState({text:e},()=>this.updatePageData())}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:{},text:"",itemList:[],selectedValue:""}}componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props;this.setState({selectedValue:e.id,selectedItem:e})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:Ea,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20"},"Chọn đơn vị quản lý")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(Gt,{search:this.search}))),i.a.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},i.a.createElement(qe.a,{data:s,columns:[{title:"Chọn",field:"custom",align:"left",width:"250",render:e=>i.a.createElement(n.Radio,{id:"radio"+e.id,name:"radSelected",value:e.id,checked:this.state.selectedValue===e.id,onClick:t=>this.handleClick(t,e)})},{title:"Mã",field:"code",align:"left",width:"150"},{title:"Tên",field:"name",width:"150"},{title:"Website",field:"website",width:"150"},{title:"Phân loại",field:"organizationType",width:"150",render:e=>{let t="";const a=y.a.HEALTH_ORGANIZATION_TYPE.find(t=>t.value==e.organizationType);return a&&(t+=a.name),t}},{title:"Đơn vị quản lý",field:"parent.name",width:"150"}],onRowClick:(e,t)=>this.onClickRow(t),options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e()},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Chọn")))}}var Sa=_a;function Ca(e){const{formik:t,field:a,size:o,required:r,variant:l,label:c,disabled:d,classes:m,tree:u}=e,[h,p]=i.a.useState(!1),[g,f]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{t.values[a]=g},[g]),Object(s.useEffect)(()=>{f(t.values[a])},[t.values,a,g]),i.a.createElement("div",{className:"input-popup-container"},i.a.createElement(n.TextField,{disabled:!0,fullWidth:!0,classes:m,id:a,size:o,name:a,label:c,value:g&&g.name?g.name:"",onChange:t.handleChange,required:!0,variant:l,error:t.touched[a]&&Boolean(t.errors[a]),helperText:t.touched[a]&&t.errors[a]}),!d&&i.a.createElement(n.Button,{size:"small",className:"btn btn-primary-d",style:{float:"right",height:"100%"},variant:"contained",onClick:()=>p(!0)},"Chọn"),h&&i.a.createElement(Sa,{open:h,handleSelect:e=>{p(!1),f(e)},selectedItem:g||{},handleClose:()=>p(!1)}))}a(1226);var wa=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTest/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTest/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTest";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTest/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTest/"+e;return v.a.delete(a)}async checkCode(e){let t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;const a={params:{id:e.id,code:e.code}};let n=y.a.API_ENPOINT+"/api/labTest/checkCode";return v.a.get(n,a)}};function Oa(e){return i.a.createElement(vt.a,e)}class xa extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await wa.searchByPage(e),{selectedItem:a}=this.state,n=t.data.content,s=a;if(s&&s.length>0)for(let e=0;e<n.length;e++)for(let t=0;t<s.length;t++)if(n[e].id==s[t].id){let t={checked:!0};n[e].tableData=t;break}this.setState({itemList:n,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleRowClick",(e,t)=>{e.persist();let{selectedItem:a,itemList:n}=this.state,s=n;const i=s.indexOf(t);s[i].tableData.checked=!s[i].tableData.checked;let o=a;s[i].tableData.checked?o.push(s[i]):o=o.filter(e=>e.id!==s[i].id),this.setState({itemList:s,selectedItem:o},()=>{})}),Fe()(this,"onChangeBioProduct",(e,t,a)=>{}),Fe()(this,"handleClickCheckBox",e=>{var t,a;console.log(e);let{selectedItem:n,itemList:s}=this.state,i=s;const o=i.indexOf(e);let r=n;null!==(t=i[o])&&void 0!==t&&null!==(a=t.tableData)&&void 0!==a&&a.checked?r.push(i[o]):r=-1==o?0==r.length||0==r?s:[]:r.filter(e=>e.id!==i[o].id),this.setState({itemList:i,selectedItem:r})}),Fe()(this,"renderLabTestType",e=>{let t="",a=Oe.a.LABTEST_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderBiologicalTestDtos",e=>i.a.createElement(Se.Autocomplete,{fullWidth:!0,options:e||[],getOptionLabel:e=>e.name,size:"small",onChange:this.onChangeBioProduct,renderInput:e=>i.a.createElement(n.TextField,u()({className:"font-inherit",label:"Chọn sinh phẩm",fullWidth:!0,name:"patient"},e)),getOptionSelected:(e,t)=>t===e.id})),Fe()(this,"search",e=>{this.setState({text:e},()=>this.updatePageData())}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:[],item:null,itemList:[],selectedValue:"",text:""}}async componentDidMount(){await this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props,t=[];e&&e.length>0&&e.forEach(e=>{t.push(e.labTest)}),this.setState({selectedItem:t})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:Oa,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,null,i.a.createElement("span",{className:"mb-20"},"Chọn xét nghiệm")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,className:"mb-16"},i.a.createElement(n.Grid,{item:!0,md:6}),i.a.createElement(n.Grid,{item:!0,md:6},i.a.createElement(Gt,{search:this.search}))),i.a.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},i.a.createElement(qe.a,{data:s,columns:[{title:"Mã xét nghiệm",field:"code"},{title:"Tên xét nghiệm",field:"name"},{title:"Loại xét nghiệm",field:"labTestType",render:e=>this.renderLabTestType(e.labTestType)},{title:"Mô tả",field:"description"}],onRowClick:this.handleRowClick,onSelectionChange:(e,t)=>{this.handleClickCheckBox(t)},options:{draggable:!1,selection:!0,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"}),selectionProps:e=>({color:"primary"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e()},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Chọn")))}}var Ra=xa;function ka(e){const[t,a]=Object(s.useState)(!1);return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Button,{className:"btn btn-primary",variant:"contained",color:"primary",onClick:()=>a(!0)},e.label),t&&i.a.createElement(Ra,{open:t,handleSelect:t=>{if(t&&t.length>0){let n=[];t.forEach(e=>{n.push({labTest:e})}),e.setFieldValue("items",n),a(!1)}else Ce.toast.warning("Chưa chọn xét nghiệm",Oe.a.TOAST_CONFIGURE)},selectedItem:e.selectedItems?e.selectedItems:[],handleClose:()=>a(!1)}))}function Ia(e){const{formik:t,field:a,size:o,required:r,variant:l,label:c,disabled:d,classes:m,requiredHivTest:u,isFullWidth:h}=e,[p,g]=i.a.useState(!1),[f,v]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{t.values[a]=f},[f]),Object(s.useEffect)(()=>{v(t.values[a])},[t.values,a,f]),i.a.createElement(i.a.Fragment,null,!d&&i.a.createElement(n.Button,{style:{width:h&&"100%"},className:"btn btn-primary",variant:"contained",color:"primary",onClick:()=>g(!0)},"Chọn xét nghiệm"),p&&i.a.createElement(Ra,{open:p,handleSelect:e=>{if(e&&e.length>0){console.log(e);let a=[];e.forEach(e=>{a.push({labTest:e})});let n=e.findIndex(e=>"56888-1"==e.code);if(console.log(n),n<0)return void Ce.toast.warning("Xét nghiệm HIV combo Ag/Ab là bắt buộc",Oe.a.TOAST_CONFIGURE);v(a),t.setFieldValue("items",a),g(!1)}else Ce.toast.warning("Chưa chọn xét nghiệm",Oe.a.TOAST_CONFIGURE)},selectedItem:f||[],handleClose:()=>g(!1)}))}a(2262);var Ta=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/searchByPage";return v.a.post(a,e)}async getPatient(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/searchByPage";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification";return v.a.post(a,e)}async sendNotifications(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/sendNotifications";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/"+e;return v.a.get(a)}async getAllInfoByUserLogin(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/user/getAllInfoByUserLogin";return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/delete/"+e;return v.a.delete(a)}};function Pa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Na(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Pa(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Pa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Da(e){return i.a.createElement(vt.a,e)}class ja extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Ta.getPatient(e),a=[];this.setState({totalElements:t.data.totalElements,totalPages:t.data.totalPages}),this.state.selectedItem&&(a=t.data.content.map(e=>this.state.selectedItem.findIndex(t=>t.id==e.id)>=0?Na(Na({},e),{},{isCheck:!0}):Na(Na({},e),{},{isCheck:!1}))),this.setState({itemList:a})}),Fe()(this,"handleClick",(e,t)=>{let a=this.state.itemList.map(e=>e.id==t.id?(console.log(Na(Na({},e),{},{isCheck:!e.isCheck})),Na(Na({},e),{},{isCheck:!e.isCheck})):e),n=this.state.selectedItem.slice(),s=this.state.selectedItem.findIndex(e=>e.id==t.id);s<0?n.push(t):n.splice(s,1),this.setState({itemList:a,selectedItem:n}),console.log(this.state)}),Fe()(this,"onClickRow",e=>{this.setState({selectedValue:[...this.state.selectedValue,e.id],selectedItem:[...this.state.selectedItem,e]})}),Fe()(this,"search",e=>{this.setState({text:e},()=>this.updatePageData())}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:[],text:"",itemList:[],selectedValue:[]}}componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props;this.setState({selectedValue:e.id,selectedItem:e})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s}=this.state;return console.log("state",this.state),i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:Da,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20"},"Chọn đơn vị quản lý")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(Gt,{search:this.search}))),i.a.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},i.a.createElement(qe.a,{data:s,columns:[{title:"Chọn",field:"custom",align:"left",width:"250",render:e=>i.a.createElement(n.Checkbox,{name:"radSelected",value:e.id,checked:e.isCheck,color:"primary",onClick:t=>this.handleClick(t,e)})},{title:"Tên",field:"displayName",width:"150"},{title:"Tài khoản",field:"userName",width:"150"}],onRowClick:(e,t)=>this.onClickRow(t),options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e()},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Chọn")))}}var Aa=ja;function Ma(e){const{formik:t,field:a,size:o,required:r,variant:l,label:c,disabled:d,classes:m,tree:u}=e,[h,p]=i.a.useState(!1),[g,f]=i.a.useState(t.values[a]),[v,b]=i.a.useState("");return Object(s.useEffect)(()=>{if(t.values[a]=g,g){let e=g.map(e=>e.displayName);b(e.join(", "))}},[g]),Object(s.useEffect)(()=>{f(t.values[a])},[t.values,a,g]),i.a.createElement("div",{className:"input-popup-container"},i.a.createElement(n.TextField,{disabled:!0,fullWidth:!0,classes:m,id:a,size:o,name:a,label:c,value:v,onChange:t.handleChange,required:!0,variant:l,error:t.touched[a]&&Boolean(t.errors[a]),helperText:t.touched[a]&&t.errors[a]}),!d&&i.a.createElement(n.Button,{size:"small",className:"btn btn-primary-d",style:{float:"right",height:"100%"},variant:"contained",onClick:()=>p(!0)},"Chọn"),h&&i.a.createElement(Aa,{open:h,handleSelect:e=>{p(!1),f(e)},selectedItem:g||[],handleClose:()=>p(!1)}))}a(2263);var Ua=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner/searchByPage";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner/update/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner/create";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner/getOne/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner/delete/"+e;return v.a.delete(a)}async checkCode(e,t){var a=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+a;const n={params:{id:e,code:t}};var s=y.a.API_ENPOINT+"/api/practitioner/checkDuplicateCode";return v.a.get(s,n)}async getUserNameByLogin(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/practitioner/getUserName";return v.a.get(t)}async acceptInviteRoom(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;var a=y.a.API_ENPOINT+"/api/practitioner/acceptInviteRoom/"+e+"/"+t;return v.a.get(a)}async getPractitionerByUsername(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner/getPractitionerByUsername/"+e;return v.a.get(a)}};function La(e){return i.a.createElement(vt.a,e)}class Fa extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Ua.searchByPage(e),{selectedItem:a}=this.state,n=t.data.content,s=a;if(s&&s.length>0)for(let e=0;e<n.length;e++)for(let t=0;t<s.length;t++)if(n[e].id==s[t].id){let t={checked:!0};n[e].tableData=t;break}this.setState({itemList:n,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleRowClick",(e,t)=>{e.persist();let{selectedItem:a,itemList:n}=this.state,s=n;const i=s.indexOf(t);s[i].tableData.checked=!s[i].tableData.checked;let o=a;s[i].tableData.checked?o.push(s[i]):o=o.filter(e=>e.id!==s[i].id),this.setState({itemList:s,selectedItem:o})}),Fe()(this,"handleClickCheckBox",e=>{var t;let{selectedItem:a,itemList:n}=this.state,s=n;const i=s.indexOf(e);let o=a;null!==(t=s[i])&&void 0!==t&&t.tableData.checked?o.push(s[i]):o=o.filter(e=>{var t;return e.id!==(null===(t=s[i])||void 0===t?void 0:t.id)}),this.setState({itemList:s,selectedItem:o})}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:{},item:null,itemList:[],selectedValue:"",text:""}}async componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props,t=[];e&&e.length>0&&e.forEach(e=>{t.push(e.practitioner)}),this.setState({selectedItem:t})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s,text:o}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:La,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{className:"dialog-header",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",null,"Bác sĩ điều trị")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:o,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(qe.a,{data:s,columns:[{title:"Chọn",field:"custom",render:e=>{var t;return i.a.createElement(n.Checkbox,{checked:null==e||null===(t=e.tableData)||void 0===t?void 0:t.checked})}},{title:"Họ và tên",field:"displayName"},{title:"Tài khoản",field:"userName"},{title:"Ngày sinh",field:"birthDate",render:e=>e.birthDate?i.a.createElement("span",null,Te()(e.birthDate).format("DD/MM/YYYY")):""},{title:"Giới tính",field:"gender"},{title:"Số điện thoại",field:"phoneNumber"},{title:"Email",field:"email"}],onRowClick:this.handleRowClick,onSelectionChange:(e,t)=>{this.handleClickCheckBox(t)},options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,sorting:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page})))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e()},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Chọn")))}}var Ba=Fa;function Va(e){const{formik:t,field:a,size:o,required:r,variant:l,label:c,disabled:d,classes:m}=e,[u,h]=i.a.useState(!1),[p,g]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{t.values[a]=p},[p]),Object(s.useEffect)(()=>{g(t.values[a])},[t.values,a,p]),i.a.createElement("div",{className:""},!d&&i.a.createElement(n.Button,{className:"btn btn-primary",variant:"contained",color:"primary",onClick:()=>h(!0)},"Chọn bác sĩ"),u&&i.a.createElement(Ba,{open:u,handleSelect:e=>{if(e&&e.length>0){let a=[];e.forEach(e=>{a.push({practitioner:e})}),g(a),t.setFieldValue("items",a),h(!1)}else Ce.toast.warning("Chưa chọn dữ liệu",Oe.a.TOAST_CONFIGURE)},selectedItem:p||[],handleClose:()=>h(!1)}))}var Ga=new class{async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/regimen/searchByDto";return v.a.post(a,e)}async searchByDtoRegimentDrug(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/regimen-drug/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/regimen/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/regimen";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/regimen/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/regimen/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/regimen/checkCode";return v.a.post(a,e)}},za=a(316),Wa=a.n(za);function Ha(e){return i.a.createElement(vt.a,e)}class Ka extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,regimenId:this.state.regimenId},t=await Ga.searchByDtoRegimentDrug(e),a=await Ga.searchByDto({pageIndex:1,pageSize:999,text:""});this.setState({itemList:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,regimenSelect:a.data.content})}),Fe()(this,"renderRegimentType",e=>{let t="",a=Oe.a.REGIMENT_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"getRegimentType",async()=>{}),Fe()(this,"handleClick",(e,t)=>{null==this.state.selectedValue?this.setState({selectedValue:t.id,selectedItem:t}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"onClickRow",e=>{null==this.state.selectedValue?this.setState({selectedValue:e.id,selectedItem:e}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"search",e=>{this.setState({text:e},()=>this.updatePageData())}),Fe()(this,"onChangeRegimen",e=>{this.setState({regimenId:e.id},()=>{this.updatePageData()})}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:{},text:"",itemList:[],selectedValue:"",regimenId:null,regimenSelect:[]}}componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props;this.setState({selectedValue:e.id,selectedItem:e})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:Ha,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20"},"Chọn phác đồ")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:4},i.a.createElement(p.a,{id:"combo-box-demo",options:this.state.regimenSelect,getOptionLabel:e=>e.name,onChange:(e,t)=>{this.onChangeRegimen(t)},fullWidth:!0,renderInput:e=>i.a.createElement(Wa.a,u()({},e,{label:"Phác đồ",variant:"outlined",size:"small"}))})),i.a.createElement(n.Grid,{item:!0,xs:4}),i.a.createElement(n.Grid,{item:!0,xs:4},i.a.createElement(Gt,{search:this.search}))),i.a.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},i.a.createElement(qe.a,{data:s,columns:[{title:"Chọn",field:"custom",align:"left",headerStyle:{minWidth:"60px",maxWidth:"70px"},cellStyle:{minWidth:"60px",maxWidth:"70px"},render:e=>i.a.createElement(n.Radio,{id:"radio"+e.id,name:"radSelected",value:e.id,checked:this.state.selectedValue===e.id,onClick:t=>this.handleClick(t,e)})},{title:"Tên thuốc",field:"drug.code",width:"150",headerStyle:{minWidth:"60px",maxWidth:"100px"},cellStyle:{minWidth:"60px",maxWidth:"100px"}},{title:"Phác đồ",field:"regimen.name",width:"350",headerStyle:{minWidth:"350px",maxWidth:"350px"},cellStyle:{minWidth:"350px",maxWidth:"350px"}}],onRowClick:(e,t)=>this.onClickRow(t),options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e(),style:{marginRight:"12px"}},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Chọn")))}}var qa=Ka;a(2264);function Ya(e){return i.a.createElement(vt.a,e)}class $a extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{this.state.page,this.state.rowsPerPage}),Fe()(this,"handleClick",(e,t)=>{null==this.state.selectedValue?this.setState({selectedValue:t.id,selectedItem:t}):this.setState({selectedValue:null,selectedItem:null})}),Fe()(this,"onClickRow",e=>{null==this.state.selectedValue?this.setState({selectedValue:e.id,selectedItem:e}):this.setState({selectedValue:null,selectedItem:null})}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:{id:""},text:"",itemList:[],selectedValue:""}}componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props;this.setState({selectedValue:e.id,selectedItem:e})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:Ya,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20"},"Select Treatment Period")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(qe.a,{data:s,columns:[{title:"Select",field:"custom",align:"left",width:"250",render:e=>i.a.createElement(n.Radio,{id:"radio"+e.id,name:"radSelected",value:e.id,checked:this.state.selectedValue===e.id,onClick:t=>this.handleClick(t,e)})},{title:"Ngày thăm khám",field:"encounterDate",align:"left",width:"150",render:e=>e.encounterDate?i.a.createElement("span",null,Te()(e.encounterDate).format("DD/MM/YYYY")):""},{title:"Giai đoạn điều trị",field:"treatmentPeriod.name",width:"150"}],onRowClick:(e,t)=>this.onClickRow(t),options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e()},"Cancel"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Select")))}}var Ja=$a;function Qa(e){const{formik:t,field:a,size:o,required:r,variant:l,label:c,disabled:d,classes:m,tree:u}=e,[h,p]=i.a.useState(!1),[g,f]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{t.values[a]=g},[g]),Object(s.useEffect)(()=>{f(t.values[a])},[t.values,a,g]),i.a.createElement("div",{className:"input-popup-container"},i.a.createElement(n.TextField,{disabled:!0,fullWidth:!0,classes:m,id:a,size:o,name:a,label:c,value:g&&g.name?g.name:"",onChange:t.handleChange,required:!0,variant:l,error:t.touched[a]&&Boolean(t.errors[a]),helperText:t.touched[a]&&t.errors[a]}),!d&&i.a.createElement(n.Button,{size:"small",className:"btn btn-primary-d",style:{float:"right"},variant:"contained",onClick:()=>p(!0)},"Select"),h&&i.a.createElement(Ja,{open:h,handleSelect:e=>{p(!1),f(e)},selectedItem:g||{},handleClose:()=>p(!1)}))}const Xa=Object(n.makeStyles)(e=>({root:{}}));function Za(e){const t=Xa(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Mã",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Tên",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(z,{formik:l,optionList:y.a.ADMINISTRATIVE_UNIT_LEVEL,variant:"outlined",field:"level",label:"Cấp đơn vị",size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(Kt,{label:"Đơn vị quản lý",formik:l,field:"parent",variant:"outlined",size:"small"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",loading:e.loading,type:"submit"},"Lưu"))))))}function en(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function tn(e){return i.a.createElement(vt.a,e)}class an extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{this.setState({loading:!0});let{handleClose:t}=this.props,{id:a}=this.state,n={id:a,name:e.name,code:e.code,level:e.level,parent:e.parent};_.checkCode(n).then(e=>{let{data:s}=e;s?Ce.toast.warning("Mã đơn vị hành chính đã tồn tại",Oe.a.TOAST_CONFIGURE):a?_.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):_.create(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}).finally(()=>{this.setState({loading:!1})})}),this.state={id:"",name:"",code:"",level:null,parent:{},loading:!1}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?en(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):en(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){var e;let{name:t,code:a,parent:s,level:o}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:tn,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Chỉnh sửa Đơn vị hành chính":"Thêm mới Đơn vị hành chính"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Za,{initialValues:{name:t||"",code:a||"",level:o||null,parent:s||{}},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,loading:this.state.loading}))}}var nn=a(1228),sn=a.n(nn),on=a(411),rn=a.n(on),ln=a(1227),cn=a.n(ln);const dn={SortArrow:Object(s.forwardRef)((e,t)=>React.createElement(cn.a,u()({},e,{ref:t})))};var mn=a(152),un=a.n(mn);class hn extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await _.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{_.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"renderLevel",e=>{let t="";return y.a.ADMINISTRATIVE_UNIT_LEVEL.map(a=>{a.value==e&&(t=a.name)}),t}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1,item:null,id:"",listEncounter:[],loading:!1}}async componentDidMount(){this.updatePageData(),this.setState({tableHeight:window.innerHeight-275})}render(){let{item:e,shouldOpenEditorDialog:t,shouldOpenConfirmationDialog:a,shouldOpenConfirmationDeleteListDialog:s,text:o}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Đơn vị hành chính"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement(sn.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:o,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),i.a.createElement(n.Grid,{item:!0,md:10},t&&i.a.createElement(an,{handleClose:this.handleClose,open:t,item:e}),a&&i.a.createElement(l,{open:a,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"})),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã",field:"code",align:"left",width:"150"},{title:"Tên",field:"name",width:"150"},{title:"Cấp hành chính",field:"level",width:"150",render:e=>this.renderLevel(e.level)},{title:"Đơn vị quản lý",field:"parent.name",width:"150"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await _.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(rn.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qt.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},icons:dn,localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var pn=e=>s.createElement(hn,null),gn=a(100);var fn=new class{constructor(){Fe()(this,"isAdmin",()=>{let e=JSON.parse(localStorage.getItem("userRoles"));return!!e&&e.ROLE_ADMIN}),Fe()(this,"isUser",()=>{let e=JSON.parse(localStorage.getItem("userRoles"));return!!e&&e.ROLE_USER}),Fe()(this,"isPatient",()=>{let e=JSON.parse(localStorage.getItem("userRoles"));return!!e&&e.ROLE_PATIENT}),Fe()(this,"isDrugStore",()=>{let e=JSON.parse(localStorage.getItem("userRoles"));return!!e&&e.ROLE_DRUG_STORE}),Fe()(this,"isLab",()=>{let e=JSON.parse(localStorage.getItem("userRoles"));return!!e&&e.ROLE_LAB}),Fe()(this,"isPractitioner",()=>{let e=JSON.parse(localStorage.getItem("userRoles"));return!!e&&e.ROLE_PRACTITIONER}),Fe()(this,"isClinic",()=>{let e=JSON.parse(localStorage.getItem("userRoles"));return!!e&&e.ROLE_CLINIC})}};function vn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function bn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?vn(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):vn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function yn(e){var t,a,o;const{item:r}=e,[l,c]=Object(s.useState)([]),[d,m]=Object(s.useState)([]),[h,p]=Object(s.useState)([]);Object(s.useEffect)(()=>{var t;if(g(),null!==(t=e.item)&&void 0!==t&&t.practitioners){var a,n;let t=null===(a=e.item)||void 0===a||null===(n=a.practitioners[0])||void 0===n?void 0:n.practitioner;p(t),e.setFieldValue("practitioners",t)}},[]),Object(s.useEffect)(()=>{f()},[e.listEncounterSlot]);const g=async()=>{await Ua.searchByPage({pageIndex:1,pageSize:1e3,getAllEntity:!1}).then(e=>{let{data:t}=e;t&&m(t.content)})},f=()=>{let t=e.listEncounterSlot,a=t.findIndex(t=>t.id===e.item.slot.id);-1!==a&&(t[a]=bn(bn({},t[a]),{},{isBooked:!0})),c([...t]),console.log(t)};return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement("div",{className:"selected-date-text text-primary"},Te()(e.item.start).locale("vi").format("dddd, DD MMM")),i.a.createElement("div",{className:"text-warning",style:{fontSize:"1.5rem"}},`${Te()(null==r||null===(t=r.slot)||void 0===t?void 0:t.start).format("HH:mm")} - ${Te()(null==r||null===(a=r.slot)||void 0===a?void 0:a.end).format("HH:mm")}`)),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement("div",{className:"selected-date-text text-primary"},null==r||null===(o=r.patient)||void 0===o?void 0:o.displayName)),i.a.createElement(n.Grid,{item:!0,sm:12,xs:12},i.a.createElement(Se.Autocomplete,{value:h,size:"medium",id:"practitioners",options:d,getOptionLabel:e=>e.displayName?e.displayName:"",getOptionSelected:(e,t)=>e.id===t.id,onChange:(t,a)=>{p(a),e.setFieldValue("practitioners",a)},renderInput:e=>i.a.createElement(n.TextField,u()({},e,{size:"small",variant:"outlined",label:"Chọn bác sĩ",placeholder:"Chọn bác sĩ"}))}))))))}var En=new class{async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/"+e.id;return v.a.put(a,e)}async changeOfAppointment(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/changeOfAppointment/"+e.id;return v.a.put(a,e)}async generateEncounterSlot(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter-slot/generateEncounterSlot";return v.a.post(a,e)}async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter-slot/searchByDto";return v.a.post(a,e)}};function _n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Sn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_n(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Cn(e){return i.a.createElement(vt.a,e)}function wn(e){const[t,a]=Object(s.useState)([]),[o,r]=Object(s.useState)(null),[l,c]=Object(s.useState)(!1);Object(s.useEffect)(()=>{var t;d(null===(t=e.item)||void 0===t?void 0:t.start),o||Ot.getAllInfoByUserLogin().then(e=>{let{data:t}=e;r(t)})},[]);const d=async e=>{let t={currentDate:e};null!=e?await En.generateEncounterSlot(t).then(e=>{let{data:t}=e;a(t)}):Ce.toast.warning("Bạn chưa chọn lịch",Oe.a.TOAST_CONFIGURE)},m=Ye.object().shape({});return i.a.createElement(n.Dialog,{className:"dialog-container",open:e.open,PaperComponent:Cn,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," Đặt lịch "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>e.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Y.Formik,{initialValues:e.item,validationSchema:m,onSubmit:async t=>{var a,n;let s=Sn(Sn({},e.item),{},{encounterId:null===(a=t.encounter)||void 0===a?void 0:a.id,patientId:null===(n=t.patient)||void 0===n?void 0:n.id,slot:t.slot,practitioners:[{practitioner:t.practitioners}]});null!=t.slot?(c(!0),s.id?await En.update(s).then(()=>{Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE),e.handleClose()}):await En.create(s).then(()=>{e.handleClose(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})):Ce.toast.warning("Bạn chưa chọn ca",Oe.a.TOAST_CONFIGURE)}},e=>{let{errors:a,touched:s,setFieldValue:o,values:r}=e;return i.a.createElement(Y.Form,null,i.a.createElement(n.DialogContent,null,i.a.createElement(yn,{listEncounterSlot:t,item:r,setFieldValue:o})),i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",loadng:l,type:"submit"},"Lưu")))}))}var On=a(97);function xn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Rn(e){return i.a.createElement(vt.a,e)}class kn extends i.a.Component{constructor(e){super(e)}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){const e=On.getComponent("structures.GlobitsRoomView");let{_roomView:t,onRegistered:a,threepidInvite:s,currentRoomId:o,roomOobData:r,resizeNotifier:l,roomJustCreatedOpts:c,handleClose:d}=this.props;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Rn,fullWidth:!0,maxWidth:"md"},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.IconButton,{style:{position:"absolute",right:"10px",top:"10px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"})),i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement("div",{className:"chat-box",style:{display:"contents"}},i.a.createElement(e,{ref:t,onRegistered:a,threepidInvite:s,oobData:r,key:o,roomId:o,resizeNotifier:l,justCreatedOpts:c,style:{padding:"20px"}})))))}}const In=y.a.API_ENPOINT+"/api/patient";var Tn=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/searchByPage";return v.a.post(a,e)}async searchByPrescription(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=In+"/search-by-prescription";return v.a.get(t)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/update/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/create";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/getOne/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/delete/"+e;return v.a.delete(a)}async getUserNameByLogin(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/patient/getUserName";return v.a.get(t)}async sendLinkRequest(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;var a=y.a.API_ENPOINT+"/api/patient/sendLinkRequest/"+e+"/"+t;return v.a.get(a)}async getPatientInfoByPatientId(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/getPatientInfoByPatientId/"+e;return v.a.get(a)}async updateProfileStatus(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/updateProfileStatus";return v.a.put(a,e)}async getFilterList(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/filter-list";return v.a.post(a,e)}async checkDuplicatePatient(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/duplicate-patient-check";return v.a.post(a,e)}};var Pn=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/search";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/"+e;return v.a.delete(a)}async changeStatusApprove(e,t){var a=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+a;let n=y.a.API_ENPOINT+"/api/appointment/update/"+e;return v.a.put(n,{statusApprove:t})}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/checkCode";return v.a.post(a,e)}async getIdEncounterByAppointment(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/getIdEncounterByAppointment/"+e;return v.a.get(a)}async getConversationId(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/getConversationId/"+e;return v.a.get(a)}async getFilterList(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/appointment/filter-list";return v.a.post(a,e)}},Nn=(a(2267),a(2268)),Dn=a.n(Nn),jn=a(568),An=a.n(jn);function Mn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Un(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Mn(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Mn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Ln=Object(n.makeStyles)(e=>({root:{},textCapitalize:{textTransform:"capitalize"}}));function Fn(e){var t,a,o,r,c,d,m,h,p,g,f,v,b,y,E;const _=Ln(),{initialValues:C,handleSubmit:w,handleClose:O}=e,x=Ye.object({}),R=Object(Y.useFormik)({enableReinitialize:!0,initialValues:C,validationSchema:x,onSubmit:e=>{F(!0),w(e)}}),[I,P]=i.a.useState(R.values.items),[N,D]=i.a.useState(!1),[j,A]=i.a.useState([]),[M,U]=Object(s.useState)([]),[L,F]=Object(s.useState)(!1);Object(s.useEffect)(()=>{var e,t;B();let a=null;var n,s;null!=(null===(e=R.values)||void 0===e?void 0:e.practitioners)&&(null===(t=R.values)||void 0===t?void 0:t.practitioners.length)>0&&(a=null===(n=R.values)||void 0===n||null===(s=n.practitioners[0])||void 0===s?void 0:s.practitioner);U(a),R.setFieldValue("practitioners",[{practitioner:a}])},[]),Object(s.useEffect)(()=>{P(R.values.items)},[R.values.items]);Object(s.useEffect)(()=>{},[R.values.currentDate]);const B=()=>{Ua.searchByPage({pageIndex:1,pageSize:1e3}).then(e=>{let{data:t}=e;t&&A(t.content)})};Object(s.useEffect)(()=>{var e,t,a;let n=[];null!==(e=R.values)&&void 0!==e&&e.items&&(null===(t=R.values)||void 0===t||null===(a=t.items)||void 0===a?void 0:a.length)>0&&(n=R.values.items.map(e=>{let t=Te()(null==e?void 0:e.start).format("HH:mm"),a=Te()(null==e?void 0:e.end).format("HH:mm");return Un(Un({},e),{},{name:`${t} - ${a}`})})),P(n)},[R.values.items]);return i.a.createElement("div",{className:_.root},i.a.createElement("form",{className:"form-booking",onSubmit:R.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("span",{style:{color:"#3366ff",fontWeight:"bold"}},"Ngày hẹn: ")," ",i.a.createElement("span",null,(null===(t=R.values)||void 0===t?void 0:t.currentDate)&&Te()(null===(a=R.values)||void 0===a?void 0:a.currentDate).format("DD/MM/YYYY"))),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("span",{style:{color:"#3366ff",fontWeight:"bold"}},"Thời gian khám: "),i.a.createElement("span",null," ",(null===(o=R.values)||void 0===o||null===(r=o.slot)||void 0===r?void 0:r.start)&&Te()(null===(c=R.values)||void 0===c||null===(d=c.slot)||void 0===d?void 0:d.start).format("HH:mm")," - ",(null===(m=R.values)||void 0===m||null===(h=m.slot)||void 0===h?void 0:h.end)&&Te()(null===(p=R.values)||void 0===p||null===(g=p.slot)||void 0===g?void 0:g.end).format("HH:mm"))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a,locale:Dn.a},i.a.createElement(k.DatePicker,{autoOk:!0,id:"currentDate",name:"currentDate",label:"Chọn ngày khám",orientation:"landscape",format:"dd/MM/yyyy",variant:"static",disablePast:!0,openTo:"date",value:null===(f=R.values)||void 0===f?void 0:f.currentDate,onChange:e=>(async e=>{await R.setFieldValue("currentDate",e)})(e)}))),i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:12,xs:12},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement("h2",{className:_.textCapitalize+" selected-date-text text-primary"},Te()(null===(v=R.values)||void 0===v?void 0:v.currentDate).locale("vi").format("dddd, DD MMM"))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12,style:{margin:"auto"}},i.a.createElement("div",{className:"selected-date-text text-primary"},null===(b=R.values)||void 0===b||null===(y=b.patient)||void 0===y?void 0:y.displayName)),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12,style:{margin:"auto"}},i.a.createElement(Se.Autocomplete,{value:M,size:"medium",id:"practitioners",options:j,getOptionLabel:e=>e.displayName?e.displayName:"",getOptionSelected:(e,t)=>e.id===t.id,onChange:(e,t)=>{U(t),R.setFieldValue("practitioners",[{practitioner:t}])},renderInput:e=>i.a.createElement(n.TextField,u()({},e,{size:"small",variant:"outlined",label:"Bác sĩ",placeholder:"Bác sĩ"}))})),i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(z,{formik:R,label:"Dịch vụ khám",value:R.values.place,field:"place",size:"small",variant:"outlined",optionList:Oe.a.APPOINTMENT_PLACE})),i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(Se.Autocomplete,{id:"slot",options:I||[],getOptionLabel:e=>e.name,onChange:(e,t)=>{R.setFieldValue("slot",t)},value:null===(E=R.values)||void 0===E?void 0:E.slot,size:"small",renderInput:e=>i.a.createElement(n.TextField,u()({className:"font-inherit",label:"Lựa chọn ca khám",fullWidth:!0,size:"small",variant:"outlined"},e)),getOptionSelected:(e,t)=>t.id===e.id})),i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(S,{formik:R,field:"reason",size:"small",label:"Lý do đổi lịch",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,className:"p-0",xs:12},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(An.a,null),variant:"contained",className:"btn btn-primary d-inline-flex",color:"primary",style:{width:"100%"},onClick:()=>D(!0)},"Đặt lịch")))))),N&&i.a.createElement(l,{open:N,onConfirmDialogClose:()=>{D(!1)},onYesClick:()=>{R.handleSubmit()},title:"Xác nhận",text:"Bạn có muốn thay đổi lịch hẹn này không?",agree:"Đồng ý",cancel:"Hủy"})))))}function Bn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Vn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Bn(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Bn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Gn(e){return i.a.createElement(vt.a,e)}class zn extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"handleFormSubmit",e=>{var t;let{patientId:a,encounter:n}=this.state,s=null;null!=n&&null!=n.id&&(s=n.id);let i={id:this.state.id,start:e.currentDate,end:e.currentDate,conferenceId:e.conferenceId,appointmentType:e.appointmentType,patient:e.patient,encounterId:s,patientId:null===(t=e.patient)||void 0===t?void 0:t.id,slot:e.slot,place:e.place,practitioners:e.practitioners,reason:e.reason};null!=e.slot?i.id&&En.changeOfAppointment(i).then(()=>{this.props.handleClose(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):Ce.toast.warning("Bạn chưa chọn ca",Oe.a.TOAST_CONFIGURE)}),this.state={start:null,end:null,conferenceId:"",appointmentType:null,practitioners:[],patientId:"",patient:{},currentDate:new Date,items:[],slot:{},encounterId:null,encounter:{},place:null,id:null,reason:null,practitioner:{id:""}}}componentDidMount(){let e=this.props.item,{currentDate:t}=this.state;if(null!=e&&e.start&&(t=null==e?void 0:e.start),e){var a,n;let t=Te()(null==e||null===(a=e.slot)||void 0===a?void 0:a.start).format("HH:mm"),s=Te()(null==e||null===(n=e.slot)||void 0===n?void 0:n.end).format("HH:mm");this.setState(Vn(Vn({},e),{},{slot:Vn(Vn({},null==e?void 0:e.slot),{},{name:`${t} - ${s}`})}))}En.searchByDto({pageIndex:0,pageSize:100}).then(e=>{let{data:t}=e;this.setState({items:t.content})})}render(){return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Gn,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},"Thay đổi lịch hẹn"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Fn,{initialValues:{id:this.state.id,start:this.state.start,end:this.state.end,conferenceId:this.state.conferenceId,appointmentType:this.state.appointmentType,practitioners:this.state.practitioners,currentDate:this.state.currentDate,items:this.state.items,slot:this.state.slot,place:this.state.place,patient:this.state.patient,reason:this.state.reason},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose}))}}var Wn=a(102),Hn=a.n(Wn);class Kn extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page+1,pageSize:this.state.rowsPerPage,text:this.state.text,currentDate:this.state.date,patientId:this.state.patientId,slotId:this.state.slotId,fromDate:this.state.fromDate,toDate:this.state.toDate,fromStartDate:this.state.fromStartDate,toStartDate:this.state.toStartDate,listStatus:this.state.listStatus,practitioners:this.state.practitioners,indexNumber:this.state.indexNumber,place:this.state.place,displayName:this.state.displayName,patientCode:this.state.patientCode};this.setState({loadingTable:!0});let t=await Pn.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalElements,loadingTable:!1})}),Fe()(this,"viewFilePatient",e=>{this.setState({shouldViewFilePatient:!0,idFilePatientOpen:e})}),Fe()(this,"handleViewPatientFileClose",()=>{this.setState({shouldViewFilePatient:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenBookingDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationChangeStatusDialog:!1,shouldOpenConfirmationDialogConnect:!1,shouldOpenChatDialog:!1,shouldOpenChangeAppointmentDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenBookingDialog:!0})}),Fe()(this,"handleChangeAppointment",e=>{this.setState({item:e,shouldOpenChangeAppointmentDialog:!0})}),Fe()(this,"getListAppointment",()=>{this.setState({fromDate:null,toDate:null,fromStartDate:null,toStartDate:null},()=>this.updatePageData())}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{Pn.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleConfirmChangeStatusItem",()=>{Pn.changeStatusApprove(this.state.id,this.state.statusApprove).then(()=>{this.handleClose(),Ce.toast.success("Thành công",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"onChangePractitioner",(e,t,a)=>{this.setState({practitioners:t?t.id:t},()=>this.updatePageData())}),Fe()(this,"onChangeIndexExam",e=>{this.setState({patientCode:e.target.value?e.target.value:null})}),Fe()(this,"onChangePlaceService",e=>{this.setState({displayName:e.target.value?e.target.value:null})}),Fe()(this,"filter",()=>{this.setState({page:0},()=>this.updatePageData())}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleChangeStatus",(e,t)=>{this.setState({id:e,statusApprove:t,shouldOpenConfirmationChangeStatusDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleEncounter",async e=>{var t;let a=await Pn.getIdEncounterByAppointment(e.id);this.props.history.push({pathname:y.a.ROOT_PATH+"medical-examination/"+(null==a?void 0:a.data),state:{patientId:null==e||null===(t=e.patient)||void 0===t?void 0:t.id}})}),Fe()(this,"handleViewPatient",async(e,t)=>{await Tn.getOneById(e)&&this.props.history.push({pathname:y.a.ROOT_PATH+"medical-record/"+e+"/1"})}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e,shouldOpenChatDialog:!0})}),Fe()(this,"handleSendRequest",e=>{this.setState({shouldOpenConfirmationDialogConnect:!0,ppId:e})}),Fe()(this,"confirmSendLinkRequest",async()=>{this.setState({waitSendRequest:!0},()=>{this.state.waitSendRequest&&Pn.getConversationId(this.state.ppId).then(()=>{this.setState({waitSendRequest:!1}),this.handleClose(),Ce.toast.success("Xác nhận kết nối thành công",Oe.a.TOAST_CONFIGURE)}).catch(()=>{this.setState({waitSendRequest:!1}),this.handleClose(),Ce.toast.error("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})})}),Fe()(this,"optionList",[{value:1,name:"Lần 1"},{value:2,name:"Lần 2"},{value:3,name:"Lần 3"},{value:4,name:"Lần 4"},{value:5,name:"Lần 5"}]),Fe()(this,"renderAdminUnit",e=>{var t;const{classes:a}=this.props;let n="",s="";var o,r,l;null!=e&&e.parent&&(s=null==e||null===(o=e.parent)||void 0===o?void 0:o.name);null!=e&&null!==(t=e.parent)&&void 0!==t&&t.parent&&(n=null==e||null===(r=e.parent)||void 0===r||null===(l=r.parent)||void 0===l?void 0:l.name);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,n),i.a.createElement("div",{className:a.detail+" "},s))}),Fe()(this,"handleChangeRowsPerPage",e=>{this.setState({rowsPerPage:parseInt(e.target.value,10),page:0},()=>{this.updatePageData()})}),this.state={data:[],text:"",rowsPerPage:10,page:0,totalPages:null,totalElements:null,shouldOpenBookingDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationChangeStatusDialog:!1,item:null,id:"",listEncounter:[],listPatient:[],listSlot:[],date:null,shouldOpenConfirmationDialogConnect:!1,status:null,listStatus:[],waitSendRequest:!1,shouldOpenChangeAppointmentDialog:!1,openFilter:!1,listPractitioner:[],listIndexExam:[],listPlaceService:[],loadingTable:!1,shouldViewFilePatient:!1,idFilePatientOpen:"",statusApprove:-1}}async componentDidMount(){this.getListAppointment(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),window.innerHeight<750?this.setState({tableHeight:600}):this.setState({tableHeight:window.innerHeight-400})}render(){const{classes:e}=this.props;let{item:t,shouldOpenBookingDialog:a,shouldOpenConfirmationDialog:s,shouldOpenConfirmationChangeStatusDialog:o,text:r,listPatient:c,patient:d,date:m,listSlot:u,slot:h,shouldOpenChatDialog:p,currentRoomId:g,shouldOpenConfirmationDialogConnect:f,shouldViewFilePatient:v,idFilePatientOpen:b}=this.state,{_roomView:y,onRegistered:E,threepidInvite:_,roomOobData:S,resizeNotifier:C,roomJustCreatedOpts:w}=this.props;return i.a.createElement("div",{className:Hn()(e.contentPadding,"scroll")},i.a.createElement(n.Box,{className:e.filter},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:12},i.a.createElement("p",{className:e.filterTitle},"Tên khách hàng"),i.a.createElement(n.TextField,{className:"textField",variant:"outlined",placeholder:"Tên khách hàng",onChange:this.onChangePlaceService})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:12},i.a.createElement("p",{className:e.filterTitle},"Thời gian tái khám từ ngày"),i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,{className:"textField",fullWidth:!0,id:"date-filter",name:"date-filter",autoOk:!0,variant:"inline",inputVariant:"outlined",placeholder:"DD /MM /YYYY",format:"dd/MM/yyyy",size:"small",InputAdornmentProps:{position:"end"},onChange:e=>{this.setState({fromStartDate:e})},value:this.state.fromStartDate}))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:12},i.a.createElement("p",{className:e.filterTitle},"Đến ngày"),i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,{className:"textField",fullWidth:!0,id:"date-filter",name:"date-filter",autoOk:!0,variant:"inline",inputVariant:"outlined",placeholder:"DD /MM /YYYY",format:"dd/MM/yyyy",size:"small",InputAdornmentProps:{position:"end"},onChange:e=>{this.setState({toStartDate:e})},value:this.state.toStartDate}))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:12},i.a.createElement("p",{className:e.filterTitle},"Mã khách hàng"),i.a.createElement(n.TextField,{className:"textField",variant:"outlined",placeholder:"Mã khách hàng",onChange:this.onChangeIndexExam})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:12},i.a.createElement("p",{className:e.filterTitle},"Thời gian yêu cầu từ ngày"),i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,{className:"textField",fullWidth:!0,id:"date-filter",name:"date-filter",autoOk:!0,variant:"inline",inputVariant:"outlined",placeholder:"DD /MM /YYYY",format:"dd/MM/yyyy",size:"small",InputAdornmentProps:{position:"end"},onChange:e=>{this.setState({fromDate:e})},value:this.state.fromDate}))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:12},i.a.createElement("p",{className:e.filterTitle},"Đến ngày"),i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,{className:"textField",fullWidth:!0,id:"date-filter",name:"date-filter",autoOk:!0,variant:"inline",inputVariant:"outlined",placeholder:"DD /MM /YYYY",format:"dd/MM/yyyy",size:"small",InputAdornmentProps:{position:"end"},onChange:e=>{this.setState({toDate:e})},value:this.state.toDate}))),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("button",{className:e.button,onClick:this.filter},i.a.createElement("img",{src:"themes/element/img/SVG/Icon_search.svg",alt:"search"}),i.a.createElement("span",{className:e.lineHeight},"Tìm kiếm"))))),i.a.createElement(n.Grid,{container:!0,spacing:2},this.state.shouldOpenBookingDialog&&i.a.createElement(wn,{handleClose:this.handleClose,open:this.state.shouldOpenBookingDialog,item:this.state.item}),this.state.shouldOpenChangeAppointmentDialog&&i.a.createElement(zn,{handleClose:this.handleClose,open:this.state.shouldOpenChangeAppointmentDialog,item:this.state.item}),s&&i.a.createElement(l,{open:s,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),o&&i.a.createElement(l,{open:o,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmChangeStatusItem,title:"Xác nhận",text:1==this.state.statusApprove?"Bạn có muốn phê duyệt lịch khám này?":"Bạn có muốn từ chối lịch khám này?",agree:"Đồng ý",cancel:"Hủy"}),p&&i.a.createElement(kn,{handleClose:this.handleClose,open:p,item:t,ref:y,onRegistered:E,threepidInvite:_,roomOobData:S,currentRoomId:g,resizeNotifier:C,roomJustCreatedOpts:w}),f&&i.a.createElement(l,{open:f,onConfirmDialogClose:this.handleClose,onYesClick:this.confirmSendLinkRequest,loading:this.state.waitSendRequest,title:"Xác nhận",text:"Xác nhận yêu cầu kết nối?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12,className:"table-list-customer"},(fn.isAdmin()||fn.isClinic())&&i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Mã khách hàng",field:"patient.code",align:"left",width:"50"},{title:"Họ tên",field:"patient.displayName",align:"left",width:"150"},{title:"Ngày tái khám",field:"start",width:"50",render:e=>{let t=null;return e.start&&(t=i.a.createElement(i.a.Fragment,null,""+(null!=e&&e.start&&2==(null==e?void 0:e.appointmentType)?Te()(null==e?void 0:e.start).format("DD/MM/YYYY"):""))),t}},{title:"Ngày yêu cầu thay đổi",field:"requestDate",width:"50",render:e=>{let t=null;return e.requestDate&&(t=i.a.createElement(i.a.Fragment,null,""+(null!=e&&e.requestDate?Te()(null==e?void 0:e.requestDate).format("DD/MM/YYYY"):""))),t}},{title:"Lý do thay đổi",field:"reason",align:"left",width:"200"},{title:"Loại khám",field:"appointmentType",align:"left",width:"200",render:e=>{let t=null;return e.appointmentType&&(t=i.a.createElement(i.a.Fragment,null,""+(2==(null==e?void 0:e.appointmentType)?"Tái khám":"Khám tình huống"))),t}},{title:"Trạng thái",field:"status",align:"left",width:"200",render:e=>i.a.createElement(i.a.Fragment,null,-1==e.status&&i.a.createElement("p",{className:"div__status appointment--notBook"},"Chưa đặt lịch"),0==e.status&&i.a.createElement("p",{className:"div__status customer__list--notActive"},"Chờ xác nhận"),1==e.status&&i.a.createElement("p",{className:"div__status customer__list--Active"},"Chờ khám"),2==e.status&&i.a.createElement("p",{className:"div__status appointment--examined"},"Đã khám"))},{title:"Thao tác",field:"custom",type:"numeric",align:"left",render:t=>{let a=null;return 0==t.status&&t.requestDate&&(a=i.a.createElement(i.a.Fragment,null,i.a.createElement(_e,{onClick:async()=>{this.handleChangeStatus(t.id,1)},sx:{m:2},className:"custom-btn primary-button mr-8"},i.a.createElement("span",{className:e.lineHeight},"Phê duyệt")))),a}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.5rem"},rowStyle:(e,t)=>({backgroundColor:"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có kết quả"}},style:{overflow:"auto",height:this.state.tableHeight},icons:dn}),i.a.createElement(n.TablePagination,{component:"div",count:this.state.totalPages,rowsPerPageOptions:[1,2,3,5,10,25],page:this.state.page,onPageChange:this.handleChangePage,rowsPerPage:this.state.rowsPerPage,onRowsPerPageChange:this.handleChangeRowsPerPage}))))}}var qn=Object(n.withStyles)(e=>({root:{},ulTable:{listStyle:"none",margin:0,padding:0},contentPadding:{padding:"0 15px"},filter:{margin:"30px 0",background:"#ffffff",borderRadius:"4px",padding:"15px !important",boxShadow:"0px 2px 5px rgba(0, 46, 89, 0.15)"},filterTitle:{fontWeight:700,lineheight:"16px",margin:"0 0 8px 0"},liItem:{},badge:{fontWeight:500,padding:"1rem 1.5rem",borderRadius:"1rem",position:"relative",width:"fit-content",textAlign:"center",background:" rgba(51, 102, 255, 0.1)",color:"#3366ff"},detail:{fontSize:"1.5rem",color:"#3366ff"},button:{display:"flex",alignItems:"center",outline:"none",border:0,padding:"8px 12px",borderRadius:"4px",color:"#fff",background:"linear-gradient(#0E9594, #127475)",margin:"auto"},center:{display:"flex",justifyContent:"center"},lineHeight:{lineHeight:"16px"}}))(Kn);const Yn=Object(n.makeStyles)(e=>({title:{width:"100%",background:"#ffffff",padding:"19px 15px"},icon:{marginRight:e.spacing(.5),color:"#0E9594",fontWeight:400},titleIcon:{fontWeight:700,marginRight:e.spacing(.5),color:"#0E9594"}}));var $n=e=>{const t=Yn();return s.createElement(s.Fragment,null,s.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12,className:Hn()(t.title,"d-inline-flex height-54")},s.createElement(un.a,{fontSize:"large",color:"primary",className:t.icon}),s.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb",separator:"›",className:t.titleIcon},s.createElement("span",{className:t.icon},"Trang chủ"),s.createElement("span",null,"Danh sách đặt lịch"))),s.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},s.createElement(qn,u()({},e,{className:Hn()("mx_ListPage mx_ListPage_default")}))))},Jn=a(138),Qn=a(277),Xn=a(740);class Zn{static fetchJoinedGroups(e){return Object(Xn.a)("GroupActions.fetchJoinedGroups",()=>e.getJoinedGroups(),null)}}var es,ts=a(93),as=a(476),ns=a(119),ss=a(103),is=a(135),os=a(94);let rs=Object(os.a)("views.elements.UserTagTile")(es=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"tagStoreRef",void 0),Fe()(this,"onTagStoreUpdate",()=>{const e=0===Qn.a.getSelectedTags().length;this.setState({selected:e})}),Fe()(this,"onTileClick",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"deselect_tags"})}),this.state={selected:0===Qn.a.getSelectedTags().length}}componentDidMount(){this.tagStoreRef=Qn.a.addListener(this.onTagStoreUpdate)}componentWillUnmount(){this.tagStoreRef.remove()}render(){const e=Hn()({mx_TagTile:!0,mx_TagTile_prototype:!0,mx_TagTile_selected_prototype:this.state.selected,mx_TagTile_home:!0});return i.a.createElement(is.a,{className:e,onClick:this.onTileClick,title:Object(ts.a)("Home")},i.a.createElement("div",{className:"mx_TagTile_avatar"},i.a.createElement("div",{className:"mx_TagTile_homeIcon"})))}})||es;var ls,cs;var ds,ms=Object(os.a)("structures.GroupFilterPanel")((cs=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{orderedTags:[],selectedTags:[]}),Fe()(this,"_onGroupMyMembership",()=>{this.unmounted||gn.a.dispatch(Zn.fetchJoinedGroups(this.context))}),Fe()(this,"_onClientSync",(e,t)=>{"ERROR"!==e&&t!==e&&gn.a.dispatch(Zn.fetchJoinedGroups(this.context))}),Fe()(this,"onMouseDown",e=>{this.state.selectedTags.length>0&&gn.a.dispatch({action:"deselect_tags"})}),Fe()(this,"onClearFilterClick",e=>{gn.a.dispatch({action:"deselect_tags"})})}componentDidMount(){this.unmounted=!1,this.context.on("Group.myMembership",this._onGroupMyMembership),this.context.on("sync",this._onClientSync),this._groupFilterOrderStoreToken=Qn.a.addListener(()=>{this.unmounted||this.setState({orderedTags:Qn.a.getOrderedTags()||[],selectedTags:Qn.a.getSelectedTags()})}),gn.a.dispatch(Zn.fetchJoinedGroups(this.context))}componentWillUnmount(){this.unmounted=!0,this.context.removeListener("Group.myMembership",this._onGroupMyMembership),this.context.removeListener("sync",this._onClientSync),this._groupFilterOrderStoreToken&&this._groupFilterOrderStoreToken.remove()}renderGlobalIcon(){return ss.b.getValue("feature_communities_v2_prototypes")?i.a.createElement("div",null,i.a.createElement(rs,null),i.a.createElement("hr",{className:"mx_GroupFilterPanel_divider"})):null}render(){const e=On.getComponent("elements.DNDTagTile"),t=On.getComponent("elements.ActionButton"),a=this.state.orderedTags.map((t,a)=>i.a.createElement(e,{key:t,tag:t,index:a,selected:this.state.selectedTags.includes(t)})),n=this.state.selectedTags.length>0,s=Hn()("mx_GroupFilterPanel",{mx_GroupFilterPanel_items_selected:n});let o;ss.b.getBetaInfo("feature_spaces")&&!localStorage.getItem("mx_seenSpacesBeta")&&(o=i.a.createElement("div",{className:"mx_BetaDot"}));let r=i.a.createElement(t,{tooltip:!0,label:Object(ts.a)("Communities"),action:"toggle_my_groups",className:"mx_TagTile mx_TagTile_plus"}),l=i.a.createElement(t,{tooltip:!0,label:Object(ts.a)("Home"),action:"view_home_page",className:"mx_TagTile mx_TagTile_plus"}),c=i.a.createElement(t,{tooltip:!0,label:"List Patient",action:"view_list_patient",className:"mx_TagTile mx_TagTile_plus"}),d=i.a.createElement(t,{tooltip:!0,label:"List Page",action:"view_list_page",className:"mx_TagTile mx_TagTile_plus"});return ss.b.getValue("feature_communities_v2_prototypes")&&(r=i.a.createElement(t,{tooltip:!0,label:Object(ts.a)("Create community"),action:"view_create_group",className:"mx_TagTile mx_TagTile_plus"})),i.a.createElement("div",{className:s,onClick:this.onClearFilterClick},i.a.createElement(Jn.a,{className:"mx_GroupFilterPanel_scroller",onMouseDown:this.onMouseDown},i.a.createElement(as.Droppable,{droppableId:"tag-panel-droppable",type:"draggable-TagTile"},(e,t)=>i.a.createElement("div",{className:"mx_GroupFilterPanel_tagTileContainer",ref:e.innerRef},this.renderGlobalIcon(),a,i.a.createElement("div",null,l),i.a.createElement("div",null,c),i.a.createElement("div",null,d),e.placeholder))))}},Fe()(cs,"contextType",ns.a),ls=cs))||ls,us=a(412),hs=a(249);let ps=Object(os.a)("structures.CustomRoomTagPanel")(ds=class extends i.a.Component{constructor(e){super(e),this.state={tags:us.a.getSortedTags()}}componentDidMount(){this._tagStoreToken=us.a.addListener(()=>{this.setState({tags:us.a.getSortedTags()})})}componentWillUnmount(){this._tagStoreToken&&this._tagStoreToken.remove()}render(){const e=this.state.tags.map(e=>i.a.createElement(gs,{tag:e,key:e.name})),t=Hn()("mx_CustomRoomTagPanel",{mx_CustomRoomTagPanel_empty:0===this.state.tags.length});return i.a.createElement("div",{className:t},i.a.createElement("div",{className:"mx_CustomRoomTagPanel_divider"}),i.a.createElement(Jn.a,{className:"mx_CustomRoomTagPanel_scroller"},e))}})||ds;class gs extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onClick",()=>{gn.a.dispatch({action:"select_custom_room_tag",tag:this.props.tag.name})})}render(){const e=On.getComponent("avatars.BaseAvatar"),t=On.getComponent("elements.AccessibleTooltipButton"),a=this.props.tag,n=Hn()({CustomRoomTagPanel_tileSelected:a.selected}),s=a.name,o=a.badgeNotifState;let r;if(o){const e=Hn()({mx_TagTile_badge:!0,mx_TagTile_badgeHighlight:o.hasMentions});r=i.a.createElement("div",{className:e},hs.c(o.count))}return i.a.createElement(t,{className:n,onClick:this.onClick,title:s},i.a.createElement("div",{className:"mx_TagTile_avatar"},i.a.createElement(e,{name:a.avatarLetter,idName:s,width:40,height:40}),r))}}var fs=ps,vs=a(140),bs=a(194),ys=a(174),Es=a(165),_s=a(161),Ss=a(844),Cs=a(99),ws=a(227),Os=a(126);const xs=["groupId","groupAvatarUrl","groupName"];var Rs,ks;let Is=Object(os.a)("views.avatars.GroupAvatar")((ks=class extends i.a.Component{getGroupAvatarUrl(){return this.props.groupAvatarUrl?Object(Os.b)(this.props.groupAvatarUrl).getThumbnailOfSourceHttp(this.props.width,this.props.height,this.props.resizeMethod):null}render(){const e=this.props,{groupId:t,groupAvatarUrl:a,groupName:n}=e,s=te()(e,xs);return i.a.createElement(ws.a,u()({name:n||this.props.groupId[1],idName:this.props.groupId,url:this.getGroupAvatarUrl()},s))}},Fe()(ks,"defaultProps",{width:36,height:36,resizeMethod:"crop"}),Rs=ks))||Rs;var Ts=a(269);class Ps extends i.a.Component{constructor(e){super(e),Fe()(this,"onTileMouseEnter",()=>{this.setState({hover:!0})}),Fe()(this,"onTileMouseLeave",()=>{this.setState({hover:!1})}),this.state={hover:!1}}render(){var e;const t=Hn()({mx_ExtraTile:!0,mx_RoomTile:!0,mx_RoomTile_selected:this.props.isSelected,mx_RoomTile_minimized:this.props.isMinimized});let a;this.props.notificationState&&(a=i.a.createElement(Ts.a,{notification:this.props.notificationState,forceCount:!1}));let n=this.props.displayName;"string"!=typeof n&&(n=""),n=n.replace(":",":​");const s=Hn()({mx_RoomTile_name:!0,mx_RoomTile_nameHasUnreadEvents:null===(e=this.props.notificationState)||void 0===e?void 0:e.isUnread});let o=i.a.createElement("div",{className:"mx_RoomTile_nameContainer"},i.a.createElement("div",{title:n,className:s,tabIndex:-1,dir:"auto"},n));this.props.isMinimized&&(o=null);let r=bs.a;return this.props.isMinimized&&(r=bs.b),i.a.createElement(i.a.Fragment,null,i.a.createElement(r,{className:t,onMouseEnter:this.onTileMouseEnter,onMouseLeave:this.onTileMouseLeave,onClick:this.props.onClick,role:"treeitem",title:this.props.isMinimized?n:void 0},i.a.createElement("div",{className:"mx_RoomTile_avatarContainer"},this.props.avatar),o,i.a.createElement("div",{className:"mx_RoomTile_badgeContainer"},a)))}}var Ns,Ds=a(304),js=a(115),As=a(184),Ms=a(153),Us=a(166),Ls=a(202),Fs=a(108),Bs=a(203),Vs=a(158),Gs=a(175),zs=a(334),Ws=a(167);const Hs=[_s.a.Invite,_s.a.Favourite,_s.a.DM,_s.a.Untagged,_s.a.LowPriority,_s.a.ServerNotice,_s.a.Suggested,_s.a.Archived],Ks=_s.a.LowPriority,qs=[_s.a.DM,_s.a.Untagged],Ys=e=>{(e||gn.a).dispatch({action:"view_create_chat"})},$s=e=>i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Start a Conversation"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_chat"})}}),i.a.createElement(Ls.b,{label:Object(ts.a)("Open dial pad"),iconClassName:"mx_RoomList_iconDialpad",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.OpenDialPad)}})),Js={[_s.a.Invite]:{sectionLabel:Object(ts.b)("Invites"),isInvite:!0,defaultHidden:!1},[_s.a.Favourite]:{sectionLabel:Object(ts.b)("Favourites"),isInvite:!1,defaultHidden:!1},[_s.a.DM]:{sectionLabel:Object(ts.b)("People"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Start chat")},[_s.a.Untagged]:{sectionLabel:Object(ts.b)("Rooms"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Add room"),addRoomContextMenu:e=>{if(Gs.e.instance.activeSpace){const t=Gs.e.instance.activeSpace.currentState.maySendStateEvent(vs.a.SpaceChild,Cs.a.get().getUserId());return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.d)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to create new rooms in this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Add existing room"),iconClassName:"mx_RoomList_iconHash",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.c)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to add rooms to this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Explore rooms"),iconClassName:"mx_RoomList_iconBrowse",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_room"})}}),i.a.createElement(Ls.b,{label:Bs.a.instance.getSelectedCommunityId()?Object(ts.a)("Explore community rooms"):Object(ts.a)("Explore public rooms"),iconClassName:"mx_RoomList_iconExplore",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}},[_s.a.LowPriority]:{sectionLabel:Object(ts.b)("Low priority"),isInvite:!1,defaultHidden:!1},[_s.a.ServerNotice]:{sectionLabel:Object(ts.b)("System Alerts"),isInvite:!1,defaultHidden:!1},[_s.a.Archived]:{sectionLabel:Object(ts.b)("Historical"),isInvite:!1,defaultHidden:!0},[_s.a.Suggested]:{sectionLabel:Object(ts.b)("Suggested Rooms"),isInvite:!1,defaultHidden:!1}};let Qs=Object(os.a)("views.rooms.GlobitsRoomList")(Ns=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"customTagStoreRef",void 0),Fe()(this,"tagAesthetics",void 0),Fe()(this,"roomStoreToken",void 0),Fe()(this,"onRoomViewStoreUpdate",()=>{this.setState({currentRoomId:Es.a.getRoomId()})}),Fe()(this,"onAction",e=>{if(e.action===js.a.ViewRoomDelta){const t=e,a=Es.a.getRoomId(),n=this.getRoomDelta(a,t.delta,t.unread);n&&gn.a.dispatch({action:"view_room",room_id:n.roomId,show_room_tile:!0})}else e.action===js.a.PstnSupportUpdated&&(this.updateDmAddRoomAction(),this.updateLists())}),Fe()(this,"getRoomDelta",(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=ys.b.instance.orderedLists,s=[];Hs.forEach(t=>{let i=n[t];a&&(i=i.filter(t=>{const a=As.a.instance.getRoomState(t);return a.room.roomId===e||a.isUnread})),s.push(...i)});const i=s.findIndex(t=>t.roomId===e),[o]=s.slice((i+t)%s.length);return o})),Fe()(this,"updateSuggestedRooms",e=>{this.setState({suggestedRooms:e})}),Fe()(this,"updateLists",()=>{const e=ys.b.instance.orderedLists;ss.b.getValue("advancedRoomListLogging")&&console.log("new lists",e);const t=Object.keys(this.state.sublists),a=Object.keys(e).filter(e=>!Object(_s.d)(e)||us.a.getTags()[e]),n=!!ys.b.instance.getFirstNameFilterCondition();let s=this.state.isNameFiltering!==n||Object(Ms.d)(t,a);if(!s)for(const t of a){const a=this.state.sublists[t],n=e[t];if(a.length!==n.length){s=!0;break}}if(s){const t=Object(Us.f)(e,a),s=Object(Us.e)(t,(e,t)=>Object(Ms.b)(t));this.setState({sublists:s,isNameFiltering:n})}}),Fe()(this,"onStartChat",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;gn.a.dispatch({action:"view_create_chat",initialText:t})}),Fe()(this,"onExplore",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;gn.a.dispatch({action:js.a.ViewRoomDirectory,initialText:t})}),Fe()(this,"onSpaceInviteClick",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;Object(zs.e)(this.props.activeSpace,t)}),this.state={sublists:{},isNameFiltering:!!ys.b.instance.getFirstNameFilterCondition(),suggestedRooms:Gs.e.instance.suggestedRooms},this.tagAesthetics=Object(Us.e)(Js),this.updateDmAddRoomAction()}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),this.roomStoreToken=Es.a.addListener(this.onRoomViewStoreUpdate),Gs.e.instance.on(Gs.a,this.updateSuggestedRooms),ys.b.instance.on(ys.a,this.updateLists),this.customTagStoreRef=us.a.addListener(this.updateLists),this.updateLists()}componentWillUnmount(){Gs.e.instance.off(Gs.a,this.updateSuggestedRooms),ys.b.instance.off(ys.a,this.updateLists),gn.a.unregister(this.dispatcherRef),this.customTagStoreRef&&this.customTagStoreRef.remove(),this.roomStoreToken&&this.roomStoreToken.remove()}updateDmAddRoomAction(){const e=Object(Us.e)(Js[_s.a.DM]);Vs.d.sharedInstance().getSupportsPstnProtocol()?e.addRoomContextMenu=$s:e.onAddRoom=Ys,this.tagAesthetics[_s.a.DM]=e}renderSuggestedRooms(){return this.state.suggestedRooms.map(e=>{var t;const a=e.name||e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0])||Object(ts.a)("Empty room"),n=i.a.createElement(Ws.a,{oobData:{name:a,avatarUrl:e.avatar_url},width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:this.state.currentRoomId===e.room_id,displayName:a,avatar:n,onClick:()=>{var t;gn.a.dispatch({action:"view_room",room_alias:e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0]),room_id:e.room_id,via_servers:e.viaServers,oobData:{avatarUrl:e.avatar_url,name:a}})},key:"suggestedRoomTile_"+e.room_id})})}renderCommunityInvites(){return Cs.a.get().getGroups().filter(e=>"invite"===e.myMembership).map(e=>{const t=i.a.createElement(Is,{groupId:e.groupId,groupName:e.name,groupAvatarUrl:e.avatarUrl,width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:!1,displayName:e.name,avatar:t,notificationState:Ds.a.RED_EXCLAMATION,onClick:()=>{gn.a.dispatch({action:"view_group",group_id:e.groupId})},key:"temporaryGroupTile_"+e.groupId})})}renderSublists(){const e=!this.state.isNameFiltering&&Object.values(ys.b.instance.unfilteredLists).every(e=>!(null!=e&&e.length));return Hs.reduce((e,t)=>{if(t===Ks){const t=Object.keys(this.state.sublists).filter(e=>Object(_s.d)(e));e.push(...t)}return e.push(t),e},[]).map(t=>{let a=null;t===_s.a.Invite?a=this.renderCommunityInvites():t===_s.a.Suggested&&(a=this.renderSuggestedRooms());const n=Object(_s.d)(t)?((s=t).startsWith("u.")&&(s=s.substring(2)),{sectionLabel:Object(ts.b)("Custom Tag"),sectionLabelRaw:s,isInvite:!1,defaultHidden:!1}):this.tagAesthetics[t];var s;if(!n)throw new Error(`Tag ${t} does not have aesthetics`);return i.a.createElement(Ss.a,{key:"sublist-"+t,tagId:t,forRooms:!0,startAsHidden:n.defaultHidden,label:n.sectionLabelRaw?n.sectionLabelRaw:Object(ts.a)(n.sectionLabel),onAddRoom:n.onAddRoom,addRoomLabel:n.addRoomLabel?Object(ts.a)(n.addRoomLabel):n.addRoomLabel,addRoomContextMenu:n.addRoomContextMenu,isMinimized:this.props.isMinimized,showSkeleton:e,extraTiles:a,resizeNotifier:this.props.resizeNotifier,alwaysVisible:qs.includes(t),onListCollapse:this.props.onListCollapse})})}render(){const e=Cs.a.get().getUserId();let t;var a,n;if(!this.props.isMinimized)if(this.state.isNameFiltering)t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Can't see what you’re looking for?")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Start a new chat")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_explore",kind:"link",onClick:this.onExplore},this.props.activeSpace?Object(ts.a)("Explore rooms"):Object(ts.a)("Explore all public rooms")));else if(null!==(a=this.props.activeSpace)&&void 0!==a&&a.canInvite(e)||"join"===(null===(n=this.props.activeSpace)||void 0===n?void 0:n.getMyMembership()))t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Quick actions")),this.props.activeSpace.canInvite(e)&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceInvite",onClick:this.onSpaceInviteClick},Object(ts.a)("Invite people")),"join"===this.props.activeSpace.getMyMembership()&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceExplore",onClick:this.onExplore},Object(ts.a)("Explore rooms")));else if(Object.values(this.state.sublists).some(e=>e.length>0)){const e=ys.b.instance.unfilteredLists,a=e[_s.a.Untagged]||[],n=e[_s.a.Archived]||[],s=e[_s.a.Favourite]||[];a.length<1&&n<1&&s<1&&(t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Use the + to make a new room or explore existing ones below")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Start a new chat")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_explore",kind:"link",onClick:this.onExplore},"List Page")))}const s=this.renderSublists();return i.a.createElement(bs.c,{handleHomeEnd:!0,onKeyDown:this.props.onKeyDown},e=>{let{onKeyDownHandler:a}=e;return i.a.createElement("div",{onFocus:this.props.onFocus,onBlur:this.props.onBlur,onKeyDown:a,className:"mx_RoomList",role:"tree","aria-label":Object(ts.a)("Rooms")},s,t)})}})||Ns;var Xs=a(850);var Zs,ei=new class{async getListDrug(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/drug/list/1/10";return v.a.get(t)}async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/searchByPage";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/update/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/create";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/getOne/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/delete/"+e;return v.a.delete(a)}async treatmentStopped(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/treatmentStopped";return v.a.post(a,e)}async getTreamentById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/getOne/"+e;return v.a.get(a)}async createSummaryMedicalRecords(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/summaryMedicalRecords";return v.a.post(a,e)}};const ti=[_s.a.Invite,_s.a.Favourite,_s.a.DM,_s.a.Untagged,_s.a.LowPriority,_s.a.ServerNotice,_s.a.Suggested,_s.a.Archived],ai=_s.a.LowPriority,ni=[_s.a.DM,_s.a.Untagged],si=e=>{(e||gn.a).dispatch({action:"view_create_chat"})},ii=e=>i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Start a Conversation"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_chat"})}}),i.a.createElement(Ls.b,{label:Object(ts.a)("Open dial pad"),iconClassName:"mx_RoomList_iconDialpad",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.OpenDialPad)}})),oi={[_s.a.Invite]:{sectionLabel:Object(ts.b)("Invites"),isInvite:!0,defaultHidden:!1},[_s.a.Favourite]:{sectionLabel:Object(ts.b)("Favourites"),isInvite:!1,defaultHidden:!1},[_s.a.DM]:{sectionLabel:Object(ts.b)("Patient Management"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Start chat")},[_s.a.Untagged]:{sectionLabel:Object(ts.b)("Category Management"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Add room"),addRoomContextMenu:e=>{if(Gs.e.instance.activeSpace){const t=Gs.e.instance.activeSpace.currentState.maySendStateEvent(vs.a.SpaceChild,Cs.a.get().getUserId());return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.d)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to create new rooms in this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Add existing room"),iconClassName:"mx_RoomList_iconHash",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.c)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to add rooms to this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Explore rooms"),iconClassName:"mx_RoomList_iconBrowse",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_room"})}}),i.a.createElement(Ls.b,{label:Bs.a.instance.getSelectedCommunityId()?Object(ts.a)("Explore community rooms"):Object(ts.a)("Explore public rooms"),iconClassName:"mx_RoomList_iconExplore",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}},[_s.a.LowPriority]:{sectionLabel:Object(ts.b)("Low priority"),isInvite:!1,defaultHidden:!1},[_s.a.ServerNotice]:{sectionLabel:Object(ts.b)("System Alerts"),isInvite:!1,defaultHidden:!1},[_s.a.Archived]:{sectionLabel:Object(ts.b)("Historical"),isInvite:!1,defaultHidden:!0},[_s.a.Suggested]:{sectionLabel:Object(ts.b)("Suggested Rooms"),isInvite:!1,defaultHidden:!1}};Object(os.a)("views.rooms.GlobitsMenuList")(Zs=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"customTagStoreRef",void 0),Fe()(this,"tagAesthetics",void 0),Fe()(this,"roomStoreToken",void 0),Fe()(this,"onRoomViewStoreUpdate",()=>{this.setState({currentRoomId:Es.a.getRoomId()})}),Fe()(this,"onAction",e=>{if(e.action===js.a.ViewRoomDelta){const t=e,a=Es.a.getRoomId(),n=this.getRoomDelta(a,t.delta,t.unread);n&&gn.a.dispatch({action:"view_room",room_id:n.roomId,show_room_tile:!0})}else e.action===js.a.PstnSupportUpdated&&(this.updateDmAddRoomAction(),this.updateLists())}),Fe()(this,"getRoomDelta",(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=ys.b.instance.orderedLists,s=[];ti.forEach(t=>{let i=n[t];a&&(i=i.filter(t=>{const a=As.a.instance.getRoomState(t);return a.room.roomId===e||a.isUnread})),s.push(...i)});const i=s.findIndex(t=>t.roomId===e),[o]=s.slice((i+t)%s.length);return o})),Fe()(this,"updateSuggestedRooms",e=>{this.setState({suggestedRooms:e})}),Fe()(this,"updateLists",()=>{const e=ys.b.instance.orderedLists;ss.b.getValue("advancedRoomListLogging")&&console.log("new lists",e);const t=Object.keys(this.state.sublists),a=Object.keys(e).filter(e=>!Object(_s.d)(e)||us.a.getTags()[e]),n=!!ys.b.instance.getFirstNameFilterCondition();let s=this.state.isNameFiltering!==n||Object(Ms.d)(t,a);if(!s)for(const t of a){const a=this.state.sublists[t],n=e[t];if(a.length!==n.length){s=!0;break}}if(s){const t=Object(Us.f)(e,a),s=Object(Us.e)(t,(e,t)=>Object(Ms.b)(t));this.setState({sublists:s,isNameFiltering:n})}}),Fe()(this,"onStartChat",()=>{ei.getTest()}),Fe()(this,"onExplore",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;gn.a.dispatch({action:js.a.ViewRoomDirectory,initialText:t})}),Fe()(this,"onSpaceInviteClick",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;Object(zs.e)(this.props.activeSpace,t)}),this.state={sublists:{},isNameFiltering:!!ys.b.instance.getFirstNameFilterCondition(),suggestedRooms:Gs.e.instance.suggestedRooms},this.tagAesthetics=Object(Us.e)(oi),this.updateDmAddRoomAction()}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),this.roomStoreToken=Es.a.addListener(this.onRoomViewStoreUpdate),Gs.e.instance.on(Gs.a,this.updateSuggestedRooms),ys.b.instance.on(ys.a,this.updateLists),this.customTagStoreRef=us.a.addListener(this.updateLists),this.updateLists()}componentWillUnmount(){Gs.e.instance.off(Gs.a,this.updateSuggestedRooms),ys.b.instance.off(ys.a,this.updateLists),gn.a.unregister(this.dispatcherRef),this.customTagStoreRef&&this.customTagStoreRef.remove(),this.roomStoreToken&&this.roomStoreToken.remove()}updateDmAddRoomAction(){const e=Object(Us.e)(oi[_s.a.DM]);Vs.d.sharedInstance().getSupportsPstnProtocol()?e.addRoomContextMenu=ii:e.onAddRoom=si,this.tagAesthetics[_s.a.DM]=e}renderSuggestedRooms(){return this.state.suggestedRooms.map(e=>{var t;const a=e.name||e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0])||Object(ts.a)("Empty room"),n=i.a.createElement(Ws.a,{oobData:{name:a,avatarUrl:e.avatar_url},width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:this.state.currentRoomId===e.room_id,displayName:a,avatar:n,onClick:()=>{var t;gn.a.dispatch({action:"view_room",room_alias:e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0]),room_id:e.room_id,via_servers:e.viaServers,oobData:{avatarUrl:e.avatar_url,name:a}})},key:"suggestedRoomTile_"+e.room_id})})}renderCommunityInvites(){return Cs.a.get().getGroups().filter(e=>"invite"===e.myMembership).map(e=>{const t=i.a.createElement(Is,{groupId:e.groupId,groupName:e.name,groupAvatarUrl:e.avatarUrl,width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:!1,displayName:e.name,avatar:t,notificationState:Ds.a.RED_EXCLAMATION,onClick:()=>{gn.a.dispatch({action:"view_group",group_id:e.groupId})},key:"temporaryGroupTile_"+e.groupId})})}renderSublists(){const e=!this.state.isNameFiltering&&Object.values(ys.b.instance.unfilteredLists).every(e=>!(null!=e&&e.length));return ti.reduce((e,t)=>{if(t===ai){const t=Object.keys(this.state.sublists).filter(e=>Object(_s.d)(e));e.push(...t)}return e.push(t),e},[]).map(t=>{let a=null;t===_s.a.Invite?a=this.renderCommunityInvites():t===_s.a.Suggested&&(a=this.renderSuggestedRooms());const n=Object(_s.d)(t)?((s=t).startsWith("u.")&&(s=s.substring(2)),{sectionLabel:Object(ts.b)("Custom Tag"),sectionLabelRaw:s,isInvite:!1,defaultHidden:!1}):this.tagAesthetics[t];var s;if(!n)throw new Error(`Tag ${t} does not have aesthetics`);return i.a.createElement(Xs.a,{key:"sublist-"+t,tagId:t,forRooms:!0,startAsHidden:n.defaultHidden,label:n.sectionLabelRaw?n.sectionLabelRaw:Object(ts.a)(n.sectionLabel),onAddRoom:n.onAddRoom,addRoomLabel:n.addRoomLabel?Object(ts.a)(n.addRoomLabel):n.addRoomLabel,addRoomContextMenu:n.addRoomContextMenu,isMinimized:this.props.isMinimized,showSkeleton:e,extraTiles:a,resizeNotifier:this.props.resizeNotifier,alwaysVisible:ni.includes(t),onListCollapse:this.props.onListCollapse})})}render(){const e=Cs.a.get().getUserId();let t;var a,n;if(!this.props.isMinimized)if(this.state.isNameFiltering)t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Can't see what you’re looking for?")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Start a new chat")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_explore",kind:"link",onClick:this.onExplore},this.props.activeSpace?Object(ts.a)("Explore rooms"):Object(ts.a)("Explore all public rooms")));else if(null!==(a=this.props.activeSpace)&&void 0!==a&&a.canInvite(e)||"join"===(null===(n=this.props.activeSpace)||void 0===n?void 0:n.getMyMembership()))t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Quick actions")),this.props.activeSpace.canInvite(e)&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceInvite",onClick:this.onSpaceInviteClick},Object(ts.a)("Invite people")),"join"===this.props.activeSpace.getMyMembership()&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceExplore",onClick:this.onExplore},Object(ts.a)("Explore rooms")));else if(Object.values(this.state.sublists).some(e=>e.length>0)){const e=ys.b.instance.unfilteredLists,a=e[_s.a.Untagged]||[],n=e[_s.a.Archived]||[],s=e[_s.a.Favourite]||[];a.length<1&&n<1&&s<1&&(t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Add a new Patient"))))}const s=this.renderSublists();return i.a.createElement(bs.c,{handleHomeEnd:!0,onKeyDown:this.props.onKeyDown},e=>{let{onKeyDownHandler:a}=e;return i.a.createElement("div",{onFocus:this.props.onFocus,onBlur:this.props.onBlur,onKeyDown:a,className:"mx_RoomList",role:"tree","aria-label":Object(ts.a)("List of Patient")},s,t)})}});var ri=a(600),li=a(851),ci=a(237),di=a(1),mi=a(123);class ui extends ci.a{constructor(){super(gn.a),Fe()(this,"waitingRooms",[]),Fe()(this,"onMyMembership",async e=>{const t=ss.b.getValue("breadcrumbs",null,!0);this.meetsRoomRequirement&&Object(di.o)(t)&&await ss.b.setValue("breadcrumbs",null,mi.a.ACCOUNT,!0)}),Fe()(this,"onRoom",async e=>{const t=this.waitingRooms.find(t=>t.roomId===e.roomId);t&&(this.waitingRooms.splice(this.waitingRooms.indexOf(t),1),Date.now()-t.addedTs>9e4||await this.appendRoom(e))}),ss.b.monitorSetting("breadcrumb_rooms",null),ss.b.monitorSetting("breadcrumbs",null)}static get instance(){return ui.internalInstance}get rooms(){return this.state.rooms||[]}get visible(){return this.state.enabled&&this.meetsRoomRequirement}get meetsRoomRequirement(){return this.matrixClient&&this.matrixClient.getVisibleRooms().length>=20}async onAction(e){if(this.matrixClient)if("setting_updated"===e.action)"breadcrumb_rooms"===e.settingName?await this.updateRooms():"breadcrumbs"===e.settingName&&await this.updateState({enabled:ss.b.getValue("breadcrumbs",null)});else if("view_room"===e.action)if(e.auto_join&&!this.matrixClient.getRoom(e.room_id))this.waitingRooms.push({roomId:e.room_id,addedTs:Date.now()});else{const t=this.matrixClient.getRoom(e.room_id);t&&await this.appendRoom(t)}}async onReady(){await this.updateRooms(),await this.updateState({enabled:ss.b.getValue("breadcrumbs",null)}),this.matrixClient.on("Room.myMembership",this.onMyMembership),this.matrixClient.on("Room",this.onRoom)}async onNotReady(){this.matrixClient.removeListener("Room.myMembership",this.onMyMembership),this.matrixClient.removeListener("Room",this.onRoom)}async updateRooms(){let e=ss.b.getValue("breadcrumb_rooms");e&&0!==e.length||(e=[]);const t=e.map(e=>this.matrixClient.getRoom(e)).filter(e=>!!e),a=this.state.rooms||[];Object(Ms.d)(t,a)&&await this.updateState({rooms:t})}async appendRoom(e){if(ss.b.getValue("feature_spaces")&&e.isSpaceRoom())return;let t=!1;const a=(this.state.rooms||[]).slice(),n=this.matrixClient.getRoomUpgradeHistory(e.roomId);if(n.length>1){e=n[n.length-1];for(let e=0;e<n.length-1;e++){const s=a.findIndex(t=>t.roomId===n[e].roomId);-1!==s&&(a.splice(s,1),t=!0)}}const s=a.findIndex(t=>t.roomId===e.roomId);if(0!==s&&(-1!==s&&a.splice(s,1),a.splice(0,0,e),t=!0),a.length>20&&(a.splice(20,a.length-20),t=!0),t){await this.updateState({rooms:a});const e=a.map(e=>e.roomId);e.length>0&&await ss.b.setValue("breadcrumb_rooms",null,mi.a.ACCOUNT,e)}}}Fe()(ui,"internalInstance",new ui);var hi=a(440),pi=a(181),gi=a(142),fi=a(286),vi=a(131);const bi=["children"];var yi,Ei=e=>{let{children:t}=e,a=te()(e,bi);return i.a.createElement(bs.c,{handleHomeEnd:!0,onKeyDown:(e,t)=>{const a=e.target;if("INPUT"===a.tagName)return;let n=!0;switch(e.key){case vi.a.ARROW_UP:case vi.a.ARROW_DOWN:a.hasAttribute("aria-haspopup")&&a.click();break;case vi.a.ARROW_LEFT:case vi.a.ARROW_RIGHT:if(t.refs.length>0){const a=t.refs.findIndex(e=>e===t.activeRef),n=e.key===vi.a.ARROW_RIGHT?1:-1;t.refs.slice((a+n)%t.refs.length)[0].current.focus()}break;default:n=!1}n&&(e.preventDefault(),e.stopPropagation())}},e=>{let{onKeyDownHandler:n}=e;return i.a.createElement("div",u()({},a,{onKeyDown:n,role:"toolbar"}),t)})};let _i=Object(os.a)("views.rooms.RoomBreadcrumbs")(yi=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"isMounted",!0),Fe()(this,"onBreadcrumbsUpdate",()=>{this.isMounted&&(this.setState({doAnimation:!1,skipFirst:!0}),setTimeout(()=>this.setState({doAnimation:!0,skipFirst:!1}),0))}),Fe()(this,"viewRoom",(e,t)=>{pi.a.trackEvent("Breadcrumbs","click_node",String(t)),gn.a.dispatch({action:"view_room",room_id:e.roomId})}),this.state={doAnimation:!0,skipFirst:!1},ui.instance.on(gi.b,this.onBreadcrumbsUpdate)}componentWillUnmount(){this.isMounted=!1,ui.instance.off(gi.b,this.onBreadcrumbsUpdate)}render(){const e=ui.instance.rooms.map((e,t)=>i.a.createElement(bs.b,{className:"mx_RoomBreadcrumbs_crumb",key:e.roomId,onClick:()=>this.viewRoom(e,t),"aria-label":Object(ts.a)("Room %(name)s",{name:e.name}),title:e.name,tooltipClassName:"mx_RoomBreadcrumbs_Tooltip"},i.a.createElement(hi.a,{room:e,avatarSize:32,displayBadge:!0,forceCount:!0})));return e.length>0?i.a.createElement(fi.CSSTransition,{appear:!0,in:this.state.doAnimation,timeout:640,classNames:"mx_RoomBreadcrumbs"},i.a.createElement(Ei,{className:"mx_RoomBreadcrumbs","aria-label":Object(ts.a)("Recently visited rooms")},e.slice(this.state.skipFirst?1:0))):i.a.createElement("div",{className:"mx_RoomBreadcrumbs"},i.a.createElement("div",{className:"mx_RoomBreadcrumbs_placeholder"},Object(ts.a)("No recently visited rooms")))}})||yi;var Si,Ci;let wi=Object(os.a)("structures.IndicatorScrollbar")((Ci=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onMouseWheel",e=>{if(this.props.verticalScrollsHorizontally&&this._scrollElement){const t=0,a=1,n=(new Date).getTime();if(Math.abs(e.deltaX)>0?(this._likelyTrackpadUser=!0,this._checkAgainForTrackpad=n+6e4):this._likelyTrackpadUser&&n>=this._checkAgainForTrackpad&&(this._likelyTrackpadUser=!1),this._likelyTrackpadUser)return;if(Math.abs(e.deltaX)<=t){const t=e.deltaY<0?-50:50,n=Math.abs(e.deltaY)<25?e.deltaY+t:e.deltaY;this._scrollElement.scrollLeft+=n*a}}}),this._collectScroller=this._collectScroller.bind(this),this._collectScrollerComponent=this._collectScrollerComponent.bind(this),this.checkOverflow=this.checkOverflow.bind(this),this._scrollElement=null,this._autoHideScrollbar=null,this._likelyTrackpadUser=null,this._checkAgainForTrackpad=0,this.state={leftIndicatorOffset:0,rightIndicatorOffset:0}}moveToOrigin(){this._scrollElement&&(this._scrollElement.scrollLeft=0,this._scrollElement.scrollTop=0)}_collectScroller(e){e&&!this._scrollElement&&(this._scrollElement=e,this._scrollElement.addEventListener("scroll",this.checkOverflow,{passive:!0}),this.checkOverflow())}_collectScrollerComponent(e){this._autoHideScrollbar=e}componentDidUpdate(e){(e&&e.children&&e.children.length||0)!==(this.props.children&&this.props.children.length||0)&&this.checkOverflow()}componentDidMount(){this.checkOverflow()}checkOverflow(){const e=this._scrollElement.scrollTop>0,t=this._scrollElement.scrollHeight>this._scrollElement.scrollTop+this._scrollElement.clientHeight,a=this._scrollElement.scrollLeft>0,n=this._scrollElement.scrollWidth>this._scrollElement.scrollLeft+this._scrollElement.clientWidth;e?this._scrollElement.classList.add("mx_IndicatorScrollbar_topOverflow"):this._scrollElement.classList.remove("mx_IndicatorScrollbar_topOverflow"),t?this._scrollElement.classList.add("mx_IndicatorScrollbar_bottomOverflow"):this._scrollElement.classList.remove("mx_IndicatorScrollbar_bottomOverflow"),a?this._scrollElement.classList.add("mx_IndicatorScrollbar_leftOverflow"):this._scrollElement.classList.remove("mx_IndicatorScrollbar_leftOverflow"),n?this._scrollElement.classList.add("mx_IndicatorScrollbar_rightOverflow"):this._scrollElement.classList.remove("mx_IndicatorScrollbar_rightOverflow"),this.props.trackHorizontalOverflow&&this.setState({leftIndicatorOffset:a?this._scrollElement.scrollLeft+"px":"0",rightIndicatorOffset:n?`-${this._scrollElement.scrollLeft}px`:"0"})}getScrollTop(){return this._autoHideScrollbar.getScrollTop()}componentWillUnmount(){this._scrollElement&&this._scrollElement.removeEventListener("scroll",this.checkOverflow)}render(){const e={left:this.state.leftIndicatorOffset},t={right:this.state.rightIndicatorOffset},a=this.props.trackHorizontalOverflow?i.a.createElement("div",{className:"mx_IndicatorScrollbar_leftOverflowIndicator",style:e}):null,n=this.props.trackHorizontalOverflow?i.a.createElement("div",{className:"mx_IndicatorScrollbar_rightOverflowIndicator",style:t}):null;return i.a.createElement(Jn.a,u()({ref:this._collectScrollerComponent,wrappedRef:this._collectScroller,onWheel:this.onMouseWheel},this.props),a,this.props.children,n)}},Fe()(Ci,"propTypes",{trackHorizontalOverflow:At.a.bool,verticalScrollsHorizontally:At.a.bool}),Si=Ci))||Si;var Oi=a(253),xi=a(193);var Ri=e=>{let{onVisibilityChange:t}=e;const[a,n]=Object(s.useState)(null);return Object(xi.a)(ys.b.instance,ys.a,()=>{if(ys.b.instance.getFirstNameFilterCondition()){const e=Object.values(ys.b.instance.orderedLists).flat(1).length;n(e)}else n(null)}),Object(s.useEffect)(()=>{t&&t()},[a,t]),"number"!=typeof a?null:i.a.createElement("div",{className:"mx_LeftPanel_roomListFilterCount"},Gs.e.instance.spacePanelSpaces.length?Object(ts.a)("%(count)s results in all spaces",{count:a}):Object(ts.a)("%(count)s results",{count:a}))},ki=a(370);const Ii=(e,t)=>{try{const a=window.localStorage.getItem(e);return a?JSON.parse(a):t}catch(e){return t}},Ti=(e,t)=>{const a="mx_"+e,[n,i]=Object(s.useState)(Ii(a,t));Object(s.useEffect)(()=>{i(Ii(a,t))},[a,t]);return[n,Object(s.useCallback)(e=>{window.localStorage.setItem(a,JSON.stringify(e)),i(e)},[a])]};var Pi=a(215);const Ni=e=>e?e.getContent():void 0;var Di=a(501),ji=a(852),Ai=a(200);var Mi,Ui=()=>{const e=Object(s.useContext)(ns.a),t=((e,t)=>{const[a,n]=Object(s.useState)(()=>Ni(e.getAccountData(t))),i=Object(s.useCallback)(e=>{e.getType()===t&&n(e.getContent())},[t]);return Object(xi.a)(e,"accountData",i),a||{}})(e,"m.widgets"),a=Object(ji.a)("Widgets.leftPanel"),n=Object(s.useMemo)(()=>{if(!t||!a)return null;const e=Object.values(t).find(e=>e.id===a);return e?Pi.a.makeAppConfig(e.state_key,e.content,e.sender,null,e.id):null},[t,a]),[o,r]=Ti("left-panel-widget-height",280),[l,c]=Ti("left-panel-widget-expanded",!0),[d,m,u]=Object(bs.e)(),h=m?0:-1;if(!n)return null;let p;return l&&(p=i.a.createElement(ki.Resizable,{size:{height:o},minHeight:100,maxHeight:Math.min(Ai.b.instance.windowHeight/2,500),onResizeStop:(e,t,a,n)=>{r(o+n.height)},handleWrapperClass:"mx_LeftPanelWidget_resizerHandles",handleClasses:{top:"mx_LeftPanelWidget_resizerHandle"},className:"mx_LeftPanelWidget_resizeBox",enable:{top:!0}},i.a.createElement(Di.a,{app:n,fullWidth:!0,show:!0,showMenubar:!1,userWidget:!0,userId:e.getUserId(),creatorUserId:n.creatorUserId,widgetPageTitle:Pi.a.getWidgetDataTitle(n),waitForIframeLoad:n.waitForIframeLoad}))),i.a.createElement("div",{className:"mx_LeftPanelWidget"},i.a.createElement("div",{onFocus:d,className:"mx_LeftPanelWidget_headerContainer",onKeyDown:e=>{switch(e.key){case vi.a.ARROW_LEFT:e.stopPropagation(),c(!1);break;case vi.a.ARROW_RIGHT:e.stopPropagation(),c(!0)}}},i.a.createElement("div",{className:"mx_LeftPanelWidget_stickable"},i.a.createElement(Fs.a,{onFocus:d,inputRef:u,tabIndex:h,className:"mx_LeftPanelWidget_headerText",role:"treeitem","aria-expanded":l,"aria-level":1,onClick:()=>{c(e=>!e)}},i.a.createElement("span",{className:Hn()({mx_LeftPanelWidget_collapseBtn:!0,mx_LeftPanelWidget_collapseBtn_collapsed:!l})}),i.a.createElement("span",null,Pi.a.getWidgetName(n))))),p)},Li=a(220);a(1436);const Fi=["mx_RoomSearch_input","mx_RoomSearch_minimizedHandle","mx_RoomSublist_headerText","mx_RoomTile","mx_RoomSublist_showNButton"];let Bi=Object(os.a)("structures.ChatPanel")(Mi=class extends s.Component{constructor(e){super(e),Fe()(this,"ref",Object(s.createRef)()),Fe()(this,"listContainerRef",Object(s.createRef)()),Fe()(this,"groupFilterPanelWatcherRef",void 0),Fe()(this,"bgImageWatcherRef",void 0),Fe()(this,"focusedElement",null),Fe()(this,"isDoingStickyHeaders",!1),Fe()(this,"updateActiveSpace",e=>{this.setState({activeSpace:e})}),Fe()(this,"onExplore",()=>{gn.a.fire(js.a.ViewRoomDirectory)}),Fe()(this,"refreshStickyHeaders",()=>{this.listContainerRef.current&&this.handleStickyHeaders(this.listContainerRef.current)}),Fe()(this,"onBreadcrumbsUpdate",()=>{const e=ui.instance.visible;if(e!==this.state.showBreadcrumbs){if(this.setState({showBreadcrumbs:e}),!this.listContainerRef.current)return;this.handleStickyHeaders(this.listContainerRef.current)}}),Fe()(this,"onBackgroundImageUpdate",()=>{let e=Oi.a.instance.getHttpAvatarUrl(32);const t=ss.b.getValue("RoomList.backgroundImage");t&&(e=Object(Os.b)(t).getSquareThumbnailHttp(32));const a=`url(${e})`;e?document.body.style.getPropertyValue("--avatar-url")!==a&&document.body.style.setProperty("--avatar-url",a):document.body.style.removeProperty("--avatar-url")}),Fe()(this,"onScroll",e=>{const t=e.target;this.handleStickyHeaders(t)}),Fe()(this,"onFocus",e=>{this.focusedElement=e.target}),Fe()(this,"onBlur",()=>{this.focusedElement=null}),Fe()(this,"onKeyDown",e=>{if(!this.focusedElement)return;const t=Object(Li.f)().getRoomListAction(e);switch(t){case Li.e.NextRoom:case Li.e.PrevRoom:e.stopPropagation(),e.preventDefault(),this.onMoveFocus(t===Li.e.PrevRoom)}}),Fe()(this,"selectRoom",()=>{const e=this.listContainerRef.current.querySelector(".mx_RoomTile");if(e)return e.click(),!0}),Fe()(this,"onMoveFocus",e=>{let t,a=this.focusedElement,n=!1;do{const s=e?a.lastElementChild:a.firstElementChild,i=e?a.previousElementSibling:a.nextElementSibling;n?s?a=s:i?a=i:(n=!1,a=a.parentElement):i?(a=i,n=!0):a=a.parentElement,a&&(t=a.classList)}while(a&&(!Fi.some(e=>t.contains(e))||null===a.offsetParent));a&&(a.focus(),this.focusedElement=a)}),this.state={showBreadcrumbs:ui.instance.visible,showGroupFilterPanel:ss.b.getValue("TagPanel.enableTagPanel"),activeSpace:Gs.e.instance.activeSpace},ui.instance.on(gi.b,this.onBreadcrumbsUpdate),ys.b.instance.on(ys.a,this.onBreadcrumbsUpdate),Oi.a.instance.on(gi.b,this.onBackgroundImageUpdate),Gs.e.instance.on(Gs.c,this.updateActiveSpace),this.bgImageWatcherRef=ss.b.watchSetting("RoomList.backgroundImage",null,this.onBackgroundImageUpdate),this.groupFilterPanelWatcherRef=ss.b.watchSetting("TagPanel.enableTagPanel",null,()=>{this.setState({showGroupFilterPanel:ss.b.getValue("TagPanel.enableTagPanel")})})}componentDidMount(){var e;Ai.b.instance.trackElementDimensions("ListContainer",this.listContainerRef.current),Ai.b.instance.on("ListContainer",this.refreshStickyHeaders),null===(e=this.listContainerRef.current)||void 0===e||e.addEventListener("scroll",this.onScroll,{passive:!0})}componentWillUnmount(){var e;ss.b.unwatchSetting(this.groupFilterPanelWatcherRef),ss.b.unwatchSetting(this.bgImageWatcherRef),ui.instance.off(gi.b,this.onBreadcrumbsUpdate),ys.b.instance.off(ys.a,this.onBreadcrumbsUpdate),Oi.a.instance.off(gi.b,this.onBackgroundImageUpdate),Gs.e.instance.off(Gs.c,this.updateActiveSpace),Ai.b.instance.stopTrackingElementDimensions("ListContainer"),Ai.b.instance.removeListener("ListContainer",this.refreshStickyHeaders),null===(e=this.listContainerRef.current)||void 0===e||e.removeEventListener("scroll",this.onScroll)}componentDidUpdate(e,t){t.activeSpace!==this.state.activeSpace&&this.refreshStickyHeaders()}handleStickyHeaders(e){this.isDoingStickyHeaders||(this.isDoingStickyHeaders=!0,window.requestAnimationFrame(()=>{this.doStickyHeaders(e),this.isDoingStickyHeaders=!1}))}doStickyHeaders(e){const t=e.scrollTop,a=e.offsetHeight+e.scrollTop,n=e.querySelectorAll(".mx_RoomSublist:not(.mx_RoomSublist_hidden)"),s=new Map;let i,o;for(const e of n){const r=e.querySelector(".mx_RoomSublist_stickable");r.style.removeProperty("display");const l=.4,c=e.offsetTop+l*ri.a<=t,d=e.offsetTop+l*ri.a>=a;c||e===n[0]?(s.set(r,{stickyTop:!0}),i&&(i.style.display="none",s.set(i,{makeInvisible:!0})),i=r):d&&!o?(s.set(r,{stickyBottom:!0}),o=r):s.set(r,{})}for(const t of s.keys()){const a=s.get(t);if(a.makeInvisible)t.style.display="none";else{if(a.stickyTop){t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")||t.classList.add("mx_RoomSublist_headerContainer_stickyTop");const a=e.parentElement.offsetTop+"px";t.style.top!==a&&(t.style.top=a)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyTop"),t.style.top&&t.style.removeProperty("top");if(a.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")||t.classList.add("mx_RoomSublist_headerContainer_stickyBottom");const a=Ai.b.instance.windowHeight-(e.parentElement.offsetTop+e.parentElement.offsetHeight)+"px";t.style.bottom!==a&&(t.style.bottom=a)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyBottom"),t.style.bottom&&t.style.removeProperty("bottom");if(a.stickyTop||a.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_sticky")||t.classList.add("mx_RoomSublist_headerContainer_sticky");const e=Ai.b.instance.getElementDimensions("ListContainer");if(e){const a=15,n=e.width-a+"px";t.style.width!==n&&(t.style.width=n)}}else a.stickyTop||a.stickyBottom||(t.classList.contains("mx_RoomSublist_headerContainer_sticky")&&t.classList.remove("mx_RoomSublist_headerContainer_sticky"),t.style.width&&t.style.removeProperty("width"))}}const r=e.parentElement;i?r.classList.add("mx_LeftPanel_roomListWrapper_stickyTop"):r.classList.remove("mx_LeftPanel_roomListWrapper_stickyTop"),o?r.classList.add("mx_LeftPanel_roomListWrapper_stickyBottom"):r.classList.remove("mx_LeftPanel_roomListWrapper_stickyBottom")}renderBreadcrumbs(){if(this.state.showBreadcrumbs&&!this.props.isMinimized)return s.createElement(wi,{className:"mx_LeftPanel_breadcrumbsContainer mx_AutoHideScrollbar",verticalScrollsHorizontally:!0,tabIndex:-1},s.createElement(_i,null))}renderSearchExplore(){return s.createElement("div",{className:"mx_LeftPanel_filterContainer",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown},s.createElement(li.a,{isMinimized:this.props.isMinimized,onKeyDown:this.onKeyDown,onSelectRoom:this.selectRoom}),s.createElement(is.a,{className:Hn()("mx_LeftPanel_exploreButton",{mx_LeftPanel_exploreButton_space:!!this.state.activeSpace}),onClick:this.onExplore,title:Object(ts.a)("Explore rooms")}))}render(){let e;this.state.showGroupFilterPanel&&(e=s.createElement("div",{className:"mx_LeftPanel_GroupFilterPanelContainer"},s.createElement(ms,null),ss.b.getValue("feature_custom_tags")?s.createElement(fs,null):null));const t=s.createElement(Qs,{onKeyDown:this.onKeyDown,resizeNotifier:this.props.resizeNotifier,onFocus:this.onFocus,onBlur:this.onBlur,isMinimized:this.props.isMinimized,activeSpace:this.state.activeSpace,onListCollapse:this.refreshStickyHeaders}),a=(this.onKeyDown,this.props.resizeNotifier,this.onFocus,this.onBlur,this.props.isMinimized,this.state.activeSpace,this.refreshStickyHeaders,Hn()({mx_LeftPanel:!0,mx_LeftPanel_minimized:this.props.isMinimized})),n=Hn()("mx_LeftPanel_actualRoomListContainer","mx_AutoHideScrollbar");return s.createElement("div",{className:a,ref:this.ref},s.createElement("aside",{className:"mx_LeftPanel_roomListContainer"},this.renderSearchExplore(),this.renderBreadcrumbs(),s.createElement(Ri,{onVisibilityChange:this.refreshStickyHeaders}),s.createElement("div",{className:"mx_LeftPanel_roomListWrapper"},s.createElement("div",{className:n,ref:this.listContainerRef,tabIndex:-1},t)),!this.props.isMinimized&&s.createElement(Ui,null)))}})||Mi;var Vi=a(1437),Gi=a(1446),zi=a(2755);function Wi(e){var t,a,s,o,r,l,c,d,m,u,h,p,g,f,v,b;return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(X,{label:i.a.createElement("span",null,"Loại thông tin ",i.a.createElement("span",{style:{color:"red"}},"*")),name:"type",defaultValue:null===(t=e.item)||void 0===t?void 0:t.type,options:Oe.a.CLINIC_INFORMATION_TYPE,setFieldValue:e.setFieldValue})),2==e.values.type?i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Email",name:"email",defaultValue:null===(a=e.item)||void 0===a?void 0:a.email,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Website",name:"website",defaultValue:null===(s=e.item)||void 0===s?void 0:s.website,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Mã phòng khám",name:"code",defaultValue:null===(o=e.item)||void 0===o?void 0:o.code,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Tên phòng khám",name:"name",defaultValue:null===(r=e.item)||void 0===r?void 0:r.name,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Người liên hệ",name:"contactPersonName",defaultValue:null===(l=e.item)||void 0===l?void 0:l.contactPersonName,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Số điện thoại",name:"contactPersonPhoneNumber",defaultValue:null===(c=e.item)||void 0===c?void 0:c.contactPersonPhoneNumber,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Địa chỉ",name:"address",defaultValue:null===(d=e.item)||void 0===d?void 0:d.address,setFieldValue:e.setFieldValue}))):i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Số tài khoản nhận tiền",name:"accountNumberReceivingMoney",defaultValue:null===(m=e.item)||void 0===m?void 0:m.accountNumberReceivingMoney,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Chủ tài khoản",name:"accountHolder",defaultValue:null===(u=e.item)||void 0===u?void 0:u.accountHolder,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Loại tài khoản (tên ngân hàng)",name:"typeOfAccount",defaultValue:null===(h=e.item)||void 0===h?void 0:h.typeOfAccount,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Mã thông tin",name:"code",defaultValue:null===(p=e.item)||void 0===p?void 0:p.code,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Tên thông tin",name:"name",defaultValue:null===(g=e.item)||void 0===g?void 0:g.name,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Người liên hệ",name:"contactPersonName",defaultValue:null===(f=e.item)||void 0===f?void 0:f.contactPersonName,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Số điện thoại liên hệ",name:"contactPersonPhoneNumber",defaultValue:null===(v=e.item)||void 0===v?void 0:v.contactPersonPhoneNumber,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(Z,{label:"Địa chỉ liên hệ",name:"address",defaultValue:null===(b=e.item)||void 0===b?void 0:b.address,setFieldValue:e.setFieldValue})))))}var Hi=new class{async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/clinicInformation/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/clinicInformation/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/clinicInformation/";return v.a.post(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/clinicInformation/"+e;return v.a.delete(a)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/clinicInformation/getOne/"+e;return v.a.get(a)}async getClinicInformation(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/clinicInformation/getClinicInformation";return v.a.get(t)}};function Ki(e){return i.a.createElement(vt.a,e)}function qi(e){var t,a,s,o,r,l,c,d,m,u,h,p,g;const[f,v]=i.a.useState(!1),b=Ye.object().shape({type:Ye.mixed().required("Trường này là bắt buộc")}),y={id:null===(t=e.item)||void 0===t?void 0:t.id,type:null===(a=e.item)||void 0===a?void 0:a.type,code:null===(s=e.item)||void 0===s?void 0:s.code,name:null===(o=e.item)||void 0===o?void 0:o.name,contactPersonName:null===(r=e.item)||void 0===r?void 0:r.contactPersonName,contactPersonPhoneNumber:null===(l=e.item)||void 0===l?void 0:l.contactPersonPhoneNumber,address:null===(c=e.item)||void 0===c?void 0:c.address,accountNumberReceivingMoney:null===(d=e.item)||void 0===d?void 0:d.accountNumberReceivingMoney,accountHolder:null===(m=e.item)||void 0===m?void 0:m.accountHolder,typeOfAccount:null===(u=e.item)||void 0===u?void 0:u.typeOfAccount,email:null===(h=e.item)||void 0===h?void 0:h.email,website:null===(p=e.item)||void 0===p?void 0:p.website};return i.a.createElement(n.Dialog,{className:"dialog-container",open:e.open,PaperComponent:Ki,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},null!==(g=e.item)&&void 0!==g&&g.id?"Thêm thông tin phòng khám":"Sửa thông tin phòng khám"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>e.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Y.Formik,{initialValues:y,validationSchema:b,onSubmit:async t=>{v(!0);let a={id:t.id,type:t.type,code:t.code,name:t.name,contactPersonName:t.contactPersonName,contactPersonPhoneNumber:t.contactPersonPhoneNumber,address:t.address,accountNumberReceivingMoney:t.accountNumberReceivingMoney,accountHolder:t.accountHolder,typeOfAccount:t.typeOfAccount,email:t.email,website:t.website};t.id?await Hi.update(a):await Hi.save(a),v(!1),e.handleSubmit()}},t=>{let{errors:a,touched:s,setFieldValue:o,values:r}=t;return i.a.createElement(Y.Form,null,i.a.createElement(n.DialogContent,null,i.a.createElement(Wi,{setFieldValue:o,item:e.item,values:r})),i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),loading:f,className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu")))}))}var Yi=a(169),$i=a.n(Yi),Ji=a(139),Qi=a.n(Ji),Xi=a(157),Zi=a.n(Xi);function eo(e){const[t,a]=Object(s.useState)([]),[o,r]=Object(s.useState)(0),[l,c]=Object(s.useState)(1),[d,m]=Object(s.useState)(10),[u,h]=Object(s.useState)(-1),[p,g]=Object(s.useState)(""),[f,v]=Object(s.useState)(!1),[b,y]=Object(s.useState)(null),[E,_]=Object(s.useState)(null),[S,C]=Object(s.useState)(!1);Object(s.useEffect)(()=>{_(window.innerHeight-270)},[]),Object(s.useEffect)(()=>{w()},[l,d,p]);const w=async()=>{C(!0);let e={pageIndex:l,pageSize:d,text:p},t=await Hi.searchByDto(e);a(t.data.content),h(t.data.totalElements),r(t.data.totalPages),C(!1)},O=e=>{y(e),v(!0)},x=()=>{v(!1)};return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Thông tin phòng khám"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{O(null)}},"Thêm mới"),f&&i.a.createElement(qi,{handleClose:x,handleSubmit:()=>{x(),w()},item:b,open:f})),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(Gt,{search:e=>{g(e)}}))),i.a.createElement(n.Grid,{container:!0,className:"mt-16"},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{columns:[{title:"Loại thông tin",field:"type",render:e=>e.type?Oe.a.CLINIC_INFORMATION_TYPE.find(t=>t.value===e.type).name:null},{title:"Mã thông tin",field:"code"},{title:"Tên thông tin",field:"name"},{title:"Thao tác",align:"right",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>O(e)},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>(async e=>{await Hi.deleteById(e),w()})(e)},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],data:t,options:{headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"}),draggable:!1,toolbar:!1,maxBodyHeight:E,showTitle:!1,search:!1,sorting:!0,paging:!1},style:{overflow:"auto",height:E},icons:dn,isLoading:S}),i.a.createElement(xe,{totalPages:o,handleChangePage:(e,t)=>{c(t)},setRowsPerPage:e=>{m(e.target.value),c(1)},pageSize:d,pageSizeOption:[1,2,3,5,10,25],totalElements:u,page:l}))))}var to=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/searchByPage";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/getOne/"+e;return v.a.get(a)}async getPatientPeriodPrepScreeningById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-period-prep-screening/"+e;return v.a.get(a)}async getLabTestOrderByTreatmentPeriodId(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/getByIdTreamentPreiod/"+e;return v.a.get(a)}async searchByPageEncounter(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter/searchByDto";return v.a.post(a,e)}},ao=a(229),no=a.n(ao);const so=Object(n.makeStyles)(e=>({root:{}}));function io(e){const t=so(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({code:Ye.string().required(),name:Ye.string().required()}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{console.log("abcd"),s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Drug Code",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Drug Name",variant:"outlined",required:"true"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>o()},"Cancel"),i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Save"))))))}function oo(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ro(e){return i.a.createElement(vt.a,e)}class lo extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state;console.log("abcderfasfas");let n={id:a,name:e.name,code:e.code};a?to.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):to.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={id:"",name:"",code:""}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?oo(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):oo(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){var e;let{name:t,code:a}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:ro,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Edit Drug":"Create Drug"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(io,{initialValues:{name:t||"",code:a||""},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose}))}}var co=a(1454),mo=a.n(co),uo=a(869),ho=a.n(uo),po=a(868),go=a.n(po);function fo(e){return i.a.createElement(D.a,{handle:"#draggable-dialog-title",cancel:'[class*="MuiDialogContent-root"]'},i.a.createElement(vt.a,e))}class vo extends s.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",()=>{let e=document.getElementById("divcontents"),t=document.getElementById("ifmcontentstoprint").contentWindow;t.document.open(),t.document.write(e.innerHTML),t.document.close(),t.focus(),t.print()}),Fe()(this,"getAddress",()=>{var e,t,a,n,s,i,o;let{item:r}=this.props,l="";var c,d,m,u,h,p,g,f,v,b;null!=r&&null!==(e=r.patient)&&void 0!==e&&e.currentDetailResidence&&(l+=(null==r||null===(c=r.patient)||void 0===c?void 0:c.currentDetailResidence)+", ");null!=r&&null!==(t=r.patient)&&void 0!==t&&t.currentResidence&&(l+=(null==r||null===(d=r.patient)||void 0===d||null===(m=d.currentResidence)||void 0===m?void 0:m.name)+", ");null!=r&&null!==(a=r.patient)&&void 0!==a&&null!==(n=a.currentResidence)&&void 0!==n&&n.parent&&(l+=(null==r||null===(u=r.patient)||void 0===u||null===(h=u.currentResidence)||void 0===h||null===(p=h.parent)||void 0===p?void 0:p.name)+", ");null!=r&&null!==(s=r.patient)&&void 0!==s&&null!==(i=s.currentResidence)&&void 0!==i&&null!==(o=i.parent)&&void 0!==o&&o.parent&&(l+=null==r||null===(g=r.patient)||void 0===g||null===(f=g.currentResidence)||void 0===f||null===(v=f.parent)||void 0===v||null===(b=v.parent)||void 0===b?void 0:b.name);return l}),this.state={clinicInformation:null}}async componentDidMount(){await Hi.getClinicInformation().then(e=>{let{data:t}=e;t&&this.setState({clinicInformation:t})})}render(){var e,t,a,s,o,r;let{open:l,handleClose:c,item:d,reviewerName:m}=this.props,{clinicInformation:u}=(new Date,this.state);return i.a.createElement(n.Dialog,{className:"dialog-container",open:l,PaperComponent:fo,maxWidth:"md",fullWidth:!0},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white",style:{fontSize:"20px"}}," In kết quả sàng lọc "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"inherit"}))),i.a.createElement("iframe",{id:"ifmcontentstoprint",style:{height:"0px",width:"0px",position:"absolute",print:{size:"auto",margin:"0mm"}}}),i.a.createElement(n.DialogContent,{id:"divcontents",className:"scroll-vertical h-70vh over-flow-auto"},i.a.createElement("div",null,i.a.createElement("div",{className:"WordSection1"},i.a.createElement("style",{dangerouslySetInnerHTML:{__html:'\n            p.MsoNormal,\n            li.MsoNormal,\n            div.MsoNormal {\n                margin: 0in;\n                font-size: 14.0pt;\n                font-family: ".VnTime", sans-serif;\n            }\n\n            h1 {\n                mso-style-link: "Heading 1 Char";\n                margin: 0in;\n                text-align: center;\n                page-break-after: avoid;\n                font-size: 18.0pt;\n                font-family: ".VnTimeH", sans-serif;\n            }\n\n            span.Heading1Char {\n                mso-style-name: "Heading 1 Char";\n                mso-style-link: "Heading 1";\n                font-family: ".VnTimeH", sans-serif;\n                font-weight: bold;\n            }\n\n            .MsoChpDefault {\n                font-family: "Calibri", sans-serif;\n            }\n\n            .MsoPapDefault {\n                margin-bottom: 8.0pt;\n                line-height: 107%;\n            }\n\n            @page WordSection1 {\n                size: 8.5in 11.0in;\n                margin: 1.0in 1.0in 1.0in 1.0in;\n            }\n\n            div.WordSection1 {\n                page: WordSection1;\n            }\n\n            ol {\n                margin-bottom: 0in;\n            }\n\n            ul {\n                margin-bottom: 0in;\n            }\n        '}}),i.a.createElement("h1",null,i.a.createElement("a",{name:"_Toc89194740"},i.a.createElement("span",{style:{fontSize:"16.0pt",fontFamily:'"Times New Roman",serif'}},"PHIẾU ĐÁNH GIÁ"))),i.a.createElement("table",{className:"MsoNormalTable",border:1,cellSpacing:0,cellPadding:0,width:"101%",style:{width:"101.98%",marginLeft:".5pt",borderCollapse:"collapse",border:"none"}},i.a.createElement("tbody",null,i.a.createElement("tr",{style:{height:"11.25pt"}},i.a.createElement("td",{width:"100%",colSpan:8,valign:"top",style:{width:"100.0%",border:"solid windowtext 1.0pt",background:"#EEECE1",padding:"0in 0in 0in 0in",height:"11.25pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.6pt"}},i.a.createElement("b",null,i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Thông tin khách hàng"))))),i.a.createElement("tr",{style:{height:"10.4pt"}},i.a.createElement("td",{width:"63%",colSpan:5,valign:"top",style:{width:"63.12%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"10.4pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.35pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Họ",i.a.createElement("span",{style:{letterSpacing:".05pt"}}," "),"và",i.a.createElement("span",{style:{letterSpacing:"-.1pt"}}," "),"tên: ",null!=d&&null!==(e=d.patient)&&void 0!==e&&e.displayName?null==d||null===(t=d.patient)||void 0===t?void 0:t.displayName:""))),i.a.createElement("td",{width:"36%",colSpan:3,valign:"top",style:{width:"36.88%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.4pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.4pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Năm",i.a.createElement("span",{style:{letterSpacing:"-.15pt"}}," "),"sinh: ",null!==(a=d.patient)&&void 0!==a&&a.birthDate?Te()(null===(s=d.patient)||void 0===s?void 0:s.birthDate).format("YYYY"):"")))),i.a.createElement("tr",{style:{height:"10.3pt"}},i.a.createElement("td",{width:"63%",colSpan:5,valign:"top",style:{width:"63.12%",borderTop:"none",borderLeft:"solid black 1.0pt",borderBottom:"solid windowtext 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.35pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Địa chỉ: ",this.getAddress()))),i.a.createElement("td",{width:"36%",colSpan:3,valign:"top",style:{width:"36.88%",borderTop:"none",borderLeft:"none",borderBottom:"solid windowtext 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.4pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Số điện thoại: ",null!=d&&null!==(o=d.patient)&&void 0!==o&&o.phoneNumber?null==d||null===(r=d.patient)||void 0===r?void 0:r.phoneNumber:"")))),i.a.createElement("tr",{style:{height:"10.5pt"}},i.a.createElement("td",{width:"6%",valign:"top",style:{width:"6.04%",border:"solid windowtext 1.0pt",borderTop:"none",background:"#EEECE1",padding:"0in 0in 0in 0in",height:"10.5pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.6pt"}},i.a.createElement("b",null,i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif',color:"black"}},"STT")))),i.a.createElement("td",{width:"93%",colSpan:7,valign:"top",style:{width:"93.96%",borderTop:"none",borderLeft:"none",borderBottom:"solid windowtext 1.0pt",borderRight:"solid windowtext 1.0pt",background:"#EEECE1",padding:"0in 0in 0in 0in",height:"10.5pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.65pt"}},i.a.createElement("b",null,i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif',color:"black"}},"Câu hỏi sàng lọc"))))),i.a.createElement("tr",{style:{height:"10.4pt"}},i.a.createElement("td",{width:"6%",style:{width:"6.04%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"10.4pt"}},i.a.createElement("p",{className:"MsoNormal",align:"center",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"0in",textAlign:"center"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"1"))),i.a.createElement("td",{width:"37%",style:{width:"37.08%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.4pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.4pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Giới tính lúc sinh của bạn"))),i.a.createElement("td",{width:"11%",style:{width:"11.16%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.4pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.25pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},0==(null==d?void 0:d.question1)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),"N",i.a.createElement("span",{style:{letterSpacing:".05pt"}},"a"),"m"))),i.a.createElement("td",{width:"7%",style:{width:"7.86%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.4pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.5pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},1==(null==d?void 0:d.question1)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"N"),"ữ"))),i.a.createElement("td",{width:"37%",colSpan:4,style:{width:"37.86%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.4pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"0in"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}}," ")))),i.a.createElement("tr",{style:{height:"26.05pt"}},i.a.createElement("td",{width:"6%",style:{width:"6.04%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"26.05pt"}},i.a.createElement("p",{className:"MsoNormal",align:"center",style:{textAlign:"center",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"2"))),i.a.createElement("td",{width:"37%",style:{width:"37.08%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"26.05pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"5.4pt",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Hiện nay, bạn tự nhận mình thuộc giới tính nào"))),i.a.createElement("td",{width:"11%",style:{width:"11.16%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"26.05pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"5.25pt",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},0==(null==d?void 0:d.question2)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),"N",i.a.createElement("span",{style:{letterSpacing:".05pt"}},"a"),"m"))),i.a.createElement("td",{width:"7%",style:{width:"7.86%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"26.05pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"5.5pt",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},1==(null==d?void 0:d.question2)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"N"),"ữ"))),i.a.createElement("td",{width:"12%",colSpan:2,style:{width:"12.36%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"26.05pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"4.7pt",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},2==(null==d?void 0:d.question2)?"☑":i.a.createElement("span",null,"▢"),"Chuyển giới nữ"))),i.a.createElement("td",{width:"14%",style:{width:"14.16%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"26.05pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"5.85pt",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},3==(null==d?void 0:d.question2)?"☑":i.a.createElement("span",null,"▢"),"Chuyển giới nam"))),i.a.createElement("td",{width:"11%",style:{width:"11.34%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"26.05pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"6.0pt",lineHeight:"9.35pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},4==(null==d?void 0:d.question2)?"☑":i.a.createElement("span",null,"▢")," Khác")))),i.a.createElement("tr",{style:{height:"54.8pt"}},i.a.createElement("td",{width:"6%",style:{width:"6.04%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"54.8pt"}},i.a.createElement("p",{className:"MsoNormal",align:"center",style:{textAlign:"center",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"3"))),i.a.createElement("td",{width:"37%",style:{width:"37.08%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"54.8pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"5.4pt",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Bạn có QHTD với"))),i.a.createElement("td",{width:"11%",style:{width:"11.16%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"54.8pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"5.25pt",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},0==(null==d?void 0:d.question3)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),"N",i.a.createElement("span",{style:{letterSpacing:".05pt"}},"a"),"m"))),i.a.createElement("td",{width:"20%",colSpan:3,style:{width:"20.22%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"54.8pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"4.7pt",lineHeight:"10.1pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},1==(null==d?void 0:d.question3)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"N"),"ữ"))),i.a.createElement("td",{width:"25%",colSpan:2,style:{width:"25.5%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"54.8pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginLeft:"6.0pt",lineHeight:"9.35pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},2==(null==d?void 0:d.question3)?"☑":i.a.createElement("span",null,"▢")," Cả nam và nữ ")))),i.a.createElement("tr",{style:{height:"10.4pt"}},i.a.createElement("td",{width:"6%",valign:"top",style:{width:"6.04%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"10.4pt"}},i.a.createElement("p",{className:"MsoNormal",align:"center",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"0in",textAlign:"center"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"4"))),i.a.createElement("td",{width:"93%",colSpan:7,valign:"top",style:{width:"93.96%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.4pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.4pt"}},i.a.createElement("b",null,i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Trong 6 tháng qua, ")),i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"bạn có:")))),i.a.createElement("tr",{style:{height:"10.3pt"}},i.a.createElement("td",{width:"6%",style:{width:"6.04%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",align:"center",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"0in",textAlign:"center"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"4.1"))),i.a.createElement("td",{width:"48%",colSpan:2,style:{width:"48.24%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.4pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"QHTD đường hậu môn hoặc âm đạo:")),i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"15.45pt",textIndent:"-10.05pt",textAutospace:"none"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"-",i.a.createElement("span",{style:{font:'7.0pt "Times New Roman"'}},"    ")),i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"không sử dụng bao cao su với từ 2 bạn tình trở lên",i.a.createElement("i",null,", ",i.a.createElement("b",null,"hoặc")))),i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"15.45pt",textIndent:"-10.05pt",textAutospace:"none"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"-",i.a.createElement("span",{style:{font:'7.0pt "Times New Roman"'}},"    ")),i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"bạn tình có nguy cơ lây nhiễm HIV cao, ",i.a.createElement("b",null,i.a.createElement("i",null,"hoặc")))),i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"15.45pt",textIndent:"-10.05pt",textAutospace:"none"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"-",i.a.createElement("span",{style:{font:'7.0pt "Times New Roman"'}},"    ")),i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"với người nhiễm HIV chưa điều trị ARV hoặc tải lượng HIV >200 bản sao/mL máu, ",i.a.createElement("b",null,i.a.createElement("i",null,"hoặc")))),i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"15.45pt",textIndent:"-10.05pt",textAutospace:"none"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"-",i.a.createElement("span",{style:{font:'7.0pt "Times New Roman"'}},"    ")),i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"có sử dụng chất gây nghiện khi QHTD, ",i.a.createElement("b",null,i.a.createElement("i",null,"hoặc")))),i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"15.45pt",textIndent:"-10.05pt",textAutospace:"none"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"-",i.a.createElement("span",{style:{font:'7.0pt "Times New Roman"'}},"    ")),i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"có tiền sử mắc hoặc điều trị các BLTQĐTD như lậu, giang mai, chlamydia."))),i.a.createElement("td",{width:"20%",colSpan:3,style:{width:"20.22%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.5pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},0==(null==d?void 0:d.question41)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),"Kh",i.a.createElement("span",{style:{letterSpacing:".05pt"}},"ôn"),"g"))),i.a.createElement("td",{width:"25%",colSpan:2,style:{width:"25.5%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.65pt",lineHeight:"115%"}},i.a.createElement("span",{style:{fontSize:"12.0pt",lineHeight:"115%",fontFamily:'"Times New Roman",serif'}},1==(null==d?void 0:d.question41)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"C"),i.a.createElement("span",{style:{letterSpacing:".15pt"}},"ó"),"/Không trả lời* ")))),i.a.createElement("tr",{style:{height:"10.3pt"}},i.a.createElement("td",{width:"6%",style:{width:"6.04%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",align:"center",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"0in",textAlign:"center"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"4.2"))),i.a.createElement("td",{width:"48%",colSpan:2,style:{width:"48.24%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.4pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Dùng chung dụng cụ tiêm chích với người khác"))),i.a.createElement("td",{width:"20%",colSpan:3,style:{width:"20.22%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.5pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},0==(null==d?void 0:d.question42)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),"Kh",i.a.createElement("span",{style:{letterSpacing:".05pt"}},"ôn"),"g"))),i.a.createElement("td",{width:"25%",colSpan:2,style:{width:"25.5%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.65pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},1==(null==d?void 0:d.question42)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"Có/Không trả lời*"))))),i.a.createElement("tr",{style:{height:"10.3pt"}},i.a.createElement("td",{width:"6%",style:{width:"6.04%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",align:"center",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"0in",textAlign:"center"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"5"))),i.a.createElement("td",{width:"48%",colSpan:2,valign:"top",style:{width:"48.24%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.4pt"}},i.a.createElement("b",null,i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Trong 3 ngày qua,")),i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"bạn có QHTD không dùng BCS hoặc dùng chung dụng cụ tiêm chích với người có HIV hoặc không rõ tình trạng nhiễm HIV "))),i.a.createElement("td",{width:"20%",colSpan:3,style:{width:"20.22%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.5pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},0==(null==d?void 0:d.question5)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),"Kh",i.a.createElement("span",{style:{letterSpacing:".05pt"}},"ôn"),"g"))),i.a.createElement("td",{width:"25%",colSpan:2,style:{width:"25.5%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.65pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},1==(null==d?void 0:d.question5)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"C"),i.a.createElement("span",{style:{letterSpacing:".15pt"}},"ó"),i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"**"))))),i.a.createElement("tr",{style:{height:"10.3pt"}},i.a.createElement("td",{width:"6%",style:{width:"6.04%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",align:"center",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"0in",textAlign:"center"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"6"))),i.a.createElement("td",{width:"48%",colSpan:2,valign:"top",style:{width:"48.24%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.4pt"}},i.a.createElement("b",null,i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Trong 4 tuần qua, ")),i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"bạn có các triệu chứng giống như cảm cúm, viêm họng, vã mồ hôi, sưng hạch, loét miệng, đau đầu hay dị ứng ",i.a.createElement("b",null,i.a.createElement("i",null,"VÀ"))," cho rằng mình có nguy cơ nhiễm HIV"))),i.a.createElement("td",{width:"20%",colSpan:3,style:{width:"20.22%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.5pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},0==(null==d?void 0:d.question6)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),"Kh",i.a.createElement("span",{style:{letterSpacing:".05pt"}},"ôn"),"g"))),i.a.createElement("td",{width:"25%",colSpan:2,style:{width:"25.5%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.65pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},1==(null==d?void 0:d.question6)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"C"),i.a.createElement("span",{style:{letterSpacing:".15pt"}},"ó"),i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"***"))))),i.a.createElement("tr",{style:{height:"10.3pt"}},i.a.createElement("td",{width:"6%",style:{width:"6.04%",border:"solid black 1.0pt",borderTop:"none",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",align:"center",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"0in",textAlign:"center"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"7"))),i.a.createElement("td",{width:"48%",colSpan:2,style:{width:"48.24%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.4pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},"Bạn có nhu cầu sử dụng thuốc?"))),i.a.createElement("td",{width:"20%",colSpan:3,style:{width:"20.22%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.5pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},0==(null==d?void 0:d.question7)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),"Kh",i.a.createElement("span",{style:{letterSpacing:".05pt"}},"ôn"),"g/Không biết"))),i.a.createElement("td",{width:"25%",colSpan:2,style:{width:"25.5%",borderTop:"none",borderLeft:"none",borderBottom:"solid black 1.0pt",borderRight:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.3pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.65pt"}},i.a.createElement("span",{style:{fontSize:"12.0pt",fontFamily:'"Times New Roman",serif'}},1==(null==d?void 0:d.question7)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"C"),i.a.createElement("span",{style:{letterSpacing:".15pt"}},"ó"),"* ")))),i.a.createElement("tr",{height:0},i.a.createElement("td",{width:38,style:{border:"none"}}),i.a.createElement("td",{width:209,style:{border:"none"}}),i.a.createElement("td",{width:62,style:{border:"none"}}),i.a.createElement("td",{width:44,style:{border:"none"}}),i.a.createElement("td",{width:6,style:{border:"none"}}),i.a.createElement("td",{width:64,style:{border:"none"}}),i.a.createElement("td",{width:79,style:{border:"none"}}),i.a.createElement("td",{width:63,style:{border:"none"}})))),i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"0in",marginRight:"0in",marginBottom:".8pt",marginLeft:"26.6pt"}},i.a.createElement("b",null,i.a.createElement("span",{style:{fontSize:"16.0pt",fontFamily:'"Times New Roman",serif'}},"KẾT LUẬN"))),i.a.createElement("table",{className:"MsoNormalTable",border:1,cellSpacing:0,cellPadding:0,width:"102%",style:{width:"102.56%",marginLeft:".5pt",borderCollapse:"collapse",border:"none"}},i.a.createElement("tbody",null,i.a.createElement("tr",{style:{height:"10.25pt"}},i.a.createElement("td",{width:"32%",valign:"top",style:{width:"32.76%",border:"solid black 1.0pt",padding:"0in 0in 0in 0in",height:"10.25pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.35pt"}},i.a.createElement("span",{style:{fontSize:"16.0pt",fontFamily:'"Times New Roman",serif',color:"red"}},1==(null==d?void 0:d.statusResult)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.15pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.3pt"}},"*"),i.a.createElement("span",{style:{letterSpacing:".05pt"}},"Xe"),"m",i.a.createElement("span",{style:{letterSpacing:"-.05pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"x"),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"é"),"t",i.a.createElement("span",{style:{letterSpacing:".05pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"c"),i.a.createElement("span",{style:{letterSpacing:".05pt"}},"h"),"ỉ",i.a.createElement("span",{style:{letterSpacing:".05pt"}}," đ"),"ị",i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"n"),"h",i.a.createElement("span",{style:{letterSpacing:"-.05pt"}}," "),i.a.createElement("span",{style:{letterSpacing:".1pt"}},"P"),"r",i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"E"),"P"))),i.a.createElement("td",{width:"31%",valign:"top",style:{width:"31.02%",border:"solid black 1.0pt",borderLeft:"none",padding:"0in 0in 0in 0in",height:"10.25pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.35pt"}},i.a.createElement("span",{style:{fontSize:"16.0pt",fontFamily:'"Times New Roman",serif',color:"red"}},2==(null==d?void 0:d.statusResult)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.15pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"*"),i.a.createElement("span",{style:{letterSpacing:"-.2pt"}},"*"),i.a.createElement("span",{style:{letterSpacing:".05pt"}},"Đ"),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"á"),i.a.createElement("span",{style:{letterSpacing:".05pt"}},"n"),"h",i.a.createElement("span",{style:{letterSpacing:".05pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"g"),"iá",i.a.createElement("span",{style:{letterSpacing:"-.15pt"}}," "),i.a.createElement("span",{style:{letterSpacing:".1pt"}},"P"),i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"E"),"P"))),i.a.createElement("td",{width:"36%",valign:"top",style:{width:"36.22%",border:"solid black 1.0pt",borderLeft:"none",padding:"0in 0in 0in 0in",height:"10.25pt"}},i.a.createElement("p",{className:"MsoNormal",style:{marginTop:"3.0pt",marginRight:"0in",marginBottom:"3.0pt",marginLeft:"5.15pt"}},i.a.createElement("span",{style:{fontSize:"16.0pt",fontFamily:'"Times New Roman",serif',color:"red"}},3==(null==d?void 0:d.statusResult)?"☑":i.a.createElement("span",null,"▢"),i.a.createElement("span",{style:{letterSpacing:"-.15pt"}}," "),i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"**"),i.a.createElement("span",{style:{letterSpacing:"-.2pt"}},"*"),"T",i.a.createElement("span",{style:{letterSpacing:".05pt"}},"h"),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"e"),"o",i.a.createElement("span",{style:{letterSpacing:".05pt"}}," dõ"),"i",i.a.createElement("span",{style:{letterSpacing:"-.1pt"}},"n"),i.a.createElement("span",{style:{letterSpacing:".05pt"}},"hi"),i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"ễ"),"m",i.a.createElement("span",{style:{letterSpacing:"-.05pt"}}," "),"HIV",i.a.createElement("span",{style:{letterSpacing:"-.05pt"}},"cấ"),"p")))))),i.a.createElement("p",{className:"MsoNormal"},i.a.createElement("span",{style:{fontFamily:'"Times New Roman",serif'}}," ")),i.a.createElement("p",{className:"MsoNormal"},i.a.createElement("span",{style:{fontFamily:'"Times New Roman",serif'}}," "))))),i.a.createElement(n.DialogActions,null,i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{variant:"contained",color:"primary",className:"mr-12 btn btn-primary d-inline-flex",onClick:()=>{this.handleFormSubmit()}},"In"),i.a.createElement(n.Button,{variant:"contained",color:"secondary",className:"btn btn-secondary d-inline-flex",onClick:()=>this.props.handleClose()},"Hủy"))))}}function bo(e){const{formik:t,optionList:a,field:o,variant:r,size:l,listLabelValue:c,disabled:d,action:m,required:u,readOnly:h,isStatusResult:p}=e,[g,f]=i.a.useState(t.values[o]);console.log(t.values,"values");return Object(s.useEffect)(()=>{let{values:e}=t;if(t.values[o]=g,!p){let a;a=1==e.question6?3:1==e.question5?2:1==e.question41||1==e.question42?1:0,t.setFieldValue("statusResult",a)}},[g]),Object(s.useEffect)(()=>{f(t.values[o]),null!=m&&(1==t.values[o]?m(!0):m(!1))}),i.a.createElement(n.FormControl,{fullWidth:!0,variant:r,required:u||!1,disabled:h},i.a.createElement(n.RadioGroup,{row:!0,"aria-label":o,name:o,value:g,onChange:e=>{f(e.target.value)}},i.a.createElement(n.Grid,{container:!0},c.map(e=>i.a.createElement(n.FormControlLabel,{value:e.value,control:i.a.createElement(n.Radio,{disabled:h,color:"primary",size:"medium",checked:g==e.value}),label:e.label,"aria-describedby":o})))),i.a.createElement(n.FormHelperText,{id:o},t.touched[o]&&t.errors[o]))}var yo=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-period-prep-screening/searchByPage";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-period-prep-screening/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-period-prep-screening";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-period-prep-screening"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-period-prep-screening"+e;return v.a.delete(a)}getLoginPatient(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/patient-period-prep-screening/getLoginPatient";return v.a.get(t)}};function Eo(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function _o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Eo(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Eo(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const So=Object(n.makeStyles)(e=>({root:{}}));function Co(e){var t,a;const s=So(),{initialValues:o,handleSubmit:r,handleClose:l,readOnly:c,item:d}=e,[m,u]=i.a.useState(d),[h,p]=i.a.useState(o.highRisk?o.highRisk:[]),[g,f]=i.a.useState(!1),[v,b]=i.a.useState(null),y=e=>{null==_.values[e]&&document.getElementById(e).scrollIntoView({behavior:"smooth",block:"center"})};i.a.useEffect(()=>{if(_.values.highRisk=h,0==h.length)f(!1);else for(var e=0;e<h.length;e++){if(0==h[e]){f(!0);break}f(!1)}},[h]);const E=Ye.object({question1:Ye.mixed().required("Không được để trống"),question2:Ye.mixed().required("Không được để trống"),question3:Ye.mixed().required("Không được để trống"),question41:Ye.mixed().required("Không được để trống"),question42:Ye.mixed().required("Không được để trống"),question5:Ye.mixed().required("Không được để trống"),question6:Ye.mixed().required("Không được để trống"),question7:Ye.mixed().required("Không được để trống")}),_=Object(Y.useFormik)({enableReinitialize:!0,initialValues:o,validationSchema:E,onSubmit:e=>{r(e)}});i.a.useEffect(()=>{u(d)},[]);const[S,C]=i.a.useState(Boolean(1==_.values.question5)),[w,O]=i.a.useState(Boolean(1==_.values.question6)),[x,R]=i.a.useState(!1),[k,I]=i.a.useState(!1);return i.a.createElement("div",{className:s.root},i.a.createElement("form",{onSubmit:_.handleSubmit},i.a.createElement("div",{className:`dialog-body ${e.inTab?"intab":""} `},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0},i.a.createElement(n.Grid,{className:"test-table",item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.Grid,{container:!0,className:"table-tr table-title"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1},"STT"),i.a.createElement(n.Grid,{item:!0,lg:11,md:11,sm:11,xs:11},"Câu hỏi sàng lọc")),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1,className:"align-center"},"1"),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:5,xs:5,className:"align-center"},"Giới tính lúc sinh của bạn"),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:6},i.a.createElement(bo,{formik:_,classes:s,field:"question1",size:"medium",listLabelValue:[{label:"Nam",value:"0"},{label:"Nữ",value:"1"}],variant:"outlined",required:!0,readOnly:e.readOnly}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1,className:"align-center"},"2"),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:5,xs:5,className:"align-center"},"Hiện nay, bạn tự nhận mình thuộc giới tính nào"),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:6},i.a.createElement(bo,{formik:_,classes:s,field:"question2",size:"medium",listLabelValue:[{label:"Nam",value:"0"},{label:"Nữ",value:"1"},{label:"Chuyển giới nữ",value:"2"},{label:"Chuyển giới nam",value:"3"},{label:"Khác",value:"4"}],variant:"outlined",required:!0,readOnly:e.readOnly}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1,className:"align-center"},"3"),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:6,className:"align-center"},"Bạn có quan hệ tình dục với"),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:5,xs:5},i.a.createElement(bo,{formik:_,classes:s,field:"question3",size:"medium",listLabelValue:[{label:"Nam",value:"0"},{label:"Nữ",value:"1"},{label:"Cả nam và nữ",value:"2"}],variant:"outlined",required:!0,readOnly:e.readOnly}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1},"4"),i.a.createElement(n.Grid,{item:!0,lg:11,md:11,sm:11,xs:11},i.a.createElement("b",null,"Trong 6 tháng qua, "),i.a.createElement("span",null,"bạn có:"))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1,className:"align-center"},"4.1"),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:6,className:"align-center d-flex"},i.a.createElement("p",null,"Quan hệ tình dục đường hậu môn hoặc âm đạo:",i.a.createElement("br",null),"- không sử dụng bao cao su với từ 2 bạn tình trở lên, ",i.a.createElement("b",null,"HOẶC"),i.a.createElement("br",null),"- bạn tình có nguy cơ lây nhiễm HIV cao, ",i.a.createElement("b",null,"HOẶC"),i.a.createElement("br",null),"- với người nhiễm HIV chưa điều trị ARV hoặc tải lượng HIV >200 bản sao/mL máu, ",i.a.createElement("b",null,"HOẶC"),i.a.createElement("br",null),"- có sử dụng chất gây nghiện khi quan hệ tình dục, ",i.a.createElement("b",null,"HOẶC"),i.a.createElement("br",null),"- có tiền sử mắc hoặc điều trị các bện lây truyền qua đường tình dục như lậu, giang mai, chlamydia.")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:5,xs:5,className:"align-center d-flex"},i.a.createElement(bo,{formik:_,classes:s,field:"question41",size:"medium",listLabelValue:[{label:"Không",value:"0"},{label:"Có/Không trả lời",value:"1"}],variant:"outlined",readOnly:e.readOnly}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1,className:"align-center"},"4.2"),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:6,className:"align-center"},"Dùng chung dụng cụ tiêm chích"),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:5,xs:5},i.a.createElement(bo,{formik:_,classes:s,field:"question42",size:"medium",listLabelValue:[{label:"Không",value:"0"},{label:"Có/Không trả lời",value:"1"}],variant:"outlined",readOnly:e.readOnly}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1,className:"align-center"},"5"),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:6,className:"align-center"},i.a.createElement("p",null,i.a.createElement("b",null,"Trong 3 ngày qua"),", bạn có quan hệ tình dục không dùng bao cao su hoặc dùng chung dụng cụ tiêm chích với người có HIV hoặc không rõ tình trạng nhiễm HIV ")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:5,xs:5,className:"title-answer align-center d-flex"},i.a.createElement(bo,{formik:_,classes:s,field:"question5",size:"medium",listLabelValue:[{label:"Không",value:"0"},{label:"Có",value:"1",confirm:!0}],variant:"outlined",required:!0,readOnly:e.readOnly}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1,className:"align-center"},"6"),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:6,className:"align-center"},i.a.createElement("div",null,i.a.createElement("b",null,"Trong 4 tuần qua, "),i.a.createElement("span",null,"Bạn có các triệu chứng giống như cảm cúm, viêm họng, vã mồ hôi, sưng hạch, loét miệng, đau đầu hay dị ứng "),i.a.createElement("span",{style:{fontWeight:"bold",fontStyle:"italic"}}," VÀ"),i.a.createElement("span",null," cho rằng mình có nguy cơ nhiễm HIV"))),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:5,xs:5,className:"title-answer align-center d-flex"},i.a.createElement(bo,{formik:_,classes:s,field:"question6",size:"medium",listLabelValue:[{label:"Không",value:"0"},{label:"Có",value:"1",confirm:!0}],variant:"outlined",required:!0,readOnly:e.readOnly}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1,className:"align-center"},"7"),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:6,className:"align-center"},"Theo bạn, bạn có cần sử dụng thuốc không?"),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:5,xs:5,className:"d-flex align-center"},i.a.createElement(bo,{formik:_,classes:s,field:"question7",size:"medium",listLabelValue:[{label:"Không/Không biết",value:"0"},{label:"Có",value:"1"}],variant:"outlined",readOnly:e.readOnly}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr table-title"},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},"Kết luận")),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(Dt,{formik:_,classes:s,field:"statusResult",size:"medium",listLabelValue:[{label:"Không có nguy cơ HIV",value:"0"},{label:"Xem xét chỉ định",value:"1"},{label:"Đánh giá PEP",value:"2"},{label:"Theo dõi nhiễm HIV cấp",value:"3"}],variant:"outlined",required:!0,isStatusResult:!0,readOnly:e.readOnly}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(dt.a,null),className:"mr-12 btn btn-primary d-inline-flex",variant:"contained",color:"primary",onClick:()=>{null!=m&&m.confirmationDate?R(!0):I(!0)}},"In"),!e.readOnly&&i.a.createElement(_e,{startIcon:i.a.createElement(Ae.a,null),className:"mr-12 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit",loading:e.loading,onClick:()=>{y("question7"),y("question6"),y("question5"),y("question42"),y("question41"),y("question3"),y("question2"),y("question1")}},"Lưu kết quả"),x&&i.a.createElement(vo,{item:m,open:x,handleClose:()=>R(!1)}),k&&i.a.createElement(Pt,{open:k,handleSubmit:async e=>{await yo.update(_o(_o({},m),{},{reviewer:e,confirmationDate:new Date})).then(e=>{let{data:t}=e;t&&u(_o({},t))}),I(!1),R(!0)},handleClose:()=>I(!1),content:null!==(t=e.item)&&void 0!==t&&t.reviewerName?null===(a=e.item)||void 0===a?void 0:a.reviewerName:"",title:"Thông tin người rà soát phiếu sàng lọc",label:"Họ và tên",variant:"outlined",required:!0})))))))}function wo(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Oo(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?wo(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wo(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function xo(e){return i.a.createElement(vt.a,e)}class Ro extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"handleFormSubmit",async e=>{this.setState({loading:!0});let{id:t,treatmentPeriod:a,patient:n}=this.state,s={id:t,facilityName:e.facilityName,groupName:e.groupName,otherSouces:e.otherSouces,question1:e.question1,question2:e.question2,question3:e.question3,question41:e.question41,question42:e.question42,question5:e.question5,question6:e.question6,question7:e.question7,highRisk:e.highRisk,medicalStaffEvaluation:e.medicalStaffEvaluation,statusResult:e.statusResult,situationPrep:e.situationPrep,treatmentPeriod:a,patient:n},i={title:"Cập nhật phiếu khảo sát thành công!",text:"Phiếu sàng lọc đã được cập nhật",cancel:"OK"};t?await yo.update(s).then(e=>{let{data:t}=e;t&&(this.setState(Oo({},t)),this.setState({messageBoxContent:i,shouldOpenMessageBox:!0}))}).then(()=>{this.setState({loading:!1})}):await yo.create(s).then(e=>{let{data:t}=e;t&&(this.setState(Oo({},t)),this.setState({messageBoxContent:i,shouldOpenMessageBox:!0}))}).then(()=>{this.setState({loading:!1})}),this.props.updateData()}),Fe()(this,"handleDialogClose",()=>{this.setState({shouldOpenMessageBox:!1}),this.props.handleClose()}),this.state={id:null,source:null,facilityName:null,groupName:null,otherSouces:null,question1:null,question2:null,question3:null,question41:null,question42:null,question5:null,question6:null,question7:null,statusResult:null,highRisk:[],medicalStaffEvaluation:"",situationPrep:!1,resultText:"",shouldOpenMessageBox:!1,shouldOpenMessage:!1,didmountComplete:!1,loading:!1,treatmentPeriod:null,patient:null}}componentDidMount(){let e=this.props.item;e&&this.setState(Oo({},e)),console.log(e,"item")}render(){let{messageBoxContent:e,shouldOpenMessageBox:t}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:xo,fullWidth:!0,maxWidth:"lg"},t&&i.a.createElement(ue,{open:t,title:null==e?void 0:e.title,text:null==e?void 0:e.text,cancel:null==e?void 0:e.cancel,onClose:this.handleDialogClose}),i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white",style:{fontSize:"20px"}}," Xem kết quả sàng lọc "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"inherit"}))),i.a.createElement(Co,{initialValues:{source:this.state.source,facilityName:this.state.facilityName,groupName:this.state.groupName,otherSouces:this.state.otherSouces,question1:this.state.question1,question2:this.state.question2,question3:this.state.question3,question41:this.state.question41,question42:this.state.question42,question5:this.state.question5,question6:this.state.question6,question7:this.state.question7,statusResult:this.state.statusResult,highRisk:this.state.highRisk,medicalStaffEvaluation:this.state.medicalStaffEvaluation},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,item:this.props.item}))}}function ko(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Io(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ko(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ko(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function To(e){return i.a.createElement(vt.a,e)}function Po(e){var t,a;const[o,r]=i.a.useState(!1),l=Ye.object().shape({}),[c,d]=i.a.useState(!1),[m,h]=i.a.useState(null===(t=e.item)||void 0===t?void 0:t.active),[p,g]=Object(s.useState)(null===(a=e.item)||void 0===a?void 0:a.userName),[f,v]=Object(s.useState)(null),[b,y]=Object(s.useState)(!1),[E,_]=Object(s.useState)(!0);Object(s.useEffect)(()=>{p&&y(!0),0==m&&_(!1)},[]);const S=e=>{h(!m)},C=Object(n.withStyles)({root:{color:"rgba(0, 0, 0, 0.54)","&$checked":{color:"rgba(14, 149, 148, 1)"}},checked:{}})(e=>i.a.createElement(n.Radio,u()({color:"default"},e)));return i.a.createElement(n.Dialog,{className:"dialog-container ",open:e.open,PaperComponent:To,fullWidth:!0,maxWidth:"xs",scroll:"paper"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-title-popup",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},"Chi tiết khách hàng"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>e.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Y.Formik,{initialValues:e.item,validationSchema:l,onSubmit:t=>{(t=>{if(1==m||0==m&&p)if(p||f)if(!f&&p&&1==m&&0==E)Ce.toast.warning("Vui lòng nhập mật khẩu",Oe.a.TOAST_CONFIGURE);else if(f&&!p)Ce.toast.warning("Vui lòng nhập tên tài khoản",Oe.a.TOAST_CONFIGURE);else{var a;let t;t=Io(Io({},e.item),{},b?{password:f,active:m}:{userName:p,password:f,active:m}),null!==(a=e.item)&&void 0!==a&&a.id&&Tn.update(t).then(()=>{e.handleClose(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)})}else Ce.toast.warning("Chưa có tài khoản",Oe.a.TOAST_CONFIGURE);else p&&f&&(p||f)||Ce.toast.warning("Tài khoản chưa được kích hoạt",Oe.a.TOAST_CONFIGURE)})()},validateOnChange:!0},t=>{var a,s;let{errors:o,touched:r,setFieldValue:l,values:c}=t;return i.a.createElement(Y.Form,null,i.a.createElement(n.DialogContent,{dividers:!0,className:"scroll-vertical h-70vh over-flow-auto"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("span",{className:"title-field-popup"},"Tên khách hàng"),i.a.createElement(n.TextField,{name:"displayName",variant:"standard",fullWidth:!0,value:null===(a=e.item)||void 0===a?void 0:a.displayName,disabled:!0})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("span",{className:"title-field-popup"},"Thời gian đăng ký"),i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,{size:"small",className:"w-100",margin:"none",id:"estimatedEndTime-picker-dialog",inputVariant:"standard",type:"text",autoOk:!0,format:"dd/MM/yyyy",value:null===(s=e.item)||void 0===s?void 0:s.registrationDate,onChange:()=>{},disabled:!0}))),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("span",{className:"title-field-popup"},"Tên tài khoản"),i.a.createElement(n.TextField,{name:"userName",variant:"standard",fullWidth:!0,value:p,onChange:e=>{g(e.target.value)},disabled:b})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("span",{className:"title-field-popup"},"Mật khẩu"),i.a.createElement(n.TextField,{name:"password",variant:"standard",fullWidth:!0,type:"password",onChange:e=>{v(e.target.value)}})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("span",{className:"title-field-popup"},"Trạng thái sử dụng"),i.a.createElement("div",null,i.a.createElement(C,{checked:1==m,onChange:S,value:!0,name:"radio-button-demo",inputProps:{"aria-label":"A"}}),"Đã kích hoạt"),i.a.createElement("div",null,i.a.createElement(C,{name:"radio-button-demo",onChange:S,checked:0==m,value:!1,inputProps:{"aria-label":"B"}}),"Chưa kích hoạt"))),i.a.createElement(n.Grid,{container:!0,spacing:2,className:"mt-46"},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.Button,{id:"dialog__btn--update",type:"submit"},"Cập nhật"),i.a.createElement(n.Button,{id:"dialog__btn--close",onClick:()=>e.handleClose()},"Đóng")))))}))}function No(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Do(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?No(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):No(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const jo=Object(n.makeStyles)(e=>({root:{}}));function Ao(e){const t=jo(),{initialValues:a,handleSubmit:s,handleClose:o,screeningItem:r,selectTempCode:l,patientId:c}=e,[d,m]=i.a.useState(!1),[h,g]=i.a.useState(null),[f,v]=i.a.useState(!1),[b,y]=i.a.useState(!1),E=()=>{m(!1),v(!1),e.handleSelectLabTest()},_=Ye.object({expectedDate:Ye.mixed().required("Chưa điền ngày xét nghiệm dự kiến")}),S=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:_,onSubmit:e=>{s(e),y(!0)}}),[C,w]=i.a.useState([]),[O,x]=i.a.useState([]);i.a.useEffect(()=>{R(),null!=a&&a.practitioner&&(x(null==a?void 0:a.practitioner),S.setFieldValue("practitioner",null==a?void 0:a.practitioner))},[]);const R=async()=>{await Ua.searchByPage({pageIndex:1,pageSize:1e3,getAllEntity:!1}).then(e=>{let{data:t}=e;t&&w(t.content)})};return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:S.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(P,{formik:S,label:"Ngày gửi yêu cầu",format:"dd/MM/yyyy",field:"requestDate",inputVariant:"outlined",size:"small",readOnly:!0,disablePast:!0})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(p.a,{value:S.values.template?S.values.template:null,id:"patient-filter",onChange:(e,t)=>l(e,t),options:S.values.listTemplate?S.values.listTemplate:[],getOptionLabel:e=>e.name?e.name:"",getOptionSelected:(e,t)=>e.id===t.id,filterSelectedOptions:!0,renderInput:e=>i.a.createElement(n.TextField,u()({},e,{size:"small",variant:"outlined",label:"Lựa chọn bộ mẫu xét nghiệm"}))})),i.a.createElement(n.Grid,{item:!0,sm:12,xs:12},i.a.createElement(p.a,{value:O,size:"medium",id:"practitioner",options:C,getOptionLabel:e=>e.displayName?e.displayName:"",getOptionSelected:(e,t)=>e.id===t.id,onChange:(e,t)=>{x(t),S.setFieldValue("practitioner",t)},renderInput:e=>i.a.createElement(n.TextField,u()({},e,{size:"small",variant:"outlined",label:"Chọn bác sĩ",placeholder:"Chọn bác sĩ"}))})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(P,{formik:S,label:"Ngày xét nghiệm dự kiến",format:"dd/MM/yyyy",field:"expectedDate",inputVariant:"outlined",size:"small",disablePast:!0})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},r&&i.a.createElement(n.Button,{startIcon:i.a.createElement(go.a,null),variant:"contained",className:"mr-12 btn btn-warning d-inline-flex",style:{marginRight:"12px",width:"100%"},onClick:async()=>{m(!0)}},"Xem kết quả sàng lọc")),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.Button,{style:{width:"100%"},variant:"contained",className:"mr-12 btn btn-primary d-inline-flex",onClick:()=>{c&&Tn.getOneById(c).then(e=>{let{data:t}=e;t&&(g(t),v(!0))})}},"Xem thông tin KH")),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(Ia,{isFullWidth:!0,label:"",formik:S,field:"items",variant:"outlined",size:"small",requiredHivTest:!0})))),i.a.createElement(n.Grid,{item:!0,lg:9,md:9,sm:12,xs:12},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12,style:{paddingBottom:0}},i.a.createElement("i",null,"(",i.a.createElement("span",{style:{color:"red"}},"*"),") là xét nghiệm bắt buộc")),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:S.values.items?(k=S.values.items,k.map((e,t)=>Do(Do({},e),{},{index:t+1}))):[],columns:[{title:"STT",field:"index",align:"left",cellStyle:{padding:"10px 10px 10px 14px"},width:"10%"},{title:"Tên xét nghiệm",field:"labTest.name",cellStyle:{padding:"1px 2px 1px 2px",whiteSpace:"nowrap"},render:e=>{var t;let a=null==e||null===(t=e.labTest)||void 0===t?void 0:t.name;return null!=e&&e.compulsoryToDoNewTest?i.a.createElement("span",null,a," ",i.a.createElement("span",{style:{color:"red"}},"*")):a}},{title:"Sinh phẩm",field:"labTest.biologicalTestDtos",cellStyle:{padding:"0px 2px 0px 2px"},render:e=>{null==e||e.labTest.id;return((e,t)=>{var a,s;return i.a.createElement(p.a,{fullWidth:!0,options:e||[],getOptionLabel:e=>e.name,size:"small",defaultValue:null===(a=S.values)||void 0===a||null===(s=a.items[t])||void 0===s?void 0:s.biologicalTest,onChange:(e,a)=>{var n,s,i;null!=(null===(n=S.values)||void 0===n?void 0:n.items)&&(S.values.items[t].biologicalTest=a,S.setFieldValue("items",null===(s=S.values)||void 0===s?void 0:s.items),console.log("itemformik",null===(i=S.values)||void 0===i?void 0:i.items))},renderInput:e=>i.a.createElement(n.TextField,u()({className:"font-inherit",fullWidth:!0,name:"patient"},e)),getOptionSelected:(e,t)=>t===e.id})})(null==e?void 0:e.labTest.biologicalTestDtos,e.index-1)}},{title:"Thao tác",field:"custom",align:"center",cellStyle:{padding:"1px 2px 1px 2px"},render:e=>i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{(e=>{const t=S.values.items.filter(t=>t.labTest.id!==e.labTest.id);S.setFieldValue("items",t)})(e)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem",whiteSpace:"nowrap",padding:"10px"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn})))),d&&i.a.createElement(Ro,{open:d,handleClose:E,item:r,readOnly:!0}),v&&i.a.createElement(Po,{handleClose:()=>E(),open:f,item:h,readOnly:!0}))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(ho.a,null),className:"mr-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit",loading:b},"Xác nhận")))))));var k}var Mo=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-temp/searchByDto";return v.a.post(a,e)}getFirsttesttemplate(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/lab-test-temp/firsttesttemplate";return v.a.get(t)}getByTempCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/getByTempCode/"+e;return v.a.get(a)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/"+e.id;return v.a.put(a,e)}async searchByPageService(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/services/searchByDto";return v.a.post(a,e)}async getById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/"+e;return v.a.get(a)}},Uo=a(457),Lo=a.n(Uo);function Fo(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Bo(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Fo(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Fo(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Vo(e){return i.a.createElement(vt.a,e)}class Go extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"handleFormSubmit",e=>{let t={id:this.state.id,encounter:e.encounter,items:e.items,template:e.template,requestDate:e.requestDate,resultFilePath:e.resultFilePath,expectedDate:e.expectedDate,testCost:e.testCost,paymentStatus:1,testStatus:1,staffInformation:e.staffInformation,paymentMethods:e.paymentMethods,treatmentPeriodId:this.props.treatmentPeriodId,practitioner:e.practitioner};this.state.id?Mo.update(t).then(e=>{if(e&&200==e.status){let e={id:this.props.treatmentPeriodId,encounterId:"00000000-0000-0000-0000-000000000000",status:2};ke.updateTreatmentPeriodStatus(e).then(()=>{this.props.handleClose(),Ce.toast.success("Đã cập nhật xét nghiệm",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})}}):Mo.create(t).then(e=>{if(e&&200==e.status){let e={id:this.props.treatmentPeriodId,encounterId:"00000000-0000-0000-0000-000000000000",status:2};ke.updateTreatmentPeriodStatus(e).then(()=>{this.props.handleClose(),Ce.toast.success("Đã xác nhận xét nghiệm",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})}})}),Fe()(this,"selectTempCode",(e,t)=>{console.log(e,t);let{tempCode:a}=this.state;null!=t&&this.setState({template:t},()=>{Mo.getByTempCode(t.code).then(e=>{let{data:t}=e;this.setState(Bo(Bo({},t),{},{isLoad:!0}))})})}),Fe()(this,"updateData",()=>{}),this.state={id:null,items:[],encounter:{},template:{},requestDate:new Date,resultFilePath:"",isLoad:!1,expectedDate:null,testCost:null,paymentStatus:1,testStatus:null,staffInformation:null,paymentMethods:null,serviceType:null,tempCode:"Lần khám-T0",listTemplate:[],practitioner:null}}async componentDidMount(){var e;await Mo.searchByPage({pageIndex:0,pageSize:100}).then(e=>{let{data:t}=e;this.setState({listTemplate:t.content})}),await Mo.getByTempCode("DT-T0").then(e=>{let{data:t}=e;this.setState(Bo({},t))});let t=null===(e=this.props)||void 0===e?void 0:e.encounter;if(t){let e=null==t?void 0:t.labTestOrder[0];e&&null!=e&&e.id&&await Mo.getById(null==e?void 0:e.id).then(e=>{let{data:t}=e;this.setState(Bo({},t))})}this.setState({isLoad:!0})}render(){return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Vo,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," Chỉ định xét nghiệm "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),this.state.isLoad?i.a.createElement(Ao,{initialValues:{items:this.state.items,encounter:this.state.encounter,template:this.state.template,expectedDate:this.state.expectedDate,requestDate:this.state.requestDate,testCost:this.state.testCost,listTemplate:this.state.listTemplate,staffInformation:this.state.staffInformation,paymentMethods:this.state.paymentMethods,practitioner:this.state.practitioner},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,selectTempCode:this.selectTempCode,screeningItem:this.props.screeningItem,patientId:this.props.patientId,handleSelectLabTest:this.props.handleSelectLabTest}):i.a.createElement(Lo.a,null))}}var zo=a(608),Wo=a.n(zo),Ho=a(134);var Ko=new class{async getAnalytics(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/analytics/getAnalytics";return v.a.post(a,e)}async searchPatient(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/analytics/searchPatient";return v.a.post(a,e)}};function qo(e){return i.a.createElement(vt.a,e)}class Yo extends i.a.Component{constructor(e){super(e),Fe()(this,"onClick",(e,t)=>{this.props.handleChange(e,t),this.props.handleClose()}),this.state={item:{}}}componentDidMount(){let e=this.props.item;e&&this.setState({item:e})}render(){let{item:e}=this.state,{textSearch:t}=this.props;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:qo,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},"Kết quả tìm kiếm"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(n.DialogContent,null,i.a.createElement(n.Grid,{container:!0,spacing:2},null!=t&&i.a.createElement(n.Grid,{item:!0,container:!0,xs:12},"Tìm kiếm cho từ khóa: ",i.a.createElement("a",{style:{fontWeight:"bold",paddingLeft:"10px"}},t)),0!=(null==e?void 0:e.notRegisteredForTreatment)&&i.a.createElement(n.Grid,{item:!0,container:!0,xs:12},i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,xs:8},"Có ",i.a.createElement("b",null,null==e?void 0:e.notRegisteredForTreatment)," kết quả ở Xác nhận thông tin"),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:4},i.a.createElement(n.Button,{variant:"contained",className:"mr-12 btn btn-primary d-inline-flex",color:"primary",onClick:e=>this.onClick(e,0)},"Chuyển Tab"))),0!=(null==e?void 0:e.waitingForTest)&&i.a.createElement(n.Grid,{item:!0,container:!0,xs:12},i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,xs:8},"Có ",i.a.createElement("b",null,null==e?void 0:e.waitingForTest)," kết quả ở Chỉ định xét nghiệm"),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:4},i.a.createElement(n.Button,{variant:"contained",className:"mr-12 btn btn-primary d-inline-flex",color:"primary",onClick:e=>this.onClick(e,1)},"Chuyển Tab"))),0!=(null==e?void 0:e.waitingForTestResult)&&i.a.createElement(n.Grid,{item:!0,container:!0,xs:12},i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,xs:8},"Có ",i.a.createElement("b",null,null==e?void 0:e.waitingForTestResult)," kết quả ở Chờ kết quả xét nghiệm"),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:4},i.a.createElement(n.Button,{variant:"contained",className:"mr-12 btn btn-primary d-inline-flex",color:"primary",onClick:e=>this.onClick(e,2)},"Chuyển Tab"))),0!=(null==e?void 0:e.scheduled)&&i.a.createElement(n.Grid,{item:!0,container:!0,xs:12},i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,xs:8},"Có ",i.a.createElement("b",null,null==e?void 0:e.scheduled)," kết quả ở Chờ khám"),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:4},i.a.createElement(n.Button,{variant:"contained",className:"mr-12 btn btn-primary d-inline-flex",color:"primary",onClick:e=>this.onClick(e,3)},"Chuyển Tab"))),0==(null==e?void 0:e.notRegisteredForTreatment)&&0==(null==e?void 0:e.waitingForTest)&&0==(null==e?void 0:e.waitingForTestResult)&&0==(null==e?void 0:e.scheduled)&&i.a.createElement(n.Grid,{item:!0,xs:12},"Không tìm thấy kết quả nào"))),i.a.createElement("div",{style:{marginBottom:"15px"}}))}}const $o=Object(Ho.withStyles)(e=>Object(n.createStyles)({root:{width:28,height:16,padding:0,display:"flex"},switchBase:{padding:2,color:e.palette.grey[500],"&$checked":{transform:"translateX(12px)",color:e.palette.common.white,"& + $track":{opacity:1,backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main}}},thumb:{width:12,height:12,boxShadow:"none"},track:{border:"1px solid "+e.palette.grey[500],borderRadius:8,opacity:1,backgroundColor:e.palette.common.white},checked:{}}))(n.Switch);class Jo extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.props.updateAnalytics();let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatest:!0,listStatus:[1,2],profileStatus:[4]};this.setState({loadingTable:!0});let t=await to.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loadingTable:!1});let a={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatestTreatmentPeriod:!0,isLatest:!0,status:5};await Ko.getAnalytics(a).then(e=>{let{data:t}=e;this.setState({dataAnalytics:t},()=>{this.state.check&&this.setState({shouldOpenSearchResult:!0})})}),this.setState({selectedList:[]})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenViewLabTest:!1,shouldOpenViewScreening:!1,shouldOpenViewPatientBasic:!1},()=>{this.updatePageData()})}),Fe()(this,"handleCloseSearchResult",()=>{this.setState({shouldOpenSearchResult:!1})}),Fe()(this,"handleEditItem",e=>{this.props.history.push({pathname:y.a.ROOT_PATH+"patient/edit/"+e.id,state:{item:e}})}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e},()=>{})}),Fe()(this,"handleSendRequest",async e=>{let t=await to.sendLinkRequest(e);console.log(t.data)}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{alert(e),gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.props.handleChange(null,null,this.state.text),this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleViewScreening",async(e,t)=>{let a=await to.getPatientPeriodPrepScreeningById(e);this.setState({item:a.data,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewScreening:!0})})}),Fe()(this,"handleSelectLabTest",async e=>{var t;if(null!=e&&e.encounters&&(null==e?void 0:e.encounters.length)>0){let t=null==e?void 0:e.encounters.find(e=>e.isLatestEncounter);t&&await ha.getOneById(null==t?void 0:t.id).then(e=>{let{data:t}=e;this.setState({encounter:t})})}if(null!=(null==e?void 0:e.periodPrepScreening)&&null!=(null==e||null===(t=e.periodPrepScreening)||void 0===t?void 0:t.id)){var a,n;let t=await to.getPatientPeriodPrepScreeningById(null==e||null===(a=e.periodPrepScreening)||void 0===a?void 0:a.id);this.setState({item:t.data,patientId:null==e||null===(n=e.patient)||void 0===n?void 0:n.id,treatmentPeriodId:null==e?void 0:e.id},()=>{this.setState({shouldOpenViewLabTest:!0})})}else{var s;this.setState({item:null,patientId:null==e||null===(s=e.patient)||void 0===s?void 0:s.id,treatmentPeriodId:null==e?void 0:e.id},()=>{this.setState({shouldOpenViewLabTest:!0})})}}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderStatusResult",e=>{let t="",a=Oe.a.ANSWER_SCORE.find(t=>t.value==e);return a&&(t=a.display),t}),Fe()(this,"renderTreatmentPeriodStatus",e=>{let t="",a=Oe.a.TREATMENT_PERIOD_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderServiceType",e=>{let t="",a=Oe.a.SERVICE_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleViewPatientBasic",async e=>{e&&await Tn.getOneById(e).then(e=>{let{data:t}=e;t&&this.setState({patient:t,shouldOpenViewPatientBasic:!0})})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",currentRoomId:"",userName:"",text:"",selectedList:[],shouldOpenViewLabTest:!1,shouldOpenViewScreening:!1,shouldOpenViewPatientBasic:!1,shouldOpenSearchResult:!1,check:!1,dataAnalytics:{},patientId:null,loadingTable:!0}}async componentDidMount(){null!=this.props.textSearch?this.setState({text:this.props.textSearch},()=>{this.updatePageData()}):this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenViewLabTest:t,text:a,treatmentPeriodId:s,shouldOpenViewScreening:o,shouldOpenViewPatientBasic:r,patient:l,encounter:c,check:d,shouldOpenSearchResult:m,dataAnalytics:u,patientId:h}=this.state;const{classes:p,handleChange:g}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},m&&i.a.createElement(Yo,{open:m,handleClose:this.handleCloseSearchResult,item:u,handleChange:(e,t)=>g(e,t,a),textSearch:this.state.text})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12,className:"d-flex align-center"},i.a.createElement(n.FormControl,{component:"fieldset"},i.a.createElement(n.FormGroup,{"aria-label":"position"},i.a.createElement(n.FormControlLabel,{value:"end",control:i.a.createElement($o,{checked:d,onChange:e=>{this.setState({check:e.target.checked})},name:"checked_encounter"}),label:i.a.createElement("span",{style:{marginLeft:"8px"}},"Tìm kiếm tất cả các tab"),labelPlacement:"end"})))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.TextField,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:a,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Tìm kiếm theo Tên và Số điện thoại",id:"search_box",variant:"outlined",InputProps:{endAdornment:i.a.createElement(Wo.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#3366ff",cursor:"pointer"}}),classes:{input:p.input}}}))),t&&i.a.createElement(Go,{handleClose:this.handleClose,open:t,screeningItem:e,treatmentPeriodId:s,encounter:c,patientId:h}),o&&i.a.createElement(Ro,{handleClose:this.handleClose,open:o,item:e,readOnly:!0,treatmentPeriodId:s,handleSelectLabTest:this.handleSelectLabTest}),r&&i.a.createElement(Po,{handleClose:this.handleClose,open:r,item:l,readOnly:!0}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s,o;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),i.a.createElement("div",{className:p.detail},`${this.renderGender(null==e||null===(a=e.patient)||void 0===a?void 0:a.gender)} | ${null!=e&&null!==(n=e.patient)&&void 0!==n&&n.birthDate?Te()(null==e||null===(s=e.patient)||void 0===s?void 0:s.birthDate).format("DD/MM/YYYY"):""} | ${null==e||null===(o=e.patient)||void 0===o?void 0:o.phoneNumber}`))},cellStyle:{padding:"10px",whiteSpace:"nowrap"}},{title:"Dịch vụ sử dụng",field:"custom",cellStyle:{padding:"10px"},render:e=>{var t;return this.renderServiceType(null==e||null===(t=e.patient)||void 0===t?void 0:t.serviceType)}},{title:"Ngày sàng lọc",field:"custom",render:e=>{var t,a;return null!=e&&null!==(t=e.periodPrepScreening)&&void 0!==t&&t.screeningDay?Te()(null==e||null===(a=e.periodPrepScreening)||void 0===a?void 0:a.screeningDay).format("DD/MM/YYYY"):""},cellStyle:{padding:"10px"}},{title:"Kết quả sàng lọc",field:"custom",render:e=>{var t,a,n;let s=this.renderStatusResult(null==e||null===(t=e.periodPrepScreening)||void 0===t?void 0:t.statusResult),o="";return 0==(null==e||null===(a=e.periodPrepScreening)||void 0===a?void 0:a.statusResult)&&(o="bgc-pink-d3 text-pink-d3"),1==(null==e||null===(n=e.periodPrepScreening)||void 0===n?void 0:n.statusResult)&&(o="bgc-green-d1-button"),i.a.createElement("div",{style:{width:"200px"}},i.a.createElement("span",{className:`${p.badge} ${o}`},s))},cellStyle:{padding:"10px",whiteSpace:"nowrap"}},{title:"Trạng thái",field:"custom",render:e=>{let t=this.renderTreatmentPeriodStatus(e.status),a="";return 1==e.status&&(a="bgc-warning-d1-button text-orange-d3"),2==e.status&&(a="bgc-pink-d3 text-pink-d3"),3==e.status&&(a="bgc-green-d1-button"),i.a.createElement("div",{style:{width:"200px"}},i.a.createElement("span",{className:`${p.badge} ${a}`},t))},headerStyle:{},cellStyle:{padding:"10px"}},{title:"Thao tác",field:"custom",type:"numeric",headerStyle:{width:100,maxWidth:100},cellStyle:{width:100,maxWidth:100,padding:"10px"},render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Chỉ định XN"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>this.handleSelectLabTest(e)},i.a.createElement(mo.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"calc(100vh - 326px)",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},icons:dn,localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},onSelectionChange:e=>{this.setState({selectedList:e})},style:{height:"calc(100vh - 320px)",overflow:"auto"}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Qo=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.7rem",fontWeight:"bold"},detail:{fontSize:"1.35rem",color:"#3366ff!important"},badge:{fontWeight:500,padding:"0.5rem 0.5rem",borderRadius:"1rem",position:"relative",width:"fit-content",textAlign:"center",background:" rgba(51, 102, 255, 0.1)",color:"#3366ff"},input:{"&::placeholder":{color:"black !important"}}}))(Jo);var Xo=e=>s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},s.createElement(Qo,null)));var Zo=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/billing/searchByDto";return v.a.post(a,e)}async getById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/billing/"+e;return v.a.get(a)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/billing/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/billing";return v.a.post(a,e)}},er=a(670),tr=a.n(er),ar=a(671),nr=a.n(ar),sr=a(260),ir=a.n(sr),or=a(672),rr=a.n(or),lr=a(288),cr=a.n(lr);const dr=Object(O.makeStyles)(e=>({root:{},head:{backgroundColor:"#3366FF"}})),mr=Object(O.withStyles)(e=>Object(O.createStyles)({head:{backgroundColor:"#3366FF",color:"#FFF"}}))(ir.a);function ur(e){var t;const a=dr(),{initialValues:o,handleSubmit:r,handleClose:l}=e,c=Ye.object({}),d=Object(Y.useFormik)({enableReinitialize:!0,initialValues:o,validationSchema:c,onSubmit:e=>{r(e)}}),[m,u]=Object(s.useState)(d.values.type?d.values.type:null),[h,p]=Object(s.useState)(d.values.status?d.values.status:null),[g,f]=Object(s.useState)(e.data.totalPayment?e.data.totalPayment:null);Object(s.useEffect)(()=>{d.values.type=m},[m]),Object(s.useEffect)(()=>{u(d.values.type)}),Object(s.useEffect)(()=>{d.values.status=h},[h]),Object(s.useEffect)(()=>{p(d.values.status)});const v=e=>{f(e.map(e=>e.amount).reduce((e,t)=>e+t,0))};return console.log(d.values.items),i.a.createElement("div",{className:a.root},i.a.createElement("form",{onSubmit:d.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(S,{formik:d,field:"code",size:"small",label:"Mã xét nghiệm",variant:"outlined",required:!0,disabled:!0})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.TextField,{fullWidth:!0,size:"small",label:"Khách hàng",defaultValue:d.values.patient.displayName,variant:"outlined",disabled:!0})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(P,{formik:d,label:"Ngày yêu cầu",format:"dd/MM/yyyy",field:"requestDate",inputVariant:"outlined",size:"small",disabled:!0})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small",disabled:!0},i.a.createElement(n.InputLabel,{id:"type"},"Loại hoá đơn"),i.a.createElement(n.Select,{labelId:"type",id:"type",value:m,label:"Loại hoá đơn"},Oe.a.BILL_TYPE.map((e,t)=>i.a.createElement(n.MenuItem,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"status"},"Tình trạng thanh toán"),i.a.createElement(n.Select,{labelId:"status",id:"status",value:h,onChange:e=>{p(e.target.value)},label:"Tình trạng thanh toán"},Oe.a.PAYMENT_STATUS_SELECT.map((e,t)=>i.a.createElement(n.MenuItem,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12,className:" d-flex align-center"},"Lần khám: ",null===(t=e.data.encounter)||void 0===t?void 0:t.templateCorrespondingTo),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(tr.a,{className:"table",size:"small","aria-label":"a dense table"},i.a.createElement(rr.a,null,i.a.createElement(cr.a,null,i.a.createElement(mr,null,"STT"),i.a.createElement(mr,{align:"left"},"Tên hàng hoá, Dịch vụ"),i.a.createElement(mr,{align:"left"},"Đơn vị tính"),i.a.createElement(mr,{align:"left"},"Số lượng"),i.a.createElement(mr,{align:"left"},"Đơn giá( VND )"),i.a.createElement(mr,{align:"left"},"Thành tiền"))),i.a.createElement(nr.a,null,d.values.items?d.values.items.map((e,t)=>i.a.createElement(cr.a,{key:t},i.a.createElement(ir.a,{component:"th",scope:"row"},t+1),i.a.createElement(ir.a,{align:"left"},e.description),i.a.createElement(ir.a,{align:"left"},e.unit),i.a.createElement(ir.a,{align:"left"},i.a.createElement(n.TextField,{id:"price-"+t,className:"font-inherit",name:"price",size:"small",variant:"outlined",type:"number",fullWidth:!0,value:e.quantity,onChange:e=>{let a=d.values.items;a[t].quantity=e.target.value,""==e.target.value||""==e.target.value?a[t].amount=0:a[t].amount=parseInt(e.target.value)*a[t].price,v(a),d.setFieldValue("items",a)}})),i.a.createElement(ir.a,{align:"left"},i.a.createElement(n.TextField,{id:"price-"+t,className:"font-inherit",name:"price",size:"small",variant:"outlined",type:"number",fullWidth:!0,value:e.price,onChange:e=>{let a=d.values.items;a[t].price=e.target.value,""==e.target.value||""==e.target.value?a[t].amount=0:a[t].amount=parseInt(e.target.value)*a[t].quantity,v(a),d.setFieldValue("items",a)}})),i.a.createElement(ir.a,{align:"left"},i.a.createElement(ne.a,{thousandsGroupStyle:"thousand",value:e.amount,suffix:"VND",decimalSeparator:".",displayType:"text",type:"text",thousandSeparator:!0,allowNegative:!0})))):"",i.a.createElement(cr.a,null,i.a.createElement(ir.a,{colSpan:3}),i.a.createElement(ir.a,{colSpan:2},"Tổng cộng"),i.a.createElement(ir.a,{align:"left"},i.a.createElement(ne.a,{thousandsGroupStyle:"thousand",value:g,suffix:"VND",decimalSeparator:".",displayType:"text",type:"text",thousandSeparator:!0,allowNegative:!0}))))))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}function hr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function pr(e){return i.a.createElement(vt.a,e)}class gr extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state,n="";n=1==e.resultType?e.minNormalRange+" - "+e.maxNormalRange:e.normalRange;let s={id:a,code:e.code,requestDate:e.requestDate,type:e.type,paymentStatus:e.paymentStatus,items:e.items,status:e.status,appointment:this.state.appointment,labTestOrder:this.state.labTestOrder,prescription:this.state.prescription};a?Zo.update(s).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)}):Zo.save(s).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})}),this.state={id:null,code:"",name:"",requestDate:null,type:null,paymentStatus:null,totalPayment:null,isAddNew:!1,items:[],patient:null,status:null}}componentDidMount(){let e=this.props.item;e&&(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?hr(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):hr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)),e.id&&this.setState({isAddNew:!1}))}render(){return console.log(this.state.id),i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:pr,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1"},i.a.createElement("span",{className:"mb-20 text-white"}," ",this.props.id?"Chỉnh sửa hoá đơn":"Thêm mới hoá đơn"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(ur,{initialValues:{code:this.state.code?this.state.code:"",name:this.state.name?this.state.name:"",requestDate:this.state.requestDate?this.state.requestDate:null,type:this.state.type?this.state.type:null,status:this.state.status?this.state.status:null,paymentStatus:this.state.paymentStatus?this.state.paymentStatus:null,totalPayment:this.state.totalPayment?this.state.totalPayment:null,items:this.state.items?this.state.items:[],patient:this.state.patient?this.state.patient:[]},items:this.state.items,data:this.props.item,handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,isAddNew:this.state.isAddNew}))}}var fr=a(196),vr=a.n(fr),br=a(190),yr=a.n(br),Er=a(199),_r=a.n(Er),Sr=a(232),Cr=a.n(Sr),wr=a(508),Or=a.n(wr),xr=a(509),Rr=a.n(xr),kr=a(510),Ir=a.n(kr);class Tr extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,status:this.props.status,type:this.state.type};this.setState({loadingTable:!0});let t=await Zo.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loadingTable:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1,shouldOpenConfirmPaymentDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleFilterClick",()=>{this.setState({openFilter:!this.state.openFilter}),!1===this.state.openFilter?this.setState({tableHeight:window.innerHeight-420}):this.setState({tableHeight:window.innerHeight-320})}),Fe()(this,"handleConfirmDeleteItem",()=>{}),Fe()(this,"onChangeStatus",(e,t,a)=>{this.setState({status:t?t.value:t},()=>this.updatePageData())}),Fe()(this,"onChangeType",(e,t,a)=>{this.setState({type:t?t.value:t},()=>this.updatePageData())}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"renderPaymentStatus",e=>{let t="",a=Oe.a.PAYMENT_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderType",e=>{let t="",a=Oe.a.BILL_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderPaymentMethod",e=>{let t="",a=Oe.a.PAYMENT_METHOD.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderTestCost",e=>i.a.createElement(ne.a,{thousandsGroupStyle:"thousand",value:e,suffix:"VND",decimalSeparator:".",displayType:"text",type:"text",thousandSeparator:!0,allowNegative:!0})),Fe()(this,"handleOpenConfirmPayment",e=>{this.setState({item:e,shouldOpenConfirmPaymentDialog:!0})}),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1,item:null,id:"",listEncounter:[],status:null,shouldOpenConfirmPaymentDialog:!1,openFilter:!1,loadingTable:!0}}async componentDidMount(){this.updatePageData(),this.setState({tableHeight:window.innerHeight-320})}render(){let{item:e,shouldOpenEditorDialog:t,shouldOpenConfirmationDialog:a,shouldOpenConfirmationDeleteListDialog:s,text:o,status:r,type:c,shouldOpenConfirmPaymentDialog:d}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12,className:"d-flex"},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:o,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})})),i.a.createElement(n.Button,{className:"button-filter ml-20 btn btn-primary d-inline-flex",color:"primary",variant:"contained",startIcon:i.a.createElement(Or.a,null),endIcon:this.state.openFilter?i.a.createElement(Ir.a,null):i.a.createElement(Rr.a,null),onClick:()=>{this.handleFilterClick()}},"Lọc")),i.a.createElement(pe,{openFilter:this.state.openFilter},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(p.a,{fullWidth:!0,options:Oe.a.BILL_TYPE,getOptionLabel:e=>e.name,size:"small",onChange:this.onChangeType,renderInput:e=>i.a.createElement(n.TextField,u()({id:"type",className:"font-inherit",label:"Loại hóa đơn",fullWidth:!0,name:"type"},e)),getOptionSelected:(e,t)=>t===e.value}))),t&&i.a.createElement(gr,{handleClose:this.handleClose,open:t,item:e}),a&&i.a.createElement(l,{open:a,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Khách hàng",field:"patient.displayName",align:"left",width:"150"},{title:"Mã hóa đơn",field:"code",align:"left",width:"150"},{title:"Ngày yêu cầu",field:"requestDate",render:e=>i.a.createElement("span",null,Te()(e.requestDate).format("DD/MM/YYYY"))},{title:"Loại hóa đơn",field:"type",width:"150",render:e=>this.renderType(e.type)},{title:"Trạng thái hóa đơn",field:"paymentStatus",width:"150",render:e=>this.renderPaymentStatus(e.status)},{title:"Giá tiền",align:"left",field:"totalPayment",type:"numeric",render:e=>this.renderTestCost(e.totalPayment)},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Chỉnh sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Zo.getById(e.id);this.handleEditItem(t.data)}},i.a.createElement(rn.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},icons:dn,style:{height:this.state.tableHeight,overflow:"auto"},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}const Pr=["children","value","index"];function Nr(e){const{children:t,value:a,index:n}=e,s=te()(e,Pr);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:1},t))}function Dr(e){return{id:"scrollable-auto-tab-"+e,"aria-controls":"scrollable-auto-tabpanel-"+e}}Nr.propTypes={children:At.a.node,index:At.a.any.isRequired,value:At.a.any.isRequired};const jr=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}}));function Ar(e){const{ref:t,onRegistered:a,threepidInvite:n,roomOobData:s,resizeNotifier:o,roomJustCreatedOpts:r,history:l}=e,c=jr(),[d,m]=i.a.useState(0),[h,p]=i.a.useState({}),[g,f]=i.a.useState(""),[v,b]=i.a.useState(!1),[y,E]=i.a.useState(null),[_,S]=i.a.useState(!1);return i.a.createElement("div",{className:c.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:c.tabHeader,value:d,onChange:(e,t,a)=>{console.log(e,t,a),null!==a&&f(a),null!==t&&m(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},i.a.createElement(_r.a,u()({label:i.a.createElement("div",{className:c.countHeader},i.a.createElement("div",{className:c.titleAnalytics},"Mới lập"))},Dr(0))),i.a.createElement(_r.a,u()({label:i.a.createElement("div",{className:c.countHeader},i.a.createElement("div",{className:c.titleAnalytics},"Phòng khám đã xác nhận"))},Dr(1))),i.a.createElement(_r.a,u()({label:i.a.createElement("div",{className:c.countHeader},i.a.createElement("div",{className:c.titleAnalytics},"Đã chuyển tiền"))},Dr(2))),i.a.createElement(_r.a,u()({label:i.a.createElement("div",{className:c.countHeader},i.a.createElement("div",{className:c.titleAnalytics},"Đã nhận được"))},Dr(3))))),i.a.createElement("div",{className:c.tabPanel},i.a.createElement(Nr,{value:d,index:0},i.a.createElement(Tr,u()({},e,{status:1}))),i.a.createElement(Nr,{value:d,index:1},i.a.createElement(Tr,u()({},e,{status:2}))),i.a.createElement(Nr,{value:d,index:2},i.a.createElement(Tr,u()({},e,{status:3}))),i.a.createElement(Nr,{value:d,index:3},i.a.createElement(Tr,u()({},e,{status:4})))))}var Mr=e=>s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},s.createElement(Ar,null)));var Ur=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/searchByPage";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/treatmentperiod/getOne/"+e;return v.a.get(a)}async getPatientPeriodPrepScreeningById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-period-prep-screening/"+e;return v.a.get(a)}};const Lr=Object(n.makeStyles)(e=>({root:{}}));function Fr(e){const t=Lr(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({code:Ye.string().required(),name:Ye.string().required()}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{console.log("abcd"),s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Drug Code",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Drug Name",variant:"outlined",required:"true"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>o()},"Cancel"),i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Save"))))))}function Br(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Vr(e){return i.a.createElement(vt.a,e)}class Gr extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state;console.log("abcderfasfas");let n={id:a,name:e.name,code:e.code};a?Ur.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):Ur.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={id:"",name:"",code:""}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Br(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Br(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){var e;let{name:t,code:a}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Vr,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Edit Drug":"Create Drug"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Fr,{initialValues:{name:t||"",code:a||""},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose}))}}class zr extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatest:!0,status:0},t=await Ur.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages}),this.setState({selectedList:[]})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenViewScreening:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.props.history.push({pathname:y.a.ROOT_PATH+"patient/edit/"+e.id,state:{item:e}})}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e},()=>{})}),Fe()(this,"handleSendRequest",async e=>{let t=await Ur.sendLinkRequest(e);console.log(t.data)}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{alert(e),gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleViewScreening",(e,t)=>{this.setState({item:e,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewScreening:!0})})}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderStatusResult",e=>{let t="",a=Oe.a.ANSWER_SCORE.find(t=>t.value==e);return a&&(t=a.display),t}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",currentRoomId:"",userName:"",text:"",selectedList:[],shouldOpenViewScreening:!1}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenViewScreening:t,text:a,treatmentPeriodId:s}=this.state,{_roomView:o,onRegistered:r,threepidInvite:l,roomOobData:c,resizeNotifier:d,roomJustCreatedOpts:m}=this.props;const{classes:u}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},t&&i.a.createElement(Ro,{handleClose:this.handleClose,open:t,item:e,readOnly:!0,treatmentPeriodId:s}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:u.displayName},null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),i.a.createElement("div",{className:u.detail},`${this.renderGender(null==e||null===(a=e.patient)||void 0===a?void 0:a.gender)} | ${Te()(null==e||null===(n=e.patient)||void 0===n?void 0:n.birthDate).format("DD/MM/YYYY")} | ${null==e||null===(s=e.patient)||void 0===s?void 0:s.phoneNumber}`))}},{title:"Tài khoản",field:"patient.userName"},{title:"Ngày sàng lọc",field:"custom",render:e=>{var t;return Te()(null==e||null===(t=e.periodPrepScreening)||void 0===t?void 0:t.screeningDay).format("DD/MM/YYYY")}},{title:"Kết quả tạm thời",field:"custom",render:e=>{var t;return this.renderStatusResult(null==e||null===(t=e.periodPrepScreening)||void 0===t?void 0:t.statusResult)}},{title:"",field:"custom",type:"numeric",render:e=>{if(e.periodPrepScreening&&e.periodPrepScreening.id){let t=e.periodPrepScreening.id;return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",variant:"contained",onClick:async()=>{let a=await Ur.getPatientPeriodPrepScreeningById(t);this.handleViewScreening(a.data,e.id)}},"Xác nhận"))}return i.a.createElement(i.a.Fragment,null," ")}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF",fontSize:"1.5rem"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,onSelectionChange:e=>{this.setState({selectedList:e})}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Wr=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.7rem",fontWeight:"bold"},detail:{fontSize:"1.35rem"}}))(zr);var Hr=e=>s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},s.createElement(Wr,null))),Kr=a(127);y.a.API_ENPOINT;var qr=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/customer/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/customer/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/customer";return v.a.post(a,e)}async getById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/customer/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/customer/"+e;return v.a.delete(a)}async getFilterList(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/filter-list";return v.a.post(a,e)}};var Yr=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/ethnicity/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/ethnicity/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/ethnicity";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/ethnicity/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/ethnicity/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/ethnicity/checkCode";return v.a.post(a,e)}};var $r=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/occupation/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/occupation/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/occupation";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/occupation/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/occupation/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/occupation/checkCode";return v.a.post(a,e)}};function Jr(e){const[t,a]=Object(s.useState)([]),[o,r]=Object(s.useState)([]),{item:l,setFieldValue:c,values:d,readOnly:m}=e;Object(s.useEffect)(()=>{"F"!=d.gender&&c("pregnant",null)},[d.gender]),Object(s.useEffect)(()=>{u()},[]);const u=async()=>{await $r.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&a(t.content)}),await Yr.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&r(t.content)})};return i.a.createElement(Y.Form,null,i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15"},i.a.createElement("h3",{className:"text-white m-0"},"Thông tin phòng khám")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"clinicName",label:"Tên phòng khám",defaultValue:null==l?void 0:l.clinicName,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Q,{name:"lastVisit",label:"Lần khám gần nhất",defaultValue:null!=l&&l.lastVisit?null==l?void 0:l.lastVisit:null,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Q,{name:"nextAppointmentDate",label:"Ngày hẹn khám tiếp theo",defaultValue:null!=l&&l.nextAppointmentDate?null==l?void 0:l.nextAppointmentDate:null,setFieldValue:c,disabled:m}))),i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15 mt-16"},i.a.createElement("h3",{className:"text-white m-0"},"Thông tin cá nhân")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Z,{name:"displayName",label:"Họ và tên",defaultValue:null==l?void 0:l.displayName,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Q,{name:"birthDate",label:"Ngày sinh",defaultValue:null!=l&&l.birthDate?null==l?void 0:l.birthDate:null,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(X,{label:"Giới tính",name:"gender",defaultValue:null==l?void 0:l.gender,setFieldValue:c,options:Oe.a.BIRTH_GENDER,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},"F"==d.gender&&i.a.createElement(J,{setFieldValue:c,value:null==d?void 0:d.pregnant,name:"pregnant",label:"Có mang thai",disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement($,{label:"Nghề nghiệp",name:"occupation",defaultValue:null==l?void 0:l.occupation,options:t,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement($,{label:"Dân tộc",name:"ethnicity",defaultValue:null==l?void 0:l.ethnicity,options:o,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Z,{name:"idNumber",label:"CMND",defaultValue:null==l?void 0:l.idNumber,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Z,{name:"email",label:"Email",defaultValue:null==l?void 0:l.email,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"phoneNumber",label:"Số điện thoại",defaultValue:null==l?void 0:l.phoneNumber,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"healthInsuranceNumber",label:"Số thẻ BHYT",defaultValue:null==l?void 0:l.healthInsuranceNumber,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(X,{label:"Loại dịch vụ sử dụng",name:"serviceType",defaultValue:null==l?void 0:l.serviceType,setFieldValue:c,options:Oe.a.SERVICE_TYPE,disabled:m}))),i.a.createElement(de,{setFieldValue:c,defaultValue:l,values:e.values,readOnly:m}),i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15 mt-16"},i.a.createElement("h3",{className:"text-white m-0"},"Thông tin người thân khi cần liên hệ")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"supporterName",label:"Họ và tên",defaultValue:null==l?void 0:l.supporterName,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"supporterAddress",label:"Địa chỉ",defaultValue:null==l?void 0:l.supporterAddress,setFieldValue:c,disabled:m})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"supporterPhoneNumber",label:"Số điện thoại",defaultValue:null==l?void 0:l.supporterPhoneNumber,setFieldValue:c,disabled:m}))))}function Qr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Xr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Qr(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Qr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Zr(e){return i.a.createElement(vt.a,e)}function el(e){const t=Ye.object().shape({});return i.a.createElement(n.Dialog,{className:"dialog-container",open:e.open,PaperComponent:Zr,fullWidth:!0,maxWidth:"lg",scroll:"paper"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},null!=e&&e.reviewProfile?"Xác nhận hồ sơ khách hàng":"Thông tin khách hàng"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>e.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Y.Formik,{initialValues:e.item,validationSchema:t,onSubmit:t=>{(t=>{let a=Xr(Xr({},e.item),{},{prEPcode:t.prEPcode,currentTreatmentStatus:t.currentTreatmentStatus,clinicName:t.clinicName,startDateOfTreatment:t.startDateOfTreatment,lastVisit:t.lastVisit,mostRecentHivTestResults:t.mostRecentHivTestResults,prepRegimen:t.prepRegimen,numberOfMedicinesDispensed:t.numberOfMedicinesDispensed,nextAppointmentDate:t.nextAppointmentDate,displayName:t.displayName,birthDate:t.birthDate,gender:t.gender,occupation:t.occupation,ethnicity:t.ethnicity,idNumber:t.idNumber,email:t.email,phoneNumber:t.phoneNumber,healthInsuranceNumber:t.healthInsuranceNumber,serviceType:t.serviceType,currentResidence:t.currentWard?t.currentWard:t.currentResidence,currentDetailResidence:t.currentDetailResidence,permanentResidence:t.permanentWard?t.permanentWard:t.permanentResidence,permanentDetailResidence:t.permanentDetailResidence,supporterName:t.supporterName,supporterAddress:t.supporterAddress,supporterPhoneNumber:t.supporterPhoneNumber,pregnant:t.pregnant});null!=a&&a.id?qr.update(a).then(()=>{Ce.toast.success("Đã cập nhật",Oe.a.TOAST_CONFIGURE),e.handleClose()}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)}):qr.create(a).then(()=>{Ce.toast.warning("Thêm thành công",Oe.a.TOAST_CONFIGURE),e.handleClose()})})(t)},validateOnChange:!0},t=>{let{errors:a,touched:s,setFieldValue:o,values:r}=t;return i.a.createElement(Y.Form,null,i.a.createElement(n.DialogContent,{dividers:!0,className:"scroll-vertical h-70vh over-flow-auto"},i.a.createElement(Jr,{item:e.item,setFieldValue:o,values:r,readOnly:e.readOnly})),i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))}))}class tl extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,display_name:this.state.display_name,wardId:this.state.wardId,provinceId:this.state.provinceId,districtId:this.state.districtId,status:this.state.status},t=await qr.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"getUserLogin",async()=>{let e=await Ot.getAllInfoByUserLogin();this.setState({userLogin:e.data})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{qr.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"onChangeNamePatient",(e,t,a)=>{this.setState({display_name:t},()=>this.updatePageData())}),Fe()(this,"onChangeStatus",(e,t,a)=>{this.setState({status:t?t.value:t},()=>this.updatePageData())}),Fe()(this,"onChangeProvince",(e,t,a)=>{this.setState({provinceId:t?t.id:t},()=>this.updatePageData())}),Fe()(this,"onChangeDistrict",(e,t,a)=>{this.setState({districtId:t?t.id:t},()=>this.updatePageData())}),Fe()(this,"onChangeWard",(e,t,a)=>{this.setState({wardId:t?t.id:t},()=>this.updatePageData())}),Fe()(this,"getListNamePatient",()=>{qr.getFilterList({filterType:1}).then(e=>{let{data:t}=e;this.setState({listNamePatient:t})})}),Fe()(this,"getListStatus",()=>{qr.getFilterList({filterType:4}).then(e=>{let{data:t}=e;this.setState({listStatus:t})})}),Fe()(this,"getListProvince",()=>{qr.getFilterList({filterType:5}).then(e=>{let{data:t}=e;this.setState({listProvince:t})})}),Fe()(this,"getListDistrict",()=>{qr.getFilterList({filterType:6}).then(e=>{let{data:t}=e;this.setState({listDistrict:t})})}),Fe()(this,"getListWard",()=>{qr.getFilterList({filterType:7}).then(e=>{let{data:t}=e;this.setState({listWard:t})})}),Fe()(this,"handleFilterClick",()=>{this.setState({openFilter:!this.state.openFilter}),!1===this.state.openFilter?this.setState({tableHeight:window.innerHeight-350}):this.setState({tableHeight:window.innerHeight-270})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"renderTreatmentPeriodStatus",e=>{let t="",a=Oe.a.TREATMENT_PERIOD_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:-1,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1,item:null,id:"",openFilter:!1,listNamePatient:[],listStatus:[],listProvince:[],listDistrict:[],listWard:[]}}async componentDidMount(){this.updatePageData(),this.getListNamePatient(),this.getListStatus(),this.getListProvince(),this.getListDistrict(),this.getListWard(),this.getUserLogin(),this.setState({tableHeight:window.innerHeight-270})}render(){var e,t;let{item:a,shouldOpenEditorDialog:s,shouldOpenConfirmationDialog:o,shouldOpenConfirmationDeleteListDialog:r}=this.state;const{classes:c}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary",className:c.icon}),i.a.createElement("span",{className:c.icon},"Khách hàng tại phòng khám"))),i.a.createElement(n.Grid,{item:!0,xs:7},((null===(e=this.state.userLogin)||void 0===e?void 0:e.admin)||(null===(t=this.state.userLogin)||void 0===t?void 0:t.clinic))&&i.a.createElement(n.Button,{className:"mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,xs:3},s&&i.a.createElement(el,{handleClose:this.handleClose,open:s,item:a}),o&&i.a.createElement(l,{open:o,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận",text:"Bạn có chắc muốn xoá bản ghi này",agree:"Xoá",cancel:"Đóng"})),i.a.createElement(n.Grid,{item:!0,xs:2},i.a.createElement(n.Button,{className:" btn btn-primary d-inline-flex button-filter float-right",color:"primary",variant:"contained",startIcon:i.a.createElement(Or.a,null),endIcon:this.state.openFilter?i.a.createElement(Ir.a,null):i.a.createElement(Rr.a,null),onClick:()=>{this.handleFilterClick()}},"Lọc")),i.a.createElement(pe,{openFilter:this.state.openFilter},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Se.Autocomplete,{fullWidth:!0,options:this.state.listProvince?this.state.listProvince:[],getOptionLabel:e=>e.name,size:"small",onChange:this.onChangeProvince,renderInput:e=>i.a.createElement(n.TextField,u()({id:"province",className:"font-inherit",label:"Tỉnh / Thành phố",fullWidth:!0,name:"province"},e)),getOptionSelected:(e,t)=>t===e.id})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Se.Autocomplete,{fullWidth:!0,options:this.state.listDistrict?this.state.listDistrict:[],getOptionLabel:e=>e.name,size:"small",onChange:this.onChangeDistrict,renderInput:e=>i.a.createElement(n.TextField,u()({id:"district",className:"font-inherit",label:"Huyện",fullWidth:!0,name:"district"},e)),getOptionSelected:(e,t)=>t===e.id})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Se.Autocomplete,{fullWidth:!0,options:this.state.listWard?this.state.listWard:[],getOptionLabel:e=>e.name,size:"small",onChange:this.onChangeWard,renderInput:e=>i.a.createElement(n.TextField,u()({id:"ward",className:"font-inherit",label:"Xã",fullWidth:!0,name:"ward"},e)),getOptionSelected:(e,t)=>t===e.id}))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%",height:"calc(100vh - 200px)"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Khách hàng",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:c.displayName},null==e?void 0:e.displayName),i.a.createElement("div",{className:c.detail},`${this.renderGender(null==e?void 0:e.gender)}${null!=e&&e.birthDate?" | "+Te()(null==e?void 0:e.birthDate).format("DD/MM/YYYY"):""}${null!=e&&e.phoneNumber?" | "+(null==e?void 0:e.phoneNumber):""}`))},{title:"Mã KH",field:"prEPcode"},{title:"Ngày bắt đầu điều trị",field:"custom",render:e=>null===(null==e?void 0:e.startDateOfTreatment)?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,"Chưa có")):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,Te()(null==e?void 0:e.startDateOfTreatment).format("DD/MM/YYYY")))},{title:"Ngày khám tiếp theo",field:"custom",render:e=>null===(null==e?void 0:e.nextAppointmentDate)?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,"Chưa có")):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,Te()(null==e?void 0:e.nextAppointmentDate).format("DD/MM/YYYY")))},{title:"Địa chỉ",field:"custom",cellStyle:{padding:"2px",minWidth:"450px"},render:e=>{var t,a,n,s,o,r;return e.currentResidence?i.a.createElement("div",null,`${null===(t=e.currentResidence)||void 0===t?void 0:t.name}/${null===(a=e.currentResidence)||void 0===a||null===(n=a.parent)||void 0===n?void 0:n.name}/${null===(s=e.currentResidence)||void 0===s||null===(o=s.parent)||void 0===o||null===(r=o.parent)||void 0===r?void 0:r.name}`):i.a.createElement("div",null)}},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Chỉnh sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await qr.getById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{overflow:"auto",height:this.state.tableHeight},icons:dn,isLoading:!(this.state.totalElements>=0)}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var al=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.7rem"},detail:{fontSize:"1.35rem"},icon:{marginRight:e.spacing(.5)}}))(tl);function nl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function sl(e){return i.a.createElement(vt.a,e)}class il extends i.a.Component{constructor(e){super(e)}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?nl(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){const e=On.getComponent("structures.GlobitsRoomView");let{_roomView:t,onRegistered:a,threepidInvite:s,currentRoomId:o,roomOobData:r,resizeNotifier:l,roomJustCreatedOpts:c,handleClose:d}=this.props;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:sl,fullWidth:!0,maxWidth:"md"},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.IconButton,{style:{position:"absolute",right:"10px",top:"10px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"})),i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement("div",{className:"chat-box",style:{display:"contents"}},i.a.createElement(e,{ref:t,onRegistered:a,threepidInvite:s,oobData:r,key:o,roomId:o,resizeNotifier:l,justCreatedOpts:c,style:{padding:"20px"}})))))}}var ol=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-support-staff/searchByPage";return v.a.post(a,e)}async getById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-support-staff/"+e;return v.a.get(a)}async getOnePatientById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/getOne/"+e;return v.a.get(a)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-support-staff/"+e.id;return v.a.put(a,e)}},rl=a(1470),ll=a.n(rl),cl=a(1455);class dl extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage},t=await ol.searchByPage(e);if(t.data.content.length>0){let e=t.data.content[0].linkId;this.setState({currentRoomId:e})}this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e})}),Fe()(this,"handleSelectedBox",(e,t)=>{this.setState({selectedBox:e}),this.handleChat(t)}),Fe()(this,"handleSendRequest",e=>{this.setState({shouldOpenConfirmationDialog:!0,ppId:e})}),Fe()(this,"confirmSendLinkRequest",async()=>{this.setState({waitSendRequest:!0},()=>{this.state.waitSendRequest&&ol.updateLinkRequestById(this.state.ppId).then(()=>{this.setState({waitSendRequest:!1}),this.handleClose(),Ce.toast.success("Xác nhận kết nối thành công",Oe.a.TOAST_CONFIGURE)}).catch(()=>{this.setState({waitSendRequest:!1}),this.handleClose(),Ce.toast.error("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})})}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),this.state={data:[],page:1,totalPages:null,rowsPerPage:50,totalElements:null,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",currentRoomId:"",userName:"",ppId:"",practitionerId:"",waitSendRequest:!1,selectedBox:null}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),console.log("height",window.innerHeight),this.setState({tableHeight:window.innerHeight-100})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){const e=On.getComponent("structures.GlobitsRoomView");let{item:t,shouldOpenChatDialog:a,currentRoomId:s,shouldOpenConfirmationDialog:o}=this.state,{_roomView:r,onRegistered:c,threepidInvite:d,roomOobData:m,resizeNotifier:u,roomJustCreatedOpts:h}=this.props;const{classes:p}=this.props;return i.a.createElement("div",null,i.a.createElement("div",{className:"height-100-90px"},a&&i.a.createElement(il,{handleClose:this.handleClose,open:a,item:t,ref:r,onRegistered:c,threepidInvite:d,roomOobData:m,currentRoomId:s,resizeNotifier:u,roomJustCreatedOpts:h}),o&&i.a.createElement(l,{open:o,onConfirmDialogClose:this.handleClose,onYesClick:this.confirmSendLinkRequest,title:"Xác nhận",loading:this.state.waitSendRequest,text:"Xác nhận yêu cầu kết nối?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{container:!0,spacing:2,style:{display:"flex",height:"100%"}},i.a.createElement(n.Grid,{item:!0,md:4,style:{width:"100%",height:"100%"},className:"support-grid"},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Khách hàng",field:"custom",align:"left",headerStyle:{top:"8px !important"},render:e=>{var t;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"chatbox-icon "+(e.id===this.state.selectedBox?"chatbox-icon-active":""),onClick:()=>this.handleSelectedBox(e.id,e.linkId),style:{padding:"5px 0px 5px 10px",display:"flex",alignItems:"center"}},i.a.createElement("div",{style:{borderRadius:"50%",height:"50px",width:"50px",border:"1px solid grey",marginRight:"12px",display:"flex",justifyContent:"center",alignItems:"center"}},i.a.createElement(cl.Person,{style:{fontSize:"40px"}})),i.a.createElement("div",{style:{marginRight:"auto"},className:p.displayName},null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),(null===e.linkId||2!==e.linkStatus)&&i.a.createElement(gt,{title:"Kết nối lại"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>{ol.update(e).then(e=>{let{data:t}=e;t&&2==t.linkStatus?(Ce.toast.success("Kết nối thành công"),this.updatePageData()):Ce.toast.warning("Kết nối không thành công.")})}},i.a.createElement(ll.a,{fontSize:"large",color:"primary",style:{marginRight:"10px"}})))))},cellStyle:{cursor:"pointer",padding:"0px"}}],options:{draggable:!1,selection:!1,paging:!1,search:!1,sorting:!1,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"}},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn})),i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,style:{backgroundColor:"aliceblue"}},s&&i.a.createElement(e,{ref:r,onRegistered:c,threepidInvite:d,oobData:m,key:s,roomId:s,room:s,resizeNotifier:u,justCreatedOpts:h,style:{padding:"20px"}})))))}}var ml=Object(Ho.withStyles)(e=>({detail:{color:"#3366ff"}}))(dl);var ul=e=>{let{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:i,roomJustCreatedOpts:o,resizeNotifier:r,history:l}=e;return s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},s.createElement(ml,{ref:t,onRegistered:a,threepidInvite:n,roomOobData:i,resizeNotifier:r,roomJustCreatedOpts:o,history:l})))},hl=a(1468),pl=a.n(hl);const gl=Object(Ho.withStyles)(e=>Object(n.createStyles)({root:{width:28,height:16,padding:0,display:"flex"},switchBase:{padding:2,color:e.palette.grey[500],"&$checked":{transform:"translateX(12px)",color:e.palette.common.white,"& + $track":{opacity:1,backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main}}},thumb:{width:12,height:12,boxShadow:"none"},track:{border:"1px solid "+e.palette.grey[500],borderRadius:8,opacity:1,backgroundColor:e.palette.common.white},checked:{}}))(n.Switch);class fl extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.props.updateAnalytics(),this.setState({loadingTable:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,patientStatusDifferent:Oe.a.BEINGTREATED.value},t=await Ko.searchPatient(e);t.data.content&&this.setState({data:t.data.content.filter(e=>4!==e.profileStatus),loadingTable:!1}),this.setState({totalElements:t.data.totalElements,totalPages:t.data.totalPages});let a={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatestTreatmentPeriod:!0,isLatest:!0,status:5};await Ko.getAnalytics(a).then(e=>{let{data:t}=e;this.setState({dataAnalytics:t},()=>{this.state.check&&this.setState({shouldOpenSearchResult:!0})})}),this.setState({selectedList:[]})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenViewLabTest:!1,shouldOpenViewScreening:!1,shouldOpenReviewProfile:!1,shouldOpenSearchResult:!1,shouldOpenRequestUpdate:!1},()=>{this.updatePageData()})}),Fe()(this,"handleCloseSearchResult",()=>{this.setState({shouldOpenSearchResult:!1})}),Fe()(this,"handleEditItem",e=>{this.props.history.push({pathname:y.a.ROOT_PATH+"patient/edit/"+e.id,state:{item:e}})}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e},()=>{})}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{alert(e),gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.props.handleChange(null,null,this.state.text),this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleViewPatient",async e=>{this.props.history.push({pathname:y.a.ROOT_PATH+"patient/edit/"+e})}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderStatusResult",e=>{let t="",a=Oe.a.ANSWER_SCORE.find(t=>t.value==e);return a&&(t=a.display),t}),Fe()(this,"renderTreatmentPeriodStatus",e=>{let t="",a=Oe.a.TREATMENT_PERIOD_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderAdminUnit",e=>{var t;const{classes:a}=this.props;let n="",s="";var o,r,l;null!=e&&e.parent&&(s=null==e||null===(o=e.parent)||void 0===o?void 0:o.name);null!=e&&null!==(t=e.parent)&&void 0!==t&&t.parent&&(n=null==e||null===(r=e.parent)||void 0===r||null===(l=r.parent)||void 0===l?void 0:l.name);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,n),i.a.createElement("div",{className:a.detail+" text-purple"},s))}),Fe()(this,"renderServiceType",e=>{let t="",a=Oe.a.SERVICE_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleReviewProfile",async e=>{e&&await Tn.getOneById(e).then(e=>{let{data:t}=e;t&&this.setState({patient:t,shouldOpenReviewProfile:!0})})}),Fe()(this,"renderProfileStatus",e=>{let t="",a=Oe.a.PATIENT_PROFILE_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleOpenRequestUpdate",async e=>{e&&await Tn.getOneById(e).then(e=>{let{data:t}=e;t&&this.setState({patient:t,shouldOpenRequestUpdate:!0})})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",currentRoomId:"",userName:"",text:"",selectedList:[],shouldOpenViewLabTest:!1,shouldOpenViewScreening:!1,shouldOpenReviewProfile:!1,shouldOpenSearchResult:!1,check:!1,dataAnalytics:{},shouldOpenRequestUpdate:!1,loadingTable:!0}}async componentDidMount(){null!=this.props.textSearch?this.setState({text:this.props.textSearch},()=>{this.updatePageData()}):this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenViewLabTest:t,text:a,treatmentPeriodId:s,shouldOpenViewScreening:o,check:r,patient:l,shouldOpenReviewProfile:c,shouldOpenSearchResult:d,dataAnalytics:m,shouldOpenRequestUpdate:u}=this.state;console.log(this.state.data);let{_roomView:h,onRegistered:p,threepidInvite:g,roomOobData:f,resizeNotifier:v,roomJustCreatedOpts:b,handleChange:y}=this.props;const{classes:E}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},d&&i.a.createElement(Yo,{open:d,handleClose:this.handleCloseSearchResult,item:m,handleChange:(e,t)=>y(e,t,a),textSearch:this.state.text})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12,className:"d-flex align-center"},i.a.createElement(n.FormControl,{component:"fieldset"},i.a.createElement(n.FormGroup,{"aria-label":"position"},i.a.createElement(n.FormControlLabel,{value:"end",control:i.a.createElement(gl,{checked:r,onChange:e=>{this.setState({check:e.target.checked})},name:"checked_encounter"}),label:i.a.createElement("span",{style:{marginLeft:"8px"}},"Tìm kiếm tất cả các tab"),labelPlacement:"end"})))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.TextField,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:a,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Tìm kiếm theo Tên và Số điện thoại",id:"search_box",variant:"outlined",InputProps:{endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#3366ff",cursor:"pointer"}}),classes:{input:E.input}}}))),c&&i.a.createElement(Po,{handleClose:this.handleClose,open:c,item:l,readOnly:!0,reviewProfile:!0}),u&&i.a.createElement(Pt,{open:u,handleClose:this.handleClose,content:null==l?void 0:l.profileRequestUpdate,readOnly:!0,title:"Yêu cầu cập nhật thông tin của KH",label:"Nội dung yêu cầu",multiline:!0,minRows:4,variant:"outlined",agreeButton:"Chỉnh sửa hồ sơ KH",handleSubmit:()=>{this.handleViewPatient(null==l?void 0:l.id)}}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{isLoading:this.state.loadingTable,data:this.state.data,columns:[{title:"Khách hàng",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e?void 0:e.displayName),i.a.createElement("div",{className:E.detail},`${this.renderGender(null==e?void 0:e.gender)}  ${null!=e&&e.birthDate?"| "+Te()(null==e?void 0:e.birthDate).format("DD/MM/YYYY"):""} `),i.a.createElement("div",{className:E.detail},null==e?void 0:e.phoneNumber)),cellStyle:{padding:"10px",whiteSpace:"nowrap"}},{title:"Dịch vụ sử dụng",field:"custom",cellStyle:{padding:"10px"},render:e=>this.renderServiceType(e.serviceType)},{title:"Dân tộc",field:"ethnicity.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Nghề nghiệp",field:"occupation.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Địa chỉ",field:"custom",cellStyle:{padding:"10px",minWidth:"110px"},render:e=>this.renderAdminUnit(e.currentResidence)},{title:"Ngày tạo tài khoản",field:"",align:"left",cellStyle:{padding:"10px"},render:e=>null!=e&&e.registrationDate?Te()(null==e?void 0:e.registrationDate).format("DD/MM/YYYY HH:mm:ss"):""},{title:"Trạng thái hồ sơ",field:"",cellStyle:{padding:"10px",minWidth:"200px"},render:e=>{let t=this.renderProfileStatus(null==e?void 0:e.profileStatus),a="";return 3!=e.profileStatus&&5!=e.profileStatus||(a="bgc-warning-d1-button text-orange-d3"),2==e.profileStatus&&(a="bgc-pink-d3 text-pink-d3"),4==e.profileStatus&&(a="bgc-green-d1-button"),i.a.createElement("span",{className:`${E.badge} ${a}`},t)}},{title:"Xác nhận hồ sơ",field:"custom",type:"numeric",cellStyle:{padding:"10px",width:"60px"},render:e=>{let t=null==e?void 0:e.profileStatus;return i.a.createElement(i.a.Fragment,null,5==t&&i.a.createElement(gt,{title:"Xem yêu cầu cập nhật thông tin"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleOpenRequestUpdate(e.id)}},i.a.createElement(pl.a,{fontSize:"large",color:"inherit",className:"text-pink"}))),i.a.createElement(gt,{title:"Xác nhận hồ sơ khách hàng"},i.a.createElement(n.IconButton,{size:"small"},i.a.createElement("img",{style:{width:"18px",objectFit:"contain",borderRadius:"5px"},src:"themes/element/img/logos/ConfirmIcon4.png",onClick:async()=>{this.handleViewPatient(e.id)}}))))}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"calc(100vh - 326px)",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},icons:dn,localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},onSelectionChange:e=>{this.setState({selectedList:e})},style:{height:"calc(100vh - 326px)",overflow:"auto"}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var vl=Object(Ho.withStyles)(e=>({detail:{fontSize:"1.35rem",color:"#3366ff!important"},input:{"&::placeholder":{color:"black !important"}},badge:{fontWeight:500,padding:"0.5rem 0.5rem",borderRadius:"1rem",position:"relative",width:"fit-content",textAlign:"center",background:" rgba(51, 102, 255, 0.1)",color:"#3366ff"}}))(fl),bl=a(610),yl=a.n(bl),El=a(609),_l=a.n(El);const Sl=Object(Ho.withStyles)(e=>Object(n.createStyles)({root:{width:28,height:16,padding:0,display:"flex"},switchBase:{padding:2,color:e.palette.grey[500],"&$checked":{transform:"translateX(12px)",color:e.palette.common.white,"& + $track":{opacity:1,backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main}}},thumb:{width:12,height:12,boxShadow:"none"},track:{border:"1px solid "+e.palette.grey[500],borderRadius:8,opacity:1,backgroundColor:e.palette.common.white},checked:{}}))(n.Switch);class Cl extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.props.updateAnalytics();let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatestTreatmentPeriod:!0,isLatest:!0,status:5};this.setState({loadingTable:!0});let t=await to.searchByPageEncounter(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loadingTable:!1});let a={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatestTreatmentPeriod:!0,isLatest:!0,status:5};await Ko.getAnalytics(a).then(e=>{let{data:t}=e;this.setState({dataAnalytics:t},()=>{this.state.check&&this.setState({shouldOpenSearchResult:!0})})}),this.setState({selectedList:[]})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenViewPatientBasic:!1},()=>{this.updatePageData()})}),Fe()(this,"handleCloseSearchResult",()=>{this.setState({shouldOpenSearchResult:!1})}),Fe()(this,"handleEditItem",e=>{this.props.history.push({pathname:y.a.ROOT_PATH+"patient/edit/"+e.id,state:{item:e}})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.props.handleChange(null,null,this.state.text),this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleViewScreening",async(e,t)=>{let a=await to.getPatientPeriodPrepScreeningById(e);this.setState({item:a.data,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewScreening:!0})})}),Fe()(this,"handleSelectLabTest",async(e,t)=>{let a=await to.getPatientPeriodPrepScreeningById(e);this.setState({item:a.data,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewLabTest:!0})})}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderStatusResult",e=>{let t="",a=Oe.a.ANSWER_SCORE.find(t=>t.value==e);return a&&(t=a.display),t}),Fe()(this,"renderTreatmentPeriodStatus",e=>{let t="",a=Oe.a.TREATMENT_PERIOD_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleViewPatientBasic",async e=>{e&&await Tn.getOneById(e).then(e=>{let{data:t}=e;t&&this.setState({patient:t,shouldOpenViewPatientBasic:!0})})}),Fe()(this,"handleViewItem",async e=>{let t=await Tn.getOneById(e);t&&this.props.history.push({pathname:y.a.ROOT_PATH+"medical-record/"+e,state:{item:t.data}})}),Fe()(this,"renderServiceType",e=>{let t="",a=Oe.a.SERVICE_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderAdminUnit",e=>{var t;const{classes:a}=this.props;let n="",s="";var o,r,l;null!=e&&e.parent&&(s=null==e||null===(o=e.parent)||void 0===o?void 0:o.name);null!=e&&null!==(t=e.parent)&&void 0!==t&&t.parent&&(n=null==e||null===(r=e.parent)||void 0===r||null===(l=r.parent)||void 0===l?void 0:l.name);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,n),i.a.createElement("div",{className:""+a.detail},s))}),Fe()(this,"renderSlot",e=>{let t="";var a,n;e&&(t=`${Te()(null==e||null===(a=e.slot)||void 0===a?void 0:a.start).format("HH:mm")} - ${Te()(null==e||null===(n=e.slot)||void 0===n?void 0:n.end).format("HH:mm")}`);return t}),Fe()(this,"renderPractitioners",e=>{const{classes:t}=this.props;let a=null==e?void 0:e.practitioners;console.log(e),console.log(a);let n=null;return a&&a.length>0&&(n=i.a.createElement("ul",{className:t.ulTable},a.map(e=>{var t;const{classes:a}=this.props;return i.a.createElement("li",{className:a.liItem},i.a.createElement("span",{className:""+a.badge},null==e||null===(t=e.practitioner)||void 0===t?void 0:t.displayName))}))),n}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",currentRoomId:"",userName:"",text:"",selectedList:[],shouldOpenViewLabTest:!1,shouldOpenViewScreening:!1,shouldOpenViewPatientBasic:!1,shouldOpenSearchResult:!1,check:!1,dataAnalytics:{},loadingTable:!0}}async componentDidMount(){null!=this.props.textSearch?this.setState({text:this.props.textSearch},()=>{this.updatePageData()}):this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}render(){let{item:e,shouldOpenViewLabTest:t,text:a,treatmentPeriodId:s,shouldOpenViewScreening:o,shouldOpenViewPatientBasic:r,patient:l,check:c,shouldOpenSearchResult:d,dataAnalytics:m}=this.state,{_roomView:u,onRegistered:h,threepidInvite:p,roomOobData:g,resizeNotifier:f,roomJustCreatedOpts:v,handleChange:b}=this.props;const{classes:y}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},d&&i.a.createElement(Yo,{open:d,handleClose:this.handleCloseSearchResult,item:m,handleChange:(e,t)=>b(e,t,a),textSearch:this.state.text})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12,className:"d-flex align-center"},i.a.createElement(n.FormControl,{component:"fieldset"},i.a.createElement(n.FormGroup,{"aria-label":"position"},i.a.createElement(n.FormControlLabel,{value:"end",control:i.a.createElement(Sl,{checked:c,onChange:e=>{this.setState({check:e.target.checked})},name:"checked_encounter"}),label:i.a.createElement("span",{style:{marginLeft:"8px"}},"Tìm kiếm tất cả các tab"),labelPlacement:"end"})))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12,className:"d-flex align-center"},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.TextField,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:a,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Tìm kiếm theo Tên và Số điện thoại",id:"search_box",variant:"outlined",InputProps:{endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#3366ff",cursor:"pointer"}}),classes:{input:y.input}}}))),r&&i.a.createElement(Po,{handleClose:this.handleClose,open:r,item:l,readOnly:!0}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Khách hàng",field:"custom",cellStyle:{padding:"10px",whiteSpace:"nowrap"},render:e=>{var t,a,n,s,o,r,l,c,d,m;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.patient)||void 0===a?void 0:a.displayName),i.a.createElement("div",{className:""+y.detail},`${this.renderGender(null==e||null===(n=e.treatmentPeriod)||void 0===n||null===(s=n.patient)||void 0===s?void 0:s.gender)}  ${null!=e&&null!==(o=e.treatmentPeriod)&&void 0!==o&&null!==(r=o.patient)&&void 0!==r&&r.birthDate?"| "+Te()(null==e||null===(l=e.treatmentPeriod)||void 0===l||null===(c=l.patient)||void 0===c?void 0:c.birthDate).format("DD/MM/YYYY"):""} `),i.a.createElement("div",{className:y.detail},null==e||null===(d=e.treatmentPeriod)||void 0===d||null===(m=d.patient)||void 0===m?void 0:m.phoneNumber))}},{title:"Dịch vụ sử dụng",field:"custom",cellStyle:{padding:"10px",whiteSpace:"nowrap"},render:e=>{var t,a;return this.renderServiceType(null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.patient)||void 0===a?void 0:a.serviceType)}},{title:"Địa chỉ",field:"custom",cellStyle:{padding:"10px",whiteSpace:"nowrap"},render:e=>{var t,a;return this.renderAdminUnit(null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.patient)||void 0===a?void 0:a.currentResidence)}},{title:"Kết quả sàng lọc",field:"custom",cellStyle:{padding:"10px",whiteSpace:"nowrap"},render:e=>{var t,a,n,s,o,r;return i.a.createElement("div",null,i.a.createElement("div",null,this.renderStatusResult(null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.periodPrepScreening)||void 0===a?void 0:a.statusResult)),i.a.createElement("div",{className:""+y.detail},null!=e&&null!==(n=e.treatmentPeriod)&&void 0!==n&&null!==(s=n.periodPrepScreening)&&void 0!==s&&s.screeningDay?Te()(null==e||null===(o=e.treatmentPeriod)||void 0===o||null===(r=o.periodPrepScreening)||void 0===r?void 0:r.screeningDay).format("DD/MM/YYYY"):""))}},{title:"Ngày đặt lịch",field:"custom",cellStyle:{padding:"10px",whiteSpace:"nowrap"},customSort:(e,t)=>(null==e?void 0:e.encounterDate)-(null==t?void 0:t.encounterDate),render:e=>i.a.createElement("div",null,i.a.createElement("div",null,null!=e&&e.encounterDate?Te()(null==e?void 0:e.encounterDate).format("DD/MM/YYYY"):""),i.a.createElement("div",{className:""+y.detail},this.renderSlot(null==e?void 0:e.appointment)))},{title:"Lần khám",field:"custom",cellStyle:{padding:"10px",whiteSpace:"nowrap",textAlign:"left"},render:e=>{let t="";return null!=e&&e.indexNumber&&(t=null==e?void 0:e.indexNumber),i.a.createElement("div",null,t)}},{title:"Bác sĩ phụ trách",field:"custom",cellStyle:{padding:"10px",whiteSpace:"nowrap"},render:e=>this.renderPractitioners(null==e?void 0:e.appointment)},{title:"Thao tác",field:"custom",type:"numeric",cellStyle:{padding:"10px",whiteSpace:"nowrap"},render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Thông tin khách hàng"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{var t,a;this.handleViewPatientBasic(null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.patient)||void 0===a?void 0:a.id)}},i.a.createElement(_l.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Bệnh án"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{var t,a;await this.handleViewItem(null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.patient)||void 0===a?void 0:a.id)}},i.a.createElement(yl.a,{fontSize:"large",color:"inherit",className:"text-success"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"calc(100vh - 326px)",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem",whiteSpace:"nowrap"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},icons:dn,localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},onSelectionChange:e=>{this.setState({selectedList:e})},style:{height:"calc(100vh - 320px)",overflow:"auto"}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var wl=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.7rem",fontWeight:"bold"},detail:{fontSize:"1.35rem",color:"#3366ff!important"},fontBold:{fontWeight:"bold"},badge:{fontWeight:500,padding:"1rem 1.5rem",borderRadius:"1rem",position:"relative",width:"fit-content",textAlign:"center",background:" rgba(51, 102, 255, 0.1)",color:"#3366ff"},ulTable:{listStyle:"none",margin:0,padding:0},liItem:{},input:{"&::placeholder":{color:"black !important"}}}))(Cl);var Ol=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/searchByDto";return v.a.post(a,e)}async searchHivInfected(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/searchHivInfected";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/"+e;return v.a.get(a)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/"+e.id;return v.a.put(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/"+e;return v.a.delete(a)}async updateStatus(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/update-status/"+e.id;return v.a.post(a,e)}async searchByHealthOrgnaization(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/health-organization/searchByDto";return v.a.post(a,e)}};const xl=Object(Ho.withStyles)(e=>Object(n.createStyles)({root:{width:28,height:16,padding:0,display:"flex"},switchBase:{padding:2,color:e.palette.grey[500],"&$checked":{transform:"translateX(12px)",color:e.palette.common.white,"& + $track":{opacity:1,backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main}}},thumb:{width:12,height:12,boxShadow:"none"},track:{border:"1px solid "+e.palette.grey[500],borderRadius:8,opacity:1,backgroundColor:e.palette.common.white},checked:{}}))(n.Switch);class Rl extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.props.updateAnalytics();let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatest:!0,listStatus:[3,4]};this.setState({loadingTable:!0});let t=await to.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loadingTable:!1});let a={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatestTreatmentPeriod:!0,isLatest:!0,status:5};await Ko.getAnalytics(a).then(e=>{let{data:t}=e;this.setState({dataAnalytics:t},()=>{this.state.check&&this.setState({shouldOpenSearchResult:!0})})}),this.setState({selectedList:[]})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenViewLabTest:!1,shouldOpenViewScreening:!1,shouldOpenEditorDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleCloseSearchResult",()=>{this.setState({shouldOpenSearchResult:!1})}),Fe()(this,"handleEditItem",async e=>{if(e.encounters&&e.encounters.length>0){let t=e.encounters.find(e=>e.isLatestEncounter);t&&t.id&&await ha.getOneById(t.id).then(e=>{var t;let{data:a}=e;var n;a.labTestOrder&&a.labTestOrder[0]&&null!==(t=a.labTestOrder[0])&&void 0!==t&&t.id&&Ol.getOneById(null===(n=a.labTestOrder[0])||void 0===n?void 0:n.id).then(e=>{let{data:t}=e;t&&this.setState({item:t,shouldOpenEditorDialog:!0})})})}}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e},()=>{})}),Fe()(this,"handleSendRequest",async e=>{let t=await to.sendLinkRequest(e);console.log(t.data)}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{alert(e),gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.props.handleChange(null,null,this.state.text),this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleViewScreening",async(e,t)=>{let a=await to.getPatientPeriodPrepScreeningById(e);this.setState({item:a.data,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewScreening:!0})})}),Fe()(this,"handleSelectLabTest",async(e,t)=>{let a=await to.getPatientPeriodPrepScreeningById(e);this.setState({item:a.data,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewLabTest:!0})})}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderStatusResult",e=>{let t="",a=Oe.a.ANSWER_SCORE.find(t=>t.value==e);return a&&(t=a.display),t}),Fe()(this,"renderTreatmentPeriodStatus",e=>{let t="",a=Oe.a.TREATMENT_PERIOD_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderServiceType",e=>{let t="",a=Oe.a.SERVICE_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",currentRoomId:"",userName:"",text:"",selectedList:[],shouldOpenViewLabTest:!1,shouldOpenViewScreening:!1,shouldOpenEditorDialog:!1,shouldOpenSearchResult:!1,check:!1,dataAnalytics:{},loadingTable:!0}}async componentDidMount(){null!=this.props.textSearch?this.setState({text:this.props.textSearch},()=>{this.updatePageData()}):this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenViewLabTest:t,text:a,treatmentPeriodId:s,shouldOpenViewScreening:o,shouldOpenEditorDialog:r,check:l,shouldOpenSearchResult:c,dataAnalytics:d}=this.state;const{classes:m,handleChange:u}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},c&&i.a.createElement(Yo,{open:c,handleClose:this.handleCloseSearchResult,item:d,handleChange:(e,t)=>u(e,t,a),textSearch:this.state.text})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12,className:"d-flex align-center"},i.a.createElement(n.FormControl,{component:"fieldset"},i.a.createElement(n.FormGroup,{"aria-label":"position"},i.a.createElement(n.FormControlLabel,{value:"end",control:i.a.createElement(xl,{checked:l,onChange:e=>{this.setState({check:e.target.checked})},name:"checked_encounter"}),label:i.a.createElement("span",{style:{marginLeft:"8px"}},"Tìm kiếm tất cả các tab"),labelPlacement:"end"})))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.TextField,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:a,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Tìm kiếm theo Tên và Số điện thoại",id:"search_box",variant:"outlined",InputProps:{endAdornment:i.a.createElement(Wo.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#3366ff",cursor:"pointer"}}),classes:{input:m.input}}}))),t&&i.a.createElement(Go,{handleClose:this.handleClose,open:t,screeningItem:e,treatmentPeriodId:s}),o&&i.a.createElement(Ro,{handleClose:this.handleClose,open:o,item:e,readOnly:!0,treatmentPeriodId:s}),r&&i.a.createElement(It,{handleClose:this.handleClose,open:r,item:e}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s,o;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),i.a.createElement("div",{className:m.detail},`${this.renderGender(null==e||null===(a=e.patient)||void 0===a?void 0:a.gender)}  ${null!=e&&null!==(n=e.patient)&&void 0!==n&&n.birthDate?"| "+Te()(null==e||null===(s=e.patient)||void 0===s?void 0:s.birthDate).format("DD/MM/YYYY"):""} `),i.a.createElement("div",{className:m.detail},null==e||null===(o=e.patient)||void 0===o?void 0:o.phoneNumber))},cellStyle:{padding:"10px",whiteSpace:"nowrap"}},{title:"Dịch vụ sử dụng",field:"custom",cellStyle:{padding:"5px"},render:e=>{var t;return this.renderServiceType(null==e||null===(t=e.patient)||void 0===t?void 0:t.serviceType)}},{title:"Ngày sàng lọc",field:"custom",align:"left",render:e=>{var t,a;return null!=e&&null!==(t=e.periodPrepScreening)&&void 0!==t&&t.screeningDay?Te()(null==e||null===(a=e.periodPrepScreening)||void 0===a?void 0:a.screeningDay).format("DD/MM/YYYY"):""},cellStyle:{padding:"5px"}},{title:"Đơn vị XN",field:"receivingUnitName",headerStyle:{minWidth:"160px",maxWidth:"220px"},cellStyle:{minWidth:"160px",maxWidth:"220px"}},{title:"Kết quả bất thường",field:"abnormalResults",headerStyle:{minWidth:"100px",maxWidth:"110px"},render:e=>i.a.createElement(n.Checkbox,{checked:null==e?void 0:e.abnormalResults,color:"primary"})},{title:"Trạng thái",field:"custom",render:e=>{let t=this.renderTreatmentPeriodStatus(e.status),a="";return 1==e.status&&(a="bgc-warning-d1-button"),2==e.status&&(a="bgc-primary-d1-button"),3==e.status&&(a="bgc-green-d1-button"),i.a.createElement("div",{style:{width:"200px"}},i.a.createElement("span",{className:`${m.badge} text-primary ${a}`},t))},cellStyle:{}},{title:"Thao tác",field:"custom",type:"numeric",headerStyle:{minWidth:"70px",maxWidth:"80px"},render:e=>{var t;null==e||null===(t=e.periodPrepScreening)||void 0===t||t.id,null==e||e.status;return i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Cập nhật kết quả"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleEditItem(e)}},i.a.createElement(rn.a,{fontSize:"large",color:"primary"}))))}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"calc(100vh - 326px)",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},icons:dn,localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},onSelectionChange:e=>{this.setState({selectedList:e})},style:{height:"calc(100vh - 320px)",overflow:"auto"}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var kl=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.7rem",fontWeight:"bold"},detail:{fontSize:"1.35rem",color:"#3366ff!important"},badge:{fontWeight:500,padding:"0.5rem 0.5rem",borderRadius:"1rem",position:"relative",width:"fit-content",textAlign:"center",background:" rgba(51, 102, 255, 0.1)",color:"#3366ff"},input:{"&::placeholder":{color:"black !important"}}}))(Rl);const Il=["children","value","index"];function Tl(e){const{children:t,value:a,index:n}=e,s=te()(e,Il);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:1},t))}function Pl(e){return{id:"scrollable-auto-tab-"+e,"aria-controls":"scrollable-auto-tabpanel-"+e}}Tl.propTypes={children:At.a.node,index:At.a.any.isRequired,value:At.a.any.isRequired};const Nl=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}}));function Dl(e){const{ref:t,onRegistered:a,threepidInvite:n,roomOobData:s,resizeNotifier:o,roomJustCreatedOpts:r,history:l}=e,c=Nl(),[d,m]=i.a.useState(0),[h,p]=i.a.useState({}),[g,f]=i.a.useState(""),[v,b]=i.a.useState(!1),[y,E]=i.a.useState(null),[_,S]=i.a.useState(!1),C=(e,t,a)=>{console.log(e,t,a),null!==a&&f(a),null!==t&&m(t)};i.a.useEffect(()=>{w(!0)},[]);const w=async e=>{if(!e)return;const t={text:g};await Ko.getAnalytics(t).then(e=>{let{data:t}=e;p(t)})};return i.a.createElement("div",{className:c.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:c.tabHeader,value:d,onChange:C,indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},i.a.createElement(_r.a,u()({label:i.a.createElement("div",{className:c.countHeader},i.a.createElement("div",{className:c.titleAnalytics},"Danh sách khách hàng (",null==h?void 0:h.notRegisteredForTreatment,")"))},Pl(0))),i.a.createElement(_r.a,u()({label:i.a.createElement("div",{className:c.countHeader},i.a.createElement("div",{className:c.titleAnalytics},"Chỉ định xét nghiệm (",null==h?void 0:h.waitingForTest,")"))},Pl(1))),i.a.createElement(_r.a,u()({label:i.a.createElement("div",{className:c.countHeader},i.a.createElement("div",{className:c.titleAnalytics},"Chờ kết quả xét nghiệm (",null==h?void 0:h.waitingForTestResult,")"))},Pl(2))),i.a.createElement(_r.a,u()({label:i.a.createElement("div",{className:c.countHeader},i.a.createElement("div",{className:c.titleAnalytics},"Chờ khám (",null==h?void 0:h.scheduled,")"))},Pl(3))))),i.a.createElement("div",{className:c.tabPanel},i.a.createElement(Tl,{value:d,index:0},i.a.createElement(vl,u()({},e,{updateAnalytics:()=>w(!1),textSearch:g,handleChange:(e,t,a)=>C(e,t,a)}))),i.a.createElement(Tl,{value:d,index:1},i.a.createElement(Qo,{ref:t,onRegistered:a,threepidInvite:n,roomOobData:s,resizeNotifier:o,roomJustCreatedOpts:r,history:l,updateAnalytics:()=>w(!1),textSearch:g,handleChange:(e,t,a)=>C(e,t,a)})),i.a.createElement(Tl,{value:d,index:2},i.a.createElement(kl,u()({},e,{updateAnalytics:()=>w(!1),textSearch:g,handleChange:(e,t,a)=>C(e,t,a)}))),i.a.createElement(Tl,{value:d,index:3},i.a.createElement(wl,u()({},e,{updateAnalytics:()=>w(!1),textSearch:g,handleChange:(e,t,a)=>C(e,t,a)})))))}var jl=e=>{let{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:i,roomJustCreatedOpts:o,resizeNotifier:r,history:l}=e;return s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},fn.isPractitioner()&&s.createElement(Dl,{ref:t,onRegistered:a,threepidInvite:n,roomOobData:i,resizeNotifier:r,roomJustCreatedOpts:o,history:l})))};class Al extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.props.updateAnalytics();let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatest:!0,status:6},t=await to.searchByPageEncounter(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages}),this.setState({selectedList:[]})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenViewPatientBasic:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.props.history.push({pathname:y.a.ROOT_PATH+"patient/edit/"+e.id,state:{item:e}})}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e},()=>{})}),Fe()(this,"handleSendRequest",async e=>{let t=await to.sendLinkRequest(e);console.log(t.data)}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{alert(e),gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleViewScreening",async(e,t)=>{let a=await to.getPatientPeriodPrepScreeningById(e);this.setState({item:a.data,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewScreening:!0})})}),Fe()(this,"handleSelectLabTest",async(e,t)=>{let a=await to.getPatientPeriodPrepScreeningById(e);this.setState({item:a.data,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewLabTest:!0})})}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderStatusResult",e=>{let t="",a=Oe.a.ANSWER_SCORE.find(t=>t.value==e);return a&&(t=a.display),t}),Fe()(this,"renderTreatmentPeriodStatus",e=>{let t="",a=Oe.a.TREATMENT_PERIOD_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleViewPatientBasic",async e=>{e&&await Tn.getOneById(e).then(e=>{let{data:t}=e;t&&this.setState({patient:t,shouldOpenViewPatientBasic:!0})})}),Fe()(this,"handleViewItem",async e=>{let t=await Tn.getOneById(e);t&&this.props.history.push({pathname:y.a.ROOT_PATH+"medical-record/"+e,state:{item:t.data}})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",currentRoomId:"",userName:"",text:"",selectedList:[],shouldOpenViewLabTest:!1,shouldOpenViewScreening:!1,shouldOpenViewPatientBasic:!1}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenViewLabTest:t,text:a,treatmentPeriodId:s,shouldOpenViewScreening:o,shouldOpenViewPatientBasic:r,patient:l}=this.state,{_roomView:c,onRegistered:d,threepidInvite:m,roomOobData:u,resizeNotifier:h,roomJustCreatedOpts:p}=this.props;const{classes:g}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:a,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Tìm kiếm theo Tên và Số điện thoại",id:"search_box",endAdornment:i.a.createElement(Wo.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),r&&i.a.createElement(Po,{handleClose:this.handleClose,open:r,item:l,readOnly:!0}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s,o;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:g.displayName},null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),i.a.createElement("div",{className:g.detail},`${this.renderGender(null==e||null===(a=e.patient)||void 0===a?void 0:a.gender)} | ${null!=e&&null!==(n=e.patient)&&void 0!==n&&n.birthDate?Te()(null==e||null===(s=e.patient)||void 0===s?void 0:s.birthDate).format("DD/MM/YYYY"):""} | ${null==e||null===(o=e.patient)||void 0===o?void 0:o.phoneNumber}`))}},{title:"Ngày sàng lọc",field:"custom",render:e=>{var t,a;return null!=e&&null!==(t=e.periodPrepScreening)&&void 0!==t&&t.screeningDay?Te()(null==e||null===(a=e.periodPrepScreening)||void 0===a?void 0:a.screeningDay).format("DD/MM/YYYY"):""}},{title:"Kết quả sàng lọc",field:"custom",render:e=>{var t;return this.renderStatusResult(null==e||null===(t=e.periodPrepScreening)||void 0===t?void 0:t.statusResult)}},{title:"Trạng thái",field:"custom",render:e=>this.renderTreatmentPeriodStatus(e.status)},{title:"",field:"custom",type:"numeric",cellStyle:{padding:"10px"},render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Thông tin"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{var t;this.handleViewPatientBasic(null==e||null===(t=e.patient)||void 0===t?void 0:t.id)}},i.a.createElement(_l.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Bệnh án"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{var t;await this.handleViewItem(null==e||null===(t=e.patient)||void 0===t?void 0:t.id)}},i.a.createElement(yl.a,{fontSize:"large",color:"inherit",className:"text-success"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,onSelectionChange:e=>{this.setState({selectedList:e})}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Ml=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.7rem",fontWeight:"bold"},detail:{fontSize:"1.35rem"}}))(Al);class Ul extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.props.updateAnalytics();let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatestTreatmentPeriod:!0,isLatest:!0,status:4},t=await to.searchByPageEncounter(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages}),this.setState({selectedList:[]})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenViewPatientBasic:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.props.history.push({pathname:y.a.ROOT_PATH+"patient/edit/"+e.id,state:{item:e}})}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e},()=>{})}),Fe()(this,"handleSendRequest",async e=>{let t=await to.sendLinkRequest(e);console.log(t.data)}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{alert(e),gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleViewScreening",async(e,t)=>{let a=await to.getPatientPeriodPrepScreeningById(e);this.setState({item:a.data,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewScreening:!0})})}),Fe()(this,"handleSelectLabTest",async(e,t)=>{let a=await to.getPatientPeriodPrepScreeningById(e);this.setState({item:a.data,treatmentPeriodId:t},()=>{this.setState({shouldOpenViewLabTest:!0})})}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderStatusResult",e=>{let t="",a=Oe.a.ANSWER_SCORE.find(t=>t.value==e);return a&&(t=a.display),t}),Fe()(this,"renderTreatmentPeriodStatus",e=>{let t="",a=Oe.a.TREATMENT_PERIOD_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleViewPatientBasic",async e=>{e&&await Tn.getOneById(e).then(e=>{let{data:t}=e;t&&this.setState({patient:t,shouldOpenViewPatientBasic:!0})})}),Fe()(this,"handleViewItem",async e=>{let t=await Tn.getOneById(e);t&&this.props.history.push({pathname:y.a.ROOT_PATH+"medical-record/"+e,state:{item:t.data}})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",currentRoomId:"",userName:"",text:"",selectedList:[],shouldOpenViewLabTest:!1,shouldOpenViewScreening:!1,shouldOpenViewPatientBasic:!1}}async componentDidMount(){null!=this.props.textSearch?this.setState({text:this.props.textSearch},()=>{this.updatePageData()}):this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenViewLabTest:t,text:a,treatmentPeriodId:s,shouldOpenViewScreening:o,shouldOpenViewPatientBasic:r,patient:l}=this.state,{_roomView:c,onRegistered:d,threepidInvite:m,roomOobData:u,resizeNotifier:h,roomJustCreatedOpts:p}=this.props;const{classes:g}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.TextField,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:a,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Tìm kiếm theo Tên và Số điện thoại",id:"search_box",variant:"outlined",InputProps:{endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#3366ff",cursor:"pointer"}}),classes:{input:g.input}}}))),r&&i.a.createElement(Po,{handleClose:this.handleClose,open:r,item:l,readOnly:!0}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s,o,r,l,c;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.patient)||void 0===a?void 0:a.displayName),i.a.createElement("div",{className:g.detail},`${this.renderGender(null==e||null===(n=e.treatmentPeriod)||void 0===n||null===(s=n.patient)||void 0===s?void 0:s.gender)} | ${Te()(null==e||null===(o=e.treatmentPeriod)||void 0===o||null===(r=o.patient)||void 0===r?void 0:r.birthDate).format("DD/MM/YYYY")} | ${null==e||null===(l=e.treatmentPeriod)||void 0===l||null===(c=l.patient)||void 0===c?void 0:c.phoneNumber}`))}},{title:"Ngày sàng lọc",field:"custom",render:e=>{var t,a;return Te()(null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.periodPrepScreening)||void 0===a?void 0:a.screeningDay).format("DD/MM/YYYY")}},{title:"Kết quả sàng lọc",field:"custom",render:e=>{var t,a;return this.renderStatusResult(null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.periodPrepScreening)||void 0===a?void 0:a.statusResult)}},{title:"Trạng thái",field:"custom",render:e=>this.renderTreatmentPeriodStatus(e.status)},{title:"Thao tác",field:"custom",type:"numeric",cellStyle:{padding:"10px"},render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Thông tin khách hàng"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{var t,a;this.handleViewPatientBasic(null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.patient)||void 0===a?void 0:a.id)}},i.a.createElement(_l.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Bệnh án"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{var t,a;await this.handleViewItem(null==e||null===(t=e.treatmentPeriod)||void 0===t||null===(a=t.patient)||void 0===a?void 0:a.id)}},i.a.createElement(yl.a,{fontSize:"large",color:"inherit",className:"text-success"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"calc(100vh - 326px)",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},icons:dn,localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},onSelectionChange:e=>{this.setState({selectedList:e})},style:{height:"calc(100vh - 326px)",overflow:"auto"}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Ll=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.7rem",fontWeight:"bold"},detail:{fontSize:"1.35rem",color:"#3366ff!important"},input:{"&::placeholder":{color:"black !important"}}}))(Ul),Fl=a(1471),Bl=a.n(Fl),Vl=a(1472),Gl=a.n(Vl);var zl=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/serviceEvaluationCardByEncounter/searchByDto";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/serviceEvaluationCardByEncounter/"+e;return v.a.get(a)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/serviceEvaluationCardByEncounter";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/serviceEvaluationCardByEncounter/"+e.id;return v.a.put(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/serviceEvaluationCardByEncounter/"+e;return v.a.delete(a)}};function Wl(e){const{setFieldValue:t,values:a,errors:o,touched:r,field:l,variant:c,listLabelValue:d,disabled:m,action:u,required:h}=e;return Object(s.useEffect)(()=>{null!=u&&(1==a[l]?u(!0):u(!1))}),i.a.createElement(n.FormControl,{fullWidth:!0,variant:c,required:h||!1},i.a.createElement(n.RadioGroup,{row:!0,"aria-label":l,name:l,value:a[l],onChange:e=>{t(e.target.value)},id:l},i.a.createElement(n.Grid,{container:!0,style:{justifyContent:"space-around"}},d.map(e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(n.FormControlLabel,{value:e.value,control:i.a.createElement(n.Radio,{inputProps:{readOnly:m},color:"primary",checked:a[l]==e.value}),label:e.label,"aria-describedby":l}))))),i.a.createElement(n.FormHelperText,{id:l},r[l]&&o[l]))}function Hl(e){return i.a.createElement(vt.a,e)}function Kl(e){const t=Ye.object().shape({});return i.a.createElement(n.Dialog,{className:"dialog-container",open:e.open,PaperComponent:Hl,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},"Xem chi tiết phiếu đánh giá"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>e.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Y.Formik,{initialValues:e.item?e.item:{},validationSchema:t,onSubmit:async e=>{}},t=>{let{errors:a,touched:s,setFieldValue:o,values:r}=t;return i.a.createElement(Y.Form,null,i.a.createElement(n.DialogContent,{dividers:!0,className:"scroll-vertical h-70vh over-flow-auto"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{className:"test-table",item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.Grid,{container:!0,className:"table-tr table-title"},i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,xs:8,style:{textAlign:"center"}},"CÂU HỎI"),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:4,style:{textAlign:"center"}},"ĐÁNH GIÁ")),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,xs:8},"1. Thời gian cấp phát thuốc nhanh"),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:4},i.a.createElement(Wl,{setFieldValue:o,values:r,errors:a,touched:s,disabled:e.readOnly,field:"question1",size:"medium",listLabelValue:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],variant:"outlined",required:!0}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,xs:8},"2. Thuốc giao đúng chủng loại, số lượng"),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:4},i.a.createElement(Wl,{setFieldValue:o,values:r,errors:a,touched:s,disabled:e.readOnly,field:"question2",size:"medium",listLabelValue:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],variant:"outlined",required:!0}))),i.a.createElement(n.Grid,{container:!0,className:"table-tr"},i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,xs:8},"3. Nhân viên cấp/ giao thuốc thân thiện"),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:4,xs:4},i.a.createElement(Wl,{setFieldValue:o,values:r,errors:a,touched:s,disabled:e.readOnly,field:"question3",size:"medium",listLabelValue:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}],variant:"outlined",required:!0})))))))}))}class ql extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,type:2},t=await zl.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenConfirmationDialog:!1,shouldOpenViewDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handelViewItem",e=>{this.setState({item:e,shouldOpenViewDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{zl.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenConfirmationDialog:!1,item:null,id:"",text:"",shouldOpenViewDialog:!1,loading:!1}}async componentDidMount(){this.updatePageData(),this.setState({tableHeight:window.innerHeight-270})}render(){let{item:e,shouldOpenConfirmationDialog:t,text:a,shouldOpenViewDialog:s}=this.state;const{classes:o}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary",className:o.icon}),i.a.createElement("span",{className:o.icon},"Danh sách phiếu đánh giá cấp thuốc"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:a,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),s&&i.a.createElement(Kl,{item:e,open:s,handleClose:this.handleClose,readOnly:!0}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Khách hàng",field:"patient.displayName",cellStyle:{padding:"10px"}},{title:"Lần thăm khám",field:"encounter.indexNumber",cellStyle:{padding:"10px"}},{title:"Thời gian đánh giá",field:"custom",cellStyle:{padding:"10px"},render:e=>{let t="";return null!=e&&e.reviewDate&&(t=Te()(e.reviewDate).format("HH:mm DD/MM/YYYY")),t}},{title:"Đánh giá chất lượng dịch vụ",field:"mediumRating",cellStyle:{padding:"10px"},render:e=>{let t=Math.floor(e.mediumRating/20),a=5-t;return i.a.createElement("div",null,Array(t).fill("").map(e=>i.a.createElement("p",{style:{display:"inline-block",color:"yellow"}},i.a.createElement(Bl.a,null))),Array(a).fill("").map(e=>i.a.createElement("p",{style:{display:"inline-block"}},i.a.createElement(Gl.a,null))))}},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Xem"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>{this.handelViewItem(e)}},i.a.createElement(ze.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!1,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:this.state.tableHeight,overflow:"auto"},isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Yl=Object(Ho.withStyles)(e=>({icon:{marginRight:e.spacing(.5)}}))(ql);const $l=Object(n.makeStyles)(e=>({root:{}}));function Jl(e){const t=$l(),{initialValues:a,handleSubmit:o,handleClose:r}=e,[l,c]=Object(s.useState)(!1),d=Ye.object({code:Ye.string().required(),name:Ye.string().required()}),m=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:d,onSubmit:e=>{c(!0),o(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:m.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:m,classes:t,field:"code",size:"small",label:"Mã thuốc",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:m,classes:t,field:"name",size:"small",label:"Tên thuốc",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:m,classes:t,field:"manufacturer",size:"small",label:"Nhà sản xuất",variant:"outlined",required:"true"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),loading:l,className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}function Ql(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Xl(e){return i.a.createElement(vt.a,e)}class Zl extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state;console.log("abcderfasfas");let n={id:a,name:e.name,code:e.code,manufacturer:e.manufacturer};a?ia.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):ia.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={id:"",name:"",code:"",manufacturer:""}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ql(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ql(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){var e;let{name:t,code:a,manufacturer:s}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Xl,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Sửa thông tin thuốc":"Thêm thuốc"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Jl,{initialValues:{name:t||"",code:a||"",manufacturer:s||""},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose}))}}class ec extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage},t=await ia.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"getUserLogin",async()=>{let e=await Ot.getAllInfoByUserLogin();this.setState({userLogin:e.data})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{ia.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:-1,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1,item:null,id:""}}async componentDidMount(){this.updatePageData(),this.getUserLogin(),this.setState({tableHeight:window.innerHeight-290})}render(){var e,t;let{item:a,shouldOpenEditorDialog:s,shouldOpenConfirmationDialog:o,shouldOpenConfirmationDeleteListDialog:r}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Danh sách thuốc"))),i.a.createElement(n.Grid,{item:!0,md:3},((null===(e=this.state.userLogin)||void 0===e?void 0:e.admin)||(null===(t=this.state.userLogin)||void 0===t?void 0:t.clinic))&&i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới")),s&&i.a.createElement(Zl,{handleClose:this.handleClose,open:s,item:a}),o&&i.a.createElement(l,{open:o,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Delete Confirm",text:"Are you sure you want to delete this drug",agree:"Agree",cancel:"Cancel"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã thuốc",field:"code",align:"left",width:"150"},{title:"Tên thuốc",field:"name",width:"150"},{title:"Nhà sản xuất",field:"manufacturer"},{title:"Số lượng tồn",field:"remainingDrug"},{title:"Thao tác",field:"custom",align:"right",type:"numeric",render:e=>{var t,a;return((null===(t=this.state.userLogin)||void 0===t?void 0:t.admin)||(null===(a=this.state.userLogin)||void 0===a?void 0:a.clinic))&&i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await ia.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}}],options:{selection:!1,draggable:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:this.state.tableHeight,overflow:"auto"},icons:dn,isLoading:!(this.state.totalElements>=0)}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var tc=e=>s.createElement(ec,null);const ac=y.a.API_ENPOINT+"/api/prescription",nc=y.a.API_ENPOINT+"/api/encounter/medicalExamination",sc=y.a.API_ENPOINT+"/api/clinicInformation/getClinicInformation";var ic=new class{async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=ac+"/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/prescription/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/prescription";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=`${ac}/${e}`;return v.a.get(a)}async getEncounterById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=`${nc}/${e}`;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/prescription/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/prescription/checkCode";return v.a.post(a,e)}async updateStatus(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=`${ac}/update-status/${e.id}`;return v.a.put(a,e)}async updatePrescriptionAffiliated(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=ac+"/updatePrescriptionAffiliated";return v.a.get(t)}async getFilterList(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=ac+"/filter-list";return v.a.post(a,e)}async getClinicInformation(){var e=localStorage.getItem("globits_oauth2_access_token");return v.a.defaults.headers.common.Authorization="Bearer "+e,v.a.get(sc)}};const oc=Object(n.makeStyles)(e=>({root:{}}));function rc(e){const t=oc(),{initialValues:a,item:o,handleClose:r,handleSubmit:l}=e,c=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,onSubmit:e=>{l(e)}}),[d,m]=Object(s.useState)([]),[u,h]=i.a.useState(c.values.receiveType);return Object(s.useEffect)(()=>{var t,a;let{item:n}=e,s=[];null!==(t=c.values)&&void 0!==t&&t.drugsByRegimen&&(s=[...s,...c.values.drugsByRegimen]),null!==(a=c.values)&&void 0!==a&&a.drugsOther&&(s=[...s,...c.values.drugsOther]),m(s),c.setFieldValue("drugs",s)},[]),i.a.createElement("div",{className:t.root},i.a.createElement("form",{className:"form-booking",onSubmit:c.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(P,{formik:c,label:"Ngày phát thuốc",format:"dd/MM/yyyy",field:"dispensingDate",inputVariant:"outlined",size:"small",required:"true"})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(z,{formik:c,optionList:Oe.a.PRESCRIPTION_STATUS_DRUG,field:"status",variant:"outlined",size:"small",label:"Thay đổi trạng thái"})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(n.TextField,{label:"Dịch vụ nhận thuốc",size:"small",defaultValue:u?Oe.a.PRESCRIPTION_RECEIVE_TYPE.find(e=>e.value===u).name:null,InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0})),1==u&&i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:12},i.a.createElement(n.TextField,{label:"Tên người nhận",size:"small",defaultValue:c.values.receiveName,InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0})),1==u&&i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6,xs:12},i.a.createElement(n.TextField,{label:"Số điện thoại người nhận",size:"small",defaultValue:c.values.receivePhoneNumber,InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0})),1==u&&i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.TextField,{label:"Địa chỉ người nhận",size:"small",defaultValue:c.values.receiveAddress,InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(qe.a,{data:d,columns:[{title:"Mã thuốc",field:"drug.code"},{title:"Tên thuốc",field:"drug.name"},{title:"NSX",field:"drug.manufacturer"},{title:"SL thuốc",field:"totalQuantity",headerStyle:{minWidth:"200px"},cellStyle:{minWidth:"200px"}},{title:"Số ngày dùng",field:"numberDays",headerStyle:{minWidth:"200px"},cellStyle:{minWidth:"200px"}},{title:"Liều dùng/ngày",field:"numberPerDay",headerStyle:{minWidth:"200px"},cellStyle:{minWidth:"200px"}},{title:"HDSD",field:"note",headerStyle:{minWidth:"200px"},cellStyle:{minWidth:"200px"},render:e=>i.a.createElement(n.Box,{component:"div",sx:{whiteSpace:"normal"}},e.note)}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",onClick:()=>e.handleClose(),style:{marginRight:"12px"}},"Đóng"),i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}function lc(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function cc(e){return i.a.createElement(n.Paper,e)}class dc extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"handleFormSubmit",async e=>{let{id:t}=this.props.item,a=[],n=[];null!=e.drugs&&e.drugs.length>0&&e.drugs.map((e,t)=>{1==e.type?a.push(e):n.push(e)});let s={id:t,description:e.description,receiveType:e.receiveType,receiveName:e.receiveName,receiveAddress:e.receiveAddress,receivePhoneNumber:e.receivePhoneNumber,drugsByRegimen:a,drugsOther:n,encounter:e.encounter,orderDate:e.orderDate,patient:e.patient,practitioner:e.practitioner,status:e.status,dispensingDate:e.dispensingDate};await ic.update(s).then(()=>{this.props.handleClose(),Ce.toast.success("Cấp phát thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={id:"",description:"",receiveType:null,receiveName:null,receiveAddress:null,receivePhoneNumber:null,drugsByRegimen:[],drugsOther:[],encounter:null,orderDate:null,patient:null,practitioner:null,status:null,dispensingDate:null}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?lc(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):lc(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:cc,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," Cấp phát thuốc "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(rc,{initialValues:{description:this.state.description,receiveType:this.state.receiveType,receiveName:this.state.receiveName,receiveAddress:this.state.receiveAddress,receivePhoneNumber:this.state.receivePhoneNumber,drugsByRegimen:this.state.drugsByRegimen,drugsOther:this.state.drugsOther,encounter:this.state.encounter,orderDate:this.state.orderDate,patient:this.state.patient,practitioner:this.state.practitioner,status:this.state.status,dispensingDate:this.state.dispensingDate},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,item:this.props.item}))}}var mc=new class{async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/";return v.a.post(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/"+e;return v.a.delete(a)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/getOne/"+e;return v.a.get(a)}async exportExcel(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/downloadExcel/drugExportManagement";return v()({url:a,method:"POST",responseType:"blob",data:e})}},uc=a(873),hc=a.n(uc);const pc=Object(n.makeStyles)(e=>({icon:{marginRight:e.spacing(.5)}}));function gc(e){const[t,a]=Object(s.useState)([]),[o,r]=Object(s.useState)(0),[l,c]=Object(s.useState)(1),[d,m]=Object(s.useState)(10),[u,h]=Object(s.useState)(-1),[p,g]=Object(s.useState)(""),[f,v]=Object(s.useState)(!1),[b,y]=Object(s.useState)(null),E=pc(),[_,S]=Object(s.useState)(null);Object(s.useEffect)(()=>{},[]),Object(s.useEffect)(()=>{C()},[l,d,p]),Object(s.useEffect)(()=>{S(window.innerHeight-250)},[]);const C=async()=>{let e={pageIndex:l,pageSize:d,text:p,type:Oe.a.DRUG_MANAGEMENT_TYPE_EXPORT},t=await mc.searchByDto(e);a(t.data.content),h(t.data.totalElements),r(t.data.totalPages)};return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary",className:E.icon}),i.a.createElement("span",{className:E.icon},"Quản lý xuất thuốc"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{startIcon:i.a.createElement(hc.a,null),className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",onClick:()=>(()=>{let e={pageIndex:1,pageSize:10,text:"",type:Oe.a.DRUG_MANAGEMENT_TYPE_EXPORT};mc.exportExcel(e).then(e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download","TONG-HOP-XUAT-THUOC.xlsx"),document.body.appendChild(a),a.click()})})()},"Xuất Excel")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(Gt,{search:e=>{g(e)}}))),i.a.createElement(n.Grid,{container:!0,className:"mt-16"},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12,style:{width:"100%",height:"calc(100vh - 200px)"}},i.a.createElement(qe.a,{columns:[{title:"Mã hóa đơn",field:"codeBilling"},{title:"Tên thuốc",field:"drug.name"},{title:"Ngày xuất",field:"exportDate",render:e=>e.exportDate?Te()(e.exportDate).format("DD/MM/YYYY"):null},{title:"Số lượng thuốc xuất",field:"outputNumber"},{title:"Số thuốc còn lại",field:"quantityAfterChange"}],data:t,options:{headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"}),draggable:!1,toolbar:!1,maxBodyHeight:_,showTitle:!1,search:!1,sorting:!0,paging:!1},icons:dn,localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:_,overflow:"auto"},isLoading:!(u>=0)}),i.a.createElement(xe,{totalPages:o,handleChangePage:(e,t)=>{c(t)},setRowsPerPage:e=>{m(e.target.value),c(1)},pageSize:d,pageSizeOption:[1,2,3,5,10,25],totalElements:u,page:l}))))}var fc=e=>{let{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:i,roomJustCreatedOpts:o,resizeNotifier:r,history:l}=e;return s.createElement(gc,{history:l})};function vc(e){let{values:t}=e;return Object(s.useEffect)(()=>{console.log(t),null!=t&&t.inputUnit&&(null==t?void 0:t.inputUnit)!==Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_BOX&&(null==t?void 0:t.inputUnit)!==Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_JAR&&e.setFieldValue("quantity",null)},[null==t?void 0:t.inputUnit]),i.a.createElement(i.a.Fragment,null,null==t||!t.inputUnit||(null==t?void 0:t.inputUnit)!==Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_BOX&&(null==t?void 0:t.inputUnit)!==Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_JAR?null:i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{label:"Số lượng mỗi đơn vị",name:"quantity",defaultValue:null==t?void 0:t.quantity,setFieldValue:e.setFieldValue})))}function bc(e){let{values:t}=e;return Object(s.useEffect)(()=>{console.log(t),null!=t&&t.inputUnit&&(null==t?void 0:t.inputUnit)!==Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_BOX&&(null==t?void 0:t.inputUnit)!==Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_JAR&&e.setFieldValue("quantity",null)},[null==t?void 0:t.inputUnit]),i.a.createElement(i.a.Fragment,null,null==t||!t.inputUnit||(null==t?void 0:t.inputUnit)!==Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_BOX&&(null==t?void 0:t.inputUnit)!==Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_JAR?null:i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{label:"Số viên thuốc /đơn vị",name:"quantity",defaultValue:null==t?void 0:t.quantity,setFieldValue:e.setFieldValue})))}function yc(e){var t,a,o,r,l,c,d,m,u;const[h,p]=Object(s.useState)([]);Object(s.useEffect)(()=>{g()},[]);const g=async()=>{let e=await ia.searchByPage({pageIndex:1,pageSize:1e4});p(e.data.content)};return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement($,{label:"Loại thuốc",name:"drug",options:h,setFieldValue:e.setFieldValue,defaultValue:null===(t=e.values)||void 0===t?void 0:t.drug})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Q,{label:"Ngày nhập thuốc",name:"importDate",setFieldValue:e.setFieldValue,value:null===(a=e.values)||void 0===a?void 0:a.importDate,defaultValue:null===(o=e.values)||void 0===o?void 0:o.importDate})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Q,{label:"Hạn sử dụng",name:"expiryDate",setFieldValue:e.setFieldValue,value:null===(r=e.values)||void 0===r?void 0:r.expiryDate,defaultValue:null===(l=e.values)||void 0===l?void 0:l.expiryDate}))),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{label:"Nguồn thuốc",name:"sourceOfDrug",defaultValue:null===(c=e.values)||void 0===c?void 0:c.sourceOfDrug,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{label:"Số lô thuốc",name:"lot",defaultValue:null===(d=e.values)||void 0===d?void 0:d.lot,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(X,{options:Oe.a.DRUG_MANAGEMENT_INPUT_UNIT,label:"Đơn vị",name:"inputUnit",defaultValue:null===(m=e.values)||void 0===m?void 0:m.inputUnit,setFieldValue:e.setFieldValue})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{label:"Số lượng",name:"inputNumber",defaultValue:null===(u=e.values)||void 0===u?void 0:u.inputNumber,setFieldValue:e.setFieldValue})),i.a.createElement(bc,{setFieldValue:e.setFieldValue,values:e.values})))}var Ec=new class{async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/";return v.a.post(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/"+e;return v.a.delete(a)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/drug-management/getOne/"+e;return v.a.get(a)}async exportExcel(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/downloadExcel/drugManagement";return v()({url:a,method:"POST",responseType:"blob",data:e})}};function _c(e){return i.a.createElement(vt.a,e)}function Sc(e){var t;const[a,o]=Object(s.useState)(!1),r=Ye.object().shape({});return i.a.createElement(n.Dialog,{className:"dialog-container",open:e.open,PaperComponent:_c,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},null!==(t=e.item)&&void 0!==t&&t.id?"Thêm thông tin nhập thuốc":"Sửa thông tin nhập thuốc"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>e.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Y.Formik,{initialValues:e.item?e.item:{importDate:new Date,expiryDate:new Date},validationSchema:r,onSubmit:async t=>{o(!0);let a={id:t.id,drug:t.drug,inputNumber:t.inputNumber,inputUnit:t.inputUnit,lot:t.lot,quantity:t.quantity,sourceOfDrug:t.sourceOfDrug,totalQuantity:t.totalQuantity,importDate:t.importDate,expiryDate:t.expiryDate};t.id?await Ec.update(a).then(()=>{Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):await Ec.save(a).then(()=>{Ce.toast.success("Lưu thành công",Oe.a.TOAST_CONFIGURE)}),e.handleSubmit()}},e=>{let{errors:t,touched:s,setFieldValue:o,values:r}=e;return i.a.createElement(Y.Form,null,i.a.createElement(n.DialogContent,null,i.a.createElement(yc,{setFieldValue:o,values:r})),i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),loading:a,className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu")))}))}const Cc=Object(n.makeStyles)(e=>({icon:{marginRight:e.spacing(.5)}}));function wc(e){const[t,a]=Object(s.useState)([]),[o,r]=Object(s.useState)(0),[l,c]=Object(s.useState)(1),[d,m]=Object(s.useState)(10),[u,h]=Object(s.useState)(-1),[p,g]=Object(s.useState)(""),[f,v]=Object(s.useState)(!1),[b,y]=Object(s.useState)(null),[E,_]=Object(s.useState)(null),S=Cc();Object(s.useEffect)(()=>{C()},[l,d,p]),Object(s.useEffect)(()=>{_(window.innerHeight-275)},[]);const C=async()=>{let e={pageIndex:l,pageSize:d,type:Oe.a.DRUG_MANAGEMENT_TYPE_IMPORT,text:p},t=await Ec.searchByDto(e);a(t.data.content),h(t.data.totalElements),r(t.data.totalPages)},w=e=>{y(e),v(!0)},O=()=>{v(!1)};return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary",className:S.icon}),i.a.createElement("span",{className:S.icon},"Quản lý nhập thuốc"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{w(null)}},"Thêm mới"),i.a.createElement(n.Button,{className:"mb-16 ml-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement(hc.a,null),variant:"contained",onClick:()=>{(()=>{let e={pageIndex:1,pageSize:10,text:"",type:Oe.a.DRUG_MANAGEMENT_TYPE_IMPORT};Ec.exportExcel(e).then(e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download","TONG-HOP-NHAP-THUOC.xlsx"),document.body.appendChild(a),a.click()})})()}},"Xuất Excel"),f&&i.a.createElement(Sc,{handleClose:O,handleSubmit:()=>{O(),C()},item:b,open:f})),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(Gt,{search:e=>{g(e)}}))),i.a.createElement(n.Grid,{container:!0,className:"mt-16"},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12,style:{width:"100%",height:"calc(100vh - 200px)"}},i.a.createElement(qe.a,{columns:[{title:"Tên thuốc",field:"drug.name"},{title:"Ngày nhập",field:"importDate",render:e=>e.importDate?Te()(e.importDate).format("DD/MM/YYYY"):null},{title:"Hạn sử dụng",field:"expiryDate",render:e=>e.expiryDate?Te()(e.expiryDate).format("DD/MM/YYYY"):null},{title:"Nguồn thuốc",field:"sourceOfDrug"},{title:"Số lô thuốc",field:"lot"},{title:"Đơn vị",field:"inputUnit",render:e=>e.inputUnit?Oe.a.DRUG_MANAGEMENT_INPUT_UNIT.find(t=>t.value===e.inputUnit).name:null},{title:"Số lượng",field:"inputNumber"},{title:"Số viên thuốc /đơn vị",field:"quantity",render:e=>e.inputUnit===Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_BOX||e.inputUnit===Oe.a.DRUG_MANAGEMENT_INPUT_UNIT_JAR?e.quantity:null},{title:"Tổng số thuốc",field:"totalQuantity"},{title:"Thao tác",field:"custom",align:"right",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>w(e)},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xoá"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>(async e=>{await Ec.deleteById(e.id),C()})(e)},i.a.createElement(Qt.a,{fontSize:"large",color:"error"}))))}],data:t,options:{headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"}),draggable:!1,toolbar:!1,maxBodyHeight:E,showTitle:!1,search:!1,sorting:!0,paging:!1},icons:dn,localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:E,overflow:"auto"},isLoading:!(u>=0)}),i.a.createElement(xe,{totalPages:o,handleChangePage:(e,t)=>{c(t)},setRowsPerPage:e=>{m(e.target.value),c(1)},pageSize:d,pageSizeOption:[1,2,3,5,10,25],totalElements:u,page:l}))))}var Oc=e=>{let{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:i,roomJustCreatedOpts:o,resizeNotifier:r,history:l}=e;return s.createElement(wc,{history:l})};const xc=Object(n.makeStyles)(e=>({root:{}}));function Rc(e){const t=xc(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(P,{formik:l,label:"EncounterDate",format:"dd/MM/yyyy",field:"encounterDate",inputVariant:"outlined",size:"small",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(Qa,{label:"Treatment Period",formik:l,field:"treatmentPeriod",variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:12},"[] participants"),i.a.createElement(n.Grid,{item:!0,sm:12},"[] observations")))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>o()},"Cancel"),i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Save"))))))}function kc(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ic(e){return i.a.createElement(vt.a,e)}class Tc extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state,n={id:a,encounterDate:e.encounterDate,treatmentPeriod:e.treatmentPeriod,participants:e.participants,observations:e.observations};a?ha.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):ha.create(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={id:"",encounterDate:null,treatmentPeriod:{},participants:[],observations:[]}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kc(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kc(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){let{encounterDate:e,treatmentPeriod:t,participants:a,observations:s}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Ic,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",this.props.id?"Edit Encounter":"Create Encounter"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Rc,{initialValues:{encounterDate:e||null,treatmentPeriod:t||{},participants:a||[],observations:s||[]},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose}))}}class Pc extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage},t=await ha.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{ha.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1,item:null,id:"",listEncounter:[]}}async componentDidMount(){this.updatePageData()}render(){let{item:e,shouldOpenEditorDialog:t,shouldOpenConfirmationDialog:a,shouldOpenConfirmationDeleteListDialog:s}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:3},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Create")),i.a.createElement(n.Grid,{item:!0,md:10},t&&i.a.createElement(Tc,{handleClose:this.handleClose,open:t,item:e}),a&&i.a.createElement(l,{open:a,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Delete Confirm",text:"Are you sure you want to delete this encounter",agree:"Agree",cancel:"Cancel"})),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Encounter date",field:"encounterDate",align:"left",width:"150",render:e=>e.encounterDate?i.a.createElement("span",null,Te()(e.encounterDate).format("DD/MM/YYYY")):""},{title:"Treatment period",field:"treatmentPeriod.name",width:"150"},{title:"Action",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await ha.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Nc=e=>s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},s.createElement(Pc,null)));var Dc=new class{async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter-slot/searchByDto";return v.a.post(a,e)}async getById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter-slot/"+e;return v.a.get(a)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter-slot";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter-slot/"+e.id;return v.a.put(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter-slot/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter-slot/checkCode";return v.a.post(a,e)}};const jc=Object(n.makeStyles)(e=>({root:{}}));function Ac(e){const t=jc(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object().shape({code:Ye.string().required("Mã ca làm việc không được để trống"),name:Ye.string().required("Tên ca làm việc không được để trống"),slotIndex:Ye.number().required("Vị trí ca làm việc không được để trống")}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:3},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Mã ca làm việc",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:3},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Tên ca làm việc",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:3},i.a.createElement(S,{formik:l,classes:t,field:"slotIndex",size:"small",label:"Vị trí ca làm việc",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:3},i.a.createElement(S,{formik:l,classes:t,field:"quantity",size:"small",label:"Số lượng chỗ",variant:"outlined"}))),i.a.createElement(n.Grid,{container:!0,className:"mt-16",spacing:2},i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardTimePicker,{label:"Chọn thời gian bắt đầu",mask:"__:__ _M",inputVariant:"outlined",value:l.values.start,onChange:e=>{let t=Te()(e).add(30,"m").toDate();l.setFieldValue("start",e),l.setFieldValue("end",t)},fullWidth:!0}))),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardTimePicker,{label:"Chọn thời gian kết thúc",mask:"__:__ _M",inputVariant:"outlined",value:l.values.end,onChange:e=>{l.setFieldValue("end",e)},fullWidth:!0})))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"mr-3 btn btn-primary d-inline-flex",loading:e.loading,variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}function Mc(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Uc(e){return i.a.createElement(vt.a,e)}class Lc extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{this.setState({loading:!0}),console.log(e);let{handleClose:t}=this.props,{id:a}=this.state,n={id:a,code:e.code,name:e.name,slotIndex:e.slotIndex,start:e.start,end:e.end,quantity:e.quantity};Dc.checkCode(n).then(e=>{let{data:s}=e;s?Ce.toast.warning("Mã đã tồn tại",Oe.a.TOAST_CONFIGURE):a?Dc.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):Dc.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}).finally({loading:!1})}),this.state={code:"",name:"",description:"",id:"",isAddNew:!0,slotIndex:null,start:null,end:null,quantity:null,loading:!1}}componentDidMount(){let e=this.props.item;e&&(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Mc(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Mc(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)),e.id&&this.setState({isAddNew:!1}))}render(){var e;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Uc,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Chỉnh sửa Ca làm việc":"Thêm mới Ca làm việc"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Ac,{initialValues:{code:this.state.code?this.state.code:"",name:this.state.name?this.state.name:"",slotIndex:this.state.slotIndex?this.state.slotIndex:null,start:this.state.start?this.state.start:new Date,end:this.state.end?this.state.end:new Date,quantity:this.state.quantity?this.state.quantity:null},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,isAddNew:this.state.isAddNew,loading:this.state.loading}))}}class Fc extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Dc.searchByDto(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleConfirmDeleteItem",()=>{Dc.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.updatePageData()}),Fe()(this,"handleOnKeyDown",e=>{"Enter"===e.key&&this.updatePageData()}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",shouldOpenEditorDialog:!1,isAddNew:!1,shouldOpenConfirmationDialog:!1,text:"",loading:!1}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-280})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Ca làm việc"))),i.a.createElement(n.Grid,{item:!0,md:3},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date}),this.setState({isAddNew:!1})}},"Thêm mới"),this.state.shouldOpenEditorDialog&&i.a.createElement(Lc,{handleClose:this.handleClose,open:this.state.shouldOpenEditorDialog,item:this.state.item})),i.a.createElement(n.Grid,{item:!0,md:4}),i.a.createElement(n.Grid,{item:!0,md:5},i.a.createElement(n.FormControl,{fullWidth:!0,className:"float-right"},i.a.createElement(n.Input,{onChange:this.handleChange,name:"text",placeholder:"Search",onKeyDown:this.handleOnKeyDown,endAdornment:i.a.createElement(n.InputAdornment,{position:"end"},i.a.createElement(n.IconButton,{type:"submit","aria-label":"search",onClick:this.updatePageData},i.a.createElement(Vt.a,null)))})),this.state.shouldOpenConfirmationDialog&&i.a.createElement(l,{open:this.state.shouldOpenConfirmationDialog,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"})),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã ca làm việc",field:"code",width:"150"},{title:"Tên ca làm việc",field:"name",width:"150"},{title:"Vị trí ca làm việc",field:"slotIndex",width:"150"},{title:"Giờ bắt đầu",field:"start",width:"150",render:e=>i.a.createElement(i.a.Fragment,null,e.start?Te()(e.start).format("hh:mm A"):null)},{title:"Giờ kết thúc",field:"end",width:"150",render:e=>i.a.createElement(i.a.Fragment,null,e.end?Te()(e.end).format("hh:mm A"):null)},{title:"Số lượng chỗ",field:"quantity",width:"150"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Dc.getById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],isLoading:this.state.loading,options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Bc=e=>{let{}=e;return s.createElement(Fc,null)};const Vc=Object(n.makeStyles)(e=>({root:{}}));function Gc(e){const t=Vc(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({code:Ye.string().required(),name:Ye.string().required()}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Mã",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Tên",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"description",size:"small",label:"Mô tả",variant:"outlined"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit",loading:e.loading},"Lưu"))))))}function zc(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Wc(e){return i.a.createElement(vt.a,e)}class Hc extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{this.setState({loading:!1});let{handleClose:t}=this.props,{id:a}=this.state,n={id:a,name:e.name,code:e.code,description:e.description};Yr.checkCode(n).then(e=>{let{data:s}=e;s?Ce.toast.warning("Mã dân tộc đã tồn tại",Oe.a.TOAST_CONFIGURE):a?Yr.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):Yr.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}).finally(()=>{this.setState({loading:!1})})}),this.state={id:"",name:"",code:"",description:"",loading:!1}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?zc(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):zc(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){var e;let{name:t,code:a,description:s}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Wc,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Chỉnh sửa Dân tộc":"Thêm mới dân tộc"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Gc,{initialValues:{name:t||"",code:a||"",description:s||""},handleSubmit:this.handleFormSubmit,loading:this.state.loading,handleClose:this.props.handleClose}))}}class Kc extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async e=>{null!=e?(this.setState({page:1,text:e.text,loading:!0}),this.search()):(this.setState({loading:!0}),this.search())}),Fe()(this,"search",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Yr.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData(null)})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData(null)})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData(null)})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{Yr.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",loading:!1}}async componentDidMount(){this.updatePageData(null),this.setState({tableHeight:window.innerHeight-270})}render(){let{item:e,shouldOpenEditorDialog:t,shouldOpenConfirmationDialog:a,text:s}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Dân tộc"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:s,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),t&&i.a.createElement(Hc,{handleClose:this.handleClose,open:t,item:e}),a&&i.a.createElement(l,{open:a,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã",field:"code",align:"left",width:"150"},{title:"Tên",field:"name",width:"150"},{title:"Mô tả",field:"description",cellStyle:{maxWidth:"500px"},headerStyle:{maxWidth:"500px"}},{title:"",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Yr.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],isLoading:this.state.loading,options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var qc=e=>s.createElement(Kc,null),Yc=a(375),$c=a(110),Jc=a(168),Qc=a(1473),Xc=a(154),Zc=a(340);var ed,td,ad=e=>{let{hasAvatar:t,hasAvatarLabel:a,noAvatarLabel:n,setAvatarUrl:o,children:r}=e;const l=Object(s.useContext)(ns.a),[c,d]=Object(s.useState)(!1),[m,u]=Object(s.useState)(!1),[h,p]=Object(s.useState)(!1);Object(Qc.b)(()=>{p(!0)},3e3),Object(Qc.b)(()=>{p(!1)},13e3);const g=Object(s.useRef)(),f=t||c?a:n,{room:v}=Object(s.useContext)(Zc.a);if(!(null==v?void 0:v.currentState.maySendStateEvent(vs.a.RoomAvatar,l.getUserId())))return i.a.createElement(i.a.Fragment,null,r);const b=!!f&&(m||h);return i.a.createElement(i.a.Fragment,null,i.a.createElement("input",{type:"file",ref:g,className:"mx_MiniAvatarUploader_input",onChange:async e=>{var t;if(null===(t=e.target.files)||void 0===t||!t.length)return;d(!0),pi.a.trackEvent("mini_avatar","upload"),Xc.a.instance.track("mini_avatar_upload");const a=e.target.files[0],n=await l.uploadContent(a);await o(n),d(!1)},accept:"image/*"}),i.a.createElement(Fs.a,{className:Hn()("mx_MiniAvatarUploader",{mx_MiniAvatarUploader_busy:c,mx_MiniAvatarUploader_hasAvatar:t}),disabled:c,onClick:()=>{g.current.click()},onMouseOver:()=>u(!0),onMouseLeave:()=>u(!1)},r,i.a.createElement("div",{className:"mx_MiniAvatarUploader_indicator"},c?i.a.createElement(Jc.a,{w:20,h:20}):i.a.createElement("div",{className:"mx_MiniAvatarUploader_cameraIcon"})),i.a.createElement("div",{className:Hn()("mx_Tooltip",{mx_Tooltip_visible:b,mx_Tooltip_invisible:!b})},i.a.createElement("div",{className:"mx_Tooltip_chevron"}),f)))};let nd=Object(os.a)("views.elements.ActionButton")((td=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{showTooltip:!1}),Fe()(this,"_onClick",e=>{e.stopPropagation(),pi.a.trackEvent("Action Button","click",this.props.action),gn.a.dispatch({action:this.props.action})}),Fe()(this,"_onMouseEnter",()=>{this.props.tooltip&&this.setState({showTooltip:!0}),this.props.mouseOverAction&&gn.a.dispatch({action:this.props.mouseOverAction})}),Fe()(this,"_onMouseLeave",()=>{this.setState({showTooltip:!1})})}render(){const e=On.getComponent("elements.TintableSvg");let t;if(this.state.showTooltip){const e=On.getComponent("elements.Tooltip");t=i.a.createElement(e,{className:"mx_RoleButton_tooltip",label:this.props.label})}const a=this.props.iconPath?i.a.createElement(e,{src:this.props.iconPath,width:this.props.size,height:this.props.size}):void 0,n=["mx_RoleButton"];return this.props.className&&n.push(this.props.className),i.a.createElement(Fs.a,{className:n.join(" "),onClick:this._onClick,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,"aria-label":this.props.label},a,t,this.props.children)}},Fe()(td,"propTypes",{size:At.a.string,tooltip:At.a.bool,action:At.a.string.isRequired,mouseOverAction:At.a.string,label:At.a.string.isRequired,iconPath:At.a.string,className:At.a.string,children:At.a.node}),Fe()(td,"defaultProps",{size:"25",tooltip:!1}),ed=td))||ed;const sd=()=>{pi.a.trackEvent("home_page","button","dm"),Xc.a.instance.track("home_page_button",{button:"dm"}),gn.a.dispatch({action:"view_create_chat"})},id=()=>{pi.a.trackEvent("home_page","button","room_directory"),Xc.a.instance.track("home_page_button",{button:"room_directory"}),gn.a.fire(js.a.ViewRoomDirectory)},od=()=>{pi.a.trackEvent("home_page","button","create_room"),Xc.a.instance.track("home_page_button",{button:"create_room"}),gn.a.dispatch({action:"view_create_room"})},rd=(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})},ld=e=>({displayName:Oi.a.instance.displayName||e,avatarUrl:Oi.a.instance.getHttpAvatarUrl(52)}),cd=()=>{const e=Object(s.useContext)(ns.a),t=e.getUserId(),[a,n]=Object(s.useState)(ld(t));return Object(xi.a)(Oi.a.instance,gi.b,()=>{n(ld(t))}),s.createElement("div",null,s.createElement(ad,{hasAvatar:!!a.avatarUrl,hasAvatarLabel:Object(ts.a)("Great, that'll help people know it's you"),noAvatarLabel:Object(ts.a)("Add a photo so people know it's you."),setAvatarUrl:t=>e.setAvatarUrl(t)},s.createElement(ws.a,{idName:t,name:a.displayName,url:a.avatarUrl,width:52,height:52,resizeMethod:"crop"})),s.createElement("h1",null,Object(ts.a)("Welcome %(name)s",{name:a.displayName})),s.createElement("h4",null,Object(ts.a)("Now, let's help you get started")))};var dd,md=e=>{let{justRegistered:t=!1}=e;const a=$c.a.get(),n=Object(Yc.a)(a);if(n){const e=On.getComponent("structures.EmbeddedPage");return s.createElement(e,{className:"mx_HomePage",url:n,scrollbar:!0})}let i,o;if(t)i=s.createElement(cd,null);else{const e=a.branding;let t="themes/element/img/logos/globits-logo.png";e&&e.authHeaderLogoUrl&&(t=e.authHeaderLogoUrl),i=s.createElement(s.Fragment,null,s.createElement("img",{src:t,alt:a.brand}),s.createElement("h1",null,Object(ts.a)("Welcome to %(appName)s",{appName:a.brand})))}return o=s.createElement(is.a,{className:"mx_RoomHeader_button mx_RoomHeader_voiceCallButton",onClick:()=>rd(Vs.b.Voice,"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"),title:Object(ts.a)("Voice call")}),s.createElement(Jn.a,{className:"mx_HomePage mx_HomePage_default"},s.createElement("div",{className:"mx_HomePage_default_wrapper"},i,s.createElement("div",{className:"mx_HomePage_default_buttons"},s.createElement("a",{href:"/#/Patient"},s.createElement(nd,{className:"mx_RoomHeader_button mx_RoomHeader_testButton"},"List Patient")),s.createElement("a",{href:"/#/drug"},s.createElement(nd,{className:"mx_RoomHeader_button mx_RoomHeader_testButton"},"Drugs")),s.createElement(Fs.a,{className:"mx_RoomHeader_button mx_RoomHeader_videoCallButton",onClick:()=>rd(Vs.b.Video,"!UfnWDMPlQMiaSPyZrd:gcom.globits.net")},"Test Room Call"),s.createElement(Fs.a,{className:"mx_RoomHeader_button mx_RoomHeader_videoCallButton",onClick:()=>rd(Vs.b.Video,"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net")},"Test Video Call")),s.createElement("div",{className:"mx_HomePage_default_buttons"},s.createElement(Fs.a,{className:"mx_RoomHeader_button mx_RoomHeader_voiceCallButton",onClick:()=>rd(Vs.b.Voice,"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net")},"Test Voice Call"),s.createElement(Fs.a,{onClick:sd,className:"mx_HomePage_button_sendDm"},Object(ts.a)("Send a Direct Message")),s.createElement(Fs.a,{onClick:id,className:"mx_HomePage_button_explore"},Object(ts.a)("Explore Public Rooms")),s.createElement(Fs.a,{onClick:od,className:"mx_HomePage_button_createGroup"},Object(ts.a)("Create a Group Chat")))))};let ud=Object(os.a)("structures.LeftPanel")(dd=class extends s.Component{constructor(){super(...arguments),Fe()(this,"ref",Object(s.createRef)()),Fe()(this,"listContainerRef",Object(s.createRef)())}render(){const e=Hn()({mx_LeftPanel:!0,mx_LeftPanel_minimized:this.props.isMinimized});Hn()("mx_LeftPanel_actualRoomListContainer","mx_AutoHideScrollbar");return s.createElement("div",{className:e,ref:this.ref})}})||dd;var hd=a(266),pd=a(430);async function gd(){console.log("Checking for COLR support");const{userAgent:e}=navigator;if(e.includes("Firefox"))return console.log("Browser is Firefox - assuming COLR is supported"),!0;if(!e.includes("Chrome")&&e.includes("Safari"))return function(e){console.log("Browser is Safari - checking version for COLR support");try{const t=e.match(/Mac OS X ([\d|_]+).*Version\/([\d|.]+).*Safari/);if(t){const e=t[1],a=t[2],n=e.split("_").map(e=>parseInt(e,10)),s=a.split(".").map(e=>parseInt(e,10)),i=n[0]>=10&&n[1]>=14&&s[0]>=12;return console.log(`COLR support on Safari requires macOS 10.14 and Safari 12, detected Safari ${a} on macOS ${e}, COLR supported: `+i),i}}catch(e){console.error("Error in Safari COLR version check",e)}return console.warn("Couldn't determine Safari version to check COLR font support, assuming no."),!1}(e);try{const e=document.createElement("canvas"),t=e.getContext("2d"),a=new Image,n=`\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="100" style="background:#fff;fill:#000;">\n            <style type="text/css">\n                @font-face {\n                    font-family: "chromacheck-colr";\n                    src: url(data:application/x-font-woff;base64,${"d09GRgABAAAAAAKAAAwAAAAAAowAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDT0xSAAACVAAAABYAAAAYAAIAJUNQQUwAAAJsAAAAEgAAABLJAAAQT1MvMgAAAYAAAAA6AAAAYBfxJ0pjbWFwAAABxAAAACcAAAAsAAzpM2dseWYAAAH0AAAAGgAAABoNIh0kaGVhZAAAARwAAAAvAAAANgxLumdoaGVhAAABTAAAABUAAAAkCAEEAmhtdHgAAAG8AAAABgAAAAYEAAAAbG9jYQAAAewAAAAGAAAABgANAABtYXhwAAABZAAAABsAAAAgAg4AHW5hbWUAAAIQAAAAOAAAAD4C5wsecG9zdAAAAkgAAAAMAAAAIAADAAB4AWNgZGAAYQ5+qdB4fpuvDNIsDCBwaQGTAIi+VlscBaJZGMDiHAxMIAoAtjIF/QB4AWNgZGBgYQACOAkUQQWMAAGRABAAAAB4AWNgZGBgYGJgAdMMUJILJMQgAWICAAH3AC4AeAFjYGFhYJzAwMrAwDST6QwDA0M/hGZ8zWDMyMmAChgFkDgKQMBw4CXDSwYWEBdIYgAFBgYA/8sIdAAABAAAAAAAAAB4AWNgYGBkYAZiBgYeBhYGBSDNAoRA/kuG//8hpDgjWJ4BAFVMBiYAAAAAAAANAAAAAQAAAAAEAAQAAAMAABEhESEEAPwABAD8AAAAeAEtxgUNgAAAAMHHIQTShTlOAty9/4bf7AARCwlBNhBw4L/43qXjYGUmf19TMuLcj/BJL3XfBg54AWNgZsALAAB9AAR4AWNgYGAEYj4gFgGygGwICQACOwAoAAAAAAABAAEAAQAAAA4AAAAAyP8AAA=="}) format("woff");\n                }\n            </style>\n            <text x="0" y="0" font-size="20">\n                <tspan font-family="chromacheck-colr" x="0" dy="20">&#xe900;</tspan>\n            </text>\n        </svg>`;e.width=20,e.height=100,a.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(n),console.log("Waiting for COLR SVG to load"),await new Promise(e=>a.onload=e),console.log("Drawing canvas to detect COLR support"),t.drawImage(a,0,0);const s=200===t.getImageData(10,10,1,1).data[0];return console.log("Canvas check revealed COLR is supported? "+s),s}catch(e){return console.error("Couldn't load COLR font",e),!1}}let fd=!1;async function vd(){if(!fd)if(fd=!0,await gd()){const e=`url('${a(8259)}')`;document.fonts.add(new FontFace("Twemoji",e,{})),document.fonts.add(new FontFace("Twemoji",e,{weight:600})),document.fonts.add(new FontFace("Twemoji",e,{weight:700}))}else{const e=`url('${a(8260)}')`;document.fonts.add(new FontFace("Twemoji",e,{})),document.fonts.add(new FontFace("Twemoji",e,{weight:600})),document.fonts.add(new FontFace("Twemoji",e,{weight:700}))}}var bd=a(739);class yd{static moveTag(e,t,a){let n=Qn.a.getOrderedTags(),s=Qn.a.getRemovedTagsAccountData()||[];if(!n)return;n=n.filter(e=>e!==t),n=[...n.slice(0,a),t,...n.slice(a)],s=s.filter(e=>e!==t);const i=Qn.a.getStoreId();return Object(Xn.a)("TagOrderActions.moveTag",()=>(pi.a.trackEvent("TagOrderActions","commitTagOrdering"),e.setAccountData("im.vector.web.tag_ordering",{tags:n,removedTags:s,_storeId:i})),()=>({tags:n,removedTags:s}))}static removeTag(e,t){const a=Qn.a.getOrderedTags(),n=Qn.a.getRemovedTagsAccountData()||[];if(n.includes(t))return new bd.a(()=>{});n.push(t);const s=Qn.a.getStoreId();return Object(Xn.a)("TagOrderActions.removeTag",()=>(pi.a.trackEvent("TagOrderActions","removeTag"),e.setAccountData("im.vector.web.tag_ordering",{tags:a,removedTags:n,_storeId:s})),()=>({removedTags:n}))}}var Ed=a(846),_d=a(606),Sd=(a(865),a(1449));class Cd extends Sd.a{notifyCollapsed(e){const t=this.resizer.config.onCollapsed;t&&t(e,this.id,this.domNode)}get isCollapsed(){return(0,this.resizer.config.isItemCollapsed)(this.domNode)}}class wd extends _d.a{static createItem(e,t,a){return new Cd(e,t,a)}constructor(e){var t,a;super(e),Fe()(this,"toggleSize",void 0),Fe()(this,"isCollapsed",void 0),this.toggleSize=null===(t=e.resizer)||void 0===t||null===(a=t.config)||void 0===a?void 0:a.toggleSize,this.isCollapsed=e.isCollapsed}resize(e){const t=e<this.toggleSize;t&&!this.isCollapsed?(this.isCollapsed=!0,this.item.notifyCollapsed(!0)):!t&&this.isCollapsed&&(this.item.notifyCollapsed(!1),this.isCollapsed=!1),t||super.resize(e)}}var Od=a(864),xd=a(599),Rd=a(156),kd=a(268),Id=a(217),Td=a(428);const Pd=(e,t,a,n)=>{const s=Object(Td.a)(e,a,{monthly_active_user:Object(ts.b)("Your homeserver has exceeded its user limit."),hs_blocked:Object(ts.b)("This homeserver has been blocked by it's administrator."),"":Object(ts.b)("Your homeserver has exceeded one of its resource limits.")}),o=Object(Td.a)(e,a,{"":Object(ts.b)("Contact your <a>server admin</a>.")});Id.a.sharedInstance().addOrReplaceToast({key:"serverlimit",title:Object(ts.a)("Warning"),props:{description:i.a.createElement(i.a.Fragment,null,s," ",o),acceptLabel:Object(ts.a)("Ok"),onAccept:()=>{Nd(),t&&t()}},component:kd.a,priority:70})},Nd=()=>{Id.a.sharedInstance().dismissToast("serverlimit")};var Dd,jd=a(795),Ad=a(238);let Md=Object(os.a)("views.voip.IncomingCallBox")(Dd=class extends i.a.Component{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"onAction",e=>{switch(e.action){case"call_state":{const t=Vs.d.sharedInstance().getCallForRoom(e.room_id);t&&t.state===Ad.e.Ringing?this.setState({incomingCall:t}):this.setState({incomingCall:null})}}}),Fe()(this,"onAnswerClick",e=>{e.stopPropagation(),gn.a.dispatch({action:"answer",room_id:Vs.d.sharedInstance().roomIdForCall(this.state.incomingCall)})}),Fe()(this,"onRejectClick",e=>{e.stopPropagation(),gn.a.dispatch({action:"reject",room_id:Vs.d.sharedInstance().roomIdForCall(this.state.incomingCall)})}),this.dispatcherRef=gn.a.register(this.onAction),this.state={incomingCall:null}}componentWillUnmount(){gn.a.unregister(this.dispatcherRef)}render(){if(!this.state.incomingCall)return null;let e=null;this.state.incomingCall&&(e=Cs.a.get().getRoom(Vs.d.sharedInstance().roomIdForCall(this.state.incomingCall)));const t=e?e.name:Object(ts.a)("Unknown caller");let a=null;return this.state.incomingCall&&(a="voice"===this.state.incomingCall.type?Object(ts.a)("Incoming voice call"):"video"===this.state.incomingCall.type?Object(ts.a)("Incoming video call"):Object(ts.a)("Incoming call")),i.a.createElement("div",{className:"mx_IncomingCallBox"},i.a.createElement("div",{className:"mx_IncomingCallBox_CallerInfo"},i.a.createElement(Ws.a,{room:e,height:32,width:32}),i.a.createElement("div",null,i.a.createElement("h1",null,t),i.a.createElement("p",null,a))),i.a.createElement("div",{className:"mx_IncomingCallBox_buttons"},i.a.createElement(jd.a,{className:"mx_IncomingCallBox_decline",onClick:this.onRejectClick,kind:"danger",label:Object(ts.a)("Decline")}),i.a.createElement("div",{className:"mx_IncomingCallBox_spacer"}),i.a.createElement(jd.a,{className:"mx_IncomingCallBox_accept",onClick:this.onAnswerClick,kind:"primary",label:Object(ts.a)("Accept")})))}})||Dd;var Ud,Ld=a(866),Fd=a(490);let Bd=Object(os.a)("views.elements.PersistentApp")(Ud=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{roomId:Es.a.getRoomId(),persistentWidgetId:Fd.a.getPersistentWidgetId()}),Fe()(this,"_onRoomViewStoreUpdate",e=>{Es.a.getRoomId()!==this.state.roomId&&this.setState({roomId:Es.a.getRoomId()})}),Fe()(this,"_onActiveWidgetStoreUpdate",()=>{this.setState({persistentWidgetId:Fd.a.getPersistentWidgetId()})}),Fe()(this,"_onMyMembership",async(e,t)=>{const a=Fd.a.getRoomId(this.state.persistentWidgetId);"join"!==t&&e.roomId===a&&Fd.a.destroyPersistentWidget(this.state.persistentWidgetId)})}componentDidMount(){this._roomStoreToken=Es.a.addListener(this._onRoomViewStoreUpdate),Fd.a.on("update",this._onActiveWidgetStoreUpdate),Cs.a.get().on("Room.myMembership",this._onMyMembership)}componentWillUnmount(){this._roomStoreToken&&this._roomStoreToken.remove(),Fd.a.removeListener("update",this._onActiveWidgetStoreUpdate),Cs.a.get()&&Cs.a.get().removeListener("Room.myMembership",this._onMyMembership)}render(){if(this.state.persistentWidgetId){const e=Fd.a.getRoomId(this.state.persistentWidgetId),t=Cs.a.get().getRoom(e);if(!t)return null;const a=t.getMyMembership();if(this.state.roomId!==e&&"join"===a){const a=Pi.a.getRoomWidgets(t).find(e=>e.getStateKey()===Fd.a.getPersistentWidgetId()),n=Pi.a.makeAppConfig(a.getStateKey(),a.getContent(),a.getSender(),e,a.getId()),s=On.getComponent("elements.AppTile");return i.a.createElement(s,{key:n.id,app:n,fullWidth:!0,room:t,userId:Cs.a.get().credentials.userId,creatorUserId:n.creatorUserId,widgetPageTitle:Pi.a.getWidgetDataTitle(n),waitForIframeLoad:n.waitForIframeLoad,miniMode:!0,showMenubar:!1})}}return null}})||Ud;var Vd;const Gd=[Ad.e.Connected,Ad.e.InviteSent,Ad.e.Connecting,Ad.e.CreateAnswer,Ad.e.CreateOffer,Ad.e.WaitLocalMedia];function zd(e){let t=null,a=[];for(const n of e)Gd.includes(n.state)&&(n.isRemoteOnHold()||null!==t?a.push(n):t=n);return null===t&&a.length>0&&(t=a[0],a=a.slice(1)),a.length>1&&console.log("Found more than 1 secondary call! Other calls will not be shown."),[t,a]}let Wd=Object(os.a)("views.voip.CallPreview")(Vd=class extends i.a.Component{constructor(e){super(e),Fe()(this,"roomStoreToken",void 0),Fe()(this,"dispatcherRef",void 0),Fe()(this,"settingsWatcherRef",void 0),Fe()(this,"onRoomViewStoreUpdate",e=>{if(Es.a.getRoomId()===this.state.roomId)return;const t=Es.a.getRoomId(),[a,n]=zd(Vs.d.sharedInstance().getAllActiveCallsNotInRoom(t));this.setState({roomId:t,primaryCall:a,secondaryCall:n[0]})}),Fe()(this,"onAction",e=>{switch(e.action){case"call_state":this.updateCalls()}}),Fe()(this,"updateCalls",()=>{const[e,t]=zd(Vs.d.sharedInstance().getAllActiveCallsNotInRoom(this.state.roomId));this.setState({primaryCall:e,secondaryCall:t[0]})}),Fe()(this,"onCallRemoteHold",()=>{const[e,t]=zd(Vs.d.sharedInstance().getAllActiveCallsNotInRoom(this.state.roomId));this.setState({primaryCall:e,secondaryCall:t[0]})});const t=Es.a.getRoomId(),[a,n]=zd(Vs.d.sharedInstance().getAllActiveCallsNotInRoom(t));this.state={roomId:t,primaryCall:a,secondaryCall:n[0]}}componentDidMount(){Vs.d.sharedInstance().addListener(Vs.a.CallChangeRoom,this.updateCalls),this.roomStoreToken=Es.a.addListener(this.onRoomViewStoreUpdate),this.dispatcherRef=gn.a.register(this.onAction),Cs.a.get().on(Ad.c.RemoteHoldUnhold,this.onCallRemoteHold)}componentWillUnmount(){Vs.d.sharedInstance().removeListener(Vs.a.CallChangeRoom,this.updateCalls),Cs.a.get().removeListener(Ad.c.RemoteHoldUnhold,this.onCallRemoteHold),this.roomStoreToken&&this.roomStoreToken.remove(),gn.a.unregister(this.dispatcherRef),ss.b.unwatchSetting(this.settingsWatcherRef)}render(){return this.state.primaryCall?i.a.createElement(Ld.a,{call:this.state.primaryCall,secondaryCall:this.state.secondaryCall,pipMode:!0}):i.a.createElement(Bd,null)}})||Vd;var Hd;let Kd=Object(os.a)("views.voip.CallContainer")(Hd=class extends i.a.PureComponent{render(){return i.a.createElement("div",{className:"mx_CallContainer"},i.a.createElement(Md,null),i.a.createElement(Wd,null))}})||Hd;var qd=a(106),Yd=a(597),$d=a(216);class Jd extends gi.a{constructor(){super(gn.a,{hostSignupActive:!1})}static get instance(){return Jd.internalInstance}get isHostSignupActive(){return this.state.hostSignupActive}async setHostSignupActive(e){return this.updateState({hostSignupActive:e})}onDispatch(e){}}let Qd;var Xd;Fe()(Jd,"internalInstance",new Jd),function(e){e.CloseDialog="close_dialog",e.HostSignupAccountDetails="host_signup_account_details",e.HostSignupAccountDetailsRequest="host_signup_account_details_request",e.Minimize="host_signup_minimize",e.Maximize="host_signup_maximize",e.SetupComplete="setup_complete"}(Qd||(Qd={}));let Zd=Object(os.a)("views.dialogs.HostSignupDialog")(Xd=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"iframeRef",i.a.createRef()),Fe()(this,"config",void 0),Fe()(this,"messageHandler",async e=>{if(this.config.url.startsWith(e.origin))switch(e.data.action){case Qd.HostSignupAccountDetailsRequest:this.onAccountDetailsRequest();break;case Qd.Maximize:this.setState({minimized:!1});break;case Qd.Minimize:this.setState({minimized:!0});break;case Qd.SetupComplete:this.setState({completed:!0});break;case Qd.CloseDialog:return this.closeDialog()}}),Fe()(this,"maximizeDialog",()=>{this.setState({minimized:!1}),this.sendMessage({action:Qd.Maximize})}),Fe()(this,"minimizeDialog",()=>{this.setState({minimized:!0}),this.sendMessage({action:Qd.Minimize})}),Fe()(this,"closeDialog",async()=>(window.removeEventListener("message",this.messageHandler),Yd.a.destroyElement("host_signup"),Jd.instance.setHostSignupActive(!1))),Fe()(this,"onCloseClick",async()=>{if(this.state.completed)return this.closeDialog();qd.a.createDialog($d.a,{title:Object(ts.a)("Confirm abort of host creation"),description:Object(ts.a)("Are you sure you wish to abort creation of the host? The process cannot be continued."),button:Object(ts.a)("Abort"),onFinished:e=>{if(e)return this.closeDialog()}})}),Fe()(this,"sendMessage",e=>{this.iframeRef.current.contentWindow.postMessage(e,this.config.url)}),Fe()(this,"onAccountDetailsDialogFinished",async e=>e?this.sendAccountDetails():this.closeDialog()),Fe()(this,"onAccountDetailsRequest",()=>{const e=i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,Object(ts.a)("Continuing temporarily allows the %(hostSignupBrand)s setup process to access your account to fetch verified email addresses. This data is not stored.",{hostSignupBrand:this.config.brand})),i.a.createElement("p",null,Object(ts.a)("Learn more in our <privacyPolicyLink />, <termsOfServiceLink /> and <cookiePolicyLink />.",{},{cookiePolicyLink:()=>i.a.createElement("a",{href:this.config.cookiePolicyUrl,target:"_blank",rel:"noreferrer noopener"},Object(ts.a)("Cookie Policy")),privacyPolicyLink:()=>i.a.createElement("a",{href:this.config.privacyPolicyUrl,target:"_blank",rel:"noreferrer noopener"},Object(ts.a)("Privacy Policy")),termsOfServiceLink:()=>i.a.createElement("a",{href:this.config.termsOfServiceUrl,target:"_blank",rel:"noreferrer noopener"},Object(ts.a)("Terms of Service"))})));qd.a.createDialog($d.a,{title:Object(ts.a)("You should know"),description:e,button:Object(ts.a)("Continue"),onFinished:this.onAccountDetailsDialogFinished})}),this.state={completed:!1,error:null,minimized:!1},this.config=$c.a.get().hostSignup}async sendAccountDetails(){const e=await Cs.a.get().getOpenIdToken();if(!e||!e.access_token)return console.warn("Failed to connect to homeserver for OpenID token."),void this.setState({completed:!0,error:Object(ts.a)("Failed to connect to your homeserver. Please close this dialog and try again.")});this.sendMessage({action:Qd.HostSignupAccountDetails,account:{accessToken:await Cs.a.get().getAccessToken(),name:Oi.a.instance.displayName,openIdToken:e.access_token,serverName:await Cs.a.get().getDomain(),userLocalpart:await Cs.a.get().getUserIdLocalpart(),termsAccepted:!0}})}componentDidMount(){window.addEventListener("message",this.messageHandler)}componentWillUnmount(){if(Jd.instance.isHostSignupActive)return this.closeDialog()}render(){return i.a.createElement("div",{className:"mx_HostSignup_persisted"},i.a.createElement(Yd.a,{key:"host_signup",persistKey:"host_signup"},i.a.createElement("div",{className:Hn()({mx_Dialog_wrapper:!this.state.minimized})},i.a.createElement("div",{className:Hn()("mx_Dialog",{mx_HostSignupDialog_minimized:this.state.minimized,mx_HostSignupDialog:!this.state.minimized})},this.state.minimized&&i.a.createElement("div",{className:"mx_Dialog_header mx_Dialog_headerWithButton"},i.a.createElement("div",{className:"mx_Dialog_title"},Object(ts.a)("%(hostSignupBrand)s Setup",{hostSignupBrand:this.config.brand})),i.a.createElement(Fs.a,{className:"mx_HostSignup_maximize_button",onClick:this.maximizeDialog,"aria-label":Object(ts.a)("Maximize dialog"),title:Object(ts.a)("Maximize dialog")})),!this.state.minimized&&i.a.createElement("div",{className:"mx_Dialog_header mx_Dialog_headerWithCancel"},i.a.createElement(Fs.a,{onClick:this.minimizeDialog,className:"mx_HostSignup_minimize_button","aria-label":Object(ts.a)("Minimize dialog"),title:Object(ts.a)("Minimize dialog")}),i.a.createElement(Fs.a,{onClick:this.onCloseClick,className:"mx_Dialog_cancelButton","aria-label":Object(ts.a)("Close dialog"),title:Object(ts.a)("Close dialog")})),this.state.error&&i.a.createElement("div",null,this.state.error),!this.state.error&&i.a.createElement("iframe",{src:this.config.url,ref:this.iframeRef,sandbox:"allow-forms allow-scripts allow-same-origin allow-popups"})))))}})||Xd;var em=()=>{const[e,t]=Object(s.useState)(Jd.instance.isHostSignupActive);return Object(xi.a)(Jd.instance,gi.b,()=>{t(Jd.instance.isHostSignupActive)}),i.a.createElement("div",{className:"mx_HostSignupContainer"},e&&i.a.createElement(Zd,null))},tm=a(789),am=a.n(tm),nm=a(214),sm=a(797),im=a(505),om=a(341),rm=a(144),lm=a(252),cm=a(384);function dm(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function mm(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?dm(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):dm(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const um=e=>{let{title:t,description:a,className:n,onClick:s}=e;return i.a.createElement(Fs.a,{className:Hn()("mx_SpaceCreateMenuType",n),onClick:s},i.a.createElement("h3",null,t),i.a.createElement("span",null,a))};var hm;!function(e){e[e.Public=0]="Public",e[e.Private=1]="Private"}(hm||(hm={}));const pm=Object(lm.a)({rules:[{key:"required",test:async e=>{let{value:t}=e;return!!t},invalid:()=>Object(ts.a)("Please enter a name for the space")}]});var gm=e=>{let{onFinished:t}=e;const a=Object(s.useContext)(ns.a),[n,o]=Object(s.useState)(null),[r,l]=Object(s.useState)(!1),[c,d]=Object(s.useState)(""),m=Object(s.useRef)(),[u,h]=Object(s.useState)(null),[p,g]=Object(s.useState)(""),f=async e=>{if(e.preventDefault(),r)return;if(l(!0),!await m.current.validate({allowEmpty:!1}))return m.current.focus(),m.current.validate({allowEmpty:!1,focused:!0}),void l(!1);const s=[{type:vs.a.RoomHistoryVisibility,content:{history_visibility:n===hm.Public?"world_readable":"invited"}}];if(u){const e=await a.uploadContent(u);s.push({type:vs.a.RoomAvatar,content:{url:e}})}p&&s.push({type:vs.a.RoomTopic,content:{topic:p}});try{await Object(nm.d)({createOpts:{preset:n===hm.Public?nm.a.PublicChat:nm.a.PrivateChat,name:c,creation_content:{[vs.c]:vs.d.Space},initial_state:s,power_level_content_override:mm({events_default:100},hm.Public?{invite:0}:{})},spinner:!1,encryption:!1,andView:!0,inlineErrors:!0}),t()}catch(e){console.error(e)}};let v;return v=null===n?i.a.createElement(i.a.Fragment,null,i.a.createElement("h2",null,Object(ts.a)("Create a space")),i.a.createElement("p",null,Object(ts.a)("Spaces are a new way to group rooms and people. To join an existing space you'll need an invite.")),i.a.createElement(um,{title:Object(ts.a)("Public"),description:Object(ts.a)("Open space for anyone, best for communities"),className:"mx_SpaceCreateMenuType_public",onClick:()=>o(hm.Public)}),i.a.createElement(um,{title:Object(ts.a)("Private"),description:Object(ts.a)("Invite only, best for yourself or teams"),className:"mx_SpaceCreateMenuType_private",onClick:()=>o(hm.Private)}),i.a.createElement("p",null,Object(ts.a)("You can change this later")),i.a.createElement(cm.a,{onClick:t})):i.a.createElement(i.a.Fragment,null,i.a.createElement(is.a,{className:"mx_SpaceCreateMenu_back",onClick:()=>o(null),title:Object(ts.a)("Go back")}),i.a.createElement("h2",null,n===hm.Public?Object(ts.a)("Your public space"):Object(ts.a)("Your private space")),i.a.createElement("p",null,Object(ts.a)("Add some details to help people recognise it.")," ",Object(ts.a)("You can change these anytime.")),i.a.createElement("form",{className:"mx_SpaceBasicSettings",onSubmit:f},i.a.createElement(sm.a,{setAvatar:h,avatarDisabled:r}),i.a.createElement(rm.a,{name:"spaceName",label:Object(ts.a)("Name"),autoFocus:!0,value:c,onChange:e=>d(e.target.value),ref:m,onValidate:pm,disabled:r}),i.a.createElement(rm.a,{name:"spaceTopic",element:"textarea",label:Object(ts.a)("Description"),value:p,onChange:e=>g(e.target.value),rows:3,disabled:r})),i.a.createElement(Fs.a,{kind:"primary",onClick:f,disabled:r},r?Object(ts.a)("Creating..."):Object(ts.a)("Create"))),i.a.createElement(Kr.b,{left:72,top:62,chevronOffset:0,chevronFace:Kr.a.None,onFinished:t,wrapperClassName:"mx_SpaceCreateMenu_wrapper",managed:!1},i.a.createElement(am.a,{returnFocus:!0},i.a.createElement(im.a,{onClick:()=>{t(),gn.a.dispatch({action:js.a.ViewUserSettings,initialTabId:om.a})}}),v))};const fm=(e,t)=>{let a="";if(t)for(const e of t.entries())a+=e+"/";return"mx_space_collapsed_"+(a+e)};class vm{static get instance(){return vm.internalInstance||(vm.internalInstance=new vm),vm.internalInstance}setSpaceCollapsedState(e,t,a){localStorage.setItem(fm(e,t),a.toString())}getSpaceCollapsedState(e,t,a){const n=localStorage.getItem(fm(e,t));return n?"true"===n:a}}Fe()(vm,"internalInstance",void 0);var bm=a(842),ym=a(843),Em=a(497),_m=a(183),Sm=a(333);class Cm extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"onContextMenu",e=>{"join"===this.props.space.getMyMembership()&&(e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{right:e.clientX,top:e.clientY,height:0}}))}),Fe()(this,"onClick",e=>{e.preventDefault(),e.stopPropagation(),Gs.e.instance.setActiveSpace(this.props.space)}),Fe()(this,"onMenuOpenClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})}),Fe()(this,"onMenuClose",()=>{this.setState({contextMenuPosition:null})}),Fe()(this,"onInviteClick",e=>{e.preventDefault(),e.stopPropagation(),Object(zs.e)(this.props.space),this.setState({contextMenuPosition:null})}),Fe()(this,"onSettingsClick",e=>{e.preventDefault(),e.stopPropagation(),Object(zs.f)(this.context,this.props.space),this.setState({contextMenuPosition:null})}),Fe()(this,"onLeaveClick",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"leave_room",room_id:this.props.space.roomId}),this.setState({contextMenuPosition:null})}),Fe()(this,"onNewRoomClick",e=>{e.preventDefault(),e.stopPropagation(),Object(zs.d)(this.context,this.props.space),this.setState({contextMenuPosition:null})}),Fe()(this,"onAddExistingRoomClick",e=>{e.preventDefault(),e.stopPropagation(),Object(zs.c)(this.context,this.props.space),this.setState({contextMenuPosition:null})}),Fe()(this,"onMembersClick",e=>{e.preventDefault(),e.stopPropagation(),Es.a.getRoomId()||gn.a.dispatch({action:"view_room",room_id:this.props.space.roomId},!0),gn.a.dispatch({action:js.a.SetRightPanelPhase,phase:_m.c.SpaceMemberList,refireParams:{space:this.props.space}}),this.setState({contextMenuPosition:null})}),Fe()(this,"onExploreRoomsClick",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"view_room",room_id:this.props.space.roomId}),this.setState({contextMenuPosition:null})});const t=vm.instance.getSpaceCollapsedState(e.space.roomId,this.props.parents,!e.isNested);this.state={collapsed:t,contextMenuPosition:null}}toggleCollapse(e){this.props.onExpand&&this.state.collapsed&&this.props.onExpand();const t=!this.state.collapsed;vm.instance.setSpaceCollapsedState(this.props.space.roomId,this.props.parents,t),this.setState({collapsed:t}),e.stopPropagation()}renderContextMenu(){if("join"!==this.props.space.getMyMembership())return null;let e=null;if(this.state.contextMenuPosition){const t=this.context.getUserId();let a,n,s;("public"===this.props.space.getJoinRule()||this.props.space.canInvite(t))&&(a=i.a.createElement(Ls.b,{className:"mx_SpacePanel_contextMenu_inviteButton",iconClassName:"mx_SpacePanel_iconInvite",label:Object(ts.a)("Invite people"),onClick:this.onInviteClick})),Object(zs.b)(this.context,this.props.space)?n=i.a.createElement(Ls.b,{iconClassName:"mx_SpacePanel_iconSettings",label:Object(ts.a)("Settings"),onClick:this.onSettingsClick}):s=i.a.createElement(Ls.c,{red:!0,first:!0},i.a.createElement(Ls.b,{iconClassName:"mx_SpacePanel_iconLeave",label:Object(ts.a)("Leave space"),onClick:this.onLeaveClick}));const o=this.props.space.currentState.maySendStateEvent(vs.a.SpaceChild,t);let r;this.props.space.currentState.maySendStateEvent(vs.a.SpaceChild,t)&&(r=i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{iconClassName:"mx_SpacePanel_iconPlus",label:Object(ts.a)("Create new room"),onClick:this.onNewRoomClick}),i.a.createElement(Ls.b,{iconClassName:"mx_SpacePanel_iconHash",label:Object(ts.a)("Add existing room"),onClick:this.onAddExistingRoomClick}))),e=i.a.createElement(Ls.e,u()({},Object(Kr.p)(this.state.contextMenuPosition,0),{onFinished:this.onMenuClose,className:"mx_SpacePanel_contextMenu",compact:!0}),i.a.createElement("div",{className:"mx_SpacePanel_contextMenu_header"},this.props.space.name),i.a.createElement(Ls.c,{first:!0},a,i.a.createElement(Ls.b,{iconClassName:"mx_SpacePanel_iconMembers",label:Object(ts.a)("Members"),onClick:this.onMembersClick}),n,i.a.createElement(Ls.b,{iconClassName:"mx_SpacePanel_iconExplore",label:o?Object(ts.a)("Manage & explore rooms"):Object(ts.a)("Explore rooms"),onClick:this.onExploreRoomsClick})),r,s)}return i.a.createElement(i.a.Fragment,null,i.a.createElement(Em.a,{className:"mx_SpaceButton_menuButton",onClick:this.onMenuOpenClick,title:Object(ts.a)("Space options"),isExpanded:!!this.state.contextMenuPosition}),e)}render(){const{space:e,activeSpaces:t,isNested:a}=this.props,n=this.props.isPanelCollapsed,s=this.props.isPanelCollapsed,o=this.state.collapsed||n,r=Gs.e.instance.getChildSpaces(e.roomId).filter(e=>{var t;return!(null!==(t=this.props.parents)&&void 0!==t&&t.has(e.roomId))}),l=t.includes(e),c=Hn()({mx_SpaceItem:!0,mx_SpaceItem_narrow:s,collapsed:o,hasSubSpaces:r&&r.length}),d="invite"===e.getMyMembership(),m=Hn()("mx_SpaceButton",{mx_SpaceButton_active:l,mx_SpaceButton_hasMenuOpen:!!this.state.contextMenuPosition,mx_SpaceButton_narrow:s,mx_SpaceButton_invite:d}),u=d?Ds.a.forSymbol("!",Sm.a.Red):Gs.e.instance.getNotificationState(e.roomId);let h,p;r&&!o&&(h=i.a.createElement(wm,{spaces:r,activeSpaces:t,isNested:!0,parents:new Set(this.props.parents).add(this.props.space.roomId)})),u&&(p=i.a.createElement("div",{className:"mx_SpacePanel_badgeContainer"},i.a.createElement(Ts.a,{forceCount:!1,notification:u})));const g=a?24:32,f=r&&r.length?i.a.createElement(Fs.a,{className:"mx_SpaceButton_toggleCollapse",onClick:e=>this.toggleCollapse(e)}):null;let v;return v=s?i.a.createElement(ym.a,{className:m,title:e.name,onClick:this.onClick,onContextMenu:this.onContextMenu,forceHide:!!this.state.contextMenuPosition,role:"treeitem"},f,i.a.createElement("div",{className:"mx_SpaceButton_selectionWrapper"},i.a.createElement(Ws.a,{width:g,height:g,room:e}),p,this.renderContextMenu())):i.a.createElement(bm.a,{className:m,onClick:this.onClick,onContextMenu:this.onContextMenu,role:"treeitem"},f,i.a.createElement("div",{className:"mx_SpaceButton_selectionWrapper"},i.a.createElement(Ws.a,{width:g,height:g,room:e}),i.a.createElement("span",{className:"mx_SpaceButton_name"},e.name),p,this.renderContextMenu())),i.a.createElement("li",{className:c},v,h)}}Fe()(Cm,"contextType",ns.a);const wm=e=>{let{spaces:t,activeSpaces:a,isNested:n,parents:s}=e;return i.a.createElement("ul",{className:"mx_SpaceTreeLevel"},t.map(e=>i.a.createElement(Cm,{key:e.roomId,activeSpaces:a,space:e,isNested:n,parents:s})))};var Om=wm;const xm=e=>{let{space:t,className:a,selected:n,onClick:s,tooltip:o,notificationState:r,isNarrow:l,children:c}=e;const d=Hn()("mx_SpaceButton",a,{mx_SpaceButton_active:n,mx_SpaceButton_narrow:l});let m,u,h=i.a.createElement("div",{className:"mx_SpaceButton_avatarPlaceholder"},i.a.createElement("div",{className:"mx_SpaceButton_icon"}));return t&&(h=i.a.createElement(Ws.a,{width:32,height:32,room:t})),r&&(m=i.a.createElement("div",{className:"mx_SpacePanel_badgeContainer"},i.a.createElement(Ts.a,{forceCount:!1,notification:r}))),u=l?i.a.createElement(bs.b,{className:d,title:o,onClick:s,role:"treeitem"},i.a.createElement("div",{className:"mx_SpaceButton_selectionWrapper"},h,m,c)):i.a.createElement(bs.a,{className:d,onClick:s,role:"treeitem"},i.a.createElement("div",{className:"mx_SpaceButton_selectionWrapper"},h,i.a.createElement("span",{className:"mx_SpaceButton_name"},o),m,c)),i.a.createElement("li",{className:Hn()({mx_SpaceItem:!0,collapsed:l})},u)};var Rm=()=>{const[e,t,a,n]=Object(Kr.q)(),[o,r,l]=(()=>{const[e,t]=Object(s.useState)(Gs.e.instance.invitedSpaces);Object(xi.a)(Gs.e.instance,Gs.b,t);const[a,n]=Object(s.useState)(Gs.e.instance.spacePanelSpaces);Object(xi.a)(Gs.e.instance,Gs.d,n);const[i,o]=Object(s.useState)(Gs.e.instance.activeSpace);return Object(xi.a)(Gs.e.instance,Gs.c,o),[e,a,i]})(),[c,d]=Object(s.useState)(!0);Object(s.useEffect)(()=>{!c&&e&&n()},[c]);const m=Hn()("mx_SpaceButton_new",{mx_SpaceButton_newCancel:e});let u=null;e&&(u=i.a.createElement(gm,{onFinished:n}));const h=(e,t)=>{let a,n=!1;do{const s=t?e.lastElementChild:e.firstElementChild,i=t?e.previousElementSibling:e.nextElementSibling;n?s?e=s:i?e=i:(n=!1,e=e.parentElement):i?(e=i,n=!0):e=e.parentElement,e&&(e.classList.contains("mx_ContextualMenu")&&(e=t?e.lastElementChild:e.firstElementChild,n=!0),a=e.classList)}while(e&&!a.contains("mx_SpaceButton"));e&&e.focus()},p=l?[l]:[],g=c?Object(ts.a)("Expand space panel"):Object(ts.a)("Collapse space panel");return i.a.createElement(bs.c,{handleHomeEnd:!0,onKeyDown:e=>{let t=!0;switch(e.key){case vi.a.ARROW_UP:h(e.target,!0);break;case vi.a.ARROW_DOWN:h(e.target,!1);break;default:t=!1}t&&(e.stopPropagation(),e.preventDefault())}},t=>{let{onKeyDownHandler:s}=t;return i.a.createElement("ul",{className:Hn()("mx_SpacePanel",{collapsed:c}),onKeyDown:s},i.a.createElement(Jn.a,{className:"mx_SpacePanel_spaceTreeWrapper"},i.a.createElement("div",{className:"mx_SpaceTreeLevel"},i.a.createElement(xm,{className:"mx_SpaceButton_home",onClick:()=>Gs.e.instance.setActiveSpace(null),selected:!l,tooltip:Object(ts.a)("All rooms"),notificationState:As.a.instance.globalState,isNarrow:c}),o.map(e=>i.a.createElement(Cm,{key:e.roomId,space:e,activeSpaces:p,isPanelCollapsed:c,onExpand:()=>d(!1)})),r.map(e=>i.a.createElement(Cm,{key:e.roomId,space:e,activeSpaces:p,isPanelCollapsed:c,onExpand:()=>d(!1)}))),i.a.createElement(xm,{className:m,tooltip:e?Object(ts.a)("Cancel"):Object(ts.a)("Create a space"),onClick:e?n:()=>{c||d(!0),a()},isNarrow:c})),i.a.createElement(is.a,{className:Hn()("mx_SpacePanel_toggleCollapse",{expanded:!c}),onClick:()=>d(!c),title:g}),u)})},km=a(776),Im=a(0);class Tm extends i.a.Component{constructor(){super(...arguments),Fe()(this,"element",Object(s.createRef)()),Fe()(this,"onNewStream",()=>{this.playMedia()})}componentDidMount(){this.props.feed.addListener(km.b.NewStream,this.onNewStream),this.playMedia()}componentWillUnmount(){this.props.feed.removeListener(km.b.NewStream,this.onNewStream),this.stopMedia()}playMedia(){const e=this.element.current,t=pd.a.getAudioOutput();if(t)try{e.setSinkId(t)}catch(e){console.error("Couldn't set requested audio output device: using default",e),Im.a.warn("Couldn't set requested audio output device: using default",e)}e.muted=!1,e.srcObject=this.props.feed.stream,e.autoplay=!0;try{e.play()}catch(e){Im.a.info("Failed to play media element with feed",this.props.feed,e)}}stopMedia(){const e=this.element.current;e.pause(),e.src=null}render(){return i.a.createElement("audio",{ref:this.element})}}class Pm extends i.a.Component{constructor(e){super(e),Fe()(this,"onFeedsChanged",()=>{this.setState({feeds:this.props.call.getRemoteFeeds()})}),this.state={feeds:[]}}componentDidMount(){this.props.call.addListener(Ad.c.FeedsChanged,this.onFeedsChanged)}componentWillUnmount(){this.props.call.removeListener(Ad.c.FeedsChanged,this.onFeedsChanged)}render(){return this.state.feeds.map((e,t)=>i.a.createElement(Tm,{feed:e,key:t}))}}var Nm=a(874),Dm=a.n(Nm),jm=a(876),Am=a.n(jm),Mm=a(870),Um=a.n(Mm);const Lm=[{auth:["admin","clinic"],color:"#3c90d6",title:"Danh sách khách hàng",path:"/home",icon:i.a.createElement(Dm.a,{fontSize:"large"})},{auth:["admin","clinic"],color:"#3c90d6",title:"Danh sách đặt lịch",path:"/appointment",icon:i.a.createElement(An.a,{fontSize:"large"})},{auth:["admin","clinic"],color:"#3c90d6",title:"Quản trị người dùng",path:"/my-info",icon:i.a.createElement(Am.a,{fontSize:"large"})},{auth:["practitioner"],color:"#3c90d6",title:"Lịch khám",path:"/home",icon:i.a.createElement(Um.a,{fontSize:"large"})}];var Fm=a(512);a(879);const Bm=Object(n.makeStyles)(e=>({sidebarLink:{display:"flex",justifyContent:"space-between",alignItems:"center",height:"50px",fontSize:"1.125rem",padding:"0.5rem 0.5rem 0.5rem 1.5rem",textDecoration:"none",color:"#FFF!important",transition:"0.2s",fontWeight:600,boxShadow:"0px 1px 0px rgb(195 186 186 / 35%)",lineHeight:"16px","&:hover":{color:"#FFF !important",backgroundColor:"#3ca5b5",fontWeight:600}},sidebarLabel:{marginLeft:"0.2rem",fontWeight:400,fontSize:"1.5rem",textAlign:"center"},subSidebarLabel:{marginLeft:"4rem",fontSize:"1.5rem",verticalAlign:"super",color:"inherit"},navIcon:{width:"35px",marginLeft:"0",fontSize:"1rem",textAlign:"center",paddingLeft:"1px",display:"inline-block"},dropdownLink:{display:"flex",justifyContent:"flex-start",alignItems:"center",height:"55px",fontSize:"1.125rem",padding:"0.5em 0.5em 0.5em 0.5em",textDecoration:"none",color:"#6778a0!important",transition:"0.2s","&:hover":{color:"#fff!important",backgroundColor:"#3366ff",fontWeight:600}},subNavIcon:{width:"5px",height:"5px",top:"7px",background:"#0f62a6",position:"absolute"}}));var Vm=e=>{var t;let{item:a,selectedIndex:n,setSelectedIndex:o,handleExpanse:r,sideBarOpenStatus:l,roles:c}=e;const[d,m]=Object(s.useState)(!1),u=e=>{null!=e.subnav?m(!d):(o(e.path),null!=r&&r(!1))},h=Bm();return i.a.createElement(i.a.Fragment,null,i.a.createElement(Fm.Link,{className:`${h.sidebarLink} nav-item ${n===a.path?"active":""}`,to:a.path,onClick:()=>u(a)},i.a.createElement("div",{className:"nav-menu-active"},i.a.createElement("i",{className:h.navIcon},a.icon),i.a.createElement("span",{className:h.sidebarLabel},a.title)),i.a.createElement("div",{className:"toggles-mub-menu"},null!=a&&a.subnav&&d?null==a?void 0:a.iconOpened:null==a?void 0:a.iconClosed)),d&&l&&(null==a||null===(t=a.subnav)||void 0===t?void 0:t.map((e,t)=>{for(let t=0;t<c.length;t++){const a=c[t];if(null==e.auth)return i.a.createElement(Fm.Link,{className:`${h.dropdownLink} nav-item ${n===e.path?"active":""} `,to:e.path,key:t,onClick:()=>u(e)},i.a.createElement("div",{style:{position:"relative"}},i.a.createElement("span",{className:h.subSidebarLabel},e.title)));if(a.some(t=>-1!==e.auth.indexOf(t)))return i.a.createElement(Fm.Link,{className:`${h.dropdownLink} nav-item ${n===e.path?"active":""} `,to:e.path,key:t,onClick:()=>u(e)},i.a.createElement("div",{style:{position:"relative"}},i.a.createElement("span",{className:h.subSidebarLabel},e.title)))}})))};const Gm=Object(n.makeStyles)(e=>({rootItem:{display:"relative"},sidebarLink:{display:"flex",justifyContent:"space-between",alignItems:"center",height:"100%",fontSize:"1.125rem",padding:"0.5em 0.75em 0.5em 0.75em",textDecoration:"none",color:"#FFF !important",position:"relative",borderRadius:"10px","&:hover":{color:"#0E9594 !important",backgroundColor:"#FFF",fontWeight:400,borderRadius:"10px",height:"44px"}},sidebarLabel:{fontWeight:400,fontSize:"16px",verticalAlign:"super",lineHeight:"24px","&.active":{fontWeight:600}},subSidebarLabel:{fontSize:"16px",verticalAlign:"super",color:"#14142B"},navIcon:{width:"35px",height:"35px",marginLeft:"0",borderRadius:"50%",fontSize:"1rem",textAlign:"center",lineHeight:"50px",paddingLeft:"1px",display:"inline-block"},dropdownLink:{display:"flex",justifyContent:"flex-start",alignItems:"center",height:"55px",fontSize:"1.125rem",padding:"0.5em 0.5em 0.5em 3em",textDecoration:"none",color:"#14142B",transition:"0.2s","&:hover":{color:"#0f62a6!important",backgroundColor:"#e3eff9",borderLeft:"5px solid #4f95d3"}},subItems:{display:"none",minWidth:"300px",position:"absolute",background:"#fff",boxShadow:"2px 1px 2px 0 rgb(0 0 0 / 10%)",border:"1px solid #d1d1d1",borderRadius:"0.375rem",zIndex:999},subItemUl:{listStyle:"none",paddingLeft:0,margin:"5px",maxHeight:"410px",overflow:"auto"},navItemMenu:{display:"flex",alignItems:"center"}}));var zm,Wm=e=>{var t;let{item:a,selectedIndex:n,setSelectedIndex:s,roles:o,isMoblie:r}=e;const[l,c]=i.a.useState(null),[d,m]=i.a.useState(null),u=(e,t)=>{if("subnav"===t){m(e);const t=document.querySelectorAll(".nav-item.active")[0];t&&t.parentElement.parentElement.parentElement.parentElement.firstElementChild.classList.remove("active")}if(null==e.subnav){const t=document.querySelectorAll(".nav-item.active")[0];t&&t.parentElement.parentElement.parentElement.parentElement.firstElementChild.classList.remove("active"),s(e.path)}};i.a.useEffect(()=>{const e=document.querySelectorAll(".nav-item.active")[0];e&&l!=e&&(e.parentElement.parentElement.parentElement.parentElement.firstElementChild.classList.add("active"),c(e))},[d]);const h=Gm();return i.a.createElement("div",{className:h.rootItem},i.a.createElement(Fm.Link,{className:`${h.sidebarLink} nav-item-horizontal ${n===a.path?"active":""}`,to:a.path,onClick:()=>u(a,"nav")},i.a.createElement("div",{className:h.navItemMenu},i.a.createElement("i",{className:h.navIcon},a.icon),i.a.createElement("span",{className:""+h.sidebarLabel},a.title))),(null==a?void 0:a.subnav)&&i.a.createElement("div",{className:h.subItems+" sub-item-horizontal"},i.a.createElement("ul",{className:h.subItemUl},null==a||null===(t=a.subnav)||void 0===t?void 0:t.map((e,t)=>{for(let t=0;t<o.length;t++){const a=o[t];if(null==e.auth)return i.a.createElement("li",null,i.a.createElement(Fm.Link,{className:`${h.dropdownLink} nav-item desktop ${n===e.path?"active":""} `,to:e.path,key:t,onClick:()=>u(e,"subnav")},i.a.createElement("div",{style:{position:"relative"}},i.a.createElement("span",{className:h.subSidebarLabel},e.title))));if(a.some(t=>-1!==e.auth.indexOf(t)))return i.a.createElement("li",null,i.a.createElement(Fm.Link,{className:`${h.dropdownLink} nav-item desktop ${n===e.path?"active":""} `,to:e.path,key:t,onClick:()=>u(e,"subnav")},i.a.createElement("div",{style:{position:"relative"}},i.a.createElement("span",{className:h.subSidebarLabel},e.title))))}}))))},Hm=a(656),Km=a.n(Hm),qm=a(315),Ym=a.n(qm),$m=a(189),Jm=a.n($m),Qm=a(1463),Xm=a.n(Qm),Zm=a(871),eu=a.n(Zm),tu=a(833);let au=Object(os.a)("views.dialogs.BugReportDialog")(zm=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_onDownload",async e=>{this.setState({downloadBusy:!0}),this._downloadProgressCallback(Object(ts.a)("Preparing to download logs"));try{await Object(tu.b)({sendLogs:!0,progressCallback:this._downloadProgressCallback,label:this.props.label}),this.setState({downloadBusy:!1,downloadProgress:null})}catch(e){this._unmounted||this.setState({downloadBusy:!1,downloadProgress:Object(ts.a)("Failed to send logs: ")+""+e.message})}}),this.state={sendLogs:!0,busy:!1,err:null,issueUrl:"",text:e.initialText||"",progress:null,downloadBusy:!1,downloadProgress:null},this._unmounted=!1,this._onSubmit=this._onSubmit.bind(this),this._onCancel=this._onCancel.bind(this),this._onTextChange=this._onTextChange.bind(this),this._onIssueUrlChange=this._onIssueUrlChange.bind(this),this._onSendLogsChange=this._onSendLogsChange.bind(this),this._sendProgressCallback=this._sendProgressCallback.bind(this),this._downloadProgressCallback=this._downloadProgressCallback.bind(this)}componentWillUnmount(){this._unmounted=!0}_onCancel(e){this.props.onFinished(!1)}_onSubmit(e){if(!(this.state.text&&this.state.text.trim()||this.state.issueUrl&&this.state.issueUrl.trim()))return void this.setState({err:Object(ts.a)("Please tell us what went wrong or, better, create a GitHub issue that describes the problem.")});const t=(this.state.text.length>0?this.state.text+"\n\n":"")+"Issue: "+(this.state.issueUrl.length>0?this.state.issueUrl:"No issue link given");this.setState({busy:!0,progress:null,err:null}),this._sendProgressCallback(Object(ts.a)("Preparing to send logs")),Object(tu.a)($c.a.get().bug_report_endpoint_url,{userText:t,sendLogs:!0,progressCallback:this._sendProgressCallback,label:this.props.label}).then(()=>{if(!this._unmounted){this.props.onFinished(!1);const e=On.getComponent("dialogs.QuestionDialog");qd.a.createTrackedDialog("Bug report sent","",e,{title:Object(ts.a)("Logs sent"),description:Object(ts.a)("Thank you!"),hasCancelButton:!1})}},e=>{this._unmounted||this.setState({busy:!1,progress:null,err:Object(ts.a)("Failed to send logs: ")+""+e.message})})}_onTextChange(e){this.setState({text:e.target.value})}_onIssueUrlChange(e){this.setState({issueUrl:e.target.value})}_onSendLogsChange(e){this.setState({sendLogs:e.target.checked})}_sendProgressCallback(e){this._unmounted||this.setState({progress:e})}_downloadProgressCallback(e){this._unmounted||this.setState({downloadProgress:e})}render(){const e=On.getComponent("elements.Spinner"),t=On.getComponent("views.dialogs.BaseDialog"),a=On.getComponent("views.elements.DialogButtons"),n=On.getComponent("elements.Field");let s=null;this.state.err&&(s=i.a.createElement("div",{className:"error"},this.state.err));let o,r=null;return this.state.busy&&(r=i.a.createElement("div",{className:"progress"},i.a.createElement(e,null),this.state.progress," ...")),window.Modernizr&&Object.values(window.Modernizr).some(e=>!1===e)&&(o=i.a.createElement("p",null,i.a.createElement("b",null,Object(ts.a)("Reminder: Your browser is unsupported, so your experience may be unpredictable.")))),i.a.createElement(t,{className:"mx_BugReportDialog",onFinished:this._onCancel,title:Object(ts.a)("Submit debug logs"),contentId:"mx_Dialog_content"},i.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},o,i.a.createElement("p",null,Object(ts.a)("Debug logs contain application usage data including your username, the IDs or aliases of the rooms or groups you have visited and the usernames of other users. They do not contain messages.")),i.a.createElement("p",null,i.a.createElement("b",null,Object(ts.a)("Before submitting logs, you must <a>create a GitHub issue</a> to describe your problem.",{},{a:e=>i.a.createElement("a",{target:"_blank",href:"https://github.com/vector-im/element-web/issues/new"},e)}))),i.a.createElement("div",{className:"mx_BugReportDialog_download"},i.a.createElement(Fs.a,{onClick:this._onDownload,kind:"link",disabled:this.state.downloadBusy},Object(ts.a)("Download logs")),this.state.downloadProgress&&i.a.createElement("span",null,this.state.downloadProgress," ...")),i.a.createElement(n,{type:"text",className:"mx_BugReportDialog_field_input",label:Object(ts.a)("GitHub issue"),onChange:this._onIssueUrlChange,value:this.state.issueUrl,placeholder:"https://github.com/vector-im/element-web/issues/..."}),i.a.createElement(n,{className:"mx_BugReportDialog_field_input",element:"textarea",label:Object(ts.a)("Notes"),rows:5,onChange:this._onTextChange,value:this.state.text,placeholder:Object(ts.a)("If there is additional context that would help in analysing the issue, such as what you were doing at the time, room IDs, user IDs, etc., please include those things here.")}),r,s),i.a.createElement(a,{primaryButton:Object(ts.a)("Send logs"),onPrimaryButtonClick:this._onSubmit,focus:!0,onCancel:this._onCancel,disabled:this.state.busy}))}})||zm;au.propTypes={onFinished:At.a.func.isRequired,initialText:At.a.string};var nu=a(377),su=a(598);var iu,ou=e=>{const[t,a]=Object(s.useState)(""),[n,o]=Object(s.useState)(""),r=()=>{e.onFinished(),qd.a.createTrackedDialog("Bug Report Dialog","",au,{})},l=Xc.a.instance.canEnable(),c=$c.a.get().brand;let d,m;l&&(d=i.a.createElement(i.a.Fragment,null,i.a.createElement("hr",null),i.a.createElement("div",{className:"mx_FeedbackDialog_section mx_FeedbackDialog_rateApp"},i.a.createElement("h3",null,Object(ts.a)("Rate %(brand)s",{brand:c})),i.a.createElement("p",null,Object(ts.a)("Tell us below how you feel about %(brand)s so far.",{brand:c})),i.a.createElement("p",null,Object(ts.a)("Please go into as much detail as you like, so we can track down the problem.")),i.a.createElement(su.a,{name:"feedbackRating",value:t,onChange:a,definitions:[{value:"1",label:"😠"},{value:"2",label:"😞"},{value:"3",label:"😑"},{value:"4",label:"😄"},{value:"5",label:"😍"}]}),i.a.createElement(rm.a,{id:"feedbackComment",label:Object(ts.a)("Add comment"),placeholder:Object(ts.a)("Comment"),type:"text",autoComplete:"off",value:n,element:"textarea",onChange:e=>{o(e.target.value)}})))),l&&(m=i.a.createElement("h2",null,Object(ts.a)("There are two ways you can provide feedback and help us improve %(brand)s.",{brand:c})));let u=null;return $c.a.get().bug_report_endpoint_url&&(u=i.a.createElement("p",null,Object(ts.a)("PRO TIP: If you start a bug, please submit <debugLogsLink>debug logs</debugLogsLink> to help us track down the problem.",{},{debugLogsLink:e=>i.a.createElement(Fs.a,{kind:"link",onClick:r},e)}))),i.a.createElement($d.a,{className:"mx_FeedbackDialog",hasCancelButton:!!l,title:Object(ts.a)("Feedback"),description:i.a.createElement(i.a.Fragment,null,m,i.a.createElement("div",{className:"mx_FeedbackDialog_section mx_FeedbackDialog_reportBug"},i.a.createElement("h3",null,Object(ts.a)("Report a bug")),i.a.createElement("p",null,Object(ts.a)("Please view <existingIssuesLink>existing bugs on Github</existingIssuesLink> first. No match? <newIssueLink>Start a new one</newIssueLink>.",{},{existingIssuesLink:e=>i.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://github.com/vector-im/element-web/issues?q=is%3Aopen+is%3Aissue+sort%3Areactions-%2B1-desc"},e),newIssueLink:e=>i.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://github.com/vector-im/element-web/issues/new"},e)})),u),d),button:l?Object(ts.a)("Send feedback"):Object(ts.a)("Go back"),buttonDisabled:l&&""===t,onFinished:a=>{l&&a&&(Xc.a.instance.reportFeedback(parseInt(t,10),n),qd.a.createTrackedDialog("Feedback sent","",nu.a,{title:Object(ts.a)("Feedback sent"),description:Object(ts.a)("Thank you!")})),e.onFinished()}})},ru=a(426);let lu=Object(os.a)("views.dialogs.LogoutDialog")(iu=class extends i.a.Component{constructor(){super(),Fe()(this,"defaultProps",{onFinished:function(){}}),this._onSettingsLinkClick=this._onSettingsLinkClick.bind(this),this._onExportE2eKeysClicked=this._onExportE2eKeysClicked.bind(this),this._onFinished=this._onFinished.bind(this),this._onSetRecoveryMethodClick=this._onSetRecoveryMethodClick.bind(this),this._onLogoutConfirm=this._onLogoutConfirm.bind(this);const e=Cs.a.get(),t=e.isCryptoEnabled()&&!e.getKeyBackupEnabled();this.state={shouldLoadBackupStatus:t,loading:t,backupInfo:null,error:null},t&&this._loadBackupStatus()}async _loadBackupStatus(){try{const e=await Cs.a.get().getKeyBackupVersion();this.setState({loading:!1,backupInfo:e})}catch(e){console.log("Unable to fetch key backup status",e),this.setState({loading:!1,error:e})}}_onSettingsLinkClick(){this.props.onFinished()}_onExportE2eKeysClicked(){qd.a.createTrackedDialogAsync("Export E2E Keys","",a.e(4).then(a.bind(null,8461)),{matrixClient:Cs.a.get()})}_onFinished(e){e&&gn.a.dispatch({action:"logout"}),this.props.onFinished()}_onSetRecoveryMethodClick(){this.state.backupInfo?qd.a.createTrackedDialog("Restore Backup","",ru.a,null,null,!1,!0):qd.a.createTrackedDialogAsync("Key Backup","Key Backup",a.e(5).then(a.bind(null,1536)),null,null,!1,!0),this.props.onFinished()}_onLogoutConfirm(){gn.a.dispatch({action:"logout"}),this.props.onFinished()}render(){if(this.state.shouldLoadBackupStatus){const e=On.getComponent("views.dialogs.BaseDialog"),t=i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("Encrypted messages are secured with end-to-end encryption. Only you and the recipient(s) have the keys to read these messages.")),i.a.createElement("p",null,Object(ts.a)("Back up your keys before signing out to avoid losing them.")));let a;if(this.state.loading){const e=On.getComponent("views.elements.Spinner");a=i.a.createElement(e,null)}else{const e=On.getComponent("views.elements.DialogButtons");let n;n=this.state.backupInfo?Object(ts.a)("Connect this session to Key Backup"):Object(ts.a)("Start using Key Backup"),a=i.a.createElement("div",null,i.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},t),i.a.createElement(e,{primaryButton:n,hasCancel:!1,onPrimaryButtonClick:this._onSetRecoveryMethodClick,focus:!0},i.a.createElement("button",{onClick:this._onLogoutConfirm},Object(ts.a)("I don't want my encrypted messages"))),i.a.createElement("details",null,i.a.createElement("summary",null,Object(ts.a)("Advanced")),i.a.createElement("p",null,i.a.createElement("button",{onClick:this._onExportE2eKeysClicked},Object(ts.a)("Manually export keys")))))}return i.a.createElement(e,{title:Object(ts.a)("You'll lose access to your encrypted messages"),contentId:"mx_Dialog_content",hasCancel:!0,onFinished:this._onFinished},a)}{const e=On.getComponent("views.dialogs.QuestionDialog");return i.a.createElement(e,{hasCancelButton:!0,title:Object(ts.a)("Sign out"),description:Object(ts.a)("Are you sure you want to sign out?"),button:Object(ts.a)("Sign out"),onFinished:this._onFinished})}}})||iu;var cu,du=a(335),mu=a(205),uu=a(186),hu=a(182),pu=a(265);let gu=Object(os.a)("views.dialogs.EditCommunityPrototypeDialog")(cu=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"avatarUploadRef",i.a.createRef()),Fe()(this,"onNameChange",e=>{this.setState({name:e.target.value})}),Fe()(this,"onSubmit",async e=>{if(e.preventDefault(),e.stopPropagation(),!this.state.busy){this.setState({busy:!0});try{let e=this.state.currentAvatarUrl||"";this.state.avatarFile&&(e=await Cs.a.get().uploadContent(this.state.avatarFile)),await Cs.a.get().setGroupProfile(this.props.communityId,{name:this.state.name,avatar_url:e}),await pu.a.refreshGroupProfile(Cs.a.get(),this.props.communityId),this.props.onFinished(!0)}catch(e){console.error(e),this.setState({busy:!1,error:Object(ts.a)("There was an error updating your community. The server is unable to process your request.")})}}}),Fe()(this,"onAvatarChanged",e=>{if(e.target.files&&e.target.files.length){this.setState({busy:!0});const t=e.target.files[0],a=new FileReader;a.onload=e=>{this.setState({avatarFile:t,busy:!1,avatarPreview:e.target.result})},a.readAsDataURL(t)}else this.setState({avatarFile:null})}),Fe()(this,"onChangeAvatar",()=>{this.avatarUploadRef.current&&this.avatarUploadRef.current.click()});const t=Bs.a.instance.getCommunityProfile(e.communityId);this.state={name:(null==t?void 0:t.name)||"",error:null,busy:!1,avatarFile:null,avatarPreview:null,currentAvatarUrl:null==t?void 0:t.avatarUrl}}render(){let e=i.a.createElement("img",{src:this.state.avatarPreview,className:"mx_EditCommunityPrototypeDialog_avatar"});if(!this.state.avatarPreview)if(this.state.currentAvatarUrl){const t=Object(Os.b)(this.state.currentAvatarUrl).srcHttp;e=i.a.createElement("img",{src:t,className:"mx_EditCommunityPrototypeDialog_avatar"})}else e=i.a.createElement("div",{className:"mx_EditCommunityPrototypeDialog_placeholderAvatar"});return i.a.createElement(hu.a,{className:"mx_EditCommunityPrototypeDialog",onFinished:this.props.onFinished,title:Object(ts.a)("Update community")},i.a.createElement("form",{onSubmit:this.onSubmit},i.a.createElement("div",{className:"mx_Dialog_content"},i.a.createElement("div",{className:"mx_EditCommunityPrototypeDialog_rowName"},i.a.createElement(rm.a,{value:this.state.name,onChange:this.onNameChange,placeholder:Object(ts.a)("Enter name"),label:Object(ts.a)("Enter name")})),i.a.createElement("div",{className:"mx_EditCommunityPrototypeDialog_rowAvatar"},i.a.createElement("input",{type:"file",style:{display:"none"},ref:this.avatarUploadRef,accept:"image/*",onChange:this.onAvatarChanged}),i.a.createElement(Fs.a,{onClick:this.onChangeAvatar,className:"mx_EditCommunityPrototypeDialog_avatarContainer"},e),i.a.createElement("div",{className:"mx_EditCommunityPrototypeDialog_tip"},i.a.createElement("b",null,Object(ts.a)("Add image (optional)")),i.a.createElement("span",null,Object(ts.a)("An image will help people identify your community.")))),i.a.createElement(Fs.a,{kind:"primary",onClick:this.onSubmit,disabled:this.state.busy},Object(ts.a)("Save")))))}})||cu;var fu,vu=a(147);let bu=Object(os.a)("structures.HostSignupAction")(fu=class extends i.a.PureComponent{constructor(){super(...arguments),Fe()(this,"openDialog",async()=>{await Jd.instance.setHostSignupActive(!0)})}render(){const e=$c.a.get().hostSignup;return null!=e&&e.brand?i.a.createElement(Ls.c,null,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconHosting",label:Object(ts.a)("Upgrade to %(hostSignupBrand)s",{hostSignupBrand:e.brand}),onClick:this.openDialog})):null}})||fu;var yu,Eu=a(250);let _u=Object(os.a)("structures.UserMenu")(yu=class extends i.a.Component{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"themeWatcherRef",void 0),Fe()(this,"dndWatcherRef",void 0),Fe()(this,"buttonRef",Object(s.createRef)()),Fe()(this,"tagStoreRef",void 0),Fe()(this,"onRoom",e=>{this.removePendingJoinRoom(e.roomId)}),Fe()(this,"onTagStoreUpdate",()=>{this.forceUpdate()}),Fe()(this,"onProfileUpdate",async()=>{this.forceUpdate()}),Fe()(this,"onSelectedSpaceUpdate",async e=>{this.setState({selectedSpace:e})}),Fe()(this,"onThemeChanged",()=>{this.setState({isDarkTheme:this.isUserOnDarkTheme()})}),Fe()(this,"onAction",e=>{switch(e.action){case js.a.ToggleUserMenu:this.state.contextMenuPosition?this.setState({contextMenuPosition:null}):this.buttonRef.current&&this.buttonRef.current.click();break;case js.a.JoinRoom:this.addPendingJoinRoom(e.roomId);break;case js.a.JoinRoomReady:case js.a.JoinRoomError:this.removePendingJoinRoom(e.roomId)}}),Fe()(this,"onOpenMenuClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})}),Fe()(this,"onContextMenu",e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{left:e.clientX,top:e.clientY,width:20,height:0}})}),Fe()(this,"onCloseMenu",()=>{this.setState({contextMenuPosition:null})}),Fe()(this,"onSwitchThemeClick",e=>{e.preventDefault(),e.stopPropagation(),ss.b.setValue("use_system_theme",null,mi.a.DEVICE,!1);const t=this.state.isDarkTheme?"light":"dark";ss.b.setValue("theme",null,mi.a.DEVICE,t)}),Fe()(this,"onSettingsOpen",(e,t)=>{e.preventDefault(),e.stopPropagation();const a={action:js.a.ViewUserSettings,initialTabId:t};gn.a.dispatch(a),this.setState({contextMenuPosition:null})}),Fe()(this,"onShowArchived",e=>{e.preventDefault(),e.stopPropagation()}),Fe()(this,"onProvideFeedback",e=>{e.preventDefault(),e.stopPropagation(),qd.a.createTrackedDialog("Feedback Dialog","",ou),this.setState({contextMenuPosition:null})}),Fe()(this,"onSignOutClick",async e=>{var t;e.preventDefault(),e.stopPropagation();const a=Cs.a.get();a&&a.isCryptoEnabled()&&null!==(t=await a.exportRoomKeys())&&void 0!==t&&t.length?qd.a.createTrackedDialog("Logout from LeftPanel","",lu):gn.a.dispatch({action:"logout"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onSignInClick",()=>{gn.a.dispatch({action:"start_login"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onRegisterClick",()=>{gn.a.dispatch({action:"start_registration"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onHomeClick",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"view_home_page"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onCommunitySettingsClick",e=>{e.preventDefault(),e.stopPropagation(),qd.a.createTrackedDialog("Edit Community","",gu,{communityId:Bs.a.instance.getSelectedCommunityId()}),this.setState({contextMenuPosition:null})}),Fe()(this,"onCommunityMembersClick",e=>{e.preventDefault(),e.stopPropagation();const t=Bs.a.instance.getSelectedCommunityGeneralChat();t?(gn.a.dispatch({action:"view_room",room_id:t.roomId},!0),gn.a.dispatch({action:js.a.SetRightPanelPhase,phase:_m.c.RoomMemberList})):qd.a.createTrackedDialog("Failed to find general chat","",uu.a,{title:Object(ts.a)("Failed to find the general chat for this community"),description:Object(ts.a)("Failed to find the general chat for this community")}),this.setState({contextMenuPosition:null})}),Fe()(this,"onCommunityInviteClick",e=>{e.preventDefault(),e.stopPropagation(),Object(mu.e)(Bs.a.instance.getSelectedCommunityId()),this.setState({contextMenuPosition:null})}),Fe()(this,"onDndToggle",e=>{e.stopPropagation();const t=ss.b.getValue("doNotDisturb");ss.b.setValue("doNotDisturb",null,mi.a.DEVICE,!t)}),Fe()(this,"renderContextMenu",()=>{if(!this.state.contextMenuPosition)return null;const e=Bs.a.instance.getSelectedCommunityName();let t;const n=$c.a.get().hostSignup;if(Cs.a.get().isGuest())t=i.a.createElement("div",{className:"mx_UserMenu_contextMenu_header mx_UserMenu_contextMenu_guestPrompts"},Object(ts.a)("Got an account? <a>Sign in</a>",{},{a:e=>i.a.createElement(Fs.a,{kind:"link",onClick:this.onSignInClick},e)}),Object(ts.a)("New here? <a>Create an account</a>",{},{a:e=>i.a.createElement(Fs.a,{kind:"link",onClick:this.onRegisterClick},e)}));else if(n&&n&&n.url){const e=n.domains||[],a=Cs.a.get().getDomain(),s=e.filter(e=>e===a||a.endsWith("."+e));(!n.domains||s.length>0)&&(t=i.a.createElement("div",{onClick:this.onCloseMenu},i.a.createElement(bu,null)))}let s,o=null;this.hasHomePage&&(o=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconHome",label:Object(ts.a)("Home"),onClick:this.onHomeClick})),ss.b.getValue(vu.a.Feedback)&&(s=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconMessage",label:Object(ts.a)("Feedback"),onClick:this.onProvideFeedback}));let r=i.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},i.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},Oi.a.instance.displayName),i.a.createElement("span",{className:"mx_UserMenu_contextMenu_userId"},Cs.a.get().getUserId())),l=i.a.createElement(i.a.Fragment,null,i.a.createElement(Ls.c,null,o,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconBell",label:Object(ts.a)("Notification settings"),onClick:e=>this.onSettingsOpen(e,om.b)}),i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconLock",label:Object(ts.a)("Security & privacy"),onClick:e=>this.onSettingsOpen(e,om.c)}),i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("All settings"),onClick:e=>this.onSettingsOpen(e,null)}),s),i.a.createElement(Ls.c,{red:!0},i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSignOut",label:Object(ts.a)("Sign out"),onClick:this.onSignOutClick}))),c=null;if(e){const t=Bs.a.instance.getSelectedCommunityId();let a,n;r=i.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},i.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},e)),Bs.a.instance.canInviteTo(t)&&(n=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconInvite",label:Object(ts.a)("Invite"),onClick:this.onCommunityInviteClick})),Bs.a.instance.isAdminOf(t)&&(a=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("Settings"),"aria-label":Object(ts.a)("Community settings"),onClick:this.onCommunitySettingsClick})),l=i.a.createElement(Ls.c,null,a,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconMembers",label:Object(ts.a)("Members"),onClick:this.onCommunityMembersClick}),n),c=i.a.createElement(i.a.Fragment,null,i.a.createElement("hr",null),i.a.createElement("div",{className:"mx_UserMenu_contextMenu_header"},i.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},i.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},Oi.a.instance.displayName),i.a.createElement("span",{className:"mx_UserMenu_contextMenu_userId"},Cs.a.get().getUserId()))),i.a.createElement(Ls.c,null,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("Settings"),"aria-label":Object(ts.a)("User settings"),onClick:e=>this.onSettingsOpen(e,null)}),s),i.a.createElement(Ls.c,{red:!0},i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSignOut",label:Object(ts.a)("Sign out"),onClick:this.onSignOutClick})))}else Cs.a.get().isGuest()&&(l=i.a.createElement(i.a.Fragment,null,i.a.createElement(Ls.c,null,o,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("Settings"),onClick:e=>this.onSettingsOpen(e,null)}),s)));const d=Hn()({mx_UserMenu_contextMenu:!0,mx_UserMenu_contextMenu_prototype:!!e});return i.a.createElement(Ls.e,{left:this.state.contextMenuPosition.width+this.state.contextMenuPosition.left-10,top:this.state.contextMenuPosition.top+this.state.contextMenuPosition.height+8,onFinished:this.onCloseMenu,className:d},i.a.createElement("div",{className:"mx_UserMenu_contextMenu_header"},r,i.a.createElement(is.a,{className:"mx_UserMenu_contextMenu_themeButton",onClick:this.onSwitchThemeClick,title:this.state.isDarkTheme?Object(ts.a)("Switch to light mode"):Object(ts.a)("Switch to dark mode")},i.a.createElement("img",{src:a(1475),alt:Object(ts.a)("Switch theme"),width:16}))),t,l,c)}),this.state={contextMenuPosition:null,isDarkTheme:this.isUserOnDarkTheme(),pendingRoomJoin:new Set},Oi.a.instance.on(gi.b,this.onProfileUpdate),ss.b.getValue("feature_spaces")&&Gs.e.instance.on(Gs.c,this.onSelectedSpaceUpdate),this.dndWatcherRef=ss.b.watchSetting("doNotDisturb",null,()=>this.forceUpdate())}get hasHomePage(){return!!Object(Yc.a)($c.a.get())}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),this.themeWatcherRef=ss.b.watchSetting("theme",null,this.onThemeChanged),this.tagStoreRef=Qn.a.addListener(this.onTagStoreUpdate),Cs.a.get().on("Room",this.onRoom)}componentWillUnmount(){this.themeWatcherRef&&ss.b.unwatchSetting(this.themeWatcherRef),this.dndWatcherRef&&ss.b.unwatchSetting(this.dndWatcherRef),this.dispatcherRef&&gn.a.unregister(this.dispatcherRef),Oi.a.instance.off(gi.b,this.onProfileUpdate),this.tagStoreRef.remove(),ss.b.getValue("feature_spaces")&&Gs.e.instance.off(Gs.c,this.onSelectedSpaceUpdate),Cs.a.get().removeListener("Room",this.onRoom)}isUserOnDarkTheme(){if(ss.b.getValue("use_system_theme"))return window.matchMedia("(prefers-color-scheme: dark)").matches;{const e=ss.b.getValue("theme");return e.startsWith("custom-")?Object(du.c)(e.substring("custom-".length)).is_dark:"dark"===e}}addPendingJoinRoom(e){this.setState({pendingRoomJoin:new Set(this.state.pendingRoomJoin).add(e)})}removePendingJoinRoom(e){this.state.pendingRoomJoin.delete(e)&&this.setState({pendingRoomJoin:new Set(this.state.pendingRoomJoin)})}render(){const e=Cs.a.get().getUserId(),t=Oi.a.instance.displayName||e,a=Oi.a.instance.getHttpAvatarUrl(32),n=Bs.a.instance.getSelectedCommunityName();let s,o=!1,r=Object(ts.a)("User menu"),l=i.a.createElement(i.a.Fragment,null,i.a.createElement("img",{className:"avatar_nav_mobile",src:"themes/element/img/backgrounds/logoIcare.png",alt:""})),c=i.a.createElement("span",{className:"mx_UserMenu_headerButtons"});if(this.state.selectedSpace)l=i.a.createElement("div",{className:"mx_UserMenu_doubleName"},i.a.createElement("img",{src:a}),i.a.createElement("span",{className:"mx_UserMenu_userName"},t),i.a.createElement(Eu.a,{room:this.state.selectedSpace},e=>i.a.createElement("span",{className:"mx_UserMenu_subUserName"},e)),i.a.createElement("span",{className:"mx_UserMenu_headerButtons"}));else if(n)l=i.a.createElement("div",{className:"mx_UserMenu_doubleName"},i.a.createElement("span",{className:"mx_UserMenu_userName"},n),i.a.createElement("span",{className:"mx_UserMenu_subUserName"},t),i.a.createElement("span",{className:"mx_UserMenu_headerButtons"})),r=Object(ts.a)("Community and user menu"),o=!0;else if(ss.b.getValue("feature_communities_v2_prototypes"))l=i.a.createElement("div",{className:"mx_UserMenu_doubleName"},i.a.createElement("span",{className:"mx_UserMenu_userName"},Object(ts.a)("Home")),i.a.createElement("span",{className:"mx_UserMenu_subUserName"},t),i.a.createElement("span",{className:"mx_UserMenu_headerButtons"})),o=!0;else if(ss.b.getValue("feature_dnd")){const e=ss.b.getValue("doNotDisturb");s=i.a.createElement(Fs.a,{onClick:this.onDndToggle,className:Hn()({mx_UserMenu_dnd:!0,mx_UserMenu_dnd_noisy:!e,mx_UserMenu_dnd_muted:e})})}this.props.isMinimized&&(l=null,c=null);const d=Hn()({mx_UserMenu:!0,mx_UserMenu_minimized:this.props.isMinimized,mx_UserMenu_prototype:o});return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kr.c,{className:d,inputRef:this.buttonRef,label:r,isExpanded:!!this.state.contextMenuPosition,onContextMenu:this.onContextMenu},i.a.createElement("div",{className:"mx_UserMenu_row expanse"},l)),this.renderContextMenu())}})||yu;var Su,Cu=a(251);let wu=Object(os.a)("views.elements.TooltipButton")(Su=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onMouseOver",()=>{this.setState({hover:!0})}),Fe()(this,"onMouseLeave",()=>{this.setState({hover:!1})}),this.state={hover:!1}}render(){const e=On.getComponent("elements.Tooltip"),t=this.state.hover?i.a.createElement(e,{className:"mx_TooltipButton_container",tooltipClassName:"mx_TooltipButton_helpText",label:this.props.helpText}):i.a.createElement("div",null);return i.a.createElement("div",{className:"mx_TooltipButton",onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave},"?",t)}})||Su;var Ou,xu=a(1458),Ru=a.n(xu);let ku=Object(os.a)("structures.UserMenu")(Ou=class extends i.a.Component{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"themeWatcherRef",void 0),Fe()(this,"dndWatcherRef",void 0),Fe()(this,"buttonRef",Object(s.createRef)()),Fe()(this,"tagStoreRef",void 0),Fe()(this,"onRoom",e=>{this.removePendingJoinRoom(e.roomId)}),Fe()(this,"onTagStoreUpdate",()=>{this.forceUpdate()}),Fe()(this,"onProfileUpdate",async()=>{this.forceUpdate()}),Fe()(this,"onSelectedSpaceUpdate",async e=>{this.setState({selectedSpace:e})}),Fe()(this,"onThemeChanged",()=>{this.setState({isDarkTheme:this.isUserOnDarkTheme()})}),Fe()(this,"onAction",e=>{switch(e.action){case js.a.ToggleUserMenu:this.state.contextMenuPosition?this.setState({contextMenuPosition:null}):this.buttonRef.current&&this.buttonRef.current.click();break;case js.a.JoinRoom:this.addPendingJoinRoom(e.roomId);break;case js.a.JoinRoomReady:case js.a.JoinRoomError:this.removePendingJoinRoom(e.roomId)}}),Fe()(this,"onOpenMenuClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})}),Fe()(this,"onContextMenu",e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{left:e.clientX,top:e.clientY,width:20,height:0}})}),Fe()(this,"onCloseMenu",()=>{this.setState({contextMenuPosition:null})}),Fe()(this,"onSwitchThemeClick",e=>{e.preventDefault(),e.stopPropagation(),ss.b.setValue("use_system_theme",null,mi.a.DEVICE,!1);const t=this.state.isDarkTheme?"light":"dark";ss.b.setValue("theme",null,mi.a.DEVICE,t)}),Fe()(this,"onSettingsOpen",(e,t)=>{e.preventDefault(),e.stopPropagation();const a={action:js.a.ViewUserSettings,initialTabId:t};gn.a.dispatch(a),this.setState({contextMenuPosition:null})}),Fe()(this,"onShowArchived",e=>{e.preventDefault(),e.stopPropagation()}),Fe()(this,"onProvideFeedback",e=>{e.preventDefault(),e.stopPropagation(),qd.a.createTrackedDialog("Feedback Dialog","",ou),this.setState({contextMenuPosition:null})}),Fe()(this,"onSignOutClick",async e=>{var t;e.preventDefault(),e.stopPropagation();const a=Cs.a.get();a&&a.isCryptoEnabled()&&null!==(t=await a.exportRoomKeys())&&void 0!==t&&t.length?qd.a.createTrackedDialog("Logout from LeftPanel","",lu):gn.a.dispatch({action:"logout"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onSignInClick",()=>{gn.a.dispatch({action:"start_login"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onRegisterClick",()=>{gn.a.dispatch({action:"start_registration"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onHomeClick",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"view_home_page"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onCommunitySettingsClick",e=>{e.preventDefault(),e.stopPropagation(),qd.a.createTrackedDialog("Edit Community","",gu,{communityId:Bs.a.instance.getSelectedCommunityId()}),this.setState({contextMenuPosition:null})}),Fe()(this,"onCommunityMembersClick",e=>{e.preventDefault(),e.stopPropagation();const t=Bs.a.instance.getSelectedCommunityGeneralChat();t?(gn.a.dispatch({action:"view_room",room_id:t.roomId},!0),gn.a.dispatch({action:js.a.SetRightPanelPhase,phase:_m.c.RoomMemberList})):qd.a.createTrackedDialog("Failed to find general chat","",uu.a,{title:Object(ts.a)("Failed to find the general chat for this community"),description:Object(ts.a)("Failed to find the general chat for this community")}),this.setState({contextMenuPosition:null})}),Fe()(this,"onCommunityInviteClick",e=>{e.preventDefault(),e.stopPropagation(),Object(mu.e)(Bs.a.instance.getSelectedCommunityId()),this.setState({contextMenuPosition:null})}),Fe()(this,"onDndToggle",e=>{e.stopPropagation();const t=ss.b.getValue("doNotDisturb");ss.b.setValue("doNotDisturb",null,mi.a.DEVICE,!t)}),Fe()(this,"renderContextMenu",()=>{if(!this.state.contextMenuPosition)return null;const e=Bs.a.instance.getSelectedCommunityName();let t;const a=$c.a.get().hostSignup;if(Cs.a.get().isGuest())t=i.a.createElement("div",{className:"mx_UserMenu_contextMenu_header mx_UserMenu_contextMenu_guestPrompts"},Object(ts.a)("Got an account? <a>Sign in</a>",{},{a:e=>i.a.createElement(Fs.a,{kind:"link",onClick:this.onSignInClick},e)}),Object(ts.a)("New here? <a>Create an account</a>",{},{a:e=>i.a.createElement(Fs.a,{kind:"link",onClick:this.onRegisterClick},e)}));else if(a&&a&&a.url){const e=a.domains||[],n=Cs.a.get().getDomain(),s=e.filter(e=>e===n||n.endsWith("."+e));(!a.domains||s.length>0)&&(t=i.a.createElement("div",{onClick:this.onCloseMenu},i.a.createElement(bu,null)))}let n,s=null;this.hasHomePage&&(s=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconHome",label:Object(ts.a)("Home"),onClick:this.onHomeClick})),ss.b.getValue(vu.a.Feedback)&&(n=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconMessage",label:Object(ts.a)("Feedback"),onClick:this.onProvideFeedback}));let o=i.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},i.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},Oi.a.instance.displayName)),r=i.a.createElement(Ls.c,{red:!0},i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSignOut",label:Object(ts.a)("Sign out"),onClick:this.onSignOutClick})),l=null;if(e){const t=Bs.a.instance.getSelectedCommunityId();let a,s;o=i.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},i.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},e)),Bs.a.instance.canInviteTo(t)&&(s=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconInvite",label:Object(ts.a)("Invite"),onClick:this.onCommunityInviteClick})),Bs.a.instance.isAdminOf(t)&&(a=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("Settings"),"aria-label":Object(ts.a)("Community settings"),onClick:this.onCommunitySettingsClick})),r=i.a.createElement(Ls.c,null,a,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconMembers",label:Object(ts.a)("Members"),onClick:this.onCommunityMembersClick}),s),l=i.a.createElement(i.a.Fragment,null,i.a.createElement("hr",null),i.a.createElement("div",{className:"mx_UserMenu_contextMenu_header"},i.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},i.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},Oi.a.instance.displayName),i.a.createElement("span",{className:"mx_UserMenu_contextMenu_userId"},Cs.a.get().getUserId()))),i.a.createElement(Ls.c,null,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("Settings"),"aria-label":Object(ts.a)("User settings"),onClick:e=>this.onSettingsOpen(e,null)}),n),i.a.createElement(Ls.c,{red:!0},i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSignOut",label:Object(ts.a)("Sign out"),onClick:this.onSignOutClick})))}else Cs.a.get().isGuest()&&(r=i.a.createElement(i.a.Fragment,null,i.a.createElement(Ls.c,null,s,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("Settings"),onClick:e=>this.onSettingsOpen(e,null)}),n)));const c=Hn()({mx_UserMenu_contextMenu:!0,mx_UserMenu_contextMenu_prototype:!!e});return i.a.createElement(Ls.e,{right:16,top:62,onFinished:this.onCloseMenu,className:c},t,r,l)}),this.state={contextMenuPosition:null,isDarkTheme:this.isUserOnDarkTheme(),pendingRoomJoin:new Set},Oi.a.instance.on(gi.b,this.onProfileUpdate),ss.b.getValue("feature_spaces")&&Gs.e.instance.on(Gs.c,this.onSelectedSpaceUpdate),this.dndWatcherRef=ss.b.watchSetting("doNotDisturb",null,()=>this.forceUpdate())}get hasHomePage(){return!!Object(Yc.a)($c.a.get())}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),this.themeWatcherRef=ss.b.watchSetting("theme",null,this.onThemeChanged),this.tagStoreRef=Qn.a.addListener(this.onTagStoreUpdate),Cs.a.get().on("Room",this.onRoom)}componentWillUnmount(){this.themeWatcherRef&&ss.b.unwatchSetting(this.themeWatcherRef),this.dndWatcherRef&&ss.b.unwatchSetting(this.dndWatcherRef),this.dispatcherRef&&gn.a.unregister(this.dispatcherRef),Oi.a.instance.off(gi.b,this.onProfileUpdate),this.tagStoreRef.remove(),ss.b.getValue("feature_spaces")&&Gs.e.instance.off(Gs.c,this.onSelectedSpaceUpdate),Cs.a.get().removeListener("Room",this.onRoom)}isUserOnDarkTheme(){if(ss.b.getValue("use_system_theme"))return window.matchMedia("(prefers-color-scheme: dark)").matches;{const e=ss.b.getValue("theme");return e.startsWith("custom-")?Object(du.c)(e.substring("custom-".length)).is_dark:"dark"===e}}addPendingJoinRoom(e){this.setState({pendingRoomJoin:new Set(this.state.pendingRoomJoin).add(e)})}removePendingJoinRoom(e){this.state.pendingRoomJoin.delete(e)&&this.setState({pendingRoomJoin:new Set(this.state.pendingRoomJoin)})}render(){const e=Cs.a.get().getUserId(),t=Oi.a.instance.displayName||e,a=(Oi.a.instance.getHttpAvatarUrl(32),Bs.a.instance.getSelectedCommunityName());let n=!1,s=Object(ts.a)("User menu");let o,r=i.a.createElement(i.a.Fragment,null,i.a.createElement("img",{src:"themes/element/img/backgrounds/_Base Avatar.png",alt:""}),i.a.createElement("span",{className:"mx_UserMenu_userName",style:this.props.size?{fontSize:this.props.size}:{}},t),i.a.createElement(Ru.a,{fontSize:"small",color:"inherit",className:"ArrowForwardIosIcon"})),l=i.a.createElement("span",{className:"mx_UserMenu_headerButtons"});if(this.state.selectedSpace)r=i.a.createElement("div",{className:"mx_UserMenu_doubleName"},i.a.createElement("span",{className:"mx_UserMenu_userName"},t),i.a.createElement(Eu.a,{room:this.state.selectedSpace},e=>i.a.createElement("span",{className:"mx_UserMenu_subUserName"},e)),i.a.createElement("span",{className:"mx_UserMenu_headerButtons"}));else if(a)r=i.a.createElement("div",{className:"mx_UserMenu_doubleName"},i.a.createElement("span",{className:"mx_UserMenu_userName"},a),i.a.createElement("span",{className:"mx_UserMenu_subUserName"},t),i.a.createElement("span",{className:"mx_UserMenu_headerButtons"})),s=Object(ts.a)("Community and user menu"),n=!0;else if(ss.b.getValue("feature_communities_v2_prototypes"))r=i.a.createElement("div",{className:"mx_UserMenu_doubleName"},i.a.createElement("span",{className:"mx_UserMenu_userName"},Object(ts.a)("Home")),i.a.createElement("span",{className:"mx_UserMenu_subUserName"},t),i.a.createElement("span",{className:"mx_UserMenu_headerButtons"})),n=!0;else if(ss.b.getValue("feature_dnd")){const e=ss.b.getValue("doNotDisturb");o=i.a.createElement(Fs.a,{onClick:this.onDndToggle,className:Hn()({mx_UserMenu_dnd:!0,mx_UserMenu_dnd_noisy:!e,mx_UserMenu_dnd_muted:e})})}this.props.isMinimized&&(r=null,l=null);const c=Hn()({mx_UserMenu:!0,mx_UserMenu_minimized:this.props.isMinimized,mx_UserMenu_prototype:n});return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kr.c,{className:c,inputRef:this.buttonRef,label:s,isExpanded:!!this.state.contextMenuPosition,onContextMenu:this.onContextMenu},i.a.createElement("div",{className:"mx_UserMenu_row expanse",onClick:this.onOpenMenuClick},r,this.state.pendingRoomJoin.size>0&&i.a.createElement(Cu.a,null,i.a.createElement(wu,{helpText:Object(ts.a)("Currently joining %(count)s rooms",{count:this.state.pendingRoomJoin.size})})),o)),this.renderContextMenu())}})||Ou;var Iu=a(524),Tu=a.n(Iu);const Pu=Object(n.makeStyles)(e=>({root:{}}));function Nu(e){const t=Pu(),{initialValues:a,handleSubmit:s,handleClose:o,isAddNew:r}=e,l=Ye.object({}),c=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:l,onSubmit:e=>{s(e)}});return console.log(c.values),i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:c.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:c,field:"userName",size:"small",label:"User Name",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:c,field:"firstName",size:"small",label:"First Name",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:c,field:"lastName",size:"small",label:"Last Name",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(P,{formik:c,label:"Birth Date",format:"dd/MM/yyyy",field:"birthDate",inputVariant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(z,{formik:c,optionList:[{value:"M",name:"Male"},{value:"F",name:"Female"},{value:"U",name:"Unknow"}],variant:"outlined",field:"gender",label:"Gender",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:c,field:"phoneNumber",size:"small",label:"Phone Number",variant:"outlined"})),!r&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(Va,{label:"Practitioner",formik:c,field:"practitioners",variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:c.values.practitioners?c.values.practitioners:[],columns:[{title:"Thao tác",field:"custom",align:"left",render:e=>i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{(e=>{const t=c.values.practitioners.filter(t=>t.practitioner.id!==e.practitioner.id);c.setFieldValue("practitioners",t)})(e)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))},{title:"LinkId",field:"linkId",align:"left"},{title:"First Name",field:"practitioner.firstName"},{title:"Last Name",field:"practitioner.lastName"},{title:"Gender",field:"practitioner.gender"},{title:"Phone Number",field:"practitioner.phoneNumber"},{title:"Room Id",field:"practitioner.phoneCallId"}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>o()},"Cancel"),i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Save"))))))}function Du(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ju(e){return i.a.createElement(vt.a,e)}class Au extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state,n={id:a,firstName:e.firstName,lastName:e.lastName,displayName:e.firstName+e.lastName,birthDate:e.birthDate,phoneNumber:e.phoneNumber,phoneCallId:e.phoneCallId,videoCallId:e.videoCallId,gender:e.gender,userName:e.userName,practitioners:e.practitioners};a?ei.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):ei.create(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={firstName:"",lastName:"",displayName:"",birthDate:null,phoneNumber:"",id:"",phoneCallId:"",videoCallId:"",gender:"",userName:"",practitioners:[],isAddNew:!0}}componentDidMount(){let e=this.props.item;e&&(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Du(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Du(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)),e.id&&this.setState({isAddNew:!1}))}render(){var e;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:ju,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Edit Patient":"Create Patient"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Nu,{initialValues:{firstName:this.state.firstName?this.state.firstName:"",userName:this.state.userName?this.state.userName:"",lastName:this.state.lastName?this.state.lastName:"",birthDate:this.state.birthDate?this.state.birthDate:null,phoneNumber:this.state.phoneNumber?this.state.phoneNumber:"",phoneCallId:this.state.phoneCallId?this.state.phoneCallId:"",videoCallId:this.state.videoCallId?this.state.videoCallId:"",gender:this.state.gender?this.state.gender:"",practitioners:this.state.practitioners?this.state.practitioners:[]},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,isAddNew:this.state.isAddNew}))}}function Mu(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Uu(e){return i.a.createElement(vt.a,e)}class Lu extends i.a.Component{constructor(e){super(e)}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Mu(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Mu(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){const e=On.getComponent("structures.GlobitsRoomView");let{_roomView:t,onRegistered:a,threepidInvite:s,currentRoomId:o,roomOobData:r,resizeNotifier:l,roomJustCreatedOpts:c,handleClose:d}=this.props;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Uu,fullWidth:!0,maxWidth:"md"},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.IconButton,{style:{position:"absolute",right:"10px",top:"10px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"})),i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement("div",{className:"chat-box",style:{display:"contents"}},i.a.createElement(e,{ref:t,onRegistered:a,threepidInvite:s,oobData:r,key:o,roomId:o,resizeNotifier:l,justCreatedOpts:c,style:{padding:"20px"}})))))}}var Fu=a(460),Bu=a.n(Fu);class Vu extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{const e={pageIndex:this.state.page+1,pageSize:this.state.rowsPerPage,text:this.state.text,display_name:this.state.display_name,wardId:this.state.wardId,provinceId:this.state.provinceId,districtId:this.state.districtId,status:this.state.status,displayName:this.state.displayName,code:this.state.code};this.setState({loadingTable:!0});const t=await Tn.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalElements,loadingTable:!1}),this.getUserNameByLogin(),this.setState({selectedList:[]})}),Fe()(this,"getUserNameByLogin",async()=>{const e=await Tn.getUserNameByLogin();this.setState({userName:e.data})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenDeleteListDialog:!1,shouldOpenViewPatientBasic:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{null!=e?this.props.history.push({pathname:y.a.ROOT_PATH+"patient/edit/"+e.id,state:{item:e}}):this.props.history.push({pathname:y.a.ROOT_PATH+"patient/create",state:{item:e}})}),Fe()(this,"handleViewItem",e=>{this.props.history.push({pathname:y.a.ROOT_PATH+"patient-medical-record/"+e.id,state:{item:e}})}),Fe()(this,"onChangeNamePatient",(e,t,a)=>{this.setState({display_name:t},()=>this.updatePageData())}),Fe()(this,"onChangeStatus",(e,t,a)=>{this.setState({status:t?t.value:t},()=>this.updatePageData())}),Fe()(this,"onChangeProvince",(e,t,a)=>{this.setState({provinceId:t?t.id:t},()=>this.updatePageData());this.setState({listDistrict:[]}),Tn.getFilterList({filterType:6}).then(e=>{let{data:t}=e;t.map(e=>{this.state.provinceId===e.parentId&&this.setState({listDistrict:[...this.state.listDistrict,e]})})})}),Fe()(this,"onChangeDistrict",(e,t,a)=>{this.setState({districtId:t?t.id:t},()=>this.updatePageData());this.setState({listWard:[]}),Tn.getFilterList({filterType:7}).then(e=>{let{data:t}=e;t.map(e=>{this.state.districtId===e.parentId&&this.setState({listWard:[...this.state.listWard,e]})})})}),Fe()(this,"onChangeWard",(e,t,a)=>{this.setState({wardId:t?t.id:t},()=>this.updatePageData())}),Fe()(this,"getListNamePatient",()=>{Tn.getFilterList({filterType:1}).then(e=>{let{data:t}=e;this.setState({listNamePatient:t})})}),Fe()(this,"getListStatus",()=>{Tn.getFilterList({filterType:4}).then(e=>{let{data:t}=e;this.setState({listStatus:t})})}),Fe()(this,"getListProvince",()=>{Tn.getFilterList({filterType:5}).then(e=>{let{data:t}=e;this.setState({listProvince:t})})}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e,shouldOpenChatDialog:!0},()=>{})}),Fe()(this,"handleSendRequest",async e=>{await Tn.sendLinkRequest(e)}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{Tn.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleViewPatientBasic",async e=>{e&&await Tn.getOneById(e).then(e=>{let{data:t}=e;t&&this.setState({patient:t,shouldOpenViewPatientBasic:!0})})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleDeleteList",async()=>{let e=0,t=0;const{selectedList:a}=this.state;if(a&&a.length>0){for(let n=0;n<a.length;n++)await Tn.deleteById(a[n].id).then(()=>{e++}).catch(()=>{t++});0!=e&&Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE),0!=t&&Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE),this.updatePageData(),this.handleClose()}else Ce.toast.warning("Chưa chọn dữ liệu",Oe.a.TOAST_CONFIGURE)}),Fe()(this,"renderTreatmentPeriodStatus",e=>{let t="";const a=Oe.a.TREATMENT_PERIOD_STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"renderGender",e=>{let t="";const a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleFilterClick",()=>{this.setState({openFilter:!this.state.openFilter}),!1===this.state.openFilter?this.setState({tableHeight:window.innerHeight-355}):this.setState({tableHeight:window.innerHeight-275})}),Fe()(this,"handleChangeRowsPerPage",e=>{this.setState({rowsPerPage:parseInt(e.target.value,10),page:0},()=>{this.updatePageData()})}),Fe()(this,"onChangeDisplayName",e=>{this.setState({displayName:e.target.value?e.target.value:null})}),Fe()(this,"onChangeCode",e=>{this.setState({code:e.target.value?e.target.value:null})}),Fe()(this,"filter",()=>{this.setState({page:0},()=>{this.updatePageData()})}),this.state={data:[],page:0,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",currentRoomId:"",userName:"",text:"",shouldOpenDeleteListDialog:!1,selectedList:[],patient:null,shouldOpenViewPatientBasic:!1,openFilter:!1,listNamePatient:[],listStatus:[],listProvince:[],listDistrict:[],listWard:[],loadingTable:!0}}async componentDidMount(){this.updatePageData(),this.getListNamePatient(),this.getListStatus(),this.getListProvince(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),window.innerHeight<750&&window.innerWidth<1290?this.setState({tableHeight:600}):this.setState({tableHeight:window.innerHeight-350})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){const{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,shouldOpenChatDialog:s,currentRoomId:o,text:r,shouldOpenDeleteListDialog:c,selectedList:d,shouldOpenViewPatientBasic:m,patient:u}=this.state,{_roomView:h,onRegistered:p,threepidInvite:g,roomOobData:f,resizeNotifier:v,roomJustCreatedOpts:b}=this.props,{classes:y}=this.props;return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,xs:12,className:Hn()(y.title,"d-inline-flex height-54")},i.a.createElement(un.a,{fontSize:"large",color:"primary",className:y.icon}),i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb",separator:"›",className:y.titleIcon},i.a.createElement("span",{className:y.icon},"Trang chủ"),i.a.createElement("span",null,"Danh sách khách hàng"))),i.a.createElement("div",{className:Hn()(y.contentPadding,"scroll")},i.a.createElement(n.Box,{className:y.filter},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:5,sm:6,xs:12},i.a.createElement("p",{className:"title-input"},"Tên khách hàng"),i.a.createElement(n.TextField,{className:"textField",variant:"outlined",placeholder:"Tên khách hàng",onChange:this.onChangeDisplayName})),i.a.createElement(n.Grid,{item:!0,lg:4,md:5,sm:6,xs:12},i.a.createElement("p",{className:"title-input"},"Mã khách hàng"),i.a.createElement(n.TextField,{className:"textField",variant:"outlined",placeholder:"Mã khách hàng",onChange:this.onChangeCode})),i.a.createElement(n.Grid,{item:!0,lg:2,md:2,sm:12,xs:12},i.a.createElement("button",{className:Hn()(y.button,"search_dskh"),onClick:this.filter},i.a.createElement("img",{src:"themes/element/img/SVG/Icon_search.svg",alt:"search"}),i.a.createElement("span",{className:y.search_text},"Tìm kiếm"))))),a&&i.a.createElement(Au,{handleClose:this.handleClose,open:a,item:e}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xoá",text:"Bạn có chắc chắn muốn xoá khách hàng này",agree:"Có",cancel:"Không"}),this.state.shouldOpenViewPatientBasic&&i.a.createElement(Po,{handleClose:this.handleClose,open:m,item:u,readOnly:!0}),s&&i.a.createElement(Lu,{handleClose:this.handleClose,open:s,item:e,ref:h,onRegistered:p,threepidInvite:g,roomOobData:f,currentRoomId:o,resizeNotifier:v,roomJustCreatedOpts:b}),c&&i.a.createElement(l,{open:c,onConfirmDialogClose:this.handleClose,onYesClick:this.handleDeleteList,title:"Xác nhận xoá",text:"Bạn có chắc chắn muốn xoá khách hàng này",agree:"Có",cancel:"Không"}),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12,className:"table-list-customer"},i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Mã khách hàng",field:"code",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:y.displayName},null==e?void 0:e.code))},{title:"Họ tên",field:"displayName",render:e=>i.a.createElement("div",null,e.displayName)},{title:"Lịch khám sắp tới",field:"nextAppointmentDate",render:e=>i.a.createElement("div",null,null!=e&&e.nextAppointmentDate?Te()(null==e?void 0:e.nextAppointmentDate).format("DD/MM/YYYY"):"")},{title:"Trạng thái kích hoạt",field:"active",render:e=>i.a.createElement(i.a.Fragment,null,0==e.active&&i.a.createElement("p",{className:"div__status customer__list--notActive"},"Chưa kích hoạt"),e.active&&i.a.createElement("p",{className:"div__status customer__list--Active"},"Đã kích hoạt"))},{title:"Hành động",field:"custom",type:"numeric",align:"left",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Button,{id:"btn-list-customer",onClick:async()=>{this.handleViewPatientBasic(null==e?void 0:e.id)}},"Chỉnh sửa"))}],options:{draggable:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{overflow:"auto",height:this.state.tableHeight},icons:dn}),i.a.createElement(Bu.a,{component:"div",count:this.state.totalPages,rowsPerPageOptions:[1,2,3,5,10,25],page:this.state.page,onPageChange:this.handleChangePage,rowsPerPage:this.state.rowsPerPage,onRowsPerPageChange:this.handleChangeRowsPerPage}))))}}var Gu=Object(Ho.withStyles)(e=>({title:{width:"100%",background:"#ffffff",padding:"19px 15px !important"},contentPadding:{padding:"0px 15px"},displayName:{color:"rgba(0, 0, 0, 0.87)",fontSize:"14px"},detail:{fontSize:"1.35rem"},icon:{marginRight:e.spacing(.5),color:"#0E9594",fontWeight:400},titleIcon:{fontWeight:700,marginRight:e.spacing(.5),color:"#0E9594"},button:{display:"flex",alignItems:"center",outline:"none",border:0,padding:"8px 12px",borderRadius:"4px",color:"#fff",background:"linear-gradient(#0E9594, #127475)",marginTop:"28px"},filter:{margin:"16px 0",background:"#ffffff",borderRadius:"4px",padding:"15px !important",boxShadow:"0px 2px 5px rgba(0, 46, 89, 0.15)"},search_text:{lineHeight:"16px"},filterTitle:{fontWeight:700}}))(Vu);var zu=e=>{let{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:i,roomJustCreatedOpts:o,resizeNotifier:r,history:l}=e;return s.createElement(Gu,{ref:t,onRegistered:a,threepidInvite:n,roomOobData:i,resizeNotifier:r,roomJustCreatedOpts:o,history:l})};const Wu=Object(n.makeStyles)(e=>({root:{}}));function Hu(e){const t=Wu(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({userName:Ye.string().ensure().required("Tên đăng nhập không được bỏ trống").lowercase(),displayName:Ye.string().required("Họ và tên không được bỏ trống"),phoneNumber:Ye.number().required("Số điện thoại không được bỏ trống"),birthDate:Ye.mixed().required("Ngày sinh không được bỏ trống")}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"userName",size:"small",label:i.a.createElement("span",null,"Tên tài khoản ",i.a.createElement("span",{style:{color:"red"}},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"displayName",size:"small",label:i.a.createElement("span",null,"Họ và tên ",i.a.createElement("span",{style:{color:"red"}},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,md:6,sm:6,xs:12},i.a.createElement(P,{formik:l,label:i.a.createElement("span",null,"Ngày sinh ",i.a.createElement("span",{style:{color:"red"}},"*")),format:"dd/MM/yyyy",field:"birthDate",inputVariant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(z,{formik:l,optionList:Oe.a.GENDER?Oe.a.GENDER:[],variant:"outlined",field:"gender",label:"Giới tính",size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"phoneNumber",size:"small",label:i.a.createElement("span",null,"Số điện thoại ",i.a.createElement("span",{style:{color:"red"}},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"email",size:"small",label:"Email",variant:"outlined"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"mr-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}function Ku(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function qu(e){return i.a.createElement(vt.a,e)}class Yu extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state;console.log(e);let n={id:a,userName:e.userName,displayName:e.displayName,birthDate:e.birthDate,phoneNumber:e.phoneNumber,gender:e.gender,email:e.email};a?Ua.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):Ua.create(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={displayName:"",birthDate:null,phoneNumber:"",id:"",gender:"",email:"",userName:""}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ku(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ku(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:qu,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",this.props.item.id?"Chỉnh sửa cán bộ y tế":"Thêm mới cán bộ y tế"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Hu,{initialValues:{displayName:this.state.displayName?this.state.displayName:"",birthDate:this.state.birthDate?this.state.birthDate:null,phoneNumber:this.state.phoneNumber?this.state.phoneNumber:"",gender:this.state.gender?this.state.gender:"",email:this.state.email?this.state.email:"",userName:this.state.userName?this.state.userName:""},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose}))}}function $u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ju(e){return i.a.createElement(vt.a,e)}class Qu extends i.a.Component{constructor(e){super(e)}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$u(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){const e=On.getComponent("structures.GlobitsRoomView");let{_roomView:t,onRegistered:a,threepidInvite:s,currentRoomId:o,roomOobData:r,resizeNotifier:l,roomJustCreatedOpts:c,handleClose:d}=this.props;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Ju,fullWidth:!0,maxWidth:"md"},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.IconButton,{style:{position:"absolute",right:"10px",top:"10px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"})),i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement("div",{className:"chat-box",style:{display:"contents"}},i.a.createElement(e,{ref:t,onRegistered:a,threepidInvite:s,oobData:r,key:o,roomId:o,resizeNotifier:l,justCreatedOpts:c,style:{padding:"20px"}})))))}}class Xu extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,getAllEntity:!1},t=await Ua.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages}),this.getUserNameByLogin()}),Fe()(this,"getUserNameByLogin",async()=>{let e=await Ua.getUserNameByLogin();this.setState({userName:e.data,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"handleAcceptLink",async e=>{await Ua.acceptInviteRoom(e)}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e,shouldOpenChatDialog:!0},()=>{})}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{Ua.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",currentRoomId:"",userName:"",text:"",loading:!1}}async componentDidMount(){await this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-270})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,shouldOpenChatDialog:s,currentRoomId:o,text:r}=this.state,{_roomView:c,onRegistered:d,threepidInvite:m,roomOobData:u,resizeNotifier:h,roomJustCreatedOpts:p}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Nhân viên y tế"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:r,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),a&&i.a.createElement(Yu,{handleClose:this.handleClose,open:a,item:e}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),s&&i.a.createElement(Qu,{handleClose:this.handleClose,open:s,item:e,ref:c,onRegistered:d,threepidInvite:m,roomOobData:u,currentRoomId:o,resizeNotifier:h,roomJustCreatedOpts:p}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Họ và tên",field:"displayName",align:"left"},{title:"Tên tài khoản",field:"userName"},{title:"Ngày sinh",field:"birthDate",render:e=>e.birthDate?i.a.createElement("span",null,Te()(e.birthDate).format("DD/MM/YYYY")):""},{title:"Giới tính",field:"gender",render:e=>this.renderGender(e.gender)},{title:"Số điện thoại",field:"phoneNumber"},{title:"Email",field:"email"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Ua.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},style:{height:this.state.tableHeight,overflow:"auto"},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Zu=e=>{let{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:i,roomJustCreatedOpts:o,resizeNotifier:r}=e;return s.createElement(Xu,{ref:t,onRegistered:a,threepidInvite:n,roomOobData:i,resizeNotifier:r,roomJustCreatedOpts:o})};const eh=Object(n.makeStyles)(e=>({root:{}}));function th(e){const t=eh(),{initialValues:a,handleSubmit:o,handleClose:r}=e,l=Ye.object({resultType:Ye.number().required("Đây là trường bắt buộc").typeError("Đây là trường bắt buộc")}),c=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:l,onSubmit:e=>{o(e)}}),[d,m]=Object(s.useState)(c.values.resultType?c.values.resultType:null);Object(s.useEffect)(()=>{c.values.resultType=d},[d]),Object(s.useEffect)(()=>{m(c.values.resultType)});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:c.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(S,{formik:c,field:"code",size:"small",label:"Mã xét nghiệm",variant:"outlined",required:!0})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(S,{formik:c,field:"name",size:"small",label:"Tên xét nghiệm",variant:"outlined",required:!0})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(S,{formik:c,classes:t,field:"description",size:"small",label:"Mô tả",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(z,{formik:c,optionList:Oe.a.LABTEST_TYPE?Oe.a.LABTEST_TYPE:[],variant:"outlined",field:"labTestType",label:"Loại xét nghiệm",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,required:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"resultType"},"Kiểu giá trị kết quả xét nghiệm "),i.a.createElement(n.Select,{labelId:"resultType",id:"resultType",value:d,onChange:e=>{m(e.target.value)},label:"Kiểu giá trị kết quả xét nghiệm"},Oe.a.LABTEST_RESULT_TYPE.map((e,t)=>i.a.createElement(n.MenuItem,{key:e.value,value:e.value},e.name))))),1==d&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:c,classes:t,field:"minNormalRange",size:"small",label:"Chỉ số bình thường thấp",variant:"outlined",type:"number",required:!0})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:c,classes:t,field:"maxNormalRange",size:"small",label:"Chỉ số bình thường cao",variant:"outlined",type:"number",required:!0}))),2==d&&i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(S,{formik:c,classes:t,field:"normalRange",size:"small",label:"Chỉ số bình thường",variant:"outlined",required:!0})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:c,classes:t,field:"unit",size:"small",label:"Đơn vị tính",variant:"outlined",required:!0})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:c,classes:t,field:"displayOrder",size:"small",type:"number",label:"Thứ tự sắp xếp",variant:"outlined",required:!0})),a.id&&i.a.createElement(n.Grid,{item:!0,lg:2,md:2,sm:2,xs:2},i.a.createElement(sa,{item:a,label:"Dịch vụ",formik:c,field:"billing",variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:c.values.billing?c.values.billing:[],columns:[{title:"Thao tác",field:"custom",align:"left",render:e=>i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{(e=>{const t=c.values.billing.filter(t=>t.id!==e.id);c.setFieldValue("billing",t)})(e)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))},{title:"Mã dịch vụ",field:"service.code"},{title:"Tên dịch vụ",field:"service.name"},{title:"Giá hiện tại",field:"price",render:e=>i.a.createElement(n.TextField,{id:"price-"+e.tableData.id,className:"font-inherit",name:"price",size:"small",variant:"outlined",InputProps:{inputComponent:ie},fullWidth:!0,value:e.price,onChange:t=>{let a=c.values.billing;a[e.tableData.id].price=t.target.value,c.setFieldValue("billing",a)}})}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}function ah(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function nh(e){return i.a.createElement(vt.a,e)}class sh extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state,n="";n=1==e.resultType?e.minNormalRange+" - "+e.maxNormalRange:e.normalRange;let s={id:a,code:e.code,name:e.name,labTestType:e.labTestType,description:e.description,resultType:e.resultType,minNormalRange:e.minNormalRange,maxNormalRange:e.maxNormalRange,normalRange:n,unit:e.unit,billing:e.billing,displayOrder:e.displayOrder};wa.checkCode(s).then(e=>{let{data:n}=e;n?Ce.toast.warning("Mã xét nghiệm đã tồn tại",Oe.a.TOAST_CONFIGURE):a?wa.update(s).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)}):wa.save(s).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})})}),this.state={code:"",name:"",labTestType:null,description:"",id:"",resultType:null,minNormalRange:null,maxNormalRange:null,normalRange:"",unit:"",billing:[],isAddNew:!0,displayOrder:null}}componentDidMount(){let e=this.props.item;e&&(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ah(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ah(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)),e.id&&this.setState({isAddNew:!1}))}render(){return console.log(this.state.id),i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:nh,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1"},i.a.createElement("span",{className:"mb-20 text-white"}," ",this.props.id?"Chỉnh sửa xét nghiệm":"Thêm mới xét nghiệm"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(th,{initialValues:{id:this.state.id?this.state.id:"",code:this.state.code?this.state.code:"",name:this.state.name?this.state.name:"",labTestType:this.state.labTestType?this.state.labTestType:null,description:this.state.description?this.state.description:"",resultType:this.state.resultType?this.state.resultType:null,minNormalRange:this.state.minNormalRange?this.state.minNormalRange:null,maxNormalRange:this.state.maxNormalRange?this.state.maxNormalRange:null,normalRange:this.state.normalRange?this.state.normalRange:"",unit:this.state.unit?this.state.unit:"",billing:this.state.billing?this.state.billing:[],displayOrder:this.state.displayOrder?this.state.displayOrder:null},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,isAddNew:this.state.isAddNew}))}}class ih extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await wa.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{wa.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)}).catch(e=>{console.log(e),this.handleClose()})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"renderLabTestType",e=>{let t="",a=Oe.a.LABTEST_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",text:"",loading:!1}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-270})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}render(){let{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,text:s}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Xét nghiệm"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:s,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),a&&i.a.createElement(sh,{handleClose:this.handleClose,open:a,item:e}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã",field:"code"},{title:"Tên",field:"name"},{title:"Loại xét nghiệm",field:"labTestType",render:e=>this.renderLabTestType(e.labTestType)},{title:"Mô tả",field:"description"},{title:"Chỉ số bình thường",field:"normalRange"},{title:"Đơn vị tính",field:"unit"},{title:"Thứ tự hiển thị",field:"displayOrder",width:"150"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await wa.getOneById(e.id);console.log(e.id),this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,style:{height:this.state.tableHeight,overflow:"auto"},isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var oh=()=>s.createElement(ih,null);var rh=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/roles/"+e.pageIndex+"/"+e.pageSize;return v.a.get(a)}};class lh extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage};this.setState({loadingTable:!0});let t=await rh.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loadingTable:!1})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",loadingTable:!0}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll),this.setState({tableHeight:window.innerHeight-170})}getScrollTop(){return this.containerRef.current.scrollTop}render(){return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Tên",field:"name",width:"150"},{title:"Quyền",field:"authority",width:"150"},{title:"Tạo bởi",field:"createdBy",align:"left",width:"150"}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var ch=e=>{let{}=e;return s.createElement(lh,null)},dh=a(872),mh=a.n(dh);const uh=Object(O.makeStyles)(e=>({root:{width:"100%"},container:{background:"rgb(237, 245, 251)",boxShadow:"0 0.5rem 1rem rgb(0 0 0, 15%)"},details:{background:"#fff"},heading:{fontSize:e.typography.pxToRem(15),flexBasis:"33.33%",flexShrink:0},secondaryHeading:{fontSize:e.typography.pxToRem(15),color:e.palette.text.secondary}}));function hh(e){const t=uh(),[a,s]=i.a.useState(!1);let{formik:o}=e;return i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("div",{className:t.root},i.a.createElement(n.Accordion,{className:t.container,expanded:"changePasswordPanel"===a,onChange:(r="changePasswordPanel",(t,a)=>{s(!!a&&r),e.setExpands(!!a)})},i.a.createElement(n.AccordionSummary,{expandIcon:i.a.createElement(mh.a,null),"aria-controls":"changePasswordPanelbh-content",id:"changePasswordPanelbh-header"},i.a.createElement(n.Typography,{className:t.heading},"Change Password")),a&&i.a.createElement(n.AccordionDetails,{className:t.details},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:6,sm:6,xs:12},i.a.createElement(n.TextField,{fullWidth:!0,required:!0,size:"small",name:"password",type:"password",label:"Password",variant:"outlined",value:o.values.password,onChange:o.handleChange,error:o.touched.password&&Boolean(o.errors.password),helperText:o.touched.password&&o.errors.password})),i.a.createElement(n.Grid,{item:!0,md:6,sm:6,xs:12},i.a.createElement(n.TextField,{fullWidth:!0,required:!0,size:"small",name:"confirmPassword",type:"password",label:"Confirm Password",variant:"outlined",value:o.values.confirmPassword,onChange:o.handleChange,error:o.touched.confirmPassword&&Boolean(o.errors.confirmPassword),helperText:o.touched.confirmPassword&&o.errors.confirmPassword})))))));var r}const ph=Object(n.makeStyles)(e=>({root:{}}));function gh(e){const t=ph(),[a,s]=i.a.useState(!1),{initialValues:o,handleSubmit:r,listGender:l,listRole:c,listOrg:d,handleChangePassWord:m,isAddNew:u,handleClose:h}=e,p=Ye.object({displayName:Ye.string().required("Trường này là bắt buộc").typeError("Trường này là bắt buộc").min(6,"Tên hiển thị quá ngắn").max(90,"Tên hiển thị quá dài"),username:Ye.string().required("Trường này là bắt buộc").typeError("Trường này là bắt buộc"),email:Ye.string().email("Email không hợp lệ").required("Trường này là bắt buộc").typeError("Trường này là bắt buộc"),roles:Ye.array().ensure().min(1,"Trường này là bắt buộc"),password:Ye.string().ensure().min(6,"Quá ngắn"),confirmPassword:Ye.string().ensure().oneOf([Ye.ref("password"),null],"Phải trùng với mật khẩu đã nhập")}),f=Ye.object({displayName:Ye.string().required("Trường này là bắt buộc").typeError("Trường này là bắt buộc").min(6,"Tên hiển thị quá ngắn").max(90,"Tên hiển thị quá dài"),username:Ye.string().required("Trường này là bắt buộc").typeError("Trường này là bắt buộc"),email:Ye.string().email("Email không hợp lệ").required("Trường này là bắt buộc").typeError("Trường này là bắt buộc"),roles:Ye.array().ensure().min(1,"Trường này là bắt buộc")}),v=Object(Y.useFormik)({enableReinitialize:!0,initialValues:o,validationSchema:a?p:f,onSubmit:e=>{r(e),console.log(e)}});return console.log(a),i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:v.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(S,{formik:v,size:"small",field:"displayName",type:"text",label:i.a.createElement("span",null,"Tên hiển thị ",i.a.createElement("span",{style:{color:"red"}},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{htmlFor:"gender-simple"},i.a.createElement("span",{className:"font"},"Giới tính  ",i.a.createElement("span",{style:{color:"red"}},"*"))),i.a.createElement(n.Select,{label:i.a.createElement("span",{className:"font"},"Giới tính  ",i.a.createElement("span",{style:{color:"red"}}," *")),value:v.values.gender,onChange:v.handleChange,inputProps:{name:"gender",id:"gender-simple"}},l.map(e=>i.a.createElement(n.MenuItem,{key:e.id,value:e.id},e.name))))),i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(S,{formik:v,size:"small",field:"username",type:"text",label:i.a.createElement("span",null,"Tên đăng nhập ",i.a.createElement("span",{style:{color:"red"}},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(S,{formik:v,size:"small",field:"email",type:"email",variant:"outlined",label:i.a.createElement("span",null,"Email ",i.a.createElement("span",{style:{color:"red"}},"*"))})),i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(g,{formik:v,multiple:!0,field:"roles",label:i.a.createElement("span",null,"Quyền ",i.a.createElement("span",{style:{color:"red"}},"*")),options:c||[],variant:"outlined",size:"small"})),!u&&i.a.createElement(hh,{formik:v,setExpands:e=>(e=>{s(e)})(e)}),u&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(S,{formik:v,size:"small",field:"password",type:"password",variant:"outlined",label:"Mật khẩu"})),i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(S,{formik:v,size:"small",field:"confirmPassword",type:"password",variant:"outlined",label:"Nhập lại mật khẩu"}))),i.a.createElement(n.Grid,{item:!0,sm:6,xs:12},i.a.createElement(n.FormControlLabel,{value:v.values.active,className:"mb-16",name:"active",onChange:v.handleChange,control:i.a.createElement(n.Checkbox,{checked:v.values.active}),label:"Kích hoạt"}),u&&i.a.createElement(R,{formik:v,field:"createAccountChat",label:"Tạo tài khoản chat"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{startIcon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit",loading:e.loading},"Lưu"))))))}function fh(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function vh(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fh(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fh(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function bh(e){return i.a.createElement(vt.a,e)}class yh extends i.a.Component{constructor(e){super(e),Fe()(this,"listGender",[{id:"M",name:"Nam"},{id:"F",name:"Nữ"},{id:"U",name:"Không rõ"}]),Fe()(this,"handleChangePassWord",e=>{this.setState({password:e,changePass:!0},()=>{})}),Fe()(this,"handleFormSubmit",async e=>{this.setState({loading:!0});let{handleClose:t}=this.props,{id:a}=this.state,n={displayName:e.displayName,username:e.username,gender:e.gender,email:e.email,roles:e.roles,isActive:e.isActive,active:e.active,password:e.password,confirmPassword:e.confirmPassword,person:e.person,createAccountChat:e.createAccountChat};e.password===e.confirmPassword&&(n.changePass=!0),n.person.displayName=e.displayName,n.person.gender=e.gender,a?await Ot.update(vh(vh({},n),{},{id:a})).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):await Ot.saveUser(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)}),this.setState({loading:!1})}),this.state={id:"",user:{},isAddNew:!1,listRole:[],roles:[],active:!0,email:"",person:{},username:"",changePass:!0,password:"",confirmPassword:"",createAccountChat:!0,loading:!1}}componentDidMount(){let e=this.props.item;e&&this.setState(vh({},e))}componentWillMount(){let{item:e}=this.props;e.id||this.setState({isAddNew:!0,user:e.user}),this.setState(e),this.setState(vh(vh({},e.user),{},{org:e.org}),()=>{this.setState({id:e.id,user:e.user,password:""})}),Ot.getAllRoles().then(e=>{let{data:t}=e;this.setState({listRole:t})})}render(){var e;let{id:t,isAddNew:a,listRole:s,roles:o,active:r,email:l,person:c,username:d,confirmPassword:m,password:u,createAccountChat:h}=this.state,{open:p,handleClose:g}=this.props;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:bh,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Sửa thông tin":"Tạo tài khoản"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(gh,{initialValues:{displayName:c?c.displayName:"",person:c||{},email:l||"",username:d||"",roles:o||[],gender:c?c.gender:{},confirmPassword:m||"",password:u||"",active:r,createAccountChat:h},isAddNew:a,handleChangePassWord:this.handleChangePassWord,handleClose:g,handleSubmit:this.handleFormSubmit,listRole:s,listGender:this.listGender,loading:this.state.loading}))}}class Eh extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text};this.setState({loadingTable:!0});let t=await Ot.searchByDto(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loadingTable:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleOnKeyDown",e=>{"Enter"===e.key&&this.updatePageData()}),Fe()(this,"handleChange",e=>{this.setState({text:e.target.value})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",text:""}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-270})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:3},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới"),a&&i.a.createElement(yh,{handleClose:this.handleClose,open:a,item:e})),i.a.createElement(n.Grid,{item:!0,md:4}),i.a.createElement(n.Grid,{item:!0,md:5},i.a.createElement(n.FormControl,{className:"float-right",fullWidth:!0},i.a.createElement(n.Input,{onChange:this.handleChange,name:"text",placeholder:"Nhập từ khóa",onKeyDown:this.handleOnKeyDown,endAdornment:i.a.createElement(n.InputAdornment,{position:"end"},i.a.createElement(n.IconButton,{type:"submit","aria-label":"search",onClick:this.updatePageData},i.a.createElement(Vt.a,null)))}))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{isLoading:this.state.loadingTable,data:this.state.data,columns:[{title:"Họ và tên",field:"displayName"},{title:"Tên tài khoản",field:"username"},{title:"Giới tính",field:"gender",render:e=>{var t;return null!==(t=e.person)&&void 0!==t&&t.gender?Oe.a.GENDER.find(t=>t.value===e.person.gender).name:null}},{title:"Email",field:"email"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Ot.getItemById(e.id);console.log(e.id),this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:this.state.tableHeight,overflow:"auto"},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var _h=e=>{let{}=e;return s.createElement(Eh,null)};var Sh=new class{async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-temp/searchByDto";return v.a.post(a,e)}async getById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-temp/"+e;return v.a.get(a)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-temp";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-temp/"+e.id;return v.a.put(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-temp/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-temp/checkCode";return v.a.post(a,e)}};const Ch=Object(n.makeStyles)(e=>({root:{}}));function wh(e){const t=Ch(),{initialValues:a,handleSubmit:s,handleClose:o,listLabTestType:r,isAddNew:l}=e,c=Ye.object({}),d=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:c,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:d.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:d,field:"correspondingTo",size:"small",label:"Tương ứng với tháng thứ mấy",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:d,field:"code",size:"small",label:"Mã bộ xét nghiệm",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:d,field:"name",size:"small",label:"Tên bộ xét nghiệm",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:d,field:"displayOrder",size:"small",label:"Thứ tự hiển thị",variant:"outlined",required:"true",type:"number"})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(S,{formik:d,field:"description",size:"small",label:"Mô tả",variant:"outlined",multiline:!0,rows:2})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(Ia,{formik:d,field:"items",variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:d.values.items?d.values.items:[],columns:[{title:"Thao tác",field:"custom",align:"left",render:e=>i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{(e=>{let t=d.values.items;console.log(t);const a=t.filter(t=>t.labTest.id!==e.labTest.id);d.setFieldValue("items",a)})(e)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))},{title:"Mã xét nghiệm",field:"labTest.code"},{title:"Tên xét nghiệm",field:"labTest.name"},{title:"Loại xét nghiệm",field:"labTest.labTestType",render:e=>(e=>{let t="",a=Oe.a.LABTEST_TYPE.find(t=>t.value==e);return a&&(t=a.name),t})(e.labTest.labTestType)},{title:"Mô tả",field:"labTest.description"},{title:"XN bắt buộc",field:"custom",align:"center",render:e=>i.a.createElement(gt,{title:"Xét nghiệm này bắt buộc"},i.a.createElement(n.Checkbox,{value:null==e?void 0:e.compulsoryToDoNewTest,checked:null==e?void 0:e.compulsoryToDoNewTest,onClick:t=>{((e,t,a)=>{let n=d.values.items;n[e][a]=t.target.checked,"compulsoryToDoNewTest"===a&&1==t.target.checked&&(n[e].canRefuseTest=!1),d.setFieldValue("items",n)})(e.tableData.id,t,"compulsoryToDoNewTest")}}))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",loading:e.loading,type:"submit"},"Lưu"))))))}function Oh(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function xh(e){return i.a.createElement(vt.a,e)}class Rh extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state;this.setState({loading:!0});let n={id:a,code:e.code,name:e.name,items:e.items,correspondingTo:e.correspondingTo,displayOrder:e.displayOrder,description:e.description};Sh.checkCode(n).then(e=>{let{data:s}=e;s?Ce.toast.warning("Mã đã tồn tại",Oe.a.TOAST_CONFIGURE):a?Sh.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):Sh.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}).finally(()=>{this.setState({loading:!1})})}),this.state={code:"",name:"",items:[],description:"",id:"",isAddNew:!0,correspondingTo:null,displayOrder:null,loading:!1}}componentDidMount(){let e=this.props.item;e&&(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Oh(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Oh(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)),e.id&&this.setState({isAddNew:!1}))}render(){var e;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:xh,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Chỉnh sửa Bộ xét nghiệm":"Thêm mới Bộ xét nghiệm"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(wh,{initialValues:{code:this.state.code?this.state.code:"",name:this.state.name?this.state.name:"",items:this.state.items?this.state.items:[],correspondingTo:this.state.correspondingTo?this.state.correspondingTo:null,displayOrder:this.state.displayOrder?this.state.displayOrder:null,description:this.state.description?this.state.description:null},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,isAddNew:this.state.isAddNew,loading:this.state.loading}))}}class kh extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Sh.searchByDto(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"onRedirectToURL",e=>{alert(e),gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleConfirmDeleteItem",()=>{Sh.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",shouldOpenEditorDialog:!1,isAddNew:!1,shouldOpenConfirmationDialog:!1,text:"",loading:!1}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-270})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Bộ mẫu xét nghiệm"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date}),this.setState({isAddNew:!1})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:this.state.text,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),this.state.shouldOpenEditorDialog&&i.a.createElement(Rh,{handleClose:this.handleClose,open:this.state.shouldOpenEditorDialog,item:this.state.item}),this.state.shouldOpenConfirmationDialog&&i.a.createElement(l,{open:this.state.shouldOpenConfirmationDialog,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã",field:"code",width:"150"},{title:"Tên",field:"name",width:"150"},{title:"Mô tả",field:"description",width:"150"},{title:"Thứ tự hiển thị",field:"displayOrder",width:"150"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Sh.getById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:this.state.tableHeight,overflow:"auto"},icons:dn,isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Ih=e=>{let{}=e;return s.createElement(kh,null)};const Th=Object(n.makeStyles)(e=>({root:{}}));function Ph(e){const t=Th(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({code:Ye.string().required(),name:Ye.string().required()}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Mã",variant:"outlined",required:!0})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Tên",variant:"outlined",required:!0})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(ca,{formik:l,field:"drugs",variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:l.values.drugs?l.values.drugs:[],columns:[{title:"Thao tác",field:"custom",align:"left",render:e=>i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{(e=>{const t=l.values.drugs.filter(t=>t.drug.id!==e.drug.id);l.setFieldValue("drugs",t)})(e)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))},{title:"Mã thuốc",field:"drug.code"},{title:"Tên thương mại",field:"drug.name"},{title:"Nhà sản xuất",field:"drug.manufacturer"},{title:"Số ngày",field:"numberDays",render:e=>i.a.createElement(n.TextField,{id:"numberDays-"+e.tableData.id,className:"font-inherit",name:"numberDays",size:"small",variant:"outlined",fullWidth:!0,defaultValue:e.numberDays,onChange:t=>{let a=l.values.drugs;a[e.tableData.id].numberDays=t.target.value,l.setFieldValue("drugs",a)}})},{title:"Tổng lượng thuốc",field:"totalQuantity",render:e=>i.a.createElement(n.TextField,{id:"totalQuantity-"+e.tableData.id,className:"font-inherit",name:"totalQuantity",size:"small",variant:"outlined",fullWidth:!0,defaultValue:e.totalQuantity,onChange:t=>{let a=l.values.drugs;a[e.tableData.id].totalQuantity=t.target.value,l.setFieldValue("drugs",a)}})},{title:"Số lượng dùng 1 ngày",field:"numberPerDay",render:e=>i.a.createElement(n.TextField,{id:"numberPerDay-"+e.tableData.id,className:"font-inherit",name:"numberPerDay",size:"small",variant:"outlined",fullWidth:!0,defaultValue:e.numberPerDay,onChange:t=>{let a=l.values.drugs;a[e.tableData.id].numberPerDay=t.target.value,l.setFieldValue("drugs",a)}})},{title:"Hướng dẫn sử dụng thuốc",field:"note",render:e=>i.a.createElement(n.TextField,{id:"note-"+e.tableData.id,className:"font-inherit",name:"note",multiline:!0,size:"small",variant:"outlined",fullWidth:!0,defaultValue:e.note,onChange:t=>{let a=l.values.drugs;a[e.tableData.id].note=t.target.value,l.setFieldValue("drugs",a)}})}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"mr-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit",loading:e.loading},"Lưu"))))))}function Nh(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Dh(e){return i.a.createElement(vt.a,e)}class jh extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props;this.setState({loading:!0});let{id:a}=this.state,n={id:a,code:e.code,name:e.name,type:e.type,drugs:e.drugs};Ga.checkCode(n).then(s=>{let{data:i}=s;i?Ce.toast.warning("Mã phác đồ đã tồn tại",Oe.a.TOAST_CONFIGURE):a?Ga.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):(console.log(e),Ga.create(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)}))}).finally(()=>{this.setState({loading:!1})})}),this.state={code:"",name:"",type:"",id:"",drugs:[],isAddNew:!0,loading:!1}}componentDidMount(){let e=this.props.item;e&&(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Nh(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Nh(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)),e.id&&this.setState({isAddNew:!1}))}render(){return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Dh,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1"},i.a.createElement("span",{className:"mb-20 text-white"}," ",this.state.id?"Chỉnh sửa phác đồ":"Thêm mới phác đồ"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Ph,{initialValues:{code:this.state.code?this.state.code:"",name:this.state.name?this.state.name:"",drugs:this.state.drugs?this.state.drugs:[]},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,isAddNew:this.state.isAddNew,loading:this.state.loading}))}}class Ah extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Ga.searchByDto(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{Ga.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"renderRegimentType",e=>{let t="",a=Oe.a.REGIMENT_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",currentRoomId:"",isAddNew:!1,text:"",loading:!1}}async componentDidMount(){this.updatePageData(),this.setState({tableHeight:window.innerHeight-270})}render(){let{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,shouldOpenChatDialog:s,currentRoomId:o,text:r}=this.state,{_roomView:c,onRegistered:d,threepidInvite:m,roomOobData:u,resizeNotifier:h,roomJustCreatedOpts:p}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Phác đồ"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date}),this.setState({isAddNew:!1})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:r,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),a&&i.a.createElement(jh,{handleClose:this.handleClose,open:a,item:e}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã phác đồ",field:"code",align:"left"},{title:"Tên phác đồ",field:"name"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Ga.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:this.state.tableHeight,overflow:"auto"},icons:dn,isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Mh=e=>{let{}=e;return s.createElement(Ah,null)};var Uh=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/value-code/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/value-code/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/value-code";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/value-code/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/value-code/"+e;return v.a.delete(a)}async checkCode(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/value-code/checkCode";return v.a.post(a,e)}};const Lh=Object(n.makeStyles)(e=>({root:{}}));function Fh(e){const t=Lh(),{initialValues:a,handleSubmit:s,handleClose:o,listLabTestType:r}=e,l=Ye.object({code:Ye.string().required("Trường này không được bỏ trống"),name:Ye.string().required("Trường này không được bỏ trống")}),c=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:l,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:c.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:c,field:"code",size:"small",label:i.a.createElement("span",null,"Mã",i.a.createElement("span",{style:{color:"red"}}," *")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:c,field:"name",size:"small",label:i.a.createElement("span",null,"Tên",i.a.createElement("span",{style:{color:"red"}}," *")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(z,{formik:c,optionList:[{value:"ICD",name:"ICD"},{value:"Loinc",name:"Loinc"},{value:"Snomed",name:"Snomed"}],variant:"outlined",field:"system",label:"Bộ mã",size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(z,{formik:c,optionList:Oe.a.VALUE_CODE_DATA_TYPE,variant:"outlined",field:"dataType",label:"Kiểu dữ liệu",size:"small"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",loading:e.loading,color:"primary",type:"submit"},"Lưu"))))))}function Bh(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Vh(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Bh(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Bh(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Gh(e){return i.a.createElement(vt.a,e)}class zh extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",async e=>{this.setState({loading:!0});let{handleClose:t}=this.props,{id:a}=this.state,n={code:e.code,name:e.name,system:e.system,dataType:e.dataType};a?await Uh.update(Vh(Vh({},n),{},{id:a})).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):await Uh.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)}),this.setState({loading:!1})}),this.state={code:"",name:"",system:"",id:"",isAddNew:!0,dataType:null,loading:!1}}componentDidMount(){let e=this.props.item;e&&this.setState(Vh({},e))}render(){return console.log(this.state.id),i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Gh,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",this.props.id?"Chỉnh sửa chuẩn mã hoá dữ liệu y tế":"Thêm mới chuẩn mã hoá dữ liệu y tế"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Fh,{initialValues:{code:this.state.code?this.state.code:"",name:this.state.name?this.state.name:"",system:this.state.system?this.state.system:null,dataType:this.state.dataType?this.state.dataType:null},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,loading:this.state.loading}))}}class Wh extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Uh.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{Uh.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi!!",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",text:"",loading:!1}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-270})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,text:s}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Chuẩn mã hóa dữ liệu y tế"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:s,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),a&&i.a.createElement(zh,{handleClose:this.handleClose,open:a,item:e}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã",field:"code"},{title:"Tên",field:"name"},{title:"Bộ mã",field:"system"},{title:"Kiểu dữ liệu",field:"dataType",render:e=>i.a.createElement(i.a.Fragment,null,e.dataType?Oe.a.VALUE_CODE_DATA_TYPE.find(t=>t.value===e.dataType).name:null)},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Uh.getOneById(e.id);console.log(e.id),this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,style:{height:this.state.tableHeight,overflow:"auto"},isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Hh=()=>s.createElement(Wh,null);const Kh=Object(n.makeStyles)(e=>({root:{}}));function qh(e){const t=Kh(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Mã",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Tên",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(z,{formik:l,optionList:Oe.a.HEALTH_ORGANIZATION_TYPE?Oe.a.HEALTH_ORGANIZATION_TYPE:[],variant:"outlined",field:"organizationType",label:"Phân loại",size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(Kt,{label:"Đơn vị hành chính",formik:l,field:"administrativeUnit",variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"shortDescription",size:"small",label:"Mô tả ngắn",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"longDescription",size:"small",label:"Mô tả dài",variant:"outlined",multiline:!0,rows:5}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit",loading:e.loading},"Lưu"))))))}function Yh(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function $h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yh(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yh(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Jh(e){return i.a.createElement(vt.a,e)}class Qh extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state;this.setState({loading:!0});let n=$h($h({},this.props.item),{},{id:a,name:e.name,code:e.code,administrativeUnit:e.administrativeUnit,organizationType:e.organizationType});ya.checkCode(n).then(e=>{let{data:s}=e;s?Ce.toast.warning("Mã đơn vị y tế đã tồn tại",Oe.a.TOAST_CONFIGURE):a?ya.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):ya.create(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}).finally(()=>{this.setState({loading:!0})})}),this.state={id:"",name:"",code:"",website:"",organizationType:null,parent:{},administrativeUnit:null,loading:!1}}componentDidMount(){let e=this.props.item;e&&this.setState($h({},e))}render(){var e;let{name:t,code:a,website:s,organizationType:o,administrativeUnit:r,parent:l}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Jh,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Chỉnh sửa Đơn vị y tế":"Thêm mới Đơn vị y tế"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(qh,{initialValues:{name:t||"",code:a||"",organizationType:o||null,administrativeUnit:r||null,longDescription:this.state.longDescription,shortDescription:this.state.shortDescription},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,loading:this.state.loading}))}}var Xh=a(877),Zh=a.n(Xh);class ep extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await ya.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{ya.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"handleSync",()=>{this.setState({totalElements:-1}),ya.updateListHealthOrg().then(()=>{}).finally(()=>{this.updatePageData()})}),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1,item:null,id:"",listEncounter:[],loading:!1}}async componentDidMount(){this.updatePageData(),this.setState({tableHeight:window.innerHeight-270})}render(){let{item:e,shouldOpenEditorDialog:t,shouldOpenConfirmationDialog:a,shouldOpenConfirmationDeleteListDialog:s,text:o}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Đơn vị y tế"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mr-12 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới"),i.a.createElement(n.Button,{className:"mr-12 btn btn-primary d-inline-flex",startIcon:i.a.createElement(Zh.a,null),variant:"contained",onClick:()=>{this.handleSync()}},"Đồng bộ")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:o,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),t&&i.a.createElement(Qh,{handleClose:this.handleClose,open:t,item:e}),a&&i.a.createElement(l,{open:a,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã",field:"code",align:"left",width:"150"},{title:"Tên",field:"name",width:"150"},{title:"Phân loại",field:"organizationType",width:"150",render:e=>{let t="";const a=Oe.a.HEALTH_ORGANIZATION_TYPE.find(t=>t.value==e.organizationType);return a&&(t=a.name),t}},{title:"Đơn vị hành chính",field:"administrativeUnit.name",width:"150"},{title:"Mô tả ngắn",field:"shortDescription",width:"150"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await ya.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:this.state.tableHeight,overflow:"auto"},icons:dn,isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var tp=e=>s.createElement(ep,null),ap=a(1459),np=a.n(ap),sp=a(875),ip=a.n(sp),op=a(511),rp=a.n(op);y.a.API_ENPOINT;var lp=new class{async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-medical-record-file/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-medical-record-file/"+e.id;return v.a.put(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-medical-record-file/getOne/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-medical-record-file/"+e;return v.a.delete(a)}async getByPatientIdImageType(e,t){var a=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+a;let n=y.a.API_ENPOINT+"/api/patient-medical-record-file/"+e+"/"+t;return v.a.get(n)}};const cp=y.a.API_ENPOINT+"/api/file/upload",dp=y.a.API_ENPOINT+"/api/fileDownload/document";var mp=new class{async uploadMedicalRecordFile(e){const t=cp+"/patient/medical-record";let a=new FormData;a.append("uploadfile",e.file),a.append("patient_id",e.id),a.append("description",e.description),a.append("type",e.type);return v.a.post(t,a,{headers:{"Content-Type":"multipart/form-data"}})}async downloadFile(e){let t=e.file,a=t.contentType,n=t.name;const s=dp+"/"+t.id;v.a.get(s,{responseType:"arraybuffer"}).then(e=>{let t=e.data,s=new Blob([t],{type:a});return He.a.saveAs(s,n)})}async viewFile(e){let t=e.file,a=t.contentType,n=t.name;const s=dp+"/"+t.id;v.a.get(s,{responseType:"arraybuffer"}).then(e=>{let t=e.data,s=null;if(s=new Blob([t],{type:a}),"application/pdf"==s.type||"image/jpeg"==s.type||"image/png"==s.type||"text/plain"==s.type){let e=URL.createObjectURL(s,n);return window.open(e)}Ce.toast.warning("Định dạng tệp tin không thể xem. Hãy tải xuống",Oe.a.TOAST_CONFIGURE)})}async setImageObjectURL(e,t){let a=e.file,n=a.contentType;const s=dp+"/"+a.id;await v.a.get(s,{responseType:"arraybuffer"}).then(e=>{let a=e.data,s=null;if(s=new Blob([a],{type:n}),"image"==s.type.split("/")[0]){let e=URL.createObjectURL(s);t(e)}})}};const up=Object(n.makeStyles)(e=>({root:{}}));function hp(e){var t,a;const o=up(),{initialValues:r,handleSubmit:c,handleClose:d,isAddNew:m,listRootUnit:u,listOccupation:h,listEthnicity:p}=e,f=Ye.object({}),b=Object(Y.useFormik)({enableReinitialize:!0,initialValues:r,validationSchema:f,onSubmit:e=>{c(e)}}),[E,_]=i.a.useState(!1),[C,w]=Object(s.useState)([]),[O,x]=Object(s.useState)(!1),[k,I]=i.a.useState(!1),[T,N]=i.a.useState(null),[D,j]=i.a.useState(!1),[A,M]=i.a.useState(null),[U,L]=i.a.useState(null);Object(s.useEffect)(()=>{O||(F(),x(!0),B())},[]);const F=()=>{V(),H(),r.id&&B()},B=async()=>{var e;let t=await to.getPatientPeriodPrepScreeningById(null===(e=r.treatmentPeriods[0])||void 0===e?void 0:e.periodPrepScreening.id);200===t.status&&N(t.data)},V=async()=>{null!=r.id&&await lp.searchByDto({pageIndex:1,pageSize:20,patientId:r.id,type:1}).then(e=>{let{data:t}=e;t&&t.content&&w(t.content)})},[G,W]=Object(s.useState)([]),H=async()=>{null!=r.id&&await lp.searchByDto({pageIndex:1,pageSize:20,patientId:null==r?void 0:r.id,type:2}).then(e=>{let{data:t}=e;t&&t.content&&W(t.content)})},K=async()=>{await F(),I(!1),X(!1),ae(!1),ue(!1),se(!1),I(!1),j(!1)},[$,J]=Object(s.useState)(""),[Q,X]=Object(s.useState)(!1),[Z,ee]=Object(s.useState)(!1),[te,ae]=Object(s.useState)(!1),[ne,se]=i.a.useState(!1),[ie,oe]=Object(s.useState)(null),[re,le]=Object(s.useState)(""),[ce,de]=Object(s.useState)(1),[me,ue]=i.a.useState(!1);return i.a.createElement("div",{className:o.root},E&&i.a.createElement(Ro,{open:E,handleClose:()=>{_(!1)},item:T,updateData:()=>B().then(()=>{e.updateData()})}),i.a.createElement("form",{onSubmit:b.handleSubmit},i.a.createElement("div",{className:"dialog-body-v2 "+(e.inTab?"intab":"")},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15 mt-15"},i.a.createElement("h3",{className:"text-white m-0"},"Thông tin cá nhân")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:b,field:"displayName",size:"small",label:i.a.createElement("span",null," Họ và tên ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(P,{formik:b,label:"Ngày sinh",format:"dd/MM/yyyy",field:"birthDate",inputVariant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"gender"},"Giới tính"),i.a.createElement(n.Select,{name:"gender",id:"gender",value:b.values.gender,onChange:e=>(e=>{b.setFieldValue(e.target.name,e.target.value),"F"!=e.target.value&&b.setFieldValue("pregnant",!1)})(e),label:"Giới tính"},Oe.a.GENDER.map((e,t)=>i.a.createElement(n.MenuItem,{key:e.value,value:e.value},e.name))))),"F"==b.values.gender&&i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(R,{formik:b,variant:"outlined",field:"pregnant",label:"Có mang thai",size:"small"})),D&&i.a.createElement(yt,{url:U,open:D,handleClose:()=>{K()},type:A}),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(g,{formik:b,field:"occupation",label:i.a.createElement("span",null," Nghề nghiệp ",i.a.createElement("span",{className:"color-red"},"*")),options:h||[],variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(g,{formik:b,field:"ethnicity",label:i.a.createElement("span",null," Dân tộc ",i.a.createElement("span",{className:"color-red"},"*")),options:p||[],variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:b,field:"idNumber",size:"small",label:(e=>{if(null!=e){return Te()().diff(Te()(e),"years")}return 0})(b.values.birthDate)>15?i.a.createElement("span",null," CMND ",i.a.createElement("span",{className:"color-red"},"*")):"CMND",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:b,field:"email",size:"small",label:i.a.createElement("span",null," Email ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:b,field:"phoneNumber",size:"small",label:i.a.createElement("span",null," Số điện thoại ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:b,field:"healthInsuranceNumber",size:"small",label:"Số thẻ BHYT",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(z,{formik:b,optionList:Oe.a.SERVICE_TYPE,variant:"outlined",field:"serviceType",label:i.a.createElement("span",null," Loại dịch vụ sử dụng ",i.a.createElement("span",{className:"color-red"},"*")),size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(P,{formik:b,label:"Ngày tiếp nhận",format:"dd/MM/yyyy",field:"receptionDate",inputVariant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:b,field:"userName",size:"small",label:i.a.createElement("span",null," Tên đăng nhập ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),!r.id&&i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12,className:"d-flex align-center ml-auto"},i.a.createElement("span",null,"Mật khẩu mặc định: ",i.a.createElement("strong",null,"123456")))),i.a.createElement(n.Grid,{className:"mt-16",container:!0,spacing:2},i.a.createElement(q,{formik:b,listRootUnit:u})),i.a.createElement(n.Grid,{className:"mt-16",container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15"},i.a.createElement("h3",{className:"text-white m-0"},"Thông tin người thân khi cần liên hệ")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(S,{formik:b,field:"supporterName",size:"small",label:"Họ và tên",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(S,{formik:b,field:"supporterAddress",size:"small",label:"Địa chỉ",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(S,{formik:b,field:"supporterPhoneNumber",size:"small",label:"Số điện thoại",variant:"outlined"}))))),!m&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15 mt-15"},i.a.createElement("h3",{className:"text-white m-0"},"Đính kèm hồ sơ bệnh án")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12,style:{display:"flex"}},i.a.createElement("label",{htmlFor:"upload-single-file"},i.a.createElement(n.Button,{variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"primary",component:"span"},"Chọn file")),i.a.createElement("input",{className:"display-none",onChange:e=>((e,t)=>{let a=e.target.files;oe(a[0]),le(""),de(t),ae(!0)})(e,1),id:"upload-single-file",type:"file"}),i.a.createElement("div",null,i.a.createElement("i",{style:{display:"block"}},"* Ảnh chụp CMND/CCCD"))),Q&&i.a.createElement(l,{open:Q,onConfirmDialogClose:K,onYesClick:async()=>{await lp.deleteById($).then(()=>{Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)}),await K()},title:"Xác nhận",text:"Bạn có chắc muốn xóa bản ghi này",agree:"Có",cancel:"Không"}),te&&i.a.createElement(Pt,{open:te,onConfirmDialogClose:K,handleSubmit:e=>{let t={file:ie,description:e,id:null==r?void 0:r.id,type:ce};mp.uploadMedicalRecordFile(t).then(e=>{Ce.toast.info("Tải tập tin thành công",Oe.a.TOAST_CONFIGURE),F()}),K()},handleClose:K,content:re,title:"Mô tả file đính kèm",label:"Nhập mô tả"}),me&&i.a.createElement(Pt,{open:me,onConfirmDialogClose:K,handleSubmit:async e=>{let t={id:$,description:e};await lp.update(t).then(()=>{Ce.toast.success("Đã cập nhật mô tả",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)}),K()},handleClose:K,content:re,title:"Cập nhật mô tả file đính kèm",label:"Nhập mô tả"}),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:C||[],columns:[{title:"Thao tác",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Tải xuống"},i.a.createElement(n.IconButton,{size:"medium",onClick:()=>(e=>{mp.downloadFile(e)})(e)},i.a.createElement(rp.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xem file"},i.a.createElement(n.IconButton,{size:"medium",onClick:()=>(e=>{let t=e.file,a=t.contentType;const n=y.a.API_ENPOINT+"/api/fileDownload/document/"+t.id;v.a.get(n,{responseType:"arraybuffer"}).then(e=>{let t=e.data,n=null;if(n=new Blob([t],{type:a}),"image/jpg"==n.type||"image/jpeg"==n.type||"image/png"==n.type){let e=URL.createObjectURL(n);L(e),M("img"),j(!0)}else if("application/pdf"==n.type){let e=URL.createObjectURL(n);M("pdf"),L(e),j(!0)}else Ce.toast.warning("Định dạng tệp tin không thể xem. Hãy tải xuống",Oe.a.TOAST_CONFIGURE)})})(e)},i.a.createElement(ze.a,{fontSize:"large",color:"action"}))),i.a.createElement(gt,{title:"Cập nhật mô tả"},i.a.createElement(n.IconButton,{size:"medium",onClick:()=>(e=>{le(e.description),J(e.id),ue(!0)})(e)},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"medium",onClick:()=>(e=>{J(e),X(!0)})(e.id)},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))),cellStyle:{padding:"4px 2px",minWidth:"80px"},headerStyle:{minWidth:"80px"}},{title:"Tên file",field:"file.name",align:"left",cellStyle:{padding:"4px 2px",minWidth:"500px"},headerStyle:{minWidth:"500px"}},{title:"Mô tả",field:"description",align:"left",cellStyle:{padding:"4px 2px",minWidth:"500px"},headerStyle:{minWidth:"500px"}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",padding:"6px"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle width-100percent"},i.a.createElement("div",{style:{display:"flex"}},r.id&&e.viewRiskAssesment&&T&&i.a.createElement(n.Button,{startIcon:i.a.createElement(go.a,null),variant:"contained",className:"mr-12 btn btn-warning d-inline-flex",onClick:async()=>{_(!0)}},"Xem kết quả sàng lọc"),e.id&&i.a.createElement(n.Button,{startIcon:i.a.createElement(ip.a,null),variant:"contained",className:"mr-12 btn btn-warning d-inline-flex",onClick:()=>{se(!0)}},"Yêu cầu bổ sung hồ sơ"),ne&&i.a.createElement(Pt,{open:ne,handleSubmit:async t=>{await Tn.updateProfileStatus({id:null==r?void 0:r.id,profileStatus:3,profileStatusRequired:t}).then(()=>{Ce.toast.success("Đã yêu gửi cầu bổ sung hồ sơ",Oe.a.TOAST_CONFIGURE),e.handleClose()}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})},handleClose:K,content:null!==(t=e.item)&&void 0!==t&&t.profileStatusRequired?null===(a=e.item)||void 0===a?void 0:a.profileStatusRequired:"",title:"Yêu cầu bổ sung hồ sơ",label:"Nhập yêu cầu bổ sung",multiline:!0,minRows:3,variant:"outlined",required:!0}),i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"mr-12 ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit",loading:e.loading},"Cập nhật thay đổi")),i.a.createElement("div",{style:{display:"flex",flex:"end"}},e.id&&i.a.createElement(_e,{icon:i.a.createElement(np.a,null),variant:"contained",className:"mr-12 btn btn-primary d-inline-flex",onClick:()=>(async t=>{ee(!0),await Tn.updateProfileStatus({id:null==r?void 0:r.id,profileStatus:t}).then(()=>{4==t&&Ce.toast.success("Đã xác nhận hồ sơ",Oe.a.TOAST_CONFIGURE),e.handleClose(),ee(!1)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})})(4),loading:Z},"Xác nhận hồ sơ"),i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",style:{marginRight:"12px"},color:"secondary",onClick:()=>d()},"Quay lại trang chủ"))))))))}function pp(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function gp(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pp(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pp(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class fp extends i.a.Component{constructor(e){super(e),Fe()(this,"updateData",async()=>{var e,t,a;let n=null===(e=this.props)||void 0===e||null===(t=e.match)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.id;if(n){let e=(await Tn.getOneById(n)).data;e&&(null!=e.currentResidence&&null!=e.currentResidence.id&&(this.setState({currentCommune:e.currentResidence,currentDistrict:e.currentResidence.parent?e.currentResidence.parent:null}),e.currentResidence.parent&&e.currentResidence.parent.id&&await _.getOneById(e.currentResidence.parent.id).then(e=>{let{data:t}=e;t&&this.setState({currentCity:t.parent?t.parent:null})})),null!=e.permanentResidence&&null!=e.permanentResidence.id&&(this.setState({permanentCommune:e.permanentResidence,permanentDistrict:e.permanentResidence.parent?e.permanentResidence.parent:null}),e.permanentResidence.parent&&e.permanentResidence.parent.id&&await _.getOneById(e.permanentResidence.parent.id).then(e=>{let{data:t}=e;t&&this.setState({permanentCity:t.parent?t.parent:null})})),this.setState(gp(gp({},e),{},{isAddNew:!1})))}await _.getRootUnit().then(e=>{let{data:t}=e;this.setState({listRootUnit:t})}),await $r.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&this.setState({listOccupation:t.content})}),await Yr.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&this.setState({listEthnicity:t.content})}),this.setState({didMountComplete:!0})}),Fe()(this,"handleClose",()=>{this.props.history.push({pathname:y.a.ROOT_PATH+"home"})}),Fe()(this,"handleFormSubmit",async e=>{this.setState({loading:!0});let{id:t}=this.state,a={id:t,displayName:e.displayName,birthDate:e.birthDate,phoneNumber:e.phoneNumber,gender:e.gender,userName:e.userName,practitioners:e.practitioners,idNumber:e.idNumber,email:e.email,prEPcode:e.prEPcode,currentResidence:e.currentCommune,permanentResidence:e.permanentCommune,supporterName:e.supporterName,supporterAddress:e.supporterAddress,supporterPhoneNumber:e.supporterPhoneNumber,serviceType:e.serviceType,clientResourceType:e.clientResourceType,receptionDate:e.receptionDate,ethnicity:e.ethnicity,occupation:e.occupation,currentDetailResidence:e.currentDetailResidence,permanentDetailResidence:e.permanentDetailResidence,healthInsuranceNumber:e.healthInsuranceNumber,pregnant:e.pregnant,clinicName:e.clinicName,startDateOfTreatment:e.startDateOfTreatment,lastVisit:e.lastVisit,nextAppointmentDate:e.nextAppointmentDate,mostRecentHivTestResults:e.mostRecentHivTestResults,prepRegimen:e.prepRegimen,numberOfMedicinesDispensed:e.numberOfMedicinesDispensed,currentTreatmentStatus:e.currentTreatmentStatus},n=await Tn.checkDuplicatePatient(a);var s,i,o;if(n&&(200==n.status&&n.data&&(null!==(s=n.data)&&void 0!==s&&s.isPhoneNumber||null!==(i=n.data)&&void 0!==i&&i.isIdNumBer)))return Ce.toast.warning(null===(o=n.data)||void 0===o?void 0:o.description,Oe.a.TOAST_CONFIGURE),void this.setState(gp(gp({},a),{},{loading:!1}));t?await Tn.update(a).then(()=>{Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE),this.handleClose()}):await Tn.create(a).then(()=>{Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE),this.handleClose()}),this.setState({loading:!1})}),this.state={displayName:"",birthDate:null,phoneNumber:"",id:null,gender:"",userName:"",practitioners:[],isAddNew:!0,occupation:"",idNumber:null,email:"",prEPcode:"",currentResidence:null,permanentResidence:null,supporterName:null,supporterAddress:null,supporterPhoneNumber:null,serviceType:null,clientResourceType:null,receptionDate:null,ethnicity:null,didMountComplete:!1,listRootUnit:[],currentDetailResidence:null,permanentDetailResidence:null,listOccupation:[],listEthnicity:[],healthInsuranceNumber:null,pregnant:!1,loading:!1}}async componentDidMount(){var e,t,a;let n=null===(e=this.props)||void 0===e||null===(t=e.match)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.id;if(n){let e=(await Tn.getOneById(n)).data;e&&(null!=e.currentResidence&&null!=e.currentResidence.id&&(this.setState({currentCommune:e.currentResidence,currentDistrict:e.currentResidence.parent?e.currentResidence.parent:null}),e.currentResidence.parent&&e.currentResidence.parent.id&&await _.getOneById(e.currentResidence.parent.id).then(e=>{let{data:t}=e;t&&this.setState({currentCity:t.parent?t.parent:null})})),null!=e.permanentResidence&&null!=e.permanentResidence.id&&(this.setState({permanentCommune:e.permanentResidence,permanentDistrict:e.permanentResidence.parent?e.permanentResidence.parent:null}),e.permanentResidence.parent&&e.permanentResidence.parent.id&&await _.getOneById(e.permanentResidence.parent.id).then(e=>{let{data:t}=e;t&&this.setState({permanentCity:t.parent?t.parent:null})})),this.setState(gp(gp({},e),{},{isAddNew:!1})))}await _.getRootUnit().then(e=>{let{data:t}=e;this.setState({listRootUnit:t})}),await $r.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&this.setState({listOccupation:t.content})}),await Yr.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&this.setState({listEthnicity:t.content})}),this.setState({didMountComplete:!0})}render(){let{displayName:e,userName:t,birthDate:a,occupation:n,gender:s,idNumber:o,email:r,prEPcode:l,phoneNumber:c,currentResidence:d,permanentResidence:m,supporterName:u,supporterAddress:h,supporterPhoneNumber:p,serviceType:g,clientResourceType:f,receptionDate:v,ethnicity:b,practitioners:y,didMountComplete:E,currentCommune:_,currentDistrict:S,currentCity:C,permanentCommune:w,permanentDistrict:O,permanentCity:x,currentDetailResidence:R,permanentDetailResidence:k,healthInsuranceNumber:I,pregnant:T,clinicName:P,startDateOfTreatment:N,lastVisit:D,nextAppointmentDate:j,mostRecentHivTestResults:A,prepRegimen:M,numberOfMedicinesDispensed:U,currentTreatmentStatus:L}=this.state;return E&&i.a.createElement(hp,{id:this.state.id,initialValues:gp(gp({},this.state),{},{displayName:e||"",userName:t||"",birthDate:a||null,phoneNumber:c||"",gender:s||"",practitioners:y||[],occupation:n||null,idNumber:o||"",email:r,prEPcode:l,currentResidence:d,permanentResidence:m,supporterName:u,supporterAddress:h,supporterPhoneNumber:p,serviceType:g,clientResourceType:f,receptionDate:v,ethnicity:b,currentCommune:_,currentDistrict:S,currentCity:C,permanentCommune:w,permanentDistrict:O,permanentCity:x,currentDetailResidence:R,permanentDetailResidence:k,healthInsuranceNumber:I,pregnant:T,clinicName:P,startDateOfTreatment:N,lastVisit:D,nextAppointmentDate:j,mostRecentHivTestResults:A,prepRegimen:M,numberOfMedicinesDispensed:U,currentTreatmentStatus:L}),handleSubmit:this.handleFormSubmit,handleClose:this.handleClose,listRootUnit:this.state.listRootUnit,listOccupation:this.state.listOccupation,listEthnicity:this.state.listEthnicity,isAddNew:this.state.isAddNew,loading:this.state.loading,viewRiskAssesment:this.props.viewRiskAssesment,updateData:()=>this.updateData(),inTab:this.props.inTab})}}var vp=fp;var bp=e=>s.createElement(vp,e);const yp=Object(n.makeStyles)(e=>({root:{}}));function Ep(e){const t=yp(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({code:Ye.string().required(),name:Ye.string().required()}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Mã",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Tên",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"description",size:"small",label:"Mô tả",variant:"outlined"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),loading:e.loading,className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}function _p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Sp(e){return i.a.createElement(vt.a,e)}class Cp extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{this.setState({loading:!0});let{handleClose:t}=this.props,{id:a}=this.state,n={id:a,name:e.name,code:e.code,description:e.description};$r.checkCode(n).then(e=>{let{data:s}=e;s?Ce.toast.warning("Mã nghề nghiệp này đã tồn tại",Oe.a.TOAST_CONFIGURE):a?$r.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):$r.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}).finally(()=>{this.setState({loading:!1})})}),this.state={id:"",name:"",code:"",description:"",loading:!1}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_p(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){var e;let{name:t,code:a,description:s}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Sp,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Chỉnh sửa Nghề nghiệp":"Thêm mới Nghề nghiệp"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Ep,{initialValues:{name:t||"",code:a||"",description:s||""},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,loading:this.state.loading}))}}class wp extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async e=>{this.setState({loading:!0}),null!=e?(this.setState({page:1,text:e.text}),this.search()):this.search()}),Fe()(this,"search",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await $r.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData(null)})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData(null)})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData(null)})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{$r.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",loading:!1}}async componentDidMount(){this.updatePageData(null),this.setState({tableHeight:window.innerHeight-280})}render(){let{item:e,shouldOpenEditorDialog:t,shouldOpenConfirmationDialog:a,text:s}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Nghề nghiệp"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:s,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),i.a.createElement(n.Grid,{item:!0,md:10},t&&i.a.createElement(Cp,{handleClose:this.handleClose,open:t,item:e}),a&&i.a.createElement(l,{open:a,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"})),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã",field:"code",align:"left",width:"150"},{title:"Tên",field:"name",width:"150"},{title:"",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await $r.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:this.state.tableHeight,overflow:"auto"},icons:dn,isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Op=e=>s.createElement(wp,null),xp=a(878),Rp=a.n(xp);const kp=Object(n.makeStyles)(e=>({root:{}})),Ip={toolbar:[],clipboard:{matchVisual:!0}};function Tp(e){var t;const a=kp(),{initialValues:s,handleClose:o}=e,r=Ye.object({}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:s,validationSchema:r,onSubmit:e=>{}});return i.a.createElement("div",{className:a.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:a,field:"subject",size:"small",label:"Chủ đề",variant:"outlined",disabled:!0})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:a,field:"toAddress",size:"small",label:"Địa chỉ hòm thư",variant:"outlined",disabled:!0})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(n.TextField,{name:"status",id:"status",label:"Trạng thái",variant:"outlined",fullWidth:!0,size:"small",defaultValue:null===(t=Oe.a.STATUS.find(e=>e.value==l.values.status))||void 0===t?void 0:t.name,disabled:!0})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,{fullWidth:!0,autoOk:!0,className:"font-inherit",id:"sentDate",name:"sentDate",label:"Ngày gửi",inputVariant:"outlined",InputAdornmentProps:{position:"end"},variant:"inline",placeholder:"dd/MM/yyyy",format:"dd/MM/yyyy",value:l.values.sentDate,defaultValue:l.values.sentDate,onChange:()=>{},disabled:!0}))),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement("fieldset",{className:"fieldset-border"},i.a.createElement("legend",{className:"legend-color"},"Nội dung"),i.a.createElement(Ft,{theme:"bubble",content:l.values.body,modules:Ip,handleContentChange:!0,onChange:()=>{},readOnly:!0})))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"})))))}function Pp(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Np(e){return i.a.createElement(vt.a,e)}class Dp extends i.a.Component{constructor(e){super(e),this.state={id:"",subject:"",toAddress:"",body:"",status:null,sentDate:null}}componentDidMount(){let e=this.props.item;console.log(e),e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Pp(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Pp(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){let{subject:e,toAddress:t,status:a,sentDate:s,body:o}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Np,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ","Chi tiết"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Tp,{initialValues:{subject:e||"",toAddress:t||"",status:a,sentDate:s||null,body:o},handleClose:this.props.handleClose}))}}var jp=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/mail-log/searchByPage";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/mail-log/"+e.id;return v.a.put(a,e)}async save(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/mail-log";return v.a.post(a,e)}async sendNotifications(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/mail-log/sendNotifications";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/mail-log/"+e;return v.a.get(a)}async getAllInfoByUserLogin(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/user/getAllInfoByUserLogin";return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/mail-log"+e;return v.a.delete(a)}};class Ap extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text};this.setState({loadingTable:!0});let t=await jp.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loadingTable:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{jp.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"renderStatus",e=>{let t="",a=Oe.a.STATUS.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"preventDefault",e=>e.preventDefault()),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",currentRoomId:"",text:"",loadingTable:!0}}async componentDidMount(){this.updatePageData(),this.setState({tableHeight:window.innerHeight-260})}render(){let{item:e,shouldOpenEditorDialog:t,text:a}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},t&&i.a.createElement(Dp,{handleClose:this.handleClose,open:t,item:e}),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:a,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Chủ đề",field:"subject",align:"left"},{title:"Email gửi tới",field:"toAddress"},{title:"Ngày gửi",field:"sentDate",render:e=>{let t=null;return null!=e&&e.sentDate&&(t=i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,Te()(null==e?void 0:e.sentDate).format("DD/MM/YYYY")))),t}},{title:"Trạng thái",field:"status",render:e=>this.renderStatus(e.status)},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Chi tiết"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await jp.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Rp.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{height:this.state.tableHeight,overflow:"auto"},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Mp=e=>{let{}=e;return s.createElement(Ap,null)};var Up=new class{async getAllByPatient(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-practitioner/getAllByPatient";return v.a.post(a,e)}async getAllByPractitioner(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-practitioner/getAllByPractitioner";return v.a.post(a,e)}async getUserNameByLogin(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/patient-practitioner/getUserName";return v.a.get(t)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-practitioner/getOne/"+e;return v.a.get(a)}async updateLinkRequestById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;var a=y.a.API_ENPOINT+"/api/patient-practitioner/updateLinkRequestById/"+e;return v.a.get(a)}async getOnePatientById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/getOne/"+e;return v.a.get(a)}};const Lp=Object(n.makeStyles)(e=>({root:{}}));function Fp(e){const t=Lp(),{initialValues:a,handleSubmit:s,handleClose:o,listRootUnit:r,listEthnicity:l,listOccupation:c}=e,d=Ye.object({}),m=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:d,onSubmit:e=>{s(e)}});return console.log(m.values),i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:m.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15"},i.a.createElement("h3",{className:"text-white m-0"},"Thông tin cá nhân")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:m,field:"displayName",size:"small",label:"Họ và tên",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(P,{formik:m,label:"Ngày sinh",format:"dd/MM/yyyy",field:"birthDate",inputVariant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(z,{formik:m,optionList:Oe.a.GENDER,variant:"outlined",field:"gender",label:"Giới tính",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(g,{formik:m,field:"occupation",label:"Nghề nghiệp",options:c||[],variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(g,{formik:m,field:"ethnicity",label:"Dân tộc",options:l||[],variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:m,field:"idNumber",size:"small",label:"CMND",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:m,field:"email",size:"small",label:"Email",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:m,field:"phoneNumber",size:"small",label:"Số điện thoại",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(z,{formik:m,optionList:Oe.a.SERVICE_TYPE,variant:"outlined",field:"serviceType",label:"Loại dịch vụ sử dụng",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(z,{formik:m,optionList:Oe.a.CLIENT_RESOURCE_TYPE,variant:"outlined",field:"clientResourceType",label:"Nguồn khách hàng",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(P,{formik:m,label:"Ngày tiếp nhận",format:"dd/MM/yyyy",field:"receptionDate",inputVariant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(S,{formik:m,field:"userName",size:"small",label:"Tài khoản",variant:"outlined"}))))),i.a.createElement(n.Grid,{className:"mt-16",container:!0,spacing:2},i.a.createElement(q,{formik:m,listRootUnit:r})),i.a.createElement(n.Grid,{className:"mt-16",container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15"},i.a.createElement("h3",{className:"text-white m-0"},"Thông tin người thân khi cần liên hệ")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(S,{formik:m,field:"supporterName",size:"small",label:"Họ và tên",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(S,{formik:m,field:"supporterAddress",size:"small",label:"Địa chỉ",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(S,{formik:m,field:"supporterPhoneNumber",size:"small",label:"Số điện thoại",variant:"outlined"})))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>o()},"Hủy"),i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu")))))))}function Bp(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Vp(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Bp(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Bp(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Gp(e){return i.a.createElement(D.a,{handle:"#draggable-dialog-title",cancel:'[class*="MuiDialogContent-root"]'},i.a.createElement(vt.a,e))}class zp extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state,n=Vp(Vp({},this.state),{},{id:a,displayName:e.displayName,birthDate:e.birthDate,phoneNumber:e.phoneNumber,gender:e.gender,userName:e.userName,practitioners:e.practitioners,occupation:e.occupation,idNumber:e.idNumber,email:e.email,currentResidence:e.currentCommune,permanentResidence:e.permanentCommune,supporterName:e.supporterName,supporterAddress:e.supporterAddress,supporterPhoneNumber:e.supporterPhoneNumber,serviceType:e.serviceType,clientResourceType:e.clientResourceType,receptionDate:e.receptionDate,ethnicity:e.ethnicity});a?ei.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):ei.create(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={displayName:"",birthDate:null,phoneNumber:"",id:"",gender:"",userName:"",practitioners:[],isAddNew:!0,occupation:"",idNumber:null,email:"",currentResidence:null,permanentResidence:null,supporterName:null,supporterAddress:null,supporterPhoneNumber:null,serviceType:null,clientResourceType:null,receptionDate:null,ethnicity:null,didMountComplete:!1,listRootUnit:[],listEthnicity:[],listOccupation:[]}}async componentDidMount(){let e=this.props.item;e&&(this.setState(Vp({},e)),e.id&&this.setState({isAddNew:!1}),e&&(null!=e.currentResidence&&null!=e.currentResidence.id&&(this.setState({currentCommune:e.currentResidence,currentDistrict:e.currentResidence.parent?e.currentResidence.parent:null}),e.currentResidence.parent&&e.currentResidence.parent.id&&await _.getOneById(e.currentResidence.parent.id).then(e=>{let{data:t}=e;t&&this.setState({currentCity:t.parent?t.parent:null})})),null!=e.permanentResidence&&null!=e.permanentResidence.id&&(this.setState({permanentCommune:e.permanentResidence,permanentDistrict:e.permanentResidence.parent?e.permanentResidence.parent:null}),e.permanentResidence.parent&&e.permanentResidence.parent.id&&await _.getOneById(e.permanentResidence.parent.id).then(e=>{let{data:t}=e;t&&(console.log(t),this.setState({permanentCity:t.parent?t.parent:null}))})),this.setState(Vp(Vp({},e),{},{isAddNew:!1})))),await _.getRootUnit().then(e=>{let{data:t}=e;this.setState({listRootUnit:t})}),await Yr.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&this.setState({listEthnicity:t.content})}),await $r.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&this.setState({listOccupation:t.content})}),this.setState({didMountComplete:!0})}render(){let{displayName:e,userName:t,birthDate:a,occupation:s,gender:o,idNumber:r,email:l,phoneNumber:c,currentResidence:d,permanentResidence:m,supporterName:u,supporterAddress:h,supporterPhoneNumber:p,serviceType:g,clientResourceType:f,receptionDate:v,ethnicity:b,practitioners:y,didMountComplete:E,currentCommune:_,currentDistrict:S,currentCity:C,permanentCommune:w,permanentDistrict:O,permanentCity:x}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Gp,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," Thông tin khách hàng "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Fp,{initialValues:{displayName:e||"",userName:t||"",birthDate:a||null,phoneNumber:c||"",gender:o||"",practitioners:y||[],occupation:s||"",idNumber:r||"",email:l,currentResidence:d,permanentResidence:m,supporterName:u,supporterAddress:h,supporterPhoneNumber:p,serviceType:g,clientResourceType:f,receptionDate:v,ethnicity:b,currentCommune:_,currentDistrict:S,currentCity:C,permanentCommune:w,permanentDistrict:O,permanentCity:x},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,listRootUnit:this.state.listRootUnit,listEthnicity:this.state.listEthnicity,listOccupation:this.state.listOccupation}))}}class Wp extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Up.getAllByPractitioner(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages}),this.getUserNameByLogin()}),Fe()(this,"getUserNameByLogin",async()=>{let e=await Up.getUserNameByLogin();this.setState({userName:e.data},()=>{this.getPractitionerByUserName(this.state.userName)})}),Fe()(this,"getPractitionerByUserName",async e=>{let t=await Ua.getPractitionerByUsername(e);this.setState({practitionerId:t.data.id})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleViewItem",(e,t)=>{this.props.history.push({pathname:y.a.ROOT_PATH+"medical-record/"+e.id,state:{item:e,practitionerId:this.state.practitionerId,linkId:t}})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"handleChat",e=>{this.setState({currentRoomId:e,shouldOpenChatDialog:!0},()=>{})}),Fe()(this,"handleSendRequest",e=>{this.setState({shouldOpenConfirmationDialog:!0,ppId:e})}),Fe()(this,"confirmSendLinkRequest",async()=>{this.setState({waitSendRequest:!0},()=>{this.state.waitSendRequest&&Up.updateLinkRequestById(this.state.ppId).then(()=>{this.setState({waitSendRequest:!1}),this.handleClose(),Ce.toast.success("Xác nhận kết nối thành công",Oe.a.TOAST_CONFIGURE)}).catch(()=>{this.setState({waitSendRequest:!1}),this.handleClose(),Ce.toast.error("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})})}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",currentRoomId:"",userName:"",ppId:"",practitionerId:"",waitSendRequest:!1,text:""}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-270})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){let{item:e,shouldOpenEditorDialog:t,shouldOpenChatDialog:a,currentRoomId:s,shouldOpenConfirmationDialog:o,text:r}=this.state,{_roomView:c,onRegistered:d,threepidInvite:m,roomOobData:u,resizeNotifier:h,roomJustCreatedOpts:p}=this.props;const{classes:g}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12},t&&i.a.createElement(zp,{handleClose:this.handleClose,open:t,item:e}),a&&i.a.createElement(kn,{handleClose:this.handleClose,open:a,item:e,ref:c,onRegistered:d,threepidInvite:m,roomOobData:u,currentRoomId:s,resizeNotifier:h,roomJustCreatedOpts:p}),o&&i.a.createElement(l,{open:o,onConfirmDialogClose:this.handleClose,onYesClick:this.confirmSendLinkRequest,title:"Xác nhận",loading:this.state.waitSendRequest,text:"Xác nhận yêu cầu kết nối?",agree:"Đồng ý",cancel:"Hủy"})),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:r,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:g.displayName},null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),i.a.createElement("div",{className:g.detail},`${this.renderGender(null==e||null===(a=e.patient)||void 0===a?void 0:a.gender)} | ${Te()(null==e||null===(n=e.patient)||void 0===n?void 0:n.birthDate).format("DD/MM/YYYY")} | ${null==e||null===(s=e.patient)||void 0===s?void 0:s.phoneNumber}`))}},{title:"Tài khoản",field:"patient.userName"},{title:"",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Xem thông tin"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Up.getOneById(e.id);this.handleViewItem(t.data.patient,e.linkId)}},i.a.createElement(Rp.a,{fontSize:"large",color:"secondary"}))),i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Up.getOnePatientById(e.patient.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Hp=Object(Ho.withStyles)(e=>({detail:{color:"#3366ff"}}))(Wp);var Kp=e=>{let{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:i,roomJustCreatedOpts:o,resizeNotifier:r,history:l}=e;return s.createElement(Hp,{ref:t,onRegistered:a,threepidInvite:n,roomOobData:i,resizeNotifier:r,roomJustCreatedOpts:o,history:l})};var qp=new class{async getAllByPatient(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-practitioner/getAllByPatient";return v.a.post(a,e)}async getAllByPractitioner(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-practitioner/getAllByPractitioner";return v.a.post(a,e)}async getUserNameByLogin(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/api/patient-practitioner/getUserName";return v.a.get(t)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-practitioner/getOne/"+e;return v.a.get(a)}async updateLinkRequestById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;var a=y.a.API_ENPOINT+"/api/patient-practitioner/updateLinkRequestById/"+e;return v.a.get(a)}async getOnePatientById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient/getOne/"+e;return v.a.get(a)}async getImageHandSignById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;var a=y.a.API_ENPOINT+"/api/fileDownload/document/"+e;return v.a.get(a)}async getMedicalRecordFile(e,t){var a=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+a;var n=y.a.API_ENPOINT+"/api/practitioner-medical-record-file/"+e+"/"+t;return v.a.get(n)}async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;var a=y.a.API_ENPOINT+"/api/user/search-by-dto";return v.a.post(a,e)}async getClinic(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;var t=y.a.API_ENPOINT+"/api/organizations?type=1";return v.a.get(t)}async getRoles(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;var t=y.a.API_ENPOINT+"/api/user/roles";return v.a.get(t)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;var a=y.a.API_ENPOINT+"/api/user";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/user";return v.a.post(a,e)}async delete(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;var a="/api/user/"+e,n=y.a.API_ENPOINT+a;return v.a.delete(n)}async getUserById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;var a="/api/user/"+e,n=y.a.API_ENPOINT+a;return v.a.get(n)}};const Yp=Object(n.makeStyles)(()=>({root:{},required:{color:"red"},saveBtn:{padding:"6px 16px",margin:"4px 0px 4px 4px",minWidth:"64px",fontSize:"15px",textTransform:"none",borderRadius:"4px"},cancelBtn:{padding:"6 16px",margin:"4px 4px 4px 0px",minWidth:"64px",fontSize:"15px",textTransform:"none",borderRadius:"4px"},contentDialog:{overflow:"hidden !important",marginBottom:"12px"},lineHeight:{lineHeight:"12px"}}));function $p(e){const t=Yp(),[a,o]=Object(s.useState)([]),[r,l]=Object(s.useState)([]),[c,d]=Object(s.useState)([]),{initialValues:m,handleSubmit:u,handleClose:h,isAddNew:p}=e,f=Ye.object({username:Ye.string().required("Vui lòng điền tài khoản").trim("Không được chứa khoảng trống").strict(!0),displayName:Ye.string().required("Vui lòng điền họ và tên").typeError("Vui lòng điền họ và tên").min(6,"Tên hiển thị quá ngắn").max(255,"Tên hiển thị quá dài"),org:Ye.object().nullable().required("Vui lòng chọn phòng khám"),gender:Ye.string().required("Vui lòng chọn giới tính"),password:Ye.string().required("Vui lòng nhập mật khẩu").min(6,"Mật khẩu ngắn"),confirmPassword:Ye.string().required("Vui lòng nhập lại mật khẩu").oneOf([Ye.ref("password")],"Mật khẩu nhập lại không đúng"),roles:Ye.object().nullable().required("Vui lòng chọn quyền"),email:Ye.string().email("Email không đúng định dạng")}),v=Ye.object({displayName:Ye.string().required("Vui lòng điền họ và tên").typeError("Vui lòng điền họ và tên").min(6,"Tên hiển thị quá ngắn").max(255,"Tên hiển thị quá dài"),org:Ye.object().nullable().required("Vui lòng chọn phòng khám"),gender:Ye.string().required("Vui lòng chọn giới tính"),password:Ye.string(),confirmPassword:Ye.string().oneOf([Ye.ref("password"),null],"Mật khẩu nhập lại không đúng"),roles:Ye.object().nullable().required("Vui lòng chọn quyền"),email:Ye.string().email("Email không đúng định dạng")}),b=Object(Y.useFormik)({enableReinitialize:!0,initialValues:m,validationSchema:p?f:v,onSubmit:e=>{u(e)}});return Object(s.useEffect)(()=>{(async()=>{if(fn.isAdmin()){let e=[];await qp.getRoles().then(t=>{t.data.filter(a=>"ROLE_ADMIN"==a.name||"ROLE_CLINIC"===a.name?e.push(a):l(t.data)),l(e)}),await qp.getClinic().then(e=>{o(e.data)})}fn.isClinic()&&await Ot.getAllInfoByUserLogin().then(e=>{const t=[e.data.userDto.org],a=e.data.userDto.roles;l(a),o(t)})})()},[]),i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:b.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:t.contentDialog},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.TextField,{fullWidth:!0,variant:"outlined",size:"small",id:"displayName",name:"displayName",label:i.a.createElement("div",{className:t.lineHeight},i.a.createElement("span",null,"Họ và tên "),i.a.createElement("span",{className:t.required},"*")),value:b.values.displayName,onChange:b.handleChange,error:b.touched.displayName&&Boolean(b.errors.displayName),helperText:b.touched.displayName&&b.errors.displayName})),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(g,{formik:b,field:"org",label:i.a.createElement("div",{className:t.lineHeight},i.a.createElement("span",null,"Phòng khám "),i.a.createElement("span",{className:t.required},"*")),options:a,variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:2,md:2,sm:12,xs:12},i.a.createElement(n.TextField,{fullWidth:!0,variant:"outlined",size:"small",id:"gender",name:"gender",select:!0,label:i.a.createElement("div",{className:t.lineHeight},i.a.createElement("span",null,"Giới tính "),i.a.createElement("span",{className:t.required},"*")),value:b.values.gender,onChange:b.handleChange,error:b.touched.gender&&Boolean(b.errors.gender),helperText:b.touched.gender&&b.errors.gender},Oe.a.GENDER&&Oe.a.GENDER.map(e=>i.a.createElement(n.MenuItem,{key:e.name,value:e.value},e.name)))),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(g,{formik:b,field:"roles",label:i.a.createElement("div",{className:t.lineHeight},i.a.createElement("span",null,"Quyền "),i.a.createElement("span",{className:t.required},"*")),options:r,variant:"outlined",size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.TextField,{fullWidth:!0,variant:"outlined",size:"small",disabled:!p,id:"username",name:"username",label:i.a.createElement("div",{className:t.lineHeight},i.a.createElement("span",null,"Tài khoản "),i.a.createElement("span",{className:t.required},"*")),value:b.values.username,onChange:b.handleChange,error:b.touched.username&&Boolean(b.errors.username),helperText:b.touched.username&&b.errors.username})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.TextField,{fullWidth:!0,variant:"outlined",size:"small",id:"email",name:"email",label:i.a.createElement("div",{className:t.lineHeight},i.a.createElement("span",null,"Email ")),value:b.values.email,onChange:b.handleChange,error:b.touched.email&&Boolean(b.errors.email),helperText:b.touched.email&&b.errors.email})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.TextField,{fullWidth:!0,variant:"outlined",size:"small",id:"password",name:"password",type:"password",label:i.a.createElement("div",{className:t.lineHeight},i.a.createElement("span",null,p?"Mật khẩu":"Mật khẩu mới"),i.a.createElement("span",{className:t.required},p?" *":"")),value:b.values.password,onChange:b.handleChange,error:b.touched.password&&Boolean(b.errors.password),helperText:b.touched.password&&b.errors.password})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.TextField,{fullWidth:!0,variant:"outlined",size:"small",id:"confirmPassword",name:"confirmPassword",type:"password",label:i.a.createElement("div",{className:t.lineHeight},i.a.createElement("span",null,p?"Nhập lại mật khẩu":"Nhập lại mật khẩu mới"),i.a.createElement("span",{className:t.required},p?" *":"")),value:b.values.confirmPassword,onChange:b.handleChange,error:b.touched.confirmPassword&&Boolean(b.errors.confirmPassword),helperText:b.touched.confirmPassword&&b.errors.confirmPassword})))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{className:t.cancelBtn+" secondary-button",variant:"contained",onClick:()=>h(),size:"small"},"Hủy"),i.a.createElement(n.Button,{className:t.saveBtn+" primary-button",variant:"contained",type:"submit",size:"small"},p?"Lưu":"Cập nhật")))))))}a(8272);function Jp(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Qp(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Jp(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Jp(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class Xp extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state,n={id:a,displayName:e.displayName,gender:e.gender,person:{displayName:e.displayName,gender:e.gender},username:e.username,roles:[e.roles],org:e.org,password:e.password,confirmPassword:e.confirmPassword,email:e.email,active:!0};qp.create(n).then(e=>{"200"===e.data.code?(t(),Ce.toast.success(e.data.message,Oe.a.TOAST_CONFIGURE)):Ce.toast.error(e.data.message,Oe.a.TOAST_CONFIGURE)})}),this.state={displayName:"",id:"",gender:"",username:"",password:"",isAddNew:!0,org:"",confirmPassword:"",person:"",email:""}}async componentDidMount(){let{item:e}=this.props;e&&(this.setState(Qp(Qp({},e),{},{roles:e.roles[0],gender:e.person?e.person.gender:""})),e.id&&this.setState({isAddNew:!1}))}render(){let{displayName:e,username:t,gender:a,roles:s,password:o,org:r,confirmPassword:l,person:c,isAddNew:d,email:m}=this.state,{classes:u,item:h}=this.props;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:u.title,style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},d?"Thêm người dùng mới":"Cập nhật người dùng"),i.a.createElement(n.IconButton,{className:u.iconClose,onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement($p,{initialValues:{displayName:e||"",username:t||"",gender:a||"",roles:s||"",password:o||"",org:r||"",confirmPassword:l||"",person:c||"",email:m||""},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,isAddNew:d}))}}var Zp=Object(n.withStyles)(e=>({title:{background:"linear-gradient(180deg, #0E9594 0%, #127475 100%) !important"},iconClose:{position:"absolute",right:"3px",top:"3px"}}))(Xp);function eg(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function tg(e){return i.a.createElement(vt.a,e)}class ag extends i.a.Component{constructor(e){super(e)}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?eg(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):eg(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){const e=On.getComponent("structures.GlobitsRoomView");let{_roomView:t,onRegistered:a,threepidInvite:s,currentRoomId:o,roomOobData:r,resizeNotifier:l,roomJustCreatedOpts:c,handleClose:d}=this.props;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:tg,fullWidth:!0,maxWidth:"md"},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.IconButton,{style:{position:"absolute",right:"10px",top:"10px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"})),i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement("div",{className:"chat-box",style:{display:"contents"}},i.a.createElement(e,{ref:t,onRegistered:a,threepidInvite:s,oobData:r,key:o,roomId:o,resizeNotifier:l,justCreatedOpts:c,style:{padding:"20px"}})))))}}class ng extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{const e={pageIndex:this.state.page+1,pageSize:this.state.rowsPerPage,text:this.state.text,display_name:this.state.display_name,wardId:this.state.wardId,provinceId:this.state.provinceId,districtId:this.state.districtId,status:this.state.status};this.setState({loadingTable:!0});const t=await qp.searchByDto(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalElements,loadingTable:!1}),this.setState({selectedList:[]})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenDeleteListDialog:!1,shouldOpenViewPatientBasic:!1},()=>{this.updatePageData().then(e=>e)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleConfirmDeleteItem",()=>{qp.delete(this.state.id).then(e=>{this.handleClose(),Ce.toast.success(e.data.message,Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData().then(e=>e)})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData().then(e=>e)})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleChangeRowsPerPage",e=>{this.setState({rowsPerPage:parseInt(e.target.value,10),page:0},()=>{this.updatePageData().then(e=>e)})}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData().then(e=>e)})}),Fe()(this,"preventDefault",e=>e.preventDefault()),this.state={data:[],page:0,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenChatDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",currentRoomId:"",userName:"",text:"",shouldOpenDeleteListDialog:!1,selectedList:[],patient:null,shouldOpenViewPatientBasic:!1,openFilter:!1,listNamePatient:[],listStatus:[],listProvince:[],listDistrict:[],listWard:[],loadingTable:!0,isAddNew:!1}}async componentDidMount(){await this.updatePageData(),this.setState({tableHeight:window.innerHeight-275})}componentWillUnmount(){this.updatePageData().then(e=>e),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){const{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,shouldOpenChatDialog:s,currentRoomId:o,shouldOpenViewPatientBasic:r,patient:c}=this.state,{_roomView:d,onRegistered:m,threepidInvite:u,roomOobData:h,resizeNotifier:p,roomJustCreatedOpts:g}=this.props,{classes:f}=this.props;return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Button,{disabled:!fn.isAdmin()&&!fn.isClinic(),onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date}),this.setState({isAddNew:!1})},className:f.button},i.a.createElement("span",null,"Thêm mới")),i.a.createElement("div",{className:f.contentPadding},a&&i.a.createElement(Zp,{handleClose:this.handleClose,open:a,item:e}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xoá",text:"Bạn có chắc chắn muốn xoá khách hàng này",cancel:"Không",agree:"Có"}),this.state.shouldOpenViewPatientBasic&&i.a.createElement(Po,{handleClose:this.handleClose,open:r,item:c,readOnly:!0}),s&&i.a.createElement(ag,{handleClose:this.handleClose,open:s,item:e,ref:d,onRegistered:m,threepidInvite:u,roomOobData:h,currentRoomId:o,resizeNotifier:p,roomJustCreatedOpts:g}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%",height:"auto"}},(fn.isAdmin()||fn.isClinic())&&i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Tài khoản",field:"username",width:"50"},{title:"Họ tên",field:"displayName",width:"100"},{title:"Email",field:"email",width:"100"},{title:"Phòng khám",field:"org.name",width:"100"},{title:"Quyền",field:"roles[0].name",width:"50"},{title:"Thao tác",field:"custom",type:"numeric",width:"40",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await qp.getUserById(e.id);this.handleEditItem(t.data.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{disabled:!fn.isAdmin()&&!fn.isClinic(),size:"small",onClick:()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},style:{overflow:"auto",height:this.state.tableHeight},icons:dn}),i.a.createElement(Bu.a,{component:"div",count:this.state.totalPages,rowsPerPageOptions:[1,2,3,5,10,25],page:this.state.page,onPageChange:this.handleChangePage,rowsPerPage:this.state.rowsPerPage,onRowsPerPageChange:this.handleChangeRowsPerPage}))))}}var sg=Object(Ho.withStyles)(e=>({title:{height:"auto",width:"100%",background:"#ffffff",padding:"19px 15px !important"},contentPadding:{padding:"10px 15px 0 15px"},displayName:{color:"rgba(0, 0, 0, 0.87)",fontSize:"14px"},detail:{fontSize:"1.35rem"},icon:{marginRight:e.spacing(.5),color:"#0E9594",fontWeight:400},titleIcon:{fontWeight:700,marginRight:e.spacing(.5),color:"#0E9594"},button:{color:"#fff",border:0,margin:"8px 18px",outline:"none",background:"linear-gradient(180deg, #0E9594 0%, #127475 100%) !important",alignItems:"center",borderRadius:"4px",minWidth:"64px",fontSize:"1.5rem",textTransform:"none"},columRow:{maxWidth:"100px"}}))(ng);const ig=Object(n.makeStyles)(e=>({title:{height:"auto",width:"100%",background:"#ffffff",padding:"19px 15px"},icon:{marginRight:e.spacing(.5),color:"#0E9594",fontWeight:400},titleIcon:{fontWeight:700,marginRight:e.spacing(.5),color:"#0E9594"}}));var og=e=>{const t=ig();return s.createElement(s.Fragment,null,s.createElement(n.Grid,{item:!0,xs:12,className:Hn()(t.title,"d-inline-flex height-54")},s.createElement(un.a,{fontSize:"large",color:"primary",className:t.icon}),s.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb",separator:"›",className:t.titleIcon},s.createElement("span",{className:t.icon},"Trang chủ"),s.createElement("span",null,"Quản trị người dùng"))),s.createElement(sg,u()({},e,{className:Hn()("mx_ListPage mx_ListPage_default")})))},rg=(a(1476),a(177)),lg=a.n(rg);var cg=new class{async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter/medicalExamination/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter/medicalExamination";return v.a.post(a,e)}async getById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/encounter/medicalExamination/"+e;return v.a.get(a)}async getServiceEvaluationCardByEnCounterId(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/serviceEvaluationCardByEncounter/getServiceEvaluationCardByEnCounterId/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/screenshot-of-the-visit-file/"+e;return v.a.delete(a)}};function dg(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}class mg extends s.Component{constructor(e){super(e),Fe()(this,"handleRowDataCellDownloadFile",e=>{let t=e.file,a=t.contentType,n=t.name;const s=y.a.API_ENPOINT+"/api/fileDownload/document/"+t.id;v.a.get(s,{responseType:"arraybuffer"}).then(e=>{let t=e.data,s=new Blob([t],{type:a});return He.a.saveAs(s,n)})}),Fe()(this,"handleOpenDelete",e=>{this.setState({idDeleted:e}),this.setState({shouldOpenDeleteDialog:!0})}),Fe()(this,"handleDialogClose",async()=>{await this.updatePageData(this.props.encounterId),this.setState({shouldOpenDeleteDialog:!1})}),Fe()(this,"handleConfirmDeleteItem",async()=>{await cg.deleteById(this.state.idDeleted).then(()=>{Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)}),await this.handleDialogClose()}),Fe()(this,"handleViewFile",e=>{mp.viewFile(e)}),Fe()(this,"updatePageData",e=>{cg.getById(e).then(e=>{let{data:t}=e;t&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?dg(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):dg(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},t))})}),Fe()(this,"handleDeleteItem",async e=>{await cg.deleteById(e.id).then(()=>{Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)}),await this.handleDialogClose()}),this.state={id:"",encounterDate:new Date,serviceType:0,practitioner:null,temperature:null,pulse:null,minimumBloodPressure:null,maximumBloodPressure:null,breathing:null,weight:null,height:null,motorFunction:null,anamnesis:"",treatmentPeriodId:"",patientId:"",degreeOfAdherenceTreatment:null,pathologicalProcess:"",hivTest:!1,creatinineTest:!1,creatinineResult:"",hbvTest:!1,hbvResult:"",hcvTest:!1,hcvResult:"",syphilisTest:!1,syphilisResult:"",gonorrhoeaTest:!1,gonorrhoeaResult:"",chlamydiaTest:!1,chlamydiaTestResult:"",prescription:{},otherDiseases:"",listTemplate:[],fullBodyTestResults:"",parts:"",practitionerId:"",linkId:"",appointment:{},sideEffectsOfMedications:"",symptomsOfHIVInfection:"",pregnancyStatus:"",sexuallyTransmittedDiseaseSymptoms:"",highRiskHIVBehaviors:"",isLoad:!1,shouldOpenDeleteDialog:!1,idDeleted:"",treatmentPeriod:null,diagnosis:[],encounterType:null,summaryExamination:null,visiableDoctorNote:!1,drNote:null,indexNumber:null}}componentDidMount(){let e=this.props.encounterId;e&&this.updatePageData(e)}componentDidUpdate(e){this.props.encounterId!==e.encounterId&&this.updatePageData(this.props.encounterId)}render(){var e,t;let{classes:a}=this.props,{encounterDate:i,serviceType:r,practitioner:c,temperature:m,pulse:u,minimumBloodPressure:h,maximumBloodPressure:p,breathing:g,weight:f,height:v,motorFunction:b,anamnesis:y,linkId:E,degreeOfAdherenceTreatment:_,pathologicalProcess:S,hivTest:C,creatinineTest:w,creatinineResult:O,hbvTest:x,hbvResult:R,hcvTest:k,hcvResult:I,syphilisTest:T,syphilisResult:P,gonorrhoeaTest:N,gonorrhoeaResult:D,chlamydiaTest:j,chlamydiaTestResult:A,otherDiseases:M,labTestOrder:U,screenshotFiles:L,fullBodyTestResults:F,parts:B,sideEffectsOfMedications:V,symptomsOfHIVInfection:G,pregnancyStatus:z,sexuallyTransmittedDiseaseSymptoms:W,highRiskHIVBehaviors:H,patientInfo:K,isLoad:q,shouldOpenDeleteDialog:Y,idDeleted:$,treatmentPeriod:J,encounterType:Q,diagnosis:X,prescription:Z,status:ee,testEvaluation:te,summaryExamination:ae}=this.state;return s.createElement(n.Grid,{item:!0,container:!0,spacing:2},s.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:y||"",size:"small",label:"Tiền sử bệnh",multiline:!0,rows:4})),s.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:S||"",size:"small",label:"Quá trình bệnh lý",multiline:!0,rows:4})),s.createElement(n.Grid,{item:!0,lg:3,md:6,sm:6},s.createElement(n.TextField,{variant:"outlined",fullWidth:!0,value:m||"",size:"small",label:"Nhiệt độ",InputProps:{readOnly:!0,endAdornment:s.createElement(n.InputAdornment,{position:"end"},"độ C")}})),s.createElement(n.Grid,{item:!0,lg:3,md:6,sm:6},s.createElement(n.TextField,{variant:"outlined",fullWidth:!0,value:u||"",size:"small",label:"Mạch",InputProps:{readOnly:!0,endAdornment:s.createElement(n.InputAdornment,{position:"end"},"lần/phút")}})),s.createElement(n.Grid,{item:!0,lg:3,md:6,sm:6},s.createElement(n.TextField,{variant:"outlined",fullWidth:!0,value:h||"",size:"small",label:"Huyết áp tối thiểu",InputProps:{readOnly:!0,endAdornment:s.createElement(n.InputAdornment,{position:"end"},"/mmHg")}})),s.createElement(n.Grid,{item:!0,lg:3,md:6,sm:6},s.createElement(n.TextField,{variant:"outlined",fullWidth:!0,value:p||"",size:"small",label:"Huyết áp tối đa",InputProps:{readOnly:!0,endAdornment:s.createElement(n.InputAdornment,{position:"end"},"/mmHg")}})),s.createElement(n.Grid,{item:!0,lg:3,md:6,sm:6},s.createElement(n.TextField,{variant:"outlined",fullWidth:!0,value:g||"",size:"small",label:"Nhịp thở",InputProps:{readOnly:!0,endAdornment:s.createElement(n.InputAdornment,{position:"end"},"lần/phút")}})),s.createElement(n.Grid,{item:!0,lg:3,md:6,sm:6},s.createElement(n.TextField,{variant:"outlined",fullWidth:!0,value:f||"",size:"small",label:"Cân nặng",InputProps:{readOnly:!0,endAdornment:s.createElement(n.InputAdornment,{position:"end"},"Kg")}})),s.createElement(n.Grid,{item:!0,lg:3,md:6,sm:6},s.createElement(n.TextField,{variant:"outlined",fullWidth:!0,value:v||"",size:"small",label:"Chiều cao",InputProps:{readOnly:!0,endAdornment:s.createElement(n.InputAdornment,{position:"end"},"cm")}})),s.createElement(n.Grid,{item:!0,lg:3,md:6,sm:6},s.createElement(n.FormControl,{fullWidth:!0,size:"small",variant:"outlined"},s.createElement(n.InputLabel,{htmlFor:"motorFunction-simple"},"Chức năng vận động"),s.createElement(n.Select,{variant:"outlined",name:"motorFunction",value:b||"",label:"Chức năng vận động",inputProps:{readOnly:!0,name:"motorFunction",id:"motorFunction-simple"}},Oe.a.MOTOR_FUNCTION.map(e=>s.createElement(n.MenuItem,{value:e.value},e.name))))),s.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:F||"",size:"small",label:"Kết quả khám toàn thân",multiline:!0,rows:3})),s.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:B||"",size:"small",label:"Khám các bộ phận",multiline:!0,rows:3})),1!==this.state.indexNumber&&s.createElement(n.Grid,{item:!0,md:4,sm:4},s.createElement(n.FormControl,{fullWidth:!0,size:"small",variant:"outlined"},s.createElement(n.InputLabel,{htmlFor:"degreeOfAdherenceTreatment-simple"},"Mức độ tuân thủ điều trị"),s.createElement(n.Select,{variant:"outlined",name:"degreeOfAdherenceTreatment",value:_||"",label:"Mức độ tuân thủ điều trị",inputProps:{readOnly:!0,name:"degreeOfAdherenceTreatment",id:"degreeOfAdherenceTreatment-simple"}},Oe.a.DEGREE_OF_ADHERENCE_TREATMENT.map(e=>s.createElement(n.MenuItem,{value:e.value},e.name))))),s.createElement(n.Grid,{item:!0,md:4,sm:4},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:V||"",size:"small",label:"Tác dụng phụ của thuốc"})),s.createElement(n.Grid,{item:!0,md:4,sm:4},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:G||"",size:"small",label:"Triệu chứng nhiễm HIV cấp"})),s.createElement(n.Grid,{item:!0,md:4,sm:4},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:z||"",size:"small",label:"Tình trạng thai nghén"})),s.createElement(n.Grid,{item:!0,md:4,sm:4},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:W||"",size:"small",label:"Triệu chứng bệnh LTQDTD"})),s.createElement(n.Grid,{item:!0,md:4,sm:4},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:H||"",size:"small",label:"Các hành vi NCC lây nhiễm HIV"})),s.createElement(n.Grid,{item:!0,md:12,sm:12},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:M||"",size:"small",label:"Bệnh lý khác"})),s.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},s.createElement("div",{style:{marginBottom:"8px",marginTop:"8px"},className:a.titleTable},"Danh sách xét nghiệm"),s.createElement(qe.a,{data:U&&null!==(e=U[0])&&void 0!==e&&e.items?null===(t=U[0])||void 0===t?void 0:t.items:[],columns:[{title:"Mã xét nghiệm",field:"labTest.code"},{title:"Ngày lấy mẫu",field:"specimenDate",render:e=>e.specimenDate?s.createElement("span",null,Te()(e.specimenDate).format("DD/MM/YYYY")):""},{title:"Ngày có kết quả",field:"performedDate",render:e=>e.performedDate?s.createElement("span",null,Te()(e.performedDate).format("DD/MM/YYYY")):""},{title:"Tên xét nghiệm",field:"labTest.name"},{title:"Kết quả",field:"numericResult",render:e=>{var t;return 1==(null==e||null===(t=e.labTest)||void 0===t?void 0:t.resultType)?null==e?void 0:e.numericResult:null==e?void 0:e.stringResult}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn})),s.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:te||"",size:"small",label:"Tư vấn và đánh giá xét nghiệm",multiline:!0,rows:4})),s.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},s.createElement("div",{style:{marginBottom:"8px",marginTop:"8px"},className:a.titleTable},"Thuốc theo phác đồ"),s.createElement(qe.a,{data:null!=Z&&Z.drugsByRegimen?null==Z?void 0:Z.drugsByRegimen:[],columns:[{title:"Mã đơn thuốc",field:"code"},{title:"Mã thuốc",field:"drug.code"},{title:"Tên thương mại",field:"drug.name"},{title:"Số ngày",field:"numberDays"},{title:"SL thuốc",field:"totalQuantity"},{title:"Liều dùng/ngày",field:"numberPerDay"},{title:"Hướng dẫn SD",field:"note"}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})),s.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},s.createElement("div",{style:{marginBottom:"8px",marginTop:"8px"},className:a.titleTable},"Thuốc ngoài phác đồ"),s.createElement(qe.a,{data:null!=Z&&Z.drugsOther?null==Z?void 0:Z.drugsOther:[],columns:[{title:"Mã đơn thuốc",field:"code"},{title:"Mã thuốc",field:"drug.code"},{title:"Tên thương mại",field:"drug.name"},{title:"Số ngày",field:"numberDays"},{title:"SL thuốc",field:"totalQuantity"},{title:"Liều dùng/ngày",field:"numberPerDay"},{title:"Hướng dẫn SD",field:"note"}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})),s.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,className:"mt-16"},s.createElement(n.TextField,{InputProps:{readOnly:!0},variant:"outlined",fullWidth:!0,value:ae||"",size:"small",label:"Tổng kết lần thăm khám",multiline:!0,rows:4})),s.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},s.createElement("div",{style:{marginBottom:"8px",marginTop:"8px"},className:a.titleTable},"Hình thức nhận thuốc")),Y&&s.createElement(l,{open:Y,onConfirmDialogClose:this.handleDialogClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),(null==Z?void 0:Z.receiveType)&&s.createElement(s.Fragment,null,s.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},s.createElement(o,{defaultValue:null==Z?void 0:Z.receivingUnitName,label:"Phòng thuốc",readOnly:!0})),s.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},s.createElement(o,{defaultValue:Oe.a.RECEIVE_TYPE.find(e=>e.value===Z.receiveType).name,readOnly:!0})),(null==Z?void 0:Z.receiveType)===Oe.a.RECEIVE_TYPE_AT_HOME&&s.createElement(s.Fragment,null,s.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},s.createElement(o,{defaultValue:null==Z?void 0:Z.receiveName,label:"Họ và tên người nhận",readOnly:!0})),s.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},s.createElement(o,{defaultValue:null==Z?void 0:Z.receivePhoneNumber,label:"Số điện thoại liên hệ",readOnly:!0})),s.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},s.createElement(o,{defaultValue:null==Z?void 0:Z.receiveAddress,label:"Địa chỉ",readOnly:!0})))),s.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},s.createElement("div",{style:{marginBottom:"8px",marginTop:"8px"},className:a.titleTable},"Ảnh chụp màn hình"),s.createElement(qe.a,{data:L||[],columns:[{title:"Thao tác",field:"custom",render:e=>s.createElement(s.Fragment,null,s.createElement(gt,{title:"Tải xuống"},s.createElement(n.IconButton,{size:"medium",onClick:()=>this.handleRowDataCellDownloadFile(e)},s.createElement(rp.a,{fontSize:"large",color:"primary"}))),s.createElement(gt,{title:"Xem file"},s.createElement(n.IconButton,{size:"medium",onClick:()=>this.handleViewFile(e)},s.createElement(ze.a,{fontSize:"large",color:"primary"}))),s.createElement(gt,{title:"Xóa"},s.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDeleteItem(e)}},s.createElement(Qi.a,{fontSize:"large",color:"error"})))),cellStyle:{padding:"4px 2px",minWidth:"120px"},headerStyle:{minWidth:"120px"}},{title:"Tên file",field:"file.name",align:"left",cellStyle:{padding:"4px 2px",minWidth:"500px"},headerStyle:{minWidth:"500px"}},{title:"Mô tả",field:"description",align:"left",cellStyle:{padding:"4px 2px",minWidth:"500px"},headerStyle:{minWidth:"500px"}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",padding:"6px"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})),s.createElement(n.Grid,{item:!0,xs:12},s.createElement("iframe",{id:"printable",width:"100%",loading:"lazy",hidden:!0},s.createElement(d,null)),s.createElement(n.Button,{startIcon:s.createElement(dt.a,null),onClick:()=>{let e=document.getElementById("content-print"),t=document.getElementById("printable").contentWindow;t.document.open(),t.document.write(e.innerHTML),t.document.close(),t.focus(),t.print()},className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary"},"In phiếu đồng thuận")))}}var ug=Object(Ho.withStyles)(e=>({titleTable:{fontSize:"2rem !important",color:"#3366ff !important",fontWeight:600}}))(mg);const hg=["children","value","index"];function pg(e){const{children:t,value:a,index:n}=e,s=te()(e,hg);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:1},i.a.createElement(lg.a,null,t)))}pg.propTypes={children:At.a.node,index:At.a.any.isRequired,value:At.a.any.isRequired};const gg=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}}));function fg(e){const{formik:t,patientInfo:a,tab:n,setTab:s,encounterId:o}=e,r=gg();return i.a.createElement("div",{className:r.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:r.tabHeader,value:n,onChange:(e,t)=>{s(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:r.countHeader},i.a.createElement("div",{className:r.titleAnalytics},"Thông tin chi tiết"))},{id:"scrollable-auto-tab-"+(l=1),"aria-controls":"scrollable-auto-tabpanel-"+l})))),i.a.createElement("div",{className:r.tabPanel},i.a.createElement(pg,{value:n,index:0},i.a.createElement(ug,{encounterId:o}))));var l}var vg=a(1461),bg=a.n(vg);function yg(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Eg(e){return i.a.createElement(D.a,{handle:"#draggable-dialog-title",cancel:'[class*="MuiDialogContent-root"]'},i.a.createElement(vt.a,e))}class _g extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",()=>{let{handleClose:e}=this.props,{id:t,reasonEndingTreatment:a,detailedReasonsEndingTreatment:n,pathologicalProcessAndClinicalCourse:s,summaryOfResults:i,comorbidities:o,treatmentMethod:r,patientCondition:l,mainDisease:c,directionTreatment:d}=this.state,m={id:t,reasonEndingTreatment:a,detailedReasonsEndingTreatment:n},u={treatmentPeriod:{id:t},pathologicalProcessAndClinicalCourse:s,summaryOfResults:i,mainDisease:c,comorbidities:o,treatmentMethod:r,patientCondition:l,directionTreatment:d};null!=a&&null!=n&&ei.treatmentStopped(m).then(()=>{null!=t&&ei.createSummaryMedicalRecords(u).then(()=>{e()})})}),this.state={id:null,reasonEndingTreatment:null,detailedReasonsEndingTreatment:null,pathologicalProcessAndClinicalCourse:null,summaryOfResults:null,mainDisease:null,comorbidities:null,treatmentMethod:null,patientCondition:null,directionTreatment:null,submit:!1}}async componentDidMount(){let e=this.props.item;this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?yg(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):yg(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){let{reasonEndingTreatment:e,detailedReasonsEndingTreatment:t,pathologicalProcessAndClinicalCourse:a,summaryOfResults:s,mainDisease:o,comorbidities:r,treatmentMethod:l,patientCondition:c,directionTreatment:d}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Eg,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," Kết thúc đợt điều trị "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement("div",{className:""},i.a.createElement("form",{onSubmit:this.handleFormSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,null,i.a.createElement(n.Grid,{item:!0,container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,variant:"outlined",size:"small",error:!!this.state.submit&&(!this.state.reasonEndingTreatment||""===this.state.reasonEndingTreatment),required:!0},i.a.createElement(n.InputLabel,{id:"reasonEndingTreatment"},"Lý do kết thúc điều trị"),i.a.createElement(n.Select,{labelId:"reasonEndingTreatment",id:"reasonEndingTreatment",value:e,onChange:e=>{this.setState({reasonEndingTreatment:e.target.value})},label:"Lý do kết thúc điều trị"},Oe.a.REASON_ENDING_TREATMENT.map((e,t)=>i.a.createElement(n.MenuItem,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.TextField,{id:"content",className:"font-inherit",label:"Lý do chi tiết kết thúc điều trị",name:"detailedReasonsEndingTreatment",size:"small",variant:"outlined",multiline:!0,minRows:2,value:t,fullWidth:!0,onChange:e=>{this.setState({detailedReasonsEndingTreatment:e.target.value})},error:!!this.state.submit&&(!this.state.detailedReasonsEndingTreatment||""===this.state.detailedReasonsEndingTreatment),required:!0})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("hr",null),i.a.createElement("h2",null,"TỔNG KẾT BỆNH ÁN")),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.TextField,{id:"content",className:"font-inherit",label:"Quá trình bệnh lý và diễn biến lâm sàng",name:"pathologicalProcessAndClinicalCourse",size:"small",variant:"outlined",multiline:!0,minRows:2,value:a,fullWidth:!0,onChange:e=>{this.setState({pathologicalProcessAndClinicalCourse:e.target.value})},error:!!this.state.submit&&(!this.state.pathologicalProcessAndClinicalCourse||""===this.state.pathologicalProcessAndClinicalCourse),required:!0})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.TextField,{id:"content",className:"font-inherit",label:"Tóm tắt kết quả xét nghiệm cận lâm sàng có giá trị chuẩn đoán",name:"summaryOfResults",size:"small",variant:"outlined",multiline:!0,minRows:2,value:s,fullWidth:!0,onChange:e=>{this.setState({summaryOfResults:e.target.value})},error:!!this.state.submit&&(!this.state.summaryOfResults||""===this.state.summaryOfResults),required:!0})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.TextField,{id:"content",className:"font-inherit",label:"Bệnh chính",name:"mainDisease",size:"small",variant:"outlined",multiline:!0,minRows:2,value:o,fullWidth:!0,onChange:e=>{this.setState({mainDisease:e.target.value})},error:!!this.state.submit&&(!this.state.mainDisease||""===this.state.mainDisease),required:!0})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.TextField,{id:"content",className:"font-inherit",label:"Bệnh kèm theo (nếu có)",name:"comorbidities",size:"small",variant:"outlined",multiline:!0,minRows:2,value:r,fullWidth:!0,onChange:e=>{this.setState({comorbidities:e.target.value})},error:!!this.state.submit&&(!this.state.comorbidities||""===this.state.comorbidities),required:!0})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.TextField,{id:"content",className:"font-inherit",label:"Phương pháp điều trị",name:"treatmentMethod",size:"small",variant:"outlined",multiline:!0,minRows:2,value:l,fullWidth:!0,onChange:e=>{this.setState({treatmentMethod:e.target.value})},error:!!this.state.submit&&(!this.state.treatmentMethod||""===this.state.treatmentMethod),required:!0})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.TextField,{id:"content",className:"font-inherit",label:"Tình trạng người bệnh ra viện",name:"patientCondition",size:"small",variant:"outlined",multiline:!0,minRows:2,value:c,fullWidth:!0,onChange:e=>{this.setState({patientCondition:e.target.value})},error:!!this.state.submit&&(!this.state.patientCondition||""===this.state.patientCondition),required:!0})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.TextField,{id:"content",className:"font-inherit",label:"Hướng điều trị và các chế độ tiếp theo",name:"directionTreatment",size:"small",variant:"outlined",multiline:!0,minRows:2,value:d,fullWidth:!0,onChange:e=>{this.setState({directionTreatment:e.target.value})},error:!!this.state.submit&&(!this.state.directionTreatment||""===this.state.directionTreatment),required:!0}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{style:{marginRight:"8px"},startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>this.props.handleClose()},"Hủy"),i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"mr-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit",onClick:()=>{this.setState({submit:!0})}},"Lưu")))))))}}var Sg=a(880),Cg=a.n(Sg);const wg=Object(n.makeStyles)(e=>({root:{backgroundColor:"#fbfcfe"},patientHeader:{padding:"1.5rem!important",border:"1px solid #eee",borderRadius:"0.5rem",boxShadow:"0 0.125rem 0.25rem rgb(0 0 0 / 8%) !important",backgroundColor:"#fff"},patientInfomation:{fontSize:"1.5rem",display:"flex",flexDirection:"column",justifyContent:"space-between"},patientName:{fontSize:"1.8rem!important",fontWeight:600},treatmentInfomation:{fontSize:"1.5rem"},goMedicalBtn:{borderRadius:"5px!important",border:"2px solid #e76896",width:"100%",color:"#e76896",backgroundColor:"#e7689611",height:"80%","&:hover":{backgroundColor:"#e76896",color:"#fff!important",transaction:"0.2s"}},finishMedicalBtn:{borderRadius:"5px!important",border:"2px solid #2a80c8",color:"#2a80c8",width:"100%",marginTop:"5px",height:"20%","&:hover":{backgroundColor:"#3366ff",color:"#fff!important",transaction:"0.2s"}},cardHeader:{},listItemLink:{borderRadius:"5px!important",width:"100%",padding:"5px 0px",fontSize:"2rem","&:hover":{color:"#e57f00",transaction:"0.2s",cursor:"pointer"}},active:{color:"#e76896!important"},treatmentInfomationLabel:{fontWeight:"bold",color:"#000",minWidth:"160px"},treatmentInfomationValue:{color:"#000",float:"left"},patientInfomationDetail:{color:"#5b739e",fontWeight:500},treatmentDate:{color:"#cd895c",fontWeight:600}}));function Og(e){var t,a,o,r,l,c,d,m,u,h,p,g,f,v,b,E,_,S,C,w,O,x,R,k;const I=wg(),{initialValues:T,handleSubmit:P,handleClose:N,isAddNew:D,id:j,listRootUnit:A,listOccupation:M,listEthnicity:U,treatmentPeriods:L,patientInfo:F,history:B}=e,[V,G]=Object(s.useState)([]),[z,W]=Object(s.useState)(null),[H,K]=Object(s.useState)([]),q=Ye.object({}),$=Object(Y.useFormik)({enableReinitialize:!0,initialValues:T,validationSchema:q,onSubmit:e=>{P(e)}}),[J,Q]=Object(s.useState)(null),[X,Z]=Object(s.useState)(""),[ee,te]=Object(s.useState)(""),[ae,ne]=Object(s.useState)(null),[se,ie]=i.a.useState(!1),[re,le]=Object(s.useState)(null),[ce,de]=Object(s.useState)(0),[me,ue]=Object(s.useState)(""),[he,pe]=Object(s.useState)(null);Object(s.useEffect)(()=>{ge()},[]),Object(s.useEffect)(()=>{if(V.length>0){W(V[0]);let e=V.find(e=>e.isLatestPeriod);e&&ne(e)}},[V]),Object(s.useEffect)(()=>{if(z){let e=null==z?void 0:z.encounters;if(e){K(e);let t=Oe.a.TREATMENT_PERIOD_STATUS.find(e=>e.value===z.status);if(t&&Z(t.name),z.patient){let e=Oe.a.PATIENT_STATUS.find(e=>e.value===z.patient.status);e&&te(e.name)}}}},[z]),Object(s.useEffect)(()=>{cg.getById(me).then(e=>{let{data:t}=e;t&&(pe(t),console.log("data encounter",t))})},[me]);const ge=async()=>{let t=await ke.getByPatientId(e.id);if(t.data){G(t.data);let e=t.data[0];if(e){let t=null==e?void 0:e.encounters[0];t&&(le(t),console.log(t.id),ue(t.id))}}},fe=e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name+", "),t},ve=e=>{let t="";return e&&(t=Te()().diff(e,"years",!1)+" tuổi "),t},be=()=>{let e="";var t,a;$.values.currentCommune&&(e=`${null!==(t=$.values)&&void 0!==t&&t.currentDetailResidence?(null===(a=$.values)||void 0===a?void 0:a.currentDetailResidence)+", ":""}${$.values.currentCommune.name+", "}${$.values.currentDistrict.name+", "}${$.values.currentCity.name}`);return e};return i.a.createElement("div",{className:I.root},i.a.createElement("form",{onSubmit:$.handleSubmit},i.a.createElement("div",{className:"dialog-body-v2 "+(e.inTab?"intab":"")},i.a.createElement(n.DialogContent,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:2,md:2,sm:2,xs:2},i.a.createElement("div",{style:{border:"1px solid #2a80c8",display:"flex",alignItems:"center",justifyContent:"center",height:"150px",width:"150px",margin:"auto"}},i.a.createElement(Cg.a,{value:null!=F&&F.code?F.code:""}))),fn.isPractitioner()&&e.fromAppointment?i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:8,xs:8,style:{display:"flex"}},i.a.createElement(n.Grid,{className:I.patientHeader,container:!0,spacing:4},i.a.createElement(n.Grid,{className:I.patientInfomation,item:!0,lg:6,md:6,sm:6,xs:6},i.a.createElement("div",{style:{width:"100%"}},i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex "},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Họ và tên:"),i.a.createElement("span",{className:I.treatmentInfomationValue},$.values.displayName))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex "},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Mã khách hàng:"),i.a.createElement("span",{className:I.treatmentInfomationValue},F.code))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex "},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Thông tin chung:"),i.a.createElement("span",{className:I.treatmentInfomationValue},fe($.values.gender),ve($.values.birthDate),$.values.birthDate?`(${Te()($.values.birthDate).format("DD/MM/YYYY")})`:""))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex "},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Phác đồ điều trị:"),i.a.createElement("span",{className:I.treatmentInfomationValue},null!=F&&null!==(t=F.encounter)&&void 0!==t&&t.regimens&&null!=F&&null!==(a=F.encounter)&&void 0!==a&&null!==(o=a.regimens[0])&&void 0!==o&&o.valueText?null==F||null===(r=F.encounter)||void 0===r||null===(l=r.regimens[0])||void 0===l?void 0:l.valueText:""))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex"},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Địa chỉ:"),i.a.createElement("span",{className:I.treatmentInfomationValue},be()))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex "},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Ngày bắt đầu:"),i.a.createElement("span",{className:I.treatmentInfomationValue},null!=F&&F.treatmentStartDate?Te()(null==F?void 0:F.treatmentStartDate).format("DD/MM/YYYY"):""))))),i.a.createElement(n.Grid,{className:I.treatmentInfomation,item:!0,lg:6,md:6,sm:6,xs:6},i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Trạng thái khách hàng:"),i.a.createElement("td",{className:I.treatmentInfomationValue},ee)),i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Trạng thái điều trị:"),i.a.createElement("td",{className:I.treatmentInfomationValue},null!=he&&null!==(c=he.treatmentPeriod)&&void 0!==c&&c.status?null===(d=Oe.a.TREATMENT_PERIOD_STATUS.find(e=>{var t;return e.value==(null==he||null===(t=he.treatmentPeriod)||void 0===t?void 0:t.status)}))||void 0===d?void 0:d.name:"")),i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Ngày khám gần nhất:"),i.a.createElement("td",{className:I.treatmentInfomationValue},F.latestEncounterDate?Te()(F.latestEncounterDate).format("DD/MM/YYYY"):"")),0!=(null==F?void 0:F.patientStatus)&&i.a.createElement(i.a.Fragment,null,i.a.createElement("tr",null,i.a.createElement("span",{className:I.treatmentInfomationValue},null!=F&&null!==(m=F.encounter)&&void 0!==m&&m.regimens&&null!=F&&null!==(u=F.encounter)&&void 0!==u&&null!==(h=u.regimens[0])&&void 0!==h&&h.valueText?null==F||null===(p=F.encounter)||void 0===p||null===(g=p.regimens[0])||void 0===g?void 0:g.valueText:"")),i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Ngày khám tiếp theo:"),i.a.createElement("td",{className:I.treatmentInfomationValue},null!=F&&F.nextEncounterDate?Te()(null==F?void 0:F.nextEncounterDate).format("DD/MM/YYYY"):""))),i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Lần khám:"),i.a.createElement("td",{className:I.treatmentInfomationValue},null==he||null===(f=he.labTestOrder[0])||void 0===f||null===(v=f.template)||void 0===v?void 0:v.correspondingTo)))))),i.a.createElement(n.Grid,{item:!0,lg:2,md:2,sm:2,xs:2,spacing:2},i.a.createElement(n.IconButton,{className:I.goMedicalBtn+" nice-button ",size:"medium",onClick:()=>{(e=>{let t="";t=e?y.a.ROOT_PATH+"medical-examination/"+e:re&&6!=(null==re?void 0:re.status)?y.a.ROOT_PATH+"medical-examination/"+re.id:y.a.ROOT_PATH+"medical-examination",B.push({pathname:t,state:{lastestTreatmentPeriod:ae,patientId:j}})})(F.id)}},i.a.createElement(bg.a,{fontSize:"large",color:"inherit"}),"Thăm khám"),i.a.createElement(n.Button,{onClick:async()=>{ie(!0)},variant:"outlined",className:""+I.finishMedicalBtn,disabled:!(null!=z&&z.isLatestPeriod)||(null==z?void 0:z.status)===Oe.a.TREATMENT_PERIOD_STATUS_FINISHED},"Kết thúc đợt điều trị"),se&&i.a.createElement(_g,{handleClose:()=>{ie(!1),ge()},open:se,item:z,id:F.lastTreatmentPeriodId}))):i.a.createElement(n.Grid,{item:!0,lg:10,md:10,sm:10,xs:10,style:{display:"flex"}},i.a.createElement(n.Grid,{className:I.patientHeader,container:!0},i.a.createElement(n.Grid,{className:I.patientInfomation,item:!0,lg:6,md:6,sm:6,xs:6},i.a.createElement("div",{style:{width:"100%"}},i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Họ và tên:"),i.a.createElement("span",{className:I.treatmentInfomationValue},$.values.displayName))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Mã khách hàng:"),i.a.createElement("span",{className:I.treatmentInfomationValue},F.code))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Thông tin chung:"),i.a.createElement("span",{className:I.treatmentInfomationValue},fe($.values.gender)," ",ve($.values.birthDate)," (",$.values.birthDate?Te()($.values.birthDate).format("DD/MM/YYYY"):"",")"))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Phác đồ điều trị:"),i.a.createElement("span",{className:I.treatmentInfomationValue},null!=F&&null!==(b=F.encounter)&&void 0!==b&&b.regimens&&null!=F&&null!==(E=F.encounter)&&void 0!==E&&null!==(_=E.regimens[0])&&void 0!==_&&_.valueText?null==F||null===(S=F.encounter)||void 0===S||null===(C=S.regimens[0])||void 0===C?void 0:C.valueText:""))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Địa chỉ:"),i.a.createElement("span",{className:I.treatmentInfomationValue},be()))),null!=(null==F?void 0:F.treatmentStartDate)&&i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:I.treatmentInfomationLabel},"Ngày bắt đầu:"),i.a.createElement("span",{className:I.treatmentInfomationValue},null!=F&&F.treatmentStartDate?Te()(null==F?void 0:F.treatmentStartDate).format("DD/MM/YYYY"):""))))),i.a.createElement(n.Grid,{item:!0,lg:1,md:1,sm:1,xs:1}),i.a.createElement(n.Grid,{className:I.treatmentInfomation,item:!0,lg:5,md:5,sm:5,xs:5},i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Trạng thái khách hàng:"),i.a.createElement("td",{className:I.treatmentInfomationValue},ee)),i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Trạng thái điều trị:"),i.a.createElement("td",{className:I.treatmentInfomationValue},null!=F&&F.treatmentStatus?Oe.a.TREATMENT_PERIOD_STATUS.find(e=>e.value==F.treatmentStatus).name:"")),i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Ngày khám gần nhất:"),i.a.createElement("td",{className:I.treatmentInfomationValue},F.latestEncounterDate?Te()(F.latestEncounterDate).format("DD/MM/YYYY"):"")),0!=(null==F?void 0:F.patientStatus)&&i.a.createElement(i.a.Fragment,null,i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Phác đồ điều trị:"),i.a.createElement("span",{className:I.treatmentInfomationValue},null!=F&&null!==(w=F.encounter)&&void 0!==w&&w.regimens&&null!=F&&null!==(O=F.encounter)&&void 0!==O&&null!==(x=O.regimens[0])&&void 0!==x&&x.valueText?null==F||null===(R=F.encounter)||void 0===R||null===(k=R.regimens[0])||void 0===k?void 0:k.valueText:"")),null!=(null==F?void 0:F.nextEncounterDate)&&i.a.createElement("tr",null,i.a.createElement("td",{className:I.treatmentInfomationLabel},"Ngày khám tiếp theo:"),i.a.createElement("td",{className:I.treatmentInfomationValue},null!=F&&F.nextEncounterDate?Te()(null==F?void 0:F.nextEncounterDate).format("DD/MM/YYYY"):""))))))))),i.a.createElement(n.Grid,{item:!0,lg:2,md:2,sm:2,xs:2},i.a.createElement(oe,{label:"Chọn đợt điều trị",name:"treatmentPeriod",value:z,onChange:e=>{W(e.target.value),K(e.target.value.encounters)},options:V,variant:"outline"}),i.a.createElement(n.Card,{className:"card-rounded-mt5"},i.a.createElement(n.CardHeader,{className:"bgc-primary-d2 text-white",title:"Lần thăm khám"}),i.a.createElement(n.CardContent,null,H.map((e,t)=>{let a="",s=e.encounterDate;return s||(s=e.startDate),a=Te()(s).format("DD/MM/YYYY"),6==e.status?a+="- Đã hoàn thành":a+="- Đang thực hiện",i.a.createElement(n.ListItemText,{id:"encounter-"+t,className:`${I.listItemLink} ${e.id==me?I.active:""}`,primary:a,onClick:()=>{(async e=>{await ue(e)})(e.id)}})})))),i.a.createElement(n.Grid,{item:!0,lg:10,md:10,sm:10,xs:10},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement(fg,{formik:$,patientInfo:F,tab:ce,setTab:de,encounterId:me})))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",style:{marginRight:"12px"},color:"secondary",onClick:()=>N()},"Huỷ")))))))}function xg(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Rg(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xg(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xg(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class kg extends i.a.Component{constructor(e){super(e),Fe()(this,"handleClose",()=>{this.props.history.push({pathname:y.a.ROOT_PATH+"home"})}),Fe()(this,"handleFormSubmit",async e=>{let{id:t}=this.state}),this.state={displayName:"",birthDate:null,phoneNumber:"",id:"",gender:"",userName:"",practitioners:[],isAddNew:!0,occupation:"",idNumber:null,email:"",currentResidence:null,permanentResidence:null,supporterName:null,supporterAddress:null,supporterPhoneNumber:null,serviceType:null,clientResourceType:null,receptionDate:null,ethnicity:null,didMountComplete:!1,listRootUnit:[],currentDetailResidence:null,permanentDetailResidence:null,listOccupation:[],listEthnicity:[],healthInsuranceNumber:null,treatmentPeriods:[],encounters:[],patientInfo:{},fromAppointment:!1}}async componentDidMount(){var e,t;let a=this.props.match.params.from;a&&1==a&&this.setState({fromAppointment:!0});let n=null===(e=this.props)||void 0===e||null===(t=e.match)||void 0===t?void 0:t.params.id;if(n){let e=await Tn.getOneById(n);if(200==e.status){let t=e.data;t&&(t.id&&Tn.getPatientInfoByPatientId(t.id).then(e=>{let{data:t}=e;t&&this.setState({patientInfo:t})}),null!=t.currentResidence&&null!=t.currentResidence.id&&(this.setState({currentCommune:t.currentResidence,currentDistrict:t.currentResidence.parent?t.currentResidence.parent:null}),t.currentResidence.parent&&t.currentResidence.parent.id&&await _.getOneById(t.currentResidence.parent.id).then(e=>{let{data:t}=e;t&&this.setState({currentCity:t.parent?t.parent:null})})),null!=t.permanentResidence&&null!=t.permanentResidence.id&&(this.setState({permanentCommune:t.permanentResidence,permanentDistrict:t.permanentResidence.parent?t.permanentResidence.parent:null}),t.permanentResidence.parent&&t.permanentResidence.parent.id&&await _.getOneById(t.permanentResidence.parent.id).then(e=>{let{data:t}=e;t&&this.setState({permanentCity:t.parent?t.parent:null})})),this.setState(Rg(Rg({},t),{},{isAddNew:!1})))}}await _.getRootUnit().then(e=>{let{data:t}=e;this.setState({listRootUnit:t})}),await $r.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&this.setState({listOccupation:t.content})}),await Yr.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&this.setState({listEthnicity:t.content})}),this.setState({didMountComplete:!0})}render(){let{displayName:e,userName:t,birthDate:a,occupation:n,gender:s,idNumber:o,email:r,phoneNumber:l,currentResidence:c,permanentResidence:d,supporterName:m,supporterAddress:u,supporterPhoneNumber:h,serviceType:p,clientResourceType:g,receptionDate:f,ethnicity:v,practitioners:b,didMountComplete:y,currentCommune:E,currentDistrict:_,currentCity:S,permanentCommune:C,permanentDistrict:w,permanentCity:O,currentDetailResidence:x,permanentDetailResidence:R,healthInsuranceNumber:k}=this.state;return i.a.createElement("div",{className:""},y&&i.a.createElement(Og,{initialValues:{displayName:e||"",userName:t||"",birthDate:a||null,phoneNumber:l||"",gender:s||"",practitioners:b||[],occupation:n||null,idNumber:o||"",email:r,currentResidence:c,permanentResidence:d,supporterName:m,supporterAddress:u,supporterPhoneNumber:h,serviceType:p,clientResourceType:g,receptionDate:f,ethnicity:v,currentCommune:E,currentDistrict:_,currentCity:S,permanentCommune:C,permanentDistrict:w,permanentCity:O,currentDetailResidence:x,permanentDetailResidence:R,healthInsuranceNumber:k},handleSubmit:this.handleFormSubmit,handleClose:this.handleClose,listRootUnit:this.state.listRootUnit,listOccupation:this.state.listOccupation,listEthnicity:this.state.listEthnicity,id:this.state.id,history:this.props.history,isAddNew:this.state.isAddNew,treatmentPeriods:this.state.treatmentPeriods,patientInfo:this.state.patientInfo,fromAppointment:this.state.fromAppointment,inTab:this.props.inTab}))}}var Ig=kg;function Tg(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}class Pg extends i.a.Component{constructor(e,t){super(e,t),this.state={id:null,source:null,facilityName:null,groupName:null,otherSouces:null,question1:null,question2:null,question3:null,question41:null,question42:null,question5:null,question6:null,question7:null,statusResult:null,highRisk:[],medicalStaffEvaluation:"",situationPrep:!1,resultText:""}}async componentDidMount(){var e,t,a;let n=null===(e=this.props)||void 0===e||null===(t=e.match)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.id;n&&Tn.getPatientInfoByPatientId(n).then(e=>{let{data:t}=e;t&&to.getPatientPeriodPrepScreeningById(t.lastPatientPrepScreeningId).then(e=>{let{data:t}=e;this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Tg(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Tg(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({item:t},t))})})}render(){return i.a.createElement(Co,{initialValues:{source:this.state.source,facilityName:this.state.facilityName,groupName:this.state.groupName,otherSouces:this.state.otherSouces,question1:this.state.question1,question2:this.state.question2,question3:this.state.question3,question41:this.state.question41,question42:this.state.question42,question5:this.state.question5,question6:this.state.question6,question7:this.state.question7,statusResult:this.state.statusResult,highRisk:this.state.highRisk,medicalStaffEvaluation:this.state.medicalStaffEvaluation},handleClose:()=>{},readOnly:!0,item:this.state.item,inTab:this.props.inTab})}}const Ng=["children","value","index"];function Dg(e){const{children:t,value:a,index:n}=e,s=te()(e,Ng);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(i.a.Fragment,null,t))}function jg(e){return{id:"scrollable-auto-tab-"+e,"aria-controls":"scrollable-auto-tabpanel-"+e}}Dg.propTypes={children:At.a.node,index:At.a.any.isRequired,value:At.a.any.isRequired};const Ag=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}}));function Mg(e){const t=Ag(),[a,n]=i.a.useState(0);return i.a.createElement("div",{className:t.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:t.tabHeader,value:a,onChange:(e,t)=>{n(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},"Thông tin cá nhân"))},jg(0))),i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},"Kết quả sàng lọc"))},jg(1))),i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},"Các lần khám"))},jg(2))))),i.a.createElement("div",{className:t.tabPanel},i.a.createElement(Dg,{value:a,index:0},i.a.createElement(vp,u()({inTab:!0},e))),i.a.createElement(Dg,{value:a,index:1},i.a.createElement(Pg,u()({inTab:!0},e))),i.a.createElement(Dg,{value:a,index:2},i.a.createElement(Ig,u()({inTab:!0},e)))))}function Ug(e){const{formik:t,handleTab:a,encounterType:s}=e,[o,r]=i.a.useState(!1),[l,c]=i.a.useState({}),[d,m]=i.a.useState([]),[u,h]=i.a.useState(0);i.a.useEffect(()=>{0===d.length&&1===u&&(t.handleSubmit(t.values),h(0)),0===d.length&&2===u&&(t.handleSubmit(t.values),a(1),h(0)),0===d.length||1!==u&&2!==u||(Ce.toast.error("Chưa điền đủ các trường thông tin ở phần khám bệnh",Oe.a.TOAST_CONFIGURE),h(0))},[u]);const p=()=>{const e=[];return""!=t.values.anamnesis&&null!=t.values.anamnesis||e.push("submit"),""!=t.values.pathologicalProcess&&null!=t.values.pathologicalProcess||e.push("submit"),""!=t.values.temperature&&null!=t.values.temperature||e.push("submit"),""!=t.values.pulse&&null!=t.values.pulse||e.push("submit"),""!=t.values.minimumBloodPressure&&null!=t.values.minimumBloodPressure||e.push("submit"),""!=t.values.maximumBloodPressure&&null!=t.values.maximumBloodPressure||e.push("submit"),""!=t.values.breathing&&null!=t.values.breathing||e.push("submit"),""!=t.values.weight&&null!=t.values.weight||e.push("submit"),""!=t.values.height&&null!=t.values.height||e.push("submit"),""!=t.values.motorFunction&&null!=t.values.motorFunction||e.push("submit"),""!=t.values.fullBodyTestResults&&null!=t.values.fullBodyTestResults||e.push("submit"),""!=t.values.parts&&null!=t.values.parts||e.push("submit"),""!=t.values.sideEffectsOfMedications&&null!=t.values.sideEffectsOfMedications||e.push("submit"),""!=t.values.symptomsOfHIVInfection&&null!=t.values.symptomsOfHIVInfection||e.push("submit"),""!=t.values.pregnancyStatus&&null!=t.values.pregnancyStatus||e.push("submit"),""!=t.values.sexuallyTransmittedDiseaseSymptoms&&null!=t.values.sexuallyTransmittedDiseaseSymptoms||e.push("submit"),""!=t.values.highRiskHIVBehaviors&&null!=t.values.highRiskHIVBehaviors||e.push("submit"),""!=t.values.otherDiseases&&null!=t.values.otherDiseases||e.push("submit"),e};return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(U,{visiable:o,note:l,onClose:()=>r(!1)}),i.a.createElement(n.Grid,{item:!0,lg:6,md:12,sm:12,xs:12},i.a.createElement(S,{formik:t,field:"anamnesis",size:"small",label:i.a.createElement("span",null," Tiền sử bệnh ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",multiline:!0,rows:4})),i.a.createElement(n.Grid,{item:!0,lg:6,md:12,sm:12,xs:12},i.a.createElement(S,{formik:t,field:"pathologicalProcess",size:"small",label:i.a.createElement("span",null," Quá trình bệnh lý ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",multiline:!0,rows:4})),i.a.createElement(n.Grid,{item:!0,xl:3,lg:3,md:6,sm:6},i.a.createElement(S,{formik:t,field:"temperature",size:"small",label:i.a.createElement("span",null," Nhiệt độ ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",type:"number",unit:"độ C"})),i.a.createElement(n.Grid,{item:!0,xl:3,lg:3,md:6,sm:6},i.a.createElement(S,{formik:t,field:"pulse",size:"small",label:i.a.createElement("span",null," Mạch ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",type:"number",unit:"lần/phút"})),i.a.createElement(n.Grid,{item:!0,xl:3,lg:3,md:6,sm:6},i.a.createElement(S,{formik:t,field:"minimumBloodPressure",size:"small",label:i.a.createElement("span",null," Huyết áp TT ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",type:"number",unit:"/mmHg"})),i.a.createElement(n.Grid,{item:!0,xl:3,lg:3,md:6,sm:6},i.a.createElement(S,{formik:t,field:"maximumBloodPressure",size:"small",label:i.a.createElement("span",null," Huyết áp TĐ ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",type:"number",unit:"/mmHg"})),i.a.createElement(n.Grid,{item:!0,xl:3,lg:3,md:6,sm:6},i.a.createElement(S,{formik:t,field:"breathing",size:"small",label:i.a.createElement("span",null," Nhịp thở ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",type:"number",unit:"lần/phút"})),i.a.createElement(n.Grid,{item:!0,xl:3,lg:3,md:6,sm:6},i.a.createElement(S,{formik:t,field:"weight",size:"small",label:i.a.createElement("span",null," Cân nặng ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",type:"number",unit:"Kg"})),i.a.createElement(n.Grid,{item:!0,xl:3,lg:3,md:6,sm:6},i.a.createElement(S,{formik:t,field:"height",size:"small",label:i.a.createElement("span",null," Chiều cao ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",type:"number",unit:"cm"})),i.a.createElement(n.Grid,{item:!0,xl:3,lg:3,md:6,sm:6},i.a.createElement(z,{formik:t,optionList:Oe.a.MOTOR_FUNCTION,variant:"outlined",field:"motorFunction",label:i.a.createElement("span",null," Chức năng vận động ",i.a.createElement("span",{className:"color-red"},"*")),size:"small"})),i.a.createElement(n.Grid,{item:!0,lg:6,md:12,sm:12,xs:12},i.a.createElement(S,{formik:t,field:"fullBodyTestResults",size:"small",label:i.a.createElement("span",null," Kết quả khám toàn thân ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",multiline:!0,rows:3})),i.a.createElement(n.Grid,{item:!0,lg:6,md:12,sm:12,xs:12},i.a.createElement(S,{formik:t,field:"parts",size:"small",label:i.a.createElement("span",null," Khám các bộ phận ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined",onFocus:e=>((e,t)=>{const a=Oe.a.DOCTOR_NOTE.find(e=>e.field===t);a&&(c(a),r(!0))})(0,"parts"),multiline:!0,rows:3})),i.a.createElement(n.Grid,{item:!0,md:6,sm:6},i.a.createElement(z,{formik:t,optionList:Oe.a.DEGREE_OF_ADHERENCE_TREATMENT,variant:"outlined",field:"degreeOfAdherenceTreatment",label:"Mức độ tuân thủ điều trị",size:"small"})),i.a.createElement(n.Grid,{item:!0,md:6,sm:6},i.a.createElement(S,{formik:t,field:"sideEffectsOfMedications",size:"small",label:i.a.createElement("span",null," Tác dụng phụ của thuốc ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,md:6,sm:6},i.a.createElement(S,{formik:t,field:"symptomsOfHIVInfection",size:"small",label:i.a.createElement("span",null," Triệu chứng nhiễm HIV cấp ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,md:6,sm:6},i.a.createElement(S,{formik:t,field:"pregnancyStatus",size:"small",label:i.a.createElement("span",null," Tình trạng thai nghén ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,md:6,sm:6},i.a.createElement(S,{formik:t,field:"sexuallyTransmittedDiseaseSymptoms",size:"small",label:i.a.createElement("span",null," Triệu chứng bệnh LTQDTD ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,md:6,sm:6},i.a.createElement(S,{formik:t,field:"highRiskHIVBehaviors",size:"small",label:i.a.createElement("span",null," Các hành vi NCC lây nhiễm HIV ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,md:12,sm:12},i.a.createElement(S,{formik:t,field:"otherDiseases",size:"small",label:i.a.createElement("span",null," Bệnh lý khác ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,md:12,sm:12},i.a.createElement(n.Button,{className:"mr-0 btn d-inline-flex",variant:"contained",color:"primary",onClick:()=>{e.formik.setFieldValue("status",2),m(p()),h(1)},style:{marginRight:"12px"}},"Lưu"),i.a.createElement(n.Button,{className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",onClick:()=>{e.formik.setFieldValue("status",2),m(p()),h(2)}},"Tiếp theo")))}function Lg(e){return i.a.createElement(vt.a,e)}function Fg(e){var t,a,o,r,l,c,d,m,u,h;const[p,g]=Object(s.useState)([]);Object(s.useEffect)(()=>{Mo.searchByPage({pageIndex:0,pageSize:100}).then(e=>{let{data:t}=e;g(t.content)})},[]);const f=Ye.object().shape({template:Ye.object().required().typeError("Xin mời chọn bộ mẫu xét nghiệm")});return i.a.createElement(n.Dialog,{className:"dialog-container",open:e.open,PaperComponent:Lg,fullWidth:!0,maxWidth:"lg"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," Chỉ định xét nghiệm "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>e.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Y.Formik,{initialValues:{template:null!=e&&null!==(t=e.data)&&void 0!==t&&t.template?null==e||null===(a=e.data)||void 0===a?void 0:a.template:null,items:null!=e&&null!==(o=e.data)&&void 0!==o&&o.items?null==e||null===(r=e.data)||void 0===r?void 0:r.items:[],requestDate:null!=e&&null!==(l=e.data)&&void 0!==l&&l.requestDate?null==e||null===(c=e.data)||void 0===c?void 0:c.requestDate:null,expectedDate:null!=e&&null!==(d=e.data)&&void 0!==d&&d.expectedDate?null==e||null===(m=e.data)||void 0===m?void 0:m.expectedDate:null,staffInformation:null!=e&&null!==(u=e.data)&&void 0!==u&&u.staffInformation?null==e||null===(h=e.data)||void 0===h?void 0:h.staffInformation:null},validationSchema:f,onSubmit:t=>{console.log(t),e.handleSubmit(t),e.handleClose()}},e=>{let{errors:t,touched:a,setFieldValue:s,values:o,setValues:r}=e;return i.a.createElement(Y.Form,null,i.a.createElement(n.DialogContent,{style:{maxHeight:"70vh"}},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement($,{label:"Lựa chọn bộ mẫu xét nghiệm",name:"template",value:o.template,options:p,setFieldValue:s,updateParent:e=>((e,t)=>{Mo.getByTempCode(e.code).then(e=>{let{data:a}=e;t(a)})})(e,r)})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Q,{label:"Ngày yêu cầu xét nghiệm",name:"requestDate",value:o.requestDate?o.requestDate:null,setFieldValue:s})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Q,{label:"Ngày xét nghiệm dự kiến",name:"expectedDate",value:o.expectedDate?o.expectedDate:null,setFieldValue:s})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(ka,{label:"Lựa chọn xét nghiệm",selectedItems:o.items,setFieldValue:s})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:o.items?o.items:[],columns:[{title:"Thao tác",field:"custom",align:"left",render:e=>i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{((e,t,a)=>{a("items",t.items.filter(t=>t.labTest.id!==e.labTest.id))})(e,o,s)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))},{title:"Mã xét nghiệm",field:"labTest.code"},{title:"Tên xét nghiệm",field:"labTest.name"}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})))),i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(ho.a,null),className:"mr-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))}))}y.a.API_ENPOINT;var Bg=new class{async searchByDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner-medical-record-file/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner-medical-record-file/"+e.id;return v.a.put(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner-medical-record-file/getOne/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/practitioner-medical-record-file/"+e;return v.a.delete(a)}async getByPractitionerIdImageType(e,t){var a=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+a;let n=y.a.API_ENPOINT+"/api/practitioner-medical-record-file/"+e+"/"+t;return v.a.get(n)}};const Vg=Object(n.makeStyles)(e=>({container:{border:"1px solid #3366ff88",borderRadius:"10px",minHeight:"200px",margin:"0 10px",display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",justifyContent:"center"},img:{maxHeight:"100px"},selectImg:{"&:hover":{color:"#3366ff",cursor:"pointer"}}})),Gg=e=>{const{classes:t,image:a}=e;return a&&i.a.createElement("img",{className:t.img,src:a,alt:"preview image"})};function zg(e){var t,a,s,o,r,l,c,m,u,h,p,g,f,v;const{formik:b,handleTab:y,encounterType:E,patientInfo:_}=e,C=Vg(),[w,O]=i.a.useState(!1),[x,I]=i.a.useState(!1),[N,D]=i.a.useState([]),[j,A]=i.a.useState(!1),M=()=>{var e;if((null===(e=b.values.labTestOrder)||void 0===e?void 0:e.length)>0){let e=[];b.values.labTestOrder.forEach(t=>{var a;(null==t||null===(a=t.items)||void 0===a?void 0:a.length)>0&&e.push(...t.items)}),D(e)}};i.a.useEffect(()=>{M()},[b.values.labTestOrder]),i.a.useEffect(()=>{if(b.values.labTestOrderObj){let e=[];e.push(b.values.labTestOrderObj),b.setFieldValue("labTestOrder",e)}},[b.values.labTestOrderObj]),i.a.useEffect(()=>{M()},[]),i.a.useEffect(()=>{let e=b.values.labTestOrder;e[0]&&(e[0].items=N,b.setFieldValue("labTestOrder",e))},[N]);const U=["Âm tính","Dương tính"],L=["Âm tính","Dương tính","Nghi ngờ"],F=["Có phản ứng","Không phản ứng","Không xác định"],[B,V]=i.a.useState(null);i.a.useEffect(()=>{b.values.patientAgree&&!B&&lp.getByPatientIdImageType(_.patientId,Oe.a.PATIENT_MEDICAL_RECORD_ATTACK_IMAGE.HAND_SIGN).then(e=>{let{data:t}=e;t&&mp.setImageObjectURL(t,V)})},[b.values.patientAgree,B]);const[G,z]=i.a.useState(null);i.a.useEffect(()=>{b.values.doctorAgree&&!G&&Ua.getUserNameByLogin().then(e=>{let{data:t}=e;t&&Ua.getPractitionerByUsername(t).then(e=>{let{data:t}=e;t.id&&Bg.getByPractitionerIdImageType(t.id,Oe.a.PATIENT_MEDICAL_RECORD_ATTACK_IMAGE.HAND_SIGN).then(e=>{let{data:t}=e;t&&mp.setImageObjectURL(t,z)})})})},[b.values.doctorAgree,G]);return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},0==(null===(t=b.values.labTestOrder)||void 0===t?void 0:t.length)&&i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",variant:"contained",onClick:()=>{I(!0)}},"Chỉ định xét nghiệm"),x&&i.a.createElement(Fg,{handleClose:()=>{O(!1),I(!1)},open:x,handleSubmit:e=>b.setFieldValue("labTestOrderObj",e)})),i.a.createElement(n.Grid,{className:"labtest-result-table",item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:N||[],columns:[{title:"Mã XN",field:"labTest.code",cellStyle:{padding:"2px",maxWidth:"120px"},headerStyle:{maxWidth:"120px"}},{title:"Ngày lấy mẫu",field:"specimenDate",cellStyle:{padding:"2px"},render:e=>{let t=e.tableData.id,a=i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,{fullWidth:!0,id:"specimenDate",name:"specimenDate",autoOk:!0,variant:"inline",inputVariant:"standard",format:"dd/MM/yyyy",size:"small",InputAdornmentProps:{position:"end"},onChange:e=>{N[t].specimenDate=e,D([...N])},value:N[t].specimenDate?N[t].specimenDate:null}));return 1==e.refuse?"":a}},{title:"Ngày có kết quả",field:"performedDate",cellStyle:{padding:"2px"},render:e=>{let t=e.tableData.id,a=i.a.createElement(k.MuiPickersUtilsProvider,{utils:T.a},i.a.createElement(k.KeyboardDatePicker,{fullWidth:!0,id:"performedDate",name:"performedDate",autoOk:!0,variant:"inline",inputVariant:"standard",format:"dd/MM/yyyy",size:"small",InputAdornmentProps:{position:"end"},onChange:e=>{N[t].performedDate=e,D([...N])},value:N[t].performedDate?N[t].performedDate:null}));return 1==e.refuse?"":a}},{title:"Tên xét nghiệm",field:"labTest.name",cellStyle:{padding:"2px",minWidth:"300px"},headerStyle:{minWidth:"300px"}},{title:"Kết quả",field:"numericResult",cellStyle:{padding:"2px"},render:e=>{var t,a,s;let o=e.tableData.id,r=1==(null==e||null===(t=e.labTest)||void 0===t?void 0:t.resultType)?i.a.createElement(n.TextField,{fullWidth:!0,id:"numericResult",size:"small",name:"numericResult",value:N[o].numericResult?N[o].numericResult:null,onChange:e=>{N[o].numericResult=e.target.value,D([...N])},type:"number"}):"56888-1"==(l=null==e||null===(a=e.labTest)||void 0===a?void 0:a.code)||"75409-3"==l||"75886-2"==l||"XN-006"==l||"XN-005"==l||"XN-005"==l||"XN-007"==l?((e,t)=>{let a=U;return"XN-006"!=e&&"XN-007"!=e||(a=L),"56888-1"==e&&(a=F),i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},size:"small"},i.a.createElement(n.Select,{id:"stringResult-select",value:N[t].stringResult,onChange:e=>{null!=N[t]&&(N[t].stringResult=e.target.value,D([...N]))}},a.map((e,t)=>i.a.createElement(n.MenuItem,{key:e,value:e},e))))})(null==e||null===(s=e.labTest)||void 0===s?void 0:s.code,o):i.a.createElement(n.TextField,{fullWidth:!0,id:"stringResult",size:"small",name:"stringResult",value:N[o].stringResult?N[o].stringResult:null,onChange:e=>{N[o].stringResult=e.target.value,D([...N])}});var l;return 1==e.refuse?"Từ chối xét nghiệm":r}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})),i.a.createElement(n.Grid,{item:!0,md:12,sm:12},i.a.createElement(S,{formik:b,field:"testEvaluation",size:"small",label:"Nội dung tư vấn và đánh giá xét nghiệm",variant:"outlined",multiline:!0,rows:3})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(P,{formik:b,label:"Ngày tư vấn và đánh giá xét nghiệm",format:"dd/MM/yyyy",field:"testEvaluationDate",inputVariant:"outlined",size:"small",disablePast:!0})),0==E&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(R,{formik:b,field:"eligibleCustomer",label:"Khách hàng đủ tiêu chuẩn để được chỉ định thăm khám"})),b.values.eligibleCustomer&&i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(P,{formik:b,label:"Ngày bác sĩ đồng thuận",format:"dd/MM/yyyy",field:"doctorAgreeDay",inputVariant:"outlined",size:"small"})),b.values.eligibleCustomer&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(d,null),i.a.createElement("iframe",{id:"printable",loading:"lazy",width:"100%",hidden:!0},i.a.createElement("div",{id:"printForm"},i.a.createElement(d,null),i.a.createElement("div",{style:{display:"flex",width:"100%",margin:"auto"}},i.a.createElement("div",{style:{width:"50%",textAlign:"center"}},i.a.createElement("div",null," ",(null===(a=b.values)||void 0===a?void 0:a.doctorAgreeDay)&&"Ngày: "+Te()(null===(s=b.values)||void 0===s?void 0:s.doctorAgreeDay).format("DD/MM/YYYY")),b.values.doctorAgree&&G&&i.a.createElement("img",{src:G,style:{maxHeight:"100px"}})),i.a.createElement("div",{style:{width:"50%",textAlign:"center"}},i.a.createElement("div",null," ",(null===(o=b.values)||void 0===o?void 0:o.patientAgreeDay)&&"Ngày: "+Te()(null===(r=b.values)||void 0===r?void 0:r.patientAgreeDay).format("DD/MM/YYYY")),b.values.patientAgree&&B&&i.a.createElement("img",{src:B,style:{maxHeight:"100px"}})))))),i.a.createElement("div",{style:{display:"flex",width:"100%",margin:"auto"}},i.a.createElement("div",{style:{width:"50%",textAlign:"center"}},i.a.createElement("div",null," ",(null===(l=b.values)||void 0===l?void 0:l.doctorAgree)&&"Đã ký"),i.a.createElement("div",null," ",(null===(c=b.values)||void 0===c?void 0:c.doctorAgreeDay)&&"Ngày: "+Te()(null===(m=b.values)||void 0===m?void 0:m.doctorAgreeDay).format("DD/MM/YYYY")),(null===(u=b.values)||void 0===u?void 0:u.doctorAgree)&&i.a.createElement(Gg,{classes:C,image:G})),i.a.createElement("div",{style:{width:"50%",textAlign:"center"}},i.a.createElement("div",null," ",(null===(h=b.values)||void 0===h?void 0:h.patientAgree)&&"Khách hàng đã ký"),i.a.createElement("div",null," ",(null===(p=b.values)||void 0===p?void 0:p.patientAgreeDay)&&"Ngày: "+Te()(null===(g=b.values)||void 0===g?void 0:g.patientAgreeDay).format("DD/MM/YYYY")),(null===(f=b.values)||void 0===f?void 0:f.patientAgree)&&i.a.createElement(Gg,{classes:C,image:B}))),i.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"}},(null===(v=b.values)||void 0===v?void 0:v.patientAgree)&&i.a.createElement("div",null,i.a.createElement(n.Button,{className:"mr-0 btn btn-primary d-inline-flex",style:{margin:"30px 30px 0 30px"},variant:"contained",color:"primary",onClick:()=>{b.setFieldValue("doctorAgree",!0),b.setFieldValue("doctorAgreeDay",new Date),b.handleSubmit()}},"Đồng thuận")),i.a.createElement("div",null,i.a.createElement(n.Button,{startIcon:i.a.createElement(dt.a,null),onClick:()=>{let e=document.getElementById("printForm"),t=document.getElementById("printable").contentWindow;t.document.open(),t.document.write(e.innerHTML),t.document.close(),t.focus(),t.print()},className:"mr-0 btn btn-primary d-inline-flex",style:{margin:"30px 30px 0 0"},variant:"contained",color:"primary"},"In phiếu đồng thuận"))))),i.a.createElement(n.Grid,{item:!0,md:12,sm:12},i.a.createElement(n.Button,{className:"mr-0 btn btn-secondary d-inline-flex",variant:"contained",color:"primary",type:"submit",style:{marginRight:"12px"},onClick:()=>y(-1)},"Trở lại"),i.a.createElement(n.Button,{className:"mr-0 btn d-inline-flex",variant:"contained",color:"primary",onClick:()=>{b.setFieldValue("status",4),b.handleSubmit()},style:{marginRight:"12px"}},"Lưu"),i.a.createElement(n.Button,{className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",onClick:()=>{b.setFieldValue("status",4),b.handleSubmit(),y(1)}},"Tiếp theo")))}function Wg(e){return Object(s.useEffect)(()=>{e.values.numberDays&&e.values.totalQuantity&&e.setFieldValue(e.name,Math.round(e.values.totalQuantity/e.values.numberDays*100)/100)},[e.values.numberDays,e.values.totalQuantity]),i.a.createElement(Z,{name:e.name,label:e.label,value:e.value,setFieldValue:e.setFieldValue,disabled:!0})}function Hg(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Kg(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Hg(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Hg(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function qg(e){const{drugs:t,setDrugs:a,encounterType:o,formik:r}=e,[l,c]=Object(s.useState)(!1),d=()=>{var e,t,a;0!=o||null!==(e=r.values)&&void 0!==e&&e.eligibleCustomer&&null!==(t=r.values)&&void 0!==t&&t.doctorAgree&&null!==(a=r.values)&&void 0!==a&&a.patientAgree?c(!0):Ce.toast.warning("Cần chấp nhận phiếu đồng thuận tiếp tục",Oe.a.TOAST_CONFIGURE)},m=()=>{c(!1)},u=Ye.object().shape({});return i.a.createElement(i.a.Fragment,null,i.a.createElement(Y.Formik,{initialValues:{drug:{code:"",name:"",manufacturer:""},numberDays:"",totalQuantity:"",numberPerDay:"",note:""},validationSchema:u,onSubmit:(n,s)=>{let{resetForm:i}=s;(n=>{if(n.drug.id){let s=Kg(Kg({},n),{},{type:e.type}),i=[...t,s];a(i)}else Ce.toast.warning("Hãy chọn một loại thuốc",Oe.a.TOAST_CONFIGURE)})(n),i()}},e=>{var t,a,s;let{errors:o,touched:r,setFieldValue:c,values:u}=e;return i.a.createElement(Y.Form,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0},i.a.createElement(n.Button,{size:"small",className:"btn btn-primary",style:{float:"right",height:"100%"},variant:"contained",onClick:d},"Chọn thuốc"),l&&i.a.createElement(ua,{open:l,handleSelect:e=>((e,t)=>{m(),t("drug",e)})(e,c),selectedItem:u.drug?u.drug:{},handleClose:m}))),i.a.createElement(n.Grid,{container:!0,spacing:2,className:"mt-16"},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"drug.code",label:"Mã thuốc",value:null===(t=u.drug)||void 0===t?void 0:t.code,setFieldValue:c,disabled:!0})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"drug.name",label:"Tên thương mại",value:null===(a=u.drug)||void 0===a?void 0:a.name,setFieldValue:c,disabled:!0})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"drug.manufacturer",label:"Nhà SX",value:null===(s=u.drug)||void 0===s?void 0:s.manufacturer,setFieldValue:c,disabled:!0})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"totalQuantity",label:"SL thuốc",value:u.totalQuantity,setFieldValue:c,disabled:!u.drug.code})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"numberDays",label:"Số ngày",value:u.numberDays,setFieldValue:c,disabled:!u.drug.code})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Wg,{label:"Liều dùng/ngày",name:"numberPerDay",setFieldValue:c,value:u.numberPerDay,values:u}))),i.a.createElement(n.Grid,{container:!0,spacing:2,className:"mt-16"},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(Z,{name:"note",label:"Hướng dẫn SD",multiline:!0,minRows:2,value:u.note,setFieldValue:c,disabled:!u.drug.code}))),i.a.createElement(n.Button,{size:"small",className:"btn btn-primary mt-16",style:{height:"100%"},variant:"contained",type:"submit"},"Thêm thuốc"))}),i.a.createElement(n.Grid,{container:!0,className:"mt-16"},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(qe.a,{data:t||[],columns:[{title:"Thao tác",field:"custom",align:"left",render:e=>i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{(e=>{const n=t.filter(t=>t.drug.code!==e.drug.code);a(n)})(e)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))},{title:"Mã thuốc",field:"drug.code"},{title:"Tên thương mại",field:"drug.name"},{title:"Số ngày",field:"numberDays"},{title:"SL thuốc",field:"totalQuantity"},{title:"Liều dùng/ngày",field:"numberPerDay"},{title:"Hướng dẫn SD",field:"note"}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}))))}function Yg(e){return Object(s.useEffect)(()=>{e.rowData.numberDays&&e.rowData.totalQuantity&&e.onChange(e.name,e.rowData.totalQuantity/e.rowData.numberDays)},[e.rowData.numberDays,e.rowData.totalQuantity]),i.a.createElement(n.TextField,{name:e.name,value:e.value,InputProps:{readOnly:!0}})}function $g(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Jg(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$g(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$g(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Qg=Object(n.makeStyles)(e=>{});function Xg(e){const{regimen:t,drugs:a,setRegimen:o,setDrugs:r,encounterType:l,formik:c}=e,[d,m]=(Qg(),Object(s.useState)(!1)),[u,h]=Object(s.useState)(!1),p=()=>{m(!1),h(!1)},g=(Ye.object().shape({}),(e,t)=>{let n=[...a];n[t]=Jg(Jg({},n[t]),{},{[e.target.name]:e.target.value}),r(n)}),f=(e,t,n)=>{a[n]=Jg(Jg({},a[n]),{},{[e]:t}),r(a)};return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,i.a.createElement(n.Button,{size:"small",className:"btn btn-primary",style:{height:"100%"},variant:"contained",onClick:()=>{var e,t,a;0!=l||null!==(e=c.values)&&void 0!==e&&e.eligibleCustomer&&null!==(t=c.values)&&void 0!==t&&t.doctorAgree&&null!==(a=c.values)&&void 0!==a&&a.patientAgree?h(!0):Ce.toast.warning("Cần chấp nhận phiếu đồng thuận tiếp tục",Oe.a.TOAST_CONFIGURE)}},t?"Thay đổi phác đồ":"Chọn phác đồ")," "),u&&i.a.createElement(qa,{open:u,handleSelect:t=>{t?(p(),console.log(e.type),o(t.regimen),r([t])):Ce.toast.warning("Hãy chọn 1 phác đồ",Oe.a.TOAST_CONFIGURE)},selectedItem:t||{},handleClose:p}),i.a.createElement(n.Grid,{container:!0},i.a.createElement(n.Grid,{item:!0,xs:12,className:"mt-16"},i.a.createElement(qe.a,{data:a||[],columns:[{title:"Thao tác",field:"custom",align:"left",render:e=>i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{(e=>{const t=a.filter(t=>t.drug.id!==e.drug.id);r(t)})(e)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))},{title:"Mã thuốc",field:"drug.code"},{title:"Tên thương mại",field:"drug.name",cellStyle:{minWidth:200}},{title:"Tên phác đồ",field:"regimenName",cellStyle:{minWidth:200}},{title:"SL thuốc",field:"totalQuantity",render:e=>i.a.createElement(n.TextField,{defaultValue:e.totalQuantity,name:"totalQuantity",onChange:t=>g(t,e.tableData.id)})},{title:"Số ngày",field:"numberDays",render:e=>i.a.createElement(n.TextField,{defaultValue:e.numberDays,name:"numberDays",onChange:t=>g(t,e.tableData.id)})},{title:"Liều dùng/ngày",field:"numberPerDay",render:e=>i.a.createElement(Yg,{value:e.numberPerDay,rowData:a[e.tableData.id],name:"numberPerDay",onChange:(t,a)=>f(t,a,e.tableData.id)})},{title:"Hướng dẫn SD",field:"note",cellStyle:{minWidth:200},render:e=>i.a.createElement(n.TextField,{multiline:!0,defaultValue:e.note,name:"note",onChange:t=>f(t.target.name,t.target.value,e.tableData.id)})}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}))))}const Zg=["children","value","index"];function ef(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function tf(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ef(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ef(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function af(e){return{id:"scrollable-auto-tab-"+e,"aria-controls":"scrollable-auto-tabpanel-"+e}}const nf=Object(O.makeStyles)(e=>({root:{flexGrow:1,width:"100%",backgroundColor:e.palette.background.paper},padding24:{padding:"24px 0px"}}));function sf(e){const{children:t,value:a,index:s}=e,o=te()(e,Zg);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==s,id:"scrollable-auto-tabpanel-"+s,"aria-labelledby":"scrollable-auto-tab-"+s},o),a===s&&i.a.createElement(n.Box,{p:3},i.a.createElement(n.Typography,null,t)))}function of(e){var t,a,o,r,l,c,d,m,h,p,f,v,b,y,E,_,C,w,O;const x=nf(),[R,k]=i.a.useState(0),[I,T]=Object(s.useState)(e.formik.values.regimenPrEP),[N,D]=Object(s.useState)(null!==(t=e.formik.values)&&void 0!==t&&null!==(a=t.prescription)&&void 0!==a&&a.drugsByRegimen?e.formik.values.prescription.drugsByRegimen:[]),[j,A]=Object(s.useState)(null!==(o=e.formik.values)&&void 0!==o&&null!==(r=o.prescription)&&void 0!==r&&r.drugsOther?e.formik.values.prescription.drugsOther:[]),[M,U]=Object(s.useState)(null),[L,F]=Object(s.useState)(!1),[B,V]=Object(s.useState)([]),[G,z]=Object(s.useState)(null!==(l=e.formik.values.prescription)&&void 0!==l&&l.receiveType?e.formik.values.prescription.receiveType:null),{encounterType:W,formik:H}=e,[K,q]=Object(s.useState)(!(null===(c=e.formik.values)||void 0===c||null===(d=c.prescription)||void 0===d||!d.buyForYourself)&&e.formik.values.prescription.buyForYourself);console.log(e.formik.values,"props.formik.values.prescription"),Object(s.useEffect)(()=>{e.formik.setFieldValue("prescription.buyForYourself",K)},[K]),Object(s.useEffect)(()=>{Y()},[]),Object(s.useEffect)(()=>{e.formik.setFieldValue("prescription.drugsByRegimen",N)},[N]),Object(s.useEffect)(()=>{e.formik.setFieldValue("prescription.drugsOther",j)},[j]),Object(s.useEffect)(()=>{e.formik.setFieldValue("regimenPrEP",I)},[I]);console.log(e.patientInfo,"patientInfo");const Y=()=>{ya.searchByPage({pageIndex:1,pageSize:50,types:[3,4]}).then(e=>{let{data:t}=e;V(t.content)})};return i.a.createElement("div",{className:x.root},i.a.createElement(vr.a,{position:"static",color:"default"},i.a.createElement(yr.a,{value:R,onChange:(e,t)=>{k(t)},indicatorColor:"primary",textColor:"primary",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},i.a.createElement(_r.a,u()({label:"Thuốc chỉ định"},af(0))),i.a.createElement(_r.a,u()({label:"Thuốc khác"},af(1))))),i.a.createElement(sf,{value:R,index:0},i.a.createElement(Xg,{regimen:I,setRegimen:T,drugs:N,setDrugs:D,type:Oe.a.DRUG_ORDER_TYPE_REGIMEN,encounterType:W,formik:H})),i.a.createElement(sf,{value:R,index:1},i.a.createElement(qg,{drugs:j,setDrugs:A,type:Oe.a.DRUG_ORDER_TYPE_OTHER,encounterType:W,formik:H})),i.a.createElement(S,{formik:e.formik,variant:"outlined",label:"Tổng kết lần thăm khám",field:"summaryExamination",multiline:!0,minRows:3}),i.a.createElement("br",null),i.a.createElement("hr",null),e.formik.values.isLatestEncounter&&!e.formik.values.hasCreateNextIndicationTesting&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{padding:"8px",borderRadius:"4px",backgroundColor:"#3a83ff",width:"100%",color:"white",fontSize:"large",fontWeight:"bold"}},"THÔNG TIN TÁI KHÁM"),i.a.createElement(n.Grid,{className:"mb-15 mt-15",container:!0},i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:6},i.a.createElement(P,{formik:e.formik,label:"Ngày xét nghiệm kế tiếp (dự kiến)",format:"dd/MM/yyyy",field:"nextEncounterDate",inputVariant:"outlined",size:"small",disablePast:!0})))),e.formik.values.isLatestEncounter&&!e.formik.values.hasCreateNextIndicationTesting&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",variant:"contained",style:{marginBottom:"8px"},onClick:()=>{(e=>{var t,a,n;if(!(0!=W||null!==(t=H.values)&&void 0!==t&&t.eligibleCustomer&&null!==(a=H.values)&&void 0!==a&&a.doctorAgree&&null!==(n=H.values)&&void 0!==n&&n.patientAgree))return void Ce.toast.warning("Cần chấp nhận phiếu đồng thuận tiếp tục",Oe.a.TOAST_CONFIGURE);let s=0;N.forEach(e=>{e.numberDays&&e.numberDays>s&&(s=e.numberDays)}),j.forEach(e=>{e.numberDays&&e.numberDays>s&&(s=e.numberDays)});let i=Te()().add(s,"days");e=tf(tf({},e),{},{start:i.toDate()}),U(e),F(!0)})({startDate:new Date,endDate:new Date})}},"Chỉ định xét nghiệm"),L&&i.a.createElement(Fg,{handleClose:()=>{F(!1)},open:L,data:e.formik.values.nextLabTestOrder,handleSubmit:t=>e.formik.setFieldValue("nextLabTestOrder",t)}),e.formik.values.nextLabTestOrder&&e.formik.values.nextLabTestOrder.items&&e.formik.values.nextLabTestOrder.items.map((e,t)=>i.a.createElement("div",{style:{backgroundColor:"antiquewhite",fontSize:"initial"}},t+1," . ",e.labTest.name))),i.a.createElement("br",null),i.a.createElement("hr",null),i.a.createElement("div",{style:{padding:"8px",borderRadius:"4px",backgroundColor:"#3a83ff",width:"100%",color:"white",fontSize:"large",fontWeight:"bold"}},"HÌNH THỨC NHẬN THUỐC"),i.a.createElement(n.Grid,{className:"mb-15 mt-16",container:!0,spacing:2},"HAS_FEE"==(null===(m=e.patientInfo)||void 0===m?void 0:m.serviceType)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"buyForYourself"},"Hình thức mua thuốc"),i.a.createElement(n.Select,{labelId:"buyForYourself",id:"buyForYourself",value:K,defaultValue:!(null===(h=e.formik.values.prescription)||void 0===h||!h.buyForYourself)&&(null===(p=e.formik.values.prescription)||void 0===p?void 0:p.buyForYourself),onChange:e=>{q(e.target.value),H.setFieldValue("prescription.buyForYourself",e.target.value),!0===e.target.value&&(z(Oe.a.RECEIVE_TYPE_AT_PHARMACY),H.setFieldValue("prescription.receiveType",Oe.a.RECEIVE_TYPE_AT_PHARMACY))},label:"Hình thức mua thuốc"},Oe.a.DRUG_BUY_FOR_MYSELF.map((e,t)=>i.a.createElement(n.MenuItem,{key:e.label,value:e.value},e.label))))),!(null!==(f=H.values.prescription)&&void 0!==f&&f.buyForYourself)&&i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(g,{formik:H,variant:"outlined",field:"prescription.receivingUnit",defaultValue:null===(v=H.values.prescription)||void 0===v?void 0:v.receivingUnit,label:"Chọn phòng thuốc",size:"small",options:B}))),!(null!==(b=H.values.prescription)&&void 0!==b&&b.buyForYourself)&&i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"receiveType"},"Hình thức nhận thuốc"),i.a.createElement(n.Select,{labelId:"receiveType",id:"receiveType",value:G,defaultValue:null===(y=e.formik.values.prescription)||void 0===y?void 0:y.receiveType,onChange:t=>{var a,n,s;(z(t.target.value),H.setFieldValue("prescription.receiveType",t.target.value),t.target.value===Oe.a.RECEIVE_TYPE_AT_HOME)&&(H.setFieldValue("prescription.receiveAddress",null===(a=e.patientInfo)||void 0===a?void 0:a.address),H.setFieldValue("prescription.receiveName",null===(n=e.patientInfo)||void 0===n?void 0:n.displayName),H.setFieldValue("prescription.receivePhoneNumber",null===(s=e.patientInfo)||void 0===s?void 0:s.phoneNumber))},label:"Hình thức nhận thuốc"},Oe.a.RECEIVE_TYPE.map((e,t)=>i.a.createElement(n.MenuItem,{key:e.value,value:e.value},e.name))))),G===Oe.a.RECEIVE_TYPE_AT_HOME&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(S,{formik:H,variant:"outlined",field:"prescription.receiveName",label:"Họ và tên người nhận",size:"small",defaultValue:null===(E=H.values.prescription)||void 0===E?void 0:E.receiveName})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(S,{formik:H,variant:"outlined",field:"prescription.receivePhoneNumber",label:"Số điện thoại liên hệ",size:"small",defaultValue:null===(_=H.values.prescription)||void 0===_?void 0:_.receivePhoneNumber})),i.a.createElement(n.Grid,{item:!0,lg:"FREE"==(null===(C=e.patientInfo)||void 0===C?void 0:C.serviceType)?12:4,md:"FREE"==(null===(w=e.patientInfo)||void 0===w?void 0:w.serviceType)?12:4,sm:12,xs:12},i.a.createElement(S,{formik:H,variant:"outlined",field:"prescription.receiveAddress",label:"Địa chỉ",size:"small",defaultValue:null===(O=H.values.prescription)||void 0===O?void 0:O.receiveAddress})))),i.a.createElement("br",null),i.a.createElement("hr",null),i.a.createElement(n.Button,{className:"mr-0 mb-16 btn btn-secondary d-inline-flex",variant:"contained",color:"primary",onClick:()=>e.handleTab(-1)},"Trở lại"),i.a.createElement(n.Button,{className:"mr-0 mb-16 btn btn-primary d-inline-flex ml-16",variant:"contained",color:"primary",onClick:()=>{H.setFieldValue("status",3),H.handleSubmit()}},"Lưu"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex ml-16",variant:"contained",color:"primary",onClick:()=>{e.handleComplete(e.formik.values)}},"Hoàn thành"),i.a.createElement(n.Button,{className:"mb-16 mr-16 ml-16 btn btn-secondary d-inline-flex float-right",variant:"contained",color:"primary",onClick:e.handleCloseMedical},"Đóng"))}const rf=["children","value","index"];function lf(e){const{children:t,value:a,index:n}=e,s=te()(e,rf);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:3},i.a.createElement(lg.a,null,t)))}function cf(e){return{id:"scrollable-auto-tab-"+e,"aria-controls":"scrollable-auto-tabpanel-"+e}}const df=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem"}}));function mf(e){const{formik:t,encounterType:a,handleClose:n,openTab:s,handleComplete:o,labTestOrder:r}=e,l=df(),[c,d]=i.a.useState(0),m=e=>{d(c+e)};i.a.useEffect(()=>{d(s)},[s]);return i.a.createElement("div",{className:l.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:l.tabHeader,value:c,onChange:(e,t)=>{d(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},i.a.createElement(_r.a,u()({style:{fontSize:"1.5rem"},label:"Khám bệnh"},cf(0))),i.a.createElement(_r.a,u()({style:{fontSize:"1.5rem"},label:"Xét nghiệm"},cf(1))),i.a.createElement(_r.a,u()({style:{fontSize:"1.5rem"},label:"Kê đơn thuốc"},cf(2))))),i.a.createElement("div",{className:l.tabPanel},i.a.createElement(lf,{value:c,index:0},i.a.createElement(Ug,{formik:t,handleTab:m,encounterType:a})),i.a.createElement(lf,{value:c,index:1},i.a.createElement(zg,{formik:t,handleTab:m,encounterType:a,patientInfo:e.patientInfo})),i.a.createElement(lf,{value:c,index:2},i.a.createElement(of,{formik:t,handleTab:m,handleCloseMedical:n,handleComplete:o,encounterType:a,patientInfo:e.patientInfo,labTestOrder:r}))))}const uf=Object(n.makeStyles)(e=>({root:{},patientHeader:{padding:"1.5rem!important",border:"1px solid #83b8e5",borderRadius:"0.5rem",boxShadow:"0 0.125rem 0.25rem rgb(0 0 0 / 8%) !important"},patientInfomation:{fontSize:"1.5rem",display:"flex",flexDirection:"column",justifyContent:"space-between",paddingRight:"20px"},patientName:{fontSize:"1.8rem!important",fontWeight:600},treatmentInfomation:{fontSize:"1.5rem"},goMedicalBtn:{borderRadius:"5px!important",border:"2px solid #3366ff",width:"100%",height:"100%","&:hover":{backgroundColor:"#3366ff",color:"#fff!important",transaction:"0.2s"}},finishMedicalBtn:{borderRadius:"5px!important",border:"2px solid #2a80c8",color:"#2a80c8",width:"100%","&:hover":{backgroundColor:"#3366ff",color:"#fff!important",transaction:"0.2s"}},cardHeader:{},treatmentInfomationLabel:{fontWeight:"bold",color:"#000"},treatmentInfomationValue:{float:"right",color:"#000"},patientInfomationDetail:{color:"#5b739e",fontWeight:500},treatmentDate:{color:"#cd895c",fontWeight:600},screeningInfo:{fontSize:"1.5rem",padding:"0 0 0 24px"},screeningInfoBtn:{width:"100%",textAlign:"center"},encounterDate:{display:"flex",justifyContent:"flex-end"}})),hf=e=>{const t=e.serviceType;var a="";const n=Oe.a.SERVICE_TYPE.find(e=>e.key==t);return n&&(a=n.name),i.a.createElement("span",null,a)};function pf(e){var t,a,s,o,r,l,c,d,m,u,h,p;const g=uf(),{initialValues:f,handleSubmit:v,handleClose:b,practitionerId:E,patientInfo:_,_roomView:S,onRegistered:C,threepidInvite:w,currentRoomId:O,roomOobData:x,resizeNotifier:R,roomJustCreatedOpts:k,encounterType:I,openTab:T,handleComplete:P,user:N,labTestOrder:D}=e,j=Ye.object({}),A=Object(Y.useFormik)({enableReinitialize:!0,initialValues:f,validationSchema:j,onSubmit:e=>{v(e)}});i.a.useEffect(()=>{A.values.nextEncounterDate=A.values.doctorAgreeDay},[]),i.a.useEffect(()=>{const t=setInterval(()=>{cg.getServiceEvaluationCardByEnCounterId(e.encounterId).then(e=>{let{data:t}=e;U(t)})},5e3);return()=>clearInterval(t)},[]);const[M,U]=i.a.useState(!1),[L,F]=i.a.useState(null),[B,V]=i.a.useState(null),[G,z]=i.a.useState(!1),[W,H]=i.a.useState(!1),[K,q]=i.a.useState(!1);On.getComponent("structures.GlobitsRoomView");let $=window.location.protocol+"//"+window.location.host,J="localhost:8443";"https"==window.location.protocol&&(J="jitsi.riot.im");let Q=$+"/jitsi.html?conferenceDomain=meet.oceantech.com.vn:9143&conferenceId="+O+"&isAudioOnly=false&userId=USER&roomName=Room&displayName="+(null==N||null===(t=N.practitionerDto)||void 0===t?void 0:t.displayName)+"&encounterId="+(null==_||null===(a=_.encounter)||void 0===a?void 0:a.id)+"&appConfig="+y.a.API_ENPOINT,X=encodeURI(Q);return i.a.createElement("div",{className:g.root},i.a.createElement("form",{onSubmit:A.handleSubmit},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12,style:{display:"flex"}},i.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"150px",margin:"0 12px"}},i.a.createElement(Cg.a,{value:null!=_&&_.code?_.code:""})),i.a.createElement(n.Grid,{className:g.patientHeader,container:!0},i.a.createElement(n.Grid,{className:g.patientInfomation,item:!0,lg:5,md:5,sm:5,xs:5},i.a.createElement("div",{style:{width:"100%"}},i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:g.treatmentInfomationLabel},"Họ và tên:"),i.a.createElement("span",{className:g.treatmentInfomationValue},null==_?void 0:_.displayName))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:g.treatmentInfomationLabel},"Mã khách hàng:"),i.a.createElement("span",{className:g.treatmentInfomationValue},_.code))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:g.treatmentInfomationLabel},"Thông tin chung"),i.a.createElement("span",{className:g.treatmentInfomationValue},(e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name+", "),t})(null==_?void 0:_.gender),(e=>{let t=null;return e&&(t=Te()().diff(e,"years",!1)+" tuổi "),t})(null==_?void 0:_.dob),null!=_&&_.dob?`(${Te()(null==_?void 0:_.dob).format("DD/MM/YYYY")})`:""))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:g.treatmentInfomationLabel},"Địa chỉ"),i.a.createElement("span",{className:g.treatmentInfomationValue},null!=_&&_.address?null==_?void 0:_.address:""))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:g.treatmentInfomationLabel},"Dịch vụ:"),i.a.createElement("span",{className:g.treatmentInfomationValue},i.a.createElement(hf,{serviceType:_.serviceType})))),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex space-between"},i.a.createElement("span",{className:g.treatmentInfomationLabel},"Ngày bắt đầu:"),i.a.createElement("span",{className:g.treatmentInfomationValue},null!=_&&_.treatmentStartDate?Te()(null==_?void 0:_.treatmentStartDate).format("DD/MM/YYYY"):""))))),i.a.createElement(n.Grid,{className:g.treatmentInfomation,item:!0,lg:4,md:4,sm:4,xs:4},i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tr",null,i.a.createElement("td",{className:g.treatmentInfomationLabel},"Trạng thái khách hàng:"),i.a.createElement("td",{className:g.treatmentInfomationValue},(e=>{let t="",a=Oe.a.PATIENT_STATUS.find(t=>t.value==e);return a&&(t=a.name),t})(null==_?void 0:_.patientStatus))),i.a.createElement("tr",null,i.a.createElement("td",{className:g.treatmentInfomationLabel},"Ngày khám gần nhất:"),i.a.createElement("td",{className:g.treatmentInfomationValue},_.latestEncounterDate?Te()(_.latestEncounterDate).format("DD/MM/YYYY"):"")),i.a.createElement("tr",null,i.a.createElement("td",{className:g.treatmentInfomationLabel},"Trạng thái lịch khám:"),i.a.createElement("td",{className:g.treatmentInfomationValue},"Đang diễn ra")),0!=(null==_?void 0:_.patientStatus)&&i.a.createElement(i.a.Fragment,null,i.a.createElement("tr",null,i.a.createElement("td",{className:g.treatmentInfomationLabel},"Phác đồ điều trị:"),i.a.createElement("td",{className:g.treatmentInfomationValue},null!=_&&_.listRegiment&&null!=_&&null!==(s=_.listRegiment[0])&&void 0!==s&&s.name?null==_||null===(o=_.listRegiment[0])||void 0===o?void 0:o.name:"")),i.a.createElement("tr",null,i.a.createElement("td",{className:g.treatmentInfomationLabel},"Ngày khám tiếp theo:"),i.a.createElement("td",{className:g.treatmentInfomationValue},null!=_&&_.nextEncounterDate?Te()(null==_?void 0:_.nextEncounterDate).format("DD/MM/YYYY"):""))),i.a.createElement("tr",null,i.a.createElement("td",{className:g.treatmentInfomationLabel},"Lần khám:"),i.a.createElement("td",{className:g.treatmentInfomationValue},null!=_&&null!==(r=_.encounter)&&void 0!==r&&r.labTestOrder?null==_||null===(l=_.encounter)||void 0===l||null===(c=l.labTestOrder[0])||void 0===c||null===(d=c.template)||void 0===d?void 0:d.correspondingTo:"")))),i.a.createElement(n.Grid,{className:g.screeningInfo,item:!0,lg:3,md:3,sm:3,xs:3},i.a.createElement(n.Button,{onClick:async()=>{let e=await to.getPatientPeriodPrepScreeningById(_.lastPatientPrepScreeningId);F(e.data),z(!0)},variant:"outlined",className:g.screeningInfoBtn+" btn btn-primary mb-8",color:"primary"},"Thông tin sàng lọc"),i.a.createElement(n.Button,{onClick:()=>{q(!0)},variant:"outlined",className:g.screeningInfoBtn+" btn btn-primary mb-8",color:"primary"},"Hồ sơ bệnh án"),i.a.createElement(n.Button,{onClick:async()=>{let e=await ei.getTreamentById(_.lastTreatmentPeriodId);V(e.data),H(!0)},variant:"outlined",className:g.screeningInfoBtn+" btn btn-secondary mt-8",disabled:!(null!=_&&null!==(m=_.encounter)&&void 0!==m&&null!==(u=m.treatmentPeriod)&&void 0!==u&&u.isLatestPeriod)||(null==_||null===(h=_.encounter)||void 0===h||null===(p=h.treatmentPeriod)||void 0===p?void 0:p.status)===Oe.a.TREATMENT_PERIOD_STATUS_FINISHED},"Kết thúc đợt điều trị"),W&&i.a.createElement(_g,{handleClose:()=>{z(!1),H(!1),q(!1)},open:W,item:B,id:_.lastTreatmentPeriodId}))))),i.a.createElement("div",{className:"dialog-body-v3",style:{marginTop:"20px"}},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},M&&i.a.createElement("div",{className:g.encounterDate+" color-dark-green"},"Khách hàng đã đánh giá chất lượng"))),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.Card,null,i.a.createElement(n.CardHeader,{className:"bgc-primary-d1 text-white",title:"Trò chuyện với khách hàng"}),i.a.createElement(n.CardContent,null,i.a.createElement("iframe",{allow:"microphone; camera; encrypted-media; autoplay; display-capture; clipboard-write;allow-downloads;",src:X,style:{border:"none",borderRadius:"3px",width:"100%",minHeight:"400px"},allowfullscreen:"",sandbox:"allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-presentation allow-downloads"})))),i.a.createElement(n.Grid,{item:!0,md:8,sm:12,xs:12},i.a.createElement(mf,{formik:A,encounterType:I,handleClose:b,openTab:T,handleComplete:P,patientInfo:_,labTestOrder:D})))))))))}var gf=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/searchByPage";return v.a.post(a,e)}async searchNotification(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/searchNotification";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/"+e;return v.a.get(a)}async updateWatched(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/updateWatched/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/notification/"+e;return v.a.delete(a)}async checkCode(e,t){let a=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+a;const n={params:{id:e,code:t}};let s=y.a.API_ENPOINT+"/api/notification/checkCode";return v.a.get(s,n)}};function ff(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function vf(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ff(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ff(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class bf extends s.Component{constructor(e){super(e),Fe()(this,"updatePatientAgree",async()=>{var e,t,a;let n=null==this||null===(e=this.props)||void 0===e||null===(t=e.match)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.id;n&&await cg.getById(n).then(e=>{let{data:t}=e;t&&t.patientAgree!==this.state.patientAgree&&(Ce.toast.success("Khách hàng đã ký phiếu đồng thuận",Oe.a.TOAST_CONFIGURE),this.setState(vf({},t)),t.encounterType||this.setState({encounterType:0}))})}),Fe()(this,"handleClose",()=>{this.props.history.push({pathname:y.a.ROOT_PATH+"appointment"})}),Fe()(this,"handleComplete",e=>{if(0!=this.state.encounterType||null!=e&&e.eligibleCustomer&&null!=e&&e.doctorAgree&&null!=e&&e.patientAgree){if(e.isLatestEncounter&&!e.hasCreateNextIndicationTesting){if(!e.nextLabTestOrder)return void Ce.toast.error("Chưa chỉ định xét nghiệm",Oe.a.TOAST_CONFIGURE);if(!e.nextEncounterDate)return void Ce.toast.error("Chưa chỉ định ngày xét nghiệm kế tiếp",Oe.a.TOAST_CONFIGURE)}this.handleFormSubmit(vf(vf({},e),{},{status:6,finishEncounter:!0}))}else Ce.toast.warning("Cần chấp nhận phiếu đồng thuận để hoàn thành lần khám",Oe.a.TOAST_CONFIGURE)}),Fe()(this,"handleFormSubmit",async e=>{var t,a,n;let s={id:this.state.id,patientId:null===(t=this.props.history)||void 0===t||null===(a=t.location)||void 0===a||null===(n=a.state)||void 0===n?void 0:n.patientId,encounterDate:e.encounterDate,serviceType:Number(e.serviceType),practitioner:{id:""},temperature:Number(e.temperature),pulse:Number(e.pulse),minimumBloodPressure:Number(e.minimumBloodPressure),maximumBloodPressure:Number(e.maximumBloodPressure),breathing:Number(e.breathing),weight:Number(e.weight),height:Number(e.height),motorFunction:Number(e.motorFunction),anamnesis:e.anamnesis,treatmentPeriod:{id:this.state.treatmentPeriodId},degreeOfAdherenceTreatment:e.degreeOfAdherenceTreatment,pathologicalProcess:e.pathologicalProcess,participants:this.state.participants,hivTest:e.hivTest,creatinineTest:e.creatinineTest,creatinineResult:e.creatinineResult,hbvTest:e.hbvTest,hbvResult:e.hbvResult,hcvTest:e.hcvTest,hcvResult:e.hcvResult,syphilisTest:e.syphilisTest,syphilisResult:e.syphilisResult,gonorrhoeaTest:e.gonorrhoeaTest,gonorrhoeaResult:e.gonorrhoeaResult,chlamydiaTest:e.chlamydiaTest,chlamydiaTestResult:e.chlamydiaTestResult,otherDiseases:e.otherDiseases,labTestOrder:e.labTestOrder,fullBodyTestResults:e.fullBodyTestResults,parts:e.parts,prescription:e.prescription,regimenPrEP:e.regimenPrEP,sideEffectsOfMedications:e.sideEffectsOfMedications,symptomsOfHIVInfection:e.symptomsOfHIVInfection,pregnancyStatus:e.pregnancyStatus,sexuallyTransmittedDiseaseSymptoms:e.sexuallyTransmittedDiseaseSymptoms,highRiskHIVBehaviors:e.highRiskHIVBehaviors,eligibleCustomer:e.eligibleCustomer,doctorAgree:e.doctorAgree,patientAgree:e.patientAgree,testEvaluation:e.testEvaluation,testEvaluationDate:e.testEvaluationDate?e.testEvaluationDate:new Date,doctorAgreeDay:e.doctorAgreeDay?e.doctorAgreeDay:null,finishEncounter:e.finishEncounter,status:e.status,nextLabTestOrder:e.nextLabTestOrder,nextEncounterDate:e.nextEncounterDate,summaryExamination:e.summaryExamination,patientAgreeDay:e.patientAgreeDay};if(""!=this.state.practitionerId?s.practitioner.id=this.state.practitionerId:null!=e.practitioner&&(s.practitioner.id=e.practitioner.id),this.state.id?await cg.update(s).then(e=>{let{data:t}=e;t&&(this.setState(vf({},t)),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE))}):await cg.create(s).then(e=>{let{data:t}=e;t&&(this.setState(vf({},t)),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE))}),e.finishEncounter){var i,o;Ce.toast.success("Đã hoàn thành lần khám",Oe.a.TOAST_CONFIGURE);const{user:e,patientInfo:t}=this.state,a=t.userName?t.userName:"",n=null!=e&&null!==(i=e.userDto)&&void 0!==i&&i.username?null==e||null===(o=e.userDto)||void 0===o?void 0:o.username:"";let s={title:"Đã hoàn thành lần thăm khám",content:"Bác sĩ "+n+" đã hoàn thành lần thăm khám cho "+a+" vào ngày "+Te()(new Date).format("DD/MM/YYYY HH:mm"),type:Oe.a.NOTIFICATION_TYPE_CONST.END_ENCOUNTER,userName:a,userNamePractitioner:n};gf.create(s)}}),this.state={id:"",encounterDate:new Date,serviceType:0,practitioner:null,temperature:null,pulse:null,minimumBloodPressure:null,maximumBloodPressure:null,breathing:null,weight:null,height:null,motorFunction:null,anamnesis:"",treatmentPeriodId:"",patientId:"",degreeOfAdherenceTreatment:null,pathologicalProcess:"",participants:[],hivTest:!1,creatinineTest:!1,creatinineResult:"",hbvTest:!1,hbvResult:"",hcvTest:!1,hcvResult:"",syphilisTest:!1,syphilisResult:"",gonorrhoeaTest:!1,gonorrhoeaResult:"",chlamydiaTest:!1,chlamydiaTestResult:"",otherDiseases:"",listTemplate:[],labTestOrder:[],fullBodyTestResults:"",parts:"",practitionerId:"",linkId:"",appointment:{},sideEffectsOfMedications:"",symptomsOfHIVInfection:"",pregnancyStatus:"",sexuallyTransmittedDiseaseSymptoms:"",highRiskHIVBehaviors:"",testEvaluation:"",testEvaluationDate:new Date,doctorAgreeDay:null,nextEncounterDate:null,dimountComplete:!1,summaryExamination:"",prescription:null,encounterType:0,patientAgreeDay:null,tab:0}}async componentDidMount(){var e,t,a;let n=null==this||null===(e=this.props)||void 0===e||null===(t=e.match)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.id,s=await cg.getById(n);if(s&&s.data){var i,o,r,l,c,d;let e=null===(i=s.data)||void 0===i||null===(o=i.participants[0])||void 0===o||null===(r=o.practitioner)||void 0===r?void 0:r.id,t=null==s||null===(l=s.data)||void 0===l?void 0:l.patientId,a=null===(c=s.data)||void 0===c||null===(d=c.treatmentPeriod)||void 0===d?void 0:d.id;this.setState({treatmentPeriodId:a,patientId:t,practitionerId:e});let h=await ke.getOneById(a);if(h&&h.data){var m,u;let e=this.state.encounterType;0!=(null===(m=h.data)||void 0===m||null===(u=m.encounters)||void 0===u?void 0:u.length)&&(e=1),this.setState({encounterType:e})}n&&await cg.getById(n).then(e=>{let{data:t}=e;t&&(this.setState(vf({},t)),t.encounterType||this.setState({encounterType:0}))}),await Tn.getPatientInfoByPatientId(t).then(e=>{let{data:t}=e;t&&this.setState({patientInfo:t})}).then(()=>{var e,t,a,n;null!==(e=this.state.patientInfo)&&void 0!==e&&null!==(t=e.encounter)&&void 0!==t&&null!==(a=t.labTestOrder[0])&&void 0!==a&&null!==(n=a.template)&&void 0!==n&&n.correspondingTo&&this.setState({nextEncounterDate:Te()(new Date).add(Oe.a.NEXT_TIME_ENCOUNTER.find(e=>{var t,a,n,s;return e.label==(null===(t=this.state.patientInfo)||void 0===t||null===(a=t.encounter)||void 0===a||null===(n=a.labTestOrder[0])||void 0===n||null===(s=n.template)||void 0===s?void 0:s.correspondingTo)}).value,"M")})}),await Ot.getAllInfoByUserLogin().then(e=>{let{data:t}=e;this.setState({user:t})}),this.setState({dimountComplete:!0})}}render(){var e,t,a,n;let{encounterDate:i,serviceType:o,practitioner:r,temperature:l,pulse:c,minimumBloodPressure:d,maximumBloodPressure:m,breathing:u,weight:h,height:p,motorFunction:g,anamnesis:f,degreeOfAdherenceTreatment:v,pathologicalProcess:b,hivTest:y,creatinineTest:E,creatinineResult:_,hbvTest:S,hbvResult:C,hcvTest:w,hcvResult:O,syphilisTest:x,syphilisResult:R,gonorrhoeaTest:k,gonorrhoeaResult:I,chlamydiaTest:T,chlamydiaTestResult:P,otherDiseases:N,labTestOrder:D,fullBodyTestResults:j,parts:A,doctorAgreeDay:M,sideEffectsOfMedications:U,symptomsOfHIVInfection:L,pregnancyStatus:F,sexuallyTransmittedDiseaseSymptoms:B,highRiskHIVBehaviors:V,eligibleCustomer:G,patientAgree:z,doctorAgree:W,testEvaluation:H,testEvaluationDate:K,encounterType:q,nextEncounterDate:Y,dimountComplete:$,regimenPrEP:J,summaryExamination:Q,prescription:X,patientAgreeDay:Z}=this.state,{_roomView:ee,onRegistered:te,threepidInvite:ae,roomOobData:ne,resizeNotifier:se,roomJustCreatedOpts:ie}=this.props;return s.createElement("div",{className:""},$&&s.createElement(pf,{initialValues:{encounterDate:i,serviceType:o,practitioner:r,temperature:l,pulse:c,minimumBloodPressure:d,maximumBloodPressure:m,breathing:u,weight:h,height:p,motorFunction:g,anamnesis:f,degreeOfAdherenceTreatment:v,pathologicalProcess:b,hivTest:y,creatinineTest:E,creatinineResult:_,hbvTest:S,hbvResult:C,hcvTest:w,hcvResult:O,syphilisTest:x,syphilisResult:R,gonorrhoeaTest:k,gonorrhoeaResult:I,chlamydiaTest:T,chlamydiaTestResult:P,otherDiseases:N,labTestOrder:D,fullBodyTestResults:j,parts:A,sideEffectsOfMedications:U,symptomsOfHIVInfection:L,pregnancyStatus:F,sexuallyTransmittedDiseaseSymptoms:B,highRiskHIVBehaviors:V,eligibleCustomer:G,patientAgree:z,doctorAgree:W,testEvaluation:H,testEvaluationDate:K||new Date,doctorAgreeDay:M||null,isLatestEncounter:!this.state.id||this.state.isLatestEncounter,nextEncounterDate:this.state.nextEncounterDate,regimenPrEP:J,summaryExamination:Q,prescription:X,patientAgreeDay:Z},handleSubmit:this.handleFormSubmit,handleClose:this.handleClose,handleComplete:this.handleComplete,practitionerId:this.state.practitionerId,patientInfo:this.state.patientInfo,ref:ee,openTab:this.state.tab,onRegistered:te,threepidInvite:ae,roomOobData:ne,currentRoomId:null===(e=this.state.appointment)||void 0===e?void 0:e.id,resizeNotifier:se,roomJustCreatedOpts:ie,encounterType:q,encounterId:null==this||null===(t=this.props)||void 0===t||null===(a=t.match)||void 0===a||null===(n=a.params)||void 0===n?void 0:n.id,user:this.state.user}))}}var yf=bf;class Ef extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loadingTable:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatest:!0,filterTestType:this.state.filterTestType,receivingUnitId:this.state.receivingUnitId};console.log("search object ",e);let t=await Ol.searchByPage(e);this.setState({loadingTable:!1,data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",async e=>{if(e){let t=await Ol.getOneById(e);t&&this.setState({item:t.data,shouldOpenEditorDialog:!0})}else this.setState({item:null,shouldOpenEditorDialog:!0})}),Fe()(this,"optionList",[{value:0,name:"Lọc xét nghiệm chờ"},{value:1,name:"Lọc xét nghiệm còn thiếu"},{value:2,name:"Lọc xét nghiệm bất thường"}]),Fe()(this,"handleChangeSelectStatus",(e,t,a)=>{this.setState({filterTestType:t?t.value:null},()=>this.updatePageData())}),Fe()(this,"getListReceivingUnit",()=>{Ol.searchByHealthOrgnaization({pageSize:9999,pageIndex:1,text:"",types:[2,5]}).then(e=>{let{data:t}=e;this.setState({listReceivingUnit:t.content}),console.log("Data",t.content)})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{Ol.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"onChangeReceivingUnit",(e,t,a)=>{this.setState({receivingUnitId:t?t.id:t},()=>this.updatePageData())}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"renderLabTestType",e=>{let t="",a=Oe.a.LABTEST_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleFilterClick",()=>{this.setState({openFilter:!this.state.openFilter}),!1===this.state.openFilter?this.setState({tableHeight:window.innerHeight-350}):this.setState({tableHeight:window.innerHeight-270})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",text:"",filterTestType:null,listReceivingUnit:[],openFilter:!1,loadingTable:!0}}async componentDidMount(){this.updatePageData(),this.getListReceivingUnit(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-270})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}render(){let{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,text:s,filterTestType:o,loadingTable:r}=this.state;const{classes:c}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary",className:c.icon}),i.a.createElement("span",{className:c.icon},"Danh sách yêu cầu xét nghiệm"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12,className:"d-flex"},i.a.createElement(n.FormControl,{fullWidth:!0,style:{marginTop:"9px"}},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:s,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})})),i.a.createElement(n.Button,{className:"btn btn-primary d-inline-flex button-filter ml-20",color:"primary",variant:"contained",startIcon:i.a.createElement(Or.a,null),endIcon:this.state.openFilter?i.a.createElement(Ir.a,null):i.a.createElement(Rr.a,null),onClick:()=>{this.handleFilterClick()}},"Lọc")),i.a.createElement(pe,{openFilter:this.state.openFilter},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Se.Autocomplete,{fullWidth:!0,options:this.optionList,getOptionLabel:e=>e.name,size:"small",onChange:this.handleChangeSelectStatus,renderInput:e=>i.a.createElement(n.TextField,u()({id:"status",className:"font-inherit",label:"Lọc xét nghiệm",fullWidth:!0,name:"status"},e)),getOptionSelected:(e,t)=>t===e})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Se.Autocomplete,{fullWidth:!0,options:this.state.listReceivingUnit?this.state.listReceivingUnit:[],getOptionLabel:e=>e.name,size:"small",onChange:this.onChangeReceivingUnit,renderInput:e=>i.a.createElement(n.TextField,u()({id:"unit",className:"font-inherit",label:"Chọn đơn vị xét nghiệm",fullWidth:!0,name:"unit"},e)),getOptionSelected:(e,t)=>t.id===e.id}))),a&&i.a.createElement(It,{handleClose:this.handleClose,open:a,item:e}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,isLoading:this.state.loadingTable,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s,o;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:c.displayName},null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),i.a.createElement("div",{className:c.detail},`${this.renderGender(null==e||null===(a=e.patient)||void 0===a?void 0:a.gender)} | ${null!=e&&null!==(n=e.patient)&&void 0!==n&&n.birthDate?Te()(null==e||null===(s=e.patient)||void 0===s?void 0:s.birthDate).format("DD/MM/YYYY"):""} | ${null==e||null===(o=e.patient)||void 0===o?void 0:o.phoneNumber}`))},cellStyle:{padding:"10px"}},{title:"Tên bộ xét nghiệm",field:"template.name"},{title:"Ngày lập yêu cầu",field:"custom",render:e=>{let t="";return null!=e&&e.requestDate&&(t=Te()(null==e?void 0:e.requestDate).format("DD/MM/YYYY")),t}},{title:"Ngày thực hiện",field:"custom",render:e=>{let t="";return null!=e&&e.expectedDate&&(t=Te()(null==e?void 0:e.expectedDate).format("DD/MM/YYYY")),t}},{title:"Đơn vị xét nghiệm",field:"receivingUnit.name"},{title:"Kết quả bất thường",field:"abnormalResults",headerStyle:{minWidth:"100px",maxWidth:"110px"},render:e=>i.a.createElement(n.Checkbox,{checked:null==e?void 0:e.abnormalResults,color:"primary"})},{title:"Thao tác",field:"custom",align:"right",width:"10%",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Cập nhật kết quả"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>{this.handleEditItem(e.id)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,style:{height:this.state.tableHeight,overflow:"auto"}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var _f=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.65rem"},detail:{fontSize:"1.25rem"},icon:{marginRight:e.spacing(.5)}}))(Ef);var Sf=()=>s.createElement(_f,null);const Cf=Object(n.makeStyles)(e=>({root:{}}));function wf(e){var t,a,o,r,l,c,d,m,u,h,p,f,v,b,y,E,_,C,w,O,x,R,k,I,T,N;const D=Cf(),{initialValues:j,item:A,handleClose:M,handleSubmit:U,userLogin:L,listDrugStore:F,encounter:B,clinicCode:V,clinicName:G}=e,W=Object(Y.useFormik)({enableReinitialize:!0,initialValues:j,onSubmit:e=>{Te()(e.orderDate).subtract(1,"days").unix()<Te()(e.dispensingDate).unix()?U(e):Ce.toast.warning("Ngày phát thuốc không được trước ngày kê đơn",Oe.a.TOAST_CONFIGURE)}}),[H,K]=Object(s.useState)([]),[q,$]=Object(s.useState)(""),[J,Q]=i.a.useState(W.values.receiveType);Object(s.useEffect)(()=>{var t,a;let{item:n,encounter:s}=e,i=[],o=[];null!==(t=W.values)&&void 0!==t&&t.drugsByRegimen&&(i=[...i,...W.values.drugsByRegimen]),null!==(a=W.values)&&void 0!==a&&a.drugsOther&&(i=[...i,...W.values.drugsOther]),o=i.map(e=>`Thuốc:${e.drugName}/SL:${e.totalQuantity}`),$(o.join("\n")),K(i),W.setFieldValue("drugs",i)},[]);return i.a.createElement("div",{className:D.root},i.a.createElement("form",{className:"form-booking",onSubmit:W.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:2,md:2,sm:6,xs:12},i.a.createElement(Cg.a,{value:`Phòng thuốc:${null!==(t=W.values)&&void 0!==t&&null!==(a=t.receivingUnit)&&void 0!==a&&a.name?null===(o=W.values)||void 0===o||null===(r=o.receivingUnit)||void 0===r?void 0:r.name:""} \nMã đơn:${null===(l=W.values)||void 0===l?void 0:l.code} \nBác sĩ kê:${null!==(c=W.values)&&void 0!==c&&null!==(d=c.practitioner)&&void 0!==d&&d.displayName?null===(m=W.values)||void 0===m||null===(u=m.practitioner)||void 0===u?void 0:u.displayName:""} \nNgày kê:${null!==(h=W.values)&&void 0!==h&&h.orderDate?Te()(null===(p=W.values)||void 0===p?void 0:p.orderDate).format("DD/MM/YYYY"):""} \nTên khách hàng:${null===(f=W.values)||void 0===f||null===(v=f.patient)||void 0===v?void 0:v.displayName} \n ${q}`,style:{}})),i.a.createElement(n.Grid,{item:!0,lg:10,md:10,sm:12,xs:12,container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(P,{formik:W,label:"Ngày kê đơn",format:"dd/MM/yyyy",field:"orderDate",inputVariant:"outlined",size:"small",required:"true",readOnly:!0})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(P,{formik:W,label:"Ngày phát thuốc",format:"dd/MM/yyyy",field:"dispensingDate",inputVariant:"outlined",size:"small",required:"true",readOnly:!L.drugStore})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(z,{formik:W,optionList:Oe.a.PRESCRIPTION_STATUS_DRUG,field:"status",variant:"outlined",size:"small",label:"Thay đổi trạng thái",readOnly:!L.drugStore})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.TextField,{disabled:!L.drugStore,fullWidth:!0,id:"returnedBox",size:"small",name:"returnedBox",label:"Số hộp thuốc trả lại",variant:"outlined",value:null===(b=W.values)||void 0===b?void 0:b.returnedBox,onChange:e=>W.setFieldValue("returnedBox",e.target.value),type:"number"})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(n.TextField,{disabled:!L.drugStore,fullWidth:!0,id:"unreturnedBox",size:"small",name:"unreturnedBox",label:"Số hộp thuốc không trả lại",variant:"outlined",value:null===(y=W.values)||void 0===y?void 0:y.unreturnedBox,onChange:e=>W.setFieldValue("unreturnedBox",e.target.value),type:"number"})),1==(null===(E=W.values)||void 0===E||null===(_=E.patient)||void 0===_?void 0:_.serviceType)&&null!=(null===(C=W.values)||void 0===C?void 0:C.buyForYourself)&&i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(n.TextField,{disabled:!0,fullWidth:!0,id:"buyForYourself",size:"small",name:"buyForYourself",label:"Hình thức mua thuốc",variant:"outlined",value:null===(w=Oe.a.DRUG_BUY_FOR_MYSELF.find(e=>{var t;return e.value===(null===(t=W.values)||void 0===t?void 0:t.buyForYourself)}))||void 0===w?void 0:w.label})),(0==(null===(O=W.values)||void 0===O?void 0:O.buyForYourself)&&1==(null===(x=W.values)||void 0===x||null===(R=x.patient)||void 0===R?void 0:R.serviceType)||2==(null===(k=W.values)||void 0===k||null===(I=k.patient)||void 0===I?void 0:I.serviceType)||null==(null===(T=W.values)||void 0===T?void 0:T.buyForYourself))&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(g,{formik:W,variant:"outlined",field:"receivingUnit",defaultValue:null===(N=W.values)||void 0===N?void 0:N.receivingUnit,label:"Nhà thuốc",size:"small",options:F})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"receiveType"},"Dịch vụ nhận thuốc"),i.a.createElement(n.Select,{labelId:"receiveType",id:"receiveType",value:J,onChange:e=>{Q(e.target.value),W.setFieldValue("receiveType",e.target.value)},label:"Dịch vụ nhận thuốc"},Oe.a.PRESCRIPTION_RECEIVE_TYPE.map((e,t)=>i.a.createElement(n.MenuItem,{key:e.value,value:e.value},e.name)))))),1==J&&i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(S,{formik:W,classes:D,field:"receiveName",size:"small",label:"Tên người nhận",variant:"outlined",required:"true",readOnly:!0})),1==J&&i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:6,xs:12},i.a.createElement(S,{formik:W,classes:D,field:"receivePhoneNumber",size:"small",label:"Số điện thoại người nhận",variant:"outlined",required:"true",readOnly:!0}))),1==J&&i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:W,classes:D,field:"receiveAddress",size:"small",label:"Địa chỉ người nhận",variant:"outlined",required:"true",readOnly:!0})),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(S,{formik:W,classes:D,field:"reasonForNotReturnBox",size:"small",label:"Lý do không trả đủ số lọ vỏ thuốc",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(qe.a,{data:H,columns:[{title:"Mã thuốc",field:"drugCode"},{title:"Tên thuốc",field:"drugName"},{title:"Số lượng thuốc",field:"totalQuantity",headerStyle:{minWidth:"200px"},cellStyle:{minWidth:"200px"}},{title:"Số ngày dùng thuốc",field:"numberDays",headerStyle:{minWidth:"200px"},cellStyle:{minWidth:"200px"}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("h3",{className:"text-primary m-0"},"Đính kèm hoá đơn thuốc")),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:e.listFile?e.listFile:[],columns:[{title:"Thao tác",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Tải xuống"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>(e=>{mp.downloadFile(e)})(e)},i.a.createElement(rp.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xem file"},i.a.createElement(n.IconButton,{size:"medium",onClick:()=>(e=>{mp.viewFile(e)})(e)},i.a.createElement(ze.a,{fontSize:"large",color:"action"})))),cellStyle:{padding:"4px 2px",minWidth:"100px"},headerStyle:{minWidth:"100px"}},{title:"Tên file",field:"file.name",align:"left",cellStyle:{padding:"4px 2px",minWidth:"350px"},headerStyle:{minWidth:"350px"}},{title:"Mô tả",field:"description",align:"left",cellStyle:{padding:"4px 2px",minWidth:"400px"},headerStyle:{minWidth:"400px"}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",padding:"6px"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(dt.a,null),onClick:()=>{let e=document.getElementById("content-print"),t=document.getElementById("printable").contentWindow;t.document.open(),t.document.write(e.innerHTML),t.document.close(),t.focus(),t.print()},className:"mr-12 btn btn-primary d-inline-flex",variant:"contained",color:"primary"},"In đơn thuốc"),L.drugStore&&i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))),i.a.createElement("iframe",{id:"printable",width:"100%",loading:"lazy",hidden:!0},i.a.createElement(Nt,{item:e.item,encounter:e.encounter,clinicCode:e.clinicCode,clinicName:e.clinicName})))}function Of(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function xf(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Of(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Of(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Rf(e){return i.a.createElement(n.Paper,e)}class kf extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"handleFormSubmit",async e=>{var t;let{id:a}=this.props.item;console.log("VALUES: ",e);let n=[],s=[];null!=e.drugs&&(null===(t=e.drugs)||void 0===t?void 0:t.length)>0&&e.drugs.map((e,t)=>{1==e.type?n.push(e):s.push(e)});let i=xf(xf({},this.state),{},{id:a,buyForYourself:e.buyForYourself,description:e.description,receiveType:e.receiveType,receiveName:e.receiveName,receiveAddress:e.receiveAddress,reasonForNotReturnBox:e.reasonForNotReturnBox,receivePhoneNumber:e.receivePhoneNumber,drugsByRegimen:n,drugsOther:s,orderDate:e.orderDate,patient:e.patient,practitioner:e.practitioner,status:e.status,dispensingDate:e.dispensingDate,returnedBox:e.returnedBox,unreturnedBox:e.unreturnedBox,receivingUnit:e.receivingUnit});await ic.update(i).then(()=>{this.props.handleClose()})}),this.state={id:"",buyForYourself:!1,description:"",receiveType:null,receiveName:null,receiveAddress:null,reasonForNotReturnBox:null,receivePhoneNumber:null,drugsByRegimen:[],drugsOther:[],orderDate:null,patient:null,practitioner:null,status:null,dispensingDate:null,returnedBox:null,unreturnedBox:null,receivingUnit:null,listDrugStore:[],code:null}}componentDidMount(){let{item:e,encounter:t}=this.props;ya.searchByPage({pageSize:50,pageIndex:1,types:[3,4]}).then(e=>{let{data:t}=e;this.setState({listDrugStore:t.content})}),e&&this.setState(xf({},e))}render(){return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Rf,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},"Đơn thuốc "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(wf,{initialValues:{description:this.state.description,receiveType:this.state.receiveType,receiveName:this.state.receiveName,buyForYourself:this.state.buyForYourself,receiveAddress:this.state.receiveAddress,reasonForNotReturnBox:this.state.reasonForNotReturnBox,receivePhoneNumber:this.state.receivePhoneNumber,drugsByRegimen:this.state.drugsByRegimen,drugsOther:this.state.drugsOther,orderDate:this.state.orderDate,patient:this.state.patient,practitioner:this.state.practitioner,status:this.state.status,dispensingDate:this.state.dispensingDate,returnedBox:this.state.returnedBox,unreturnedBox:this.state.unreturnedBox,receivingUnit:this.state.receivingUnit,code:this.state.code},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,item:this.props.item,userLogin:this.props.userLogin,listDrugStore:this.state.listDrugStore,listFile:this.props.item.prescriptionAttachFile,encounter:this.props.encounter,clinicCode:this.props.clinicCode,clinicName:this.props.clinicName}))}}function If(e){return i.a.createElement(n.TextField,{select:!0,label:e.label,name:e.name,value:e.value?e.value:"",onChange:e.onChange,fullWidth:!0},e.options.map((t,a)=>i.a.createElement(n.MenuItem,{key:`${e.name}-${a}`,value:t},t.name)))}class Tf extends i.a.Component{constructor(e){super(e),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,patientId:this.state.patientId,receivingUnitId:this.state.receivingUnitId,receivingType:this.state.receivingType,status:this.state.status},t=await ic.searchByDto(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleFilterClick",()=>{this.setState({openFilter:!this.state.openFilter}),!1===this.state.openFilter?this.setState({tableHeight:window.innerHeight-350}):this.setState({tableHeight:window.innerHeight-270})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"getUserLogin",()=>{Ot.getAllInfoByUserLogin().then(e=>{let{data:t}=e;this.setState({userLogin:t})})}),Fe()(this,"getListPatient",()=>{Tn.searchByPrescription({pageIndex:1,pageSize:1e3}).then(e=>{let{data:t}=e;this.setState({listPatient:t})})}),Fe()(this,"getListReceivingUnit",()=>{ic.getFilterList({filterType:11}).then(e=>{let{data:t}=e;this.setState({listReceivingUnit:t})})}),Fe()(this,"onChangeReceivingUnit",(e,t,a)=>{this.setState({receivingUnitId:t?t.id:t},()=>this.updatePageData())}),Fe()(this,"onChangeReceivingType",(e,t,a)=>{this.setState({receivingType:t?t.value:t},()=>this.updatePageData())}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleEditItem",e=>{ic.getEncounterById(e.encounter.id).then(e=>{this.setState({encounter:e.data.weight})}),ic.getClinicInformation().then(e=>{this.setState({clinicName:e.data.name,clinicCode:e.data.code})}),this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"search",e=>{this.setState({text:e},()=>this.updatePageData())}),Fe()(this,"handleChangeSelectStatus",async e=>{this.setState({status:e.target.value.value,labelStatus:e.target.value});let t={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,patientId:this.state.patientId,receivingUnitId:this.state.receivingUnitId,receivingType:this.state.receivingType,status:e.target.value.value},a=await ic.searchByDto(t);this.setState({data:a.data.content,totalElements:a.data.totalElements,totalPages:a.data.totalPages})}),Fe()(this,"onChangePatient",(e,t,a)=>{this.setState({patientId:t?t.id:t},()=>this.updatePageData())}),Fe()(this,"handleSync",()=>{this.setState({totalElements:-1}),ic.updatePrescriptionAffiliated().then(()=>{Object(Ce.toast)("Đã đồng bộ dữ liệu từ nhà thuốc liên kết",Oe.a.TOAST_CONFIGURE)}).finally(()=>{this.updatePageData()})}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:-1,item:null,shouldOpenEditorDialog:!1,userLogin:null,listPatient:[],openFilter:!1,listReceivingUnit:[],loading:!1,encounter:null,clinicCode:null,clinicName:null}}async componentDidMount(){this.updatePageData(),this.getListPatient(),this.getUserLogin(),this.getListReceivingUnit(),this.setState({tableHeight:window.innerHeight-270})}render(){const{classes:e}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Danh sách đơn thuốc"))),i.a.createElement(n.Grid,{item:!0,md:2,lg:2},i.a.createElement(n.Button,{startIcon:i.a.createElement(Zh.a,null),className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",onClick:()=>{this.handleSync()}},"Đồng bộ")),i.a.createElement(n.Grid,{item:!0,md:5,lg:5}),i.a.createElement(n.Grid,{item:!0,md:5,lg:5,className:"d-flex"},i.a.createElement(Gt,{search:this.search}),i.a.createElement(n.Button,{className:"ml-20 button-filter btn btn-primary d-inline-flex",color:"primary",variant:"contained",startIcon:i.a.createElement(Or.a,null),endIcon:this.state.openFilter?i.a.createElement(Ir.a,null):i.a.createElement(Rr.a,null),onClick:()=>{this.handleFilterClick()}},"Lọc")),i.a.createElement(pe,{openFilter:this.state.openFilter},i.a.createElement(n.Grid,{item:!0,md:3},i.a.createElement(If,{label:"Chọn trạng thái",name:"status",onChange:this.handleChangeSelectStatus,options:Oe.a.PRESCRIPTION_STATUS,value:this.state.labelStatus})),i.a.createElement(n.Grid,{item:!0,md:3,style:{display:"flex",alignItems:"flex-end"}},i.a.createElement(Se.Autocomplete,{fullWidth:!0,options:this.state.listReceivingUnit?this.state.listReceivingUnit:[],getOptionLabel:e=>e.name,size:"small",onChange:this.onChangeReceivingUnit,renderInput:e=>i.a.createElement(n.TextField,u()({className:"font-inherit",label:"Nhà thuốc",fullWidth:!0,name:"patient"},e)),getOptionSelected:(e,t)=>t===e.id})),i.a.createElement(n.Grid,{item:!0,md:3,style:{display:"flex",alignItems:"flex-end"}},i.a.createElement(Se.Autocomplete,{fullWidth:!0,options:Oe.a.PRESCRIPTION_RECEIVE_TYPE,getOptionLabel:e=>e.name,size:"small",onChange:this.onChangeReceivingType,renderInput:e=>i.a.createElement(n.TextField,u()({className:"font-inherit",label:"Hình thức nhận",fullWidth:!0,name:"patient"},e)),getOptionSelected:(e,t)=>t===e.value}))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%",height:"calc(100vh - 200px)"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã đơn thuốc",field:"code"},{title:"Lần thăm khám",field:"encounter.indexNumber",render:e=>{var t,a;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null!==(t=e.encounter)&&void 0!==t&&t.indexNumber?"Lần thăm khám thứ "+e.encounter.indexNumber:null),i.a.createElement("div",{className:"detail"},null!==(a=e.encounter)&&void 0!==a&&a.encounterDate?"Ngày: "+Te()(e.encounter.encounterDate).format("DD/MM/YYYY"):null))}},{title:"Khách hàng",field:"patient.displayName",render:t=>{var a,n;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null===(a=t.patient)||void 0===a?void 0:a.displayName),i.a.createElement("div",{className:e.detail},"Bác sĩ: ",null===(n=t.practitioner)||void 0===n?void 0:n.displayName))}},{title:"Trạng thái cấp phát",field:"status",render:e=>{if(e.status){let t=Oe.a.PRESCRIPTION_STATUS.find(t=>t.value===e.status);if(t)return i.a.createElement("span",{style:{color:""+t.color}},t.name)}return null}},{title:"Nhà thuốc",field:"receivingUnit.name"},{title:"Hình thức nhận",field:"receiveType",render:e=>e.receiveType?Oe.a.PRESCRIPTION_RECEIVE_TYPE.find(t=>t.value===e.receiveType).name:null},{title:"Ngày phát thuốc",field:"dispensingDate",render:e=>e.dispensingDate?Te()(e.dispensingDate).format("DD/MM/YYYY"):null},{title:"Thông tin phản hồi",field:"feedback"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await ic.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,style:{overflow:"auto",height:this.state.tableHeight},isLoading:!(this.state.totalElements>=0)}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}),this.state.shouldOpenEditorDialog&&i.a.createElement(kf,{handleClose:this.handleClose,open:this.state.shouldOpenEditorDialog,item:this.state.item,userLogin:this.state.userLogin,encounter:this.state.encounter,clinicCode:this.state.clinicCode,clinicName:this.state.clinicName}))))}}var Pf=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.7rem"},detail:{fontSize:"1.35rem",color:"#3366ff!important"},icon:{marginRight:e.spacing(.5)}}))(Tf);var Nf=e=>{let{}=e;return s.createElement(Pf,null)};const Df=y.a.API_ENPOINT+"/api/report";var jf=new class{async reportByPatientStatus(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/report/reportByPatientStatus";return v.a.post(a,e)}async reportPrepScreeningResultStatus(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/report/reportPrepScreeningResultStatus";return v.a.post(a,e)}async searchPatientPeriodPrepScreeningDto(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/patient-period-prep-screening/searchByDto";return v.a.post(a,e)}async reportServiceEvaluationCardByEncounter(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/report/reportServiceEvaluationCardByEncounter";return v.a.post(a,e)}async reportAppointment(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/report/reportAppointment";return v.a.post(a,e)}async reportProgramActivity(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=Df+"/program-activity";return v.a.post(a,e)}async reportQualVaac(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=Df+"/qual-vaac";return v.a.post(a,e)}};class Af extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{data:[],dataPatient:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,year:null,month:null,startDate:null,endDate:null,id:"",text:"",listYear:[],type:2,patientStatus:Oe.a.NEVERBEENTREATED.value}),Fe()(this,"updatePageData",async()=>{let e={yearReport:this.state.year,monthReport:this.state.month,patientStatus:[this.state.patientStatus],type:this.state.type},t=await jf.reportByPatientStatus(e);this.setState({data:t.data.items,startDate:t.data.startDate,endDate:t.data.endDate},()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,startDate:this.state.startDate,endDate:this.state.endDate,patientStatus:[this.state.patientStatus]};Tn.searchByPage(e).then(e=>{this.setState({dataPatient:e.data.content,totalElements:e.data.totalElements,totalPages:e.data.totalPages})})})}),Fe()(this,"getDataByType",()=>{new Date,Te()().startOf("month").toDate(),Te()().endOf("month").toDate();this.props.type===Bf.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_MONTH.value},()=>{this.updatePageData()}):this.props.type===Vf.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_QUARTER.value},()=>{this.updatePageData()}):this.props.type===Gf.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_HAFT_YEAR.value},()=>{this.updatePageData()}):this.props.type===zf.index&&this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_YEAR.value},()=>{this.updatePageData()})}),Fe()(this,"getListYear",()=>{let e=(new Date).getFullYear(),t=[];for(let a=e-10;a<=e+10;a++){let e={};e.value=a,e.name=a,t.push(e)}this.setState({year:e,listYear:t})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleChangeYear",e=>{e.target.value,e.target.value;this.setState({year:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePatientStatus",e=>{this.setState({patientStatus:e.target.value},()=>{this.updatePageData()})})}componentWillMount(){this.getListYear()}async componentDidMount(){this.getDataByType()}render(){let{item:e,year:t,text:a,type:s,listYear:o,dataPatient:r,data:l,patientStatus:c}=this.state;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Năm"),i.a.createElement(n.Select,{id:"id-year",value:t,name:"year",onChange:this.handleChangeYear,label:"Năm"},o.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("table",{className:"tbl_report"},this.props.type===Bf.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Tháng 1"),i.a.createElement("th",null,"Tháng 2"),i.a.createElement("th",null,"Tháng 3"),i.a.createElement("th",null,"Tháng 4"),i.a.createElement("th",null,"Tháng 5"),i.a.createElement("th",null,"Tháng 6"),i.a.createElement("th",null,"Tháng 7"),i.a.createElement("th",null,"Tháng 8"),i.a.createElement("th",null,"Tháng 9"),i.a.createElement("th",null,"Tháng 10"),i.a.createElement("th",null,"Tháng 11"),i.a.createElement("th",null,"Tháng 12")),this.props.type===Vf.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Quý 1"),i.a.createElement("th",null,"Quý 2"),i.a.createElement("th",null,"Quý 3"),i.a.createElement("th",null,"Quý 4")),this.props.type===Gf.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Đầu năm"),i.a.createElement("th",null,"Cuối năm")),this.props.type===zf.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,this.state.year)),i.a.createElement("tr",null,i.a.createElement("td",null,"Số lượng"),l&&l.map((e,t)=>i.a.createElement("td",{style:{textAlign:"center"}},i.a.createElement("div",null," ",e.total)))))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.dataPatient,columns:[{title:"Khách hàng",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e?void 0:e.displayName),i.a.createElement("div",null,`${null!=e&&e.birthDate?Te()(null==e?void 0:e.birthDate).format("DD/MM/YYYY"):""} | ${null==e?void 0:e.phoneNumber}`)),cellStyle:{padding:"10px",whiteSpace:"nowrap"}},{title:"Dân tộc",field:"ethnicity.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Nghề nghiệp",field:"occupation.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Ngày tạo tài khoản",field:"",cellStyle:{padding:"10px"},render:e=>null!=e&&e.registrationDate?Te()(null==e?void 0:e.registrationDate).format("DD/MM/YYYY HH:mm:ss"):""}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,onSelectionChange:e=>{this.setState({selectedList:e})}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page})))}}var Mf=Af;const Uf=["children","value","index"];function Lf(e){const{children:t,value:a,index:n}=e,s=te()(e,Uf);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:3},t))}const Ff=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{borderRadius:"0.5rem"},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}})),Bf={index:0,label:"Tháng"},Vf={index:1,label:"Quý"},Gf={index:2,label:"Nửa năm"},zf={index:3,label:"Năm"},Wf=[Bf,Vf,Gf,zf];function Hf(e){const t=Ff(),[a,n]=i.a.useState(0);return i.a.createElement("div",{className:t.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:t.tabHeader,value:a,onChange:(e,t)=>{n(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},Wf.map(e=>{return i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},e.label))},{id:"scrollable-auto-tab-"+(a=e.index),"aria-controls":"scrollable-auto-tabpanel-"+a}));var a}))),i.a.createElement("div",{className:t.tabPanel},Wf.map(t=>i.a.createElement(Lf,{value:a,index:t.index},i.a.createElement(Mf,u()({type:t.index},e))))))}class Kf extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{data:[],dataPatient:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,year:null,month:null,startDate:null,endDate:null,id:"",text:"",listYear:[],type:2,patientStatus:0}),Fe()(this,"updatePageData",async()=>{let e={yearReport:this.state.year,monthReport:this.state.month,patientStatus:[Oe.a.NEVERBEENTREATED.value],type:this.state.type},t=await jf.reportPrepScreeningResultStatus(e);this.setState({data:t.data.items,startDate:t.data.startDate,endDate:t.data.endDate},()=>{let e={statusResult:1,pageIndex:this.state.page,pageSize:this.state.rowsPerPage,startDate:this.state.startDate,endDate:this.state.endDate};jf.searchPatientPeriodPrepScreeningDto(e).then(e=>{this.setState({dataPatient:e.data.content,totalElements:e.data.totalElements,totalPages:e.data.totalPages})})})}),Fe()(this,"getDataByType",()=>{new Date,Te()().startOf("month").toDate(),Te()().endOf("month").toDate();this.props.type===Qf.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_MONTH.value},()=>{this.updatePageData()}):this.props.type===Xf.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_QUARTER.value},()=>{this.updatePageData()}):this.props.type===Zf.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_HAFT_YEAR.value},()=>{this.updatePageData()}):this.props.type===ev.index&&this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_YEAR.value},()=>{this.updatePageData()})}),Fe()(this,"getListYear",()=>{let e=(new Date).getFullYear(),t=[];for(let a=e-10;a<=e+10;a++){let e={};e.value=a,e.name=a,t.push(e)}this.setState({year:e,listYear:t})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleChangeYear",e=>{e.target.value,e.target.value;this.setState({year:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePatientStatus",e=>{this.setState({patientStatus:e.target.value},()=>{this.updatePageData()})})}componentWillMount(){this.getListYear()}async componentDidMount(){this.getDataByType()}render(){let{item:e,year:t,text:a,type:s,listYear:o,dataPatient:r,data:l,patientStatus:c}=this.state;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Năm"),i.a.createElement(n.Select,{id:"id-year",value:t,name:"year",onChange:this.handleChangeYear,label:"Năm"},o.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("table",{className:"tbl_report"},this.props.type===Qf.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Tháng 1"),i.a.createElement("th",null,"Tháng 2"),i.a.createElement("th",null,"Tháng 3"),i.a.createElement("th",null,"Tháng 4"),i.a.createElement("th",null,"Tháng 5"),i.a.createElement("th",null,"Tháng 6"),i.a.createElement("th",null,"Tháng 7"),i.a.createElement("th",null,"Tháng 8"),i.a.createElement("th",null,"Tháng 9"),i.a.createElement("th",null,"Tháng 10"),i.a.createElement("th",null,"Tháng 11"),i.a.createElement("th",null,"Tháng 12")),this.props.type===Xf.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Quý 1"),i.a.createElement("th",null,"Quý 2"),i.a.createElement("th",null,"Quý 3"),i.a.createElement("th",null,"Quý 4")),this.props.type===Zf.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Đầu năm"),i.a.createElement("th",null,"Cuối năm")),this.props.type===ev.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,this.state.year)),i.a.createElement("tr",null,i.a.createElement("td",null,"Số lượng"),l&&l.map((e,t)=>i.a.createElement("td",{style:{textAlign:"center"}},i.a.createElement("div",null," ",e.total)))))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.dataPatient,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),i.a.createElement("div",null,`${null!=e&&null!==(a=e.patient)&&void 0!==a&&a.birthDate?Te()(null==e||null===(n=e.patient)||void 0===n?void 0:n.birthDate).format("DD/MM/YYYY"):""} | ${null==e||null===(s=e.patient)||void 0===s?void 0:s.phoneNumber}`))},cellStyle:{padding:"10px",whiteSpace:"nowrap"}},{title:"Dân tộc",field:"patient.ethnicity.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Nghề nghiệp",field:"patient.occupation.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Ngày tạo tài khoản",field:"",cellStyle:{padding:"10px"},render:e=>{var t,a;return null!=e&&null!==(t=e.patient)&&void 0!==t&&t.registrationDate?Te()(null==e||null===(a=e.patient)||void 0===a?void 0:a.registrationDate).format("DD/MM/YYYY HH:mm:ss"):""}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,onSelectionChange:e=>{this.setState({selectedList:e})}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page})))}}var qf=Kf;const Yf=["children","value","index"];function $f(e){const{children:t,value:a,index:n}=e,s=te()(e,Yf);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:3},t))}const Jf=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{borderRadius:"0.5rem"},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}})),Qf={index:0,label:"Tháng"},Xf={index:1,label:"Quý"},Zf={index:2,label:"Nửa năm"},ev={index:3,label:"Năm"},tv=[Qf,Xf,Zf,ev];function av(e){const t=Jf(),[a,n]=i.a.useState(0);return i.a.createElement("div",{className:t.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:t.tabHeader,value:a,onChange:(e,t)=>{n(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},tv.map(e=>{return i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},e.label))},{id:"scrollable-auto-tab-"+(a=e.index),"aria-controls":"scrollable-auto-tabpanel-"+a}));var a}))),i.a.createElement("div",{className:t.tabPanel},tv.map(t=>i.a.createElement($f,{value:a,index:t.index},i.a.createElement(qf,u()({type:t.index},e))))))}var nv=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/searchByDto";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/"+e;return v.a.get(a)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/"+e.id;return v.a.put(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/"+e;return v.a.delete(a)}async updateStatus(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/lab-test-order/update-status/"+e.id;return v.a.post(a,e)}};class sv extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,isLatest:!0,statusEncounter:3},t=await nv.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",async e=>{if(e){let t=await nv.getOneById(e);t&&this.setState({item:t.data,shouldOpenEditorDialog:!0})}else this.setState({item:null,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{nv.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"renderLabTestType",e=>{let t="",a=Oe.a.LABTEST_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",text:""}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-270})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}render(){let{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,text:s}=this.state;const{classes:o}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary",className:o.icon}),i.a.createElement("span",{className:o.icon},"Danh sách xét nghiệm chờ thực hiện"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:s,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),a&&i.a.createElement(It,{handleClose:this.handleClose,open:a,item:e}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s,r;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:o.displayName},null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),i.a.createElement("div",{className:o.detail},`${this.renderGender(null==e||null===(a=e.patient)||void 0===a?void 0:a.gender)} | ${null!=e&&null!==(n=e.patient)&&void 0!==n&&n.birthDate?Te()(null==e||null===(s=e.patient)||void 0===s?void 0:s.birthDate).format("DD/MM/YYYY"):""} | ${null==e||null===(r=e.patient)||void 0===r?void 0:r.phoneNumber}`))},cellStyle:{padding:"10px"}},{title:"Tên bộ xét nghiệm",field:"template.name"},{title:"Ngày lập yêu cầu",field:"custom",render:e=>{let t="";return null!=e&&e.requestDate&&(t=Te()(null==e?void 0:e.requestDate).format("DD/MM/YYYY")),t}},{title:"Ngày thực hiện",field:"custom",render:e=>{let t="";return null!=e&&e.expectedDate&&(t=Te()(null==e?void 0:e.expectedDate).format("DD/MM/YYYY")),t}},{title:"Đơn vị xét nghiệm",field:"receivingUnit.name"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Cập nhật kết quả"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>{this.handleEditItem(e.id)}},i.a.createElement(rn.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!1,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var iv=Object(Ho.withStyles)(e=>({displayName:{color:"#3f51b5",fontSize:"1.65rem"},detail:{fontSize:"1.25rem"},icon:{marginRight:e.spacing(.5)}}))(sv);var ov=()=>s.createElement(iv,null);const rv=y.a.API_ENPOINT+"/api/practitionerSchedule";var lv=new class{async getListPractitionerSchedule(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=rv+"/getListPractitionerSchedule";return v.a.post(a,e)}async saveOrUpdate(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=rv;return v.a.post(a,e)}async saveList(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=rv+"/saveList";return v.a.post(a,e)}async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=rv+"/searchByPage";return v.a.post(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=rv+"/"+e;return v.a.delete(a)}};function cv(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function dv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?cv(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cv(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function mv(e){return i.a.createElement(vt.a,e)}class uv extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props;e.name,e.code}),Fe()(this,"updatePageData",()=>{var e,t;let a={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,dayInWeek:null===(e=this.state.cell)||void 0===e?void 0:e.dayInWeek,slotId:null===(t=this.state.slot)||void 0===t?void 0:t.id};lv.searchByPage(a).then(e=>{let{data:t}=e;this.setState({data:t.content,totalElements:t.totalElements,totalPages:t.totalPages})})}),Fe()(this,"handleOpenPopup",()=>{this.setState({shouldOpenPopup:!0})}),Fe()(this,"handlePopupClose",()=>{this.setState({shouldOpenPopup:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleSelect",e=>{if(e&&e.length>0){let t=[];e.forEach(e=>{var a;t.push({practitioner:e,slot:this.state.slot,dayInWeek:null===(a=this.state.cell)||void 0===a?void 0:a.dayInWeek})}),this.setState({cell:dv(dv({},this.state.cell),{},{listPractitionerSchedule:t})}),lv.saveList(t).then(()=>{Ce.toast.success("Đã cập nhật lịch",Oe.a.TOAST_CONFIGURE),this.handlePopupClose()}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)})}else Ce.toast.warning("Chưa chọn dữ liệu",Oe.a.TOAST_CONFIGURE)}),Fe()(this,"handleConfirmDeleteItem",()=>{lv.deleteById(this.state.id).then(()=>{this.handlePopupClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"renderDayInWeek",e=>{let t=Oe.a.DAY_IN_WEEK.find(t=>t.value==e);return t?t.name:null}),Fe()(this,"renderCaseTime",(e,t)=>`${Te()(e).format("HH:mm")} - ${Te()(t).format("HH:mm")}`),this.state={shouldOpenPopup:!1,data:[],page:1,totalPages:null,rowsPerPage:5,totalElements:null,shouldOpenConfirmationDialog:!1,id:""}}componentDidMount(){let e=this.props.item;this.setState(dv({},e),()=>{this.updatePageData()})}render(){let{cell:e,slot:t,shouldOpenPopup:a,data:s,shouldOpenConfirmationDialog:o}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:mv,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},"Cập nhật lịch"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement("div",null,null==t?void 0:t.name),i.a.createElement("div",{style:{color:"#3366ff"}},this.renderCaseTime(null==t?void 0:t.start,null==t?void 0:t.end))),i.a.createElement(n.Grid,{item:!0,sm:6},this.renderDayInWeek(null==e?void 0:e.dayInWeek)),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(n.Button,{className:"btn btn-primary",variant:"contained",color:"primary",onClick:this.handleOpenPopup},"Chọn bác sĩ")),i.a.createElement(n.Grid,{item:!0,sm:12},a&&i.a.createElement(Ba,{open:a,handleSelect:this.handleSelect,selectedItem:null!=e&&e.listPractitionerSchedule?null==e?void 0:e.listPractitionerSchedule:[],handleClose:this.handlePopupClose}),o&&i.a.createElement(l,{open:o,onConfirmDialogClose:this.handlePopupClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận",text:"Bạn có chắc chắn hủy lịch bác sĩ này",agree:"Có",cancel:"Không"}),i.a.createElement(qe.a,{data:s||[],columns:[{title:"Thao tác",field:"custom",align:"left",render:e=>i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))},{title:"Bác sĩ",field:"custom",align:"center",render:e=>{var t;return null==e||null===(t=e.practitioner)||void 0===t?void 0:t.displayName}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"}))))}}const hv=Object(n.makeStyles)(e=>({table:{width:"100%",overflow:"hidden",maxHeight:"100%",overflowY:"auto"},cell:{cursor:"pointer"}})),pv=Object(Ho.withStyles)(e=>({head:{backgroundColor:"#3366ff",color:"#fff",border:"1px solid #ccc"},body:{fontSize:14,border:"1px solid #ccc",padding:"8px 8px","&:hover":{backgroundColor:"#3366ff33"}}}))(n.TableCell),gv=Object(Ho.withStyles)(e=>({root:{"&:nth-of-type(odd)":{}}}))(n.TableRow);function fv(){const e=hv(),[t,a]=s.useState(!1),[i,o]=s.useState(null),[r,l]=s.useState(null),[c,d]=s.useState(null);s.useEffect(()=>{r||m()},[]);const m=()=>{d(!0),lv.getListPractitionerSchedule({}).then(e=>{let{data:t}=e;t&&l(t)}).finally(()=>{d(!1)})};return s.createElement("div",{style:{maxHeight:"calc(100vh - 120px)",overflowX:"hidden",overflowY:"auto"}},c?s.createElement(Lo.a,null):s.createElement(n.Grid,{container:!0,spacing:2},s.createElement(n.Grid,{item:!0,xs:12},s.createElement(n.TableContainer,{component:n.Paper},t&&s.createElement(uv,{open:t,handleClose:()=>{a(!1),m()},item:i}),s.createElement(n.Table,{className:e.table,"aria-label":"customized table"},s.createElement(n.TableHead,null,s.createElement(n.TableRow,null,s.createElement(pv,null),s.createElement(pv,{align:"center"},"Chủ Nhật"),s.createElement(pv,{align:"center"},"Thứ 2"),s.createElement(pv,{align:"center"},"Thứ 3"),s.createElement(pv,{align:"center"},"Thứ 4"),s.createElement(pv,{align:"center"},"Thứ 5"),s.createElement(pv,{align:"center"},"Thứ 6"),s.createElement(pv,{align:"center"},"Thứ 7"))),s.createElement(n.TableBody,null,r&&r.length>0&&r.map(t=>{var n,i,r,l,c,d;return s.createElement(gv,{key:null==t||null===(n=t.slot)||void 0===n?void 0:n.id},s.createElement(pv,null,s.createElement("div",null,null==t||null===(i=t.slot)||void 0===i?void 0:i.name),s.createElement("div",{style:{color:"#3366ff"}},(c=null==t||null===(r=t.slot)||void 0===r?void 0:r.start,d=null==t||null===(l=t.slot)||void 0===l?void 0:l.end,`${Te()(c).format("HH:mm")} - ${Te()(d).format("HH:mm")}`))),t.cells&&t.cells.length>0&&t.cells.map(n=>s.createElement(gt,{title:"Chỉnh sửa lịch này"},s.createElement(pv,{className:e.cell,align:"center",onClick:()=>((e,t)=>{o({slot:null==e?void 0:e.slot,cell:t}),a(!0)})(t,n)},n.listPractitionerSchedule&&n.listPractitionerSchedule.length>0&&n.listPractitionerSchedule.map(e=>{var t;return s.createElement("div",null,null==e||null===(t=e.practitioner)||void 0===t?void 0:t.displayName)})))))})))))))}var vv=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/policies/searchByPage";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/policies/"+e;return v.a.get(a)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/policies";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/policies/"+e.id;return v.a.put(a,e)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/policies/"+e;return v.a.delete(a)}async updateStatus(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/policies/update-status/"+e.id;return v.a.post(a,e)}async getItemActive(){var e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;let t=y.a.API_ENPOINT+"/public/api/policies";return v.a.get(t)}};class bv extends s.Component{constructor(){super(...arguments),Fe()(this,"state",{content:""}),Fe()(this,"handleContentChange",e=>{this.setState({content:e}),this.props.handleContentChange(e)})}componentWillMount(){this.setState({content:this.props.content})}render(){return i.a.createElement("div",null,i.a.createElement(Ft,{content:this.state.content,handleContentChange:this.handleContentChange,placeholder:"Chèn văn bản vào đây..."}))}}var yv=bv;function Ev(e){const{item:t,setFieldValue:a,values:o,readOnly:r}=e,[l,c]=Object(s.useState)([]),[d,m]=Object(s.useState)(!1);Object(s.useEffect)(()=>{d||m(!0)},[]);const[u,h]=Object(s.useState)(""),[p,g]=Object(s.useState)(!1);return i.a.createElement(Y.Form,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(Z,{name:"code",label:"Mã",defaultValue:null==t?void 0:t.code,setFieldValue:a,disabled:r})),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(Z,{name:"name",label:"Tên",defaultValue:null==t?void 0:t.name,setFieldValue:a,disabled:r})),i.a.createElement(n.Grid,{item:!0,lg:2,md:2,sm:12,xs:12},i.a.createElement(J,{name:"isActive",label:"Kích hoạt",value:!(null==o||!o.isActive)&&(null==o?void 0:o.isActive),setFieldValue:a,disabled:r})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(yv,{content:t.content?t.content:"",handleContentChange:e=>{a("content",e)}}))))}function _v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Sv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_v(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Cv(e){return i.a.createElement(vt.a,e)}function wv(e){var t;const[a,s]=i.a.useState(!1),o=Ye.object().shape({});return i.a.createElement(n.Dialog,{className:"dialog-container",open:e.open,PaperComponent:Cv,fullWidth:!0,maxWidth:"lg",scroll:"paper"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},null!=e&&null!==(t=e.item)&&void 0!==t&&t.id?"Cập nhật":"Thêm mới"," điều khoản sử dụng"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>e.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Y.Formik,{initialValues:e.item,validationSchema:o,onSubmit:t=>{(async t=>{var a,n;s(!0);let i=Sv(Sv({},e.item),{},{id:null===(a=e.item)||void 0===a?void 0:a.id,code:t.code,name:t.name,content:t.content,isActive:t.isActive});null!==(n=e.item)&&void 0!==n&&n.id?await vv.update(i).then(()=>{e.handleClose(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau!",Oe.a.TOAST_CONFIGURE)}):await vv.create(i).then(()=>{e.handleClose(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau!",Oe.a.TOAST_CONFIGURE)}),s(!1)})(t)},validateOnChange:!0},t=>{let{errors:s,touched:o,setFieldValue:r,values:l}=t;return i.a.createElement(Y.Form,null,i.a.createElement(n.DialogContent,{dividers:!0,className:"scroll-vertical h-70vh over-flow-auto"},i.a.createElement(Ev,{item:e.item,setFieldValue:r,values:l,readOnly:e.readOnly})),i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),loading:a,className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))}))}var Ov=a(1457),xv=a.n(Ov);function Rv(e){return i.a.createElement(vt.a,e)}class kv extends s.Component{constructor(){super(...arguments),Fe()(this,"state",{item:{},data:[],contentMessage:"",shouldOpenFileDownLoad:!1,shouldOpenShowMessage:!1,pageIndex:1,pageSize:10,checkBtn:!0,dataTest:[],content:""}),Fe()(this,"updatePageData",()=>{this.state.pageIndex,this.state.pageSize}),Fe()(this,"handleOpenFileDownload",(e,t)=>{this.setState({item:t,shouldOpenFileDownLoad:!0})}),Fe()(this,"handleCloseFileDownload",()=>{this.setState({shouldOpenFileDownLoad:!1,shouldOpenShowMessage:!1})}),Fe()(this,"shouldOpenShowMessage",e=>{this.setState({contentMessage:e,shouldOpenShowMessage:!0})}),Fe()(this,"handelNextPage",()=>{this.setState({pageIndex:this.state.pageIndex+1},()=>{this.componentDidMount()})}),Fe()(this,"handelPrePage",()=>{this.setState({pageIndex:this.state.pageIndex-1},()=>{this.componentDidMount()})})}componentDidMount(){var e,t;vv.getOneById(null===(e=this.props)||void 0===e||null===(t=e.item)||void 0===t?void 0:t.id).then(e=>{let{data:t}=e;this.setState({content:t.content,item:t})}),this.updatePageData()}render(){let{data:e}=this.state,{dataTest:t}=this.state;t.length;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Rv,fullWidth:!0,maxWidth:"lg",scroll:"paper"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"},"Chi tiết"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(n.DialogContent,{dividers:!0,className:"scroll-vertical h-70vh over-flow-auto"},i.a.createElement(n.Grid,{container:!0,spacing:5},i.a.createElement(n.Grid,{item:!0,sm:12,xs:12},i.a.createElement(Ut.a,{value:this.state.content,readOnly:!0,theme:"bubble"})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},Array.isArray(e)&&e.length>0&&i.a.createElement(n.Grid,null,i.a.createElement("ul",{style:{paddingLeft:0}},this.state.data.map((e,t)=>i.a.createElement("li",{style:{listStyle:"none",padding:"0px 16px",borderBottom:"1px dotted #ccc",cursor:"pointer",height:60},className:"list-item w-100",onClick:t=>this.handleOpenFileDownload(t,e)},i.a.createElement("div",{style:{display:"flex",height:"100%",paddingTop:10},className:"w-100"},i.a.createElement("div",{style:{width:"10%",paddingTop:10}},i.a.createElement("h6",null,i.a.createElement("span",{style:{fontSize:16,fontWeight:400,color:"rgb(0, 102, 204)",height:60}},i.a.createElement(xv.a,{color:"primary"})))),i.a.createElement("div",{style:{width:"90%"}},i.a.createElement("h3",{style:{width:"100%"}},i.a.createElement("a",{style:{width:"100%",color:"rgb(0, 102, 204)",fontWeight:400,lineHeight:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"block",fontSize:16,height:20,paddingTop:5}},e.name)),i.a.createElement("h6",null,i.a.createElement("span",{style:{color:"#a4b0be",fontWeight:300}},"Thông báo -"," ",Te()(e.createDateTime).format("DD/MM/YYYY"))))))))),i.a.createElement(n.Grid,{id:"messageContent"})))),i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"})))}}var Iv=kv;class Tv extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await vv.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenViewDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",async e=>{if(e){let t=await vv.getOneById(e);t&&this.setState({item:t.data,shouldOpenEditorDialog:!0})}else this.setState({item:{code:"",name:"",content:""},shouldOpenEditorDialog:!0})}),Fe()(this,"handelViewItem",e=>{this.setState({item:e,shouldOpenViewDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{vv.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",text:"",shouldOpenViewDialog:!1,loading:!1}}async componentDidMount(){this.updatePageData(),this.setState({tableHeight:window.innerHeight-290})}render(){let{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,text:s,shouldOpenViewDialog:o}=this.state;const{classes:r}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary",className:r.icon}),i.a.createElement("span",{className:r.icon},"Danh sách điều khoản sử dụng"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem(null)}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:s,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),o&&i.a.createElement(Iv,{item:e,open:o,handleClose:this.handleClose}),a&&i.a.createElement(wv,{handleClose:this.handleClose,open:a,item:e}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã",field:"code",cellStyle:{padding:"10px"}},{title:"Tên",field:"name",cellStyle:{padding:"10px"}},{title:"Kích hoạt",field:"isActive",cellStyle:{padding:"10px"},render:e=>{let t="";return e.isActive&&(t="Đang kích hoạt"),t}},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Chỉnh sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{await this.handleEditItem(e.id)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xem"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>{this.handelViewItem(e)}},i.a.createElement(ze.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],isLoading:this.state.loading,options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!1,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},style:{height:this.state.tableHeight,overflow:"auto"},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Pv=Object(Ho.withStyles)(e=>({icon:{marginRight:e.spacing(.5)}}))(Tv);class Nv extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{data:[],dataPatient:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,year:null,month:null,startDate:null,endDate:null,id:"",text:"",listYear:[],type:2,patientStatus:0}),Fe()(this,"updatePageData",async()=>{let e={yearReport:this.state.year,type:this.state.type},t=await jf.reportServiceEvaluationCardByEncounter(e);this.setState({data:t.data.items,startDate:t.data.startDate,endDate:t.data.endDate},()=>{})}),Fe()(this,"getDataByType",()=>{new Date,Te()().startOf("month").toDate(),Te()().endOf("month").toDate();this.props.type===Uv.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_MONTH.value},()=>{this.updatePageData()}):this.props.type===Lv.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_QUARTER.value},()=>{this.updatePageData()}):this.props.type===Fv.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_HAFT_YEAR.value},()=>{this.updatePageData()}):this.props.type===Bv.index&&this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_YEAR.value},()=>{this.updatePageData()})}),Fe()(this,"getListYear",()=>{let e=(new Date).getFullYear(),t=[];for(let a=e-10;a<=e+10;a++){let e={};e.value=a,e.name=a,t.push(e)}this.setState({year:e,listYear:t})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleChangeYear",e=>{e.target.value,e.target.value;this.setState({year:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePatientStatus",e=>{this.setState({patientStatus:e.target.value},()=>{this.updatePageData()})})}componentWillMount(){this.getListYear()}async componentDidMount(){this.getDataByType()}render(){let{item:e,year:t,text:a,type:s,listYear:o,dataPatient:r,data:l,patientStatus:c}=this.state;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Năm"),i.a.createElement(n.Select,{id:"id-year",value:t,name:"year",onChange:this.handleChangeYear,label:"Năm"},o.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("table",{className:"tbl_report"},this.props.type===Uv.index&&i.a.createElement("tr",null,i.a.createElement("th",null,"Các chỉ số"),i.a.createElement("th",null,"Tháng 1"),i.a.createElement("th",null,"Tháng 2"),i.a.createElement("th",null,"Tháng 3"),i.a.createElement("th",null,"Tháng 4"),i.a.createElement("th",null,"Tháng 5"),i.a.createElement("th",null,"Tháng 6"),i.a.createElement("th",null,"Tháng 7"),i.a.createElement("th",null,"Tháng 8"),i.a.createElement("th",null,"Tháng 9"),i.a.createElement("th",null,"Tháng 10"),i.a.createElement("th",null,"Tháng 11"),i.a.createElement("th",null,"Tháng 12")),this.props.type===Lv.index&&i.a.createElement("tr",null,i.a.createElement("th",null,"Các chỉ số"),i.a.createElement("th",null,"Quý 1"),i.a.createElement("th",null,"Quý 2"),i.a.createElement("th",null,"Quý 3"),i.a.createElement("th",null,"Quý 4")),this.props.type===Fv.index&&i.a.createElement("tr",null,i.a.createElement("th",null,"Các chỉ số"),i.a.createElement("th",null,"Đầu năm"),i.a.createElement("th",null,"Cuối năm")),this.props.type===Bv.index&&i.a.createElement("tr",null,i.a.createElement("th",null,"Các chỉ số"),i.a.createElement("th",null,this.state.year)),i.a.createElement("tr",null,i.a.createElement("td",null,"Tổng số đánh giá"),l&&l.map((e,t)=>i.a.createElement("td",{style:{textAlign:"center"}},i.a.createElement("div",null," ",e.total)))),i.a.createElement("tr",null,i.a.createElement("td",null,"Đánh giá hài lòng"),l&&l.map((e,t)=>i.a.createElement("td",{style:{textAlign:"center"}},i.a.createElement("div",null," ",e.goodReview)))),i.a.createElement("tr",null,i.a.createElement("td",null,"Tỷ lệ hài lòng (%)"),l&&l.map((e,t)=>i.a.createElement("td",{style:{textAlign:"center"}},i.a.createElement("div",null," ",e.ratingRate)))))))}}var Dv=Nv;const jv=["children","value","index"];function Av(e){const{children:t,value:a,index:n}=e,s=te()(e,jv);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:3},t))}const Mv=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{borderRadius:"0.5rem"},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}})),Uv={index:0,label:"Tháng"},Lv={index:1,label:"Quý"},Fv={index:2,label:"Nửa năm"},Bv={index:3,label:"Năm"},Vv=[Uv,Lv,Fv,Bv];function Gv(e){const t=Mv(),[a,n]=i.a.useState(0);return i.a.createElement("div",{className:t.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:t.tabHeader,value:a,onChange:(e,t)=>{n(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},Vv.map(e=>{return i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},e.label))},{id:"scrollable-auto-tab-"+(a=e.index),"aria-controls":"scrollable-auto-tabpanel-"+a}));var a}))),i.a.createElement("div",{className:t.tabPanel},Vv.map(t=>i.a.createElement(Av,{value:a,index:t.index},i.a.createElement(Dv,u()({type:t.index},e))))))}class zv extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{data:[],dataPatient:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,year:null,month:null,startDate:null,endDate:null,id:"",text:"",listYear:[],type:2,patientStatus:Oe.a.TREATMENTSTOPPED.value}),Fe()(this,"updatePageData",async()=>{let e={yearReport:this.state.year,monthReport:this.state.month,patientStatus:[this.state.patientStatus],type:this.state.type},t=await jf.reportByPatientStatus(e);this.setState({data:t.data.items,startDate:t.data.startDate,endDate:t.data.endDate},()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,startDate:this.state.startDate,endDate:this.state.endDate,patientStatus:[this.state.patientStatus]};Tn.searchByPage(e).then(e=>{this.setState({dataPatient:e.data.content,totalElements:e.data.totalElements,totalPages:e.data.totalPages})})})}),Fe()(this,"getDataByType",()=>{new Date,Te()().startOf("month").toDate(),Te()().endOf("month").toDate();this.props.type===Yv.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_MONTH.value},()=>{this.updatePageData()}):this.props.type===$v.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_QUARTER.value},()=>{this.updatePageData()}):this.props.type===Jv.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_HAFT_YEAR.value},()=>{this.updatePageData()}):this.props.type===Qv.index&&this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_YEAR.value},()=>{this.updatePageData()})}),Fe()(this,"getListYear",()=>{let e=(new Date).getFullYear(),t=[];for(let a=e-10;a<=e+10;a++){let e={};e.value=a,e.name=a,t.push(e)}this.setState({year:e,listYear:t})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleChangeYear",e=>{e.target.value,e.target.value;this.setState({year:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePatientStatus",e=>{this.setState({patientStatus:e.target.value},()=>{this.updatePageData()})})}componentWillMount(){this.getListYear()}async componentDidMount(){this.getDataByType()}render(){let{item:e,year:t,text:a,type:s,listYear:o,dataPatient:r,data:l,patientStatus:c}=this.state;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Năm"),i.a.createElement(n.Select,{id:"id-year",value:t,name:"year",onChange:this.handleChangeYear,label:"Năm"},o.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("table",{className:"tbl_report"},this.props.type===Yv.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Tháng 1"),i.a.createElement("th",null,"Tháng 2"),i.a.createElement("th",null,"Tháng 3"),i.a.createElement("th",null,"Tháng 4"),i.a.createElement("th",null,"Tháng 5"),i.a.createElement("th",null,"Tháng 6"),i.a.createElement("th",null,"Tháng 7"),i.a.createElement("th",null,"Tháng 8"),i.a.createElement("th",null,"Tháng 9"),i.a.createElement("th",null,"Tháng 10"),i.a.createElement("th",null,"Tháng 11"),i.a.createElement("th",null,"Tháng 12")),this.props.type===$v.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Quý 1"),i.a.createElement("th",null,"Quý 2"),i.a.createElement("th",null,"Quý 3"),i.a.createElement("th",null,"Quý 4")),this.props.type===Jv.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Đầu năm"),i.a.createElement("th",null,"Cuối năm")),this.props.type===Qv.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,this.state.year)),i.a.createElement("tr",null,i.a.createElement("td",null,"Số lượng"),l&&l.map((e,t)=>i.a.createElement("td",{style:{textAlign:"center"}},i.a.createElement("div",null," ",e.total)))))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.dataPatient,columns:[{title:"Khách hàng",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e?void 0:e.displayName),i.a.createElement("div",null,`${null!=e&&e.birthDate?Te()(null==e?void 0:e.birthDate).format("DD/MM/YYYY"):""} | ${null==e?void 0:e.phoneNumber}`)),cellStyle:{padding:"10px",whiteSpace:"nowrap"}},{title:"Dân tộc",field:"ethnicity.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Nghề nghiệp",field:"occupation.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Ngày tạo tài khoản",field:"",cellStyle:{padding:"10px"},render:e=>null!=e&&e.registrationDate?Te()(null==e?void 0:e.registrationDate).format("DD/MM/YYYY HH:mm:ss"):""}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,onSelectionChange:e=>{this.setState({selectedList:e})}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page})))}}var Wv=zv;const Hv=["children","value","index"];function Kv(e){const{children:t,value:a,index:n}=e,s=te()(e,Hv);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:3},t))}const qv=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{borderRadius:"0.5rem"},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}})),Yv={index:0,label:"Tháng"},$v={index:1,label:"Quý"},Jv={index:2,label:"Nửa năm"},Qv={index:3,label:"Năm"},Xv=[Yv,$v,Jv,Qv];function Zv(e){const t=qv(),[a,n]=i.a.useState(0);return i.a.createElement("div",{className:t.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:t.tabHeader,value:a,onChange:(e,t)=>{n(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},Xv.map(e=>{return i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},e.label))},{id:"scrollable-auto-tab-"+(a=e.index),"aria-controls":"scrollable-auto-tabpanel-"+a}));var a}))),i.a.createElement("div",{className:t.tabPanel},Xv.map(t=>i.a.createElement(Kv,{value:a,index:t.index},i.a.createElement(Wv,u()({type:t.index},e))))))}class eb extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{data:[],dataPatient:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,year:null,month:null,startDate:null,endDate:null,id:"",text:"",listYear:[],type:2,patientStatus:Oe.a.BEINGTREATED.value}),Fe()(this,"updatePageData",async()=>{let e={yearReport:this.state.year,monthReport:this.state.month,patientStatus:[this.state.patientStatus],type:this.state.type},t=await jf.reportByPatientStatus(e);this.setState({data:t.data.items,startDate:t.data.startDate,endDate:t.data.endDate},()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,startDate:this.state.startDate,endDate:this.state.endDate,patientStatus:[this.state.patientStatus]};Tn.searchByPage(e).then(e=>{this.setState({dataPatient:e.data.content,totalElements:e.data.totalElements,totalPages:e.data.totalPages})})})}),Fe()(this,"getDataByType",()=>{new Date,Te()().startOf("month").toDate(),Te()().endOf("month").toDate();this.props.type===ib.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_MONTH.value},()=>{this.updatePageData()}):this.props.type===ob.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_QUARTER.value},()=>{this.updatePageData()}):this.props.type===rb.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_HAFT_YEAR.value},()=>{this.updatePageData()}):this.props.type===lb.index&&this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_YEAR.value},()=>{this.updatePageData()})}),Fe()(this,"getListYear",()=>{let e=(new Date).getFullYear(),t=[];for(let a=e-10;a<=e+10;a++){let e={};e.value=a,e.name=a,t.push(e)}this.setState({year:e,listYear:t})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleChangeYear",e=>{e.target.value,e.target.value;this.setState({year:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePatientStatus",e=>{this.setState({patientStatus:e.target.value},()=>{this.updatePageData()})})}componentWillMount(){this.getListYear()}async componentDidMount(){this.getDataByType()}render(){let{item:e,year:t,text:a,type:s,listYear:o,dataPatient:r,data:l,patientStatus:c}=this.state;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Năm"),i.a.createElement(n.Select,{id:"id-year",value:t,name:"year",onChange:this.handleChangeYear,label:"Năm"},o.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("table",{className:"tbl_report"},this.props.type===ib.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Tháng 1"),i.a.createElement("th",null,"Tháng 2"),i.a.createElement("th",null,"Tháng 3"),i.a.createElement("th",null,"Tháng 4"),i.a.createElement("th",null,"Tháng 5"),i.a.createElement("th",null,"Tháng 6"),i.a.createElement("th",null,"Tháng 7"),i.a.createElement("th",null,"Tháng 8"),i.a.createElement("th",null,"Tháng 9"),i.a.createElement("th",null,"Tháng 10"),i.a.createElement("th",null,"Tháng 11"),i.a.createElement("th",null,"Tháng 12")),this.props.type===ob.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Quý 1"),i.a.createElement("th",null,"Quý 2"),i.a.createElement("th",null,"Quý 3"),i.a.createElement("th",null,"Quý 4")),this.props.type===rb.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Đầu năm"),i.a.createElement("th",null,"Cuối năm")),this.props.type===lb.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,this.state.year)),i.a.createElement("tr",null,i.a.createElement("td",null,"Số lượng"),l&&l.map((e,t)=>i.a.createElement("td",{style:{textAlign:"center"}},i.a.createElement("div",null," ",e.total)))))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.dataPatient,columns:[{title:"Khách hàng",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e?void 0:e.displayName),i.a.createElement("div",null,`${null!=e&&e.birthDate?Te()(null==e?void 0:e.birthDate).format("DD/MM/YYYY"):""} | ${null==e?void 0:e.phoneNumber}`)),cellStyle:{padding:"10px",whiteSpace:"nowrap"}},{title:"Dân tộc",field:"ethnicity.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Nghề nghiệp",field:"occupation.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Ngày tạo tài khoản",field:"",cellStyle:{padding:"10px"},render:e=>null!=e&&e.registrationDate?Te()(null==e?void 0:e.registrationDate).format("DD/MM/YYYY HH:mm:ss"):""}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,onSelectionChange:e=>{this.setState({selectedList:e})}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page})))}}var tb=eb;const ab=["children","value","index"];function nb(e){const{children:t,value:a,index:n}=e,s=te()(e,ab);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:3},t))}const sb=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{borderRadius:"0.5rem"},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}})),ib={index:0,label:"Tháng"},ob={index:1,label:"Quý"},rb={index:2,label:"Nửa năm"},lb={index:3,label:"Năm"},cb=[ib,ob,rb,lb];function db(e){const t=sb(),[a,n]=i.a.useState(0);return i.a.createElement("div",{className:t.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:t.tabHeader,value:a,onChange:(e,t)=>{n(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},cb.map(e=>{return i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},e.label))},{id:"scrollable-auto-tab-"+(a=e.index),"aria-controls":"scrollable-auto-tabpanel-"+a}));var a}))),i.a.createElement("div",{className:t.tabPanel},cb.map(t=>i.a.createElement(nb,{value:a,index:t.index},i.a.createElement(tb,u()({type:t.index},e))))))}class mb extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{data:[],dataPatient:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,year:null,month:null,startDate:null,endDate:null,id:"",text:"",listYear:[],type:2,patientStatus:0}),Fe()(this,"updatePageData",async()=>{let e={yearReport:this.state.year,type:this.state.type},t=await jf.reportAppointment(e);this.setState({data:t.data.items,startDate:t.data.startDate,endDate:t.data.endDate},()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,fromDate:this.state.startDate,toDate:this.state.endDate,place:1,status:2};Pn.searchByPage(e).then(e=>{this.setState({dataPatient:e.data.content,totalElements:e.data.totalElements,totalPages:e.data.totalPages})})})}),Fe()(this,"getDataByType",()=>{new Date,Te()().startOf("month").toDate(),Te()().endOf("month").toDate();this.props.type===fb.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_MONTH.value},()=>{this.updatePageData()}):this.props.type===vb.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_QUARTER.value},()=>{this.updatePageData()}):this.props.type===bb.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_HAFT_YEAR.value},()=>{this.updatePageData()}):this.props.type===yb.index&&this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_YEAR.value},()=>{this.updatePageData()})}),Fe()(this,"getListYear",()=>{let e=(new Date).getFullYear(),t=[];for(let a=e-10;a<=e+10;a++){let e={};e.value=a,e.name=a,t.push(e)}this.setState({year:e,listYear:t})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleChangeYear",e=>{e.target.value,e.target.value;this.setState({year:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePatientStatus",e=>{this.setState({patientStatus:e.target.value},()=>{this.updatePageData()})})}componentWillMount(){this.getListYear()}async componentDidMount(){this.getDataByType()}render(){let{item:e,year:t,text:a,type:s,listYear:o,dataPatient:r,data:l,patientStatus:c}=this.state;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Năm"),i.a.createElement(n.Select,{id:"id-year",value:t,name:"year",onChange:this.handleChangeYear,label:"Năm"},o.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("table",{className:"tbl_report"},this.props.type===fb.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Tháng 1"),i.a.createElement("th",null,"Tháng 2"),i.a.createElement("th",null,"Tháng 3"),i.a.createElement("th",null,"Tháng 4"),i.a.createElement("th",null,"Tháng 5"),i.a.createElement("th",null,"Tháng 6"),i.a.createElement("th",null,"Tháng 7"),i.a.createElement("th",null,"Tháng 8"),i.a.createElement("th",null,"Tháng 9"),i.a.createElement("th",null,"Tháng 10"),i.a.createElement("th",null,"Tháng 11"),i.a.createElement("th",null,"Tháng 12")),this.props.type===vb.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Quý 1"),i.a.createElement("th",null,"Quý 2"),i.a.createElement("th",null,"Quý 3"),i.a.createElement("th",null,"Quý 4")),this.props.type===bb.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Đầu năm"),i.a.createElement("th",null,"Cuối năm")),this.props.type===yb.index&&i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,this.state.year)),i.a.createElement("tr",null,i.a.createElement("td",null,"Số lượng"),l&&l.map((e,t)=>i.a.createElement("td",{style:{textAlign:"center"}},i.a.createElement("div",null," ",e.total)))))),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.dataPatient,columns:[{title:"Khách hàng",field:"custom",render:e=>{var t,a,n,s;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,null==e||null===(t=e.patient)||void 0===t?void 0:t.displayName),i.a.createElement("div",null,`${null!=e&&null!==(a=e.patient)&&void 0!==a&&a.birthDate?Te()(null==e||null===(n=e.patient)||void 0===n?void 0:n.birthDate).format("DD/MM/YYYY"):""} | ${null==e||null===(s=e.patient)||void 0===s?void 0:s.phoneNumber}`))},cellStyle:{padding:"10px",whiteSpace:"nowrap"}},{title:"Dân tộc",field:"patient.ethnicity.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Nghề nghiệp",field:"patient.occupation.name",cellStyle:{padding:"10px",width:"80px"},headerStyle:{width:"80px"},width:80},{title:"Ngày tạo tài khoản",field:"",cellStyle:{padding:"10px"},render:e=>{var t,a;return null!=e&&null!==(t=e.patient)&&void 0!==t&&t.registrationDate?Te()(null==e||null===(a=e.patient)||void 0===a?void 0:a.registrationDate).format("DD/MM/YYYY HH:mm:ss"):""}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.35rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,onSelectionChange:e=>{this.setState({selectedList:e})}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page})))}}var ub=mb;const hb=["children","value","index"];function pb(e){const{children:t,value:a,index:n}=e,s=te()(e,hb);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:3},t))}const gb=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{borderRadius:"0.5rem"},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}})),fb={index:0,label:"Tháng"},vb={index:1,label:"Quý"},bb={index:2,label:"Nửa năm"},yb={index:3,label:"Năm"},Eb=[fb,vb,bb,yb];function _b(e){const t=gb(),[a,n]=i.a.useState(0);return i.a.createElement("div",{className:t.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:t.tabHeader,value:a,onChange:(e,t)=>{n(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},Eb.map(e=>{return i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},e.label))},{id:"scrollable-auto-tab-"+(a=e.index),"aria-controls":"scrollable-auto-tabpanel-"+a}));var a}))),i.a.createElement("div",{className:t.tabPanel},Eb.map(t=>i.a.createElement(pb,{value:a,index:t.index},i.a.createElement(ub,u()({type:t.index},e))))))}var Sb=a(314),Cb=a.n(Sb),wb=a(452),Ob=a.n(wb);const xb=Object(n.makeStyles)(e=>({root:{}}));function Rb(e){const t=xb(),{initialValues:a,handleSubmit:o,handleClose:r}=e,l=Ye.object({}),c=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:l,onSubmit:e=>{o(e)}}),[d,m]=Object(s.useState)(c.values.type?c.values.type:null),[u,h]=Object(s.useState)(null);Object(s.useEffect)(()=>{c.values.type=d},[d]),Object(s.useEffect)(()=>{m(c.values.type)});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:c.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:e.isAddNew?4:6,md:e.isAddNew?4:6,sm:12,xs:12},i.a.createElement(S,{formik:c,classes:t,field:"userNameClinic",size:"small",label:"Phòng khám",variant:"outlined",disabled:!0})),i.a.createElement(n.Grid,{item:!0,lg:e.isAddNew?4:6,md:e.isAddNew?4:6,sm:12,xs:12},i.a.createElement(S,{formik:c,classes:t,field:"userNamePractitioner",size:"small",label:"Bác sĩ",variant:"outlined",disabled:!e.isAddNew})),!e.isAddNew&&i.a.createElement(n.Grid,{item:!0,lg:e.isAddNew?4:6,md:e.isAddNew?4:6,sm:12,xs:12},i.a.createElement(S,{formik:c,classes:t,field:"userName",size:"small",label:"Khách hàng",variant:"outlined",disabled:!e.isAddNew})),i.a.createElement(n.Grid,{item:!0,lg:e.isAddNew?4:6,md:e.isAddNew?4:6,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small",disabled:!e.isAddNew},i.a.createElement(n.InputLabel,{id:"resultType"},"Kiểu thông báo"),i.a.createElement(n.Select,{labelId:"resultType",id:"resultType",value:d,onChange:e=>{m(e.target.value)},label:"Kiểu thông báo"},Oe.a.NOTIFICATION_TYPE.map((e,t)=>i.a.createElement(n.MenuItem,{key:e.value,value:e.value},e.name))))),e.isAddNew&&i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Ob.a,{control:i.a.createElement(Cb.a,{checked:c.values.sendAll,onChange:()=>{c.setFieldValue("sendAll",!c.values.sendAll)},name:"checkedB",color:"primary"}),label:"Gửi tất cả"})),!c.values.sendAll&&e.isAddNew&&i.a.createElement(n.Grid,{item:!0,lg:8,md:8,sm:12,xs:12},i.a.createElement(Ma,{formik:c,classes:t,field:"listPatient",size:"small",label:"Chọn khách hàng",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(S,{formik:c,field:"title",size:"small",label:"Tiêu đề",variant:"outlined",required:!0,disabled:!e.isAddNew})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(S,{formik:c,field:"content",size:"small",label:"Nội dung",variant:"outlined",required:!0,minRows:4,rows:3,disabled:!e.isAddNew}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}function kb(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ib(e){return i.a.createElement(vt.a,e)}class Tb extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state,n={id:a,title:e.title,content:e.content,userNameClinic:e.userNameClinic,userNamePractitioner:e.userNamePractitioner,type:e.type,listPatient:e.listPatient,sendAll:e.sendAll};Ta.sendNotifications(n).then(e=>{console.log(e),Ce.toast.success("Gửi thông báo thành công"),t()}).catch(e=>{Ce.toast.error("Có lỗi xảy ra khi gửi thông báo")})}),this.state={title:"",content:"",userNameClinic:"",id:null,userNamePractitioner:"",isAddNew:!0,type:null,listPatient:null,sendAll:!1,userName:null}}componentDidMount(){let e=this.props.item;e&&(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kb(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kb(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)),e.id&&this.setState({isAddNew:!1}))}componentWillMount(){this.props.userClinic&&this.setState({userNameClinic:this.props.userClinic})}render(){return console.log(this.props.userClinic),i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Ib,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1"},i.a.createElement("span",{className:"mb-20 text-white"}," ",this.state.isAddNew?"Thêm thông báo":"Thông báo"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Rb,{initialValues:{title:this.state.title?this.state.title:"",content:this.state.content?this.state.content:"",userName:this.state.userName?this.state.userName:null,userNameClinic:this.props.userClinic?this.props.userClinic:"",userNamePractitioner:this.state.userNamePractitioner?this.state.userNamePractitioner:null,type:this.state.type?this.state.type:null,sendAll:!!this.state.sendAll&&this.state.sendAll,listPatient:this.state.listPatient?this.state.listPatient:null},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,isAddNew:this.state.isAddNew}))}}class Pb extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Ta.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenDeleteAllDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleDeleteAll",()=>{this.setState({shouldOpenDeleteAllDialog:!0})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"getInfoLogin",()=>{Ta.getAllInfoByUserLogin().then(e=>{console.log(e),this.setState({userNameClinic:e.data.userDto.username})})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{Ta.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleConfirmDeleteItemAll",()=>{let e=[];this.state.dataSelections.forEach(t=>{e.push(Ta.deleteById(t.id))}),Promise.all(e).then(()=>{this.handleClose(),Ce.toast.success("Xoá thành công",Oe.a.TOAST_CONFIGURE)}).then(()=>{this.setState({dataSelections:[]})})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),Fe()(this,"renderLabTestType",e=>{let t="",a=Oe.a.LABTEST_TYPE.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.search()}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,id:"",text:"",userNameClinic:"",dataSelections:[],shouldOpenDeleteAllDialog:!1,loading:!1,waittingDelete:!1}}async componentDidMount(){await this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.getInfoLogin(),this.setState({tableHeight:window.innerHeight-275,loading:!1})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}render(){let{item:e,shouldOpenConfirmationDialog:t,shouldOpenEditorDialog:a,text:s}=this.state;return console.log(this.state.userNameClinic),i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Quản lý thông báo"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12,className:"d-flex"},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Thêm mới"),this.state.dataSelections.length>0&&i.a.createElement(n.Button,{className:"mb-16 ml-16 btn btn-secondary d-inline-flex",startIcon:i.a.createElement(Qi.a,null),variant:"contained",onClick:()=>{this.handleDeleteAll()}},"Xoá Nhiều")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:s,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),a&&i.a.createElement(Tb,{handleClose:this.handleClose,open:a,item:e,userClinic:this.state.userNameClinic}),this.state.shouldOpenDeleteAllDialog&&i.a.createElement(l,{open:this.state.shouldOpenDeleteAllDialog,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItemAll,loading:this.state.waittingDelete,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa thông báo này?",agree:"Đồng ý",cancel:"Hủy"}),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa thông báo này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Tiêu đề",field:"title"},{title:"Nội dung",field:"content"},{title:"Khách hàng",field:"userName"},{title:"Phòng khám",field:"userNameClinic"},{title:"Bác sĩ",field:"userNamePractitioner"},{title:"Loại thông báo",field:"type",render:e=>{var t;return e.type?null===(t=Oe.a.NOTIFICATION_TYPE.find(t=>t.value==e.type))||void 0===t?void 0:t.name:""}},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Xem"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Ta.getOneById(e.id);console.log(e.id),this.handleEditItem(t.data)}},i.a.createElement(ze.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"}),selection:!0},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},isLoading:this.state.loading,icons:dn,style:{height:this.state.tableHeight,overflow:"auto"},onSelectionChange:e=>{this.setState({dataSelections:e}),console.log(e)}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Nb=()=>s.createElement(Pb,null);y.a.API_ENPOINT;var Db=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/support-staff/searchByPage";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/support-staff/getOne/"+e;return v.a.get(a)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/support-staff/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/support-staff";return v.a.post(a,e)}};const jb=Object(n.makeStyles)(e=>({root:{}}));function Ab(e){const t=jb(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({userName:Ye.string().ensure().required("Tên đăng nhập không được bỏ trống").lowercase(),displayName:Ye.string().required(),phoneNumber:Ye.number().required()}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"userName",size:"small",label:"Tên tài khoản",variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"displayName",size:"small",label:"Họ và tên",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,md:6,sm:6,xs:12},i.a.createElement(P,{formik:l,label:"Ngày sinh",format:"dd/MM/yyyy",field:"birthDate",inputVariant:"outlined",size:"small",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(z,{formik:l,optionList:Oe.a.GENDER?Oe.a.GENDER:[],variant:"outlined",field:"gender",label:"Giới tính",size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"phoneNumber",size:"small",label:"Số điện thoại",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(S,{formik:l,classes:t,field:"email",size:"small",label:"Email",variant:"outlined"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),loading:e.loading,className:"mr-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}function Mb(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ub(e){return i.a.createElement(vt.a,e)}class Lb extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",async e=>{this.setState({loading:!0});let{handleClose:t}=this.props,{id:a}=this.state;console.log(e);let n={id:a,userName:e.userName,displayName:e.displayName,birthDate:e.birthDate,phoneNumber:e.phoneNumber,gender:e.gender,email:e.email};a?await Db.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):await Db.create(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)}),this.setState({loading:!1})}),this.state={displayName:"",birthDate:null,phoneNumber:"",id:"",gender:"",email:"",userName:"",loading:!1}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Mb(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Mb(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:Ub,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",(this.props.item.id,"Chỉnh sửa người hỗ trợ")," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(Ab,{initialValues:{displayName:this.state.displayName?this.state.displayName:"",birthDate:this.state.birthDate?this.state.birthDate:null,phoneNumber:this.state.phoneNumber?this.state.phoneNumber:"",gender:this.state.gender?this.state.gender:"",email:this.state.email?this.state.email:"",userName:this.state.userName?this.state.userName:""},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose,loading:this.state.loading}))}}class Fb extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{this.setState({loading:!0});let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Db.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages,loading:!1})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenConfirmationDialog:!1,shouldOpenEditorDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handelViewItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"renderGender",e=>{let t="",a=Oe.a.GENDER.find(t=>t.value==e);return a&&(t=a.name),t}),Fe()(this,"handleConfirmDeleteItem",()=>{Db.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenConfirmationDialog:!1,item:null,id:"",text:"",shouldOpenEditorDialog:!1,isAddNew:!1,loading:!1}}async componentDidMount(){this.updatePageData(),this.setState({tableHeight:window.innerHeight-282})}render(){let{item:e,shouldOpenConfirmationDialog:t,text:a,shouldOpenEditorDialog:s}=this.state;const{classes:o}=this.props;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Quản lý nhân viên hỗ trợ"))),i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date}),this.setState({isAddNew:!1})}},"Thêm mới")),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:a,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),i.a.createElement(n.Grid,{item:!0,md:10},this.state.shouldOpenEditorDialog&&i.a.createElement(Lb,{handleClose:this.handleClose,open:this.state.shouldOpenEditorDialog,item:this.state.item}),this.state.shouldOpenConfirmationDialog&&i.a.createElement(l,{open:this.state.shouldOpenConfirmationDialog,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"})),t&&i.a.createElement(l,{open:t,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"}),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Họ và tên",field:"displayName",align:"left"},{title:"Tên tài khoản",field:"userName"},{title:"Ngày sinh",field:"birthDate",render:e=>e.birthDate?i.a.createElement("span",null,Te()(e.birthDate).format("DD/MM/YYYY")):""},{title:"Giới tính",field:"gender",render:e=>this.renderGender(e.gender)},{title:"Số điện thoại",field:"phoneNumber"},{title:"Email",field:"email"},{title:"Thao tác",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await Db.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn,style:{overflow:"auto",height:this.state.tableHeight},isLoading:this.state.loading}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var Bb=Object(Ho.withStyles)(e=>({icon:{marginRight:e.spacing(.5)}}))(Fb);class Vb extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{data:[],dataPatient:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,year:null,month:null,startDate:null,endDate:null,id:"",text:"",listYear:[],type:2,patientStatus:0,optionChoose:1}),Fe()(this,"updatePageData",async()=>{let e={yearReport:this.state.year,type:this.state.type},t=await jf.reportProgramActivity(e);this.setState({data:t.data.items,startDate:t.data.startDate,endDate:t.data.endDate})}),Fe()(this,"getDataByType",()=>{new Date,Te()().startOf("month").toDate(),Te()().endOf("month").toDate();this.props.type===Kb.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_MONTH.value},()=>{this.updatePageData()}):this.props.type===qb.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_QUARTER.value},()=>{this.updatePageData()}):this.props.type===Yb.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_HAFT_YEAR.value},()=>{this.updatePageData()}):this.props.type===$b.index&&this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_YEAR.value},()=>{this.updatePageData()})}),Fe()(this,"listOptionHalfYear",[{name:"Nửa đầu",value:1},{name:"Nửa sau",value:2}]),Fe()(this,"listOptionQuarter",[{name:"Quý 1",value:1},{name:"Quý 2",value:2},{name:"Quý 3",value:3},{name:"Quý 4",value:4}]),Fe()(this,"listOptionMonth",[{name:"Tháng 1",value:1},{name:"Tháng 2",value:2},{name:"Tháng 3",value:3},{name:"Tháng 4",value:4},{name:"Tháng 5",value:5},{name:"Tháng 6",value:6},{name:"Tháng 7",value:7},{name:"Tháng 8",value:8},{name:"Tháng 9",value:9},{name:"Tháng 10",value:10},{name:"Tháng 11",value:11},{name:"Tháng 12",value:12}]),Fe()(this,"getListYear",()=>{let e=(new Date).getFullYear(),t=[];for(let a=e-10;a<=e+10;a++){let e={};e.value=a,e.name=a,t.push(e)}this.setState({year:e,listYear:t})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleChangeYear",e=>{e.target.value,e.target.value;this.setState({year:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"handleChangeQuarter",e=>{this.setState({optionChoose:e.target.value})}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePatientStatus",e=>{this.setState({patientStatus:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"renderValue",e=>{let t=0;return null!==e.total?t=e.total:null!==e.rate?t=e.rate:null!==e.average&&(t=e.average),t})}componentWillMount(){this.getListYear()}async componentDidMount(){this.getDataByType()}render(){var e,t;let{item:a,year:s,text:o,type:r,listYear:l,dataPatient:c,data:d,patientStatus:m,optionChoose:u}=this.state;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Năm"),i.a.createElement(n.Select,{id:"id-year",value:s,name:"year",onChange:this.handleChangeYear,label:"Năm"},l.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),this.props.type===qb.index&&i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Quý"),i.a.createElement(n.Select,{id:"id-year",value:u,name:"year",onChange:this.handleChangeQuarter,label:"Quý"},this.listOptionQuarter.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),this.props.type===Kb.index&&i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Tháng"),i.a.createElement(n.Select,{id:"id-year",value:u,name:"year",onChange:this.handleChangeQuarter,label:"Tháng"},this.listOptionMonth.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),this.props.type===Yb.index&&i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Nửa năm"),i.a.createElement(n.Select,{id:"id-year",value:u,name:"year",onChange:this.handleChangeQuarter,label:"Nửa năm"},this.listOptionHalfYear.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("table",{className:"tbl_report",style:{}},i.a.createElement("tbody",{style:{width:"100%"}},i.a.createElement("tr",null,i.a.createElement("th",{rowSpan:3},"#"),i.a.createElement("th",{rowSpan:3},"Chỉ số"),i.a.createElement("th",{rowSpan:2,colSpan:6},"Nhóm đối tượng"),i.a.createElement("th",{colSpan:18},"Giới/Tuổi")),i.a.createElement("tr",null,i.a.createElement("th",{colSpan:9},"Nam"),i.a.createElement("th",{colSpan:9},"Nữ")),i.a.createElement("tr",null,i.a.createElement("th",null,"MSM"),i.a.createElement("th",null,"TG"),i.a.createElement("th",null,"TCMT"),i.a.createElement("th",null,"Người bán dâm"),i.a.createElement("th",null,"Bạn tình dị nhiễm"),i.a.createElement("th",null,"Khác"),i.a.createElement("th",null," < 15 "),i.a.createElement("th",null,"15 - 19"),i.a.createElement("th",null,"20 - 24"),i.a.createElement("th",null,"25 - 29"),i.a.createElement("th",null,"30 - 34"),i.a.createElement("th",null,"35 - 39"),i.a.createElement("th",null,"40 - 44"),i.a.createElement("th",null,"45 - 49"),i.a.createElement("th",null,"50+"),i.a.createElement("th",null," < 15 "),i.a.createElement("th",null,"15 - 19"),i.a.createElement("th",null,"20 - 24"),i.a.createElement("th",null,"25 - 29"),i.a.createElement("th",null,"30 - 34"),i.a.createElement("th",null,"35 - 39"),i.a.createElement("th",null,"40 - 44"),i.a.createElement("th",null,"45 - 49"),i.a.createElement("th",null,"50+")),null===(e=d[this.props.type===$b.index?0:u-1])||void 0===e||null===(t=e.programActivitys)||void 0===t?void 0:t.map((e,t)=>i.a.createElement(i.a.Fragment,null,4===t||9===t?i.a.createElement("tr",null,i.a.createElement("td",null,e.index),i.a.createElement("td",null,e.name),i.a.createElement("td",null,e.averageMSM),i.a.createElement("td",null,e.averageTG),i.a.createElement("td",null,e.averageTCMT),i.a.createElement("td",null,e.averageProstitutes),i.a.createElement("td",null,e.averageInfectiousSexualPartner),i.a.createElement("td",null,e.averageDiffirent),i.a.createElement("td",null,e.averageMaleLessThan15),i.a.createElement("td",null,e.averageMaleFrom15To19),i.a.createElement("td",null,e.averageMaleFrom20To24),i.a.createElement("td",null,e.averageMaleFrom25To29),i.a.createElement("td",null,e.averageMaleFrom30To34),i.a.createElement("td",null,e.averageMaleFrom35To39),i.a.createElement("td",null,e.averageMaleFrom40To44),i.a.createElement("td",null,e.averageMaleFrom45To49),i.a.createElement("td",null,e.averageMaleMoreThan50),i.a.createElement("td",null,e.averageFemaleLessThan15),i.a.createElement("td",null,e.averageFemaleFrom15To19),i.a.createElement("td",null,e.averageFemaleFrom20To24),i.a.createElement("td",null,e.averageFemaleFrom25To29),i.a.createElement("td",null,e.averageFemaleFrom30To34),i.a.createElement("td",null,e.averageFemaleFrom35To39),i.a.createElement("td",null,e.averageFemaleFrom40To44),i.a.createElement("td",null,e.averageFemaleFrom45To49),i.a.createElement("td",null,e.averageFemaleMoreThan50)):i.a.createElement("tr",null,i.a.createElement("td",null,e.index),i.a.createElement("td",null,e.name),i.a.createElement("td",null,e.msm),i.a.createElement("td",null,e.tg),i.a.createElement("td",null,e.tcmt),i.a.createElement("td",null,e.prostitutes),i.a.createElement("td",null,e.infectiousSexualPartner),i.a.createElement("td",null,e.diffirent),i.a.createElement("td",null,e.maleLessThan15),i.a.createElement("td",null,e.maleFrom15To19),i.a.createElement("td",null,e.maleFrom20To24),i.a.createElement("td",null,e.maleFrom25To29),i.a.createElement("td",null,e.maleFrom30To34),i.a.createElement("td",null,e.maleFrom35To39),i.a.createElement("td",null,e.maleFrom40To44),i.a.createElement("td",null,e.maleFrom45To49),i.a.createElement("td",null,e.maleMoreThan50),i.a.createElement("td",null,e.femaleLessThan15),i.a.createElement("td",null,e.femaleFrom15To19),i.a.createElement("td",null,e.femaleFrom20To24),i.a.createElement("td",null,e.femaleFrom25To29),i.a.createElement("td",null,e.femaleFrom30To34),i.a.createElement("td",null,e.femaleFrom35To39),i.a.createElement("td",null,e.femaleFrom40To44),i.a.createElement("td",null,e.femaleFrom45To49),i.a.createElement("td",null,e.femaleMoreThan50)))),null==d?void 0:d.map((e,t)=>i.a.createElement(i.a.Fragment,null))))))}}var Gb=Vb;const zb=["children","value","index"];function Wb(e){const{children:t,value:a,index:n}=e,s=te()(e,zb);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:3},t))}const Hb=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{borderRadius:"0.5rem"},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}})),Kb={index:0,label:"Tháng"},qb={index:1,label:"Quý"},Yb={index:2,label:"Nửa năm"},$b={index:3,label:"Năm"},Jb=[Kb,qb,Yb,$b];function Qb(e){const t=Hb(),[a,n]=i.a.useState(0);return i.a.createElement("div",{className:t.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:t.tabHeader,value:a,onChange:(e,t)=>{n(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},Jb.map(e=>{return i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},e.label))},{id:"scrollable-auto-tab-"+(a=e.index),"aria-controls":"scrollable-auto-tabpanel-"+a}));var a}))),i.a.createElement("div",{className:t.tabPanel},Jb.map(t=>i.a.createElement(Wb,{value:a,index:t.index},i.a.createElement(Gb,u()({type:t.index},e))))))}class Xb extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{data:[],dataPatient:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,item:null,year:null,month:null,startDate:null,endDate:null,id:"",text:"",listYear:[],type:2,patientStatus:0}),Fe()(this,"updatePageData",async()=>{let e={yearReport:this.state.year,type:this.state.type},t=await jf.reportQualVaac(e);this.setState({data:t.data.items,startDate:t.data.startDate,endDate:t.data.endDate})}),Fe()(this,"getDataByType",()=>{new Date,Te()().startOf("month").toDate(),Te()().endOf("month").toDate();this.props.type===ny.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_MONTH.value},()=>{this.updatePageData()}):this.props.type===sy.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_QUARTER.value},()=>{this.updatePageData()}):this.props.type===iy.index?this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_HAFT_YEAR.value},()=>{this.updatePageData()}):this.props.type===oy.index&&this.setState({type:Oe.a.REPORT_BY_PATIENT_STATUS_TYPE_YEAR.value},()=>{this.updatePageData()})}),Fe()(this,"getListYear",()=>{let e=(new Date).getFullYear(),t=[];for(let a=e-10;a<=e+10;a++){let e={};e.value=a,e.name=a,t.push(e)}this.setState({year:e,listYear:t})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"handleChangeYear",e=>{e.target.value,e.target.value;this.setState({year:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePatientStatus",e=>{this.setState({patientStatus:e.target.value},()=>{this.updatePageData()})}),Fe()(this,"renderValue",e=>{let t=0;return null!==e.total?t=e.total:null!==e.rate?t=e.rate:null!==e.average&&(t=e.average),t})}componentWillMount(){this.getListYear()}async componentDidMount(){this.getDataByType()}render(){let{item:e,year:t,text:a,type:s,listYear:o,dataPatient:r,data:l,patientStatus:c}=this.state;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0,style:{width:"100%"},variant:"outlined",size:"small"},i.a.createElement(n.InputLabel,{id:"id-year"},"Năm"),i.a.createElement(n.Select,{id:"id-year",value:t,name:"year",onChange:this.handleChangeYear,label:"Năm"},o.map((e,t)=>i.a.createElement(F.a,{key:e.value,value:e.value},e.name))))),i.a.createElement(n.Grid,{item:!0,md:12},i.a.createElement("table",{className:"tbl_report reverse-table",style:{display:"flex"}},i.a.createElement("tbody",{style:{display:"flex",width:"100%"}},null==l?void 0:l.map((e,t)=>{var a,n;return i.a.createElement(i.a.Fragment,null,0===t&&i.a.createElement("tr",{style:{flexGrow:1}},i.a.createElement("th",null,"Các chỉ số"),null===(a=e.programActivitys)||void 0===a?void 0:a.map(e=>i.a.createElement("td",{style:{height:"38px"}},e.name))),i.a.createElement("tr",{style:{flexGrow:1}},this.props.type===ny.index&&i.a.createElement("th",null,"T",e.month),this.props.type===sy.index&&i.a.createElement("th",null,"Q",e.quater),this.props.type===iy.index&&i.a.createElement("th",null,e.name),this.props.type===oy.index&&i.a.createElement("th",null,this.state.year),null===(n=e.programActivitys)||void 0===n?void 0:n.map((e,t)=>i.a.createElement("td",{style:{height:"38px"}},this.renderValue(e)))))})))))}}var Zb=Xb;const ey=["children","value","index"];function ty(e){const{children:t,value:a,index:n}=e,s=te()(e,ey);return i.a.createElement("div",u()({role:"tabpanel",hidden:a!==n,id:"scrollable-auto-tabpanel-"+n,"aria-labelledby":"scrollable-auto-tab-"+n},s),a===n&&i.a.createElement(Cr.a,{p:3},t))}const ay=Object(n.makeStyles)(e=>({root:{flexGrow:1,width:"100%"},tabHeader:{borderRadius:"0.5rem"},tabPanel:{background:"#fff",padding:"8px",border:"1px solid #ccc",borderRadius:"0 0.75rem 0.75rem 0.75rem",maxHeight:"calc(100vh - 150px)",overflow:"auto"},countHeader:{padding:"0.1rem!important"},titleAnalytics:{fontSize:"1.5rem!important",textAlign:"center",fontWeight:600}})),ny={index:0,label:"Tháng"},sy={index:1,label:"Quý"},iy={index:2,label:"Nửa năm"},oy={index:3,label:"Năm"},ry=[ny,sy,iy,oy];function ly(e){const t=ay(),[a,n]=i.a.useState(0);return i.a.createElement("div",{className:t.root+" tabs-container-dashboard"},i.a.createElement(vr.a,{className:"text-white",position:"static",color:"transparent"},i.a.createElement(yr.a,{className:t.tabHeader,value:a,onChange:(e,t)=>{n(t)},indicatorColor:"primary",textColor:"inherit",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},ry.map(e=>{return i.a.createElement(_r.a,u()({style:{fontSize:"1.1rem"},label:i.a.createElement("div",{className:t.countHeader},i.a.createElement("div",{className:t.titleAnalytics},e.label))},{id:"scrollable-auto-tab-"+(a=e.index),"aria-controls":"scrollable-auto-tabpanel-"+a}));var a}))),i.a.createElement("div",{className:t.tabPanel},ry.map(t=>i.a.createElement(ty,{value:a,index:t.index},i.a.createElement(Zb,u()({type:t.index},e))))))}function cy(e){let{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:s,currentRoomId:o,resizeNotifier:r,roomJustCreatedOpts:l,justRegistered:c}=e;return i.a.createElement(Fm.Switch,null,i.a.createElement(Fm.Route,{path:"/",exact:!0,render:e=>i.a.createElement(zu,u()({},e,{ref:t,onRegistered:a,threepidInvite:n,oobData:s,key:o||"roomview",resizeNotifier:r,justCreatedOpts:l}))}),i.a.createElement(Fm.Route,{path:"/home",exact:!0,render:e=>i.a.createElement(zu,u()({},e,{ref:t,onRegistered:a,threepidInvite:n,oobData:s,key:o||"roomview",resizeNotifier:r,justCreatedOpts:l}))}),i.a.createElement(Fm.Route,{exact:!0,path:"/patient",render:e=>i.a.createElement(jl,u()({},e,{justRegistered:c}))}),i.a.createElement(Fm.Route,{path:"/my-patient",render:e=>i.a.createElement(Kp,u()({},e,{ref:t,onRegistered:a,threepidInvite:n,oobData:s,key:o||"roomview",resizeNotifier:r,justCreatedOpts:l}))}),i.a.createElement(Fm.Route,{path:"/my-info",component:og}),i.a.createElement(Fm.Route,{path:"/customer-support",render:e=>i.a.createElement(ul,u()({},e,{ref:t,onRegistered:a,threepidInvite:n,oobData:s,key:o||"roomview",resizeNotifier:r,justCreatedOpts:l}))}),i.a.createElement(Fm.Route,{path:"/patient/create",component:bp}),i.a.createElement(Fm.Route,{exact:!0,path:"/patient/edit/:id",render:e=>i.a.createElement(bp,u()({},e,{viewRiskAssesment:!0}))}),i.a.createElement(Fm.Route,{path:"/appointment",render:e=>i.a.createElement($n,e)}),i.a.createElement(Fm.Route,{path:"/drug",component:tc}),i.a.createElement(Fm.Route,{path:"/user",component:_h}),i.a.createElement(Fm.Route,{path:"/send-mail",component:Mp}),i.a.createElement(Fm.Route,{path:"/value-code",component:Hh}),i.a.createElement(Fm.Route,{path:"/role",component:ch}),i.a.createElement(Fm.Route,{path:"/regimen",component:Mh}),i.a.createElement(Fm.Route,{path:"/labtest-template",component:Ih}),i.a.createElement(Fm.Route,{path:"/practitioner",render:e=>i.a.createElement(Zu,u()({},e,{ref:t,onRegistered:a,threepidInvite:n,oobData:s,key:o||"roomview",resizeNotifier:r,justCreatedOpts:l}))}),i.a.createElement(Fm.Route,{path:"/labtest",component:oh}),i.a.createElement(Fm.Route,{path:"/health-organization",component:tp}),i.a.createElement(Fm.Route,{path:"/administrative-unit",component:pn}),i.a.createElement(Fm.Route,{path:"/ethnicity",component:qc}),i.a.createElement(Fm.Route,{path:"/occupation",component:Op}),i.a.createElement(Fm.Route,{path:"/encounter-slot",component:Bc}),i.a.createElement(Fm.Route,{exact:!0,path:"/patient-medical-record/:id",component:Mg}),i.a.createElement(Fm.Route,{exact:!0,path:"/medical-record/:id",component:Ig}),i.a.createElement(Fm.Route,{path:"/medical-record/:id/:from",component:Ig}),i.a.createElement(Fm.Route,{path:"/medical-examination/:id",render:e=>i.a.createElement(yf,u()({},e,{ref:t,onRegistered:a,threepidInvite:n,oobData:s,key:o||"roomview",resizeNotifier:r,justCreatedOpts:l}))}),i.a.createElement(Fm.Route,{path:"/medical-examination",render:e=>i.a.createElement(yf,u()({},e,{ref:t,onRegistered:a,threepidInvite:n,oobData:s,key:o||"roomview",resizeNotifier:r,justCreatedOpts:l}))}),i.a.createElement(Fm.Route,{path:"/billing",component:Mr}),i.a.createElement(Fm.Route,{path:"/clinic-information",component:eo}),i.a.createElement(Fm.Route,{path:"/request-labtest",component:Sf}),i.a.createElement(Fm.Route,{path:"/notification-manager",component:Nb}),i.a.createElement(Fm.Route,{path:"/prescription",component:Nf}),i.a.createElement(Fm.Route,{path:"/drug-management",component:wc}),i.a.createElement(Fm.Route,{path:"/drug-export-management",component:fc}),i.a.createElement(Fm.Route,{path:"/result-waiting",component:ov}),i.a.createElement(Fm.Route,{path:"/report-first-time-customer",component:Hf}),i.a.createElement(Fm.Route,{path:"/report-being-treated-customer",component:db}),i.a.createElement(Fm.Route,{path:"/report-treatment-stopped-customer",component:Zv}),i.a.createElement(Fm.Route,{path:"/report-screening-results",component:av}),i.a.createElement(Fm.Route,{path:"/practitioner-schedule",component:fv}),i.a.createElement(Fm.Route,{path:"/policies",component:Pv}),i.a.createElement(Fm.Route,{path:"/clinic-customer",component:al}),i.a.createElement(Fm.Route,{path:"/dispensate-rating",component:Yl}),i.a.createElement(Fm.Route,{path:"/report-service-rating",component:Gv}),i.a.createElement(Fm.Route,{path:"/report-appointment",component:_b}),i.a.createElement(Fm.Route,{path:"/report-program-activity",component:Qb}),i.a.createElement(Fm.Route,{path:"/report-qual-vaac",component:ly}),i.a.createElement(Fm.Route,{path:"/supporter-management",component:Bb}))}var dy=a(1466),my=a.n(dy),uy=a(1465),hy=a.n(uy);a(695);function py(e){const[t,a]=i.a.useState(!1),[o,r]=i.a.useState([]),[l,c]=i.a.useState(0),[d,m]=i.a.useState(0),[u,h]=i.a.useState(10),[p,g]=i.a.useState(0),f=setTimeout(()=>{c(l+1)},3e4);Object(s.useEffect)(()=>(v(),()=>{clearInterval(f)}),[l]);const v=async()=>{const e=localStorage.getItem("totalNotify"),{data:t}=await gf.searchNotification({pageIndex:0,pageSize:u});r(t.items),m(t.totalUnWatched),g(t.total),e?e<t.total&&(b(),localStorage.setItem("totalNotify",t.total)):localStorage.setItem("totalNotify",t.total)},b=()=>{new Audio("media/notification.mp3").play()};function y(){v(),a(!t)}return i.a.useEffect(()=>{v()},[u]),i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Tooltip,{classes:{tooltip:e.classes.tooltip},title:"Thông báo"},i.a.createElement(n.IconButton,{onClick:y,className:e.classes.navButtonHorizontal+" nav-button ",size:"medium"},i.a.createElement(n.Badge,{color:"secondary",badgeContent:d||0},i.a.createElement(hy.a,{fontSize:"inherit",color:"inherit"})))),i.a.createElement(n.Drawer,{variant:"temporary",anchor:"right",open:t,onClose:y,ModalProps:{keepMounted:!0}},i.a.createElement("div",{className:"notification"},i.a.createElement("div",{className:"notification__topbar flex flex-middle p-16 mb-24"},i.a.createElement(my.a,{fontSize:"inherit",color:"secondary"}),i.a.createElement("h5",{className:"ml-8 my-0 font-weight-500"},"Thông báo")),o.length>0&&o.map((e,t)=>i.a.createElement("div",{key:e.id,className:"notification__card position-relative"},i.a.createElement(n.Card,{className:"mx-16 mb-24",elevation:3,style:{backgroundColor:e.watched?"#fff":"#3366ff1c",cursor:"pointer"},onClick:()=>{e.watched||(o[t].watched=!0,r([...o]),gf.updateWatched(e.id))}},i.a.createElement("div",{className:"card__topbar flex flex-middle flex-space-between p-8 "},i.a.createElement("div",{className:"flex"},i.a.createElement("div",{className:"card__topbar__button"}),i.a.createElement("span",{className:"ml-4 font-weight-500 text-black"},e.title))),i.a.createElement("div",{className:"px-16 pt-8 pb-16"},i.a.createElement("p",{className:"m-0"},e.content),i.a.createElement("small",{className:"text-muted",style:{display:"block",textAlign:"right"}},""+(e.innitiatedDate?Te()(e.innitiatedDate).fromNow():"")))))),0==o.length&&i.a.createElement("div",{className:"flex flex-middle"},"Không có thông báo"),p>u&&i.a.createElement("div",{className:"flex flex-middle p-16"},i.a.createElement(n.Button,{className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",onClick:()=>h(u+10)},"Xem thêm")),i.a.createElement("audio",{id:"ringbackAudio",loop:!0},i.a.createElement("source",{src:"media/ringback.ogg",type:"audio/ogg"}),i.a.createElement("source",{src:"media/ringback.mp3",type:"audio/mpeg"})))))}function gy(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function fy(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?gy(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):gy(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}Te.a.locale("vi");const vy=Object(n.makeStyles)(e=>({root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},menuButton:{color:"#FFF",marginLeft:12,marginRight:36},headerBar:{boxShadow:"0 0 0.25rem rgb(0 0 0 / 8%)",borderBottom:"1px solid #e4e4e4",position:"sticky",zIndex:999,top:0,padding:"8px 15px",background:"linear-gradient(180deg, #0E9594 0%, #127475 100%)"},menuButtonIconClosed:{transition:e.transitions.create(["transform"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),transform:"rotate(0deg)"},menuButtonIconOpen:{transition:e.transitions.create(["transform"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),transform:"rotate(180deg)"},hide:{display:"none"},drawer:{width:220,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:220,background:"#127475",transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},drawerClose:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:"0",background:"#ffffff"},toolbar:fy(fy({display:"contents",alignItems:"center",justifyContent:"center"},e.mixins.toolbar),{},{width:"90%"}),content:{background:"#f5f5f5",flexGrow:1,height:"auto",width:"100%"},grow:{flexGrow:1},navbarBrand:{display:"inline-block",paddingTop:"0.3125rem",paddingBottom:"0.3125rem",fontSize:"20px",lineHeight:"inherit",whiteSpace:"nowrap",fontWeight:600,color:"#fff !important",marginRight:"120px"},navUser:{padding:"0.5em 0.5em 0.5em 1.5em!important"},headerBarWraper:{width:"100%"},navToolBar:{textAlign:"center",position:"absolute",bottom:0,width:"100%",color:"#FFF"},navButton:{display:"flex",justifyContent:"space-between",alignItems:"center",height:"55px",fontSize:"1.125rem",padding:"0.5em 0.5em 0.5em 1.5em",textDecoration:"none",color:"#6778a0!important",transition:"0.2s",borderRadius:"2rem","&:hover":{color:"#fff!important",backgroundColor:"#3366ff",fontWeight:600}},navButtonLogout:{color:"#FFF!important",height:"50px",display:"flex",padding:"0.5em 0.5em 0.5em 1.5em",fontSize:"1.125rem",boxShadow:"0px -1px 0px rgb(195 186 186 / 35%)",transition:"0.2s",alignItems:"center",fontWeight:400,width:"100%",justifyContent:"flex-start",textDecoration:"none",borderRadius:0,"&:hover":{borderRadius:0,color:"#fff!important",backgroundColor:"#06535e",fontWeight:600,width:"100%"}},navButtonHorizontal:{fontSize:"3rem",right:0,marginRight:"10px",color:"#fff",borderRadius:"5px!important",padding:"1.5rem!important","&:hover":{backgroundColor:"#fff",color:"#3366FF!important",transaction:"0.2s"}},horizontalNavBar:{display:"flex",width:"71%",position:"sticky",zIndex:99},userSide:{right:0,color:"#fff"},tooltip:{fontSize:"20px"},chatpanel:{position:"absolute",top:"70px",right:"20px",overflow:"auto",zIndex:99,maxWidth:"350px",width:"100%",height:"calc(100vh - 100px)",background:"#fff",border:"1px solid #e4e4e4",borderRadius:"5px",boxShadow:"0 0 0.25rem rgb(0 0 0 / 8%) !important"},chatPopup:{position:"absolute",right:10,bottom:0,maxWidth:"350px",background:"#fff",border:"1px solid #e4e4e4",borderRadius:"5px",boxShadow:"0 0 0.25rem rgb(0 0 0 / 8%) !important"},userUl:{listStyle:"none",display:"flex",alignItems:"center",textAlign:"right"},sidebarLabel:{marginLeft:"0.8rem",fontWeight:400,fontSize:"15px",verticalAlign:"super"}}));function by(e){const{_roomView:t,onRegistered:a,threepidInvite:o,roomOobData:r,currentRoomId:l,resizeNotifier:c,roomJustCreatedOpts:d,justRegistered:m,collapseLhs:u,isMinimized:h,pageElement:p,roles:g}=e,f=vy(),v=Object(O.useTheme)(),b=Tu()(v.breakpoints.down("md")),[y,E]=Object(s.useState)(!0),[_,S]=Object(s.useState)(!1),[C,w]=Object(s.useState)(!1),[x,R]=Object(s.useState)(!1),[k,I]=Object(s.useState)(window.location.hash.slice(1));const T=Object(s.useRef)(null);var P;return P=T,Object(s.useEffect)(()=>{function e(e){P.current&&P.current.contains(e.target)&&E(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[P]),Object(s.useEffect)(()=>{E(!b)},[b]),Object(s.useEffect)(()=>{w(!0),R(!1)},[p]),i.a.createElement("div",{className:f.root},i.a.createElement(vr.a,{position:"fixed",className:f.appBar}),b&&i.a.createElement(Km.a,{onMouseEnter:()=>_?E(!0):null,onMouseLeave:()=>_?E(!1):null,variant:"permanent",className:`${Hn()(f.drawer,{[f.drawerOpen]:y,[f.drawerClose]:!y})} menu-wraper ${y?"expanse":""}`,classes:{paper:Hn()({[f.drawerOpen]:y,[f.drawerClose]:!y})},open:y},i.a.createElement("div",{className:f.toolbar},i.a.createElement("div",{className:f.navbarBrand})),i.a.createElement("div",null,i.a.createElement("div",{className:" mx_LeftPanel_userHeader"},i.a.createElement(_u,{isMinimized:u})),null==Lm?void 0:Lm.map((e,t)=>{for(let a=0;a<g.length;a++){const n=g[a];if(null==e.auth)return i.a.createElement(Vm,{item:e,key:t,selectedIndex:k,setSelectedIndex:I,handleExpanse:b?E:null,sideBarOpenStatus:y,roles:g});if(n.some(t=>-1!==e.auth.indexOf(t)))return i.a.createElement(Vm,{item:e,key:t,selectedIndex:k,setSelectedIndex:I,handleExpanse:b?E:null,sideBarOpenStatus:y,roles:g})}})),i.a.createElement("div",{className:f.navToolBar},i.a.createElement(Jm.a,{className:f.navButtonLogout+" nav-item ",size:"medium",onClick:()=>{gn.a.dispatch({action:"logout"})}},i.a.createElement(eu.a,{fontSize:"large",color:"inherit"}),y&&i.a.createElement("span",{className:f.sidebarLabel},"Đăng xuất"))),i.a.createElement("div",{ref:b?T:null,className:"menu-cover"})),i.a.createElement("main",{className:`${f.headerBarWraper} ${y?"nav-header-mobile":""} `},i.a.createElement(Ce.ToastContainer,null),i.a.createElement("div",{className:f.headerBar},i.a.createElement(Ym.a,{disableGutters:!0,className:"justify-space-between color-horizontal-navbar"},i.a.createElement("div",null,b&&i.a.createElement(Jm.a,{color:"inherit","aria-label":"Open drawer",onClick:()=>{E(!y),S(!_)},className:f.menuButton},i.a.createElement(Xm.a,{className:"menu-mobile",classes:{root:y?f.menuButtonIconOpen:f.menuButtonIconClosed}}))),i.a.createElement("div",{className:f.navbarBrand+" nav-bar-Brand"},i.a.createElement("div",null,i.a.createElement("img",{src:"themes/element/img/backgrounds/logoIcare.png",alt:""}))),i.a.createElement("div",null,b&&i.a.createElement(py,{classes:f})),i.a.createElement("div",{className:f.toolbar},!b&&i.a.createElement("div",{className:f.horizontalNavBar},Lm.map((e,t)=>{for(let a=0;a<g.length;a++){const n=g[a];if(null==e.auth)return i.a.createElement(Wm,{item:e,key:t,selectedIndex:k,setSelectedIndex:I,roles:g,isMoblie:b});if(n.some(t=>-1!==e.auth.indexOf(t)))return i.a.createElement(Wm,{item:e,key:t,selectedIndex:k,setSelectedIndex:I,roles:g,isMoblie:b})}}))),!b&&i.a.createElement("div",{className:f.userSide+" mx_LeftPanel_userHeader"},i.a.createElement("div",{className:f.userUl},i.a.createElement(py,{classes:f}),i.a.createElement(ku,{isMinimized:u,size:15}))))),i.a.createElement("div",{className:f.content},i.a.createElement(n.Grid,{container:!0,spacing:2,style:{height:"100%"}},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(cy,{_roomView:t,onRegistered:a,threepidInvite:o,roomOobData:r,currentRoomId:l,resizeNotifier:c,roomJustCreatedOpts:d,justRegistered:m}))))))}const yy=["admin"],Ey=["user"],_y=["patient"],Sy=["practitioner"],Cy=["lab"],wy=["drugStore"],Oy=["clinic"],xy=["supportStaff"],Ry="ROLE_ADMIN",ky="ROLE_PATIENT",Iy="ROLE_USER",Ty="ROLE_DRUG_STORE",Py="ROLE_LAB",Ny="ROLE_PRACTITIONER",Dy="ROLE_CLINIC",jy="ROLE_SUPPORT_STAFF";var Ay,My;const Uy=Object(O.createTheme)({typography:{fontFamily:["SVN-Poppins","Sans-Serif"].join(",")}});function Ly(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||!!e.getAttribute("contenteditable")}var Fy,By,Vy=Object(os.a)("structures.GlobitsLoggedInView")((My=class extends s.Component{constructor(e,t){super(e,t),Fe()(this,"_matrixClient",void 0),Fe()(this,"_roomView",void 0),Fe()(this,"_resizeContainer",void 0),Fe()(this,"compactLayoutWatcherRef",void 0),Fe()(this,"resizer",void 0),Fe()(this,"onCallsChanged",()=>{this.setState({activeCalls:Vs.d.sharedInstance().getAllActiveCalls()})}),Fe()(this,"canResetTimelineInRoom",e=>!this._roomView.current||this._roomView.current.canResetTimeline()),Fe()(this,"onAccountData",e=>{"m.ignored_user_list"===e.getType()&&gn.a.dispatch({action:"ignore_state_changed"})}),Fe()(this,"onCompactLayoutChanged",(e,t,a,n,s)=>{this.setState({useCompactLayout:n})}),Fe()(this,"onSync",(e,t,a)=>{const n=this.state.syncErrorData&&this.state.syncErrorData.error&&this.state.syncErrorData.error.errcode,s=a&&a.error&&a.error.errcode;e===t&&n===s||("ERROR"===e?this.setState({syncErrorData:a}):this.setState({syncErrorData:null}),"PREPARED"===t&&"SYNCING"===e?this._updateServerNoticeEvents():this._calculateServerLimitToast(this.state.syncErrorData,this.state.usageLimitEventContent))}),Fe()(this,"onRoomStateEvents",(e,t)=>{const a=ys.b.instance.orderedLists[_s.a.ServerNotice];a&&a.some(t=>t.roomId===e.getRoomId())&&this._updateServerNoticeEvents()}),Fe()(this,"onUsageLimitDismissed",()=>{this.setState({usageLimitDismissed:!0})}),Fe()(this,"_updateServerNoticeEvents",async()=>{const e=ys.b.instance.orderedLists[_s.a.ServerNotice];if(!e)return[];const t=[];let a=0;for(const n of e){const e=n.currentState.getStateEvents("m.room.pinned_events","");if(!e||!e.getContent().pinned)continue;a=e.getTs();const s=e.getContent().pinned.slice(0,2);for(const e of s){const a=(await this._matrixClient.getEventTimeline(n.getUnfilteredTimelineSet(),e)).getEvents().find(t=>t.getId()===e);a&&t.push(a)}}if(a&&this.state.usageLimitEventTs>a)return;const n=t.find(e=>e&&"m.room.message"===e.getType()&&"m.server_notice.usage_limit_reached"===e.getContent().server_notice_type),s=n&&n.getContent();this._calculateServerLimitToast(this.state.syncErrorData,s),this.setState({usageLimitEventContent:s,usageLimitEventTs:a,usageLimitDismissed:!1})}),Fe()(this,"_onPaste",e=>{let t=!1,a=e.target;for(;!t&&a;)t=Ly(a),a=a.parentElement;t||gn.a.fire(js.a.FocusComposer,!0)}),Fe()(this,"_onReactKeyDown",e=>{this._onKeyDown(e)}),Fe()(this,"_onNativeKeyDown",e=>{e.target===document.body&&this._onKeyDown(e)}),Fe()(this,"_onKeyDown",e=>{let t=!1;switch(Object(Li.f)().getRoomAction(e)){case Li.d.ScrollUp:case Li.d.RoomScrollDown:case Li.d.JumpToFirstMessage:case Li.d.JumpToLatestMessage:this._onScrollKeyPressed(e),t=!0;break;case Li.d.FocusSearch:gn.a.dispatch({action:"focus_search"}),t=!0}if(t)return e.stopPropagation(),void e.preventDefault();switch(Object(Li.f)().getNavigationAction(e)){case Li.c.FocusRoomSearch:gn.a.dispatch({action:"focus_room_filter"}),t=!0;break;case Li.c.ToggleUserMenu:gn.a.fire(js.a.ToggleUserMenu),t=!0;break;case Li.c.ToggleShortCutDialog:xd.d(),t=!0;break;case Li.c.GoToHome:gn.a.dispatch({action:"view_home_page"}),qd.a.closeCurrentModal("homeKeyboardShortcut"),t=!0;break;case Li.c.ToggleRoomSidePanel:"room_view"!==this.props.page_type&&"group_view"!==this.props.page_type||(gn.a.dispatch({action:js.a.ToggleRightPanel,type:"room_view"===this.props.page_type?"room":"group"}),t=!0);break;case Li.c.SelectPrevRoom:gn.a.dispatch({action:js.a.ViewRoomDelta,delta:-1,unread:!1}),t=!0;break;case Li.c.SelectNextRoom:gn.a.dispatch({action:js.a.ViewRoomDelta,delta:1,unread:!1}),t=!0;break;case Li.c.SelectPrevUnreadRoom:gn.a.dispatch({action:js.a.ViewRoomDelta,delta:-1,unread:!0});break;case Li.c.SelectNextUnreadRoom:gn.a.dispatch({action:js.a.ViewRoomDelta,delta:1,unread:!0});break;default:t=Rd.a.get().onKeyDown(e)}if(t)return e.stopPropagation(),void e.preventDefault();if(!(e.key===vi.a.ALT||e.key===vi.a.CONTROL||e.key===vi.a.META||e.key===vi.a.SHIFT||e.altKey||e.ctrlKey||e.metaKey)){const t=e.target!==document.body&&(e.key===vi.a.SPACE||e.key===vi.a.ENTER);if(e.key===vi.a.CONTEXT_MENU)return;t||e.key===vi.a.TAB||Ly(e.target)||(gn.a.fire(js.a.FocusComposer,!0),e.stopPropagation())}}),Fe()(this,"_onScrollKeyPressed",e=>{this._roomView.current&&this._roomView.current.handleScrollKey(e)}),Fe()(this,"_onDragEnd",e=>{if(!e.destination)return;const t=e.destination.droppableId;if("tag-panel-droppable"===t){const t=e.draggableId.split(" ").pop();gn.a.dispatch(yd.moveTag(this._matrixClient,t,e.destination.index),!0)}else t.startsWith("room-sub-list-droppable_")&&this._onRoomTileEndDrag(e)}),Fe()(this,"_onRoomTileEndDrag",e=>{let t=e.destination.droppableId.split("_")[1],a=e.source.droppableId.split("_")[1];"undefined"===t&&(t=void 0),"undefined"===a&&(a=void 0);const n=e.draggableId.split("_")[1],s=e.source.index,i=e.destination.index;gn.a.dispatch(Ed.a.tagRoom(this._matrixClient,this._matrixClient.getRoom(n),a,t,s,i),!0)}),this.state={syncErrorData:void 0,useCompactLayout:ss.b.getValue("useCompactLayout"),usageLimitDismissed:!1,activeCalls:[],roles:[]},this._matrixClient=this.props.matrixClient,pd.a.loadDevices(),vd(),this._roomView=s.createRef(),this._resizeContainer=s.createRef()}async componentDidMount(){document.addEventListener("keydown",this._onNativeKeyDown,!1),Vs.d.sharedInstance().addListener(Vs.a.CallsChanged,this.onCallsChanged),this._updateServerNoticeEvents(),this._matrixClient.on("accountData",this.onAccountData),this.onSync(this._matrixClient.getSyncState(),null,this._matrixClient.getSyncStateData()),this._matrixClient.on("RoomState.events",this.onRoomStateEvents),this.compactLayoutWatcherRef=ss.b.watchSetting("useCompactLayout",null,this.onCompactLayoutChanged),this.resizer=this._createResizer(),this.resizer.attach();let e=[],t={};await Ot.getAllInfoByUserLogin().then(a=>{let{data:n}=a;n&&(n.admin&&(t[Ry]=!0,e.push(yy)),n.user&&(t[Iy]=!0,e.push(Ey)),n.patient&&(t[ky]=!0,e.push(_y)),n.practitioner&&(t[Ny]=!0,e.push(Sy)),n.drugStore&&(t[Ty]=!0,e.push(wy)),n.lab&&(t[Py]=!0,e.push(Cy)),n.clinic&&(t[Dy]=!0,e.push(Oy)),n.supportStaff&&(t[jy]=!0,e.push(xy)))}),localStorage.setItem("userRoles",JSON.stringify(t)),this.setState({roles:e})}componentWillUnmount(){document.removeEventListener("keydown",this._onNativeKeyDown,!1),Vs.d.sharedInstance().removeListener(Vs.a.CallsChanged,this.onCallsChanged),this._matrixClient.removeListener("accountData",this.onAccountData),this._matrixClient.removeListener("sync",this.onSync),this._matrixClient.removeListener("RoomState.events",this.onRoomStateEvents),ss.b.unwatchSetting(this.compactLayoutWatcherRef),this.resizer.detach()}_createResizer(){let e,t;const a={toggleSize:156,onCollapsed:e=>{t=e,e?(gn.a.dispatch({action:"hide_left_panel"}),window.localStorage.setItem("mx_lhs_size","0")):gn.a.dispatch({action:"show_left_panel"})},onResized:t=>{e=t,this.props.resizeNotifier.notifyLeftHandleResized()},onResizeStart:()=>{this.props.resizeNotifier.startResizing()},onResizeStop:()=>{t||window.localStorage.setItem("mx_lhs_size",""+e),this.props.resizeNotifier.stopResizing()},isItemCollapsed:e=>e.classList.contains("mx_LeftPanel_minimized")},n=new Od.a(this._resizeContainer.current,wd,a);return n.setClassNames({handle:"mx_ResizeHandle",vertical:"mx_ResizeHandle_vertical",reverse:"mx_ResizeHandle_reverse"}),n}_calculateServerLimitToast(e,t){const a=e&&e.error&&"M_RESOURCE_LIMIT_EXCEEDED"===e.error.errcode;a&&(t=e.error.data),t&&this.state.usageLimitDismissed?Pd(t.limit_type,this.onUsageLimitDismissed,t.admin_contact):Nd()}render(){On.getComponent("structures.UserView");let e="mx_MatrixChat";this.state.useCompactLayout&&(e+=" mx_MatrixChat_useCompactLayout");const t=this.state.activeCalls.map(e=>s.createElement(Pm,{call:e,key:e.callId}));return s.createElement(O.ThemeProvider,{theme:Uy},s.createElement(ns.a.Provider,{value:this._matrixClient},s.createElement("div",{onPaste:this._onPaste,onKeyDown:this._onReactKeyDown,className:"mx_MatrixChat_wrapper","aria-hidden":this.props.hideToSRUsers},s.createElement(as.DragDropContext,{onDragEnd:this._onDragEnd},s.createElement("div",{ref:this._resizeContainer,className:e},ss.b.getValue("feature_spaces")?s.createElement(Rm,null):null,s.createElement(Fm.HashRouter,null,s.createElement(by,{_roomView:this._roomView,onRegistered:this.props.onRegistered,threepidInvite:this.props.threepidInvite,roomOobData:this.props.roomOobData,currentRoomId:this.props.currentRoomId,resizeNotifier:this.props.resizeNotifier,roomJustCreatedOpts:this.props.roomJustCreatedOpts,justRegistered:this.props.justRegistered,collapseLhs:this.props.collapseLhs,isMinimized:this.props.collapseLhs||!1,pageElement:void 0,roles:this.state.roles}))))),s.createElement(Kd,null),s.createElement(em,null),t))}},Fe()(My,"displayName","GlobitsLoggedInView"),Fe()(My,"propTypes",{matrixClient:jt.instanceOf(hd.b).isRequired,page_type:jt.string.isRequired,onRoomCreated:jt.func,onRegistered:jt.func}),Ay=My))||Ay,Gy=a(225),zy=a(331),Wy=a(257),Hy=(a(1380),a(1381),a(1382)),Ky=a(301),qy=a(369),Yy=a(298),$y=a(573),Jy=a(427),Qy=(a(1383),a(1384)),Xy=a(595),Zy=a(822),eE=a(823),tE=a(382),aE=a(185),nE=a(494),sE=a(824),iE=a(745),oE=a(211),rE=a(504),lE=a(1385),cE=a(421),dE=a(295),mE=a(825),uE=a(827),hE=a(828),pE=a(1386),gE=a(338),fE=a(1546);function vE(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}let bE;!function(e){e[e.LOADING=0]="LOADING",e[e.WELCOME=1]="WELCOME",e[e.LOGIN=2]="LOGIN",e[e.REGISTER=3]="REGISTER",e[e.FORGOT_PASSWORD=4]="FORGOT_PASSWORD",e[e.COMPLETE_SECURITY=5]="COMPLETE_SECURITY",e[e.E2E_SETUP=6]="E2E_SETUP",e[e.LOGGED_IN=7]="LOGGED_IN",e[e.SOFT_LOGOUT=8]="SOFT_LOGOUT"}(bE||(bE={}));const yE=["register","login","forgot_password","start_sso","start_cas"],EE=[js.a.ViewUserSettings,"view_create_chat","view_create_room","view_create_group"];let _E=Object(os.a)("structures.GlobitsMatrixChat")((By=class extends i.a.PureComponent{constructor(e,t){if(super(e,t),Fe()(this,"firstSyncComplete",void 0),Fe()(this,"firstSyncPromise",void 0),Fe()(this,"screenAfterLogin",void 0),Fe()(this,"pageChanging",void 0),Fe()(this,"tokenLogin",void 0),Fe()(this,"accountPassword",void 0),Fe()(this,"accountPasswordTimer",void 0),Fe()(this,"focusComposer",void 0),Fe()(this,"subTitleStatus",void 0),Fe()(this,"prevWindowWidth",void 0),Fe()(this,"loggedInView",void 0),Fe()(this,"dispatcherRef",void 0),Fe()(this,"themeWatcher",void 0),Fe()(this,"fontWatcher",void 0),Fe()(this,"onAction",e=>{const t=On.getComponent("dialogs.QuestionDialog");if(Cs.a.get()&&Cs.a.get().isGuest()&&EE.includes(e.action))return gn.a.dispatch({action:"do_after_sync_prepared",deferred_action:e}),void gn.a.dispatch({action:"require_registration"});switch(e.action){case"MatrixActions.accountData":if("m.identity_server"===e.event_type){const t=e.event_content?e.event_content.base_url:null;t?(Cs.a.get().setIdentityServerUrl(t),localStorage.removeItem("mx_is_access_token"),localStorage.setItem("mx_is_url",t)):(Cs.a.get().setIdentityServerUrl(null),localStorage.removeItem("mx_is_access_token"),localStorage.removeItem("mx_is_url")),gn.a.dispatch({action:"id_server_changed"})}break;case"logout":gn.a.dispatch({action:"hangup_all"}),Jy.d(y.a.API_ENPOINT+"/oauth/logout");break;case"require_registration":Object(Zy.b)(e);break;case"start_registration":if(Jy.h()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.startRegistration(e.params||{});break;case"start_login":if(Jy.h()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.viewLogin();break;case"start_password_recovery":this.setStateForNewView({view:bE.FORGOT_PASSWORD}),this.notifyNewScreen("forgot_password");break;case"start_chat":Object(nm.d)({dmUserId:e.user_id});break;case"leave_room":this.leaveRoom(e.room_id);break;case"forget_room":this.forgetRoom(e.room_id);break;case"reject_invite":qd.a.createTrackedDialog("Reject invitation","",t,{title:Object(ts.a)("Reject invitation"),description:Object(ts.a)("Are you sure you want to reject the invitation?"),onFinished:t=>{if(t){const t=On.getComponent("elements.Spinner"),a=qd.a.createDialog(t,null,"mx_Dialog_spinner");Cs.a.get().leave(e.room_id).then(()=>{a.close(),this.state.currentRoomId===e.room_id&&gn.a.dispatch({action:"view_home_page"})},e=>{a.close(),qd.a.createTrackedDialog("Failed to reject invitation","",uu.a,{title:Object(ts.a)("Failed to reject invitation"),description:e.toString()})})}}});break;case"view_user_info":this.viewUser(e.userId,e.subAction);break;case"view_room":{const t=this.viewRoom(e);e.deferred_action&&t.then(()=>{});break}case"view_create_room":this.createRoom(e.public,e.defaultName);break;case"view_create_group":{let e=On.getComponent("dialogs.CreateGroupDialog");ss.b.getValue("feature_communities_v2_prototypes")&&(e=mE.a),qd.a.createTrackedDialog("Create Community","",e);break}case"view_my_groups":this.setPage(Qy.a.MyGroups),this.notifyNewScreen("groups");break;case"view_group":this.viewGroup(e);break;case"view_login_page":this.viewLogin();break;case"view_home_page":this.viewHome(e.justRegistered);break;case"view_start_chat_or_reuse":this.chatCreateOrReuse(e.user_id);break;case"view_create_chat":Object(mu.h)(e.initialText||"");break;case"view_invite":Object(mu.g)(e.roomId);break;case"view_last_screen":this.showScreenAfterLogin();break;case"toggle_my_groups":localStorage.setItem("mx_seenSpacesBeta","1"),this.state.page_type===Qy.a.MyGroups?gn.a.dispatch({action:"view_last_screen"}):gn.a.dispatch({action:"view_my_groups"});break;case"hide_left_panel":this.setState({collapseLhs:!0},()=>{this.state.resizeNotifier.notifyLeftHandleResized()});break;case"focus_room_filter":case"show_left_panel":this.setState({collapseLhs:!1},()=>{this.state.resizeNotifier.notifyLeftHandleResized()});break;case js.a.OpenDialPad:qd.a.createTrackedDialog("Dial pad","",hE.a,{},"mx_Dialog_dialPadWrapper");break;case"on_logged_in":this.tokenLogin||Jy.h()||this.state.view===bE.LOGIN||this.state.view===bE.REGISTER||this.state.view===bE.COMPLETE_SECURITY||this.state.view===bE.E2E_SETUP||this.onLoggedIn();break;case"on_client_not_viable":this.onSoftLogout();break;case"on_logged_out":this.onLoggedOut();break;case"will_start_client":this.setState({ready:!1},()=>{this.onWillStartClient()});break;case"client_started":this.onClientStarted();break;case"send_event":this.onSendEvent(e.room_id,e.event);break;case"aria_hide_main_app":this.setState({hideToSRUsers:!0});break;case"aria_unhide_main_app":this.setState({hideToSRUsers:!1});break;case"accept_cookies":ss.b.setValue("analyticsOptIn",null,mi.a.DEVICE,!0),ss.b.setValue("showCookieBar",null,mi.a.DEVICE,!1),Object(lE.a)(),pi.a.canEnable()&&pi.a.enable(),Xc.a.instance.canEnable()&&Xc.a.instance.enable(!1);break;case"reject_cookies":ss.b.setValue("analyticsOptIn",null,mi.a.DEVICE,!1),ss.b.setValue("showCookieBar",null,mi.a.DEVICE,!1),Object(lE.a)()}}),Fe()(this,"handleResize",()=>{const e=Ai.b.instance.windowWidth;this.prevWindowWidth<1e3&&e>=1e3&&gn.a.dispatch({action:"show_left_panel"}),this.prevWindowWidth>=1e3&&e<1e3&&gn.a.dispatch({action:"hide_left_panel"}),this.prevWindowWidth=e,this.state.resizeNotifier.notifyWindowResized()}),Fe()(this,"onRegisterClick",()=>{this.showScreen("register")}),Fe()(this,"onLoginClick",()=>{this.showScreen("login")}),Fe()(this,"onForgotPasswordClick",()=>{this.showScreen("forgot_password")}),Fe()(this,"onRegisterFlowComplete",(e,t)=>this.onUserCompletedLoginFlow(e,t)),Fe()(this,"onServerConfigChange",e=>{this.setState({serverConfig:e})}),Fe()(this,"makeRegistrationUrl",e=>(this.props.startingFragmentQueryParams.referrer&&(e.referrer=this.props.startingFragmentQueryParams.referrer),this.props.makeRegistrationUrl(e))),Fe()(this,"onUserCompletedLoginFlow",async(e,t)=>{this.accountPassword=t,null!==this.accountPasswordTimer&&clearTimeout(this.accountPasswordTimer),this.accountPasswordTimer=setTimeout(()=>{this.accountPassword=null,this.accountPasswordTimer=null},3e5),await Jy.l(e),await this.postLoginSetup(),fE.b.instance.stop(fE.a.LOGIN),fE.b.instance.stop(fE.a.REGISTER)}),Fe()(this,"onCompleteSecurityE2eSetupFinished",()=>{this.onLoggedIn()}),this.state={view:bE.LOADING,collapseLhs:!1,hideToSRUsers:!1,syncError:null,resizeNotifier:new eE.a,ready:!1,roles:[]},this.loggedInView=Object(s.createRef)(),$c.a.put(this.props.config),this.firstSyncComplete=!1,this.firstSyncPromise=Object(oE.a)(),this.props.config.sync_timeline_limit&&(Cs.a.opts.initialSyncLimit=this.props.config.sync_timeline_limit),this.screenAfterLogin=this.props.initialScreenAfterLogin,this.screenAfterLogin){const e=this.screenAfterLogin.params||{};if(this.screenAfterLogin.screen.startsWith("room/")&&e.signurl&&e.email){const t=this.screenAfterLogin.screen.substring("room/".length);uE.a.instance.storeInvite(t,e)}}this.prevWindowWidth=Ai.b.instance.windowWidth||1e3,Ai.b.instance.on(Ai.a.Resize,this.handleResize),this.pageChanging=!1,qy.a.tint(),this.state.resizeNotifier.on("middlePanelResized",this.dispatchTimelineResize),Jy.h()&&Jy.i(),this.accountPassword=null,this.accountPasswordTimer=null,this.dispatcherRef=gn.a.register(this.onAction),this.themeWatcher=new nE.a,this.fontWatcher=new sE.a,this.themeWatcher.start(),this.fontWatcher.start(),this.focusComposer=!1,this.subTitleStatus="",this.onAliasClick&&($y.a.onAliasClick=this.onAliasClick),this.onUserClick&&($y.a.onUserClick=this.onUserClick),this.onGroupClick&&($y.a.onGroupClick=this.onGroupClick),Jy.h()||Jy.a(this.props.realQueryParams,this.props.defaultDeviceDisplayName,this.getFragmentAfterLogin()).then(async e=>{var t;if(null!==(t=this.props.realQueryParams)&&void 0!==t&&t.loginToken&&this.props.onTokenLoginCompleted(),e)return this.tokenLogin=!0,await Jy.k({ignoreGuest:!0}),this.postLoginSetup();const a=this.screenAfterLogin?this.screenAfterLogin.screen:null;if("login"!==a&&"register"!==a&&"forgot_password"!==a)return this.loadSession();this.showScreenAfterLogin()}),ss.b.getValue("analyticsOptIn")&&pi.a.enable(),Xc.a.instance.enable(!0)}async postLoginSetup(){const e=Cs.a.get(),t=e.isCryptoEnabled();t||this.onLoggedIn();const a=[this.firstSyncPromise.promise];if(t&&a.push(e.downloadKeys([e.getUserId()])),this.setState({pendingInitialSync:!0}),await Promise.all(a),!t)return void this.setState({pendingInitialSync:!1});e.getStoredCrossSigningForUser(e.getUserId())?!1===gE.a.SHOW_ENCRYPTION_SETUP_UI?this.onLoggedIn():this.setStateForNewView({view:bE.COMPLETE_SECURITY}):await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing")?this.setStateForNewView({view:bE.E2E_SETUP}):this.onLoggedIn(),this.setState({pendingInitialSync:!1})}UNSAFE_componentWillUpdate(e,t){this.shouldTrackPageChange(this.state,t)&&this.startPageChangeTimer()}componentDidUpdate(e,t){if(this.shouldTrackPageChange(t,this.state)){const e=this.stopPageChangeTimer();pi.a.trackPageChange(e),Xc.a.instance.trackPageChange(e)}this.focusComposer&&(gn.a.fire(js.a.FocusComposer),this.focusComposer=!1)}componentWillUnmount(){Jy.n(),gn.a.unregister(this.dispatcherRef),this.themeWatcher.stop(),this.fontWatcher.stop(),Ai.b.destroy(),this.state.resizeNotifier.removeListener("middlePanelResized",this.dispatchTimelineResize),null!==this.accountPasswordTimer&&clearTimeout(this.accountPasswordTimer)}getFallbackHsUrl(){return this.props.serverConfig&&this.props.serverConfig.isDefault?this.props.config.fallback_hs_url:null}getServerProperties(){let e=this.state.serverConfig;return e||(e=this.props.serverConfig),e||(e=$c.a.get().validated_server_config),{serverConfig:e}}loadSession(){return Promise.resolve().then(()=>Jy.i({fragmentQueryParams:this.props.startingFragmentQueryParams,enableGuest:this.props.enableGuest,guestHsUrl:this.getServerProperties().serverConfig.hsUrl,guestIsUrl:this.getServerProperties().serverConfig.isUrl,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName})).then(e=>{e?ss.b.getValue("analyticsOptIn")&&Xc.a.instance.enable(!1):uE.a.instance.pickBestInvite()?gn.a.dispatch({action:"start_registration"}):gn.a.dispatch({action:"view_login_page"})})}startPageChangeTimer(){fE.b.instance.start(fE.a.PAGE_CHANGE)}stopPageChangeTimer(){const e=fE.b.instance;e.stop(fE.a.PAGE_CHANGE);const t=e.getEntries({name:fE.a.PAGE_CHANGE}).pop();return t?t.duration:null}shouldTrackPageChange(e,t){return e.currentRoomId!==t.currentRoomId||e.view!==t.view||e.page_type!==t.page_type}setStateForNewView(e){if(void 0===e.view)throw new Error("setStateForNewView with no view!");const t={currentUserId:null,justRegistered:!1};Object.assign(t,e),this.setState(t)}setPage(e){this.setState({page_type:e})}async startRegistration(e){const t={view:bE.REGISTER};e.client_secret&&e.session_id&&e.hs_url&&e.is_url&&e.sid&&(t.serverConfig=await tE.b.validateServerConfigWithStaticUrls(e.hs_url,e.is_url),t.register_client_secret=e.client_secret,t.register_session_id=e.session_id,t.register_id_sid=e.sid),this.setStateForNewView(t),Xy.a.isLogin=!0,this.themeWatcher.recheck(),this.notifyNewScreen("register")}viewRoom(e){this.focusComposer=!0,e.room_alias?console.log(`Switching to room alias ${e.room_alias} at event `+e.event_id):console.log(`Switching to room id ${e.room_id} at event `+e.event_id);let t=Promise.resolve(null);if(!this.firstSyncComplete){if(!this.firstSyncPromise)return void console.warn("Cannot view a room before first sync. room_id:",e.room_id);t=this.firstSyncPromise.promise}return t.then(()=>{let t=e.room_alias||e.room_id;const a=Cs.a.get().getRoom(e.room_id);if(a){a.decryptAllEvents();const e=Yy.a(a);e&&(t=e,Object(iE.b)(e,a.roomId)),localStorage&&localStorage.setItem("mx_last_room_id",a.roomId)}"#"===t[0]&&(e.room_id,this.state.currentRoomId);e.event_id&&e.highlighted&&(t+="/"+e.event_id),this.setState({view:bE.LOGGED_IN,currentRoomId:e.room_id||null,page_type:Qy.a.RoomView,threepidInvite:e.threepid_invite,roomOobData:e.oob_data,ready:!0,roomJustCreatedOpts:e.justCreatedOpts},()=>{})})}async viewGroup(e){const t=e.group_id;if(!this.firstSyncComplete){if(!this.firstSyncPromise)return void console.warn("Cannot view a group before first sync. group_id:",t);await this.firstSyncPromise.promise}this.setState({view:bE.LOGGED_IN,currentGroupId:t,currentGroupIsNew:e.group_is_new}),this.setPage(Qy.a.GroupView),this.notifyNewScreen("group/"+t)}viewLogin(e){this.setStateForNewView(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?vE(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):vE(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({view:bE.LOGIN},e)),this.notifyNewScreen("login"),Xy.a.isLogin=!0,this.themeWatcher.recheck()}viewHome(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setStateForNewView({view:bE.LOGGED_IN,justRegistered:e}),this.setPage(Qy.a.HomePage),this.notifyNewScreen("home"),Xy.a.isLogin=!1,this.themeWatcher.recheck()}viewListPage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setStateForNewView({view:bE.LOGGED_IN,justRegistered:e}),this.setPage(Qy.a.ListPage),this.notifyNewScreen("listpage"),Xy.a.isLogin=!1,this.themeWatcher.recheck()}viewPage(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setStateForNewView({view:bE.LOGGED_IN,justRegistered:t}),this.setPage(e),this.notifyNewScreen(e),Xy.a.isLogin=!1,this.themeWatcher.recheck()}viewUser(e,t){(this.firstSyncPromise?this.firstSyncPromise.promise:Promise.resolve()).then(()=>{"chat"!==t?(this.notifyNewScreen("user/"+e),this.setState({currentUserId:e}),this.setPage(Qy.a.UserView)):this.chatCreateOrReuse(e)})}async createRoom(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;const a=Bs.a.instance.getSelectedCommunityId();if(a&&!Bs.a.instance.isAdminOf(a))return void qd.a.createTrackedDialog("Pre-failure to create room","",uu.a,{title:Object(ts.a)("Cannot create rooms in this community"),description:Object(ts.a)("You do not have permission to create rooms in this community.")});const n=On.getComponent("dialogs.CreateRoomDialog"),s=qd.a.createTrackedDialog("Create Room","",n,{defaultPublic:e,defaultName:t}),[i,o]=await s.finished;i&&Object(nm.d)(o)}chatCreateOrReuse(e){if(Cs.a.get().isGuest())return e!==this.props.config.welcomeUserId&&gn.a.dispatch({action:"do_after_sync_prepared",deferred_action:{action:"view_start_chat_or_reuse",user_id:e}}),void gn.a.dispatch({action:"require_registration",go_welcome_on_cancel:!0,screen_after:{screen:"user/"+this.props.config.welcomeUserId,params:{action:"chat"}}});const t=Cs.a.get(),a=new aE.a(t).getDMRoomsForUserId(e);a.length>0?gn.a.dispatch({action:"view_room",room_id:a[0]}):gn.a.dispatch({action:"start_chat",user_id:e})}leaveRoomWarnings(e){const t=Cs.a.get().getRoom(e),a=ss.b.getValue("feature_spaces")&&(null==t?void 0:t.isSpaceRoom()),n=[];if(1===t.currentState.getJoinedMemberCount())return n.push(i.a.createElement("span",{className:"warning",key:"only_member_warning"}," ",Object(ts.a)("You are the only person here. If you leave, no one will be able to join in the future, including you."))),n;const s=t.currentState.getStateEvents("m.room.join_rules","");if(s){"public"!==s.getContent().join_rule&&n.push(i.a.createElement("span",{className:"warning",key:"non_public_warning"}," ",a?Object(ts.a)("This space is not public. You will not be able to rejoin without an invite."):Object(ts.a)("This room is not public. You will not be able to rejoin without an invite.")))}return n}leaveRoom(e){const t=On.getComponent("dialogs.QuestionDialog"),a=Cs.a.get().getRoom(e),n=this.leaveRoomWarnings(e),s=ss.b.getValue("feature_spaces")&&(null==a?void 0:a.isSpaceRoom());qd.a.createTrackedDialog(s?"Leave space":"Leave room","",t,{title:s?Object(ts.a)("Leave space"):Object(ts.a)("Leave room"),description:i.a.createElement("span",null,s?Object(ts.a)("Are you sure you want to leave the space '%(spaceName)s'?",{spaceName:a.name}):Object(ts.a)("Are you sure you want to leave the room '%(roomName)s'?",{roomName:a.name}),n),button:Object(ts.a)("Leave"),onFinished:t=>{if(t){const t=Object(dE.d)(e),a=On.getComponent("elements.Spinner"),n=qd.a.createDialog(a,null,"mx_Dialog_spinner");t.finally(()=>n.close()),gn.a.dispatch({action:"after_leave_room",room_id:e})}}})}forgetRoom(e){const t=Cs.a.get().getRoom(e);Cs.a.get().forget(e).then(()=>{this.state.currentRoomId===e&&gn.a.dispatch({action:"view_home_page"}),ys.b.instance.manualRoomUpdate(t,_s.c.RoomRemoved)}).catch(e=>{const t=e.errcode||Object(ts.b)("unknown error code");qd.a.createTrackedDialog("Failed to forget room","",uu.a,{title:Object(ts.a)("Failed to forget room %(errCode)s",{errCode:t}),description:e&&e.message?e.message:Object(ts.a)("Operation failed")})})}async startWelcomeUserChat(){let e;e=this.firstSyncComplete?Promise.resolve():this.firstSyncPromise.promise,await e;if(0===aE.a.shared().getDMRoomsForUserId(this.props.config.welcomeUserId).length){const e=await Object(nm.d)({dmUserId:this.props.config.welcomeUserId,andView:!this.state.currentRoomId,spinner:!1}),t=e=>{"m.direct"===e.getType()&&e.getContent()&&e.getContent()[this.props.config.welcomeUserId]&&(Cs.a.get().store.save(!0),Cs.a.get().removeListener("accountData",t))};return Cs.a.get().on("accountData",t),e}return null}async onLoggedIn(){if(Xy.a.isLogin=!1,this.themeWatcher.recheck(),this.setStateForNewView({view:bE.LOGGED_IN}),this.screenAfterLogin&&this.screenAfterLogin.screen)this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=null;else if(Cs.a.currentUserIsJustRegistered())if(Cs.a.setJustRegisteredUserId(null),this.props.config.welcomeUserId&&Object(ts.d)().startsWith("en")){null===await this.startWelcomeUserChat()&&gn.a.dispatch({action:"view_home_page",justRegistered:!0})}else if(uE.a.instance.pickBestInvite()){const e=uE.a.instance.pickBestInvite(),t=uE.a.instance.translateToWireFormat(e);this.showScreen("room/"+e.roomId,t)}else gn.a.dispatch({action:"view_home_page",justRegistered:!0});else this.showScreenAfterLogin();var e;(rE.g(),await Object(oE.c)(30),ss.b.getValue("showCookieBar")&&(pi.a.canEnable()||Xc.a.instance.canEnable()))&&Object(lE.b)(null===(e=this.props.config.piwik)||void 0===e?void 0:e.policyUrl);$c.a.get().mobileGuideToast&&Object(pE.a)()}showScreenAfterLogin(){this.screenAfterLogin&&this.screenAfterLogin.screen?(this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=null):Cs.a.get().isGuest()?gn.a.dispatch({action:"view_login_page"}):Ot.getAllInfoByUserLogin().then(e=>{let{data:t}=e;t&&(t.admin||t.practitioner||t.clinic||t.lab||t.drugStore||t.supportStaff?t.drugStore?this.viewPage("drug-management"):t.lab?this.viewPage("request-labtest"):t.supportStaff?this.viewPage("customer-support"):gn.a.dispatch({action:"view_home_page"}):(Object(Ce.toast)("Bạn không có quyền truy cập!"),gn.a.dispatch({action:"logout"})))})}viewLastRoom(){gn.a.dispatch({action:"view_room",room_id:localStorage.getItem("mx_last_room_id")})}onLoggedOut(){this.viewLogin({ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle()}onSoftLogout(){this.notifyNewScreen("soft_logout"),this.setStateForNewView({view:bE.SOFT_LOGOUT,ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle()}onWillStartClient(){this.firstSyncComplete=!1,this.firstSyncPromise=Object(oE.a)();const e=Cs.a.get();e.setCanResetTimelineCallback(e=>(console.log("Request to reset timeline in room ",e," viewing:",this.state.currentRoomId),e!==this.state.currentRoomId||(!this.loggedInView.current||this.loggedInView.current.canResetTimelineInRoom(e)))),e.on("sync",(e,t,a)=>{gn.a.dispatch({action:"sync_state",prevState:t,state:e}),"ERROR"===e||"RECONNECTING"===e?(a.error instanceof zy.b&&Jy.e(a.error),this.setState({syncError:a.error||!0})):this.state.syncError&&this.setState({syncError:null}),this.updateStatusIndicator(e,t),"SYNCING"===e&&"SYNCING"===t||(console.info("MatrixClient sync state => %s",e),"PREPARED"===e&&(this.firstSyncComplete=!0,this.firstSyncPromise.resolve(),Ky.default.shouldShowPrompt()&&!Cs.a.userRegisteredWithinLastHours(24)&&Object(cE.b)(!1),gn.a.fire(js.a.FocusComposer),this.setState({ready:!0})))}),e.on("Session.logged_out",(function(e){if(!Jy.g()){if(qd.a.closeCurrentModal("Session.logged_out"),401===e.httpStatus&&e.data&&e.data.soft_logout)return console.warn("Soft logout issued by server - avoiding data deletion"),void Jy.m();qd.a.createTrackedDialog("Signed out","",uu.a,{title:Object(ts.a)("Signed Out"),description:Object(ts.a)("For security, this session has been signed out. Please sign in again.")}),gn.a.dispatch({action:"logout"})}})),e.on("no_consent",(function(t,a){const n=On.getComponent("dialogs.QuestionDialog");qd.a.createTrackedDialog("No Consent Dialog","",n,{title:Object(ts.a)("Terms and Conditions"),description:i.a.createElement("div",null,i.a.createElement("p",null," ",Object(ts.a)("To continue using the %(homeserverDomain)s homeserver you must review and agree to our terms and conditions.",{homeserverDomain:e.getDomain()}))),button:Object(ts.a)("Review terms and conditions"),cancelButton:Object(ts.a)("Dismiss"),onFinished:e=>{if(e){window.open(a,"_blank").opener=null}}},null,!0)}));const t=new Hy.a((e,t)=>{pi.a.trackEvent("E2E","Decryption failure",t,e),Xc.a.instance.track("decryption_failure",{errorCode:t},null,{sum:e})},e=>{switch(e){case"MEGOLM_UNKNOWN_INBOUND_SESSION_ID":return"olm_keys_not_sent_error";case"OLM_UNKNOWN_MESSAGE_INDEX":return"olm_index_error";case void 0:return"unexpected_error";default:return"unspecified_error"}});t.start(),e.on("Session.logged_out",()=>t.stop()),e.on("Event.decrypted",(e,a)=>t.eventDecrypted(e,a)),e.on("Room",e=>{if(Cs.a.get().isCryptoEnabled()){const t=ss.b.getValueAt(mi.a.ROOM_DEVICE,"blacklistUnverifiedDevices",e.roomId,!0);e.setBlacklistUnverifiedDevices(t)}}),e.on("crypto.warning",e=>{switch(e){case"CRYPTO_WARNING_OLD_VERSION_DETECTED":qd.a.createTrackedDialog("Crypto migrated","",uu.a,{title:Object(ts.a)("Old cryptography data detected"),description:Object(ts.a)("Data from an older version of %(brand)s has been detected. This will have caused end-to-end cryptography to malfunction in the older version. End-to-end encrypted messages exchanged recently whilst using the older version may not be decryptable in this version. This may also cause messages exchanged with this version to fail. If you experience problems, log out and back in again. To retain message history, export and re-import your keys.",{brand:$c.a.get().brand})})}}),e.on("crypto.keyBackupFailed",async e=>{let t,n;if(Cs.a.get().getKeyBackupEnabled())t=!0;else try{n=await Cs.a.get().getKeyBackupVersion(),null!==n&&(t=!0)}catch(e){return void console.error("Saw key backup error but failed to check backup version!",e)}t?qd.a.createTrackedDialogAsync("New Recovery Method","New Recovery Method",a.e(6).then(a.bind(null,8459)),{newVersionInfo:n}):qd.a.createTrackedDialogAsync("Recovery Method Removed","Recovery Method Removed",a.e(7).then(a.bind(null,8460)))}),e.on("crypto.keySignatureUploadFailure",(e,t,a)=>{const n=On.getComponent("views.dialogs.KeySignatureUploadFailedDialog");qd.a.createTrackedDialog("Failed to upload key signatures","Failed to upload key signatures",n,{failures:e,source:t,continuation:a})}),e.on("crypto.verification.request",e=>{if(e.verifier){const t=On.getComponent("views.dialogs.IncomingSasDialog");qd.a.createTrackedDialog("Incoming Verification","",t,{verifier:e.verifier},null,!1,!0)}else e.pending&&Id.a.sharedInstance().addOrReplaceToast({key:"verifreq_"+e.channel.transactionId,title:Object(ts.a)("Verification requested"),icon:"verification",props:{request:e},component:On.getComponent("toasts.VerificationRequestToast"),priority:90})});const n=ss.b.getValue("roomColor");qy.a.tint(n.primary_color,n.secondary_color)}onClientStarted(){const e=Cs.a.get();if(e.isCryptoEnabled()){const t=ss.b.getValueAt(mi.a.DEVICE,"blacklistUnverifiedDevices");e.setGlobalBlacklistUnverifiedDevices(t),e.setGlobalErrorOnUnknownDevices(!1)}}showScreen(e,t){const a=Cs.a.get();if(!a||a.isGuest()||!yE.includes(e))if("register"===e)gn.a.dispatch({action:"start_registration",params:t}),fE.b.instance.start(fE.a.REGISTER);else if("login"===e)gn.a.dispatch({action:"start_login",params:t}),fE.b.instance.start(fE.a.LOGIN);else if("forgot_password"===e)gn.a.dispatch({action:"start_password_recovery",params:t});else if("soft_logout"===e)a.getUserId()&&!Jy.h()?this.viewLastRoom():gn.a.dispatch({action:"start_login",params:t});else if("new"===e)gn.a.dispatch({action:"view_create_room"});else if("settings"===e)gn.a.fire(js.a.ViewUserSettings);else if("start"===e)this.showScreen("home"),gn.a.dispatch({action:"require_registration"});else if("directory"===e)this.state.view===bE.LOGIN&&Xc.a.instance.track("onboarding_room_directory"),gn.a.fire(js.a.ViewRoomDirectory);else if("start_sso"===e||"start_cas"===e){let t=Cs.a.get();if(!t){const{hsUrl:e,isUrl:a}=this.props.serverConfig;t=Object(Gy.createClient)({baseUrl:e,idBaseUrl:a})}const a="start_sso"===e?"sso":"cas";Rd.a.get().startSingleSignOn(t,a,this.getFragmentAfterLogin())}else if("groups"===e){if(ss.b.getValue("feature_spaces"))return void gn.a.dispatch({action:"view_home_page"});gn.a.dispatch({action:"view_my_groups"})}else if(0===e.indexOf("room/")){var n,s,i;const a=e.substring(5),o=a.indexOf(":")+1;let r=a.length;a.substring(o).indexOf("/")>-1&&(r=o+a.substring(o).indexOf("/"));const l=a.substring(0,r);let c,d=a.substring(r+1);if(d||(d=void 0),t.signurl&&t.email&&(c=uE.a.instance.storeInvite(l,t)),!c){c=uE.a.instance.getInvites().find(e=>e.roomId===l)}let m=[];t.via&&(m="string"==typeof t.via?[t.via]:t.via);const u={action:"view_room",event_id:d,via_servers:m,highlighted:Boolean(d),threepid_invite:c,oob_data:{name:null===(n=c)||void 0===n?void 0:n.roomName,avatarUrl:null===(s=c)||void 0===s?void 0:s.roomAvatarUrl,inviterName:null===(i=c)||void 0===i?void 0:i.inviterName},room_alias:void 0,room_id:void 0};"#"===l[0]?u.room_alias=l:u.room_id=l,gn.a.dispatch(u)}else if(0===e.indexOf("user/")){const a=e.substring(5);gn.a.dispatch({action:"view_user_info",userId:a,subAction:t.action})}else if(0===e.indexOf("group/")){if(ss.b.getValue("feature_spaces"))return void gn.a.dispatch({action:"view_home_page"});const t=e.substring(6);gn.a.dispatch({action:"view_group",group_id:t})}else this.viewPage(e);else gn.a.dispatch({action:"view_home_page"})}notifyNewScreen(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.props.onNewScreen&&this.props.onNewScreen(e,t),this.setPageSubtitle()}onAliasClick(e,t){e.preventDefault(),gn.a.dispatch({action:"view_room",room_alias:t})}onUserClick(e,t){e.preventDefault();const a=new Wy.a(null,t);a&&gn.a.dispatch({action:js.a.ViewUser,member:a})}onGroupClick(e,t){e.preventDefault(),gn.a.dispatch({action:"view_group",group_id:t})}onLogoutClick(e){gn.a.dispatch({action:"logout"}),e.stopPropagation(),e.preventDefault()}dispatchTimelineResize(){gn.a.dispatch({action:"timeline_resize"})}onRoomCreated(e){gn.a.dispatch({action:"view_room",room_id:e})}onRegistered(e){return Jy.l(e)}onSendEvent(e,t){const a=Cs.a.get();a?a.sendEvent(e,t.getType(),t.getContent()).then(()=>{gn.a.dispatch({action:"message_sent"})},e=>{gn.a.dispatch({action:"message_send_failed"})}):gn.a.dispatch({action:"message_send_failed"})}setPageSubtitle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.state.currentRoomId){const t=Cs.a.get(),a=t&&t.getRoom(this.state.currentRoomId);a&&(e=`${this.subTitleStatus} | ${a.name} ${e}`)}else e=`${this.subTitleStatus} ${e}`;const t=`${$c.a.get().brand} ${e}`;document.title!==t&&(document.title=t)}updateStatusIndicator(e,t){const a=As.a.instance.globalState.numUnreadStates;Rd.a.get()&&(Rd.a.get().setErrorStatus("ERROR"===e),Rd.a.get().setNotificationCount(a)),this.subTitleStatus="","ERROR"===e&&(this.subTitleStatus+=`[${Object(ts.a)("Offline")}] `),a>0&&(this.subTitleStatus+=`[${a}]`),this.setPageSubtitle()}onCloseAllSettings(){gn.a.dispatch({action:"close_settings"})}getFragmentAfterLogin(){let e="";const t=this.props.initialScreenAfterLogin;return t&&!["login","register","start_sso","start_cas"].includes(t.screen)&&(e="/"+t.screen),e}render(){const e=this.getFragmentAfterLogin();let t=null;if(this.state.view===bE.LOADING){const e=On.getComponent("elements.Spinner");t=i.a.createElement("div",{className:"mx_MatrixChat_splash"},i.a.createElement(e,null))}else if(this.state.view===bE.COMPLETE_SECURITY)gn.a.dispatch({action:"view_home_page"});else if(this.state.view===bE.E2E_SETUP){const e=On.getComponent("structures.auth.E2eSetup");t=i.a.createElement(e,{onFinished:this.onCompleteSecurityE2eSetupFinished,accountPassword:this.accountPassword,tokenLogin:!!this.tokenLogin})}else if(this.state.view===bE.LOGGED_IN){const e=this.state.syncError&&this.state.syncError instanceof zy.b;if(this.state.ready&&this.state.page_type&&!e){const e=On.getComponent("structures.GlobitsLoggedInView");t=i.a.createElement(e,u()({},this.props,this.state,{ref:this.loggedInView,matrixClient:Cs.a.get(),onRoomCreated:this.onRoomCreated,onCloseAllSettings:this.onCloseAllSettings,onRegistered:this.onRegistered,currentRoomId:this.state.currentRoomId}))}else{const a=On.getComponent("elements.Spinner");let n;this.state.syncError&&!e&&(n=i.a.createElement("div",{className:"mx_MatrixChat_syncError"},Object(Td.b)(this.state.syncError))),t=i.a.createElement("div",{className:"mx_MatrixChat_splash"},n,i.a.createElement(a,null),i.a.createElement("a",{href:"#",className:"mx_MatrixChat_splashButtons",onClick:this.onLogoutClick},Object(ts.a)("Logout")))}}else if(this.state.view===bE.REGISTER&&ss.b.getValue(vu.a.Registration)){var a;const n=On.getComponent("structures.auth.Registration"),s=null===(a=uE.a.instance.pickBestInvite())||void 0===a?void 0:a.toEmail;t=i.a.createElement(n,u()({clientSecret:this.state.register_client_secret,sessionId:this.state.register_session_id,idSid:this.state.register_id_sid,email:s,brand:this.props.config.brand,makeRegistrationUrl:this.makeRegistrationUrl,onLoggedIn:this.onRegisterFlowComplete,onLoginClick:this.onLoginClick,onServerConfigChange:this.onServerConfigChange,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,fragmentAfterLogin:e},this.getServerProperties()))}else if(this.state.view===bE.FORGOT_PASSWORD&&ss.b.getValue(vu.a.PasswordReset)){const e=On.getComponent("structures.auth.ForgotPassword");t=i.a.createElement(e,u()({onComplete:this.onLoginClick,onLoginClick:this.onLoginClick,onServerConfigChange:this.onServerConfigChange},this.getServerProperties()))}else if(this.state.view===bE.LOGIN){const a=ss.b.getValue(vu.a.PasswordReset),n=On.getComponent("structures.auth.Login");t=i.a.createElement(n,u()({isSyncing:this.state.pendingInitialSync,onLoggedIn:this.onUserCompletedLoginFlow,onRegisterClick:this.onRegisterClick,fallbackHsUrl:this.getFallbackHsUrl(),defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,onForgotPasswordClick:a?this.onForgotPasswordClick:void 0,onServerConfigChange:this.onServerConfigChange,fragmentAfterLogin:e,defaultUsername:this.props.startingFragmentQueryParams.defaultUsername},this.getServerProperties()))}else if(this.state.view===bE.SOFT_LOGOUT){const a=On.getComponent("structures.auth.SoftLogout");t=i.a.createElement(a,{realQueryParams:this.props.realQueryParams,onTokenLoginCompleted:this.props.onTokenLoginCompleted,fragmentAfterLogin:e})}else console.error("Unknown view "+this.state.view);const n=On.getComponent("elements.ErrorBoundary");return i.a.createElement(n,null,i.a.createElement(Ce.ToastContainer,null),t)}},Fe()(By,"displayName","GlobitsMatrixChat"),Fe()(By,"defaultProps",{realQueryParams:{},startingFragmentQueryParams:{},config:{},onTokenLoginCompleted:()=>{}}),Fy=By))||Fy;var SE=a(8278);const CE=()=>{pi.a.trackEvent("home_page","button","dm"),Xc.a.instance.track("home_page_button",{button:"dm"}),gn.a.dispatch({action:"view_create_chat"})},wE=()=>{pi.a.trackEvent("home_page","button","room_directory"),Xc.a.instance.track("home_page_button",{button:"room_directory"}),gn.a.fire(js.a.ViewRoomDirectory)},OE=()=>{pi.a.trackEvent("home_page","button","create_room"),Xc.a.instance.track("home_page_button",{button:"create_room"}),gn.a.dispatch({action:"view_create_room"})},xE=e=>({displayName:Oi.a.instance.displayName||e,avatarUrl:Oi.a.instance.getHttpAvatarUrl(52)}),RE=()=>{const e=Object(s.useContext)(ns.a),t=e.getUserId(),[a,n]=Object(s.useState)(xE(t));return Object(xi.a)(Oi.a.instance,gi.b,()=>{n(xE(t))}),s.createElement("div",null,s.createElement(ad,{hasAvatar:!!a.avatarUrl,hasAvatarLabel:Object(ts.a)("Great, that'll help people know it's you"),noAvatarLabel:Object(ts.a)("Add a photo so people know it's you."),setAvatarUrl:t=>e.setAvatarUrl(t)},s.createElement(ws.a,{idName:t,name:a.displayName,url:a.avatarUrl,width:52,height:52,resizeMethod:"crop"})),s.createElement("h1",null,Object(ts.a)("Welcome %(name)s",{name:a.displayName})),s.createElement("h4",null,Object(ts.a)("Now, let's help you get started")))};var kE,IE=e=>{let{justRegistered:t=!1}=e;const a=$c.a.get(),n=Object(Yc.a)(a);if(n){const e=On.getComponent("structures.EmbeddedPage");return s.createElement(e,{className:"mx_HomePage",url:n,scrollbar:!0})}let i;if(t)i=s.createElement(RE,null);else{const e=a.branding;let t="themes/element/img/logos/globits-logo.png";e&&e.authHeaderLogoUrl&&(t=e.authHeaderLogoUrl),i=s.createElement(s.Fragment,null,s.createElement("img",{src:t,alt:a.brand}),s.createElement("h1",null,Object(ts.a)("Welcome to %(appName)s",{appName:a.brand})),s.createElement("h4",null,Object(ts.a)("Liberate your communication")))}return s.createElement(Jn.a,{className:"mx_HomePage mx_HomePage_default"},s.createElement("div",{className:"mx_HomePage_default_wrapper"},i,s.createElement("div",{className:"mx_HomePage_default_buttons"},s.createElement(Fs.a,{onClick:CE,className:"mx_HomePage_button_sendDm"},Object(ts.a)("Send a Direct Message")),s.createElement(Fs.a,{onClick:wE,className:"mx_HomePage_button_explore"},Object(ts.a)("Explore Public Rooms")),s.createElement(Fs.a,{onClick:OE,className:"mx_HomePage_button_createGroup"},Object(ts.a)("Create a Group Chat")))))};let TE=Object(os.a)("structures.UserMenu")(kE=class extends i.a.Component{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"themeWatcherRef",void 0),Fe()(this,"dndWatcherRef",void 0),Fe()(this,"buttonRef",Object(s.createRef)()),Fe()(this,"tagStoreRef",void 0),Fe()(this,"onRoom",e=>{this.removePendingJoinRoom(e.roomId)}),Fe()(this,"onTagStoreUpdate",()=>{this.forceUpdate()}),Fe()(this,"onProfileUpdate",async()=>{this.forceUpdate()}),Fe()(this,"onSelectedSpaceUpdate",async e=>{this.setState({selectedSpace:e})}),Fe()(this,"onThemeChanged",()=>{this.setState({isDarkTheme:this.isUserOnDarkTheme()})}),Fe()(this,"onAction",e=>{switch(e.action){case js.a.ToggleUserMenu:this.state.contextMenuPosition?this.setState({contextMenuPosition:null}):this.buttonRef.current&&this.buttonRef.current.click();break;case js.a.JoinRoom:this.addPendingJoinRoom(e.roomId);break;case js.a.JoinRoomReady:case js.a.JoinRoomError:this.removePendingJoinRoom(e.roomId)}}),Fe()(this,"onOpenMenuClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})}),Fe()(this,"onContextMenu",e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{left:e.clientX,top:e.clientY,width:20,height:0}})}),Fe()(this,"onCloseMenu",()=>{this.setState({contextMenuPosition:null})}),Fe()(this,"onSwitchThemeClick",e=>{e.preventDefault(),e.stopPropagation(),ss.b.setValue("use_system_theme",null,mi.a.DEVICE,!1);const t=this.state.isDarkTheme?"light":"dark";ss.b.setValue("theme",null,mi.a.DEVICE,t)}),Fe()(this,"onSettingsOpen",(e,t)=>{e.preventDefault(),e.stopPropagation();const a={action:js.a.ViewUserSettings,initialTabId:t};gn.a.dispatch(a),this.setState({contextMenuPosition:null})}),Fe()(this,"onShowArchived",e=>{e.preventDefault(),e.stopPropagation(),console.log("TODO: Show archived rooms")}),Fe()(this,"onProvideFeedback",e=>{e.preventDefault(),e.stopPropagation(),qd.a.createTrackedDialog("Feedback Dialog","",ou),this.setState({contextMenuPosition:null})}),Fe()(this,"onSignOutClick",async e=>{var t;e.preventDefault(),e.stopPropagation();const a=Cs.a.get();a&&a.isCryptoEnabled()&&null!==(t=await a.exportRoomKeys())&&void 0!==t&&t.length?qd.a.createTrackedDialog("Logout from LeftPanel","",lu):gn.a.dispatch({action:"logout"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onSignInClick",()=>{gn.a.dispatch({action:"start_login"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onRegisterClick",()=>{gn.a.dispatch({action:"start_registration"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onHomeClick",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"view_home_page"}),this.setState({contextMenuPosition:null})}),Fe()(this,"onCommunitySettingsClick",e=>{e.preventDefault(),e.stopPropagation(),qd.a.createTrackedDialog("Edit Community","",gu,{communityId:Bs.a.instance.getSelectedCommunityId()}),this.setState({contextMenuPosition:null})}),Fe()(this,"onCommunityMembersClick",e=>{e.preventDefault(),e.stopPropagation();const t=Bs.a.instance.getSelectedCommunityGeneralChat();t?(gn.a.dispatch({action:"view_room",room_id:t.roomId},!0),gn.a.dispatch({action:js.a.SetRightPanelPhase,phase:_m.c.RoomMemberList})):qd.a.createTrackedDialog("Failed to find general chat","",uu.a,{title:Object(ts.a)("Failed to find the general chat for this community"),description:Object(ts.a)("Failed to find the general chat for this community")}),this.setState({contextMenuPosition:null})}),Fe()(this,"onCommunityInviteClick",e=>{e.preventDefault(),e.stopPropagation(),Object(mu.e)(Bs.a.instance.getSelectedCommunityId()),this.setState({contextMenuPosition:null})}),Fe()(this,"onDndToggle",e=>{e.stopPropagation();const t=ss.b.getValue("doNotDisturb");ss.b.setValue("doNotDisturb",null,mi.a.DEVICE,!t)}),Fe()(this,"renderContextMenu",()=>{if(!this.state.contextMenuPosition)return null;const e=Bs.a.instance.getSelectedCommunityName();let t;const n=$c.a.get().hostSignup;if(Cs.a.get().isGuest())t=i.a.createElement("div",{className:"mx_UserMenu_contextMenu_header mx_UserMenu_contextMenu_guestPrompts"},Object(ts.a)("Got an account? <a>Sign in</a>",{},{a:e=>i.a.createElement(Fs.a,{kind:"link",onClick:this.onSignInClick},e)}),Object(ts.a)("New here? <a>Create an account</a>",{},{a:e=>i.a.createElement(Fs.a,{kind:"link",onClick:this.onRegisterClick},e)}));else if(n&&n&&n.url){const e=n.domains||[],a=Cs.a.get().getDomain(),s=e.filter(e=>e===a||a.endsWith("."+e));(!n.domains||s.length>0)&&(t=i.a.createElement("div",{onClick:this.onCloseMenu},i.a.createElement(bu,null)))}let s,o=null;this.hasHomePage&&(o=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconHome",label:Object(ts.a)("Home"),onClick:this.onHomeClick})),ss.b.getValue(vu.a.Feedback)&&(s=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconMessage",label:Object(ts.a)("Feedback"),onClick:this.onProvideFeedback}));let r=i.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},i.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},Oi.a.instance.displayName),i.a.createElement("span",{className:"mx_UserMenu_contextMenu_userId"},Cs.a.get().getUserId())),l=i.a.createElement(i.a.Fragment,null,i.a.createElement(Ls.c,null,o,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconBell",label:Object(ts.a)("Notification settings"),onClick:e=>this.onSettingsOpen(e,om.b)}),i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconLock",label:Object(ts.a)("Security & privacy"),onClick:e=>this.onSettingsOpen(e,om.c)}),i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("All settings"),onClick:e=>this.onSettingsOpen(e,null)}),s),i.a.createElement(Ls.c,{red:!0},i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSignOut",label:Object(ts.a)("Sign out"),onClick:this.onSignOutClick}))),c=null;if(e){const t=Bs.a.instance.getSelectedCommunityId();let a,n;r=i.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},i.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},e)),Bs.a.instance.canInviteTo(t)&&(n=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconInvite",label:Object(ts.a)("Invite"),onClick:this.onCommunityInviteClick})),Bs.a.instance.isAdminOf(t)&&(a=i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("Settings"),"aria-label":Object(ts.a)("Community settings"),onClick:this.onCommunitySettingsClick})),l=i.a.createElement(Ls.c,null,a,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconMembers",label:Object(ts.a)("Members"),onClick:this.onCommunityMembersClick}),n),c=i.a.createElement(i.a.Fragment,null,i.a.createElement("hr",null),i.a.createElement("div",{className:"mx_UserMenu_contextMenu_header"},i.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},i.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},Oi.a.instance.displayName),i.a.createElement("span",{className:"mx_UserMenu_contextMenu_userId"},Cs.a.get().getUserId()))),i.a.createElement(Ls.c,null,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("Settings"),"aria-label":Object(ts.a)("User settings"),onClick:e=>this.onSettingsOpen(e,null)}),s),i.a.createElement(Ls.c,{red:!0},i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSignOut",label:Object(ts.a)("Sign out"),onClick:this.onSignOutClick})))}else Cs.a.get().isGuest()&&(l=i.a.createElement(i.a.Fragment,null,i.a.createElement(Ls.c,null,o,i.a.createElement(Ls.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(ts.a)("Settings"),onClick:e=>this.onSettingsOpen(e,null)}),s)));const d=Hn()({mx_UserMenu_contextMenu:!0,mx_UserMenu_contextMenu_prototype:!!e});return i.a.createElement(Ls.e,{left:this.state.contextMenuPosition.width+this.state.contextMenuPosition.left-10,top:this.state.contextMenuPosition.top+this.state.contextMenuPosition.height+8,onFinished:this.onCloseMenu,className:d},i.a.createElement("div",{className:"mx_UserMenu_contextMenu_header"},r,i.a.createElement(is.a,{className:"mx_UserMenu_contextMenu_themeButton",onClick:this.onSwitchThemeClick,title:this.state.isDarkTheme?Object(ts.a)("Switch to light mode"):Object(ts.a)("Switch to dark mode")},i.a.createElement("img",{src:a(1475),alt:Object(ts.a)("Switch theme"),width:16}))),t,l,c)}),this.state={contextMenuPosition:null,isDarkTheme:this.isUserOnDarkTheme(),pendingRoomJoin:new Set},Oi.a.instance.on(gi.b,this.onProfileUpdate),ss.b.getValue("feature_spaces")&&Gs.e.instance.on(Gs.c,this.onSelectedSpaceUpdate),this.dndWatcherRef=ss.b.watchSetting("doNotDisturb",null,()=>this.forceUpdate())}get hasHomePage(){return!!Object(Yc.a)($c.a.get())}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),this.themeWatcherRef=ss.b.watchSetting("theme",null,this.onThemeChanged),this.tagStoreRef=Qn.a.addListener(this.onTagStoreUpdate),Cs.a.get().on("Room",this.onRoom)}componentWillUnmount(){this.themeWatcherRef&&ss.b.unwatchSetting(this.themeWatcherRef),this.dndWatcherRef&&ss.b.unwatchSetting(this.dndWatcherRef),this.dispatcherRef&&gn.a.unregister(this.dispatcherRef),Oi.a.instance.off(gi.b,this.onProfileUpdate),this.tagStoreRef.remove(),ss.b.getValue("feature_spaces")&&Gs.e.instance.off(Gs.c,this.onSelectedSpaceUpdate),Cs.a.get().removeListener("Room",this.onRoom)}isUserOnDarkTheme(){if(ss.b.getValue("use_system_theme"))return window.matchMedia("(prefers-color-scheme: dark)").matches;{const e=ss.b.getValue("theme");return e.startsWith("custom-")?Object(du.c)(e.substring("custom-".length)).is_dark:"dark"===e}}addPendingJoinRoom(e){this.setState({pendingRoomJoin:new Set(this.state.pendingRoomJoin).add(e)})}removePendingJoinRoom(e){this.state.pendingRoomJoin.delete(e)&&this.setState({pendingRoomJoin:new Set(this.state.pendingRoomJoin)})}render(){const e=Cs.a.get().getUserId(),t=Oi.a.instance.displayName||e,a=Oi.a.instance.getHttpAvatarUrl(32),n=Bs.a.instance.getSelectedCommunityName();let s,o=!1,r=Object(ts.a)("User menu"),l=i.a.createElement("span",{className:"mx_UserMenu_userName"},t),c=i.a.createElement("span",{className:"mx_UserMenu_headerButtons"});if(this.state.selectedSpace)l=i.a.createElement("div",{className:"mx_UserMenu_doubleName"},i.a.createElement("span",{className:"mx_UserMenu_userName"},t),i.a.createElement(Eu.a,{room:this.state.selectedSpace},e=>i.a.createElement("span",{className:"mx_UserMenu_subUserName"},e)));else if(n)l=i.a.createElement("div",{className:"mx_UserMenu_doubleName"},i.a.createElement("span",{className:"mx_UserMenu_userName"},n),i.a.createElement("span",{className:"mx_UserMenu_subUserName"},t)),r=Object(ts.a)("Community and user menu"),o=!0;else if(ss.b.getValue("feature_communities_v2_prototypes"))l=i.a.createElement("div",{className:"mx_UserMenu_doubleName"},i.a.createElement("span",{className:"mx_UserMenu_userName"},Object(ts.a)("Home")),i.a.createElement("span",{className:"mx_UserMenu_subUserName"},t)),o=!0;else if(ss.b.getValue("feature_dnd")){const e=ss.b.getValue("doNotDisturb");s=i.a.createElement(Fs.a,{onClick:this.onDndToggle,className:Hn()({mx_UserMenu_dnd:!0,mx_UserMenu_dnd_noisy:!e,mx_UserMenu_dnd_muted:e})})}this.props.isMinimized&&(l=null,c=null);const d=Hn()({mx_UserMenu:!0,mx_UserMenu_minimized:this.props.isMinimized,mx_UserMenu_prototype:o});return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kr.c,{className:d,onClick:this.onOpenMenuClick,inputRef:this.buttonRef,label:r,isExpanded:!!this.state.contextMenuPosition,onContextMenu:this.onContextMenu},i.a.createElement("div",{className:"mx_UserMenu_row"},i.a.createElement("span",{className:"mx_UserMenu_userAvatarContainer",style:{height:"fit-content"}},i.a.createElement(ws.a,{idName:e,name:t,url:a,width:32,height:32,resizeMethod:"crop",className:"mx_UserMenu_userAvatar"})),l,this.state.pendingRoomJoin.size>0&&i.a.createElement(Cu.a,null,i.a.createElement(wu,{helpText:Object(ts.a)("Currently joining %(count)s rooms",{count:this.state.pendingRoomJoin.size})})),s,c)),this.renderContextMenu())}})||kE;var PE;const NE=["mx_RoomSearch_input","mx_RoomSearch_minimizedHandle","mx_RoomSublist_headerText","mx_RoomTile","mx_RoomSublist_showNButton"];let DE=Object(os.a)("structures.LeftPanel")(PE=class extends s.Component{constructor(e){super(e),Fe()(this,"ref",Object(s.createRef)()),Fe()(this,"listContainerRef",Object(s.createRef)()),Fe()(this,"groupFilterPanelWatcherRef",void 0),Fe()(this,"bgImageWatcherRef",void 0),Fe()(this,"focusedElement",null),Fe()(this,"isDoingStickyHeaders",!1),Fe()(this,"updateActiveSpace",e=>{this.setState({activeSpace:e})}),Fe()(this,"onExplore",()=>{gn.a.fire(js.a.ViewRoomDirectory)}),Fe()(this,"refreshStickyHeaders",()=>{this.listContainerRef.current&&this.handleStickyHeaders(this.listContainerRef.current)}),Fe()(this,"onBreadcrumbsUpdate",()=>{const e=ui.instance.visible;if(e!==this.state.showBreadcrumbs){if(this.setState({showBreadcrumbs:e}),!this.listContainerRef.current)return;this.handleStickyHeaders(this.listContainerRef.current)}}),Fe()(this,"onBackgroundImageUpdate",()=>{let e=Oi.a.instance.getHttpAvatarUrl(32);const t=ss.b.getValue("RoomList.backgroundImage");t&&(e=Object(Os.b)(t).getSquareThumbnailHttp(32));const a=`url(${e})`;e?document.body.style.getPropertyValue("--avatar-url")!==a&&document.body.style.setProperty("--avatar-url",a):document.body.style.removeProperty("--avatar-url")}),Fe()(this,"onScroll",e=>{const t=e.target;this.handleStickyHeaders(t)}),Fe()(this,"onFocus",e=>{this.focusedElement=e.target}),Fe()(this,"onBlur",()=>{this.focusedElement=null}),Fe()(this,"onKeyDown",e=>{if(!this.focusedElement)return;const t=Object(Li.f)().getRoomListAction(e);switch(t){case Li.e.NextRoom:case Li.e.PrevRoom:e.stopPropagation(),e.preventDefault(),this.onMoveFocus(t===Li.e.PrevRoom)}}),Fe()(this,"selectRoom",()=>{const e=this.listContainerRef.current.querySelector(".mx_RoomTile");if(e)return e.click(),!0}),Fe()(this,"onMoveFocus",e=>{let t,a=this.focusedElement,n=!1;do{const s=e?a.lastElementChild:a.firstElementChild,i=e?a.previousElementSibling:a.nextElementSibling;n?s?a=s:i?a=i:(n=!1,a=a.parentElement):i?(a=i,n=!0):a=a.parentElement,a&&(t=a.classList)}while(a&&(!NE.some(e=>t.contains(e))||null===a.offsetParent));a&&(a.focus(),this.focusedElement=a)}),this.state={showBreadcrumbs:ui.instance.visible,showGroupFilterPanel:ss.b.getValue("TagPanel.enableTagPanel"),activeSpace:Gs.e.instance.activeSpace},ui.instance.on(gi.b,this.onBreadcrumbsUpdate),ys.b.instance.on(ys.a,this.onBreadcrumbsUpdate),Oi.a.instance.on(gi.b,this.onBackgroundImageUpdate),Gs.e.instance.on(Gs.c,this.updateActiveSpace),this.bgImageWatcherRef=ss.b.watchSetting("RoomList.backgroundImage",null,this.onBackgroundImageUpdate),this.groupFilterPanelWatcherRef=ss.b.watchSetting("TagPanel.enableTagPanel",null,()=>{this.setState({showGroupFilterPanel:ss.b.getValue("TagPanel.enableTagPanel")})})}componentDidMount(){var e;Ai.b.instance.trackElementDimensions("ListContainer",this.listContainerRef.current),Ai.b.instance.on("ListContainer",this.refreshStickyHeaders),null===(e=this.listContainerRef.current)||void 0===e||e.addEventListener("scroll",this.onScroll,{passive:!0})}componentWillUnmount(){var e;ss.b.unwatchSetting(this.groupFilterPanelWatcherRef),ss.b.unwatchSetting(this.bgImageWatcherRef),ui.instance.off(gi.b,this.onBreadcrumbsUpdate),ys.b.instance.off(ys.a,this.onBreadcrumbsUpdate),Oi.a.instance.off(gi.b,this.onBackgroundImageUpdate),Gs.e.instance.off(Gs.c,this.updateActiveSpace),Ai.b.instance.stopTrackingElementDimensions("ListContainer"),Ai.b.instance.removeListener("ListContainer",this.refreshStickyHeaders),null===(e=this.listContainerRef.current)||void 0===e||e.removeEventListener("scroll",this.onScroll)}componentDidUpdate(e,t){t.activeSpace!==this.state.activeSpace&&this.refreshStickyHeaders()}handleStickyHeaders(e){this.isDoingStickyHeaders||(this.isDoingStickyHeaders=!0,window.requestAnimationFrame(()=>{this.doStickyHeaders(e),this.isDoingStickyHeaders=!1}))}doStickyHeaders(e){const t=e.scrollTop,a=e.offsetHeight+e.scrollTop,n=e.querySelectorAll(".mx_RoomSublist:not(.mx_RoomSublist_hidden)"),s=new Map;let i,o;for(const e of n){const r=e.querySelector(".mx_RoomSublist_stickable");r.style.removeProperty("display");const l=.4,c=e.offsetTop+l*ri.a<=t,d=e.offsetTop+l*ri.a>=a;c||e===n[0]?(s.set(r,{stickyTop:!0}),i&&(i.style.display="none",s.set(i,{makeInvisible:!0})),i=r):d&&!o?(s.set(r,{stickyBottom:!0}),o=r):s.set(r,{})}for(const t of s.keys()){const a=s.get(t);if(a.makeInvisible)t.style.display="none";else{if(a.stickyTop){t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")||t.classList.add("mx_RoomSublist_headerContainer_stickyTop");const a=e.parentElement.offsetTop+"px";t.style.top!==a&&(t.style.top=a)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyTop"),t.style.top&&t.style.removeProperty("top");if(a.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")||t.classList.add("mx_RoomSublist_headerContainer_stickyBottom");const a=Ai.b.instance.windowHeight-(e.parentElement.offsetTop+e.parentElement.offsetHeight)+"px";t.style.bottom!==a&&(t.style.bottom=a)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyBottom"),t.style.bottom&&t.style.removeProperty("bottom");if(a.stickyTop||a.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_sticky")||t.classList.add("mx_RoomSublist_headerContainer_sticky");const e=Ai.b.instance.getElementDimensions("ListContainer");if(e){const a=15,n=e.width-a+"px";t.style.width!==n&&(t.style.width=n)}}else a.stickyTop||a.stickyBottom||(t.classList.contains("mx_RoomSublist_headerContainer_sticky")&&t.classList.remove("mx_RoomSublist_headerContainer_sticky"),t.style.width&&t.style.removeProperty("width"))}}const r=e.parentElement;i?r.classList.add("mx_LeftPanel_roomListWrapper_stickyTop"):r.classList.remove("mx_LeftPanel_roomListWrapper_stickyTop"),o?r.classList.add("mx_LeftPanel_roomListWrapper_stickyBottom"):r.classList.remove("mx_LeftPanel_roomListWrapper_stickyBottom")}renderHeader(){return s.createElement("div",{className:"mx_LeftPanel_userHeader"},s.createElement(TE,{isMinimized:this.props.isMinimized}))}renderBreadcrumbs(){if(this.state.showBreadcrumbs&&!this.props.isMinimized)return s.createElement(wi,{className:"mx_LeftPanel_breadcrumbsContainer mx_AutoHideScrollbar",verticalScrollsHorizontally:!0,tabIndex:-1},s.createElement(_i,null))}renderSearchExplore(){return s.createElement("div",{className:"mx_LeftPanel_filterContainer",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown},s.createElement(li.a,{isMinimized:this.props.isMinimized,onKeyDown:this.onKeyDown,onSelectRoom:this.selectRoom}),s.createElement(is.a,{className:Hn()("mx_LeftPanel_exploreButton",{mx_LeftPanel_exploreButton_space:!!this.state.activeSpace}),onClick:this.onExplore,title:Object(ts.a)("Explore rooms")}))}renderGlobitsMenu(){return s.createElement("div",null,s.createElement("div",{className:"mx_LeftPanel_filterContainer"},s.createElement("a",{href:"#/home"},"Home")),s.createElement("div",{className:"mx_LeftPanel_filterContainer"},s.createElement("a",{href:"#/listpage"},"List Page")))}render(){let e;this.state.showGroupFilterPanel&&(e=s.createElement("div",{className:"mx_LeftPanel_GroupFilterPanelContainer"},s.createElement(ms,null),ss.b.getValue("feature_custom_tags")?s.createElement(fs,null):null));const t=s.createElement(Qs,{onKeyDown:this.onKeyDown,resizeNotifier:this.props.resizeNotifier,onFocus:this.onFocus,onBlur:this.onBlur,isMinimized:this.props.isMinimized,activeSpace:this.state.activeSpace,onListCollapse:this.refreshStickyHeaders}),a=(this.onKeyDown,this.props.resizeNotifier,this.onFocus,this.onBlur,this.props.isMinimized,this.state.activeSpace,this.refreshStickyHeaders,Hn()({mx_LeftPanel:!0,mx_LeftPanel_minimized:this.props.isMinimized})),n=Hn()("mx_LeftPanel_actualRoomListContainer","mx_AutoHideScrollbar");return s.createElement("div",{className:a,ref:this.ref},e,s.createElement("aside",{className:"mx_LeftPanel_roomListContainer"},this.renderHeader(),this.renderSearchExplore(),this.renderBreadcrumbs(),this.renderGlobitsMenu(),s.createElement(Ri,{onVisibilityChange:this.refreshStickyHeaders}),s.createElement("div",{className:"mx_LeftPanel_roomListWrapper"},s.createElement("div",{className:n,ref:this.listContainerRef,tabIndex:-1},t)),!this.props.isMinimized&&s.createElement(Ui,null)))}})||PE;const jE=e=>({displayName:Oi.a.instance.displayName||e,avatarUrl:Oi.a.instance.getHttpAvatarUrl(52)}),AE=()=>{const e=Object(s.useContext)(ns.a),t=e.getUserId(),[a,n]=Object(s.useState)(jE(t));return Object(xi.a)(Oi.a.instance,gi.b,()=>{n(jE(t))}),s.createElement("div",null,s.createElement(ad,{hasAvatar:!!a.avatarUrl,hasAvatarLabel:Object(ts.a)("Great, that'll help people know it's you"),noAvatarLabel:Object(ts.a)("Add a photo so people know it's you."),setAvatarUrl:t=>e.setAvatarUrl(t)},s.createElement(ws.a,{idName:t,name:a.displayName,url:a.avatarUrl,width:52,height:52,resizeMethod:"crop"})),s.createElement("h1",null,Object(ts.a)("Welcome %(name)s",{name:a.displayName})),s.createElement("h4",null,Object(ts.a)("Now, let's help you get started")))};var ME,UE=e=>{let{justRegistered:t=!1}=e;const a=$c.a.get(),n=Object(Yc.b)(a);if(n){const e=On.getComponent("structures.EmbeddedPage");return s.createElement(e,{className:"mx_ListPage",url:n,scrollbar:!0})}let i;if(t)i=s.createElement(AE,null);else{const e=a.branding;let t="themes/element/img/logos/globits-logo.png";e&&e.authHeaderLogoUrl&&(t=e.authHeaderLogoUrl),i=s.createElement(s.Fragment,null,s.createElement("img",{src:t,alt:a.brand}),s.createElement("h1",null,Object(ts.a)("Welcome to %(appName)s",{appName:a.brand})))}return s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},i,"[Need to put data here]",s.createElement("br",null),"[Need to add the Liberary to call API from SpringBoot]"))},LE=a(863),FE=a(1431);let BE=Object(os.a)("structures.NonUrgentToastContainer")(ME=class extends s.PureComponent{constructor(e,t){super(e,t),Fe()(this,"onUpdateToasts",()=>{this.setState({toasts:FE.a.instance.components})}),this.state={toasts:FE.a.instance.components},FE.a.instance.on(gi.b,this.onUpdateToasts)}componentWillUnmount(){FE.a.instance.off(gi.b,this.onUpdateToasts)}render(){const e=this.state.toasts.map((e,t)=>s.createElement("div",{className:"mx_NonUrgentToastContainer_toast",key:"toast-"+t},s.createElement(e,{})));return s.createElement("div",{className:"mx_NonUrgentToastContainer",role:"alert"},e)}})||ME;var VE,GE;function zE(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||!!e.getAttribute("contenteditable")}var WE=Object(os.a)("structures.LoggedInView")((GE=class extends s.Component{constructor(e,t){super(e,t),Fe()(this,"_matrixClient",void 0),Fe()(this,"_roomView",void 0),Fe()(this,"_resizeContainer",void 0),Fe()(this,"compactLayoutWatcherRef",void 0),Fe()(this,"resizer",void 0),Fe()(this,"onCallsChanged",()=>{this.setState({activeCalls:Vs.d.sharedInstance().getAllActiveCalls()})}),Fe()(this,"canResetTimelineInRoom",e=>!this._roomView.current||this._roomView.current.canResetTimeline()),Fe()(this,"onAccountData",e=>{"m.ignored_user_list"===e.getType()&&gn.a.dispatch({action:"ignore_state_changed"})}),Fe()(this,"onCompactLayoutChanged",(e,t,a,n,s)=>{this.setState({useCompactLayout:n})}),Fe()(this,"onSync",(e,t,a)=>{const n=this.state.syncErrorData&&this.state.syncErrorData.error&&this.state.syncErrorData.error.errcode,s=a&&a.error&&a.error.errcode;e===t&&n===s||("ERROR"===e?this.setState({syncErrorData:a}):this.setState({syncErrorData:null}),"PREPARED"===t&&"SYNCING"===e?this._updateServerNoticeEvents():this._calculateServerLimitToast(this.state.syncErrorData,this.state.usageLimitEventContent))}),Fe()(this,"onRoomStateEvents",(e,t)=>{const a=ys.b.instance.orderedLists[_s.a.ServerNotice];a&&a.some(t=>t.roomId===e.getRoomId())&&this._updateServerNoticeEvents()}),Fe()(this,"onUsageLimitDismissed",()=>{this.setState({usageLimitDismissed:!0})}),Fe()(this,"_updateServerNoticeEvents",async()=>{const e=ys.b.instance.orderedLists[_s.a.ServerNotice];if(!e)return[];const t=[];let a=0;for(const n of e){const e=n.currentState.getStateEvents("m.room.pinned_events","");if(!e||!e.getContent().pinned)continue;a=e.getTs();const s=e.getContent().pinned.slice(0,2);for(const e of s){const a=(await this._matrixClient.getEventTimeline(n.getUnfilteredTimelineSet(),e)).getEvents().find(t=>t.getId()===e);a&&t.push(a)}}if(a&&this.state.usageLimitEventTs>a)return;const n=t.find(e=>e&&"m.room.message"===e.getType()&&"m.server_notice.usage_limit_reached"===e.getContent().server_notice_type),s=n&&n.getContent();this._calculateServerLimitToast(this.state.syncErrorData,s),this.setState({usageLimitEventContent:s,usageLimitEventTs:a,usageLimitDismissed:!1})}),Fe()(this,"_onPaste",e=>{let t=!1,a=e.target;for(;!t&&a;)t=zE(a),a=a.parentElement;t||gn.a.fire(js.a.FocusComposer,!0)}),Fe()(this,"_onReactKeyDown",e=>{this._onKeyDown(e)}),Fe()(this,"_onNativeKeyDown",e=>{e.target===document.body&&this._onKeyDown(e)}),Fe()(this,"_onKeyDown",e=>{let t=!1;switch(Object(Li.f)().getRoomAction(e)){case Li.d.ScrollUp:case Li.d.RoomScrollDown:case Li.d.JumpToFirstMessage:case Li.d.JumpToLatestMessage:this._onScrollKeyPressed(e),t=!0;break;case Li.d.FocusSearch:gn.a.dispatch({action:"focus_search"}),t=!0}if(t)return e.stopPropagation(),void e.preventDefault();switch(Object(Li.f)().getNavigationAction(e)){case Li.c.FocusRoomSearch:gn.a.dispatch({action:"focus_room_filter"}),t=!0;break;case Li.c.ToggleUserMenu:gn.a.fire(js.a.ToggleUserMenu),t=!0;break;case Li.c.ToggleShortCutDialog:xd.d(),t=!0;break;case Li.c.GoToHome:gn.a.dispatch({action:"view_home_page"}),qd.a.closeCurrentModal("homeKeyboardShortcut"),t=!0;break;case Li.c.ToggleRoomSidePanel:"room_view"!==this.props.page_type&&"group_view"!==this.props.page_type||(gn.a.dispatch({action:js.a.ToggleRightPanel,type:"room_view"===this.props.page_type?"room":"group"}),t=!0);break;case Li.c.SelectPrevRoom:gn.a.dispatch({action:js.a.ViewRoomDelta,delta:-1,unread:!1}),t=!0;break;case Li.c.SelectNextRoom:gn.a.dispatch({action:js.a.ViewRoomDelta,delta:1,unread:!1}),t=!0;break;case Li.c.SelectPrevUnreadRoom:gn.a.dispatch({action:js.a.ViewRoomDelta,delta:-1,unread:!0});break;case Li.c.SelectNextUnreadRoom:gn.a.dispatch({action:js.a.ViewRoomDelta,delta:1,unread:!0});break;default:t=Rd.a.get().onKeyDown(e)}if(t)return e.stopPropagation(),void e.preventDefault();if(!(e.key===vi.a.ALT||e.key===vi.a.CONTROL||e.key===vi.a.META||e.key===vi.a.SHIFT||e.altKey||e.ctrlKey||e.metaKey)){const t=e.target!==document.body&&(e.key===vi.a.SPACE||e.key===vi.a.ENTER);if(e.key===vi.a.CONTEXT_MENU)return;t||e.key===vi.a.TAB||zE(e.target)||(gn.a.fire(js.a.FocusComposer,!0),e.stopPropagation())}}),Fe()(this,"_onScrollKeyPressed",e=>{this._roomView.current&&this._roomView.current.handleScrollKey(e)}),Fe()(this,"_onDragEnd",e=>{if(!e.destination)return;const t=e.destination.droppableId;if("tag-panel-droppable"===t){const t=e.draggableId.split(" ").pop();gn.a.dispatch(yd.moveTag(this._matrixClient,t,e.destination.index),!0)}else t.startsWith("room-sub-list-droppable_")&&this._onRoomTileEndDrag(e)}),Fe()(this,"_onRoomTileEndDrag",e=>{let t=e.destination.droppableId.split("_")[1],a=e.source.droppableId.split("_")[1];"undefined"===t&&(t=void 0),"undefined"===a&&(a=void 0);const n=e.draggableId.split("_")[1],s=e.source.index,i=e.destination.index;gn.a.dispatch(Ed.a.tagRoom(this._matrixClient,this._matrixClient.getRoom(n),a,t,s,i),!0)}),this.state={syncErrorData:void 0,useCompactLayout:ss.b.getValue("useCompactLayout"),usageLimitDismissed:!1,activeCalls:[]},this._matrixClient=this.props.matrixClient,pd.a.loadDevices(),vd(),this._roomView=s.createRef(),this._resizeContainer=s.createRef()}componentDidMount(){document.addEventListener("keydown",this._onNativeKeyDown,!1),Vs.d.sharedInstance().addListener(Vs.a.CallsChanged,this.onCallsChanged),this._updateServerNoticeEvents(),this._matrixClient.on("accountData",this.onAccountData),this._matrixClient.on("sync",this.onSync),this.onSync(this._matrixClient.getSyncState(),null,this._matrixClient.getSyncStateData()),this._matrixClient.on("RoomState.events",this.onRoomStateEvents),this.compactLayoutWatcherRef=ss.b.watchSetting("useCompactLayout",null,this.onCompactLayoutChanged),this.resizer=this._createResizer(),this.resizer.attach(),this._loadResizerPreferences()}componentWillUnmount(){document.removeEventListener("keydown",this._onNativeKeyDown,!1),Vs.d.sharedInstance().removeListener(Vs.a.CallsChanged,this.onCallsChanged),this._matrixClient.removeListener("accountData",this.onAccountData),this._matrixClient.removeListener("sync",this.onSync),this._matrixClient.removeListener("RoomState.events",this.onRoomStateEvents),ss.b.unwatchSetting(this.compactLayoutWatcherRef),this.resizer.detach()}_createResizer(){let e,t;const a={toggleSize:156,onCollapsed:e=>{t=e,e?(gn.a.dispatch({action:"hide_left_panel"}),window.localStorage.setItem("mx_lhs_size","0")):gn.a.dispatch({action:"show_left_panel"})},onResized:t=>{e=t,this.props.resizeNotifier.notifyLeftHandleResized()},onResizeStart:()=>{this.props.resizeNotifier.startResizing()},onResizeStop:()=>{t||window.localStorage.setItem("mx_lhs_size",""+e),this.props.resizeNotifier.stopResizing()},isItemCollapsed:e=>e.classList.contains("mx_LeftPanel_minimized")},n=new Od.a(this._resizeContainer.current,wd,a);return n.setClassNames({handle:"mx_ResizeHandle",vertical:"mx_ResizeHandle_vertical",reverse:"mx_ResizeHandle_reverse"}),n}_loadResizerPreferences(){let e=parseInt(window.localStorage.getItem("mx_lhs_size"),10);isNaN(e)&&(e=350),this.resizer.forHandleAt(0).resize(e)}_calculateServerLimitToast(e,t){const a=e&&e.error&&"M_RESOURCE_LIMIT_EXCEEDED"===e.error.errcode;a&&(t=e.error.data),t&&this.state.usageLimitDismissed?Pd(t.limit_type,this.onUsageLimitDismissed,t.admin_contact):Nd()}render(){On.getComponent("structures.RoomView"),On.getComponent("structures.UserView"),On.getComponent("structures.GroupView"),On.getComponent("structures.MyGroups");const e=On.getComponent("structures.ToastContainer");let t="mx_MatrixChat";this.state.useCompactLayout&&(t+=" mx_MatrixChat_useCompactLayout");const a=this.state.activeCalls.map(e=>s.createElement(Pm,{call:e,key:e.callId}));return s.createElement(ns.a.Provider,{value:this._matrixClient},s.createElement("div",{onPaste:this._onPaste,onKeyDown:this._onReactKeyDown,className:"mx_MatrixChat_wrapper","aria-hidden":this.props.hideToSRUsers},s.createElement(e,null),s.createElement(as.DragDropContext,{onDragEnd:this._onDragEnd},s.createElement("div",{ref:this._resizeContainer,className:t},ss.b.getValue("feature_spaces")?s.createElement(Rm,null):null,s.createElement(DE,{isMinimized:this.props.collapseLhs||!1,resizeNotifier:this.props.resizeNotifier}),s.createElement(LE.a,null),void 0))),s.createElement(Kd,null),s.createElement(BE,null),s.createElement(em,null),a)}},Fe()(GE,"displayName","LoggedInView"),Fe()(GE,"propTypes",{matrixClient:jt.instanceOf(hd.b).isRequired,page_type:jt.string.isRequired,onRoomCreated:jt.func,onRegistered:jt.func}),VE=GE))||VE,HE=a(1379);var KE=e=>{let{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:i,roomJustCreatedOpts:o,resizeNotifier:r,history:l}=e;return s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},s.createElement(yf,{ref:t,onRegistered:a,threepidInvite:n,roomOobData:i,resizeNotifier:r,roomJustCreatedOpts:o,history:l})))};function qE(e){const{formik:t,handleTab:a}=e;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12,sm:12},i.a.createElement("img",{style:{margin:"auto",width:"100%"},src:y.a.ROOT_PATH+"themes/element/img/download/PhieuDongThuan.PNG"})),i.a.createElement(n.Grid,{item:!0,md:12,sm:12},i.a.createElement(n.Button,{className:"mr-0 btn btn-secondary d-inline-flex",variant:"contained",style:{marginRight:"12px"},onClick:()=>{t.values.doctorAgree=!1,a(-1)}},"Từ chối phiếu đồng thuận"),i.a.createElement(n.Button,{className:"mr-0 btn btn-primary d-inline-flex",variant:"contained",color:"primary",style:{marginRight:"12px"},onClick:()=>{t.values.doctorAgree=!0,a(1)}},"Chấp nhận phiếu đồng thuận")))}function YE(e){const{formik:t}=e;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12,sm:12},i.a.createElement(S,{formik:t,field:"otherDiseases",size:"small",label:"Bệnh lý khác",variant:"outlined"})))}function $E(e){const{formik:t}=e;return i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:12,sm:12},i.a.createElement(S,{formik:t,field:"anamnesis",size:"small",label:"Tiền sử bệnh",variant:"outlined",multiline:!0,rows:4})),i.a.createElement(n.Grid,{item:!0,md:12,sm:12},i.a.createElement(S,{formik:t,field:"pathologicalProcess",size:"small",label:"Quá trình bệnh lý",variant:"outlined",multiline:!0,rows:4})))}var JE=a(1456),QE=a.n(JE);const XE=Object(n.makeStyles)(e=>({root:{},container:{border:"1px solid #3366ff88",borderRadius:"10px",minHeight:"300px",display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",justifyContent:"center"},img:{height:"200px",maxWidth:"400px",[e.breakpoints.down("md")]:{height:"300px",maxWidth:"600px"}},selectImg:{"&:hover":{color:"#3366ff",cursor:"pointer"}}}));function ZE(e){const t=XE(),[a,o]=Object(s.useState)(null),[r,l]=Object(s.useState)(null);Object(s.useEffect)(()=>{Ot.getAllInfoByUserLogin().then(e=>{let{data:t}=e;l(t)})},[]),Object(s.useEffect)(()=>{c()},[r]);const c=async()=>{await qp.getMedicalRecordFile(r.practitionerDto.id,3).then(e=>{let{data:t}=e;d(t,o)})},d=async(e,t)=>{let a=e.file,n=a.contentType;const s=y.a.API_ENPOINT+"/api/fileDownload/document/"+a.id;await v.a.get(s,{responseType:"arraybuffer"}).then(e=>{let a=e.data,s=null;if(s=new Blob([a],{type:n}),"image"==s.type.split("/")[0]){let e=URL.createObjectURL(s);t(e)}})},m=e=>{let t=e.target.files[0];var a=t.type;"image"==a.split("/")[0]?"image"===a.split("/")[0]&&t.size>Oe.a.MAX_IMAGE_FILE?Ce.toast.warning("File quá lớn, vui lòng thử lại",Oe.a.TOAST_CONFIGURE):(o(URL.createObjectURL(t)),((e,t,a,n)=>{const s=y.a.API_ENPOINT+"/api/file/upload/practitioner/medical-record";let i=new FormData;i.append("uploadfile",e),i.append("practitioner_id",t),i.append("description",a),i.append("attackImageType",n);v.a.post(s,i,{headers:{"Content-Type":"multipart/form-data"}})})(t,r.practitionerDto.id,"sign",Oe.a.PATIENT_MEDICAL_RECORD_ATTACK_IMAGE.HAND_SIGN)):Ce.toast.warning("Không đúng định dạng tải lên, vui lòng thử lại",Oe.a.TOAST_CONFIGURE)},u=e=>{const{classes:t,title:a,image:s,htmlFor:o,readOnly:r}=e;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{textAlign:"center"}},a,i.a.createElement("span",{className:"color-red"}," * ")),i.a.createElement("div",{className:t.container},s?i.a.createElement("img",{className:t.img,src:s,alt:"preview image"}):r?i.a.createElement("span",{style:{display:"flex",alignItems:"center"}},i.a.createElement("span",null,"Chưa có ảnh")):i.a.createElement("label",{htmlFor:o,className:t.selectImg},i.a.createElement("span",{style:{display:"flex",alignItems:"center"}},i.a.createElement(QE.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Chọn ảnh"))),s&&!r&&i.a.createElement("div",{className:"mt-16"},i.a.createElement("label",{htmlFor:o},i.a.createElement(n.Button,{startIcon:i.a.createElement(ip.a,null),variant:"contained",className:"btn btn-primary d-inline-flex",color:"primary",component:"span"},"Chọn ảnh khác")))))};return i.a.createElement(n.Grid,{item:!0,sm:4,xs:12},i.a.createElement("input",{accept:"image/*",className:"display-none",onChange:e=>m(e),id:"upload-single-image-sign",type:"file"}),i.a.createElement(u,{readOnly:e.readOnly,classes:t,title:"Chữ ký",image:a,htmlFor:"upload-single-image-sign"}))}var e_=a(666),t_=a.n(e_),a_=a(664),n_=a.n(a_),s_=a(665),i_=a.n(s_),o_=a(1464),r_=a.n(o_),l_=a(1460),c_=a.n(l_),d_=a(1469),m_=a.n(d_);const u_=Object(O.withStyles)({paper:{border:"1px solid #d3d4d5"}})(e=>i.a.createElement(t_.a,u()({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},e))),h_=Object(O.withStyles)(e=>({root:{"&:focus":{backgroundColor:e.palette.primary.main,"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:e.palette.common.white}}}}))(F.a);function p_(e){const[t,a]=i.a.useState(null);return i.a.createElement("div",null,i.a.createElement(fe.a,{"aria-controls":"customized-menu","aria-haspopup":"true",variant:"contained",color:"primary",onClick:e=>{a(e.currentTarget)}},"Open Menu"),i.a.createElement(u_,{id:"customized-menu",anchorEl:t,keepMounted:!0,open:Boolean(t),onClose:()=>{a(null)}},i.a.createElement(h_,null,i.a.createElement(n_.a,null,i.a.createElement(m_.a,{fontSize:"small"})),i.a.createElement(i_.a,{primary:"Sent mail"})),i.a.createElement(h_,null,i.a.createElement(n_.a,null,i.a.createElement(c_.a,{fontSize:"small"})),i.a.createElement(i_.a,{primary:"Drafts"})),i.a.createElement(h_,null,i.a.createElement(n_.a,null,i.a.createElement(r_.a,{fontSize:"small"})),i.a.createElement(i_.a,{primary:"Inbox"}))))}var g_=a(1462),f_=a.n(g_);function v_(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b_(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v_(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const y_=Object(n.makeStyles)(e=>({root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},menuButton:{color:"#FFF",marginLeft:4,marginRight:8},headerBar:{background:"#ffffff",boxShadow:"0 0 0.25rem rgb(0 0 0 / 8%)",borderBottom:"1px solid #e4e4e4",position:"sticky",zIndex:999,top:0},menuButtonIconClosed:{fontSize:"4rem !important",transition:e.transitions.create(["transform"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),transform:"rotate(0deg)"},menuButtonIconOpen:{fontSize:"4rem !important",transition:e.transitions.create(["transform"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),transform:"rotate(180deg)"},hide:{display:"none"},drawer:{width:270,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:270,backgroundColor:"#FFF",transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},drawerClose:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:"0",background:"#ffffff",[e.breakpoints.up("md")]:{width:"70px"}},toolbar:b_(b_({display:"flex",alignItems:"center",justifyContent:"center"},e.mixins.toolbar),{},{margin:"0 8px",borderBottom:"1px solid #ebeff1"}),content:{flexGrow:1,padding:e.spacing(2)},grow:{flexGrow:1},navbarBrand:{display:"inline-block",paddingTop:"0.3125rem",paddingBottom:"0.3125rem",marginRight:"1rem",fontSize:"1.25rem",lineHeight:"inherit",whiteSpace:"nowrap",color:"#57585c !important"},navUser:{padding:"0.5em 0.5em 0.5em 1.5em!important"},headerBarWraper:{width:"100%"},navToolBar:{margin:"10px",textAlign:"center",paddingTop:"10px",borderTop:"2px solid #ebeff1"},navButton:{borderRadius:"5px!important",border:"2px solid #df4b30",width:"100%",padding:"5px 20px!important",height:"100%","&:hover":{backgroundColor:"#df4b30",color:"#fff!important",transaction:"0.2s"}}}));function E_(e){const{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:o,currentRoomId:r,resizeNotifier:l,roomJustCreatedOpts:c,justRegistered:d,collapseLhs:m}=e,u=y_(),h=Object(O.useTheme)(),p=Tu()(h.breakpoints.down("md")),[g,f]=Object(s.useState)(!1),[v,b]=Object(s.useState)(!0),[y,E]=Object(s.useState)(window.location.pathname);const _=Object(s.useRef)(null);var S;return S=_,Object(s.useEffect)(()=>{function e(e){S.current&&S.current.contains(e.target)&&b(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[S]),Object(s.useEffect)(()=>{b(!p)},[p]),i.a.createElement("div",{className:u.root},i.a.createElement(vr.a,{position:"fixed",className:u.appBar}),i.a.createElement(Km.a,{onMouseEnter:()=>g?b(!0):null,onMouseLeave:()=>g?b(!1):null,variant:"permanent",className:`${Hn()(u.drawer,{[u.drawerOpen]:v,[u.drawerClose]:!v})} menu-wraper ${v?"expanse":""}`,classes:{paper:Hn()({[u.drawerOpen]:v,[u.drawerClose]:!v})},open:v},i.a.createElement("div",{className:u.toolbar},i.a.createElement(Fm.Link,{className:u.navbarBrand,to:"/"},i.a.createElement("span",null,"E-Doctor"))),i.a.createElement("div",null,i.a.createElement("div",{className:" mx_LeftPanel_userHeader"},i.a.createElement(_u,{isMinimized:m})),Lm.map((e,t)=>i.a.createElement(Vm,{item:e,key:t,selectedIndex:y,setSelectedIndex:E,handleExpanse:p?b:null,sideBarOpenStatus:v}))),i.a.createElement("div",{className:u.navToolBar},i.a.createElement(Jm.a,{className:u.navButton+" text-danger nav-button ",size:"medium",onClick:()=>{qd.a.createTrackedDialog("Logout from LeftPanel","",lu)}},i.a.createElement(eu.a,{fontSize:"large",color:"inherit"}),v&&i.a.createElement("span",null,"Đăng xuất"))),i.a.createElement("div",{ref:p?_:null,className:"menu-cover"})),i.a.createElement("main",{className:`${u.headerBarWraper} ${v?"nav-header-mobile":""} `},i.a.createElement(Ce.ToastContainer,null),i.a.createElement("div",{className:u.headerBar},i.a.createElement(Ym.a,{disableGutters:!0},i.a.createElement(Jm.a,{color:"inherit","aria-label":"Open drawer",onClick:()=>{b(!v),f(!g)},className:u.menuButton},i.a.createElement(f_.a,{classes:{root:v?u.menuButtonIconOpen:u.menuButtonIconClosed}})))),i.a.createElement("div",{className:u.content},i.a.createElement(cy,{_roomView:t,onRegistered:a,threepidInvite:n,roomOobData:o,currentRoomId:r,resizeNotifier:l,roomJustCreatedOpts:c,justRegistered:d}))))}Dm.a,An.a,Am.a,Um.a;var __=a(1417);var S_=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/observation/searchByDto";return v.a.post(a,e)}async update(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/observation/"+e.id;return v.a.put(a,e)}async create(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/observation/";return v.a.post(a,e)}async getOneById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/observation/"+e;return v.a.get(a)}async deleteById(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/observation/"+e;return v.a.delete(a)}async checkCode(e,t){let a=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+a;const n={params:{id:e,code:t}};let s=y.a.API_ENPOINT+"/api/observation/checkCode";return v.a.get(s,n)}};const C_=Object(n.makeStyles)(e=>({root:{}}));function w_(e){const t=C_(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({code:Ye.string().required(),name:Ye.string().required()}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Observation Code",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Observation Name",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(va,{label:"Encounter",formik:l,field:"encounter",variant:"outlined",size:"small",checking:"true",confirmation:"true",manager:"true",screening:"true",treatment:"true"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>o()},"Cancel"),i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Save"))))))}function O_(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function x_(e){return i.a.createElement(vt.a,e)}class R_ extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state,n={id:a,name:e.name,code:e.code,encounter:e.encounter};a?S_.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):S_.create(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={id:"",name:"",code:"",encounter:{}}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?O_(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):O_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){let{name:e,code:t,encounter:a}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:x_,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",this.props.id?"Edit Observation":"Create Observation"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(w_,{initialValues:{name:e||"",code:t||"",encounter:a||{}},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose}))}}class k_ extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage},t=await S_.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{S_.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1,item:null,id:"",listEncounter:[]}}async componentDidMount(){this.updatePageData()}render(){let{item:e,shouldOpenEditorDialog:t,shouldOpenConfirmationDialog:a,shouldOpenConfirmationDeleteListDialog:s}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:3},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Create")),i.a.createElement(n.Grid,{item:!0,md:10},t&&i.a.createElement(R_,{handleClose:this.handleClose,open:t,item:e}),a&&i.a.createElement(l,{open:a,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Delete Confirm",text:"Are you sure you want to delete this observation",agree:"Agree",cancel:"Cancel"})),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Observation Code",field:"code",align:"left",width:"150"},{title:"Observation Name",field:"name",width:"150"},{title:"Action",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await S_.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var I_=e=>s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},s.createElement(k_,null))),T_=a(1482);const P_=[{field:"id",headerName:"ID",width:90},{field:"firstName",headerName:"First name",width:150,editable:!0},{field:"lastName",headerName:"Last name",width:150,editable:!0},{field:"age",headerName:"Age",type:"number",width:110,editable:!0},{field:"fullName",headerName:"Full name",description:"This column has a value getter and is not sortable.",sortable:!1,width:160,valueGetter:e=>`${e.getValue(e.id,"firstName")||""} ${e.getValue(e.id,"lastName")||""}`},{field:"edit",headerName:"Edit",sortable:!1,width:130,disableClickEventBubbling:!0,renderCell:e=>s.createElement(fe.a,{onClick:()=>{alert("Test")}}," Click ")}],N_=[{id:1,lastName:"Snow",firstName:"Jon",age:35,number:"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"},{id:2,lastName:"Lannister",firstName:"Cersei",age:42,number:"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"},{id:3,lastName:"Lannister",firstName:"Jaime",age:45,number:"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"},{id:4,lastName:"Stark",firstName:"Arya",age:16,number:"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"},{id:5,lastName:"Targaryen",firstName:"Daenerys",age:null,number:"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"},{id:6,lastName:"Melisandre",firstName:null,age:150,number:"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"},{id:7,lastName:"Clifford",firstName:"Ferrara",age:44,number:"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"},{id:8,lastName:"Frances",firstName:"Rossini",age:36,number:"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"},{id:9,lastName:"Roxie",firstName:"Harvey",age:65,number:"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net"}];class D_ extends s.Component{render(){return s.createElement("div",{style:{height:400,width:"100%"}},s.createElement(T_.DataGrid,{rows:N_,columns:P_,pageSize:5,checkboxSelection:!0}))}}class j_ extends i.a.Component{constructor(){super(...arguments),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",()=>{ei.searchByPage({pageIndex:1,pageSize:10}).then(e=>{let{data:t}=e;this.setState({itemList:[...t.content],totalElements:t.totalElements,totalPages:t.totalPages})})}),Fe()(this,"onCallPlaced",(e,t)=>{gn.a.dispatch({action:"place_call",type:e,room_id:t})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})})}async componentDidMount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current)}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){return i.a.createElement(Jn.a,{className:"mx_HomePage mx_HomePage_default"},i.a.createElement("div",{className:"mx_HomePage_default_wrapper"},i.a.createElement("div",{className:"mx_HomePage_default_buttons"},i.a.createElement("a",{href:"/#/home"},i.a.createElement(nd,{className:"mx_RoomHeader_button mx_RoomHeader_testButton"},"Home")),i.a.createElement(Fs.a,{className:"mx_RoomHeader_button mx_RoomHeader_videoCallButton",onClick:()=>this.onCallPlaced(Vs.b.Video,"!UfnWDMPlQMiaSPyZrd:gcom.globits.net")},"Test Room Call"),i.a.createElement(Fs.a,{className:"mx_RoomHeader_button mx_RoomHeader_videoCallButton",onClick:()=>this.onCallPlaced(Vs.b.Video,"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net")},"Test Video Call"),i.a.createElement(Fs.a,{className:"mx_RoomHeader_button mx_RoomHeader_voiceCallButton",onClick:()=>this.onCallPlaced(Vs.b.Voice,"!IdaVJVFTrnnAnlDmMJ:gcom.globits.net")},"Test Voice Call")),i.a.createElement(D_,null)))}}var A_=e=>s.createElement(Jn.a,{className:""},s.createElement("div",{className:""},s.createElement(Ig,e))),M_=a(8311),U_=a.n(M_);const L_=Object(n.makeStyles)(e=>({root:{},accordionHeader:{},block:{marginLeft:"10px",marginRight:"10px"}}));function F_(e){const t=L_(),{formik:a,patientInfo:o}=e,[r,l]=Object(s.useState)([]),[c,d]=Object(s.useState)([]);return Object(s.useEffect)(()=>{o&&o.listLabTestOrderItem&&l(o.listLabTestOrderItem),o&&o.listEncounter&&d(o.listEncounter)},[]),console.log(o),i.a.createElement(n.Grid,{container:!0,spacing:1},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("h3",{className:"text-primary"},"1. Thông tin chung"),i.a.createElement("div",null," Ngày bắt đầu điều trị: ",i.a.createElement("span",{className:"text_blue"},Te()(o.treatmentStartDate).format("DD/MM/YYYY"))),i.a.createElement("div",null," Nơi đăng ký điều trị đầu tiên: ",i.a.createElement("span",{className:"text_blue"},o.registerPlace)),i.a.createElement("div",null," Ngày đăng ký điều trị tại cơ sở hiện thời: ",i.a.createElement("span",{className:"text_blue"},Te()(o.currentStartDateOfTreatment).format("DD/MM/YYYY")))),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("h3",{className:"text-primary"},"2. Phác đồ điều trị"),i.a.createElement(qe.a,{data:o.listRegiment?o.listRegiment:[],columns:[{title:"Ngày",field:"date",render:e=>i.a.createElement("span",null,Te()(e.date).format("DD/MM/YYYY"))},{title:"Phác đồ",field:"name"},{title:"Lý do",field:"l"}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn})),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("h3",{className:"text-primary"},"3. Các xét nghiệm gần đây"),r.map(e=>{let t=e.labTest.name,a=e.labTest.unit,n="";return e.numericResult&&(n=e.numericResult),e.stringResult&&(n=e.numericResult),i.a.createElement("div",null,t," : ",i.a.createElement("span",{className:"text_blue"},n)," (",a,")")})),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement("h3",{className:"text-primary"},"4. Các lần khám gần đây")),c.map(e=>{let a=e.encounterDate,s="___";e.participants&&e.participants.length>0&&(s="",e.participants.forEach(e=>{s+=e.displayName+", "}),s=s.replace(/,\s*$/,""));let o="___";e.symptoms&&e.symptoms.length>0&&(o="",e.symptoms.forEach(e=>{e.valueCode&&(o+=e.valueCode.name+", ")}),o=o.replace(/,\s*$/,""));let r="___",l=Oe.a.MOTOR_FUNCTION.find(t=>t.value==e.motorFunction);l&&(r=l.name);let c="___";return e.diagnosis&&e.diagnosis.length>0&&(c="",e.diagnosis.forEach(e=>{e.valueCode&&(c+=e.valueCode.name+", ")}),c=c.replace(/,\s*$/,"")),i.a.createElement(n.Grid,{item:!0,lg:6,md:6,sm:12,xs:12},i.a.createElement(n.Accordion,{defaultExpanded:!0},i.a.createElement(n.AccordionSummary,{expandIcon:i.a.createElement(mh.a,{className:"text-white"}),"aria-controls":"panel1a-content",id:"panel1a-header",className:t.accordionHeader+" bgc-primary-d1 text-white"},i.a.createElement(n.Typography,null,"Ngày khám: ",i.a.createElement("span",null," ",Te()(a).format("DD/MM/YYYY")," ")),i.a.createElement(n.Typography,{className:t.block}," | "),i.a.createElement(n.Typography,null,"Người khám: ",i.a.createElement("span",null,s))),i.a.createElement(n.AccordionDetails,null,i.a.createElement(n.Typography,null,i.a.createElement("div",null,"Chức năng vận động: ",i.a.createElement("span",{className:"text_blue"},r)),i.a.createElement("div",null,"Xét nghiệm: "),i.a.createElement("div",null,"Triệu chứng: ",i.a.createElement("span",{className:"text_blue"},o)),i.a.createElement("div",null,"Chẩn đoán: ",i.a.createElement("span",{className:"text_blue"},c))))))})))}function B_(e){const[t,a]=Object(s.useState)([]),[o,r]=Object(s.useState)([]),[c,d]=i.a.useState(!1),[m,u]=i.a.useState(null),[h,p]=i.a.useState(null),{item:g,setFieldValue:f,values:b,readOnly:E}=e;Object(s.useEffect)(()=>{"F"!=b.gender&&f("pregnant",null)},[b.gender]),Object(s.useEffect)(()=>{_()},[]);const _=async()=>{await $r.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&a(t.content)}),await Yr.searchByPage({pageIndex:1,pageSize:200}).then(e=>{let{data:t}=e;t&&t.content&&r(t.content)})},[S,C]=Object(s.useState)([]),[w,O]=Object(s.useState)(!1),[x,R]=i.a.useState(!1);Object(s.useEffect)(()=>{w||(k(),O(!0))},[]);const k=()=>{I(),N()},I=async()=>{await lp.searchByDto({pageIndex:1,pageSize:20,patientId:null==g?void 0:g.id,type:1}).then(e=>{let{data:t}=e;t&&t.content&&C(t.content)})},[T,P]=Object(s.useState)([]),N=async()=>{await lp.searchByDto({pageIndex:1,pageSize:20,patientId:null==g?void 0:g.id,type:2}).then(e=>{let{data:t}=e;t&&t.content&&P(t.content)})},D=async()=>{await k(),R(!1),U(!1)},[j,A]=Object(s.useState)(""),[M,U]=Object(s.useState)(!1);return i.a.createElement(Y.Form,null,i.a.createElement(n.Grid,{container:!0,spacing:2}),c&&i.a.createElement(yt,{url:h,open:c,handleClose:()=>{d(!1)},type:m}),i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15 mt-16"},i.a.createElement("h3",{className:"text-white m-0"},"Thông tin cá nhân")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Z,{name:"displayName",label:"Họ và tên",defaultValue:null==g?void 0:g.displayName,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Q,{name:"birthDate",label:"Ngày sinh",defaultValue:null==g?void 0:g.birthDate,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(X,{label:"Giới tính",name:"gender",defaultValue:null==g?void 0:g.gender,setFieldValue:f,options:Oe.a.BIRTH_GENDER,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},"F"==b.gender&&i.a.createElement(J,{setFieldValue:f,value:null==b?void 0:b.pregnant,name:"pregnant",label:"Có mang thai",disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement($,{label:"Nghề nghiệp",name:"occupation",defaultValue:null==g?void 0:g.occupation,options:t,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement($,{label:"Dân tộc",name:"ethnicity",defaultValue:null==g?void 0:g.ethnicity,options:o,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Z,{name:"idNumber",label:"CMND",defaultValue:null==g?void 0:g.idNumber,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:3,md:3,sm:12,xs:12},i.a.createElement(Z,{name:"email",label:"Email",defaultValue:null==g?void 0:g.email,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"phoneNumber",label:"Số điện thoại",defaultValue:null==g?void 0:g.phoneNumber,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"healthInsuranceNumber",label:"Số thẻ BHYT",defaultValue:null==g?void 0:g.healthInsuranceNumber,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(X,{label:"Loại dịch vụ sử dụng",name:"serviceType",defaultValue:null==g?void 0:g.serviceType,setFieldValue:f,options:Oe.a.SERVICE_TYPE,disabled:E}))),i.a.createElement(de,{setFieldValue:f,defaultValue:g,values:e.values,readOnly:E}),i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15 mt-16"},i.a.createElement("h3",{className:"text-white m-0"},"Thông tin người thân khi cần liên hệ")),i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"supporterName",label:"Họ và tên",defaultValue:null==g?void 0:g.supporterName,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"supporterAddress",label:"Địa chỉ",defaultValue:null==g?void 0:g.supporterAddress,setFieldValue:f,disabled:E})),i.a.createElement(n.Grid,{item:!0,lg:4,md:4,sm:12,xs:12},i.a.createElement(Z,{name:"supporterPhoneNumber",label:"Số điện thoại",defaultValue:null==g?void 0:g.supporterPhoneNumber,setFieldValue:f,disabled:E}))),i.a.createElement("div",{className:"bgc-primary-d1 p-10 mb-15 mt-15"},i.a.createElement("h3",{className:"text-white m-0"},"Đính kèm hồ sơ bệnh án")),i.a.createElement(n.Grid,{container:!0,spacing:2},!E&&i.a.createElement(n.Grid,{item:!0,xs:12}),M&&i.a.createElement(l,{open:M,onConfirmDialogClose:D,onYesClick:async()=>{await lp.deleteById(j).then(()=>{Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)}).catch(()=>{Ce.toast.warning("Có lỗi xảy ra, vui lòng thử lại sau",Oe.a.TOAST_CONFIGURE)}),await D()},title:"Xác nhận",text:"Bạn có chắc muốn xóa bản ghi này",agree:"Có",cancel:"Không"}),i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},i.a.createElement(qe.a,{data:S||[],columns:[{title:"Thao tác",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Tải xuống"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>(e=>{mp.downloadFile(e)})(e)},i.a.createElement(rp.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xem file"},i.a.createElement(n.IconButton,{size:"medium",onClick:()=>(e=>{let t=e.file,a=t.contentType;const n=y.a.API_ENPOINT+"/api/fileDownload/document/"+t.id;v.a.get(n,{responseType:"arraybuffer"}).then(e=>{let t=e.data,n=null;if(n=new Blob([t],{type:a}),"image/jpg"==n.type||"image/jpeg"==n.type||"image/png"==n.type){let e=URL.createObjectURL(n);p(e),u("img"),d(!0)}else if("application/pdf"==n.type){let e=URL.createObjectURL(n);u("pdf"),p(e),d(!0)}else Ce.toast.warning("Định dạng tệp tin không thể xem. Hãy tải xuống",Oe.a.TOAST_CONFIGURE)})})(e)},i.a.createElement(ze.a,{fontSize:"large",color:"action"}))),!E&&i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:()=>(e=>{A(e),U(!0)})(e.id)},i.a.createElement(Qi.a,{fontSize:"large",color:"error"})))),cellStyle:{padding:"4px 2px",minWidth:"100px"},headerStyle:{minWidth:"100px"}},{title:"Tên file",field:"file.name",align:"left",cellStyle:{padding:"4px 2px",minWidth:"350px"},headerStyle:{minWidth:"350px"}},{title:"Mô tả",field:"description",align:"left",cellStyle:{padding:"4px 2px",minWidth:"400px"},headerStyle:{minWidth:"400px"}}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff",padding:"6px"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}))))}a(8312);function V_(e){return i.a.createElement(vt.a,e)}class G_ extends i.a.Component{constructor(e){super(e),Fe()(this,"setPage",e=>{this.setState({page:e},(function(){this.updatePageData()}))}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},(function(){this.updatePageData()}))}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text},t=await Ua.searchByPage(e),{selectedItem:a}=this.state,n=t.data.content,s=a;if(s&&s.length>0)for(let e=0;e<n.length;e++)for(let t=0;t<s.length;t++)if(n[e].id==s[t].id){let t={checked:!0};n[e].tableData=t;break}this.setState({itemList:n,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleTextSearchChange",e=>{this.setState({text:e.target.value})}),Fe()(this,"handleKeyDownEnterSearch",e=>{"Enter"===e.key&&this.search()}),Fe()(this,"search",()=>{this.setState({page:1},()=>{this.updatePageData()})}),Fe()(this,"handleClick",(e,t)=>{let{selectedValue:a}=this.state;a===t.id?this.setState({selectedValue:null,selectedItem:null}):this.setState({selectedValue:t.id,selectedItem:t})}),this.state={rowsPerPage:5,page:1,totalElements:0,totalPages:0,selectedItem:{},item:null,itemList:[],selectedValue:"",text:""}}async componentDidMount(){this.updatePageData()}componentWillMount(){let{selectedItem:e}=this.props;console.log(e),null!=e&&this.setState({selectedValue:e.id,selectedItem:e})}render(){const{handleClose:e,handleSelect:t,open:a}=this.props;let{itemList:s,text:o}=this.state;return i.a.createElement(n.Dialog,{onClose:e,open:a,PaperComponent:V_,maxWidth:"md",fullWidth:!0},i.a.createElement(st.a,{style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20"},"Bác sĩ điều trị")),i.a.createElement(at.a,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:7,md:7,sm:12,xs:12}),i.a.createElement(n.Grid,{item:!0,lg:5,md:5,sm:12,xs:12},i.a.createElement(n.FormControl,{fullWidth:!0},i.a.createElement(n.Input,{className:"mt-10 search_box w-100 stylePlaceholder",name:"text",value:o,onChange:this.handleTextSearchChange,onKeyDown:this.handleKeyDownEnterSearch,placeholder:"Nhập từ khoá",id:"search_box",endAdornment:i.a.createElement(Vt.a,{onClick:()=>this.search(),fontSize:"medium",style:{color:"#2a80c8",cursor:"pointer"}})}))),i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(qe.a,{data:s,columns:[{title:"Chọn",field:"custom",align:"left",width:"250",render:e=>i.a.createElement(n.Radio,{id:"radio"+e.id,name:"radSelected",value:e.id,checked:this.state.selectedValue===e.id,onClick:t=>this.handleClick(t,e)})},{title:"Họ và tên",field:"displayName"},{title:"Tài khoản",field:"userName"},{title:"Ngày sinh",field:"birthDate",render:e=>e.birthDate?i.a.createElement("span",null,Te()(e.birthDate).format("DD/MM/YYYY")):""},{title:"Giới tính",field:"gender"},{title:"Số điện thoại",field:"phoneNumber"},{title:"Email",field:"email"}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page})))),i.a.createElement(n.DialogActions,null,i.a.createElement(n.Button,{className:"mb-16 mr-36 btn btn-secondary",variant:"contained",onClick:()=>e()},"Huỷ"),i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary",variant:"contained",onClick:()=>t(this.state.selectedItem)},"Chọn")))}}var z_=G_;function W_(e){const{formik:t,field:a,size:o,variant:r,label:l,disabled:c,classes:d}=e,[m,u]=i.a.useState(!1),[h,p]=i.a.useState(t.values[a]);return Object(s.useEffect)(()=>{t.values[a]=h},[h]),Object(s.useEffect)(()=>{p(t.values[a])},[t.values,a,h]),i.a.createElement("div",{className:"input-popup-container"},i.a.createElement(n.TextField,{disabled:!0,fullWidth:!0,classes:d,id:a,size:o,name:a,label:l,value:h&&h.displayName?h.displayName:"",onChange:t.handleChange,required:!0,variant:r,error:t.touched[a]&&Boolean(t.errors[a]),helperText:t.touched[a]&&t.errors[a]}),!c&&i.a.createElement(n.Button,{size:"small",className:"btn btn-primary-d",variant:"contained",onClick:()=>u(!0)},"Lựa chọn"),m&&i.a.createElement(z_,{open:m,handleSelect:e=>{console.log(e),u(!1),p(e)},selectedItem:h,handleClose:()=>u(!1)}))}var H_=a(8313);var K_=e=>i.a.createElement("div",null,i.a.createElement(H_.ComposedChart,{width:700,height:400,data:[{name:"Tháng 1",uv:590},{name:"Tháng 2",uv:590},{name:"Tháng 3",uv:590},{name:"Tháng 4",uv:590},{name:"Tháng 5",uv:590},{name:"Tháng 6",uv:590},{name:"Tháng 7",uv:590},{name:"Tháng 8",uv:590},{name:"Tháng 9",uv:590},{name:"Tháng 10",uv:590},{name:"Tháng 11",uv:590},{name:"Tháng 12",uv:590}],margin:{top:20,right:20,bottom:20,left:20}},i.a.createElement(H_.CartesianGrid,{stroke:"#f5f5f5"}),i.a.createElement(H_.XAxis,{dataKey:"name",scale:"band"}),i.a.createElement(H_.YAxis,null),i.a.createElement(H_.Tooltip,null),i.a.createElement(H_.Legend,null),i.a.createElement(H_.Bar,{dataKey:"uv",barSize:20,fill:"#413ea0"}))),q_=a(425);const Y_=Object(O.makeStyles)(e=>({clearSelect:{marginRight:"10px"}}));function $_(e){Y_();const{optionList:t,field:a,variant:s,size:o,listLabelValue:r,disabled:l,values:c}=e,[d,m]=i.a.useState(c);return i.a.createElement(n.FormControl,{fullWidth:!0,variant:s},i.a.createElement(n.RadioGroup,{row:!0,"aria-label":a,name:a,value:d,onChange:e=>{m(e.target.value)}},i.a.createElement(n.Grid,{container:!0},r.map(e=>i.a.createElement(n.FormControlLabel,{value:e.value,control:i.a.createElement(n.Radio,{color:"primary",size:"medium",checked:d==e.value}),label:e.label})))))}var J_=a(8475);function Q_(e){const{formik:t,optionList:a,field:o,variant:r,size:l,listLabelValue:c,disabled:d,action:m}=e,[u,h]=i.a.useState(t.values[o]);return Object(s.useEffect)(()=>{t.values[o]=u},[u]),Object(s.useEffect)(()=>{h(t.values[o])}),i.a.createElement(n.FormControl,{fullWidth:!0,variant:r},i.a.createElement(J_.a,{name:o,value:u,onChange:h},e=>c.map(t=>i.a.createElement("label",null,i.a.createElement(e,{disabled:!0,value:t.value}),t.label))))}function X_(e){var t,a,o;const{formik:r,optionList:l,field:c,variant:d,size:m,listLabelValue:u,disabled:h,action:p,required:g}=e,[f,v]=i.a.useState(r.values[c]),[b,y]=i.a.useState(null===(t=r.values)||void 0===t?void 0:t.facilityName),[E,_]=i.a.useState(null===(a=r.values)||void 0===a?void 0:a.groupName),[S,C]=i.a.useState(null===(o=r.values)||void 0===o?void 0:o.otherSouces);return Object(s.useEffect)(()=>{r.values[c]=f},[f]),Object(s.useEffect)(()=>{r.values.facilityName=b,r.values.otherSouces=S,r.values.groupName=E},[b,S,E]),Object(s.useEffect)(()=>{v(r.values[c]),null!=p&&(1==r.values[c]?p(!0):p(!1))}),i.a.createElement(i.a.Fragment,null,i.a.createElement(n.FormControl,{fullWidth:!0,variant:d,required:g||!1},i.a.createElement(n.RadioGroup,{row:!0,"aria-label":c,name:c,value:f,onChange:e=>{1==e.target.value&&(_(null),C(null)),2==e.target.value&&(y(null),C(null)),3==e.target.value&&(_(null),y(null)),v(e.target.value)}},i.a.createElement(n.Grid,{container:!0},u.map(e=>i.a.createElement(n.FormControlLabel,{value:e.value,control:i.a.createElement(n.Radio,{color:"primary",size:"medium",checked:f==e.value}),disabled:!0,label:e.label,"aria-describedby":c})))),i.a.createElement(n.FormHelperText,{id:c},r.touched[c]&&r.errors[c])),1==f&&i.a.createElement(n.TextField,{fullWidth:!0,size:"small",name:"facilityName",label:"Tên cơ sở",variant:"outlined",disabled:!0,value:b,onChange:e=>y(e.target.value)}),2==f&&i.a.createElement(n.TextField,{fullWidth:!0,size:"small",name:"groupName",label:"Tên NV / Nhóm",variant:"outlined",disabled:!0,value:E,onChange:e=>_(e.target.value)}),3==f&&i.a.createElement(n.TextField,{fullWidth:!0,size:"small",name:"otherSouces",label:"Cụ thể",variant:"outlined",disabled:!0,value:S,onChange:e=>C(e.target.value)}))}var Z_,eS,tS=a(201);function aS(e,t){if(!t)return null;for(const a of Object.keys(e))if(e[a].instances||!(e[a].instances instanceof Array))for(const n of e[a].instances)if(n.instance_id==t)return n}function nS(e,t){if(!t)return null;for(const a of Object.keys(e))if(e[a].instances||!(e[a].instances instanceof Array))for(const n of e[a].instances)if(n.instance_id==t)return a}let sS=Object(os.a)("views.dialogs.TextInputDialog")((eS=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onOk",async e=>{if(e.preventDefault(),this.props.validator&&(this.setState({busy:!0}),await this._field.current.validate({allowEmpty:!1}),!this._field.current.state.valid))return this._field.current.focus(),this._field.current.validate({allowEmpty:!1,focused:!0}),void this.setState({busy:!1});this.props.onFinished(!0,this.state.value)}),Fe()(this,"onCancel",()=>{this.props.onFinished(!1)}),Fe()(this,"onChange",e=>{this.setState({value:e.target.value})}),Fe()(this,"onValidate",async e=>{const t=await this.props.validator(e);return this.setState({valid:t.valid}),t}),this._field=Object(s.createRef)(),this.state={value:this.props.value,busy:!1,valid:!1}}componentDidMount(){this.props.focus&&this._field.current.focus()}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons");return i.a.createElement(e,{className:"mx_TextInputDialog",onFinished:this.props.onFinished,title:this.props.title,fixedWidth:this.props.fixedWidth},i.a.createElement("form",{onSubmit:this.onOk},i.a.createElement("div",{className:"mx_Dialog_content"},i.a.createElement("div",{className:"mx_TextInputDialog_label"},i.a.createElement("label",{htmlFor:"textinput"}," ",this.props.description," ")),i.a.createElement("div",null,i.a.createElement(rm.a,{className:"mx_TextInputDialog_input",ref:this._field,type:"text",label:this.props.placeholder,value:this.state.value,onChange:this.onChange,onValidate:this.props.validator?this.onValidate:void 0,size:"64"})))),i.a.createElement(t,{primaryButton:this.state.busy?Object(ts.a)(this.props.busyMessage):this.props.button,disabled:this.state.busy,onPrimaryButtonClick:this.onOk,onCancel:this.onCancel,hasCancel:this.props.hasCancel}))}},Fe()(eS,"propTypes",{title:At.a.string,description:At.a.oneOfType([At.a.element,At.a.string]),value:At.a.string,placeholder:At.a.string,button:At.a.string,busyMessage:At.a.string,focus:At.a.bool,onFinished:At.a.func.isRequired,hasCancel:At.a.bool,validator:At.a.func,fixedWidth:At.a.bool}),Fe()(eS,"defaultProps",{title:"",value:"",description:"",busyMessage:Object(ts.b)("Loading..."),focus:!0,hasCancel:!0}),Z_=eS))||Z_;var iS=a(226);const oS=Symbol("ALL_ROOMS"),rS=Object(lm.a)({deriveData:async e=>{let{value:t}=e;try{return await Cs.a.get().publicRooms({limit:1,server:t}),{}}catch(e){return{error:e}}},rules:[{key:"required",test:async e=>{let{value:t}=e;return!!t},invalid:()=>Object(ts.a)("Enter a server name")},{key:"available",final:!0,test:async(e,t)=>{let{error:a}=t;return!a},valid:()=>Object(ts.a)("Looks good"),invalid:e=>{let{error:t}=e;return"M_FORBIDDEN"===t.errcode?Object(ts.a)("You are not allowed to view this server's rooms list"):Object(ts.a)("Can't find this server or its room list")}}]});var lS,cS=e=>{let{onOptionChange:t,protocols:a={},selectedServerName:n,selectedInstanceId:o}=e;const[r,l,c,d]=Object(Kr.q)(),m=Object(ji.a)("room_directory_servers"),[h,p]=Object(s.useState)(m),g=(e,a)=>()=>{t(e,a),d()},f=e=>{p(e),ss.b.setValue("room_directory_servers",null,mi.a.ACCOUNT,e)};let v;if(Object(s.useEffect)(()=>{p(m)},[m]),r){const e=$c.a.get().roomDirectory||{},s=Cs.a.getHomeserverName(),r=new Set(e.servers),c=new Set(h.filter(e=>!r.has(e)&&e!==s)),m=[s,...Array.from(r).filter(e=>e!==s).sort(),...Array.from(c).sort()],p=m.map(e=>{const r=e===n,l=[],u=e===s?Object.values(a):[];let h,p;if(u.length>0&&u.push({instances:[{fields:[],network_id:"",instance_id:oS,desc:Object(ts.a)("All rooms")}],location_fields:[],user_fields:[],field_types:{},icon:""}),u.forEach(t=>{let{instances:a=[]}=t;[...a].sort((e,t)=>Object(iS.a)(t.desc,e.desc)).forEach(t=>{let{desc:a,instance_id:n}=t;l.push(i.a.createElement(Kr.h,{key:String(n),active:r&&n===o,onClick:g(e,n),label:a,className:"mx_NetworkDropdown_server_network"},a))})}),e===s&&(h=i.a.createElement("div",{className:"mx_NetworkDropdown_server_subtitle"},Object(ts.a)("Your server"))),c.has(e)){const a=async()=>{d();const{finished:a}=qd.a.createTrackedDialog("Network Dropdown","Remove server",$d.a,{title:Object(ts.a)("Are you sure?"),description:Object(ts.a)("Are you sure you want to remove <b>%(serverName)s</b>",{serverName:e},{b:e=>i.a.createElement("b",null,e)}),button:Object(ts.a)("Remove"),fixedWidth:!1},"mx_NetworkDropdown_dialog"),[n]=await a;n&&(f(m.filter(t=>t!==e)),r&&t(s,void 0))};p=i.a.createElement(Kr.f,{onClick:a,label:Object(ts.a)("Remove server")})}return i.a.createElement(Kr.e,{label:e,className:"mx_NetworkDropdown_server",key:e},i.a.createElement("div",{className:"mx_NetworkDropdown_server_title"},e,p),h,i.a.createElement(Kr.h,{active:r&&!o,onClick:g(e,void 0),label:Object(ts.a)("Matrix"),className:"mx_NetworkDropdown_server_network"},Object(ts.a)("Matrix")),l)}),y=async()=>{d();const{finished:e}=qd.a.createTrackedDialog("Network Dropdown","Add a new server",sS,{title:Object(ts.a)("Add a new server"),description:Object(ts.a)("Enter the name of a new server you want to explore."),button:Object(ts.a)("Add"),hasCancel:!1,placeholder:Object(ts.a)("Server name"),validator:rS,fixedWidth:!1},"mx_NetworkDropdown_dialog"),[a,n]=await e;a&&(h.includes(n)||f([...h,n]),t(n))},E=l.current.getBoundingClientRect();v=i.a.createElement(Kr.b,u()({},(b=E,{right:Ai.b.instance.windowWidth-b.right,top:b.top,chevronOffset:0,chevronFace:Kr.a.None}),{onFinished:d}),i.a.createElement("div",{className:"mx_NetworkDropdown_menu"},p,i.a.createElement(Kr.f,{className:"mx_NetworkDropdown_server_add",label:void 0,onClick:y},Object(ts.a)("Add a new server..."))))}else{let e;if(o===oS)e=Object(ts.a)("All rooms");else if(o){const t=aS(a,o);e=Object(ts.a)("%(networkName)s rooms",{networkName:t.desc})}else e=Object(ts.a)("Matrix rooms");v=i.a.createElement(Kr.c,{className:"mx_NetworkDropdown_handle",onClick:c,isExpanded:r},i.a.createElement("span",null,e)," ",i.a.createElement("span",{className:"mx_NetworkDropdown_handle_server"},"(",n,")"))}var b;return i.a.createElement("div",{className:"mx_NetworkDropdown",ref:l},v)},dS=a(192);let mS=Object(os.a)("views.elements.DirectorySearchBox")(lS=class extends i.a.Component{constructor(e){super(e),this._collectInput=this._collectInput.bind(this),this._onClearClick=this._onClearClick.bind(this),this._onChange=this._onChange.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onJoinButtonClick=this._onJoinButtonClick.bind(this),this.input=null,this.state={value:this.props.initialText||""}}_collectInput(e){this.input=e}_onClearClick(){this.setState({value:""}),this.input&&(this.input.focus(),this.props.onClear&&this.props.onClear())}_onChange(e){this.input&&(this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e.target.value))}_onKeyUp(e){"Enter"==e.key&&this.props.showJoinButton&&this.props.onJoinClick&&this.props.onJoinClick(this.state.value)}_onJoinButtonClick(){this.props.onJoinClick&&this.props.onJoinClick(this.state.value)}render(){const e=On.getComponent("elements.AccessibleButton");let t;return{mx_DirectorySearchBox:!0}[this.props.className]=!0,this.props.showJoinButton&&(t=i.a.createElement(e,{className:"mx_DirectorySearchBox_joinButton",onClick:this._onJoinButtonClick},Object(ts.a)("Join"))),i.a.createElement("div",{className:`mx_DirectorySearchBox ${this.props.className} mx_textinput`},i.a.createElement("input",{type:"text",name:"dirsearch",value:this.state.value,className:"mx_textinput_icon mx_textinput_search",ref:this._collectInput,onChange:this._onChange,onKeyUp:this._onKeyUp,placeholder:this.props.placeholder,autoFocus:!0}),t,i.a.createElement(e,{className:"mx_DirectorySearchBox_clear",onClick:this._onClearClick}))}})||lS;mS.propTypes={className:At.a.string,onChange:At.a.func,onClear:At.a.func,onJoinClick:At.a.func,placeholder:At.a.string,showJoinButton:At.a.bool,initialText:At.a.string};var uS,hS=a(507);function pS(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function gS(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pS(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pS(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fS(e){pi.a.trackEvent("RoomDirectory",e)}let vS=Object(os.a)("structures.RoomDirectory")(uS=class extends i.a.Component{constructor(e){super(e),Fe()(this,"startTime",void 0),Fe()(this,"unmounted",!1),Fe()(this,"nextBatch",null),Fe()(this,"filterTimeout",void 0),Fe()(this,"protocols",void 0),Fe()(this,"refreshRoomList",()=>{this.state.selectedCommunityId?this.setState({publicRooms:dS.a.getGroupRooms(this.state.selectedCommunityId).map(e=>({room_id:e.roomId,name:e.name,topic:e.topic,canonical_alias:e.canonicalAlias,num_joined_members:e.numJoinedMembers,avatarUrl:e.avatarUrl,world_readable:e.worldReadable,guest_can_join:e.guestsCanJoin})).filter(e=>{const t=this.state.filterString;if(t){const a=e=>(e||"").toLowerCase().includes(t.toLowerCase());return a(e.name)||a(e.topic)||a(e.canonical_alias)}return!0}),loading:!1}):(this.nextBatch=null,this.setState({publicRooms:[],loading:!0}),this.getMoreRooms())}),Fe()(this,"onRoomClicked",(e,t)=>{t.shiftKey&&!this.state.selectedCommunityId?(t.preventDefault(),this.removeFromDirectory(e)):this.showRoom(e)}),Fe()(this,"onOptionChange",(e,t)=>{this.nextBatch=null,this.setState({publicRooms:[],roomServer:e,instanceId:t,error:null},this.refreshRoomList)}),Fe()(this,"onFillRequest",e=>e||!this.nextBatch?Promise.resolve(!1):this.getMoreRooms()),Fe()(this,"onFilterChange",e=>{this.setState({filterString:e||null}),this.filterTimeout&&clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.filterTimeout=null,this.refreshRoomList()},700)}),Fe()(this,"onFilterClear",()=>{this.setState({filterString:null},this.refreshRoomList),this.filterTimeout&&clearTimeout(this.filterTimeout)}),Fe()(this,"onJoinFromSearchClick",e=>{if(this.state.instanceId&&this.state.instanceId!==oS){const t=nS(this.protocols,this.state.instanceId),a=aS(this.protocols,this.state.instanceId),n=t?this.getFieldsForThirdPartyLocation(e,this.protocols[t],a):null;if(!n){const e=$c.a.get().brand;return void qd.a.createTrackedDialog("Unable to join network","",uu.a,{title:Object(ts.a)("Unable to join network"),description:Object(ts.a)("%(brand)s does not know how to join a room on this network",{brand:e})})}Cs.a.get().getThirdpartyLocation(t,n).then(e=>{e.length>0&&e[0].alias?this.showRoomAlias(e[0].alias,!0):qd.a.createTrackedDialog("Room not found","",uu.a,{title:Object(ts.a)("Room not found"),description:Object(ts.a)("Couldn't find a matching Matrix room")})},e=>{qd.a.createTrackedDialog("Fetching third party location failed","",uu.a,{title:Object(ts.a)("Fetching third party location failed"),description:Object(ts.a)("Unable to look up room ID from server")})})}else-1==e.indexOf(":")&&(e=e+":"+this.state.roomServer),this.showRoomAlias(e,!0)}),Fe()(this,"onPreviewClick",(e,t)=>{this.showRoom(t,null,!1,!0),e.stopPropagation()}),Fe()(this,"onViewClick",(e,t)=>{this.showRoom(t),e.stopPropagation()}),Fe()(this,"onJoinClick",(e,t)=>{this.showRoom(t,null,!0),e.stopPropagation()}),Fe()(this,"onCreateRoomClick",()=>{this.onFinished(),gn.a.dispatch({action:"view_create_room",public:!0,defaultName:this.state.filterString.trim()})}),Fe()(this,"onFinished",()=>{Xc.a.instance.trackRoomDirectory(this.startTime),this.props.onFinished(!1)}),Xc.a.instance.trackRoomDirectoryBegin(),this.startTime=Xc.a.getTimestamp();const t=ss.b.getValue("feature_communities_v2_prototypes")?Qn.a.getSelectedTags()[0]:null;let a=!0;Cs.a.get()?t?(a=!1,pu.a.getGroupProfileCached(Cs.a.get(),this.state.selectedCommunityId).then(e=>{this.setState({communityName:e.name})})):Cs.a.get().getThirdpartyProtocols().then(e=>{this.protocols=e,this.setState({protocolsLoading:!1})},e=>{if(console.warn("error loading third party protocols: "+e),this.setState({protocolsLoading:!1}),Cs.a.get().isGuest())return;fS("Failed to get protocol list from homeserver");const t=$c.a.get().brand;this.setState({error:Object(ts.a)("%(brand)s failed to get the protocol list from the homeserver. The homeserver may be too old to support third party networks.",{brand:t})})}):a=!1,this.state={publicRooms:[],loading:!0,error:null,instanceId:void 0,roomServer:Cs.a.getHomeserverName(),filterString:this.props.initialText||"",selectedCommunityId:t,communityName:null,protocolsLoading:a}}componentDidMount(){this.refreshRoomList()}componentWillUnmount(){this.filterTimeout&&clearTimeout(this.filterTimeout),this.unmounted=!0}getMoreRooms(){if(this.state.selectedCommunityId)return Promise.resolve();if(!Cs.a.get())return Promise.resolve();this.setState({loading:!0});const e=this.state.filterString,t=this.state.roomServer,a=this.nextBatch,n={limit:20};return t!=Cs.a.getHomeserverName()&&(n.server=t),this.state.instanceId===oS?n.include_all_networks=!0:this.state.instanceId&&(n.third_party_instance_id=this.state.instanceId),this.nextBatch&&(n.since=this.nextBatch),e&&(n.filter={generic_search_term:e}),Cs.a.get().publicRooms(n).then(n=>{if(e==this.state.filterString&&t==this.state.roomServer&&a==this.nextBatch&&!this.unmounted){if(this.state.filterString){const e=n.total_room_count_estimate||n.chunk.length;Xc.a.instance.trackRoomDirectorySearch(e,this.state.filterString)}return this.nextBatch=n.next_batch,this.setState(e=>gS(gS({},e),{},{publicRooms:[...e.publicRooms,...n.chunk||[]],loading:!1})),Boolean(n.next_batch)}},n=>{if(e!=this.state.filterString||t!=this.state.roomServer||a!=this.nextBatch)return;if(this.unmounted)return;console.error("Failed to get publicRooms: %s",JSON.stringify(n)),fS("Failed to get public room list");const s=$c.a.get().brand;this.setState({loading:!1,error:Object(ts.a)("%(brand)s failed to get the public room list.",{brand:s})+(n&&n.message)?n.message:Object(ts.a)("The homeserver may be unavailable or overloaded.")})})}removeFromDirectory(e){const t=bS(e),a=e.name||t||Object(ts.a)("Unnamed room");let n;n=t?Object(ts.a)("Delete the room address %(alias)s and remove %(name)s from the directory?",{alias:t,name:a}):Object(ts.a)("Remove %(name)s from the directory?",{name:a}),qd.a.createTrackedDialog("Remove from Directory","",$d.a,{title:Object(ts.a)("Remove from Directory"),description:n,onFinished:n=>{if(!n)return;const s=qd.a.createDialog(Jc.a);let i=Object(ts.a)("remove %(name)s from the directory.",{name:a});Cs.a.get().setRoomDirectoryVisibility(e.room_id,"private").then(()=>{if(t)return i=Object(ts.a)("delete the address."),Cs.a.get().deleteAlias(t)}).then(()=>{s.close(),this.refreshRoomList()},e=>{s.close(),this.refreshRoomList(),console.error("Failed to "+i+": "+e),qd.a.createTrackedDialog("Remove from Directory Error","",uu.a,{title:Object(ts.a)("Error"),description:e&&e.message?e.message:Object(ts.a)("The server may be unavailable or overloaded")})})}})}showRoomAlias(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.showRoom(null,e,t)}showRoom(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.onFinished();const s={action:"view_room",auto_join:a,should_peek:n,_type:"room_directory"};if(e){if(Cs.a.get().isGuest()&&!e.world_readable&&!e.guest_can_join)return void gn.a.dispatch({action:"require_registration"});t||(t=bS(e)),s.oob_data={avatarUrl:e.avatar_url,name:e.name||t||Object(ts.a)("Unnamed room")},this.state.roomServer&&(s.via_servers=[this.state.roomServer],s.opts={viaServers:[this.state.roomServer]})}t?s.room_alias=t:s.room_id=e.room_id,gn.a.dispatch(s)}createRoomCells(e){const t=Cs.a.get(),a=t.getRoom(e.room_id),n=a&&"join"===a.getMyMembership(),s=t.isGuest();let o,r;n||!e.world_readable&&!s||(o=i.a.createElement(Fs.a,{kind:"secondary",onClick:t=>this.onPreviewClick(t,e)},Object(ts.a)("Preview"))),n?r=i.a.createElement(Fs.a,{kind:"secondary",onClick:t=>this.onViewClick(t,e)},Object(ts.a)("View")):s||(r=i.a.createElement(Fs.a,{kind:"primary",onClick:t=>this.onJoinClick(t,e)},Object(ts.a)("Join")));let l=e.name||bS(e)||Object(ts.a)("Unnamed room");l.length>80&&(l=l.substring(0,80)+"...");let c=e.topic||"";c.length>800&&(c=c.substring(0,800)+"..."),c=Object(tS.f)(c);let d=null;return e.avatar_url&&(d=Object(Os.b)(e.avatar_url).getSquareThumbnailHttp(32)),[i.a.createElement("div",{key:e.room_id+"_avatar",onClick:t=>this.onRoomClicked(e,t),onMouseDown:e=>{e.preventDefault()},className:"mx_RoomDirectory_roomAvatar"},i.a.createElement(ws.a,{width:32,height:32,resizeMethod:"crop",name:l,idName:l,url:d})),i.a.createElement("div",{key:e.room_id+"_description",onClick:t=>this.onRoomClicked(e,t),onMouseDown:e=>{e.preventDefault()},className:"mx_RoomDirectory_roomDescription"},i.a.createElement("div",{className:"mx_RoomDirectory_name"},l)," ",i.a.createElement("div",{className:"mx_RoomDirectory_topic",onClick:e=>{e.stopPropagation()},dangerouslySetInnerHTML:{__html:c}}),i.a.createElement("div",{className:"mx_RoomDirectory_alias"},bS(e))),i.a.createElement("div",{key:e.room_id+"_memberCount",onClick:t=>this.onRoomClicked(e,t),onMouseDown:e=>{e.preventDefault()},className:"mx_RoomDirectory_roomMemberCount"},e.num_joined_members),i.a.createElement("div",{key:e.room_id+"_preview",onClick:t=>this.onRoomClicked(e,t),onMouseDown:e=>{e.preventDefault()},className:"mx_RoomDirectory_preview"},o),i.a.createElement("div",{key:e.room_id+"_join",onClick:t=>this.onRoomClicked(e,t),onMouseDown:e=>{e.preventDefault()},className:"mx_RoomDirectory_join"},r)]}stringLooksLikeId(e,t){let a=/^#[^\s]+:[^\s]/;return t&&t.regexp&&(a=new RegExp(t.regexp)),a.test(e)}getFieldsForThirdPartyLocation(e,t,a){const n=t.location_fields;if(!n)return null;const s={};for(let e=0;e<n.length-1;++e){const t=n[e];if(void 0===a.fields[t])return null;s[t]=a.fields[t]}return s[n[n.length-1]]=e,s}render(){let e,t;if(this.state.error)e=this.state.error;else if(this.state.protocolsLoading)e=i.a.createElement(Jc.a,null);else{const t=(this.state.publicRooms||[]).reduce((e,t)=>e.concat(this.createRoomCells(t)),[]);let a;this.state.loading&&(a=i.a.createElement(Jc.a,null));const n=i.a.createElement(i.a.Fragment,null,i.a.createElement("hr",null),i.a.createElement(Fs.a,{kind:"primary",onClick:this.onCreateRoomClick,className:"mx_RoomDirectory_newRoom"},Object(ts.a)("Create new room")));let s,o;0!==t.length||this.state.loading?(s=i.a.createElement("div",{className:"mx_RoomDirectory_table"},t),this.state.loading||this.nextBatch||(o=n)):o=i.a.createElement(i.a.Fragment,null,i.a.createElement("h5",null,Object(ts.a)('No results for "%(query)s"',{query:this.state.filterString.trim()})),i.a.createElement("p",null,Object(ts.a)("Try different words or check for typos. Some results may not be visible as they're private and you need an invite to join them.")),n),e=i.a.createElement(hS.a,{className:"mx_RoomDirectory_tableWrapper",onFillRequest:this.onFillRequest,stickyBottom:!1,startAtBottom:!1},s,a,o&&i.a.createElement("div",{className:"mx_RoomDirectory_footer"},o))}if(!this.state.protocolsLoading){const e=nS(this.protocols,this.state.instanceId);let a;if(e&&this.protocols&&this.protocols[e]&&this.protocols[e].location_fields.length>0&&this.protocols[e].field_types){const t=this.protocols[e].location_fields.slice(-1)[0];a=this.protocols[e].field_types[t]}let n=Object(ts.a)("Find a room…");this.state.instanceId&&this.state.instanceId!==oS?a&&(n=a.placeholder):n=Object(ts.a)("Find a room… (e.g. %(exampleRoom)s)",{exampleRoom:"#example:"+this.state.roomServer});let s=this.stringLooksLikeId(this.state.filterString,a);if(e){const t=aS(this.protocols,this.state.instanceId);null===this.getFieldsForThirdPartyLocation(this.state.filterString,this.protocols[e],t)&&(s=!1)}let o=i.a.createElement(cS,{protocols:this.protocols,onOptionChange:this.onOptionChange,selectedServerName:this.state.roomServer,selectedInstanceId:this.state.instanceId});this.state.selectedCommunityId&&(o=null),t=i.a.createElement("div",{className:"mx_RoomDirectory_listheader"},i.a.createElement(mS,{className:"mx_RoomDirectory_searchbox",onChange:this.onFilterChange,onClear:this.onFilterClear,onJoinClick:this.onJoinFromSearchClick,placeholder:n,showJoinButton:s,initialText:this.props.initialText}),o)}const a=Object(ts.a)("If you can't find the room you're looking for, ask for an invite or <a>Create a new room</a>.",null,{a:e=>i.a.createElement(Fs.a,{kind:"secondary",onClick:this.onCreateRoomClick},e)}),n=this.state.selectedCommunityId?Object(ts.a)("Explore rooms in %(communityName)s",{communityName:this.state.communityName||this.state.selectedCommunityId}):Object(ts.a)("Explore rooms");return i.a.createElement(hu.a,{className:"mx_RoomDirectory_dialog",hasCancel:!0,onFinished:this.onFinished,title:n},i.a.createElement("div",{className:"mx_RoomDirectory"},a,i.a.createElement("div",{className:"mx_RoomDirectory_list"},t,e)))}})||uS;function bS(e){var t;return e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0])||""}var yS=a(8404);function ES(e){const{initialValues:t,handleSubmit:a,handleClose:s}=e,o=Ye.object().shape({code:Ye.string().required("Mã câu hỏi không được để trống"),name:Ye.string().required("Nội dung câu hỏi  việc không được để trống"),patientType:Ye.mixed().required("Đối tượng câu hỏi không được để trống"),requestType:Ye.mixed().required("Loại câu hỏi không được để trống")}),r=Object(Y.useFormik)({enableReinitialize:!0,initialValues:t,validationSchema:o,onSubmit:e=>{a(e)}});return i.a.createElement("div",null,i.a.createElement("form",{onSubmit:r.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:3},i.a.createElement(S,{formik:r,field:"code",size:"small",label:i.a.createElement("span",null,"Mã câu hỏi ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:9},i.a.createElement(S,{formik:r,field:"name",size:"small",label:i.a.createElement("span",null,"Nội dung câu hỏi ",i.a.createElement("span",{className:"color-red"},"*")),variant:"outlined"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(z,{formik:r,optionList:Oe.a.PATIENT_TYPE,variant:"outlined",field:"patientType",label:i.a.createElement("span",null,"Đối tượng ",i.a.createElement("span",{className:"color-red"},"*")),size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:6},i.a.createElement(z,{formik:r,optionList:Oe.a.REQUEST_TYPE,variant:"outlined",field:"requestType",label:i.a.createElement("span",null,"Dạng câu hỏi ",i.a.createElement("span",{className:"color-red"},"*")),size:"small"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:r,field:"description",size:"small",label:"Mô tả thêm",variant:"outlined"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>s(),style:{marginRight:"12px"}},"Huỷ"),i.a.createElement(_e,{icon:i.a.createElement(Ae.a,null),className:"mr-3 btn btn-primary d-inline-flex",loading:e.loading,variant:"contained",color:"primary",type:"submit"},"Lưu"))))))}var _S=new class{async searchByDto(e){const t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;const a=y.a.API_ENPOINT+"/api/request/searchByDto";return v.a.post(a,e)}async save(e){const t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;const a=y.a.API_ENPOINT+"/api/request";return v.a.post(a,e)}async update(e){const t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;const a=y.a.API_ENPOINT+"/api/request/"+e.id;return v.a.put(a,e)}async deleteById(e){const t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;const a=y.a.API_ENPOINT+"/api/request/"+e;return v.a.delete(a)}async getByPatientType(e){const t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;const a=y.a.API_ENPOINT+"/api/request/get-by-patient-type";return v.a.post(a,e)}async answerPatient(){const e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;const t=y.a.API_ENPOINT+"/api/period-screening/answer";return v.a.post(t)}async getAnswerPatient(){const e=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+e;const t=y.a.API_ENPOINT+"/api/period-screening/get-by-patient-id";return v.a.post(t)}};function SS(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}class CS extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{this.setState({loading:!0});const{handleClose:t}=this.props,{id:a}=this.state,n={id:a,code:e.code,name:e.name,patientType:e.patientType,requestType:e.requestType,description:e.description};a?_S.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):_S.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={code:"",name:"",description:"",id:"",isAddNew:!0,patientType:"",requestType:"",loading:!1}}componentDidMount(){const e=this.props.item;e&&(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?SS(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):SS(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)),e.id&&this.setState({isAddNew:!1}))}render(){var e;const{code:t,name:a,loading:s,isAddNew:o,patientType:r,requestType:l,description:c}=this.state,{open:d,handleClose:m}=this.props;return i.a.createElement(n.Dialog,{className:"dialog-container",open:d,fullWidth:!0,maxWidth:"md"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1"},i.a.createElement("span",{className:"mb-20 text-white"},null!==(e=this.props.item)&&void 0!==e&&e.id?"Chỉnh sửa Câu hỏi sàng lọc":"Thêm mới Câu hỏi sàng lọc"),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>m()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(ES,{initialValues:{code:null!=t?t:"",name:null!=a?a:"",patientType:null!=r?r:"",requestType:null!=l?l:"",description:null!=c?c:""},handleSubmit:this.handleFormSubmit,handleClose:m,isAddNew:o,loading:s}))}}class wS extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{var e,t;this.setState({loading:!0});const a={pageIndex:this.state.page,pageSize:this.state.rowsPerPage,text:this.state.text,patientType:"OVER_18"},n=await _S.getByPatientType(a);this.setState({data:n.data,totalElements:null===(e=n.data)||void 0===e?void 0:e.totalElements,totalPages:null===(t=n.data)||void 0===t?void 0:t.totalPages,loading:!1})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"onRedirectToURL",e=>{gn.a.dispatch({action:"home_page"})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"handleConfirmDeleteItem",()=>{_S.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xoá bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleChange",e=>{this.setState({text:e.target.value}),""!==e.target.value&&null!==e.target.value||this.updatePageData()}),Fe()(this,"handleOnKeyDown",e=>{"Enter"===e.key&&this.updatePageData()}),this.state={data:[],page:1,totalPages:null,rowsPerPage:10,totalElements:null,item:null,id:"",shouldOpenEditorDialog:!1,isAddNew:!1,shouldOpenConfirmationDialog:!1,text:"",loading:!1}}async componentDidMount(){this.updatePageData(),this.containerRef.current&&this.props.onScroll&&this.containerRef.current.addEventListener("scroll",this.props.onScroll,{passive:!0}),this.props.wrappedRef&&this.props.wrappedRef(this.containerRef.current),this.setState({tableHeight:window.innerHeight-280})}componentWillUnmount(){this.containerRef.current&&this.props.onScroll&&this.containerRef.current.removeEventListener("scroll",this.props.onScroll)}getScrollTop(){return this.containerRef.current.scrollTop}render(){return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,xs:12},i.a.createElement(n.Breadcrumbs,{"aria-label":"breadcrumb"},i.a.createElement(un.a,{fontSize:"large",color:"primary"}),i.a.createElement("span",null,"Câu hỏi sàng lọc"))),i.a.createElement(n.Grid,{item:!0,md:3},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem(null),this.setState({isAddNew:!1})}},"Thêm mới"),this.state.shouldOpenEditorDialog&&i.a.createElement(CS,{handleClose:this.handleClose,open:this.state.shouldOpenEditorDialog,item:this.state.item})),i.a.createElement(n.Grid,{item:!0,md:4}),i.a.createElement(n.Grid,{item:!0,md:5},i.a.createElement(n.FormControl,{fullWidth:!0,className:"float-right"},i.a.createElement(n.Input,{onChange:this.handleChange,name:"text",placeholder:"Search",onKeyDown:this.handleOnKeyDown,endAdornment:i.a.createElement(n.InputAdornment,{position:"end"},i.a.createElement(n.IconButton,{type:"submit","aria-label":"search",onClick:this.updatePageData},i.a.createElement(Vt.a,null)))})),this.state.shouldOpenConfirmationDialog&&i.a.createElement(l,{open:this.state.shouldOpenConfirmationDialog,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Xác nhận xóa",text:"Bạn có chắc muốn xóa bản ghi này?",agree:"Đồng ý",cancel:"Hủy"})),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Mã câu hỏi",field:"code",width:"150"},{title:"Nội dung",field:"name",width:"250"},{title:"Đối tượng",field:"custom",width:"200",render:e=>{var t;return i.a.createElement(i.a.Fragment,null,e.patientType?null===(t=Oe.a.PATIENT_TYPE)||void 0===t?void 0:t.find(t=>t.value===e.patientType).name:null)}},{title:"Dạng câu hỏi",field:"custom",width:"150",render:e=>{var t;return i.a.createElement(i.a.Fragment,null,e.requestType?null===(t=Oe.a.requestType)||void 0===t?void 0:t.find(t=>t.value===e.requestType).name:null)}},{title:"Thao tác",field:"custom",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleEditItem(e)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],isLoading:this.state.loading,options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:this.state.tableHeight,headerStyle:{backgroundColor:"#3366ff",color:"#fff",fontSize:"1.25rem"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var OS=()=>s.createElement(wS,null);function xS(e){return i.a.createElement(vt.a,e)}class RS extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"handleFormSubmit",e=>{console.log(e)}),this.state={data:[]}}componentDidMount(){Mo.searchByPageService({pageIndex:1,pageSize:1e3}).then(e=>{let{data:t}=e;this.setState({data:t.content})})}render(){let{data:e}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:xS,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," Bảng giá dịch vụ "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(n.DialogContent,null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,lg:12,md:12,sm:12,xs:12},e&&i.a.createElement(qe.a,{data:this.state.data?this.state.data:[],columns:[{title:"Mã dịch vụ",field:"code"},{title:"Tên dịch vụ",field:"name"},{title:"Giá dịch vụ",field:"price",render:e=>i.a.createElement(ne.a,{displayType:"text",defaultValue:e.price,thousandSeparator:!0,suffix:" VND"})}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}}})))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>this.props.handleClose()},"Đóng")))))}}var kS,IS=a(1419),TS=a(814);let PS=Object(os.a)("structures.ToastContainer")(kS=class extends s.Component{constructor(e,t){super(e,t),Fe()(this,"_onToastStoreUpdate",()=>{this.setState({toasts:Id.a.sharedInstance().getToasts(),countSeen:Id.a.sharedInstance().getCountSeen()})}),this.state={toasts:Id.a.sharedInstance().getToasts(),countSeen:Id.a.sharedInstance().getCountSeen()},Id.a.sharedInstance().on("update",this._onToastStoreUpdate)}componentWillUnmount(){Id.a.sharedInstance().removeListener("update",this._onToastStoreUpdate)}render(){const e=this.state.toasts.length,t=e>1;let a,n;if(0!==e){const i=this.state.toasts[0],{title:o,icon:r,key:l,component:c,className:d,props:m}=i,u=Hn()("mx_Toast_toast",{mx_Toast_hasIcon:r,["mx_Toast_icon_"+r]:r},d);let h;(t||this.state.countSeen>0)&&(h=` (${this.state.countSeen+1}/${this.state.countSeen+e})`);const p=Object.assign({},m,{key:l,toastKey:l});a=s.createElement("div",{className:u},s.createElement("div",{className:"mx_Toast_title"},s.createElement("h2",null,o),s.createElement("span",null,h)),s.createElement("div",{className:"mx_Toast_body"},s.createElement(c,p))),n=Hn()("mx_ToastContainer",{mx_ToastContainer_stacked:t})}return a?s.createElement("div",{className:n,role:"alert"},a):null}})||kS;const NS=Object(n.makeStyles)(e=>({root:{}}));function DS(e){const t=NS(),{initialValues:a,handleSubmit:s,handleClose:o}=e,r=Ye.object({code:Ye.string().required(),name:Ye.string().required()}),l=Object(Y.useFormik)({enableReinitialize:!0,initialValues:a,validationSchema:r,onSubmit:e=>{console.log("abcd"),s(e)}});return i.a.createElement("div",{className:t.root},i.a.createElement("form",{onSubmit:l.handleSubmit},i.a.createElement("div",{className:"dialog-body"},i.a.createElement(n.DialogContent,{className:"o-hidden"},i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"code",size:"small",label:"Treatment Period Code",variant:"outlined",required:"true"})),i.a.createElement(n.Grid,{item:!0,sm:12},i.a.createElement(S,{formik:l,classes:t,field:"name",size:"small",label:"Treatment Period Name",variant:"outlined",required:"true"}))))),i.a.createElement("div",{className:"dialog-footer"},i.a.createElement(n.DialogActions,{className:"p-0"},i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{startIcon:i.a.createElement(no.a,null),variant:"contained",className:"mr-12 btn btn-secondary d-inline-flex",color:"secondary",onClick:()=>o()},"Cancel"),i.a.createElement(n.Button,{startIcon:i.a.createElement(Ae.a,null),className:"ml-3 btn btn-primary d-inline-flex",variant:"contained",color:"primary",type:"submit"},"Save"))))))}function jS(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function AS(e){return i.a.createElement(vt.a,e)}class MS extends i.a.Component{constructor(e){super(e),Fe()(this,"handleFormSubmit",e=>{let{handleClose:t}=this.props,{id:a}=this.state;console.log("abcderfasfas");let n={id:a,name:e.name,code:e.code};a?ke.update(n).then(()=>{t(),Ce.toast.success("Cập nhật thành công",Oe.a.TOAST_CONFIGURE)}):ke.save(n).then(()=>{t(),Ce.toast.success("Thêm thành công",Oe.a.TOAST_CONFIGURE)})}),this.state={id:"",name:"",code:""}}componentDidMount(){let e=this.props.item;e&&this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?jS(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):jS(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e))}render(){var e;let{name:t,code:a}=this.state;return i.a.createElement(n.Dialog,{className:"dialog-container",open:this.props.open,PaperComponent:AS,fullWidth:!0,maxWidth:"sm"},i.a.createElement(n.DialogTitle,{className:"dialog-header bgc-primary-d1",style:{cursor:"move"},id:"draggable-dialog-title"},i.a.createElement("span",{className:"mb-20 text-white"}," ",null!==(e=this.props.item)&&void 0!==e&&e.id?"Edit Treatment Period ":"Create Treatment Period"," "),i.a.createElement(n.IconButton,{style:{position:"absolute",right:"3px",top:"3px"},onClick:()=>this.props.handleClose()},i.a.createElement(De.a,{fontSize:"large",color:"disabled"}))),i.a.createElement(DS,{initialValues:{name:t||"",code:a||""},handleSubmit:this.handleFormSubmit,handleClose:this.props.handleClose}))}}class US extends i.a.Component{constructor(e){super(e),Fe()(this,"containerRef",i.a.createRef()),Fe()(this,"updatePageData",async()=>{let e={pageIndex:this.state.page,pageSize:this.state.rowsPerPage},t=await ke.searchByPage(e);this.setState({data:t.data.content,totalElements:t.data.totalElements,totalPages:t.data.totalPages})}),Fe()(this,"handleClose",()=>{this.setState({shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1},()=>{this.updatePageData()})}),Fe()(this,"handleEditItem",e=>{this.setState({item:e,shouldOpenEditorDialog:!0})}),Fe()(this,"setPage",e=>{this.setState({page:e},()=>{this.updatePageData()})}),Fe()(this,"setRowsPerPage",e=>{this.setState({rowsPerPage:e.target.value,page:1},()=>{this.updatePageData()})}),Fe()(this,"handleChangePage",(e,t)=>{this.setPage(t)}),Fe()(this,"handleConfirmDeleteItem",()=>{ke.deleteById(this.state.id).then(()=>{this.handleClose(),Ce.toast.success("Đã xóa bản ghi",Oe.a.TOAST_CONFIGURE)})}),Fe()(this,"handleDelete",e=>{this.setState({id:e,shouldOpenConfirmationDialog:!0})}),Fe()(this,"preventDefault",e=>e.preventDefault()),this.state={data:[],text:"",rowsPerPage:10,page:1,totalPages:0,totalElements:null,shouldOpenEditorDialog:!1,shouldOpenConfirmationDialog:!1,shouldOpenConfirmationDeleteListDialog:!1,item:null,id:""}}async componentDidMount(){this.updatePageData()}render(){let{item:e,shouldOpenEditorDialog:t,shouldOpenConfirmationDialog:a,shouldOpenConfirmationDeleteListDialog:s}=this.state;return i.a.createElement("div",null,i.a.createElement(n.Grid,{container:!0,spacing:2},i.a.createElement(n.Grid,{item:!0,md:3},i.a.createElement(n.Button,{className:"mb-16 mr-16 btn btn-primary d-inline-flex",startIcon:i.a.createElement($i.a,null),variant:"contained",onClick:()=>{this.handleEditItem({startDate:new Date,endDate:new Date})}},"Create")),i.a.createElement(n.Grid,{item:!0,md:10},t&&i.a.createElement(MS,{handleClose:this.handleClose,open:t,item:e}),a&&i.a.createElement(l,{open:a,onConfirmDialogClose:this.handleClose,onYesClick:this.handleConfirmDeleteItem,title:"Delete Confirm",text:"Are you sure you want to delete this Treatment Period",agree:"Agree",cancel:"Cancel"})),i.a.createElement(n.Grid,{item:!0,md:12,style:{width:"100%"}},i.a.createElement(qe.a,{data:this.state.data,columns:[{title:"Treatment Period Code",field:"code",align:"left",width:"100"},{title:"Treatment Period Name",field:"name",width:"150"},{title:"Action",field:"custom",type:"numeric",render:e=>i.a.createElement(i.a.Fragment,null,i.a.createElement(gt,{title:"Sửa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{let t=await ke.getOneById(e.id);this.handleEditItem(t.data)}},i.a.createElement(Zi.a,{fontSize:"large",color:"primary"}))),i.a.createElement(gt,{title:"Xóa"},i.a.createElement(n.IconButton,{size:"small",onClick:async()=>{this.handleDelete(e.id)}},i.a.createElement(Qi.a,{fontSize:"large",color:"error"}))))}],options:{draggable:!1,selection:!1,actionsColumnIndex:-1,paging:!1,search:!1,sorting:!0,toolbar:!1,maxBodyHeight:"440px",headerStyle:{backgroundColor:"#3366ff",color:"#fff"},rowStyle:(e,t)=>({backgroundColor:t%2==1?"rgb(237, 245, 251)":"#FFF"})},localization:{body:{emptyDataSourceMessage:"Không có dữ liệu"}},icons:dn}),i.a.createElement(xe,{totalPages:this.state.totalPages,handleChangePage:this.handleChangePage,setRowsPerPage:this.setRowsPerPage,pageSize:this.state.rowsPerPage,pageSizeOption:[1,2,3,5,10,25],totalElements:this.state.totalElements,page:this.state.page}))))}}var LS,FS=e=>s.createElement(Jn.a,{className:"mx_ListPage mx_ListPage_default"},s.createElement("div",{className:"mx_ListPage_default_wrapper"},s.createElement(US,null))),BS=a(343),VS=a(625),GS=a.n(VS),zS=a(841);let WS=Object(os.a)("structures.UploadBar")(LS=class extends i.a.Component{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"mounted",void 0),Fe()(this,"onAction",e=>{switch(e.action){case js.a.UploadStarted:case js.a.UploadProgress:case js.a.UploadFinished:case js.a.UploadCanceled:case js.a.UploadFailed:{if(!this.mounted)return;const e=this.getUploadsInRoom();this.setState({currentUpload:e[0],uploadsHere:e});break}}}),Fe()(this,"onCancelClick",e=>{e.preventDefault(),BS.a.sharedInstance().cancelUpload(this.state.currentUpload.promise)});const t=this.getUploadsInRoom();this.state={currentUpload:t[0],uploadsHere:t}}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),this.mounted=!0}componentWillUnmount(){this.mounted=!1,gn.a.unregister(this.dispatcherRef)}getUploadsInRoom(){return BS.a.sharedInstance().getCurrentUploads().filter(e=>e.roomId===this.props.room.roomId)}render(){if(!this.state.currentUpload)return null;const e=Object(ts.a)("Uploading %(filename)s and %(count)s others",{filename:this.state.currentUpload.fileName,count:this.state.uploadsHere.length-1}),t=GS()(this.state.currentUpload.total);return i.a.createElement("div",{className:"mx_UploadBar"},i.a.createElement("div",{className:"mx_UploadBar_filename"},e," (",t,")"),i.a.createElement(Fs.a,{onClick:this.onCancelClick,className:"mx_UploadBar_cancel"}),i.a.createElement(zS.a,{value:this.state.currentUpload.loaded,max:this.state.currentUpload.total}))}})||LS;var HS,KS=a(503);let qS=Object(os.a)("views.auth.AuthPage")(HS=class extends i.a.PureComponent{render(){const e=On.getComponent("auth.AuthFooter");return i.a.createElement("div",{className:"mx_AuthPage"},i.a.createElement("div",{className:"mx_AuthPage_modal"},this.props.children),i.a.createElement(e,null))}})||HS;var YS=a(328);const $S=/^[0-9 -.]+$/;const JS=127462-"A".charCodeAt(0),QS=/^[A-Z]{2}$/,XS=[{iso2:"GB",name:Object(ts.b)("United Kingdom"),prefix:"44"},{iso2:"US",name:Object(ts.b)("United States"),prefix:"1"},{iso2:"AF",name:Object(ts.b)("Afghanistan"),prefix:"93"},{iso2:"AX",name:Object(ts.b)("Åland Islands"),prefix:"358"},{iso2:"AL",name:Object(ts.b)("Albania"),prefix:"355"},{iso2:"DZ",name:Object(ts.b)("Algeria"),prefix:"213"},{iso2:"AS",name:Object(ts.b)("American Samoa"),prefix:"1"},{iso2:"AD",name:Object(ts.b)("Andorra"),prefix:"376"},{iso2:"AO",name:Object(ts.b)("Angola"),prefix:"244"},{iso2:"AI",name:Object(ts.b)("Anguilla"),prefix:"1"},{iso2:"AQ",name:Object(ts.b)("Antarctica"),prefix:"672"},{iso2:"AG",name:Object(ts.b)("Antigua & Barbuda"),prefix:"1"},{iso2:"AR",name:Object(ts.b)("Argentina"),prefix:"54"},{iso2:"AM",name:Object(ts.b)("Armenia"),prefix:"374"},{iso2:"AW",name:Object(ts.b)("Aruba"),prefix:"297"},{iso2:"AU",name:Object(ts.b)("Australia"),prefix:"61"},{iso2:"AT",name:Object(ts.b)("Austria"),prefix:"43"},{iso2:"AZ",name:Object(ts.b)("Azerbaijan"),prefix:"994"},{iso2:"BS",name:Object(ts.b)("Bahamas"),prefix:"1"},{iso2:"BH",name:Object(ts.b)("Bahrain"),prefix:"973"},{iso2:"BD",name:Object(ts.b)("Bangladesh"),prefix:"880"},{iso2:"BB",name:Object(ts.b)("Barbados"),prefix:"1"},{iso2:"BY",name:Object(ts.b)("Belarus"),prefix:"375"},{iso2:"BE",name:Object(ts.b)("Belgium"),prefix:"32"},{iso2:"BZ",name:Object(ts.b)("Belize"),prefix:"501"},{iso2:"BJ",name:Object(ts.b)("Benin"),prefix:"229"},{iso2:"BM",name:Object(ts.b)("Bermuda"),prefix:"1"},{iso2:"BT",name:Object(ts.b)("Bhutan"),prefix:"975"},{iso2:"BO",name:Object(ts.b)("Bolivia"),prefix:"591"},{iso2:"BA",name:Object(ts.b)("Bosnia"),prefix:"387"},{iso2:"BW",name:Object(ts.b)("Botswana"),prefix:"267"},{iso2:"BV",name:Object(ts.b)("Bouvet Island"),prefix:"47"},{iso2:"BR",name:Object(ts.b)("Brazil"),prefix:"55"},{iso2:"IO",name:Object(ts.b)("British Indian Ocean Territory"),prefix:"246"},{iso2:"VG",name:Object(ts.b)("British Virgin Islands"),prefix:"1"},{iso2:"BN",name:Object(ts.b)("Brunei"),prefix:"673"},{iso2:"BG",name:Object(ts.b)("Bulgaria"),prefix:"359"},{iso2:"BF",name:Object(ts.b)("Burkina Faso"),prefix:"226"},{iso2:"BI",name:Object(ts.b)("Burundi"),prefix:"257"},{iso2:"KH",name:Object(ts.b)("Cambodia"),prefix:"855"},{iso2:"CM",name:Object(ts.b)("Cameroon"),prefix:"237"},{iso2:"CA",name:Object(ts.b)("Canada"),prefix:"1"},{iso2:"CV",name:Object(ts.b)("Cape Verde"),prefix:"238"},{iso2:"BQ",name:Object(ts.b)("Caribbean Netherlands"),prefix:"599"},{iso2:"KY",name:Object(ts.b)("Cayman Islands"),prefix:"1"},{iso2:"CF",name:Object(ts.b)("Central African Republic"),prefix:"236"},{iso2:"TD",name:Object(ts.b)("Chad"),prefix:"235"},{iso2:"CL",name:Object(ts.b)("Chile"),prefix:"56"},{iso2:"CN",name:Object(ts.b)("China"),prefix:"86"},{iso2:"CX",name:Object(ts.b)("Christmas Island"),prefix:"61"},{iso2:"CC",name:Object(ts.b)("Cocos (Keeling) Islands"),prefix:"61"},{iso2:"CO",name:Object(ts.b)("Colombia"),prefix:"57"},{iso2:"KM",name:Object(ts.b)("Comoros"),prefix:"269"},{iso2:"CG",name:Object(ts.b)("Congo - Brazzaville"),prefix:"242"},{iso2:"CD",name:Object(ts.b)("Congo - Kinshasa"),prefix:"243"},{iso2:"CK",name:Object(ts.b)("Cook Islands"),prefix:"682"},{iso2:"CR",name:Object(ts.b)("Costa Rica"),prefix:"506"},{iso2:"HR",name:Object(ts.b)("Croatia"),prefix:"385"},{iso2:"CU",name:Object(ts.b)("Cuba"),prefix:"53"},{iso2:"CW",name:Object(ts.b)("Curaçao"),prefix:"599"},{iso2:"CY",name:Object(ts.b)("Cyprus"),prefix:"357"},{iso2:"CZ",name:Object(ts.b)("Czech Republic"),prefix:"420"},{iso2:"CI",name:Object(ts.b)("Côte d’Ivoire"),prefix:"225"},{iso2:"DK",name:Object(ts.b)("Denmark"),prefix:"45"},{iso2:"DJ",name:Object(ts.b)("Djibouti"),prefix:"253"},{iso2:"DM",name:Object(ts.b)("Dominica"),prefix:"1"},{iso2:"DO",name:Object(ts.b)("Dominican Republic"),prefix:"1"},{iso2:"EC",name:Object(ts.b)("Ecuador"),prefix:"593"},{iso2:"EG",name:Object(ts.b)("Egypt"),prefix:"20"},{iso2:"SV",name:Object(ts.b)("El Salvador"),prefix:"503"},{iso2:"GQ",name:Object(ts.b)("Equatorial Guinea"),prefix:"240"},{iso2:"ER",name:Object(ts.b)("Eritrea"),prefix:"291"},{iso2:"EE",name:Object(ts.b)("Estonia"),prefix:"372"},{iso2:"ET",name:Object(ts.b)("Ethiopia"),prefix:"251"},{iso2:"FK",name:Object(ts.b)("Falkland Islands"),prefix:"500"},{iso2:"FO",name:Object(ts.b)("Faroe Islands"),prefix:"298"},{iso2:"FJ",name:Object(ts.b)("Fiji"),prefix:"679"},{iso2:"FI",name:Object(ts.b)("Finland"),prefix:"358"},{iso2:"FR",name:Object(ts.b)("France"),prefix:"33"},{iso2:"GF",name:Object(ts.b)("French Guiana"),prefix:"594"},{iso2:"PF",name:Object(ts.b)("French Polynesia"),prefix:"689"},{iso2:"TF",name:Object(ts.b)("French Southern Territories"),prefix:"262"},{iso2:"GA",name:Object(ts.b)("Gabon"),prefix:"241"},{iso2:"GM",name:Object(ts.b)("Gambia"),prefix:"220"},{iso2:"GE",name:Object(ts.b)("Georgia"),prefix:"995"},{iso2:"DE",name:Object(ts.b)("Germany"),prefix:"49"},{iso2:"GH",name:Object(ts.b)("Ghana"),prefix:"233"},{iso2:"GI",name:Object(ts.b)("Gibraltar"),prefix:"350"},{iso2:"GR",name:Object(ts.b)("Greece"),prefix:"30"},{iso2:"GL",name:Object(ts.b)("Greenland"),prefix:"299"},{iso2:"GD",name:Object(ts.b)("Grenada"),prefix:"1"},{iso2:"GP",name:Object(ts.b)("Guadeloupe"),prefix:"590"},{iso2:"GU",name:Object(ts.b)("Guam"),prefix:"1"},{iso2:"GT",name:Object(ts.b)("Guatemala"),prefix:"502"},{iso2:"GG",name:Object(ts.b)("Guernsey"),prefix:"44"},{iso2:"GN",name:Object(ts.b)("Guinea"),prefix:"224"},{iso2:"GW",name:Object(ts.b)("Guinea-Bissau"),prefix:"245"},{iso2:"GY",name:Object(ts.b)("Guyana"),prefix:"592"},{iso2:"HT",name:Object(ts.b)("Haiti"),prefix:"509"},{iso2:"HM",name:Object(ts.b)("Heard & McDonald Islands"),prefix:"672"},{iso2:"HN",name:Object(ts.b)("Honduras"),prefix:"504"},{iso2:"HK",name:Object(ts.b)("Hong Kong"),prefix:"852"},{iso2:"HU",name:Object(ts.b)("Hungary"),prefix:"36"},{iso2:"IS",name:Object(ts.b)("Iceland"),prefix:"354"},{iso2:"IN",name:Object(ts.b)("India"),prefix:"91"},{iso2:"ID",name:Object(ts.b)("Indonesia"),prefix:"62"},{iso2:"IR",name:Object(ts.b)("Iran"),prefix:"98"},{iso2:"IQ",name:Object(ts.b)("Iraq"),prefix:"964"},{iso2:"IE",name:Object(ts.b)("Ireland"),prefix:"353"},{iso2:"IM",name:Object(ts.b)("Isle of Man"),prefix:"44"},{iso2:"IL",name:Object(ts.b)("Israel"),prefix:"972"},{iso2:"IT",name:Object(ts.b)("Italy"),prefix:"39"},{iso2:"JM",name:Object(ts.b)("Jamaica"),prefix:"1"},{iso2:"JP",name:Object(ts.b)("Japan"),prefix:"81"},{iso2:"JE",name:Object(ts.b)("Jersey"),prefix:"44"},{iso2:"JO",name:Object(ts.b)("Jordan"),prefix:"962"},{iso2:"KZ",name:Object(ts.b)("Kazakhstan"),prefix:"7"},{iso2:"KE",name:Object(ts.b)("Kenya"),prefix:"254"},{iso2:"KI",name:Object(ts.b)("Kiribati"),prefix:"686"},{iso2:"XK",name:Object(ts.b)("Kosovo"),prefix:"383"},{iso2:"KW",name:Object(ts.b)("Kuwait"),prefix:"965"},{iso2:"KG",name:Object(ts.b)("Kyrgyzstan"),prefix:"996"},{iso2:"LA",name:Object(ts.b)("Laos"),prefix:"856"},{iso2:"LV",name:Object(ts.b)("Latvia"),prefix:"371"},{iso2:"LB",name:Object(ts.b)("Lebanon"),prefix:"961"},{iso2:"LS",name:Object(ts.b)("Lesotho"),prefix:"266"},{iso2:"LR",name:Object(ts.b)("Liberia"),prefix:"231"},{iso2:"LY",name:Object(ts.b)("Libya"),prefix:"218"},{iso2:"LI",name:Object(ts.b)("Liechtenstein"),prefix:"423"},{iso2:"LT",name:Object(ts.b)("Lithuania"),prefix:"370"},{iso2:"LU",name:Object(ts.b)("Luxembourg"),prefix:"352"},{iso2:"MO",name:Object(ts.b)("Macau"),prefix:"853"},{iso2:"MK",name:Object(ts.b)("Macedonia"),prefix:"389"},{iso2:"MG",name:Object(ts.b)("Madagascar"),prefix:"261"},{iso2:"MW",name:Object(ts.b)("Malawi"),prefix:"265"},{iso2:"MY",name:Object(ts.b)("Malaysia"),prefix:"60"},{iso2:"MV",name:Object(ts.b)("Maldives"),prefix:"960"},{iso2:"ML",name:Object(ts.b)("Mali"),prefix:"223"},{iso2:"MT",name:Object(ts.b)("Malta"),prefix:"356"},{iso2:"MH",name:Object(ts.b)("Marshall Islands"),prefix:"692"},{iso2:"MQ",name:Object(ts.b)("Martinique"),prefix:"596"},{iso2:"MR",name:Object(ts.b)("Mauritania"),prefix:"222"},{iso2:"MU",name:Object(ts.b)("Mauritius"),prefix:"230"},{iso2:"YT",name:Object(ts.b)("Mayotte"),prefix:"262"},{iso2:"MX",name:Object(ts.b)("Mexico"),prefix:"52"},{iso2:"FM",name:Object(ts.b)("Micronesia"),prefix:"691"},{iso2:"MD",name:Object(ts.b)("Moldova"),prefix:"373"},{iso2:"MC",name:Object(ts.b)("Monaco"),prefix:"377"},{iso2:"MN",name:Object(ts.b)("Mongolia"),prefix:"976"},{iso2:"ME",name:Object(ts.b)("Montenegro"),prefix:"382"},{iso2:"MS",name:Object(ts.b)("Montserrat"),prefix:"1"},{iso2:"MA",name:Object(ts.b)("Morocco"),prefix:"212"},{iso2:"MZ",name:Object(ts.b)("Mozambique"),prefix:"258"},{iso2:"MM",name:Object(ts.b)("Myanmar"),prefix:"95"},{iso2:"NA",name:Object(ts.b)("Namibia"),prefix:"264"},{iso2:"NR",name:Object(ts.b)("Nauru"),prefix:"674"},{iso2:"NP",name:Object(ts.b)("Nepal"),prefix:"977"},{iso2:"NL",name:Object(ts.b)("Netherlands"),prefix:"31"},{iso2:"NC",name:Object(ts.b)("New Caledonia"),prefix:"687"},{iso2:"NZ",name:Object(ts.b)("New Zealand"),prefix:"64"},{iso2:"NI",name:Object(ts.b)("Nicaragua"),prefix:"505"},{iso2:"NE",name:Object(ts.b)("Niger"),prefix:"227"},{iso2:"NG",name:Object(ts.b)("Nigeria"),prefix:"234"},{iso2:"NU",name:Object(ts.b)("Niue"),prefix:"683"},{iso2:"NF",name:Object(ts.b)("Norfolk Island"),prefix:"672"},{iso2:"KP",name:Object(ts.b)("North Korea"),prefix:"850"},{iso2:"MP",name:Object(ts.b)("Northern Mariana Islands"),prefix:"1"},{iso2:"NO",name:Object(ts.b)("Norway"),prefix:"47"},{iso2:"OM",name:Object(ts.b)("Oman"),prefix:"968"},{iso2:"PK",name:Object(ts.b)("Pakistan"),prefix:"92"},{iso2:"PW",name:Object(ts.b)("Palau"),prefix:"680"},{iso2:"PS",name:Object(ts.b)("Palestine"),prefix:"970"},{iso2:"PA",name:Object(ts.b)("Panama"),prefix:"507"},{iso2:"PG",name:Object(ts.b)("Papua New Guinea"),prefix:"675"},{iso2:"PY",name:Object(ts.b)("Paraguay"),prefix:"595"},{iso2:"PE",name:Object(ts.b)("Peru"),prefix:"51"},{iso2:"PH",name:Object(ts.b)("Philippines"),prefix:"63"},{iso2:"PN",name:Object(ts.b)("Pitcairn Islands"),prefix:"870"},{iso2:"PL",name:Object(ts.b)("Poland"),prefix:"48"},{iso2:"PT",name:Object(ts.b)("Portugal"),prefix:"351"},{iso2:"PR",name:Object(ts.b)("Puerto Rico"),prefix:"1"},{iso2:"QA",name:Object(ts.b)("Qatar"),prefix:"974"},{iso2:"RO",name:Object(ts.b)("Romania"),prefix:"40"},{iso2:"RU",name:Object(ts.b)("Russia"),prefix:"7"},{iso2:"RW",name:Object(ts.b)("Rwanda"),prefix:"250"},{iso2:"RE",name:Object(ts.b)("Réunion"),prefix:"262"},{iso2:"WS",name:Object(ts.b)("Samoa"),prefix:"685"},{iso2:"SM",name:Object(ts.b)("San Marino"),prefix:"378"},{iso2:"SA",name:Object(ts.b)("Saudi Arabia"),prefix:"966"},{iso2:"SN",name:Object(ts.b)("Senegal"),prefix:"221"},{iso2:"RS",name:Object(ts.b)("Serbia"),prefix:"381 p"},{iso2:"SC",name:Object(ts.b)("Seychelles"),prefix:"248"},{iso2:"SL",name:Object(ts.b)("Sierra Leone"),prefix:"232"},{iso2:"SG",name:Object(ts.b)("Singapore"),prefix:"65"},{iso2:"SX",name:Object(ts.b)("Sint Maarten"),prefix:"1"},{iso2:"SK",name:Object(ts.b)("Slovakia"),prefix:"421"},{iso2:"SI",name:Object(ts.b)("Slovenia"),prefix:"386"},{iso2:"SB",name:Object(ts.b)("Solomon Islands"),prefix:"677"},{iso2:"SO",name:Object(ts.b)("Somalia"),prefix:"252"},{iso2:"ZA",name:Object(ts.b)("South Africa"),prefix:"27"},{iso2:"GS",name:Object(ts.b)("South Georgia & South Sandwich Islands"),prefix:"500"},{iso2:"KR",name:Object(ts.b)("South Korea"),prefix:"82"},{iso2:"SS",name:Object(ts.b)("South Sudan"),prefix:"211"},{iso2:"ES",name:Object(ts.b)("Spain"),prefix:"34"},{iso2:"LK",name:Object(ts.b)("Sri Lanka"),prefix:"94"},{iso2:"BL",name:Object(ts.b)("St. Barthélemy"),prefix:"590"},{iso2:"SH",name:Object(ts.b)("St. Helena"),prefix:"290 n"},{iso2:"KN",name:Object(ts.b)("St. Kitts & Nevis"),prefix:"1"},{iso2:"LC",name:Object(ts.b)("St. Lucia"),prefix:"1"},{iso2:"MF",name:Object(ts.b)("St. Martin"),prefix:"590"},{iso2:"PM",name:Object(ts.b)("St. Pierre & Miquelon"),prefix:"508"},{iso2:"VC",name:Object(ts.b)("St. Vincent & Grenadines"),prefix:"1"},{iso2:"SD",name:Object(ts.b)("Sudan"),prefix:"249"},{iso2:"SR",name:Object(ts.b)("Suriname"),prefix:"597"},{iso2:"SJ",name:Object(ts.b)("Svalbard & Jan Mayen"),prefix:"47"},{iso2:"SZ",name:Object(ts.b)("Swaziland"),prefix:"268"},{iso2:"SE",name:Object(ts.b)("Sweden"),prefix:"46"},{iso2:"CH",name:Object(ts.b)("Switzerland"),prefix:"41"},{iso2:"SY",name:Object(ts.b)("Syria"),prefix:"963"},{iso2:"ST",name:Object(ts.b)("São Tomé & Príncipe"),prefix:"239"},{iso2:"TW",name:Object(ts.b)("Taiwan"),prefix:"886"},{iso2:"TJ",name:Object(ts.b)("Tajikistan"),prefix:"992"},{iso2:"TZ",name:Object(ts.b)("Tanzania"),prefix:"255"},{iso2:"TH",name:Object(ts.b)("Thailand"),prefix:"66"},{iso2:"TL",name:Object(ts.b)("Timor-Leste"),prefix:"670"},{iso2:"TG",name:Object(ts.b)("Togo"),prefix:"228"},{iso2:"TK",name:Object(ts.b)("Tokelau"),prefix:"690"},{iso2:"TO",name:Object(ts.b)("Tonga"),prefix:"676"},{iso2:"TT",name:Object(ts.b)("Trinidad & Tobago"),prefix:"1"},{iso2:"TN",name:Object(ts.b)("Tunisia"),prefix:"216"},{iso2:"TR",name:Object(ts.b)("Turkey"),prefix:"90"},{iso2:"TM",name:Object(ts.b)("Turkmenistan"),prefix:"993"},{iso2:"TC",name:Object(ts.b)("Turks & Caicos Islands"),prefix:"1"},{iso2:"TV",name:Object(ts.b)("Tuvalu"),prefix:"688"},{iso2:"VI",name:Object(ts.b)("U.S. Virgin Islands"),prefix:"1"},{iso2:"UG",name:Object(ts.b)("Uganda"),prefix:"256"},{iso2:"UA",name:Object(ts.b)("Ukraine"),prefix:"380"},{iso2:"AE",name:Object(ts.b)("United Arab Emirates"),prefix:"971"},{iso2:"UY",name:Object(ts.b)("Uruguay"),prefix:"598"},{iso2:"UZ",name:Object(ts.b)("Uzbekistan"),prefix:"998"},{iso2:"VU",name:Object(ts.b)("Vanuatu"),prefix:"678"},{iso2:"VA",name:Object(ts.b)("Vatican City"),prefix:"39"},{iso2:"VE",name:Object(ts.b)("Venezuela"),prefix:"58"},{iso2:"VN",name:Object(ts.b)("Vietnam"),prefix:"84"},{iso2:"WF",name:Object(ts.b)("Wallis & Futuna"),prefix:"681"},{iso2:"EH",name:Object(ts.b)("Western Sahara"),prefix:"212"},{iso2:"YE",name:Object(ts.b)("Yemen"),prefix:"967"},{iso2:"ZM",name:Object(ts.b)("Zambia"),prefix:"260"},{iso2:"ZW",name:Object(ts.b)("Zimbabwe"),prefix:"263"}];var ZS;const eC={};for(const e of XS)eC[e.iso2]=e;function tC(e,t){return"+"===e[0]&&(e=e.slice(1)),0==t.name.toUpperCase().indexOf(e.toUpperCase())||(t.iso2==e.toUpperCase()||-1!==t.prefix.indexOf(e))}let aC=Object(os.a)("views.auth.CountryDropdown")(ZS=class extends i.a.Component{constructor(e){super(e),this._onSearchChange=this._onSearchChange.bind(this),this._onOptionChange=this._onOptionChange.bind(this),this._getShortOption=this._getShortOption.bind(this);let t=XS[0];const a=$c.a.get().defaultCountryCode;if(a){const e=XS.find(e=>e.iso2===a.toUpperCase());e&&(t=e)}this.state={searchQuery:"",defaultCountry:t}}componentDidMount(){this.props.value||this.props.onOptionChange(this.state.defaultCountry)}_onSearchChange(e){this.setState({searchQuery:e})}_onOptionChange(e){this.props.onOptionChange(eC[e])}_flagImgForIso2(e){return i.a.createElement("div",{className:"mx_Dropdown_option_emoji"},(t=e,QS.test(t)?String.fromCodePoint(...t.split("").map(e=>JS+e.charCodeAt(0))):""));var t}_getShortOption(e){if(!this.props.isSmall)return;let t;return this.props.showPrefix&&(t="+"+eC[e].prefix),i.a.createElement("span",{className:"mx_CountryDropdown_shortOption"},this._flagImgForIso2(e),t)}render(){const e=On.getComponent("elements.Dropdown");let t;if(this.state.searchQuery){if(t=XS.filter(tC.bind(this,this.state.searchQuery)),2==this.state.searchQuery.length&&eC[this.state.searchQuery.toUpperCase()]){const e=eC[this.state.searchQuery.toUpperCase()];t=t.filter(t=>t.iso2!=e.iso2),t.unshift(e)}}else t=XS;const a=t.map(e=>i.a.createElement("div",{className:"mx_CountryDropdown_option",key:e.iso2},this._flagImgForIso2(e.iso2),Object(ts.a)(e.name)," (+",e.prefix,")")),n=this.props.value||this.state.defaultCountry.iso2;return i.a.createElement(e,{id:"mx_CountryDropdown",className:this.props.className+" mx_CountryDropdown",onOptionChange:this._onOptionChange,onSearchChange:this._onSearchChange,menuWidth:298,getShortOption:this._getShortOption,value:n,searchEnabled:!0,disabled:this.props.disabled,label:Object(ts.a)("Country Dropdown")},a)}})||ZS;aC.propTypes={className:At.a.string,isSmall:At.a.bool,showPrefix:At.a.bool,onOptionChange:At.a.func.isRequired,value:At.a.string,disabled:At.a.bool};var nC,sC,iC=a(1467),oC=a.n(iC);const rC=/^[0-9()\-\s]*$/;var lC;!function(e){e.Email="login_field_email",e.MatrixId="login_field_mxid",e.Phone="login_field_phone",e.Password="login_field_phone"}(lC||(lC={}));let cC=Object(os.a)("views.auth.PasswordLogin")((sC=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"onForgotPasswordClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onForgotPasswordClick()}),Fe()(this,"onRegisterClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onRegisterClick()}),Fe()(this,"onSubmitForm",async e=>{e.preventDefault();if(!await this.verifyFieldsBeforeSubmit())return void Xc.a.instance.track("onboarding_registration_submit_failed");let t="",a=null,n=null;switch(this.state.loginType){case lC.Email:case lC.MatrixId:t=this.props.username;break;case lC.Phone:a=this.props.phoneCountry,n=this.props.phoneNumber}this.props.onSubmit(t,a,n,this.state.password)}),Fe()(this,"onUsernameChanged",e=>{this.props.onUsernameChanged(e.target.value)}),Fe()(this,"onUsernameFocus",()=>{this.state.loginType===lC.MatrixId?Xc.a.instance.track("onboarding_login_mxid_focus"):Xc.a.instance.track("onboarding_login_email_focus")}),Fe()(this,"onUsernameBlur",e=>{this.state.loginType===lC.MatrixId?Xc.a.instance.track("onboarding_login_mxid_blur"):Xc.a.instance.track("onboarding_login_email_blur"),this.props.onUsernameBlur(e.target.value)}),Fe()(this,"onLoginTypeChange",e=>{const t=e.target.value;this.setState({loginType:t}),this.props.onUsernameChanged(""),Xc.a.instance.track("onboarding_login_type_changed",{loginType:t})}),Fe()(this,"onPhoneCountryChanged",e=>{this.props.onPhoneCountryChanged(e.iso2)}),Fe()(this,"onPhoneNumberChanged",e=>{this.props.onPhoneNumberChanged(e.target.value)}),Fe()(this,"onPhoneNumberFocus",()=>{Xc.a.instance.track("onboarding_login_phone_number_focus")}),Fe()(this,"onPhoneNumberBlur",e=>{Xc.a.instance.track("onboarding_login_phone_number_blur")}),Fe()(this,"onPasswordChanged",e=>{this.setState({password:e.target.value})}),Fe()(this,"handleClickShowPassword",()=>{this.setState({showPassword:!this.state.showPassword})}),Fe()(this,"validateUsernameRules",Object(lm.a)({rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(ts.a)("Enter username")}]})),Fe()(this,"onUsernameValidate",async e=>{const t=await this.validateUsernameRules(e);return this.markFieldValid(lC.MatrixId,t.valid),t}),Fe()(this,"validateEmailRules",Object(lm.a)({rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(ts.a)("Enter email address")},{key:"email",test:e=>{let{value:t}=e;return!t||YS.a(t)},invalid:()=>Object(ts.a)("Doesn't look like a valid email address")}]})),Fe()(this,"onEmailValidate",async e=>{const t=await this.validateEmailRules(e);return this.markFieldValid(lC.Email,t.valid),t}),Fe()(this,"validatePhoneNumberRules",Object(lm.a)({rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(ts.a)("Enter phone number")},{key:"number",test:e=>{let{value:t}=e;return!t||rC.test(t)},invalid:()=>Object(ts.a)("That phone number doesn't look quite right, please check and try again")}]})),Fe()(this,"onPhoneNumberValidate",async e=>{const t=await this.validatePhoneNumberRules(e);return this.markFieldValid(lC.Password,t.valid),t}),Fe()(this,"validatePasswordRules",Object(lm.a)({rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(ts.a)("Enter password")}]})),Fe()(this,"onPasswordValidate",async e=>{const t=await this.validatePasswordRules(e);return this.markFieldValid(lC.Password,t.valid),t}),this.state={fieldValid:{},loginType:lC.MatrixId,password:"",showPassword:!1}}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[this.state.loginType,lC.Password];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise(e=>this.setState({},e)),this.allFieldsValid())return!0;const a=this.findFirstInvalidField(t);return!a||(a.focus(),a.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){const e=Object.keys(this.state.fieldValid);for(let t=0;t<e.length;++t)if(!this.state.fieldValid[e[t]])return!1;return!0}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}markFieldValid(e,t){const{fieldValid:a}=this.state;a[e]=t,this.setState({fieldValid:a})}renderLoginField(e,t){const a={error:!1};switch(e){case lC.Email:return a.error=this.props.loginIncorrect&&!this.props.username,i.a.createElement(rm.a,{className:Hn()(a),name:"username",key:"email_input",type:"text",label:Object(ts.a)("Email"),placeholder:"joe@example.com",value:this.props.username,onChange:this.onUsernameChanged,onFocus:this.onUsernameFocus,onBlur:this.onUsernameBlur,disabled:this.props.disableSubmit,autoFocus:t,onValidate:this.onEmailValidate,ref:e=>this[lC.Email]=e});case lC.MatrixId:return a.error=this.props.loginIncorrect&&!this.props.username,i.a.createElement(rm.a,{className:Hn()(a),name:"username",key:"username_input",type:"text",placeholder:"Số điện thoại/ID đăng nhập",value:this.props.username,onChange:this.onUsernameChanged,onFocus:this.onUsernameFocus,onBlur:this.onUsernameBlur,disabled:this.props.disableSubmit,autoFocus:t,onValidate:this.onUsernameValidate,ref:e=>this[lC.MatrixId]=e});case lC.Phone:{a.error=this.props.loginIncorrect&&!this.props.phoneNumber;const e=i.a.createElement(aC,{value:this.props.phoneCountry,isSmall:!0,showPrefix:!0,onOptionChange:this.onPhoneCountryChanged});return i.a.createElement(rm.a,{className:Hn()(a),name:"phoneNumber",key:"phone_input",type:"text",label:Object(ts.a)("Phone"),value:this.props.phoneNumber,prefixComponent:e,onChange:this.onPhoneNumberChanged,onFocus:this.onPhoneNumberFocus,onBlur:this.onPhoneNumberBlur,disabled:this.props.disableSubmit,autoFocus:t,onValidate:this.onPhoneNumberValidate,ref:e=>this[lC.Password]=e})}}}isLoginEmpty(){switch(this.state.loginType){case lC.Email:case lC.MatrixId:return!this.props.username;case lC.Phone:return!this.props.phoneCountry||!this.props.phoneNumber}}render(){let e;this.props.onForgotPasswordClick&&(e=i.a.createElement(Fs.a,{className:"mx_Login_forgot",disabled:this.props.busy,kind:"link",onClick:this.onForgotPasswordClick},Object(ts.a)("Forgot password?")));const t={color:"#EF4949",fontSize:"1.5rem"},a=(this.onRegisterClick,Hn()({error:this.props.loginIncorrect&&!this.isLoginEmpty()})),s=!this.isLoginEmpty(),o=this.renderLoginField(this.state.loginType,!s);let r;return $c.a.get().disable_3pid_login||(r=i.a.createElement("div",{className:"mx_Login_type_container"},i.a.createElement("label",{className:"mx_Login_type_label"},Object(ts.a)("Sign in with")),i.a.createElement(rm.a,{element:"select",value:this.state.loginType,onChange:this.onLoginTypeChange,disabled:this.props.disableSubmit},i.a.createElement("option",{key:lC.MatrixId,value:lC.MatrixId},Object(ts.a)("Username")),i.a.createElement("option",{key:lC.Email,value:lC.Email},Object(ts.a)("Email address")),i.a.createElement("option",{key:lC.Password,value:lC.Password},Object(ts.a)("Phone"))))),i.a.createElement("div",{className:"form-login"},i.a.createElement("form",{onSubmit:this.onSubmitForm},i.a.createElement("div",{className:"flex align-item-end login-logo"},i.a.createElement("img",{src:"themes/element/img/backgrounds/logo.png",alt:""}),i.a.createElement("p",{className:"text-logo-login"},"Hỗ trợ bởi U.S. CDC/PATH")),i.a.createElement("div",{className:"auth_title"},i.a.createElement("span",null,"Số điện thoại/ID đăng nhập")),o,i.a.createElement("div",{className:"auth_title"},i.a.createElement("span",null," Mật Khẩu")),i.a.createElement(rm.a,{className:a,name:"password",placeholder:"Mật khẩu",value:this.state.password,onChange:this.onPasswordChanged,disabled:this.props.disableSubmit,autoFocus:s,onValidate:this.onPasswordValidate,ref:e=>this[lC.Password]=e,type:this.state.showPassword?"text":"password",iconEnd:i.a.createElement(n.IconButton,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,edge:"end"},this.state.showPassword?i.a.createElement(cl.Visibility,null):i.a.createElement(cl.VisibilityOff,null))}),i.a.createElement("div",{className:"block-other-info "},i.a.createElement(n.FormControlLabel,{style:{fontSize:"16px",color:"black"},control:i.a.createElement(n.Checkbox,{name:"save-info"}),label:"Lưu thông tin"}),i.a.createElement(n.Button,{className:"btn-forget-password"},"Quên Mật Khẩu?")),!this.props.busy&&i.a.createElement("input",{className:"mx_Login_submit",type:"submit",value:"Đăng nhập",disabled:this.props.disableSubmit}),i.a.createElement("hr",null)),i.a.createElement("div",{className:"Auth_footer",style:{marginTop:"6rem",height:"100%"}},i.a.createElement("p",null,"Thông tin hỗ trợ"),i.a.createElement("div",{className:"contact-info"},i.a.createElement(oC.a,{style:t})," Chuyên Môn: 0123 456 7890"),i.a.createElement("div",{className:"contact-info"},i.a.createElement(oC.a,{style:t})," Phần mềm: 0123 456 7890")))}},Fe()(sC,"defaultProps",{onUsernameChanged:function(){},onUsernameBlur:function(){},onPhoneCountryChanged:function(){},onPhoneNumberChanged:function(){},loginIncorrect:!1,disableSubmit:!1}),nC=sC))||nC;var dC=a(150);const mC=["matrixClient","loginType","fragmentAfterLogin","idp","primary","mini"],uC=e=>{let{matrixClient:t,loginType:n,fragmentAfterLogin:s,idp:o,primary:r,mini:l}=e,c=te()(e,mC);const d=o?Object(ts.a)("Continue with %(provider)s",{provider:o.name}):Object(ts.a)("Sign in with single sign-on"),m=()=>{Rd.a.get().startSingleSignOn(t,n,s,null==o?void 0:o.id)};let h,p;const g=o?(e=>{switch(e){case KS.a.Apple:return a(8405);case KS.a.Facebook:return a(8406);case KS.a.Github:return a(8407);case KS.a.Gitlab:return a(8408);case KS.a.Google:return a(8409);case KS.a.Twitter:return a(8410);default:return null}})(o.brand):null;if(g){const e=o.brand.split(".").pop();p="mx_SSOButton_brand_"+e,h=i.a.createElement("img",{src:g,height:"24",width:"24",alt:e})}else if("string"==typeof(null==o?void 0:o.icon)&&o.icon.startsWith("mxc://")){const e=Object(Os.b)(o.icon,t).getSquareThumbnailHttp(24);h=i.a.createElement("img",{src:e,height:"24",width:"24",alt:o.name})}const f=Hn()("mx_SSOButton",{[p]:p,mx_SSOButton_mini:l,mx_SSOButton_default:!o,mx_SSOButton_primary:r});return l?i.a.createElement(is.a,u()({},c,{title:d,className:f,onClick:m}),h):i.a.createElement(Fs.a,u()({},c,{className:f,onClick:m}),h,d)};var hC,pC=e=>{let{matrixClient:t,flow:a,loginType:n,fragmentAfterLogin:s,primary:o}=e;const r=a.identity_providers||[];if(r.length<2)return i.a.createElement("div",{className:"mx_SSOButtons"},i.a.createElement(uC,{matrixClient:t,loginType:n,fragmentAfterLogin:s,idp:r[0],primary:o}));const l=Math.ceil(r.length/6),c=Math.ceil(r.length/l);return i.a.createElement("div",{className:"mx_SSOButtons"},Object(dC.chunk)(r,c).map(e=>i.a.createElement("div",{key:e[0].id,className:"mx_SSOButtons_row"},e.map(e=>i.a.createElement(uC,{key:e.id,matrixClient:t,loginType:n,fragmentAfterLogin:s,idp:e,mini:!0,primary:o})))))},gC=a(339),fC=a(418),vC=a(498);let bC=Object(os.a)("views.dialogs.ServerPickerDialog")(hC=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"defaultServer",void 0),Fe()(this,"fieldRef",Object(s.createRef)()),Fe()(this,"validatedConf",void 0),Fe()(this,"onDefaultChosen",()=>{this.setState({defaultChosen:!0})}),Fe()(this,"onOtherChosen",()=>{this.setState({defaultChosen:!1})}),Fe()(this,"onHomeserverChange",e=>{this.setState({otherHomeserver:e.target.value})}),Fe()(this,"validate",Object(lm.a)({deriveData:async e=>{let{value:t}=e,a=t.trim();if(!a.includes("://"))try{const e=await fC.a.findClientConfig(a);return this.validatedConf=tE.b.buildValidatedConfigFromDiscovery(a,e),{}}catch(e){console.error(`Attempted ${a} as a server_name but it failed`,e)}a.includes("://")||(a="https://"+a);try{return this.validatedConf=await tE.b.validateServerConfigWithStaticUrls(a),{}}catch(e){console.error(e);if(tE.b.authComponentStateForError(e).serverErrorIsFatal){let t=Object(ts.a)("Unable to validate homeserver");return e.translatedMessage&&(t=e.translatedMessage),{error:t}}try{return this.validatedConf=await tE.b.validateServerConfigWithStaticUrls(a,null,!0),{}}catch(e){return console.error(e),{error:Object(ts.a)("Invalid URL")}}}},rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(ts.a)("Specify a homeserver")},{key:"valid",test:async function(e,t){let{value:a}=e,{error:n}=t;return!a||!n},invalid:function(e){let{error:t}=e;return t}}]})),Fe()(this,"onHomeserverValidate",e=>this.validate(e)),Fe()(this,"onSubmit",async e=>{e.preventDefault();if(!await this.fieldRef.current.validate({allowEmpty:!1})&&!this.state.defaultChosen)return this.fieldRef.current.focus(),void this.fieldRef.current.validate({allowEmpty:!1,focused:!0});this.props.onFinished(this.state.defaultChosen?this.defaultServer:this.validatedConf)});const t=$c.a.get();this.defaultServer=t.validated_server_config;const{serverConfig:a}=this.props;let n="";a.isDefault||(n=a.isNameResolvable&&a.hsName?a.hsName:a.hsUrl),this.state={defaultChosen:a.isDefault,otherHomeserver:n}}render(){let e;"matrix.org"===this.defaultServer.hsName&&(e=Object(ts.a)("Matrix.org is the biggest public homeserver in the world, so it’s a good place for many."));let t=this.defaultServer.hsName;return this.defaultServer.hsNameIsDifferent&&(t=i.a.createElement(gC.a,{class:"mx_Login_underlinedServerName",tooltip:this.defaultServer.hsUrl},this.defaultServer.hsName)),i.a.createElement(hu.a,{title:this.props.title||Object(ts.a)("Sign into your homeserver"),className:"mx_ServerPickerDialog",contentId:"mx_ServerPickerDialog",onFinished:this.props.onFinished,fixedWidth:!1,hasCancel:!0},i.a.createElement("form",{className:"mx_Dialog_content",id:"mx_ServerPickerDialog",onSubmit:this.onSubmit},i.a.createElement("p",null,Object(ts.a)("We call the places where you can host your account ‘homeservers’.")," ",e),i.a.createElement(vC.a,{name:"defaultChosen",value:"true",checked:this.state.defaultChosen,onChange:this.onDefaultChosen},t),i.a.createElement(vC.a,{name:"defaultChosen",value:"false",className:"mx_ServerPickerDialog_otherHomeserverRadio",checked:!this.state.defaultChosen,onChange:this.onOtherChosen},i.a.createElement(rm.a,{type:"text",className:"mx_ServerPickerDialog_otherHomeserver",label:Object(ts.a)("Other homeserver"),onChange:this.onHomeserverChange,onClick:this.onOtherChosen,ref:this.fieldRef,onValidate:this.onHomeserverValidate,value:this.state.otherHomeserver,validateOnChange:!1,validateOnFocus:!1,id:"mx_homeserverInput"})),i.a.createElement("p",null,Object(ts.a)("Use your preferred Matrix homeserver if you have one, or host your own.")),i.a.createElement(Fs.a,{className:"mx_ServerPickerDialog_continue",kind:"primary",onClick:this.onSubmit},Object(ts.a)("Continue")),i.a.createElement("h4",null,Object(ts.a)("Learn more")),i.a.createElement("a",{href:"https://matrix.org/faq/#what-is-a-homeserver%3F",target:"_blank",rel:"noreferrer noopener"},Object(ts.a)("About homeservers"))))}})||hC;const yC=()=>{qd.a.createTrackedDialog("Custom Server Dialog","",nu.a,{title:Object(ts.a)("Server Options"),description:Object(ts.a)("You can use the custom server options to sign into other Matrix servers by specifying a different homeserver URL. This allows you to use Element with an existing Matrix account on a different homeserver."),button:Object(ts.a)("Dismiss"),hasCloseButton:!1,fixedWidth:!1},"mx_ServerPicker_helpDialog")};var EC,_C=e=>{let t,{title:a,dialogTitle:n,serverConfig:s,onServerConfigChange:o}=e;if(!$c.a.get().disable_custom_urls&&o){const e=()=>{((e,t,a)=>{qd.a.createTrackedDialog("Server Picker","",bC,{title:e,serverConfig:t,onFinished:a})})(n,s,e=>{e&&o(e)})};t=i.a.createElement(Fs.a,{className:"mx_ServerPicker_change",kind:"link",onClick:e},Object(ts.a)("Edit"))}let r,l=s.isNameResolvable?s.hsName:s.hsUrl;return s.hsNameIsDifferent&&(l=i.a.createElement(gC.a,{class:"mx_Login_underlinedServerName",tooltip:s.hsUrl},s.hsName)),"matrix.org"===s.hsName&&(r=i.a.createElement("span",{className:"mx_ServerPicker_desc"},Object(ts.a)("Join millions for free on the largest public server"))),i.a.createElement("div",{className:"mx_ServerPicker"},i.a.createElement("h3",null,a||Object(ts.a)("Homeserver")),i.a.createElement(Fs.a,{className:"mx_ServerPicker_help",onClick:yC}),i.a.createElement("span",{className:"mx_ServerPicker_server"},l),t,r)};function SC(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function CC(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?SC(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):SC(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}Object(ts.b)("Invalid homeserver discovery response"),Object(ts.b)("Failed to get autodiscovery configuration from server"),Object(ts.b)("Invalid base_url for m.homeserver"),Object(ts.b)("Homeserver URL does not appear to be a valid Matrix homeserver"),Object(ts.b)("Invalid identity server discovery response"),Object(ts.b)("Invalid base_url for m.identity_server"),Object(ts.b)("Identity server URL does not appear to be a valid identity server"),Object(ts.b)("General failure");let wC=Object(os.a)("structures.auth.LoginComponent")(EC=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"unmounted",!1),Fe()(this,"loginLogic",void 0),Fe()(this,"isEnableServerPickup",$c.a.get().disable_custom_urls),Fe()(this,"stepRendererMap",void 0),Fe()(this,"isBusy",()=>this.state.busy||this.props.busy),Fe()(this,"onPasswordLogin",async(e,t,a,n)=>{if(!this.state.serverIsAlive){this.setState({busy:!0});let e=!0;try{await tE.b.validateServerConfigWithStaticUrls(this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl),this.setState({serverIsAlive:!0,errorText:""})}catch(t){const a=tE.b.authComponentStateForError(t);this.setState(CC({busy:!1,busyLoggingIn:!1},a)),e=!a.serverErrorIsFatal}if(!e)return}this.setState({busy:!0,busyLoggingIn:!0,errorText:null,loginIncorrect:!1}),this.loginLogic.loginViaPassword(e,t,a,n).then(e=>{this.setState({serverIsAlive:!0}),this.props.onLoggedIn(e,n)},t=>{if(this.unmounted)return;let a;const n=e.indexOf("@")>0;if(400===t.httpStatus&&n)a=Object(ts.a)("This homeserver does not support login using email address.");else if("M_RESOURCE_LIMIT_EXCEEDED"===t.errcode){const e=Object(Td.a)(t.data.limit_type,t.data.admin_contact,{monthly_active_user:Object(ts.b)("This homeserver has hit its Monthly Active User limit."),hs_blocked:Object(ts.b)("This homeserver has been blocked by it's administrator."),"":Object(ts.b)("This homeserver has exceeded one of its resource limits.")}),n=Object(Td.a)(t.data.limit_type,t.data.admin_contact,{"":Object(ts.b)("Please <a>contact your service administrator</a> to continue using this service.")});a=i.a.createElement("div",null,i.a.createElement("div",null,e),i.a.createElement("div",{className:"mx_Login_smallError"},n))}else a=401===t.httpStatus||403===t.httpStatus?"M_USER_DEACTIVATED"===t.errcode?Object(ts.a)("This account has been deactivated."):$c.a.get().disable_custom_urls?i.a.createElement("div",null,i.a.createElement("div",null,Object(ts.a)("Incorrect username and/or password.")),i.a.createElement("div",{className:"mx_Login_smallError"},Object(ts.a)("Please note you are logging into the %(hs)s server, not matrix.org.",{hs:this.props.serverConfig.hsName}))):Object(ts.a)("Incorrect username and/or password."):this.errorTextFromError(t);this.setState({busy:!1,busyLoggingIn:!1,errorText:a,loginIncorrect:401===t.httpStatus||403===t.httpStatus})})}),Fe()(this,"onUsernameChanged",e=>{this.setState({username:e})}),Fe()(this,"onUsernameBlur",async e=>{const t="@"===e[0];if(this.setState({username:e,busy:t,errorText:null,canTryLogin:!0}),t){const t=e.split(":").slice(1).join(":");try{const e=await tE.b.validateServerName(t);this.props.onServerConfigChange(e),this.setState({busy:!1})}catch(e){console.error("Problem parsing URL or unhandled error doing .well-known discovery:",e);let t=Object(ts.a)("Failed to perform homeserver discovery");e.translatedMessage&&(t=e.translatedMessage);let a=t,n={};tE.b.isLivelinessError(e)&&(a=this.state.errorText,n=tE.b.authComponentStateForError(e)),this.setState(CC({busy:!1,errorText:a},n))}}}),Fe()(this,"onPhoneCountryChanged",e=>{this.setState({phoneCountry:e})}),Fe()(this,"onPhoneNumberChanged",e=>{this.setState({phoneNumber:e})}),Fe()(this,"onRegisterClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onRegisterClick()}),Fe()(this,"onTryRegisterClick",e=>{var t,a;const n=null===(t=this.state.flows)||void 0===t?void 0:t.find(e=>"m.login.password"===e.type),s=null===(a=this.state.flows)||void 0===a?void 0:a.find(e=>"m.login.sso"===e.type||"m.login.cas"===e.type);if(s&&!n){e.preventDefault(),e.stopPropagation();const t="m.login.sso"===s.type?"sso":"cas";Rd.a.get().startSingleSignOn(this.loginLogic.createTemporaryClient(),t,this.props.fragmentAfterLogin)}else this.onRegisterClick(e)}),Fe()(this,"isSupportedFlow",e=>!!this.stepRendererMap[e.type]||(console.log("Skipping flow",e,"due to unsupported login type",e.type),!1)),Fe()(this,"renderPasswordStep",()=>i.a.createElement(cC,{onSubmit:this.onPasswordLogin,username:this.state.username,phoneCountry:this.state.phoneCountry,phoneNumber:this.state.phoneNumber,onUsernameChanged:this.onUsernameChanged,onUsernameBlur:this.onUsernameBlur,onPhoneCountryChanged:this.onPhoneCountryChanged,onPhoneNumberChanged:this.onPhoneNumberChanged,onForgotPasswordClick:this.props.onForgotPasswordClick,loginIncorrect:this.state.loginIncorrect,serverConfig:this.props.serverConfig,disableSubmit:this.isBusy(),busy:this.props.isSyncing||this.state.busyLoggingIn,onRegisterClick:this.props.onRegisterClick})),Fe()(this,"renderSsoStep",e=>{const t=this.state.flows.find(t=>t.type==="m.login."+e);return i.a.createElement(pC,{matrixClient:this.loginLogic.createTemporaryClient(),flow:t,loginType:e,fragmentAfterLogin:this.props.fragmentAfterLogin,primary:!this.state.flows.find(e=>"m.login.password"===e.type)})}),this.state={busy:!1,busyLoggingIn:null,errorText:null,loginIncorrect:!1,canTryLogin:!0,flows:null,username:e.defaultUsername?e.defaultUsername:"",phoneCountry:null,phoneNumber:"",serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:""},this.stepRendererMap={"m.login.password":this.renderPasswordStep},Xc.a.instance.track("onboarding_login_begin")}UNSAFE_componentWillMount(){this.initLoginLogic(this.props.serverConfig)}componentWillUnmount(){this.unmounted=!0}UNSAFE_componentWillReceiveProps(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||this.initLoginLogic(e.serverConfig)}async initLoginLogic(e){let{hsUrl:t,isUrl:a}=e,n=!1;this.props.serverConfig.isDefault&&t===this.props.serverConfig.hsUrl&&a===this.props.serverConfig.isUrl&&(n=!0);const s=n?this.props.fallbackHsUrl:null,i=new KS.b(t,a,s,{defaultDeviceDisplayName:this.props.defaultDeviceDisplayName});this.loginLogic=i,this.setState({busy:!0,loginIncorrect:!1});try{const{warning:e}=await tE.b.validateServerConfigWithStaticUrls(t,a);e?this.setState(CC(CC({},tE.b.authComponentStateForError(e)),{},{errorText:""})):this.setState({serverIsAlive:!0,errorText:""})}catch(e){this.setState(CC({busy:!1},tE.b.authComponentStateForError(e)))}i.getFlows().then(e=>{const t=e.filter(this.isSupportedFlow);t.length>0?this.setState({flows:t}):this.setState({errorText:Object(ts.a)("This homeserver doesn't offer any login flows which are supported by this client.")})},e=>{this.setState({errorText:this.errorTextFromError(e),loginIncorrect:!1,canTryLogin:!1})}).finally(()=>{this.setState({busy:!1})})}errorTextFromError(e){let t=e.errcode;!t&&e.httpStatus&&(t="HTTP "+e.httpStatus);let a="Thông tin đăng nhập không chính xác, vui lòng thử lại";return"rejected"===e.cors&&(a="https:"!==window.location.protocol||!this.props.serverConfig.hsUrl.startsWith("http:")&&this.props.serverConfig.hsUrl.startsWith("http")?i.a.createElement("span",null,Object(ts.a)("Can't connect to homeserver - please check your connectivity, ensure your <a>homeserver's SSL certificate</a> is trusted, and that a browser extension is not blocking requests.",{},{a:e=>i.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:this.props.serverConfig.hsUrl},e)})):i.a.createElement("span",null,Object(ts.a)("Can't connect to homeserver via HTTP when an HTTPS URL is in your browser bar. Either use HTTPS or <a>enable unsafe scripts</a>.",{},{a:e=>i.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://www.google.com/search?&q=enable%20unsafe%20scripts"},e)}))),a}renderLoginComponentForFlows(){if(!this.state.flows)return null;const e=["m.login.password","m.login.sso"].map(e=>this.state.flows.find(t=>t.type===e)).filter(Boolean);return i.a.createElement(i.a.Fragment,null,e.map(e=>{const t=this.stepRendererMap[e.type];return i.a.createElement(i.a.Fragment,{key:e.type},t())}))}render(){const e=On.getComponent("auth.AuthHeader"),t=On.getComponent("auth.AuthBody"),a=(this.isBusy()&&!this.state.busyLoggingIn&&Jc.a,this.state.errorText);let n,s,o;if(a&&(n=i.a.createElement("div",{className:"mx_Login_error"},a)),!this.state.serverIsAlive){const e=Hn()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});s=i.a.createElement("div",{className:e},this.state.serverDeadError)}this.props.isSyncing||this.state.busyLoggingIn?o=i.a.createElement("div",{className:"mx_AuthBody_paddedFooter"},i.a.createElement("div",{className:"mx_AuthBody_paddedFooter_title"},i.a.createElement(Cu.a,{w:20,h:20}),this.props.isSyncing?Object(ts.a)("Syncing..."):Object(ts.a)("Signing In...")),this.props.isSyncing&&i.a.createElement("div",{className:"mx_AuthBody_paddedFooter_subtitle"},Object(ts.a)("If you've joined lots of rooms, this might take a while"))):ss.b.getValue(vu.a.Registration)&&(o=i.a.createElement("span",{className:"mx_AuthBody_changeFlow"},Object(ts.a)("New? <a>Create account</a>",{},{a:e=>i.a.createElement("a",{onClick:this.onTryRegisterClick,href:"#"},e)})));return i.a.createElement(qS,{style:{marginTop:"0px !important",height:" 100vh"}},i.a.createElement(e,{disableLanguageSelector:this.props.isSyncing||this.state.busyLoggingIn}),i.a.createElement(t,{style:{display:"flex",flexDirection:"column",height:"100vh"}},n,s,i.a.createElement(_C,{serverConfig:this.props.serverConfig,onServerConfigChange:this.props.onServerConfigChange}),this.renderLoginComponentForFlows()))}})||EC;var OC;function xC(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}let RC=Object(os.a)("structures.auth.Registration")(OC=class extends i.a.Component{constructor(e){super(e),Fe()(this,"loginLogic",void 0),Fe()(this,"onFormSubmit",e=>{this.setState({errorText:"",busy:!0,formVals:e,doingUIAuth:!0})}),Fe()(this,"requestEmailToken",(e,t,a,n)=>this.state.matrixClient.requestRegisterEmailToken(e,t,a,this.props.makeRegistrationUrl({client_secret:t,hs_url:this.state.matrixClient.getHomeserverUrl(),is_url:this.state.matrixClient.getIdentityServerUrl(),session_id:n}))),Fe()(this,"onUIAuthFinished",async(e,t,a)=>{if(!e){let e=t.message||t.toString();if("M_RESOURCE_LIMIT_EXCEEDED"===t.errcode){const a=Object(Td.a)(t.data.limit_type,t.data.admin_contact,{monthly_active_user:Object(ts.b)("This homeserver has hit its Monthly Active User limit."),hs_blocked:Object(ts.b)("This homeserver has been blocked by it's administrator."),"":Object(ts.b)("This homeserver has exceeded one of its resource limits.")}),n=Object(Td.a)(t.data.limit_type,t.data.admin_contact,{"":Object(ts.b)("Please <a>contact your service administrator</a> to continue using this service.")});e=i.a.createElement("div",null,i.a.createElement("p",null,a),i.a.createElement("p",null,n))}else if(t.required_stages&&t.required_stages.indexOf("m.login.msisdn")>-1){let a=!1;for(const e of t.available_flows)a=a||e.stages.includes("m.login.msisdn");a||(e=Object(ts.a)("This server does not support authentication with a phone number."))}else"M_USER_IN_USE"===t.errcode&&(e=Object(ts.a)("That username already exists, please try another."));return void this.setState({busy:!1,doingUIAuth:!1,errorText:e})}Cs.a.setJustRegisteredUserId(t.user_id);const n={doingUIAuth:!1,registeredUsername:t.user_id,differentLoggedInUserId:null,completedNoSignin:!1,busy:!0},[s,o]=await Jy.b();s&&!o&&s!==t.userId&&(console.log(`Found a session for ${s} but ${t.userId} has just registered.`),n.differentLoggedInUserId=s),t.access_token?(await this.props.onLoggedIn({userId:t.user_id,deviceId:t.device_id,homeserverUrl:this.state.matrixClient.getHomeserverUrl(),identityServerUrl:this.state.matrixClient.getIdentityServerUrl(),accessToken:t.access_token},this.state.formVals.password),this.setupPushers()):(n.busy=!1,n.completedNoSignin=!0),this.setState(n)}),Fe()(this,"onLoginClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onLoginClick()}),Fe()(this,"onGoToFormClicked",e=>{e.preventDefault(),e.stopPropagation(),this.replaceClient(this.props.serverConfig),this.setState({busy:!1,doingUIAuth:!1})}),Fe()(this,"makeRegisterRequest",e=>{let t=Boolean(this.state.formVals.email);this.state.formVals.password||(t=null);const a={username:this.state.formVals.username,password:this.state.formVals.password,initial_device_display_name:this.props.defaultDeviceDisplayName,auth:void 0,inhibit_login:void 0};return e&&(a.auth=e),null!=t&&(a.inhibit_login=t),this.state.matrixClient.registerRequest(a)}),Fe()(this,"onLoginClickWithCheck",async e=>{e.preventDefault();const t=await Jy.i({ignoreGuest:!0});return t||this.props.onLoginClick(),t}),this.state={busy:!1,errorText:null,formVals:{email:this.props.email},doingUIAuth:Boolean(this.props.sessionId),flows:null,completedNoSignin:!1,serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:""};const{hsUrl:t,isUrl:a}=this.props.serverConfig;this.loginLogic=new KS.b(t,a,null,{defaultDeviceDisplayName:"Element login check"})}componentDidMount(){this.replaceClient(this.props.serverConfig)}UNSAFE_componentWillReceiveProps(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||this.replaceClient(e.serverConfig)}async replaceClient(e){this.setState({errorText:null,serverDeadError:null,serverErrorIsFatal:!1,busy:!0});try{await tE.b.validateServerConfigWithStaticUrls(e.hsUrl,e.isUrl),this.setState({serverIsAlive:!0,serverErrorIsFatal:!1})}catch(e){if(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xC(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xC(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({busy:!1},tE.b.authComponentStateForError(e,"register"))),this.state.serverErrorIsFatal)return}const{hsUrl:t,isUrl:a}=e,n=Object(Gy.createClient)({baseUrl:t,idBaseUrl:a});let s;this.loginLogic.setHomeserverUrl(t),this.loginLogic.setIdentityServerUrl(a);try{s=(await this.loginLogic.getFlows()).find(e=>"m.login.sso"===e.type||"m.login.cas"===e.type)}catch(e){console.error("Failed to get login flows to check for SSO support",e)}this.setState({matrixClient:n,ssoFlow:s,busy:!1});const i=e=>{this.setState({errorText:Object(ts.a)("Unable to query for supported registration methods."),flows:[]})};try{this.state.doingUIAuth||(await this.makeRegisterRequest(null),console.log("Expecting 401 from register request but got success!"))}catch(e){401===e.httpStatus?this.setState({flows:e.data.flows}):403===e.httpStatus||"M_FORBIDDEN"===e.errcode?s?gn.a.dispatch({action:"start_login"}):this.setState({serverErrorIsFatal:!0,errorText:Object(ts.a)("Registration has been disabled on this homeserver."),flows:[]}):(console.log("Unable to query for supported registration methods.",e),i())}}setupPushers(){if(!this.props.brand)return Promise.resolve();const e=Cs.a.get();return e.getPushers().then(t=>{const a=t.pushers;for(let t=0;t<a.length;++t)if("email"===a[t].kind){const n=a[t];n.data={brand:this.props.brand},e.setPusher(n).then(()=>{console.log("Set email branding to "+this.props.brand)},e=>{console.error("Couldn't set email branding: "+e)})}},e=>{console.error("Couldn't get pushers: "+e)})}getUIAuthInputs(){return{emailAddress:this.state.formVals.email,phoneCountry:this.state.formVals.phoneCountry,phoneNumber:this.state.formVals.phoneNumber}}renderRegisterComponent(){const e=On.getComponent("structures.InteractiveAuth"),t=On.getComponent("elements.Spinner"),a=On.getComponent("auth.RegistrationForm");if(this.state.matrixClient&&this.state.doingUIAuth)return i.a.createElement(e,{matrixClient:this.state.matrixClient,makeRequest:this.makeRegisterRequest,onAuthFinished:this.onUIAuthFinished,inputs:this.getUIAuthInputs(),requestEmailToken:this.requestEmailToken,sessionId:this.props.sessionId,clientSecret:this.props.clientSecret,emailSid:this.props.idSid,poll:!0});if(!this.state.matrixClient&&!this.state.busy)return null;if(this.state.busy||!this.state.flows)return i.a.createElement("div",{className:"mx_AuthBody_spinner"},i.a.createElement(t,null));if(this.state.flows.length){let e;if(this.state.ssoFlow){let t;(this.state.ssoFlow.identity_providers||[]).length>1&&(t=i.a.createElement("h3",{className:"mx_AuthBody_centered"},Object(ts.a)("Continue with %(ssoButtons)s",{ssoButtons:""}).trim())),e=i.a.createElement(i.a.Fragment,null,t,i.a.createElement(pC,{matrixClient:this.loginLogic.createTemporaryClient(),flow:this.state.ssoFlow,loginType:"m.login.sso"===this.state.ssoFlow.type?"sso":"cas",fragmentAfterLogin:this.props.fragmentAfterLogin}),i.a.createElement("h3",{className:"mx_AuthBody_centered"},Object(ts.a)("%(ssoButtons)s Or %(usernamePassword)s",{ssoButtons:"",usernamePassword:""}).trim()))}return i.a.createElement(i.a.Fragment,null,i.a.createElement(a,{defaultUsername:this.state.formVals.username,defaultEmail:this.state.formVals.email,defaultPhoneCountry:this.state.formVals.phoneCountry,defaultPhoneNumber:this.state.formVals.phoneNumber,defaultPassword:this.state.formVals.password,onRegisterClick:this.onFormSubmit,flows:this.state.flows,serverConfig:this.props.serverConfig,canSubmit:!this.state.serverErrorIsFatal}))}}render(){const e=On.getComponent("auth.AuthHeader"),t=On.getComponent("auth.AuthBody"),a=On.getComponent("elements.AccessibleButton");let n;const s=this.state.errorText;let o;if(s&&(n=i.a.createElement("div",{className:"mx_Login_error"},s)),!this.state.serverIsAlive){const e=Hn()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});o=i.a.createElement("div",{className:e},this.state.serverDeadError)}const r=i.a.createElement("span",{className:"mx_AuthBody_changeFlow"},Object(ts.a)("Already have an account? <a>Sign in here</a>",{},{a:e=>i.a.createElement("a",{onClick:this.onLoginClick,href:"#"},e)}));let l,c;if(this.state.doingUIAuth&&(l=i.a.createElement("a",{className:"mx_AuthBody_changeFlow",onClick:this.onGoToFormClicked,href:"#"},Object(ts.a)("Go back"))),this.state.completedNoSignin){let e;e=this.state.differentLoggedInUserId?i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("Your new account (%(newAccountId)s) is registered, but you're already logged into a different account (%(loggedInUserId)s).",{newAccountId:this.state.registeredUsername,loggedInUserId:this.state.differentLoggedInUserId})),i.a.createElement("p",null,i.a.createElement(a,{element:"span",className:"mx_linkButton",onClick:async e=>{await this.onLoginClickWithCheck(e)&&gn.a.dispatch({action:"view_welcome_page"})}},Object(ts.a)("Continue with previous account")))):this.state.formVals.password?i.a.createElement("h3",null,Object(ts.a)("<a>Log in</a> to your new account.",{},{a:e=>i.a.createElement("a",{href:"#/login",onClick:this.onLoginClickWithCheck},e)})):i.a.createElement("h3",null,Object(ts.a)("You can now close this window or <a>log in</a> to your new account.",{},{a:e=>i.a.createElement("a",{href:"#/login",onClick:this.onLoginClickWithCheck},e)})),c=i.a.createElement("div",null,i.a.createElement("h2",null,Object(ts.a)("Registration Successful")),e)}else c=i.a.createElement("div",null,i.a.createElement("h2",null,Object(ts.a)("Create account")),n,o,i.a.createElement("hr",null),i.a.createElement(_C,{title:Object(ts.a)("Host account on"),dialogTitle:Object(ts.a)("Decide where your account is hosted"),serverConfig:this.props.serverConfig,onServerConfigChange:this.state.doingUIAuth?void 0:this.props.onServerConfigChange}),this.renderRegisterComponent(),l,r);return i.a.createElement(qS,null,i.a.createElement(e,null),i.a.createElement(t,null,c))}})||OC;var kC,IC=a(429);const TC=1,PC=2,NC=3,DC=4,jC=5,AC={"m.login.password":PC,"m.login.cas":NC,"m.login.sso":DC};let MC=Object(os.a)("structures.auth.SoftLogout")(kC=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onClearAll",()=>{const e=On.getComponent("dialogs.ConfirmWipeDeviceDialog");qd.a.createTrackedDialog("Clear Data","Soft Logout",e,{onFinished:e=>{e&&(console.log("Clearing data from soft-logged-out session"),Jy.d(y.a.API_ENPOINT+"/oauth/logout"))}})}),Fe()(this,"onPasswordChange",e=>{this.setState({password:e.target.value})}),Fe()(this,"onForgotPassword",()=>{gn.a.dispatch({action:"start_password_recovery"})}),Fe()(this,"onPasswordLogin",async e=>{e.preventDefault(),e.stopPropagation(),this.setState({busy:!0});const t=Cs.a.get().getHomeserverUrl(),a=Cs.a.get().getIdentityServerUrl(),n={identifier:{type:"m.id.user",user:Cs.a.get().getUserId()},password:this.state.password,device_id:Cs.a.get().getDeviceId()};let s=null;try{s=await Object(KS.c)(t,a,"m.login.password",n)}catch(e){let t=Object(ts.a)("Failed to re-authenticate due to a homeserver problem");return"M_FORBIDDEN"!==e.errcode||401!==e.httpStatus&&403!==e.httpStatus||(t=Object(ts.a)("Incorrect password")),void this.setState({busy:!1,errorText:t})}Jy.f(s).catch(e=>{console.error(e),this.setState({busy:!1,errorText:Object(ts.a)("Failed to re-authenticate")})})}),this.state={loginView:TC,keyBackupNeeded:!0,busy:!1,password:"",errorText:"",flows:[]}}componentDidMount(){if(!Jy.h())return void gn.a.dispatch({action:"start_login"});this.initLogin();const e=Cs.a.get();e.isCryptoEnabled()&&e.countSessionsNeedingBackup().then(e=>{this.setState({keyBackupNeeded:e>0})})}async initLogin(){const e=this.props.realQueryParams;if(e&&e.loginToken)return this.setState({loginView:TC}),void this.trySsoLogin();const t=Cs.a.get(),a=(await t.loginFlows()).flows,n=a.map(e=>AC[e.type]).filter(e=>!!e)[0]||jC;this.setState({flows:a,loginView:n})}async trySsoLogin(){this.setState({busy:!0});const e=localStorage.getItem(IC.a),t=localStorage.getItem(IC.c)||Cs.a.get().getIdentityServerUrl(),a={token:this.props.realQueryParams.loginToken,device_id:Cs.a.get().getDeviceId()};let n=null;try{n=await Object(KS.c)(e,t,"m.login.token",a)}catch(e){return console.error(e),void this.setState({busy:!1,loginView:jC})}Jy.f(n).then(()=>{this.props.onTokenLoginCompleted&&this.props.onTokenLoginCompleted()}).catch(e=>{console.error(e),this.setState({busy:!1,loginView:jC})})}renderSignInSection(){if(this.state.loginView===TC){const e=On.getComponent("elements.Spinner");return i.a.createElement(e,null)}let e=null;if(this.state.keyBackupNeeded&&(e=Object(ts.a)("Regain access to your account and recover encryption keys stored in this session. Without them, you won’t be able to read all of your secure messages in any session.")),this.state.loginView===PC){const t=On.getComponent("elements.Field"),a=On.getComponent("elements.AccessibleButton");let n=null;return this.state.errorText&&(n=i.a.createElement("span",{className:"mx_Login_error"},this.state.errorText)),e||(e=Object(ts.a)("Enter your password to sign in and regain access to your account.")),i.a.createElement("form",{onSubmit:this.onPasswordLogin},i.a.createElement("p",null,e),n,i.a.createElement(t,{type:"password",label:Object(ts.a)("Password"),onChange:this.onPasswordChange,value:this.state.password,disabled:this.state.busy}),i.a.createElement(a,{onClick:this.onPasswordLogin,kind:"primary",type:"submit",disabled:this.state.busy},Object(ts.a)("Sign In")),i.a.createElement(a,{onClick:this.onForgotPassword,kind:"link"},Object(ts.a)("Forgotten your password?")))}if(this.state.loginView===DC||this.state.loginView===NC){e||(e=Object(ts.a)("Sign in and regain access to your account."));const t=this.state.loginView===NC?"cas":"sso",a=this.state.flows.find(e=>e.type==="m.login."+t);return i.a.createElement("div",null,i.a.createElement("p",null,e),i.a.createElement(pC,{matrixClient:Cs.a.get(),flow:a,loginType:t,fragmentAfterLogin:this.props.fragmentAfterLogin,primary:!this.state.flows.find(e=>"m.login.password"===e.type)}))}return i.a.createElement("p",null,Object(ts.a)("You cannot sign in to your account. Please contact your homeserver admin for more information."))}render(){const e=On.getComponent("auth.AuthHeader"),t=On.getComponent("auth.AuthBody"),a=On.getComponent("elements.AccessibleButton");return i.a.createElement(qS,null,i.a.createElement(e,null),i.a.createElement(t,null,i.a.createElement("h2",null,Object(ts.a)("You're signed out")),i.a.createElement("h3",null,Object(ts.a)("Sign in")),i.a.createElement("div",null,this.renderSignInSection()),i.a.createElement("h3",null,Object(ts.a)("Clear personal data")),i.a.createElement("p",null,Object(ts.a)("Warning: Your personal data (including encryption keys) is still stored in this session. Clear it if you're finished using this session, or want to sign in to another account.")),i.a.createElement("div",null,i.a.createElement(a,{onClick:this.onClearAll,kind:"danger"},Object(ts.a)("Clear all data")))))}})||kC;var UC=new class{async register(e){let t=y.a.API_ENPOINT+"/public/auth/register";return v.a.post(t,e)}};var LC,FC,BC=e=>{let{open:t,onYesClick:a}=e;return i.a.createElement(n.Dialog,{maxWidth:"xs",fullWidth:!0,open:t},i.a.createElement("div",{className:"pt-24 px-20 pb-8"},i.a.createElement("h4",{className:"capitalize"},"Register"),i.a.createElement("p",null,"Your account has been created successfully!"),i.a.createElement(n.DialogActions,null,i.a.createElement("div",{className:"flex flex-space-between flex-middle"},i.a.createElement(n.Button,{className:"btn btn-primary",variant:"contained",onClick:a},"Log In")))))};a(8411);let VC=Object(os.a)("views.auth.GlobitsRegistrationForm")((FC=class extends i.a.PureComponent{constructor(e){super(e),this.state={isSubmitting:!1,shouldOpenComfirmDialog:!1}}render(){const e=e=>{let t={displayName:e.firstName+" "+e.lastName,firstName:e.firstName,lastName:e.lastName,userName:e.userName,password:e.password,phoneNumber:e.phoneNumber,gender:e.gender};UC.register(t).then(()=>{this.setState({shouldOpenComfirmDialog:!0})})},t=Ye.object().shape({firstName:Ye.string().required(),lastName:Ye.string().required(),userName:Ye.string().required().min(6,"Too short").max(30,"Too long"),password:Ye.string().required().min(6,"Too short"),confirmPassword:Ye.string().oneOf([Ye.ref("password"),null],"Passwords must match")});return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.Grid,{container:!0,spacing:2},this.state.shouldOpenComfirmDialog&&i.a.createElement(BC,{open:this.state.shouldOpenComfirmDialog,onYesClick:this.props.onLoginClick})),i.a.createElement(Y.Formik,{initialValues:{phoneNumber:"",password:"",firstName:"",lastName:"",userName:"",confirmPassword:""},validationSchema:t,onSubmit:t=>{this.setState({isSubmitting:!0},()=>e(t))}},e=>{let{touched:t,errors:a}=e;return i.a.createElement(Y.Form,{className:"user-accese-form"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"form-group"},i.a.createElement("div",{className:"mx_Field mx_Field_input"},i.a.createElement(Y.Field,{id:"displayName",type:"text",name:"displayName"}),i.a.createElement("label",{htmlFor:"displayName"},"Display Name")),i.a.createElement(Y.ErrorMessage,{component:"div",name:"displayName",className:"invalid-feedback"})),i.a.createElement("div",{className:"form-group"},i.a.createElement("div",{className:"mx_Field mx_Field_input"},i.a.createElement(Y.Field,{id:"birthDate",type:"date",name:"birthDate"}),i.a.createElement("label",{htmlFor:"birthDate"},"Birth Date")),i.a.createElement(Y.ErrorMessage,{component:"div",name:"birthDate",className:"invalid-feedback"}))),i.a.createElement("div",{className:""},i.a.createElement("div",{className:"mx_Field mx_Field_input"},i.a.createElement(Y.Field,{id:"address",type:"text",name:"address"}),i.a.createElement("label",{htmlFor:"address"},"Address")),i.a.createElement(Y.ErrorMessage,{component:"div",name:"address",className:"invalid-feedback"})),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"form-group"},i.a.createElement("div",{className:"mx_Field mx_Field_input"},i.a.createElement(Y.Field,{id:"userName",type:"text",name:"userName"}),i.a.createElement("label",{htmlFor:"userName"},"User Name")),i.a.createElement(Y.ErrorMessage,{component:"div",name:"userName",className:"invalid-feedback"})),i.a.createElement("div",{className:"form-group"},i.a.createElement("div",{className:"mx_Field mx_Field_input"},i.a.createElement(Y.Field,{id:"phoneNumber",type:"phoneNumber",name:"phoneNumber"}),i.a.createElement("label",{htmlFor:"phoneNumber"},"Phone Number")),i.a.createElement(Y.ErrorMessage,{component:"div",name:"phoneNumber",className:"invalid-feedback"}))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"form-group"},i.a.createElement("div",{className:"mx_Field mx_Field_input"},i.a.createElement(Y.Field,{id:"password",type:"text",name:"password"}),i.a.createElement("label",{htmlFor:"password"},"Password")),i.a.createElement(Y.ErrorMessage,{component:"div",name:"password",className:"invalid-feedback"})),i.a.createElement("div",{className:"form-group"},i.a.createElement("div",{className:"mx_Field mx_Field_input"},i.a.createElement(Y.Field,{id:"confirmPassword",type:"text",name:"confirmPassword"}),i.a.createElement("label",{htmlFor:"confirmPassword"},"Confirm Password")),i.a.createElement(Y.ErrorMessage,{component:"div",name:"confirmPassword",className:"invalid-feedback"}))),i.a.createElement("button",{type:"submit",className:"btn btn-primary btn-block btn-submit",disabled:this.state.isSubmitting},this.state.isSubmitting?"Please wait...":"Submit"))}))}},Fe()(FC,"defaultProps",{onValidationChange:console.error,canSubmit:!0}),LC=FC))||LC;var GC=a(342),zC=a(438),WC=a(303);const HC=Object(lm.a)({rules:[{key:"email",test:e=>{let{value:t}=e;return!t||YS.a(t)},invalid:()=>Object(ts.a)("Doesn't look like a valid email address")}]});var KC,qC,YC,$C=e=>{let{onFinished:t}=e;const[a,n]=Object(s.useState)(""),i=Object(s.useRef)(),o=async e=>{if(e.preventDefault(),a){if(!await i.current.validate({allowEmpty:!1}))return i.current.focus(),void i.current.validate({allowEmpty:!1,focused:!0})}t(!0,a)};return s.createElement(hu.a,{title:Object(ts.a)("Continuing without email"),className:"mx_RegistrationEmailPromptDialog",contentId:"mx_RegistrationEmailPromptDialog",onFinished:()=>t(!1),fixedWidth:!1},s.createElement("div",{className:"mx_Dialog_content",id:"mx_RegistrationEmailPromptDialog"},s.createElement("p",null,Object(ts.a)("Just a heads up, if you don't add an email and forget your password, you could <b>permanently lose access to your account</b>.",{},{b:e=>s.createElement("b",null,e)})),s.createElement("form",{onSubmit:o},s.createElement(rm.a,{ref:i,autoFocus:!0,type:"text",label:Object(ts.a)("Email (optional)"),value:a,onChange:e=>{n(e.target.value)},onValidate:async e=>await HC(e),onFocus:()=>Xc.a.instance.track("onboarding_registration_email2_focus"),onBlur:()=>Xc.a.instance.track("onboarding_registration_email2_blur")}))),s.createElement(WC.a,{primaryButton:Object(ts.a)("Continue"),onPrimaryButtonClick:o,hasCancel:!1}))};!function(e){e.Email="field_email",e.PhoneNumber="field_phone_number",e.Username="field_username",e.Password="field_password",e.PasswordConfirm="field_password_confirm"}(YC||(YC={}));let JC=Object(os.a)("views.auth.RegistrationForm")((qC=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"onSubmit",async e=>{if(e.preventDefault(),e.persist(),!this.props.canSubmit)return;if(await this.verifyFieldsBeforeSubmit())if(""===this.state.email){if(!this.showEmail())return void this.doSubmit(e);Xc.a.instance.track("onboarding_registration_submit_warn"),qd.a.createTrackedDialog("Email prompt dialog","",$C,{onFinished:async(t,a)=>{t&&this.setState({email:a},()=>{this.doSubmit(e)})}})}else this.doSubmit(e);else Xc.a.instance.track("onboarding_registration_submit_failed")}),Fe()(this,"onEmailChange",e=>{this.setState({email:e.target.value})}),Fe()(this,"onEmailValidate",async e=>{const t=await this.validateEmailRules(e);return this.markFieldValid(YC.Email,t.valid),t}),Fe()(this,"validateEmailRules",Object(lm.a)({description:()=>Object(ts.a)("Use an email address to recover your account"),hideDescriptionIfValid:!0,rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!this.authStepIsRequired("m.login.email.identity")||!!t},invalid:()=>Object(ts.a)("Enter email address (required on this homeserver)")},{key:"email",test:e=>{let{value:t}=e;return!t||YS.a(t)},invalid:()=>Object(ts.a)("Doesn't look like a valid email address")}]})),Fe()(this,"onPasswordChange",e=>{this.setState({password:e.target.value})}),Fe()(this,"onPasswordValidate",e=>{this.markFieldValid(YC.Password,e.valid)}),Fe()(this,"onPasswordConfirmChange",e=>{this.setState({passwordConfirm:e.target.value})}),Fe()(this,"onPasswordConfirmValidate",async e=>{const t=await this.validatePasswordConfirmRules(e);return this.markFieldValid(YC.PasswordConfirm,t.valid),t}),Fe()(this,"validatePasswordConfirmRules",Object(lm.a)({rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(ts.a)("Confirm password")},{key:"match",test(e){let{value:t}=e;return!t||t===this.state.password},invalid:()=>Object(ts.a)("Passwords don't match")}]})),Fe()(this,"onPhoneCountryChange",e=>{this.setState({phoneCountry:e.iso2})}),Fe()(this,"onPhoneNumberChange",e=>{this.setState({phoneNumber:e.target.value})}),Fe()(this,"onPhoneNumberValidate",async e=>{const t=await this.validatePhoneNumberRules(e);return this.markFieldValid(YC.PhoneNumber,t.valid),t}),Fe()(this,"validatePhoneNumberRules",Object(lm.a)({description:()=>Object(ts.a)("Other users can invite you to rooms using your contact details"),hideDescriptionIfValid:!0,rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!this.authStepIsRequired("m.login.msisdn")||!!t},invalid:()=>Object(ts.a)("Enter phone number (required on this homeserver)")},{key:"email",test:e=>{let{value:t}=e;return!t||(a=t,$S.test(a));var a},invalid:()=>Object(ts.a)("That phone number doesn't look quite right, please check and try again")}]})),Fe()(this,"onUsernameChange",e=>{this.setState({username:e.target.value})}),Fe()(this,"onUsernameValidate",async e=>{const t=await this.validateUsernameRules(e);return this.markFieldValid(YC.Username,t.valid),t}),Fe()(this,"validateUsernameRules",Object(lm.a)({description:()=>Object(ts.a)("Use lowercase letters, numbers, dashes and underscores only"),hideDescriptionIfValid:!0,rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(ts.a)("Enter username")},{key:"safeLocalpart",test:e=>{let{value:t}=e;return!t||Zy.a.test(t)},invalid:()=>Object(ts.a)("Some characters not allowed")}]})),this.state={fieldValid:{},phoneCountry:this.props.defaultPhoneCountry,username:this.props.defaultUsername||"",email:this.props.defaultEmail||"",phoneNumber:this.props.defaultPhoneNumber||"",password:this.props.defaultPassword||"",passwordConfirm:this.props.defaultPassword||"",passwordComplexity:null},Xc.a.instance.track("onboarding_registration_begin")}doSubmit(e){const t=this.state.email.trim();Xc.a.instance.track("onboarding_registration_submit_ok",{email:!!t});const a=this.props.onRegisterClick({username:this.state.username.trim(),password:this.state.password.trim(),email:t,phoneCountry:this.state.phoneCountry,phoneNumber:this.state.phoneNumber});a&&(e.target.disabled=!0,a.finally((function(){e.target.disabled=!1})))}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[YC.Username,YC.Password,YC.PasswordConfirm,YC.Email,YC.PhoneNumber];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise(e=>this.setState({},e)),this.allFieldsValid())return!0;const a=this.findFirstInvalidField(t);return!a||(a.focus(),a.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){const e=Object.keys(this.state.fieldValid);for(let t=0;t<e.length;++t)if(!this.state.fieldValid[e[t]])return!1;return!0}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}markFieldValid(e,t){const{fieldValid:a}=this.state;a[e]=t,this.setState({fieldValid:a})}authStepIsRequired(e){return this.props.flows.every(t=>t.stages.includes(e))}authStepIsUsed(e){return this.props.flows.some(t=>t.stages.includes(e))}showEmail(){return!!this.authStepIsUsed("m.login.email.identity")}showPhoneNumber(){return!($c.a.get().disable_3pid_login||!this.authStepIsUsed("m.login.msisdn"))}renderEmail(){if(!this.showEmail())return null;const e=this.authStepIsRequired("m.login.email.identity")?Object(ts.a)("Email"):Object(ts.a)("Email (optional)");return i.a.createElement(rm.a,{ref:e=>this[YC.Email]=e,type:"text",label:e,value:this.state.email,onChange:this.onEmailChange,onValidate:this.onEmailValidate,onFocus:()=>Xc.a.instance.track("onboarding_registration_email_focus"),onBlur:()=>Xc.a.instance.track("onboarding_registration_email_blur")})}renderPassword(){return i.a.createElement(zC.a,{id:"mx_RegistrationForm_password",fieldRef:e=>this[YC.Password]=e,minScore:3,value:this.state.password,onChange:this.onPasswordChange,onValidate:this.onPasswordValidate,onFocus:()=>Xc.a.instance.track("onboarding_registration_password_focus"),onBlur:()=>Xc.a.instance.track("onboarding_registration_password_blur")})}renderPasswordConfirm(){return i.a.createElement(rm.a,{id:"mx_RegistrationForm_passwordConfirm",ref:e=>this[YC.PasswordConfirm]=e,type:"password",autoComplete:"new-password",label:Object(ts.a)("Confirm password"),value:this.state.passwordConfirm,onChange:this.onPasswordConfirmChange,onValidate:this.onPasswordConfirmValidate,onFocus:()=>Xc.a.instance.track("onboarding_registration_passwordConfirm_focus"),onBlur:()=>Xc.a.instance.track("onboarding_registration_passwordConfirm_blur")})}renderPhoneNumber(){if(!this.showPhoneNumber())return null;const e=On.getComponent("views.auth.CountryDropdown"),t=this.authStepIsRequired("m.login.msisdn")?Object(ts.a)("Phone"):Object(ts.a)("Phone (optional)"),a=i.a.createElement(e,{value:this.state.phoneCountry,isSmall:!0,showPrefix:!0,onOptionChange:this.onPhoneCountryChange});return i.a.createElement(rm.a,{ref:e=>this[YC.PhoneNumber]=e,type:"text",label:t,value:this.state.phoneNumber,prefixComponent:a,onChange:this.onPhoneNumberChange,onValidate:this.onPhoneNumberValidate})}renderUsername(){return i.a.createElement(rm.a,{id:"mx_RegistrationForm_username",ref:e=>this[YC.Username]=e,type:"text",autoFocus:!0,label:Object(ts.a)("Username"),placeholder:Object(ts.a)("Username").toLocaleLowerCase(),value:this.state.username,onChange:this.onUsernameChange,onValidate:this.onUsernameValidate,onFocus:()=>Xc.a.instance.track("onboarding_registration_username_focus"),onBlur:()=>Xc.a.instance.track("onboarding_registration_username_blur")})}render(){const e=i.a.createElement("input",{className:"mx_Login_submit",type:"submit",value:Object(ts.a)("Register"),disabled:!this.props.canSubmit});let t=null;return this.showEmail()&&(t=this.showPhoneNumber()?i.a.createElement("div",null,Object(ts.a)("Add an email to be able to reset your password.")," ",Object(ts.a)("Use email or phone to optionally be discoverable by existing contacts.")):i.a.createElement("div",null,Object(ts.a)("Add an email to be able to reset your password.")," ",Object(ts.a)("Use email to optionally be discoverable by existing contacts."))),i.a.createElement("div",null,i.a.createElement("form",{onSubmit:this.onSubmit},i.a.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderUsername()),i.a.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderPassword(),this.renderPasswordConfirm()),i.a.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderEmail(),this.renderPhoneNumber()),t,e))}},Fe()(qC,"defaultProps",{onValidationChange:console.error,canSubmit:!0}),KC=qC))||KC;var QC,XC=a(278),ZC=a(808),ew=a(1452),tw=a(1453),aw=a(636),nw=a(840),sw=a(832),iw=a(1424),ow=a(1421),rw=a(793),lw=a(634),cw=a(1357),dw=a(1433);let mw=Object(os.a)("views.dialogs.SeshatResetDialog")(QC=class extends i.a.PureComponent{render(){return i.a.createElement(hu.a,{hasCancel:!0,onFinished:this.props.onFinished.bind(null,!1),title:Object(ts.a)("Reset event store?")},i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("You most likely do not want to reset your event index store"),i.a.createElement("br",null),Object(ts.a)("If you do, please note that none of your messages will be deleted, but the search experience might be degraded for a few moments whilst the index is recreated"))),i.a.createElement(WC.a,{primaryButton:Object(ts.a)("Reset event store"),onPrimaryButtonClick:this.props.onFinished.bind(null,!0),primaryButtonClass:"danger",cancelButton:Object(ts.a)("Cancel"),onCancel:this.props.onFinished.bind(null,!1)}))}})||QC;var uw=a(805),hw=a(1327),pw=a(1344);const gw=["image/jpeg","image/gif","image/png","video/mp4","video/webm","video/ogg","audio/mp4","audio/webm","audio/aac","audio/mpeg","audio/ogg","audio/wave","audio/wav","audio/x-wav","audio/x-pn-wav","audio/flac","audio/x-flac"];function fw(e){return gw.includes(e)?e:"application/octet-stream"}var vw,bw;let yw=Object(os.a)("views.dialogs.UploadConfirmDialog")((bw=class extends i.a.Component{constructor(e){super(e),Fe()(this,"objectUrl",void 0),Fe()(this,"mimeType",void 0),Fe()(this,"onCancelClick",()=>{this.props.onFinished(!1)}),Fe()(this,"onUploadClick",()=>{this.props.onFinished(!0)}),Fe()(this,"onUploadAllClick",()=>{this.props.onFinished(!0,!0)}),this.mimeType=fw(e.file.type);const t=new Blob([e.file],{type:this.mimeType});this.objectUrl=URL.createObjectURL(t)}componentWillUnmount(){this.objectUrl&&URL.revokeObjectURL(this.objectUrl)}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons");let n,s,o;return n=this.props.totalFiles>1&&void 0!==this.props.currentIndex?Object(ts.a)("Upload files (%(current)s of %(total)s)",{current:this.props.currentIndex+1,total:this.props.totalFiles}):Object(ts.a)("Upload files"),s=this.mimeType.startsWith("image/")?i.a.createElement("div",{className:"mx_UploadConfirmDialog_previewOuter"},i.a.createElement("div",{className:"mx_UploadConfirmDialog_previewInner"},i.a.createElement("div",null,i.a.createElement("img",{className:"mx_UploadConfirmDialog_imagePreview",src:this.objectUrl})),i.a.createElement("div",null,this.props.file.name," (",GS()(this.props.file.size),")"))):i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("img",{className:"mx_UploadConfirmDialog_fileIcon",src:a(8412)}),this.props.file.name," (",GS()(this.props.file.size),")")),this.props.currentIndex+1<this.props.totalFiles&&(o=i.a.createElement("button",{onClick:this.onUploadAllClick},Object(ts.a)("Upload all"))),i.a.createElement(e,{className:"mx_UploadConfirmDialog",fixedWidth:!1,onFinished:this.onCancelClick,title:n,contentId:"mx_Dialog_content"},i.a.createElement("div",{id:"mx_Dialog_content"},s),i.a.createElement(t,{primaryButton:Object(ts.a)("Upload"),hasCancel:!1,onPrimaryButtonClick:this.onUploadClick,focus:!0},o))}},Fe()(bw,"defaultProps",{totalFiles:1}),vw=bw))||vw;var Ew,_w=a(1543),Sw=a(1343),Cw=a(836),ww=a(1317);let Ow=Object(os.a)("views.elements.Draggable")(Ew=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onMouseDown",e=>{this.setState({location:{currentX:e.clientX,currentY:e.clientY}}),document.addEventListener("mousemove",this.state.onMouseMove),document.addEventListener("mouseup",this.state.onMouseUp)}),Fe()(this,"onMouseUp",e=>{document.removeEventListener("mousemove",this.state.onMouseMove),document.removeEventListener("mouseup",this.state.onMouseUp),this.props.onMouseUp(e)}),this.state={onMouseMove:this.onMouseMove.bind(this),onMouseUp:this.onMouseUp.bind(this),location:{currentX:0,currentY:0}}}onMouseMove(e){const t=this.props.dragFunc(this.state.location,e);this.setState({location:t})}render(){return i.a.createElement("div",{className:this.props.className,onMouseDown:this.onMouseDown.bind(this)})}})||Ew;var xw=a(607),Rw=a(839);var kw,Iw=e=>{let{events:t,children:a,threshold:n=3,onToggle:o,startExpanded:r,summaryMembers:l=[],summaryText:c}=e;const[d,m]=Object(Rw.a)(r);Object(s.useEffect)(()=>{o&&o()},[d]);const u=t.map(e=>e.getId()).join(",");if(t.length<n)return i.a.createElement("div",{className:"mx_EventListSummary","data-scroll-tokens":u},a);let h;if(d)h=i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"mx_EventListSummary_line"}," "),a);else{const e=l.map(e=>i.a.createElement(XC.a,{key:e.userId,member:e,width:14,height:14}));h=i.a.createElement("div",{className:"mx_EventTile_line"},i.a.createElement("div",{className:"mx_EventTile_info"},i.a.createElement("span",{className:"mx_EventListSummary_avatars",onClick:m},e),i.a.createElement("span",{className:"mx_TextualEvent mx_EventListSummary_summary"},c)))}return i.a.createElement("li",{className:"mx_EventListSummary","data-scroll-tokens":u},i.a.createElement(Fs.a,{className:"mx_EventListSummary_toggle",onClick:m,"aria-expanded":d},d?Object(ts.a)("collapse"):Object(ts.a)("expand")),h)},Tw=a(1400),Pw=a(1420);let Nw=Object(os.a)("views.elements.IRCTimelineProfileResizer")(kw=class extends i.a.Component{constructor(e){super(e),Fe()(this,"dragFunc",(e,t)=>{const a=t.clientX-e.currentX,n=this.state.width+a;return n<this.props.minWidth||n>this.props.maxWidth?e:(this.setState({width:n}),this.updateCSSWidth.bind(this)(n),{currentX:t.clientX,currentY:e.currentY})}),this.state={width:ss.b.getValue("ircDisplayNameWidth",this.props.roomId),IRCLayoutRoot:null}}componentDidMount(){this.setState({IRCLayoutRoot:document.querySelector(".mx_IRCLayout")},()=>this.updateCSSWidth(this.state.width))}updateCSSWidth(e){this.state.IRCLayoutRoot.style.setProperty("--name-width",e+"px")}onMoueUp(e){this.props.roomId&&ss.b.setValue("ircDisplayNameWidth",this.props.roomId,mi.a.ROOM_DEVICE,this.state.width)}render(){return i.a.createElement(Ow,{className:"mx_ProfileResizer",dragFunc:this.dragFunc.bind(this),onMouseUp:this.onMoueUp.bind(this)})}})||kw;var Dw,jw,Aw,Mw=a(906),Uw=a(826),Lw=a(1447);!function(e){e.Joined="joined",e.Left="left",e.JoinedAndLeft="joined_and_left",e.LeftAndJoined="left_and_joined",e.InviteReject="invite_reject",e.InviteWithdrawal="invite_withdrawal",e.Invited="invited",e.Banned="banned",e.Unbanned="unbanned",e.Kicked="kicked",e.ChangedName="changed_name",e.ChangedAvatar="changed_avatar",e.NoChange="no_change"}(Aw||(Aw={}));let Fw=Object(os.a)("views.elements.MemberEventListSummary")((jw=class e extends i.a.Component{shouldComponentUpdate(e){return e.events.length!==this.props.events.length||e.events.length<this.props.threshold}generateSummary(t,a){const n=a.map(a=>{const n=t[a],s=this.renderNameList(n),i=a.split(","),o=e.getCanonicalTransitions(i),r=e.coalesceRepeatedTransitions(o).map(t=>e.getDescriptionForTransition(t.transitionType,n.length,t.repeats)),l=Object(hs.b)(r);return Object(ts.a)("%(nameList)s %(transitionList)s",{nameList:s,transitionList:l})});return n?n.join(", "):null}renderNameList(e){return Object(hs.b)(e,this.props.summaryLength)}static getCanonicalTransitions(e){const t={[Aw.Joined]:{after:Aw.Left,newTransition:Aw.JoinedAndLeft},[Aw.Left]:{after:Aw.Joined,newTransition:Aw.LeftAndJoined}},a=[];for(let n=0;n<e.length;n++){const s=e[n],i=e[n+1];let o=s;n<e.length-1&&t[s]&&t[s].after===i&&(o=t[s].newTransition,n++),a.push(o)}return a}static coalesceRepeatedTransitions(e){const t=[];for(let a=0;a<e.length;a++)t.length>0&&t[t.length-1].transitionType===e[a]?t[t.length-1].repeats+=1:t.push({transitionType:e[a],repeats:1});return t}static getDescriptionForTransition(e,t,a){let n=null;switch(e){case"joined":n=t>1?Object(ts.a)("%(severalUsers)sjoined %(count)s times",{severalUsers:"",count:a}):Object(ts.a)("%(oneUser)sjoined %(count)s times",{oneUser:"",count:a});break;case"left":n=t>1?Object(ts.a)("%(severalUsers)sleft %(count)s times",{severalUsers:"",count:a}):Object(ts.a)("%(oneUser)sleft %(count)s times",{oneUser:"",count:a});break;case"joined_and_left":n=t>1?Object(ts.a)("%(severalUsers)sjoined and left %(count)s times",{severalUsers:"",count:a}):Object(ts.a)("%(oneUser)sjoined and left %(count)s times",{oneUser:"",count:a});break;case"left_and_joined":n=t>1?Object(ts.a)("%(severalUsers)sleft and rejoined %(count)s times",{severalUsers:"",count:a}):Object(ts.a)("%(oneUser)sleft and rejoined %(count)s times",{oneUser:"",count:a});break;case"invite_reject":n=t>1?Object(ts.a)("%(severalUsers)srejected their invitations %(count)s times",{severalUsers:"",count:a}):Object(ts.a)("%(oneUser)srejected their invitation %(count)s times",{oneUser:"",count:a});break;case"invite_withdrawal":n=t>1?Object(ts.a)("%(severalUsers)shad their invitations withdrawn %(count)s times",{severalUsers:"",count:a}):Object(ts.a)("%(oneUser)shad their invitation withdrawn %(count)s times",{oneUser:"",count:a});break;case"invited":n=t>1?Object(ts.a)("were invited %(count)s times",{count:a}):Object(ts.a)("was invited %(count)s times",{count:a});break;case"banned":n=t>1?Object(ts.a)("were banned %(count)s times",{count:a}):Object(ts.a)("was banned %(count)s times",{count:a});break;case"unbanned":n=t>1?Object(ts.a)("were unbanned %(count)s times",{count:a}):Object(ts.a)("was unbanned %(count)s times",{count:a});break;case"kicked":n=t>1?Object(ts.a)("were kicked %(count)s times",{count:a}):Object(ts.a)("was kicked %(count)s times",{count:a});break;case"changed_name":n=t>1?Object(ts.a)("%(severalUsers)schanged their name %(count)s times",{severalUsers:"",count:a}):Object(ts.a)("%(oneUser)schanged their name %(count)s times",{oneUser:"",count:a});break;case"changed_avatar":n=t>1?Object(ts.a)("%(severalUsers)schanged their avatar %(count)s times",{severalUsers:"",count:a}):Object(ts.a)("%(oneUser)schanged their avatar %(count)s times",{oneUser:"",count:a});break;case"no_change":n=t>1?Object(ts.a)("%(severalUsers)smade no changes %(count)s times",{severalUsers:"",count:a}):Object(ts.a)("%(oneUser)smade no changes %(count)s times",{oneUser:"",count:a})}return n}static getTransitionSequence(t){return t.map(e.getTransition)}static getTransition(e){if("m.room.third_party_invite"===e.mxEvent.getType())return Object(mu.c)(e.mxEvent)?Aw.Invited:Aw.InviteWithdrawal;switch(e.mxEvent.getContent().membership){case"invite":return Aw.Invited;case"ban":return Aw.Banned;case"join":return"join"===e.mxEvent.getPrevContent().membership?e.mxEvent.getContent().displayname!==e.mxEvent.getPrevContent().displayname?Aw.ChangedName:e.mxEvent.getContent().avatar_url!==e.mxEvent.getPrevContent().avatar_url?Aw.ChangedAvatar:Aw.NoChange:Aw.Joined;case"leave":if(e.mxEvent.getSender()===e.mxEvent.getStateKey())switch(e.mxEvent.getPrevContent().membership){case"invite":return Aw.InviteReject;default:return Aw.Left}switch(e.mxEvent.getPrevContent().membership){case"invite":return Aw.InviteWithdrawal;case"ban":return Aw.Unbanned;default:return Aw.Kicked}default:return null}}getAggregate(t){const a={},n={};return Object.keys(t).forEach(s=>{const i=t[s][0],o=i.displayName,r=e.getTransitionSequence(t[s]).join(",");a[r]||(a[r]=[],n[r]=-1),a[r].push(o),(-1===n[r]||i.index<n[r])&&(n[r]=i.index)}),{names:a,indices:n}}render(){const e=this.props.events,t=new Map,a={};e.forEach((e,n)=>{const s=e.getStateKey();a[s]||(a[s]=[]),e.target&&t.set(s,e.target);let i=s;"m.room.third_party_invite"===e.getType()?i=e.getContent().display_name:e.target&&(i=e.target.name),a[s].push({mxEvent:e,displayName:i,index:n})});const n=this.getAggregate(a),s=Object.keys(n.names).sort((e,t)=>n.indices[e]-n.indices[t]);return i.a.createElement(Iw,{events:this.props.events,threshold:this.props.threshold,onToggle:this.props.onToggle,startExpanded:this.props.startExpanded,children:this.props.children,summaryMembers:[...t.values()],summaryText:this.generateSummary(n.names,s)})}},Fe()(jw,"defaultProps",{summaryLength:1,threshold:3,avatarsMaxLength:5}),Dw=jw))||Dw;var Bw=a(806),Vw=a(495),Gw=a(1399),zw=a(1398),Ww=a(1374),Hw=a(228),Kw=a(496),qw=a(293);function Yw(){const e=JSON.parse(window.localStorage.mx_reaction_count||"{}"),t=Object.entries(e).sort((e,t)=>{let[,[a,n]]=e,[,[s,i]]=t;return i-n}).map(e=>{let[t,[a,n]]=e;return[t,a]});ss.b.setValue("recent_emoji",null,mi.a.ACCOUNT,t.slice(0,100))}function $w(){return ss.b.getValue("recent_emoji")||[]}var Jw,Qw=a(480);var Xw,Zw=Object(os.a)("views.emojipicker.Header")(Jw=class extends i.a.PureComponent{constructor(){super(...arguments),Fe()(this,"onKeyDown",e=>{let t=!0;switch(e.key){case vi.a.ARROW_LEFT:this.changeCategoryRelative(-1);break;case vi.a.ARROW_RIGHT:this.changeCategoryRelative(1);break;case vi.a.HOME:this.changeCategoryAbsolute(0);break;case vi.a.END:this.changeCategoryAbsolute(this.props.categories.length-1,-1);break;default:t=!1}t&&(e.preventDefault(),e.stopPropagation())})}findNearestEnabled(e,t){e+=this.props.categories.length;const a=[...this.props.categories,...this.props.categories,...this.props.categories];for(;e<a.length&&e>=0;){if(a[e].enabled)return e%this.props.categories.length;e+=t>0?1:-1}}changeCategoryRelative(e){const t=this.props.categories.findIndex(e=>e.visible);this.changeCategoryAbsolute(t+e,e)}changeCategoryAbsolute(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const a=this.props.categories[this.findNearestEnabled(e,t)];a&&(this.props.onAnchorClick(a.id),a.ref.current.focus())}render(){return i.a.createElement("nav",{className:"mx_EmojiPicker_header",role:"tablist","aria-label":Object(ts.a)("Categories"),onKeyDown:this.onKeyDown},this.props.categories.map(e=>{const t=Hn()("mx_EmojiPicker_anchor mx_EmojiPicker_anchor_"+e.id,{mx_EmojiPicker_anchor_visible:e.visible});return i.a.createElement("button",{disabled:!e.enabled,key:e.id,ref:e.ref,className:t,onClick:()=>this.props.onAnchorClick(e.id),title:e.name,role:"tab",tabIndex:e.visible?0:-1,"aria-selected":e.visible,"aria-controls":"mx_EmojiPicker_category_"+e.id})}))}})||Jw;var eO,tO=Object(os.a)("views.emojipicker.Search")(Xw=class extends i.a.PureComponent{constructor(){super(...arguments),Fe()(this,"inputRef",i.a.createRef()),Fe()(this,"onKeyDown",e=>{e.key===vi.a.ENTER&&(this.props.onEnter(),e.stopPropagation(),e.preventDefault())})}componentDidMount(){setTimeout(()=>this.inputRef.current.focus(),0)}render(){let e;return e=this.props.query?i.a.createElement("button",{onClick:()=>this.props.onChange(""),className:"mx_EmojiPicker_search_icon mx_EmojiPicker_search_clear",title:Object(ts.a)("Cancel search")}):i.a.createElement("span",{className:"mx_EmojiPicker_search_icon"}),i.a.createElement("div",{className:"mx_EmojiPicker_search"},i.a.createElement("input",{autoFocus:!0,type:"text",placeholder:"Search",value:this.props.query,onChange:e=>this.props.onChange(e.target.value),onKeyDown:this.onKeyDown,ref:this.inputRef}),e)}})||Xw;var aO,nO=Object(os.a)("views.emojipicker.Preview")(eO=class extends i.a.PureComponent{render(){const{unicode:e="",annotation:t="",shortcodes:[a=""]}=this.props.emoji||{};return i.a.createElement("div",{className:"mx_EmojiPicker_footer mx_EmojiPicker_preview"},i.a.createElement("div",{className:"mx_EmojiPicker_preview_emoji"},e),i.a.createElement("div",{className:"mx_EmojiPicker_preview_text"},i.a.createElement("div",{className:"mx_EmojiPicker_name mx_EmojiPicker_preview_name"},t),i.a.createElement("div",{className:"mx_EmojiPicker_shortcode"},a)))}})||eO;var sO,iO=Object(os.a)("views.emojipicker.Emoji")(aO=class extends i.a.PureComponent{render(){const{onClick:e,onMouseEnter:t,onMouseLeave:a,emoji:n,selectedEmojis:s}=this.props,o=s&&s.has(n.unicode);return i.a.createElement(Kr.f,{element:"li",onClick:()=>e(n),onMouseEnter:()=>t(n),onMouseLeave:()=>a(n),className:"mx_EmojiPicker_item_wrapper",label:n.unicode},i.a.createElement("div",{className:"mx_EmojiPicker_item "+(o?"mx_EmojiPicker_item_selected":"")},n.unicode))}})||aO;const oO=["👍","👎","😄","🎉","😕","❤️","🚀","👀"].map(e=>{const t=Object(Qw.e)(e);if(!t)throw new Error(`Emoji ${e} doesn't exist in emojibase`);return t});var rO,lO=Object(os.a)("views.emojipicker.QuickReactions")(sO=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onMouseEnter",e=>{this.setState({hover:e})}),Fe()(this,"onMouseLeave",()=>{this.setState({hover:null})}),this.state={hover:null}}render(){return i.a.createElement("section",{className:"mx_EmojiPicker_footer mx_EmojiPicker_quick mx_EmojiPicker_category"},i.a.createElement("h2",{className:"mx_EmojiPicker_quick_header mx_EmojiPicker_category_label"},this.state.hover?i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"mx_EmojiPicker_name"},this.state.hover.annotation),i.a.createElement("span",{className:"mx_EmojiPicker_shortcode"},this.state.hover.shortcodes[0])):Object(ts.a)("Quick Reactions")),i.a.createElement("ul",{className:"mx_EmojiPicker_list","aria-label":Object(ts.a)("Quick Reactions")},oO.map(e=>i.a.createElement(iO,{key:e.hexcode,emoji:e,onClick:this.props.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,selectedEmojis:this.props.selectedEmojis}))))}})||sO;function cO(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var dO,mO=Object(os.a)("views.emojipicker.EmojiPicker")(rO=class e extends i.a.Component{constructor(e){super(e),Fe()(this,"recentlyUsed",void 0),Fe()(this,"memoizedDataByCategory",void 0),Fe()(this,"categories",void 0),Fe()(this,"bodyRef",i.a.createRef()),Fe()(this,"onScroll",()=>{const e=this.bodyRef.current;this.setState({scrollTop:e.scrollTop,viewportHeight:e.clientHeight}),this.updateVisibility()}),Fe()(this,"updateVisibility",()=>{const e=this.bodyRef.current,t=e.getBoundingClientRect();for(const a of this.categories){const n=e.querySelector(`[data-category-id="${a.id}"]`);if(!n){a.visible=!1,a.ref.current.classList.remove("mx_EmojiPicker_anchor_visible");continue}const s=n.getBoundingClientRect(),i=s.y-t.y,o=s.y+s.height-t.y;a.visible=i<t.height&&o>0,a.visible?(a.ref.current.classList.add("mx_EmojiPicker_anchor_visible"),a.ref.current.setAttribute("aria-selected","true"),a.ref.current.setAttribute("tabindex","0")):(a.ref.current.classList.remove("mx_EmojiPicker_anchor_visible"),a.ref.current.setAttribute("aria-selected","false"),a.ref.current.setAttribute("tabindex","-1"))}}),Fe()(this,"scrollToCategory",e=>{this.bodyRef.current.querySelector(`[data-category-id="${e}"]`).scrollIntoView()}),Fe()(this,"onChangeFilter",e=>{e=e.toLowerCase();for(const t of this.categories){let a;a=e.includes(this.state.filter)?this.memoizedDataByCategory[t.id]:"recent"===t.id?this.recentlyUsed:Qw.a[t.id],a=a.filter(t=>t.filterString.includes(e)),this.memoizedDataByCategory[t.id]=a,t.enabled=a.length>0,t.ref.current.disabled=!t.enabled}this.setState({filter:e}),setTimeout(this.updateVisibility,0)}),Fe()(this,"onEnterFilter",()=>{const e=this.bodyRef.current.querySelector(".mx_EmojiPicker_item");e&&e.click()}),Fe()(this,"onHoverEmoji",e=>{this.setState({previewEmoji:e})}),Fe()(this,"onHoverEmojiEnd",e=>{this.setState({previewEmoji:null})}),Fe()(this,"onClickEmoji",e=>{!1!==this.props.onChoose(e.unicode)&&function(e){const t=$w(),a=t.findIndex(t=>{let[a]=t;return a===e});let n;a>=0?([n]=t.splice(a,1),n[1]++):n=[e,1],ss.b.setValue("recent_emoji",null,mi.a.ACCOUNT,[n,...t].slice(0,100))}(e.unicode)}),this.state={filter:"",previewEmoji:null,scrollTop:0,viewportHeight:280},this.recentlyUsed=Array.from(new Set(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,t=$w();t.length<1&&(Yw(),t=$w());const a=Object(dC.orderBy)(t,"1","desc");return a.slice(0,e).map(e=>{let[t]=e;return t})}().map(Qw.e).filter(Boolean))),this.memoizedDataByCategory=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?cO(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cO(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({recent:this.recentlyUsed},Qw.a),this.categories=[{id:"recent",name:Object(ts.a)("Frequently Used"),enabled:this.recentlyUsed.length>0,visible:this.recentlyUsed.length>0,ref:i.a.createRef()},{id:"people",name:Object(ts.a)("Smileys & People"),enabled:!0,visible:!0,ref:i.a.createRef()},{id:"nature",name:Object(ts.a)("Animals & Nature"),enabled:!0,visible:!1,ref:i.a.createRef()},{id:"foods",name:Object(ts.a)("Food & Drink"),enabled:!0,visible:!1,ref:i.a.createRef()},{id:"activity",name:Object(ts.a)("Activities"),enabled:!0,visible:!1,ref:i.a.createRef()},{id:"places",name:Object(ts.a)("Travel & Places"),enabled:!0,visible:!1,ref:i.a.createRef()},{id:"objects",name:Object(ts.a)("Objects"),enabled:!0,visible:!1,ref:i.a.createRef()},{id:"symbols",name:Object(ts.a)("Symbols"),enabled:!0,visible:!1,ref:i.a.createRef()},{id:"flags",name:Object(ts.a)("Flags"),enabled:!0,visible:!1,ref:i.a.createRef()}]}static categoryHeightForEmojiCount(e){return 0===e?0:22+37*Math.ceil(e/8)}render(){let t=0;return i.a.createElement("div",{className:"mx_EmojiPicker"},i.a.createElement(Zw,{categories:this.categories,onAnchorClick:this.scrollToCategory}),i.a.createElement(tO,{query:this.state.filter,onChange:this.onChangeFilter,onEnter:this.onEnterFilter}),i.a.createElement(Jn.a,{className:"mx_EmojiPicker_body",wrappedRef:e=>{this.bodyRef.current=e},onScroll:this.onScroll},this.categories.map(a=>{const n=this.memoizedDataByCategory[a.id],s=i.a.createElement(fO,{key:a.id,id:a.id,name:a.name,heightBefore:t,viewportHeight:this.state.viewportHeight,scrollTop:this.state.scrollTop,emojis:n,onClick:this.onClickEmoji,onMouseEnter:this.onHoverEmoji,onMouseLeave:this.onHoverEmojiEnd,selectedEmojis:this.props.selectedEmojis}),o=e.categoryHeightForEmojiCount(n.length);return t+=o,s})),this.state.previewEmoji||!this.props.showQuickReactions?i.a.createElement(nO,{emoji:this.state.previewEmoji}):i.a.createElement(lO,{onClick:this.onClickEmoji,selectedEmojis:this.props.selectedEmojis}))}})||rO;class uO{constructor(e,t,a){this.topCount=e,this.renderCount=t,this.bottomCount=a}contains(e){return!(!e.renderCount&&this.renderCount)&&(e.topCount>=this.topCount&&e.topCount+e.renderCount<=this.topCount+this.renderCount)}expand(e){if(0===this.renderCount)return this;const t=Math.min(e,this.topCount),a=Math.min(e,this.bottomCount);return new uO(this.topCount-t,this.renderCount+t+a,this.bottomCount-a)}totalSize(){return this.topCount+this.renderCount+this.bottomCount}}let hO=Object(os.a)("views.elements.LazyRenderList")(dO=class e extends i.a.Component{constructor(e){super(e),this.state={}}static getDerivedStateFromProps(t,a){const n=e.getVisibleRangeFromProps(t),s=n.expand(t.overflowMargin),i=n.expand(t.overflowItems);return!(!!a.renderRange&&i.totalSize()!==a.renderRange.totalSize())&&a.renderRange&&a.renderRange.contains(s)?null:{renderRange:i}}static getVisibleRangeFromProps(e){const{items:t,itemHeight:a,scrollTop:n,height:s}=e,i=t?t.length:0,o=Math.min(Math.max(0,Math.floor(n/a)),i),r=i-o,l=0!==s?Math.ceil(s/a):0,c=Math.min(l,r);return new uO(o,c,r-c)}render(){const{itemHeight:e,items:t,renderItem:a}=this.props,{renderRange:n}=this.state,{topCount:s,renderCount:o,bottomCount:r}=n,l=s*e,c=r*e,d=(t||[]).slice(s,s+o),m=this.props.element||"div",u={style:{paddingTop:l+"px",paddingBottom:c+"px"},className:this.props.className};return i.a.createElement(m,u,d.map(a))}})||dO;var pO;hO.defaultProps={overflowItems:20,overflowMargin:5},hO.propTypes={itemHeight:At.a.number.isRequired,renderItem:At.a.func.isRequired,scrollTop:At.a.number.isRequired,height:At.a.number.isRequired,items:At.a.array,overflowMargin:At.a.number,overflowItems:At.a.number};var gO,fO=Object(os.a)("views.emojipicker.Category")(pO=class extends i.a.PureComponent{constructor(){super(...arguments),Fe()(this,"renderEmojiRow",e=>{const{onClick:t,onMouseEnter:a,onMouseLeave:n,selectedEmojis:s,emojis:o}=this.props,r=o.slice(8*e,8*(e+1));return i.a.createElement("div",{key:e},r.map(e=>i.a.createElement(iO,{key:e.hexcode,emoji:e,selectedEmojis:s,onClick:t,onMouseEnter:a,onMouseLeave:n})))})}render(){const{emojis:e,name:t,heightBefore:a,viewportHeight:n,scrollTop:s}=this.props;if(!e||0===e.length)return null;const o=new Array(Math.ceil(e.length/8));for(let e=0;e<o.length;++e)o[e]=e;const r=s,l=r+n,c=a+22,d=c+37*o.length,m=Math.max(r,c),u=Math.min(l,d),h=Math.max(0,u-m),p=Math.max(0,s-c);return i.a.createElement("section",{id:"mx_EmojiPicker_category_"+this.props.id,className:"mx_EmojiPicker_category","data-category-id":this.props.id,role:"tabpanel","aria-label":t},i.a.createElement("h2",{className:"mx_EmojiPicker_category_label"},t),i.a.createElement(hO,{element:"ul",className:"mx_EmojiPicker_list",itemHeight:37,items:o,scrollTop:p,height:h,overflowItems:3,overflowMargin:0,renderItem:this.renderEmojiRow}))}})||pO;var vO=Object(os.a)("views.emojipicker.ReactionPicker")(gO=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onReactionsChange",()=>{this.setState({selectedEmojis:new Set(Object.keys(this.getReactions()))})}),Fe()(this,"onChoose",e=>{this.componentWillUnmount(),this.props.onFinished();const t=this.getReactions();return t.hasOwnProperty(e)?(Cs.a.get().redactEvent(this.props.mxEvent.getRoomId(),t[e]),!1):(Cs.a.get().sendEvent(this.props.mxEvent.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:this.props.mxEvent.getId(),key:e}}),gn.a.dispatch({action:"message_sent"}),!0)}),this.state={selectedEmojis:new Set(Object.keys(this.getReactions()))},this.addListeners()}componentDidUpdate(e){e.reactions!==this.props.reactions&&(this.addListeners(),this.onReactionsChange())}addListeners(){this.props.reactions&&(this.props.reactions.on("Relations.add",this.onReactionsChange),this.props.reactions.on("Relations.remove",this.onReactionsChange),this.props.reactions.on("Relations.redaction",this.onReactionsChange))}componentWillUnmount(){this.props.reactions&&(this.props.reactions.removeListener("Relations.add",this.onReactionsChange),this.props.reactions.removeListener("Relations.remove",this.onReactionsChange),this.props.reactions.removeListener("Relations.redaction",this.onReactionsChange))}getReactions(){if(!this.props.reactions)return{};const e=Cs.a.get().getUserId(),t=this.props.reactions.getAnnotationsBySender()[e]||[];return Object.fromEntries([...t].filter(e=>!e.isRedacted()).map(e=>[e.getRelation().key,e.getId()]))}render(){return i.a.createElement(mO,{onChoose:this.onChoose,selectedEmojis:this.state.selectedEmojis,showQuickReactions:!0})}})||gO;var bO=Object(s.forwardRef)((e,t)=>{let{className:a,title:n,subtitle:s,children:o}=e;return i.a.createElement("div",{className:Hn()("mx_EventTileBubble",a),ref:t},i.a.createElement("div",{className:"mx_EventTileBubble_title"},n),s&&i.a.createElement("div",{className:"mx_EventTileBubble_subtitle"},s),o)});var yO,EO=Object(s.forwardRef)((e,t)=>{let{mxEvent:a}=e;const n=Object(s.useContext)(ns.a),o=a.getRoomId(),r=Cs.a.get().isRoomEncrypted(o);if("m.megolm.v1.aes-sha2"===a.getContent().algorithm&&r){let e;const t=aE.a.shared().getUserIdForRoomId(o);if(t){var l,c;const a=(null==n||null===(l=n.getRoom(o))||void 0===l||null===(c=l.getMember(t))||void 0===c?void 0:c.rawDisplayName)||t;e=Object(ts.a)("Messages here are end-to-end encrypted. Verify %(displayName)s in their profile - tap on their avatar.",{displayName:a})}else e=Object(ts.a)("Messages in this room are end-to-end encrypted. When people join, you can verify them in their profile, just tap on their avatar.");return i.a.createElement(bO,{className:"mx_cryptoEvent mx_cryptoEvent_icon",title:Object(ts.a)("Encryption enabled"),subtitle:e})}return r?i.a.createElement(bO,{className:"mx_cryptoEvent mx_cryptoEvent_icon",title:Object(ts.a)("Encryption enabled"),subtitle:Object(ts.a)("Ignored attempt to disable encryption")}):i.a.createElement(bO,{className:"mx_cryptoEvent mx_cryptoEvent_icon mx_cryptoEvent_icon_warning",title:Object(ts.a)("Encryption not enabled"),subtitle:Object(ts.a)("The encryption used by this room isn't supported."),ref:t})}),_O=a(299),SO=a(267);let CO=Object(os.a)("views.messages.MJitsiWidgetEvent")(yO=class extends i.a.PureComponent{constructor(e){super(e)}render(){var e;const t=this.props.mxEvent.getContent().url,a=this.props.mxEvent.getPrevContent().url,n=(null===(e=this.props.mxEvent.sender)||void 0===e?void 0:e.name)||this.props.mxEvent.getSender(),s=Cs.a.get().getRoom(this.props.mxEvent.getRoomId()),o=this.props.mxEvent.getStateKey(),r=_O.a.instance.getRoom(s.roomId,!0).widgets.find(e=>e.id===o);let l=Object(ts.a)("Join the conference at the top of this room");return r&&SO.d.instance.isInContainer(s,r,SO.a.Right)?l=Object(ts.a)("Join the conference from the room information card on the right"):r||(l=null),t?a?i.a.createElement(bO,{className:"mx_MJitsiWidgetEvent",title:Object(ts.a)("Video conference updated by %(senderName)s",{senderName:n}),subtitle:l}):i.a.createElement(bO,{className:"mx_MJitsiWidgetEvent",title:Object(ts.a)("Video conference started by %(senderName)s",{senderName:n}),subtitle:l}):i.a.createElement(bO,{className:"mx_MJitsiWidgetEvent",title:Object(ts.a)("Video conference ended by %(senderName)s",{senderName:n})})}})||yO;var wO,OO,xO=a(1438),RO=a.n(xO);function kO(e){return Object(Os.a)({file:e}).downloadSource().then(e=>e.arrayBuffer()).then(t=>RO.a.decryptAttachment(t,e)).then(t=>{let a=e.mimetype?e.mimetype.split(";")[0].trim():"";return a=fw(a),new Blob([t],{type:a})})}let IO;function TO(e){if(!e)return"";const t=window.getComputedStyle(e,null);let a=t.cssText;if(""==a)for(let e=0;e<t.length;e++)a+=t[e]+":",a+=t.getPropertyValue(t[e])+";";return a}!async function(){if(IO)return;const e=await fetch(a(8413)).then(e=>e.text());IO="data:image/svg+xml;base64,"+window.btoa(e)}();let PO=Object(os.a)("views.messages.MFileBody")((OO=class extends i.a.Component{constructor(e){super(e),this.state={decryptedBlob:this.props.decryptedBlob?this.props.decryptedBlob:null},this._iframe=Object(s.createRef)(),this._dummyLink=Object(s.createRef)()}presentableTextForFile(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=Object(ts.a)("Attachment");return e.body&&e.body.length>0&&(a=e.body),e.info&&e.info.size&&t&&(a+=" ("+GS()(e.info.size)+")"),a}_getContentUrl(){return Object(Os.a)(this.props.mxEvent.getContent()).srcHttp}componentDidUpdate(e,t){this.props.onHeightChanged&&!t.decryptedBlob&&this.state.decryptedBlob&&this.props.onHeightChanged()}render(){const e=this.props.mxEvent.getContent(),t=this.presentableTextForFile(e),a=void 0!==e.file,n=e.body&&e.body.length>0?e.body:Object(ts.a)("Attachment"),s=this._getContentUrl(),o=e.info?e.info.size:null,r=e.info?e.info.mimetype:"application/octet-stream";let l=null;if(this.props.showGenericPlaceholder&&(l=i.a.createElement("div",{className:"mx_MFileBody_info"},i.a.createElement("span",{className:"mx_MFileBody_info_icon"}),i.a.createElement("span",{className:"mx_MFileBody_info_filename"},this.presentableTextForFile(e,!1)))),a){if(null===this.state.decryptedBlob){let a=!1;const n=t=>{if(a)return!1;a=!0,kO(e.file).then(e=>{this.setState({decryptedBlob:e})}).catch(e=>{console.warn("Unable to decrypt attachment: ",e),qd.a.createTrackedDialog("Error decrypting attachment","",uu.a,{title:Object(ts.a)("Error"),description:Object(ts.a)("Error decrypting attachment")})}).finally(()=>{a=!1})};return i.a.createElement("span",{className:"mx_MFileBody"},l,i.a.createElement("div",{className:"mx_MFileBody_download"},i.a.createElement(Fs.a,{onClick:n},Object(ts.a)("Decrypt %(text)s",{text:t}))))}const a=e=>{e.target.contentWindow.postMessage({imgSrc:IO,imgStyle:null,style:TO(this._dummyLink.current),blob:this.state.decryptedBlob,download:n,textContent:Object(ts.a)("Download %(text)s",{text:t}),auto:!this.props.decryptedBlob},"*")},s="usercontent/";return i.a.createElement("span",{className:"mx_MFileBody"},l,i.a.createElement("div",{className:"mx_MFileBody_download"},i.a.createElement("div",{style:{display:"none"}},i.a.createElement("a",{ref:this._dummyLink})),i.a.createElement("iframe",{src:s,onLoad:a,ref:this._iframe,sandbox:"allow-scripts allow-downloads allow-downloads-without-user-activation"})))}if(s){const a={target:"_blank",rel:"noreferrer noopener",href:s},c="number"!=typeof o||o>524288e3;return["application/pdf"].includes(r)&&!c?a.onClick=e=>{console.log(`Downloading ${r} as blob (unencrypted)`),e.preventDefault(),e.stopPropagation(),fetch(s).then(e=>e.blob()).then(e=>{const t=URL.createObjectURL(e),a=document.createElement("a");a.download=n,a.href=t,document.body.appendChild(a),a.click(),a.remove()})}:a.download=n,"file_grid"===this.props.tileShape?i.a.createElement("span",{className:"mx_MFileBody"},l,i.a.createElement("div",{className:"mx_MFileBody_download"},i.a.createElement("a",u()({className:"mx_MFileBody_downloadLink"},a),n),i.a.createElement("div",{className:"mx_MImageBody_size"},e.info&&e.info.size?GS()(e.info.size):""))):i.a.createElement("span",{className:"mx_MFileBody"},l,i.a.createElement("div",{className:"mx_MFileBody_download"},i.a.createElement("a",a,i.a.createElement("span",{className:"mx_MFileBody_download_icon"}),Object(ts.a)("Download %(text)s",{text:t}))))}{const e=t?": "+t:"";return i.a.createElement("span",{className:"mx_MFileBody"},l,Object(ts.a)("Invalid file%(extra)s",{extra:e}))}}},Fe()(OO,"propTypes",{mxEvent:At.a.object.isRequired,decryptedBlob:At.a.object,onHeightChanged:At.a.func,tileShape:At.a.string,showGenericPlaceholder:At.a.bool}),Fe()(OO,"defaultProps",{showGenericPlaceholder:!0}),wO=OO))||wO;var NO;let DO=Object(os.a)("views.messages.MVideoBody")(NO=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"videoRef",i.a.createRef()),Fe()(this,"videoOnPlay",async()=>{if(this.hasContentUrl()||this.state.fetchingData||this.state.error)return;this.setState({fetchingData:!0});const e=this.props.mxEvent.getContent();if(!e.file)return void this.setState({error:"No file given in content"});const t=await kO(e.file),a=URL.createObjectURL(t);this.setState({decryptedUrl:a,decryptedBlob:t,fetchingData:!1},()=>{this.videoRef.current&&this.videoRef.current.play()}),this.props.onHeightChanged()}),this.state={fetchingData:!1,decryptedUrl:null,decryptedThumbnailUrl:null,decryptedBlob:null,error:null}}thumbScale(e,t,a,n){if(!e||!t)return;if(e<a&&t<n)return 1;const s=a/e,i=n/t;return s<i?s:i}getContentUrl(){const e=Object(Os.a)(this.props.mxEvent.getContent());return e.isEncrypted?this.state.decryptedUrl:e.srcHttp}hasContentUrl(){const e=this.getContentUrl();return e&&!e.startsWith("data:")}getThumbUrl(){const e=this.props.mxEvent.getContent(),t=Object(Os.a)(e);return t.isEncrypted?this.state.decryptedThumbnailUrl:t.hasThumbnail?t.thumbnailHttp:null}async componentDidMount(){const e=ss.b.getValue("autoplayGifsAndVideos"),t=this.props.mxEvent.getContent();if(void 0!==t.file&&null===this.state.decryptedUrl){let s=Promise.resolve(null);t.info&&t.info.thumbnail_file&&(s=kO(t.info.thumbnail_file).then((function(e){return URL.createObjectURL(e)})));try{const i=await s;if(e){console.log("Preloading video");const e=await kO(t.file),a=URL.createObjectURL(e);this.setState({decryptedUrl:a,decryptedThumbnailUrl:i,decryptedBlob:e}),this.props.onHeightChanged()}else{var a,n;console.log("NOT preloading video"),this.setState({decryptedUrl:`data:${null==t||null===(a=t.info)||void 0===a?void 0:a.mimetype},`,decryptedThumbnailUrl:i||`data:${null==t||null===(n=t.info)||void 0===n?void 0:n.mimetype},`,decryptedBlob:null})}}catch(e){console.warn("Unable to decrypt attachment: ",e),this.setState({error:e})}}}componentWillUnmount(){this.state.decryptedUrl&&URL.revokeObjectURL(this.state.decryptedUrl),this.state.decryptedThumbnailUrl&&URL.revokeObjectURL(this.state.decryptedThumbnailUrl)}render(){const e=this.props.mxEvent.getContent(),t=ss.b.getValue("autoplayGifsAndVideos");if(null!==this.state.error)return i.a.createElement("span",{className:"mx_MVideoBody"},i.a.createElement("img",{src:a(373),width:"16",height:"16"}),Object(ts.a)("Error decrypting video"));if(void 0!==e.file&&null===this.state.decryptedUrl&&t)return i.a.createElement("span",{className:"mx_MVideoBody"},i.a.createElement("div",{className:"mx_MImageBody_thumbnail mx_MImageBody_thumbnail_spinner"},i.a.createElement(Cu.a,null)));const n=this.getContentUrl(),s=this.getThumbUrl();let o=null,r=null,l=null,c="metadata";if(e.info){const t=this.thumbScale(e.info.w,e.info.h,480,360);t&&(r=Math.floor(e.info.w*t),o=Math.floor(e.info.h*t)),s&&(l=s,c="none")}return i.a.createElement("span",{className:"mx_MVideoBody"},i.a.createElement("video",{className:"mx_MVideoBody",ref:this.videoRef,src:n,title:e.body,controls:!0,preload:c,muted:t,autoPlay:t,height:o,width:r,poster:l,onPlay:this.videoOnPlay}),i.a.createElement(PO,u()({},this.props,{decryptedBlob:this.state.decryptedBlob,showGenericPlaceholder:!1})))}})||NO;var jO,AO=a(442),MO=a(859);let UO=Object(os.a)("views.messages.MVoiceMessageBody")(jO=class extends i.a.PureComponent{constructor(e){super(e),this.state={}}async componentDidMount(){var e,t;let a;const n=this.props.mxEvent.getContent(),s=Object(Os.a)(n);if(s.isEncrypted)try{const e=await kO(n.file);a=await e.arrayBuffer(),this.setState({decryptedBlob:e})}catch(e){return this.setState({error:e}),void console.warn("Unable to decrypt voice message",e)}else try{a=await s.downloadSource().then(e=>e.blob()).then(e=>e.arrayBuffer())}catch(e){return this.setState({error:e}),void console.warn("Unable to download voice message",e)}const i=null==n||null===(e=n["org.matrix.msc1767.audio"])||void 0===e||null===(t=e.waveform)||void 0===t?void 0:t.map(e=>e/1024),o=new AO.b(a,i);this.setState({playback:o})}componentWillUnmount(){var e;null===(e=this.state.playback)||void 0===e||e.destroy()}render(){return this.state.error?i.a.createElement("span",{className:"mx_MVoiceMessageBody"},i.a.createElement("img",{src:a(373),width:"16",height:"16"}),Object(ts.a)("Error processing voice message")):this.state.playback?i.a.createElement("span",{className:"mx_MVoiceMessageBody"},i.a.createElement(MO.a,{playback:this.state.playback}),i.a.createElement(PO,u()({},this.props,{decryptedBlob:this.state.decryptedBlob,showGenericPlaceholder:!1}))):i.a.createElement("span",{className:"mx_MVoiceMessageBody"},i.a.createElement(Cu.a,null))}})||jO;var LO;let FO=Object(os.a)("views.messages.MAudioBody")(LO=class extends i.a.Component{constructor(e){super(e),this.state={playing:!1,decryptedUrl:null,decryptedBlob:null,error:null}}onPlayToggle(){this.setState({playing:!this.state.playing})}_getContentUrl(){const e=Object(Os.a)(this.props.mxEvent.getContent());return e.isEncrypted?this.state.decryptedUrl:e.srcHttp}componentDidMount(){const e=this.props.mxEvent.getContent();if(void 0!==e.file&&null===this.state.decryptedUrl){let t;kO(e.file).then((function(e){return t=e,URL.createObjectURL(t)})).then(e=>{this.setState({decryptedUrl:e,decryptedBlob:t})},e=>{console.warn("Unable to decrypt attachment: ",e),this.setState({error:e})})}}componentWillUnmount(){this.state.decryptedUrl&&URL.revokeObjectURL(this.state.decryptedUrl)}render(){const e=this.props.mxEvent.getContent();if(null!==this.state.error)return i.a.createElement("span",{className:"mx_MAudioBody"},i.a.createElement("img",{src:a(373),width:"16",height:"16"}),Object(ts.a)("Error decrypting audio"));if(void 0!==e.file&&null===this.state.decryptedUrl)return i.a.createElement("span",{className:"mx_MAudioBody"},i.a.createElement(Cu.a,null));const t=this._getContentUrl();return i.a.createElement("span",{className:"mx_MAudioBody"},i.a.createElement("audio",{src:t,controls:!0}),i.a.createElement(PO,u()({},this.props,{decryptedBlob:this.state.decryptedBlob,showGenericPlaceholder:!1})))}})||LO;var BO;let VO=Object(os.a)("views.messages.MVoiceOrAudioBody")(BO=class extends i.a.PureComponent{render(){const e=!!this.props.mxEvent.getContent()["org.matrix.msc2516.voice"],t=ss.b.getValue("feature_voice_messages");return e&&t?i.a.createElement(UO,this.props):i.a.createElement(FO,this.props)}})||BO;var GO,zO,WO=a(423);let HO=Object(os.a)("views.messages.ReactionsRowButtonTooltip")((zO=class extends i.a.PureComponent{render(){const{content:e,reactionEvents:t,mxEvent:a,visible:n}=this.props,s=this.context.getRoom(a.getRoomId());let o,r;if(s){const a=[];for(const e of t){const t=s.getMember(e.getSender()),n=t?t.name:e.getSender();a.push(n)}const n=Object(tS.j)(e);o=i.a.createElement("div",null,Object(ts.a)("<reactors/><reactedWith>reacted with %(shortName)s</reactedWith>",{shortName:n},{reactors:()=>i.a.createElement("div",{className:"mx_Tooltip_title"},Object(hs.b)(a,6)),reactedWith:e=>n?i.a.createElement("div",{className:"mx_Tooltip_sub"},e):null}))}return o&&(r=i.a.createElement(qw.b,{visible:n,label:o})),r}},Fe()(zO,"contextType",ns.a),GO=zO))||GO;var KO,qO;let YO=Object(os.a)("views.messages.ReactionsRowButton")((qO=class extends i.a.PureComponent{constructor(){super(...arguments),Fe()(this,"state",{tooltipRendered:!1,tooltipVisible:!1}),Fe()(this,"onClick",()=>{const{mxEvent:e,myReactionEvent:t,content:a}=this.props;t?this.context.redactEvent(e.getRoomId(),t.getId()):(this.context.sendEvent(e.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:e.getId(),key:a}}),gn.a.dispatch({action:"message_sent"}))}),Fe()(this,"onMouseOver",()=>{this.setState({tooltipRendered:!0,tooltipVisible:!0})}),Fe()(this,"onMouseLeave",()=>{this.setState({tooltipVisible:!1})})}render(){const{mxEvent:e,content:t,count:a,reactionEvents:n,myReactionEvent:s}=this.props,o=Hn()({mx_ReactionsRowButton:!0,mx_ReactionsRowButton_selected:!!s});let r;this.state.tooltipRendered&&(r=i.a.createElement(HO,{mxEvent:this.props.mxEvent,content:t,reactionEvents:n,visible:this.state.tooltipVisible}));const l=this.context.getRoom(e.getRoomId());let c;if(l){const e=[];for(const t of n){const a=l.getMember(t.getSender()),n=a?a.name:t.getSender();e.push(n)}c=Object(ts.a)("<reactors/><reactedWith> reacted with %(content)s</reactedWith>",{content:t},{reactors:()=>Object(hs.b)(e,6),reactedWith:e=>t?e:null})}const d="join"!==l.getMyMembership();return i.a.createElement(Fs.a,{className:o,"aria-label":c,onClick:this.onClick,disabled:d,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave},i.a.createElement("span",{className:"mx_ReactionsRowButton_content","aria-hidden":"true"},t),i.a.createElement("span",{className:"mx_ReactionsRowButton_count","aria-hidden":"true"},a),r)}},Fe()(qO,"contextType",ns.a),KO=qO))||KO;var $O,JO;const QO=e=>{let{mxEvent:t,reactions:a}=e;const[n,s,o,r]=Object(Kr.q)();let l;if(n){const e=s.current.getBoundingClientRect();l=i.a.createElement(Kr.b,u()({},Object(Kr.k)(e),{onFinished:r,managed:!1}),i.a.createElement(vO,{mxEvent:t,reactions:a,onFinished:r}))}return i.a.createElement(i.a.Fragment,null,i.a.createElement(Em.a,{className:Hn()("mx_ReactionsRow_addReactionButton",{mx_ReactionsRow_addReactionButton_active:n}),title:Object(ts.a)("Add reaction"),onClick:o,onContextMenu:e=>{e.preventDefault(),o()},isExpanded:n,inputRef:s}),l)};let XO=Object(os.a)("views.messages.ReactionsRow")((JO=class extends i.a.PureComponent{constructor(e,t){super(e,t),Fe()(this,"onDecrypted",()=>{this.forceUpdate()}),Fe()(this,"onReactionsChange",()=>{this.setState({myReactions:this.getMyReactions()}),this.forceUpdate()}),Fe()(this,"onShowAllClick",()=>{this.setState({showAll:!0})}),this.state={myReactions:this.getMyReactions(),showAll:!1}}componentDidMount(){const{mxEvent:e,reactions:t}=this.props;(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&e.once("Event.decrypted",this.onDecrypted),t&&(t.on("Relations.add",this.onReactionsChange),t.on("Relations.remove",this.onReactionsChange),t.on("Relations.redaction",this.onReactionsChange))}componentWillUnmount(){const{mxEvent:e,reactions:t}=this.props;e.off("Event.decrypted",this.onDecrypted),t&&(t.off("Relations.add",this.onReactionsChange),t.off("Relations.remove",this.onReactionsChange),t.off("Relations.redaction",this.onReactionsChange))}componentDidUpdate(e){e.reactions!==this.props.reactions&&(this.props.reactions.on("Relations.add",this.onReactionsChange),this.props.reactions.on("Relations.remove",this.onReactionsChange),this.props.reactions.on("Relations.redaction",this.onReactionsChange),this.onReactionsChange())}getMyReactions(){const e=this.props.reactions;if(!e)return null;const t=this.context.getUserId(),a=e.getAnnotationsBySender()[t];return a?[...a.values()]:null}render(){const{mxEvent:e,reactions:t}=this.props,{myReactions:a,showAll:n}=this.state;if(!t||!Object(WO.c)(e))return null;let s,o=t.getSortedAnnotationsByKey().map(t=>{let[n,s]=t;const o=s.size;if(!o)return null;const r=a&&a.find(e=>!e.isRedacted()&&e.getRelation().key===n);return i.a.createElement(YO,{key:n,content:n,count:o,mxEvent:e,reactionEvents:s,myReactionEvent:r})}).filter(e=>!!e);if(!o.length)return null;o.length>9&&!n&&(o=o.slice(0,8),s=i.a.createElement("a",{className:"mx_ReactionsRow_showAll",href:"#",onClick:this.onShowAllClick},Object(ts.a)("Show all")));const r=this.context;let l;const c=r.getRoom(e.getRoomId());return"join"===c.getMyMembership()&&c.currentState.maySendEvent(vs.a.Reaction,r.getUserId())&&(l=i.a.createElement(QO,{mxEvent:e,reactions:t})),i.a.createElement("div",{className:"mx_ReactionsRow",role:"toolbar","aria-label":Object(ts.a)("Reactions")},o,s,l)}},Fe()(JO,"contextType",ns.a),$O=JO))||$O;var ZO,ex=a(802),tx=a(336),ax=a(811),nx=a(1365),sx=a(882),ix=a(883);const ox=[_m.c.GroupMemberInfo,_m.c.GroupMemberList],rx=[_m.c.GroupRoomList,_m.c.GroupRoomInfo];let lx=Object(os.a)("views.right_panel.GroupHeaderButtons")(ZO=class extends ix.b{constructor(e){super(e,ix.a.Group),Fe()(this,"onMembersClicked",()=>{this.state.phase===_m.c.GroupMemberInfo?this.setPhase(_m.c.GroupMemberInfo):this.setPhase(_m.c.GroupMemberList)}),Fe()(this,"onRoomsClicked",()=>{this.setPhase(_m.c.GroupRoomList)})}onAction(e){e.action===js.a.ViewUser?e.member?this.setPhase(_m.c.RoomMemberInfo,{member:e.member}):this.setPhase(_m.c.GroupMemberList):"view_group"===e.action?this.setPhase(_m.c.GroupMemberList):"view_group_room"===e.action?this.setPhase(_m.c.GroupRoomInfo,{groupRoomId:e.groupRoomId,groupId:e.groupId}):"view_group_room_list"===e.action?this.setPhase(_m.c.GroupRoomList):"view_group_member_list"===e.action?this.setPhase(_m.c.GroupMemberList):"view_group_user"===e.action&&this.setPhase(_m.c.GroupMemberInfo,{member:e.member})}renderButtons(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(sx.a,{name:"groupMembersButton",title:Object(ts.a)("Members"),isHighlighted:this.isPhase(ox),onClick:this.onMembersClicked,analytics:["Right Panel","Group Member List Button","click"]}),i.a.createElement(sx.a,{name:"roomsButton",title:Object(ts.a)("Rooms"),isHighlighted:this.isPhase(rx),onClick:this.onRoomsClicked,analytics:["Right Panel","Group Room List Button","click"]}))}})||ZO;var cx=a(635),dx=a(1481),mx=a(804),ux=a(1364),hx=a(1366),px=a(1350);class gx{constructor(e,t){if(Fe()(this,"commandRegex",void 0),Fe()(this,"forcedCommandRegex",void 0),e){if(!e.global)throw new Error("commandRegex must have global flag set");this.commandRegex=e}if(t){if(!t.global)throw new Error("forcedCommandRegex must have global flag set");this.forcedCommandRegex=t}}destroy(){}getCurrentCommand(e,t){let a,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.commandRegex;if(n&&this.shouldForceComplete()&&(s=this.forcedCommandRegex||/\S+/g),!s)return null;for(s.lastIndex=0;null!==(a=s.exec(e));){const e=a.index,n=e+a[0].length;if(t.start<=n&&t.end>=e)return{command:a,range:{start:e,end:n}}}return{command:null,range:{start:-1,end:-1}}}async getCompletions(e,t){return[]}getName(){return"Default Provider"}renderCompletions(e){return console.error("stub; should be implemented in subclasses"),null}shouldForceComplete(){return!1}}var fx=a(431);const vx=["title","subtitle","description","className"],bx=["title","subtitle","description","className","children"],yx=Object(s.forwardRef)((e,t)=>{const{title:a,subtitle:n,description:s,className:o}=e,r=te()(e,vx);return i.a.createElement("div",u()({},r,{className:Hn()("mx_Autocomplete_Completion_block",o),role:"option",ref:t}),i.a.createElement("span",{className:"mx_Autocomplete_Completion_title"},a),i.a.createElement("span",{className:"mx_Autocomplete_Completion_subtitle"},n),i.a.createElement("span",{className:"mx_Autocomplete_Completion_description"},s))}),Ex=Object(s.forwardRef)((e,t)=>{const{title:a,subtitle:n,description:s,className:o,children:r}=e,l=te()(e,bx);return i.a.createElement("div",u()({},l,{className:Hn()("mx_Autocomplete_Completion_pill",o),role:"option",ref:t}),r,i.a.createElement("span",{className:"mx_Autocomplete_Completion_title"},a),i.a.createElement("span",{className:"mx_Autocomplete_Completion_subtitle"},n),i.a.createElement("span",{className:"mx_Autocomplete_Completion_description"},s))});var _x=a(589),Sx=a(582);function Cx(e){const t=2*Math.PI/e.length;return Array.from(e).map((e,a)=>{if(" "===e)return e;const[n,s]=function(e,t){const a=127*t*Math.cos(e),n=127*t*Math.sin(e);return[a,n]}(a*t,1),[i,o,r]=function(e,t,a){let n=(e+16)/116;const s=.9505*wx(n+t/500),i=1.089*wx(n-a/200);n=wx(n);const o=-.96924364*s+1.8759675*n+.04155506*i,r=.05563008*s-.20397696*n+1.05697151*i;return[Ox(3.24096994*s-1.53738318*n-.49861076*i),Ox(o),Ox(r)]}(75,n,s);return'<font color="#'+i.toString(16).padStart(2,"0")+o.toString(16).padStart(2,"0")+r.toString(16).padStart(2,"0")+'">'+e+"</font>"}).join("")}function wx(e){return e>.2069?Math.pow(e,3):.1284*e-.01771}function Ox(e){const t=function(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055}(e),a=Math.min(Math.max(t,0),1);return Math.round(255*a)}var xx=a(363),Rx=a(416),kx=a(483),Ix=a(155),Tx=a(247),Px=a(788),Nx=a(8414),Dx=a(282);function jx(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ax(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?jx(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):jx(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Mx=async()=>new Promise(e=>{const t=document.createElement("input");t.setAttribute("type","file"),t.onchange=t=>{const a=t.target.files[0],n=On.getComponent("dialogs.UploadConfirmDialog");qd.a.createTrackedDialog("Upload Files confirmation","",n,{file:a,onFinished:t=>{e(t?Cs.a.get().uploadContent(a):null)}})},t.click()}),Ux={messages:Object(ts.b)("Messages"),actions:Object(ts.b)("Actions"),admin:Object(ts.b)("Admin"),advanced:Object(ts.b)("Advanced"),effects:Object(ts.b)("Effects"),other:Object(ts.b)("Other")};class Lx{constructor(e){Fe()(this,"command",void 0),Fe()(this,"aliases",void 0),Fe()(this,"args",void 0),Fe()(this,"description",void 0),Fe()(this,"runFn",void 0),Fe()(this,"category",void 0),Fe()(this,"hideCompletionAfterSpace",void 0),Fe()(this,"_isEnabled",void 0),this.command=e.command,this.aliases=e.aliases||[],this.args=e.args||"",this.description=e.description,this.runFn=e.runFn,this.category=e.category||Ux.other,this.hideCompletionAfterSpace=e.hideCompletionAfterSpace||!1,this._isEnabled=e.isEnabled}getCommand(){return"/"+this.command}getCommandWithArgs(){return this.getCommand()+" "+this.args}run(e,t){return this.runFn?this.runFn.bind(this)(e,t):Fx(Object(ts.a)("Command error"))}getUsage(){return Object(ts.a)("Usage")+": "+this.getCommandWithArgs()}isEnabled(){return!this._isEnabled||this._isEnabled()}}function Fx(e){return{error:e}}function Bx(e){return{promise:e}}const Vx=[new Lx({command:"spoiler",args:"<message>",description:Object(ts.b)("Sends the given message as a spoiler"),runFn:function(e,t){return Bx(_x.makeHtmlMessage(t,`<span data-mx-spoiler>${t}</span>`))},category:Ux.messages}),new Lx({command:"shrug",args:"<message>",description:Object(ts.b)("Prepends ¯\\_(ツ)_/¯ to a plain-text message"),runFn:function(e,t){let a="¯\\_(ツ)_/¯";return t&&(a=a+" "+t),Bx(_x.makeTextMessage(a))},category:Ux.messages}),new Lx({command:"tableflip",args:"<message>",description:Object(ts.b)("Prepends (╯°□°）╯︵ ┻━┻ to a plain-text message"),runFn:function(e,t){let a="(╯°□°）╯︵ ┻━┻";return t&&(a=a+" "+t),Bx(_x.makeTextMessage(a))},category:Ux.messages}),new Lx({command:"unflip",args:"<message>",description:Object(ts.b)("Prepends ┬──┬ ノ( ゜-゜ノ) to a plain-text message"),runFn:function(e,t){let a="┬──┬ ノ( ゜-゜ノ)";return t&&(a=a+" "+t),Bx(_x.makeTextMessage(a))},category:Ux.messages}),new Lx({command:"lenny",args:"<message>",description:Object(ts.b)("Prepends ( ͡° ͜ʖ ͡°) to a plain-text message"),runFn:function(e,t){let a="( ͡° ͜ʖ ͡°)";return t&&(a=a+" "+t),Bx(_x.makeTextMessage(a))},category:Ux.messages}),new Lx({command:"plain",args:"<message>",description:Object(ts.b)("Sends a message as plain text, without interpreting it as markdown"),runFn:function(e,t){return Bx(_x.makeTextMessage(t))},category:Ux.messages}),new Lx({command:"html",args:"<message>",description:Object(ts.b)("Sends a message as html, without interpreting it as markdown"),runFn:function(e,t){return Bx(_x.makeHtmlMessage(t,t))},category:Ux.messages}),new Lx({command:"ddg",args:"<query>",description:Object(ts.b)("Searches DuckDuckGo for results"),runFn:function(){const e=On.getComponent("dialogs.ErrorDialog");return qd.a.createTrackedDialog("Slash Commands","/ddg is not a command",e,{title:Object(ts.a)("/ddg is not a command"),description:Object(ts.a)("To use it, just wait for autocomplete results to load and tab through them.")}),Bx()},category:Ux.actions,hideCompletionAfterSpace:!0}),new Lx({command:"upgraderoom",args:"<new_version>",description:Object(ts.b)("Upgrades a room to a new version"),runFn:function(e,t){if(t){const a=Cs.a.get(),n=a.getRoom(e);if(!n.currentState.mayClientSendStateEvent("m.room.tombstone",a))return Fx(Object(ts.a)("You do not have the required permissions to use this command."));const s=On.getComponent("dialogs.RoomUpgradeWarningDialog"),{finished:i}=qd.a.createTrackedDialog("Slash Commands","upgrade room confirmation",s,{roomId:e,targetVersion:t},null,!1,!0);return Bx(i.then(async s=>{let i,[o]=s;if(o.continue)try{const s=a.upgradeRoom(e,t);o.invite&&(i=async e=>{const{replacement_room:t}=await s;if(e.roomId!==t)return;const o=[...n.getMembersWithMembership("join"),...n.getMembersWithMembership("invite")].map(e=>e.userId).filter(e=>e!==a.getUserId());o.length>0&&await Object(mu.b)(t,o),a.removeListener("Room",i)},a.on("Room",i)),await s}catch(e){console.error(e),i&&a.removeListener("Room",i);const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Slash Commands","room upgrade error",t,{title:Object(ts.a)("Error upgrading room"),description:Object(ts.a)("Double check that your server supports the room version chosen and try again.")})}}))}return Fx(this.getUsage())},category:Ux.admin}),new Lx({command:"nick",args:"<display_name>",description:Object(ts.b)("Changes your display nickname"),runFn:function(e,t){return t?Bx(Cs.a.get().setDisplayName(t)):Fx(this.getUsage())},category:Ux.actions}),new Lx({command:"myroomnick",aliases:["roomnick"],args:"<display_name>",description:Object(ts.b)("Changes your display nickname in the current room only"),runFn:function(e,t){if(t){const a=Cs.a.get(),n=a.getRoom(e).currentState.getStateEvents("m.room.member",a.getUserId()),s=Ax(Ax({},n?n.getContent():{membership:"join"}),{},{displayname:t});return Bx(a.sendStateEvent(e,"m.room.member",s,a.getUserId()))}return Fx(this.getUsage())},category:Ux.actions}),new Lx({command:"roomavatar",args:"[<mxc_url>]",description:Object(ts.b)("Changes the avatar of the current room"),runFn:function(e,t){let a=Promise.resolve(t);return t||(a=Mx()),Bx(a.then(t=>{if(t)return Cs.a.get().sendStateEvent(e,"m.room.avatar",{url:t},"")}))},category:Ux.actions}),new Lx({command:"myroomavatar",args:"[<mxc_url>]",description:Object(ts.b)("Changes your avatar in this current room only"),runFn:function(e,t){const a=Cs.a.get(),n=a.getRoom(e),s=a.getUserId();let i=Promise.resolve(t);return t||(i=Mx()),Bx(i.then(t=>{if(!t)return;const i=n.currentState.getStateEvents("m.room.member",s),o=Ax(Ax({},i?i.getContent():{membership:"join"}),{},{avatar_url:t});return a.sendStateEvent(e,"m.room.member",o,s)}))},category:Ux.actions}),new Lx({command:"myavatar",args:"[<mxc_url>]",description:Object(ts.b)("Changes your avatar in all rooms"),runFn:function(e,t){let a=Promise.resolve(t);return t||(a=Mx()),Bx(a.then(e=>{if(e)return Cs.a.get().setAvatarUrl(e)}))},category:Ux.actions}),new Lx({command:"topic",args:"[<topic>]",description:Object(ts.b)("Gets or sets the room topic"),runFn:function(e,t){const a=Cs.a.get();if(t)return Bx(a.setRoomTopic(e,t));const n=a.getRoom(e);if(!n)return Fx(Object(ts.a)("Failed to set topic"));const i=n.currentState.getStateEvents("m.room.topic",""),o=i&&i.getContent().topic,r=o?Object(tS.f)(o):Object(ts.a)("This room has no topic."),l=On.getComponent("dialogs.InfoDialog");return qd.a.createTrackedDialog("Slash Commands","Topic",l,{title:n.name,description:s.createElement("div",{dangerouslySetInnerHTML:{__html:r}}),hasCloseButton:!0}),Bx()},category:Ux.admin}),new Lx({command:"roomname",args:"<name>",description:Object(ts.b)("Sets the room name"),runFn:function(e,t){return t?Bx(Cs.a.get().setRoomName(e,t)):Fx(this.getUsage())},category:Ux.admin}),new Lx({command:"invite",args:"<user-id> [<reason>]",description:Object(ts.b)("Invites user with given id to current room"),runFn:function(e,t){if(t){const[a,n]=t.split(/\s+(.+)/);if(a){let t=Promise.resolve();if("email"===Object(xx.c)(a)&&!Cs.a.get().getIdentityServerUrl()){const e=Object(kx.c)();if(!e)return Fx(Object(ts.a)("Use an identity server to invite by email. Manage in Settings."));{const{finished:a}=qd.a.createTrackedDialog("Slash Commands","Identity server",$d.a,{title:Object(ts.a)("Use an identity server"),description:s.createElement("p",null,Object(ts.a)("Use an identity server to invite by email. Click continue to use the default identity server (%(defaultIdentityServerName)s) or manage in Settings.",{defaultIdentityServerName:Object(Rx.a)(e)})),button:Object(ts.a)("Continue")});t=a.then(e=>{let[t]=e;if(!t)throw new Error(Object(ts.a)("Use an identity server to invite by email. Manage in Settings."));Object(kx.d)()})}}const i=new Sx.a(e);return Bx(t.then(()=>i.invite([a],n)).then(()=>{if("invited"!==i.getCompletionState(a))throw new Error(i.getErrorText(a))}))}}return Fx(this.getUsage())},category:Ux.actions}),new Lx({command:"join",aliases:["j","goto"],args:"<room-address>",description:Object(ts.b)("Joins room with given address"),runFn:function(e,t){if(t){const e=t.split(" ");if(e.length<1)return Fx(this.getUsage());let a=!1;if(e[0].startsWith("http:")||e[0].startsWith("https:")){const t=new URL(e[0]),n=t.host||t.hostname;Object(Ix.d)(n)&&(a=!0)}if("#"===e[0][0]){let t=e[0];return t.includes(":")||(t+=":"+Cs.a.get().getDomain()),gn.a.dispatch({action:"view_room",room_alias:t,auto_join:!0,_type:"slash_command"}),Bx()}if("!"===e[0][0]){const[t,...a]=e;return gn.a.dispatch({action:"view_room",room_id:t,opts:{viaServers:a},via_servers:a,auto_join:!0,_type:"slash_command"}),Bx()}if(a){const t=Object(Ix.j)(e[0]);if(!t)return Fx(this.getUsage());if(!t.roomIdOrAlias)return Fx(this.getUsage());const a=t.roomIdOrAlias,n=t.viaServers,s=t.eventId,i={action:"view_room",auto_join:!0,_type:"slash_command"};return"!"===a[0]?i.room_id=a:i.room_alias=a,s&&(i.event_id=s,i.highlighted=!0),n&&(i.opts={viaServers:n},i.via_servers=n),gn.a.dispatch(i),Bx()}}return Fx(this.getUsage())},category:Ux.actions}),new Lx({command:"part",args:"[<room-address>]",description:Object(ts.b)("Leave room"),runFn:function(e,t){const a=Cs.a.get();let n;if(t){const e=t.match(/^(\S+)$/);if(e){let t=e[1];if("#"!==t[0])return Fx(this.getUsage());t.includes(":")||(t+=":"+a.getDomain());const s=a.getRooms();for(let e=0;e<s.length;e++){const a=s[e].currentState.getStateEvents("m.room.aliases");for(let i=0;i<a.length;i++){const o=a[i].getContent().aliases||[];for(let a=0;a<o.length;a++)if(o[a]===t){n=s[e].roomId;break}if(n)break}if(n)break}if(!n)return Fx(Object(ts.a)("Unrecognised room address:")+" "+t)}}return n||(n=e),Bx(Object(dE.d)(n))},category:Ux.actions}),new Lx({command:"kick",args:"<user-id> [reason]",description:Object(ts.b)("Kicks user with given id"),runFn:function(e,t){if(t){const a=t.match(/^(\S+?)( +(.*))?$/);if(a)return Bx(Cs.a.get().kick(e,a[1],a[3]))}return Fx(this.getUsage())},category:Ux.admin}),new Lx({command:"ban",args:"<user-id> [reason]",description:Object(ts.b)("Bans user with given id"),runFn:function(e,t){if(t){const a=t.match(/^(\S+?)( +(.*))?$/);if(a)return Bx(Cs.a.get().ban(e,a[1],a[3]))}return Fx(this.getUsage())},category:Ux.admin}),new Lx({command:"unban",args:"<user-id>",description:Object(ts.b)("Unbans user with given ID"),runFn:function(e,t){if(t){const a=t.match(/^(\S+)$/);if(a)return Bx(Cs.a.get().unban(e,a[1]))}return Fx(this.getUsage())},category:Ux.admin}),new Lx({command:"ignore",args:"<user-id>",description:Object(ts.b)("Ignores a user, hiding their messages from you"),runFn:function(e,t){if(t){const e=Cs.a.get(),a=t.match(/^(@[^:]+:\S+)$/);if(a){const t=a[1],n=e.getIgnoredUsers();return n.push(t),Bx(e.setIgnoredUsers(n).then(()=>{const e=On.getComponent("dialogs.InfoDialog");qd.a.createTrackedDialog("Slash Commands","User ignored",e,{title:Object(ts.a)("Ignored user"),description:s.createElement("div",null,s.createElement("p",null,Object(ts.a)("You are now ignoring %(userId)s",{userId:t})))})}))}}return Fx(this.getUsage())},category:Ux.actions}),new Lx({command:"unignore",args:"<user-id>",description:Object(ts.b)("Stops ignoring a user, showing their messages going forward"),runFn:function(e,t){if(t){const e=Cs.a.get(),a=t.match(/(^@[^:]+:\S+$)/);if(a){const t=a[1],n=e.getIgnoredUsers(),i=n.indexOf(t);return-1!==i&&n.splice(i,1),Bx(e.setIgnoredUsers(n).then(()=>{const e=On.getComponent("dialogs.InfoDialog");qd.a.createTrackedDialog("Slash Commands","User unignored",e,{title:Object(ts.a)("Unignored user"),description:s.createElement("div",null,s.createElement("p",null,Object(ts.a)("You are no longer ignoring %(userId)s",{userId:t})))})}))}}return Fx(this.getUsage())},category:Ux.actions}),new Lx({command:"op",args:"<user-id> [<power-level>]",description:Object(ts.b)("Define the power level of a user"),runFn:function(e,t){if(t){const a=t.match(/^(\S+?)( +(-?\d+))?$/);let n=50;if(a){const t=a[1];if(4===a.length&&void 0!==a[3]&&(n=parseInt(a[3],10)),!isNaN(n)){const a=Cs.a.get(),s=a.getRoom(e);if(!s)return Fx(Object(ts.a)("Command failed"));const i=s.getMember(t);if(!i||Object(dE.b)(i.membership)===dE.a.Leave)return Fx(Object(ts.a)("Could not find user in room"));const o=s.currentState.getStateEvents("m.room.power_levels","");return Bx(a.setPowerLevel(e,t,n,o))}}}return Fx(this.getUsage())},category:Ux.admin}),new Lx({command:"deop",args:"<user-id>",description:Object(ts.b)("Deops user with given id"),runFn:function(e,t){if(t){if(t.match(/^(\S+)$/)){const a=Cs.a.get(),n=a.getRoom(e);if(!n)return Fx(Object(ts.a)("Command failed"));const s=n.currentState.getStateEvents("m.room.power_levels","");return s.getContent().users[t]?Bx(a.setPowerLevel(e,t,void 0,s)):Fx(Object(ts.a)("Could not find user in room"))}}return Fx(this.getUsage())},category:Ux.admin}),new Lx({command:"devtools",description:Object(ts.b)("Opens the Developer Tools dialog"),runFn:function(e){const t=On.getComponent("dialogs.DevtoolsDialog");return qd.a.createDialog(t,{roomId:e}),Bx()},category:Ux.advanced}),new Lx({command:"addwidget",args:"<url | embed code | Jitsi url>",description:Object(ts.b)("Adds a custom widget by URL to the room"),isEnabled:()=>ss.b.getValue(vu.a.Widgets),runFn:function(e,t){if(!t)return Fx(Object(ts.a)("Please supply a widget URL or embed code"));if(t.toLowerCase().startsWith("<iframe ")){const e=Object(Nx.parseFragment)(t);if(e&&e.childNodes&&1===e.childNodes.length){const a=e.childNodes[0];if("iframe"===a.tagName.toLowerCase()&&a.attrs){const e=a.attrs.find(e=>"src"===e.name);console.log("Pulling URL out of iframe (embed code)"),t=e.value}}}if(!t.startsWith("https://")&&!t.startsWith("http://"))return Fx(Object(ts.a)("Please supply a https:// or http:// widget URL"));if(Pi.a.canUserModifyWidgets(e)){const a=Cs.a.get().getUserId(),n=(new Date).getTime(),s=encodeURIComponent(`${e}_${a}_${n}`);let i=Tx.a.CUSTOM,o="Custom Widget",r={};const l=Px.a.getInstance().parsePreferredConferenceUrl(t);return l&&(console.log("Making /addwidget widget a Jitsi conference"),i=Tx.a.JITSI,o="Jitsi Conference",r=l,t=Pi.a.getLocalJitsiWrapperUrl()),Bx(Pi.a.setRoomWidget(e,s,i,t,o,r))}return Fx(Object(ts.a)("You cannot modify widgets in this room."))},category:Ux.admin}),new Lx({command:"verify",args:"<user-id> <device-id> <device-signing-key>",description:Object(ts.b)("Verifies a user, session, and pubkey tuple"),runFn:function(e,t){if(t){const e=t.match(/^(\S+) +(\S+) +(\S+)$/);if(e){const t=Cs.a.get(),a=e[1],n=e[2],i=e[3];return Bx((async()=>{const e=t.getStoredDevice(a,n);if(!e)throw new Error(Object(ts.a)("Unknown (user, session) pair:")+` (${a}, ${n})`);if((await t.checkDeviceTrust(a,n)).isVerified())throw e.getFingerprint()===i?new Error(Object(ts.a)("Session already verified!")):new Error(Object(ts.a)("WARNING: Session already verified, but keys do NOT MATCH!"));if(e.getFingerprint()!==i){const t=e.getFingerprint();throw new Error(Object(ts.a)('WARNING: KEY VERIFICATION FAILED! The signing key for %(userId)s and session %(deviceId)s is "%(fprint)s" which does not match the provided key "%(fingerprint)s". This could mean your communications are being intercepted!',{fprint:t,userId:a,deviceId:n,fingerprint:i}))}await t.setDeviceVerified(a,n,!0);const o=On.getComponent("dialogs.InfoDialog");qd.a.createTrackedDialog("Slash Commands","Verified key",o,{title:Object(ts.a)("Verified key"),description:s.createElement("div",null,s.createElement("p",null,Object(ts.a)("The signing key you provided matches the signing key you received from %(userId)s's session %(deviceId)s. Session marked as verified.",{userId:a,deviceId:n})))})})())}}return Fx(this.getUsage())},category:Ux.advanced}),new Lx({command:"discardsession",description:Object(ts.b)("Forces the current outbound group session in an encrypted room to be discarded"),runFn:function(e){try{Cs.a.get().forceDiscardSession(e)}catch(e){return Fx(e.message)}return Bx()},category:Ux.advanced}),new Lx({command:"rainbow",description:Object(ts.b)("Sends the given message coloured as a rainbow"),args:"<message>",runFn:function(e,t){return t?Bx(_x.makeHtmlMessage(t,Cx(t))):Fx(this.getUserId())},category:Ux.messages}),new Lx({command:"rainbowme",description:Object(ts.b)("Sends the given emote coloured as a rainbow"),args:"<message>",runFn:function(e,t){return t?Bx(_x.makeHtmlEmote(t,Cx(t))):Fx(this.getUserId())},category:Ux.messages}),new Lx({command:"help",description:Object(ts.b)("Displays list of commands with usages and descriptions"),runFn:function(){const e=On.getComponent("dialogs.SlashCommandHelpDialog");return qd.a.createTrackedDialog("Slash Commands","Help",e),Bx()},category:Ux.advanced}),new Lx({command:"whois",description:Object(ts.b)("Displays information about a user"),args:"<user-id>",runFn:function(e,t){if(!t||!t.startsWith("@")||!t.includes(":"))return Fx(this.getUsage());const a=Cs.a.get().getRoom(e).getMember(t);return gn.a.dispatch({action:js.a.ViewUser,member:a||{userId:t}}),Bx()},category:Ux.advanced}),new Lx({command:"rageshake",aliases:["bugreport"],description:Object(ts.b)("Send a bug report with logs"),isEnabled:()=>!!$c.a.get().bug_report_endpoint_url,args:"<description>",runFn:function(e,t){return Bx(qd.a.createTrackedDialog("Slash Commands","Bug Report Dialog",au,{initialText:t}).finished)},category:Ux.advanced}),new Lx({command:"query",description:Object(ts.b)("Opens chat with the given user"),args:"<user-id>",runFn:function(e,t){const a=t&&/^\+?[0123456789]+$/.test(t);return t&&(t.startsWith("@")&&t.includes(":")||a)?Bx((async()=>{if(a){const e=await Vs.d.sharedInstance().pstnLookup(this.state.value);if(!e||0===e.length||!e[0].userid)throw new Error("Unable to find Matrix ID for phone number");t=e[0].userid}const e=await Object(nm.e)(Cs.a.get(),t);gn.a.dispatch({action:"view_room",room_id:e})})()):Fx(this.getUsage())},category:Ux.actions}),new Lx({command:"msg",description:Object(ts.b)("Sends a message to the given user"),args:"<user-id> <message>",runFn:function(e,t){if(t){const e=t.match(/^(\S+?)(?: +(.*))?$/s);if(e){const[t,a]=e.slice(1);if(a&&t&&t.startsWith("@")&&t.includes(":"))return Bx((async()=>{const e=Cs.a.get(),n=await Object(nm.e)(e,t);gn.a.dispatch({action:"view_room",room_id:n}),e.sendTextMessage(n,a)})())}}return Fx(this.getUsage())},category:Ux.actions}),new Lx({command:"holdcall",description:Object(ts.b)("Places the call in the current room on hold"),category:Ux.other,runFn:function(e,t){const a=Vs.d.sharedInstance().getCallForRoom(e);return a?(a.setRemoteOnHold(!0),Bx()):Fx("No active call in this room")}}),new Lx({command:"unholdcall",description:Object(ts.b)("Takes the call in the current room off hold"),category:Ux.other,runFn:function(e,t){const a=Vs.d.sharedInstance().getCallForRoom(e);return a?(a.setRemoteOnHold(!1),Bx()):Fx("No active call in this room")}}),new Lx({command:"converttodm",description:Object(ts.b)("Converts the room to a DM"),category:Ux.other,runFn:function(e,t){const a=Cs.a.get().getRoom(e);return Bx(Object(Yy.b)(a,!0))}}),new Lx({command:"converttoroom",description:Object(ts.b)("Converts the DM to a room"),category:Ux.other,runFn:function(e,t){const a=Cs.a.get().getRoom(e);return Bx(Object(Yy.b)(a,!1))}}),new Lx({command:"me",args:"<message>",description:Object(ts.b)("Displays action"),category:Ux.messages,hideCompletionAfterSpace:!0}),...Dx.CHAT_EFFECTS.map(e=>new Lx({command:e.command,description:e.description(),args:"<message>",runFn:function(t,a){return Bx((async()=>{if(a){const n={msgtype:e.msgType,body:a};Cs.a.get().sendMessage(t,n)}else a=e.fallbackMessage(),Cs.a.get().sendEmoteMessage(t,a);gn.a.dispatch({action:"effects."+e.command})})())},category:Ux.effects}))],Gx=new Map;function zx(e){if("/"!==(e=e.replace(/\s+$/,""))[0])return{};const t=e.match(/^(\S+?)(?:[ \n]+((.|\n)*))?$/);let a,n;return t?(a=t[1].substring(1).toLowerCase(),n=t[2]):a=e,{cmd:a,args:n}}function Wx(e){const{cmd:t,args:a}=zx(e);return Gx.has(t)&&Gx.get(t).isEnabled()?{cmd:Gx.get(t),args:a}:{}}Vx.forEach(e=>{Gx.set(e.command,e),e.aliases.forEach(t=>{Gx.set(t,e)})});const Hx=/(^\/\w*)(?: .*)?/g;const Kx=/\B\+\S*/g;const qx=/\/ddg\s+(.+)$/g;class Yx extends gx{constructor(){super(qx)}static getQueryUri(e){return"https://api.duckduckgo.com/?q="+encodeURIComponent(e)+"&format=json&no_redirect=1&no_html=1&t="+encodeURIComponent("vector")}async getCompletions(e,t){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;const{command:n,range:s}=this.getCurrentCommand(e,t);if(!e||!n)return[];const o=await fetch(Yx.getQueryUri(n[1]),{method:"GET"}),r=await o.json(),l=a>-1?a:r.Results.length,c=r.Results.slice(0,l).map(e=>({completion:e.Text,component:i.a.createElement(yx,{title:e.Text,description:e.Result}),range:s}));return r.Answer&&c.unshift({completion:r.Answer,component:i.a.createElement(yx,{title:r.Answer,description:r.AnswerType}),range:s}),r.RelatedTopics&&r.RelatedTopics.length>0&&c.unshift({completion:r.RelatedTopics[0].Text,component:i.a.createElement(yx,{title:r.RelatedTopics[0].Text}),range:s}),r.AbstractText&&c.unshift({completion:r.AbstractText,component:i.a.createElement(yx,{title:r.AbstractText}),range:s}),c}getName(){return"🔍 "+Object(ts.a)("Results from DuckDuckGo")}renderCompletions(e){return i.a.createElement("div",{className:"mx_Autocomplete_Completion_container_block",role:"listbox","aria-label":Object(ts.a)("DuckDuckGo Results")},e)}}const $x=/\B#\S*/g;function Jx(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return{room:e,matchName:a,displayedAlias:t}}class Qx extends gx{constructor(){super($x),Fe()(this,"matcher",void 0),this.matcher=new fx.a([],{keys:["displayedAlias","matchName"]})}getRooms(){let e=Cs.a.get().getVisibleRooms();return ss.b.getValue("feature_spaces")&&(e=e.filter(e=>!e.isSpaceRoom())),e}async getCompletions(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=[];const{command:o,range:r}=this.getCurrentCommand(e,t,a);if(o){let e=this.getRooms().reduce((e,t)=>{if(t.getCanonicalAlias()&&(e=e.concat(Jx(t,t.getCanonicalAlias(),t.name))),t.getAltAliases().length){const a=t.getAltAliases().map(e=>Jx(t,e));e=e.concat(a)}return e},[]);e=e.filter(t=>{const a=t.room.currentState.getStateEvents("m.room.tombstone","");if(a&&a.getContent()&&a.getContent().replacement_room){return!e.some(e=>e.room.roomId===a.getContent().replacement_room)}return!0}),this.matcher.setObjects(e);const t=o[0];s=this.matcher.match(t,n),s=Object(dC.sortBy)(s,[e=>function(e,t){const a=t.indexOf(e);return-1===a?1/0:a}(t,e.displayedAlias),e=>e.displayedAlias.length]),s=Object(dC.uniqBy)(s,e=>e.room),s=s.map(e=>({completion:e.displayedAlias,completionId:e.room.roomId,type:"room",suffix:" ",href:Object(Ix.g)(e.displayedAlias),component:i.a.createElement(Ex,{title:e.room.name,description:e.displayedAlias},i.a.createElement(Ws.a,{width:24,height:24,room:e.room})),range:r})).filter(e=>!!e.completion&&e.completion.length>0)}return s}getName(){return Object(ts.a)("Rooms")}renderCompletions(e){return i.a.createElement("div",{className:"mx_Autocomplete_Completion_container_pill mx_Autocomplete_Completion_container_truncate",role:"listbox","aria-label":Object(ts.a)("Room Autocomplete")},e)}}const Xx=/\B@\S*/g,Zx=/[^/,:; \t\n]\S*/g;var eR=a(1529),tR=a.n(eR);const aR=new RegExp("("+tR.a.source+"|(?:^|\\s):[+-\\w]*:?)$","g"),nR=Qw.b.sort((e,t)=>e.group===t.group?e.order-t.order:e.group-t.group).map((e,t)=>({emoji:e,shortname:`:${e.shortcodes[0]}:`,_orderBy:t}));function sR(e,t){const a=t.indexOf(e);return-1===a?1/0:a}const iR=/@\S*/g;class oR extends Qx{getRooms(){return Cs.a.get().getVisibleRooms().filter(e=>e.isSpaceRoom())}getName(){return Object(ts.a)("Spaces")}renderCompletions(e){return i.a.createElement("div",{className:"mx_Autocomplete_Completion_container_pill mx_Autocomplete_Completion_container_truncate",role:"listbox","aria-label":Object(ts.a)("Space Autocomplete")},e)}}const rR=[class extends gx{constructor(e){super(Xx,Zx),Fe()(this,"matcher",void 0),Fe()(this,"users",void 0),Fe()(this,"room",void 0),Fe()(this,"onRoomTimeline",(e,t,a,n,s)=>{t&&(n||t.roomId===this.room.roomId&&s.timeline.getTimelineSet()===t.getUnfilteredTimelineSet()&&!a&&s&&s.liveEvent&&this.onUserSpoke(e.sender))}),Fe()(this,"onRoomStateMember",(e,t,a)=>{a.roomId===this.room.roomId&&(this.users=null)}),this.room=e,this.matcher=new fx.a([],{keys:["name"],funcs:[e=>e.userId.slice(1)],shouldMatchWordsOnly:!1}),Cs.a.get().on("Room.timeline",this.onRoomTimeline),Cs.a.get().on("RoomState.members",this.onRoomStateMember)}destroy(){Cs.a.get()&&(Cs.a.get().removeListener("Room.timeline",this.onRoomTimeline),Cs.a.get().removeListener("RoomState.members",this.onRoomStateMember))}async getCompletions(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;const s=On.getComponent("views.avatars.MemberAvatar");this.users||this._makeUsers();let o=[];const{command:r,range:l}=this.getCurrentCommand(e,t,a);if(!r)return o;const c=r[0];if(c&&"@"!==c){const e=c.startsWith("@")?c.substring(1):c;o=this.matcher.match(e,n).map(e=>{const a=e.name||e.userId||"";return{completion:e.rawDisplayName,completionId:e.userId,type:"user",suffix:t.beginning&&0===l.start?": ":" ",href:Object(Ix.h)(e.userId),component:i.a.createElement(Ex,{title:a,description:e.userId},i.a.createElement(s,{member:e,width:24,height:24})),range:l}})}return o}getName(){return Object(ts.a)("Users")}_makeUsers(){const e=this.room.getLiveTimeline().getEvents(),t={};for(const a of e)t[a.getSender()]=a.getTs();const a=Cs.a.get().credentials.userId;this.users=this.room.getJoinedMembers().filter(e=>{let{userId:t}=e;return t!==a}),this.users=this.users.concat(this.room.getMembersWithMembership("invite")),this.users=Object(dC.sortBy)(this.users,e=>1e20-t[e.userId]||1e20),this.matcher.setObjects(this.users)}onUserSpoke(e){this.users&&e&&e.userId!==Cs.a.get().credentials.userId&&(this.users.splice(this.users.findIndex(t=>t.userId===e.userId),1),this.users=[e,...this.users],this.matcher.setObjects(this.users))}renderCompletions(e){return i.a.createElement("div",{className:"mx_Autocomplete_Completion_container_pill",role:"listbox","aria-label":Object(ts.a)("User Autocomplete")},e)}shouldForceComplete(){return!0}},Qx,class extends gx{constructor(){super(aR),Fe()(this,"matcher",void 0),Fe()(this,"nameMatcher",void 0),this.matcher=new fx.a(nR,{keys:["emoji.emoticon","shortname"],funcs:[e=>e.emoji.shortcodes.length>1?e.emoji.shortcodes.slice(1).map(e=>`:${e}:`).join(" "):""],shouldMatchWordsOnly:!1}),this.nameMatcher=new fx.a(nR,{keys:["emoji.annotation"],shouldMatchWordsOnly:!0})}async getCompletions(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;if(!ss.b.getValue("MessageComposerInput.suggestEmoji"))return[];let s=[];const{command:o,range:r}=this.getCurrentCommand(e,t);if(o){const e=o[0];s=this.matcher.match(e,n),s=s.concat(this.nameMatcher.match(e));const t=[];t.push(t=>sR(e,t.emoji.emoticon||"")),t.push(t=>sR(e,t.shortname)),t.push(t=>Math.min(...t.emoji.shortcodes.map(t=>sR(e.substring(1),t)))),e.length>1&&t.push(e=>e.shortname.length),t.push(e=>e._orderBy),s=Object(dC.sortBy)(Object(dC.uniq)(s),t),s=s.map(e=>{let{shortname:t}=e;const a=Object(tS.i)(t);return{completion:a,component:i.a.createElement(Ex,{title:t,"aria-label":a},i.a.createElement("span",null,a)),range:r}}).slice(0,20)}return s}getName(){return"😃 "+Object(ts.a)("Emoji")}renderCompletions(e){return i.a.createElement("div",{className:"mx_Autocomplete_Completion_container_pill",role:"listbox","aria-label":Object(ts.a)("Emoji Autocomplete")},e)}},class extends gx{constructor(e){super(iR),Fe()(this,"room",void 0),this.room=e}async getCompletions(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=On.getComponent("views.avatars.RoomAvatar"),s=Cs.a.get();if(!this.room.currentState.mayTriggerNotifOfType("room",s.credentials.userId))return[];const{command:o,range:r}=this.getCurrentCommand(e,t,a);return o&&o[0]&&"@room".startsWith(o[0])&&o[0].length>1?[{completion:"@room",completionId:"@room",type:"at-room",suffix:" ",component:i.a.createElement(Ex,{title:"@room",description:Object(ts.a)("Notify the whole room")},i.a.createElement(n,{width:24,height:24,room:this.room})),range:r}]:[]}getName(){return"❗️ "+Object(ts.a)("Room Notification")}renderCompletions(e){return i.a.createElement("div",{className:"mx_Autocomplete_Completion_container_pill mx_Autocomplete_Completion_container_truncate",role:"listbox","aria-label":Object(ts.a)("Notification Autocomplete")},e)}},class extends gx{constructor(){super(Hx),Fe()(this,"matcher",void 0),this.matcher=new fx.a(Vx,{keys:["command","args","description"],funcs:[e=>{let{aliases:t}=e;return t.join(" ")}]})}async getCompletions(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;const{command:s,range:o}=this.getCurrentCommand(e,t);if(!s)return[];let r=[];if(s[0]!==s[1]){const e=s[1].substr(1);if(Gx.has(e)&&Gx.get(e).isEnabled()){if(Gx.get(e).hideCompletionAfterSpace)return[];r=[Gx.get(e)]}}else r="/"===e?Vx:this.matcher.match(s[1],n);return r.filter(e=>e.isEnabled()).map(e=>{let t=e.getCommand()+" ";const a=e.aliases.find(e=>"/"+e===s[1]);return(a||e.getCommand()===s[1])&&(t=s[0]),{completion:t,type:"command",component:i.a.createElement(yx,{title:"/"+(a||e.command),subtitle:e.args,description:Object(ts.a)(e.description)}),range:o}})}getName(){return"*️⃣ "+Object(ts.a)("Commands")}renderCompletions(e){return i.a.createElement("div",{className:"mx_Autocomplete_Completion_container_block",role:"listbox","aria-label":Object(ts.a)("Command Autocomplete")},e)}},class extends gx{constructor(){super(Kx),Fe()(this,"matcher",void 0),this.matcher=new fx.a([],{keys:["groupId","name","shortDescription"]})}async getCompletions(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;const s=On.getComponent("views.avatars.BaseAvatar");if(/^(\/join|\/leave)/.test(e))return[];const o=Cs.a.get();let r=[];const{command:l,range:c}=this.getCurrentCommand(e,t,a);if(l){const e=o.getGroups().filter(e=>{let{myMembership:t}=e;return"join"===t}),t=await Promise.all(e.map(async e=>{let{groupId:t}=e;try{return pu.a.getGroupProfileCached(o,t)}catch(e){return Promise.resolve({name:"",groupId:t,avatarUrl:"",shortDescription:""})}}));this.matcher.setObjects(t);const a=l[0];r=this.matcher.match(a,n),r=Object(dC.sortBy)(r,[e=>function(e,t){const a=t.indexOf(e);return-1===a?1/0:a}(a,e.groupId),e=>e.groupId.length]).map(e=>{let{avatarUrl:t,groupId:a,name:n}=e;return{completion:a,suffix:" ",type:"community",href:Object(Ix.f)(a),component:i.a.createElement(Ex,{title:n,description:a},i.a.createElement(s,{name:n||a,width:24,height:24,url:t?Object(Os.b)(t).getSquareThumbnailHttp(24):null})),range:c}}).slice(0,4)}return r}getName(){return"💬 "+Object(ts.a)("Communities")}renderCompletions(e){return i.a.createElement("div",{className:"mx_Autocomplete_Completion_container_pill mx_Autocomplete_Completion_container_truncate",role:"listbox","aria-label":Object(ts.a)("Community Autocomplete")},e)}},Yx];ss.b.getValue("feature_spaces")&&rR.push(oR);class lR{constructor(e){Fe()(this,"room",void 0),Fe()(this,"providers",void 0),this.room=e,this.providers=rR.map(t=>new t(e))}destroy(){this.providers.forEach(e=>{e.destroy()})}async getCompletions(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;return(await Promise.all(this.providers.map(async s=>await Object(oE.d)(s.getCompletions(e,t,a,n),null,3e3)))).map((n,s)=>{if(n&&n.length)return{completions:n,provider:this.providers[s],command:this.providers[s].getCurrentCommand(e,t,a)}}).filter(Boolean)}}var cR;const dR=e=>"mx_Autocomplete_Completion_"+e;let mR=Object(os.a)("views.rooms.Autocomplete")(cR=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"autocompleter",void 0),Fe()(this,"queryRequested",void 0),Fe()(this,"debounceCompletionsRequest",void 0),Fe()(this,"containerRef",Object(s.createRef)()),Fe()(this,"hide",()=>{this.setState({hide:!0,selectionOffset:0,completions:[],completionList:[]})}),Fe()(this,"onCompletionClicked",e=>0!==this.countCompletions()&&0!==e&&(this.props.onConfirm(this.state.completionList[e-1]),this.hide(),!0)),this.autocompleter=new lR(e.room),this.state={completions:[],completionList:[],selectionOffset:0,shouldShowCompletions:!0,hide:!1,forceComplete:!1}}componentDidMount(){this.applyNewProps()}applyNewProps(e,t){t&&this.props.room.roomId!==t.roomId&&(this.autocompleter.destroy(),this.autocompleter=new lR(this.props.room)),e!==this.props.query&&this.complete(this.props.query,this.props.selection)}componentWillUnmount(){this.autocompleter.destroy()}complete(e,t){if(this.queryRequested=e,this.debounceCompletionsRequest&&clearTimeout(this.debounceCompletionsRequest),""===e)return this.setState({completions:[],completionList:[],selectionOffset:0,hide:!0}),Promise.resolve(null);let a=ss.b.getValue("autocompleteDelay");return(this.state.completions.length>0||this.state.forceComplete)&&(a=0),new Promise(n=>{this.debounceCompletionsRequest=setTimeout(()=>{n(this.processQuery(e,t))},a)})}processQuery(e,t){return this.autocompleter.getCompletions(e,t,this.state.forceComplete,20).then(t=>{e===this.queryRequested&&this.processCompletions(t)})}processCompletions(e){const t=Object(dC.flatMap)(e,e=>e.completions);let a=0;if(t.length>0){const e=0===this.state.selectionOffset?null:this.state.completionList[this.state.selectionOffset-1].completion;a=t.findIndex(t=>t.completion===e),-1===a?a=0:a++}let n=this.state.hide;n=!e.some(e=>!!e.command.command),this.setState({completions:e,completionList:t,selectionOffset:a,hide:n,forceComplete:!1})}hasSelection(){return this.countCompletions()>0&&0!==this.state.selectionOffset}countCompletions(){return this.state.completionList.length}moveSelection(e){const t=this.countCompletions();if(0===t)return;const a=(this.state.selectionOffset+e+t+1)%(t+1);this.setSelection(a)}onEscape(e){0!==this.countCompletions()&&(e.preventDefault(),this.hide())}forceComplete(){return new Promise(e=>{this.setState({forceComplete:!0,hide:!1},()=>{this.complete(this.props.query,this.props.selection).then(()=>{e(this.countCompletions())})})})}setSelection(e){this.setState({selectionOffset:e,hide:!1}),this.props.onSelectionChange&&this.props.onSelectionChange(this.state.completionList[e-1],e-1)}componentDidUpdate(e){this.applyNewProps(e.query,e.room);const t=this.refs["completion"+this.state.selectionOffset];t?t.scrollIntoView({behavior:"auto",block:"nearest"}):this.containerRef.current&&this.containerRef.current.scrollTo({top:0})}render(){let e=1;const t=this.state.completions.map((t,a)=>{const n=t.completions.map((t,a)=>{const n=e===this.state.selectionOffset,s=Hn()("mx_Autocomplete_Completion",{selected:n}),o=e;e++;return i.a.cloneElement(t.component,{key:a,ref:"completion"+o,id:dR(o-1),className:s,onClick:()=>{this.onCompletionClicked(o)},"aria-selected":n})});return n.length>0?i.a.createElement("div",{key:a,className:"mx_Autocomplete_ProviderSection"},i.a.createElement("div",{className:"mx_Autocomplete_provider_name"},t.provider.getName()),t.provider.renderCompletions(n)):null}).filter(e=>!!e);return!this.state.hide&&t.length>0?i.a.createElement("div",{className:"mx_Autocomplete",ref:this.containerRef},t):null}})||cR;var uR=a(605);class hR{constructor(){Fe()(this,"stack",[]),Fe()(this,"newlyTypedCharCount",0),Fe()(this,"currentIndex",-1),Fe()(this,"changedSinceLastPush",!1),Fe()(this,"lastCaret",null),Fe()(this,"nonWordBoundarySinceLastPush",!1),Fe()(this,"addedSinceLastPush",!1),Fe()(this,"removedSinceLastPush",!1)}clear(){this.stack=[],this.newlyTypedCharCount=0,this.currentIndex=-1,this.changedSinceLastPush=!1,this.lastCaret=null,this.nonWordBoundarySinceLastPush=!1,this.addedSinceLastPush=!1,this.removedSinceLastPush=!1}shouldPush(e,t){if(t&&("insertText"===e||"deleteContentForward"===e||"deleteContentBackward"===e)){if(t.added&&(this.addedSinceLastPush=!0),t.removed&&(this.removedSinceLastPush=!0),this.addedSinceLastPush!==this.removedSinceLastPush){const e=t.added?t.added:t.removed,a=" "===e||"\t"===e||"\n"===e;return!(!this.nonWordBoundarySinceLastPush||!a)||(a||(this.nonWordBoundarySinceLastPush=!0),this.newlyTypedCharCount+=e.length,this.newlyTypedCharCount>10)}return!0}return!0}pushState(e,t){for(;this.currentIndex<this.stack.length-1;)this.stack.pop();const a=e.serializeParts();this.stack.push({parts:a,caret:t}),this.currentIndex=this.stack.length-1,this.lastCaret=null,this.changedSinceLastPush=!1,this.newlyTypedCharCount=0,this.nonWordBoundarySinceLastPush=!1,this.addedSinceLastPush=!1,this.removedSinceLastPush=!1}tryPush(e,t,a,n){if("historyUndo"===a||"historyRedo"===a)return!1;const s=this.shouldPush(a,n);return s?this.pushState(e,t):(this.lastCaret=t,this.changedSinceLastPush=!0),s}ensureLastChangesPushed(e){this.changedSinceLastPush&&this.pushState(e,this.lastCaret)}canUndo(){return this.currentIndex>=1||this.changedSinceLastPush}canRedo(){return this.currentIndex<this.stack.length-1}undo(e){if(this.canUndo())return this.ensureLastChangesPushed(e),this.currentIndex-=1,this.stack[this.currentIndex]}redo(){if(this.canRedo())return this.changedSinceLastPush=!1,this.currentIndex+=1,this.stack[this.currentIndex]}}function pR(e,t){const a=!t||"newline"===t.type;return!e.canEdit&&(a||!t.canEdit)}function gR(e,t){return!e.canEdit&&t}function fR(e,t){const a=e.nextSibling;a?e.parentElement.insertBefore(t,a):e.parentElement.appendChild(t)}function vR(){const e=document.createElement("span");return e.className="caretNode",e.appendChild(document.createTextNode("\ufeff")),e}function bR(e){"\ufeff"!==e.textContent&&(e.textContent="\ufeff")}function yR(e){return e&&"SPAN"===e.tagName&&"caretNode"===e.className}function ER(e){if(e)for(e=e.nextSibling;e;){const t=e;e=e.nextSibling,t.remove()}}function _R(e,t){const a=t.parts.reduce((e,t)=>{if("newline"===t.type)e.push([]);else{e[e.length-1].push(t)}return e},[[]]);a.forEach((t,a)=>{let n=e.childNodes[a];for(;n&&("DIV"!==n.tagName||n.className);)e.removeChild(n),n=e.childNodes[a];n||(n=document.createElement("div"),e.appendChild(n)),t.length?function(e,t){let a,n;const s=t[t.length-1];for(const i of t){for(a=!n?e.firstChild:a.nextSibling,pR(i,n)&&(yR(a)?(bR(a),a=a.nextSibling):e.insertBefore(vR(),a));a&&!i.canUpdateDOMNode(a);){const t=a.nextSibling;e.removeChild(a),a=t}if(a&&i?i.updateDOMNode(a):i&&(a=i.toDOMNode(),e.appendChild(a)),gR(i,i===s))if(yR(a.nextSibling))a=a.nextSibling,bR(a);else{const e=vR();fR(a,e),a=e}n=i}ER(a)}(n,t):function(e){let t=!1,a=e.firstChild;for(;a;){const e=a.nextSibling;t||"BR"!==a.tagName?a.remove():t=!0,a=e}t||e.appendChild(document.createElement("br"))}(n)}),a.length?ER(e.children[a.length-1]):function(e){const t=e.firstChild;t&&(ER(t),t.remove())}(e)}const SR=(e,t,a)=>""===a.text[t].trim();class CR{constructor(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;this.model=e,Fe()(this,"_start",void 0),Fe()(this,"_end",void 0);const n=t.compare(a)<0;this._start=n?t:a,this._end=n?a:t}moveStart(e){this._start=this._start.forwardsWhile(this.model,()=>(e-=1)>=0)}trim(){this._start=this._start.forwardsWhile(this.model,SR),this._end=this._end.backwardsWhile(this.model,SR)}expandBackwardsWhile(e){this._start=this._start.backwardsWhile(this.model,e)}get text(){let e="";return this._start.iteratePartsBetween(this._end,this.model,(t,a,n)=>{const s=t.text.substring(a,n);e+=s}),e}replace(e){const t=e.reduce((e,t)=>e+t.text.length,0);let a=0;return this._start.iteratePartsBetween(this._end,this.model,(e,t,n)=>{a+=n-t}),this.model.replaceRange(this._start,this._end,e),t-a}get parts(){const e=[];return this._start.iteratePartsBetween(this._end,this.model,(t,a,n)=>{const s=t.serialize();s.text=t.text.substring(a,n);const i=this.model.partCreator.deserializePart(s);e.push(i)}),e}get length(){let e=0;return this._start.iteratePartsBetween(this._end,this.model,(t,a,n)=>{e+=n-a}),e}get start(){return this._start}get end(){return this._end}}function wR(e,t,a){a instanceof CR?function(e,t,a){const n=document.getSelection();n.removeAllRanges();const s=document.createRange(),i=OR(e,t,a.start);s.setStart(i.node,i.offset);const o=OR(e,t,a.end);s.setEnd(o.node,o.offset),n.addRange(s)}(e,t,a):function(e,t,a){const n=document.createRange(),{node:s,offset:i}=OR(e,t,a);n.setStart(s,i),n.collapse(!0);const o=document.getSelection();if(1===o.rangeCount){const e=o.getRangeAt(0);if(e.startContainer===n.startContainer&&e.startOffset===n.startOffset&&e.collapsed===n.collapsed)return}o.removeAllRanges(),o.addRange(n)}(e,t,a)}function OR(e,t,a){const{offset:n,lineIndex:s,nodeIndex:i}=function(e,t){const{parts:a}=e,n=t.index,s=function(e,t){let a=0,n=-1,s=null;for(let i=0;i<=t;++i){const o=e[i];if("newline"===o.type)a+=1,n=-1,s=null;else{if(n+=1,pR(o,s)&&(n+=1),i<t){const t=e[i+1],a=!t||"newline"===t.type;gR(o,a)&&(n+=1)}s=o}}return{lineIndex:a,nodeIndex:n}}(a,n),{lineIndex:i}=s;let{nodeIndex:o}=s,{offset:r}=t;-1===o?r=0:({nodeIndex:o,offset:r}=function(e,t,a,n){const s=e[t];if(s&&!s.canEdit)if(0===n){a-=1;const i=e[t-1];pR(s,i)||(n=i.text.length)}else a+=1,n=0;return{nodeIndex:a,offset:n}}(a,n,o,r));return{lineIndex:i,nodeIndex:o,offset:r}}(t,a),o=e.childNodes[s];let r;return-1===i?r=o:(r=o.childNodes[i],r.nodeType===Node.ELEMENT_NODE&&r.firstChild&&(r=r.firstChild)),{node:r,offset:n}}function xR(e,t){const{model:a}=e;a.transform(()=>{const n=e.length,s=e.replace(t),i=e.start.asOffset(a),o=i.add(n+s);return a.startRange(i.asPosition(a),o.asPosition(a))})}function RR(e,t){const{model:a}=e;a.transform(()=>{const n=e.length,s=e.replace(t);return e.start.asOffset(a).add(n+s).asPosition(a)})}function kR(e){const{model:t}=e,a=0!==e.start.offset,n=0===e.start.index,s=!n&&"newline"===t.parts[e.start.index-1].type;return!a&&(n||s)}function IR(e){const{model:t}=e,a=t.parts[e.end.index],n=e.end.offset!==a.text.length,s=e.end.index===t.parts.length-1,i=!s&&"newline"===t.parts[e.end.index+1].type;return!n&&(s||i)}const TR=e=>!e.text||!/\S/.test(e.text),PR=e=>"newline"===e.type;function NR(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;const{model:n,parts:s}=e,{partCreator:i}=n,o=[];let r=0;for(let e=2;e<s.length;e++)TR(s[e-2])&&PR(s[e-1])&&!PR(s[e])&&!TR(s[e])&&(r=e),PR(s[e-1])&&PR(s[e])?(o.push([r,e-1]),r=e+1):PR(s[e-2])&&TR(s[e-1])&&PR(s[e])&&(o.push([r,e-2]),r=e+1);const l=s.map(TR).lastIndexOf(!1);r<=l&&o.push([r,l+1]);let c=0;o.forEach(e=>{let[n,o]=e;const r=n+c,l=o+c;if(l-r>0&&s[r].text.startsWith(t)&&s[l-1].text.endsWith(a)){const e=s[r].serialize();e.text=e.text.substr(t.length),s[r]=i.deserializePart(e);const n=s[l-1].serialize(),o=n.text;n.text=o.substring(0,o.length-a.length),s[l-1]=i.deserializePart(n)}else s.splice(l,0,i.plain(a)),s.splice(r,0,i.plain(t)),c+=2}),xR(e,s)}class DR{constructor(e,t){this.offset=e,this.atNodeEnd=t}asPosition(e){return e.positionForOffset(this.offset,this.atNodeEnd)}add(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new DR(this.offset+e,t)}}function jR(e,t,a){let n=e.firstChild;for(;n&&n!==e;){if(t(n)&&n.firstChild)n=n.firstChild;else if(n.nextSibling)n=n.nextSibling;else{for(;!n.nextSibling&&n!==e;)n=n.parentElement,n!==e&&a(n);n!==e&&(n=n.nextSibling)}}}function AR(e,t){const{offset:a,text:n}=MR(e,t.focusNode,t.focusOffset);return{caret:a,text:n}}function MR(e,t,a){const{node:n,characterOffset:s}=function(e,t){for(;e&&e.nodeType===Node.ELEMENT_NODE;){const a=e.childNodes.length;if(!a)break;t>=a?t=(e=e.lastChild).nodeType===Node.TEXT_NODE?e.textContent.length:Number.MAX_SAFE_INTEGER:(e=e.childNodes[t],t=0)}return{node:e,characterOffset:t}}(t,a),{text:i,offsetToNode:o}=function(e,t){let a=0,n=!1,s="";function i(e){n||e===t&&(n=!0),"BR"===e.tagName&&e.nextSibling&&(n||(a+=1),s+="\n");const i=e.nodeType===Node.TEXT_NODE&&function(e){const t=e.nodeValue;return yR(e.parentElement)?1!==t.length?t.replace("\ufeff",""):"":t}(e);return i&&(n||(a+=i.length),s+=i),!0}function o(e){"DIV"===e.tagName&&e.nextSibling&&"DIV"===e.nextSibling.tagName&&(s+="\n",n||(a+=1))}return jR(e,i,o),{text:s,offsetToNode:a}}(e,n);return{offset:function(e,t,a){if(!e)return new DR(0,!1);let n=a===e.textContent.length;if(e.nodeType===Node.TEXT_NODE&&yR(e.parentElement)){const t=e.nodeValue.indexOf("\ufeff");-1!==t&&t<a&&(a-=1),n=!0}return new DR(t+a,n)}(n,o,s),text:i}}function UR(e,t,a){const n=MR(e,a.focusNode,a.focusOffset).offset,s=MR(e,a.anchorNode,a.anchorOffset).offset,i=n.asPosition(t),o=s.asPosition(t);return t.startRange(i,o)}class LR{constructor(e,t,a,n){this.updateCallback=e,this.getAutocompleterComponent=t,this.updateQuery=a,this.partCreator=n,Fe()(this,"queryPart",void 0),Fe()(this,"partIndex",void 0)}onEscape(e){this.getAutocompleterComponent().onEscape(e),this.updateCallback({replaceParts:[this.partCreator.plain(this.queryPart.text)],close:!0})}close(){this.updateCallback({close:!0})}hasSelection(){return this.getAutocompleterComponent().hasSelection()}hasCompletions(){const e=this.getAutocompleterComponent();return e&&e.countCompletions()>0}onEnter(){this.updateCallback({close:!0})}async startSelection(){const e=this.getAutocompleterComponent();0===e.countCompletions()&&(await e.forceComplete(),await e.moveSelection(1))}selectPreviousSelection(){this.getAutocompleterComponent().moveSelection(-1)}selectNextSelection(){this.getAutocompleterComponent().moveSelection(1)}onPartUpdate(e,t){return this.queryPart=e,this.partIndex=t.index,this.updateQuery(e.text)}onComponentSelectionChange(e){e?this.updateCallback({replaceParts:this.partForCompletion(e)}):this.updateCallback({replaceParts:[this.queryPart]})}onComponentConfirm(e){this.updateCallback({replaceParts:this.partForCompletion(e),close:!0})}partForCompletion(e){const{completionId:t}=e,a=e.completion;switch(e.type){case"room":return[this.partCreator.roomPill(a,t),this.partCreator.plain(e.suffix)];case"at-room":return[this.partCreator.atRoomPill(t),this.partCreator.plain(e.suffix)];case"user":return this.partCreator.createMentionParts(0===this.partIndex,a,t);case"command":return[this.partCreator.command(a)];default:return[this.partCreator.plain(a)]}}}var FR,BR=a(368);!function(e){e.Plain="plain",e.Newline="newline",e.Command="command",e.UserPill="user-pill",e.RoomPill="room-pill",e.AtRoomPill="at-room-pill",e.PillCandidate="pill-candidate"}(FR||(FR={}));class VR{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Fe()(this,"_text",void 0),this._text=e}acceptsInsertion(e,t,a){return!0}acceptsRemoval(e,t){return!0}merge(e){return!1}split(e){const t=this.text.substr(e);return this._text=this.text.substr(0,e),new zR(t)}remove(e,t){const a=this.text.substr(0,e)+this.text.substr(e+t);for(let n=e;n<t+e;++n){const e=this.text.charAt(n);if(!this.acceptsRemoval(n,e))return a}this._text=a}appendUntilRejected(e,t){const a=this.text.length;for(let n=0;n<e.length;++n){const s=e.charAt(n);if(!this.acceptsInsertion(s,a+n,t))return this._text=this._text+e.substr(0,n),e.substr(n)}this._text=this._text+e}validateAndInsert(e,t,a){for(let n=0;n<t.length;++n){const s=t.charAt(n);if(!this.acceptsInsertion(s,e+n,a))return!1}const n=this._text.substr(0,e),s=this._text.substr(e);return this._text=n+t+s,!0}createAutoComplete(e){}trim(e){const t=this._text.substr(e);return this._text=this._text.substr(0,e),t}get text(){return this._text}get canEdit(){return!0}toString(){return`${this.type}(${this.text})`}serialize(){return{type:this.type,text:this.text}}}class GR extends VR{acceptsInsertion(e,t,a){return"\n"!==e&&("insertFromPaste"===a||"insertFromDrop"===a||("@"!==e&&"#"!==e&&":"!==e&&"+"!==e||0!==t&&(" "!==this._text[t-1]&&("+"!==this._text[t-1]||":"!==e))))}toDOMNode(){return document.createTextNode(this.text)}merge(e){return e.type===this.type&&(this._text=this.text+e.text,!0)}updateDOMNode(e){e.textContent!==this.text&&(e.textContent=this.text)}canUpdateDOMNode(e){return e.nodeType===Node.TEXT_NODE}}class zR extends GR{get type(){return FR.Plain}}class WR extends VR{constructor(e,t){super(t),this.resourceId=e}acceptsInsertion(e){return" "!==e}acceptsRemoval(e,t){return 0!==e}toDOMNode(){const e=document.createElement("span");return e.setAttribute("spellcheck","false"),e.className=this.className,e.appendChild(document.createTextNode(this.text)),this.setAvatar(e),e}updateDOMNode(e){const t=e.childNodes[0];t.textContent!==this.text&&(t.textContent=this.text),e.className!==this.className&&(e.className=this.className),this.setAvatar(e)}canUpdateDOMNode(e){return e.nodeType===Node.ELEMENT_NODE&&"SPAN"===e.nodeName&&1===e.childNodes.length&&e.childNodes[0].nodeType===Node.TEXT_NODE}_setAvatarVars(e,t,a){const n=`url('${t}')`,s=`'${a}'`;e.style.getPropertyValue("--avatar-background")!==n&&e.style.setProperty("--avatar-background",n),e.style.getPropertyValue("--avatar-letter")!==s&&e.style.setProperty("--avatar-letter",s)}serialize(){return{type:this.type,text:this.text,resourceId:this.resourceId}}get canEdit(){return!1}}class HR extends VR{acceptsInsertion(e,t){return 0===t&&"\n"===e}acceptsRemoval(e,t){return!0}toDOMNode(){return document.createElement("br")}merge(){return!1}updateDOMNode(){}canUpdateDOMNode(e){return"BR"===e.tagName}get type(){return FR.Newline}get canEdit(){return!1}}class KR extends WR{constructor(e,t,a){super(e,t),this.room=a}setAvatar(e){let t="",a=BR.b(this.room,16,16,"crop");a||(t=BR.e(this.room?this.room.name:this.resourceId),a=BR.d(this.room?this.room.roomId:this.resourceId)),this._setAvatarVars(e,a,t)}get type(){return FR.RoomPill}get className(){return"mx_RoomPill mx_Pill"}}class qR extends KR{constructor(e,t){super(e,e,t)}get type(){return FR.AtRoomPill}serialize(){return{type:this.type,text:this.text}}}class YR extends WR{constructor(e,t,a){super(e,t),this.member=a}setAvatar(e){if(!this.member)return;const t=this.member.name||this.member.userId,a=BR.d(this.member.userId),n=BR.a(this.member,16,16,"crop");let s="";n===a&&(s=BR.e(t)),this._setAvatarVars(e,n,s)}get type(){return FR.UserPill}get className(){return"mx_UserPill mx_Pill"}}class $R extends GR{constructor(e,t){super(e),this.autoCompleteCreator=t}createAutoComplete(e){return this.autoCompleteCreator.create(e)}acceptsInsertion(e,t,a){return 0===t||super.acceptsInsertion(e,t,a)}merge(){return!1}acceptsRemoval(e,t){return!0}get type(){return FR.PillCandidate}}class JR extends class{constructor(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.room=e,this.client=t,Fe()(this,"autoCompleteCreator",void 0),this.autoCompleteCreator={create:a&&a(this)}}setAutoCompleteCreator(e){this.autoCompleteCreator.create=e(this)}createPartForInput(e,t,a){switch(e[0]){case"#":case"@":case":":case"+":return this.pillCandidate("");case"\n":return new HR;default:return new zR}}createDefaultPart(e){return this.plain(e)}deserializePart(e){switch(e.type){case FR.Plain:return this.plain(e.text);case FR.Newline:return this.newline();case FR.AtRoomPill:return this.atRoomPill(e.text);case FR.PillCandidate:return this.pillCandidate(e.text);case FR.RoomPill:return this.roomPill(e.resourceId);case FR.UserPill:return this.userPill(e.text,e.resourceId)}}plain(e){return new zR(e)}newline(){return new HR("\n")}pillCandidate(e){return new $R(e,this.autoCompleteCreator)}roomPill(e,t){let a;return a=t||"#"!==e[0]?this.client.getRoom(t||e):this.client.getRooms().find(t=>t.getCanonicalAlias()===e||t.getAltAliases().includes(e)),new KR(e,a?a.name:e,a)}atRoomPill(e){return new qR(e,this.room)}userPill(e,t){const a=this.room.getMember(t);return new YR(t,e,a)}createMentionParts(e,t,a){return[this.userPill(t,a),this.plain(e?": ":" ")]}}{createPartForInput(e,t){return 0===t&&"/"===e[0]?this.command(""):super.createPartForInput(e,t)}command(e){return new QR(e,this.autoCompleteCreator)}deserializePart(e){return"command"===e.type?this.command(e.text):super.deserializePart(e)}}class QR extends $R{get type(){return FR.Command}}function XR(e,t){const a=[];return e.split("@room").forEach((e,n,s)=>{e.length&&a.push(t.plain(e));n===s.length-1||a.push(t.atRoomPill("@room"))}),a}function ZR(e,t,a,n){switch(e.nodeName){case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":return function(e,t){const a=parseInt(e.nodeName.substr(1),10);return t.plain("#".repeat(a)+" ")}(e,t);case"A":return function(e,t){const{href:a}=e,n=Object(Ix.c)(a);switch(n?n[0]:void 0){case"@":return t.userPill(e.textContent,n);case"#":return t.roomPill(n);default:return a===e.textContent?t.plain(e.textContent):t.plain(`[${e.textContent.replace(/[[\\\]]/g,e=>"\\"+e)}](${a})`)}}(e,t);case"IMG":return function(e,t){const{src:a}=e;return t.plain(`![${e.alt.replace(/[[\\\]]/g,e=>"\\"+e)}](${a})`)}(e,t);case"BR":return t.newline();case"EM":return t.plain(`_${e.textContent}_`);case"STRONG":return t.plain(`**${e.textContent}**`);case"PRE":return function(e,t){const a=[];let n="";if(e.firstChild&&"CODE"===e.firstChild.nodeName)for(const t of e.firstChild.classList)if(t.startsWith("language-")&&!t.startsWith("language-_")){n=t.substr("language-".length);break}const s=("```"+n+"\n"+e.textContent+"```").split("\n");return s.forEach((e,n)=>{a.push(t.plain(e)),n<s.length-1&&a.push(t.newline())}),a}(e,t);case"CODE":return t.plain(`\`${e.textContent}\``);case"DEL":return t.plain(`<del>${e.textContent}</del>`);case"LI":{const a="  ".repeat(n.listDepth-1);if("OL"===e.parentElement.nodeName){const e=n.listIndex[n.listIndex.length-1];return n.listIndex[n.listIndex.length-1]+=1,t.plain(`${a}${e}. `)}return t.plain(a+"- ")}case"P":if(a)return t.newline();break;case"DIV":case"SPAN":if(e.hasAttribute("data-mx-maths")){const a="SPAN"==e.nodeName?(($c.a.get().latex_maths_delims||{}).inline||{}).left||"\\(":(($c.a.get().latex_maths_delims||{}).display||{}).left||"\\[",n="SPAN"==e.nodeName?(($c.a.get().latex_maths_delims||{}).inline||{}).right||"\\)":(($c.a.get().latex_maths_delims||{}).display||{}).right||"\\]",s=e.getAttribute("data-mx-maths");return t.plain(a+s+n)}if(!ek(e))return t.plain(e.textContent);break;case"OL":n.listIndex.push(e.start||1);case"UL":n.listDepth=(n.listDepth||0)+1;default:if(!ek(e))return t.plain(e.textContent)}}function ek(e){switch(e.nodeName){case"PRE":return!1;default:return Object(tS.c)(e)}}function tk(e){return e.nodeType===Node.TEXT_NODE?"\n"===e.nodeValue:e.nodeType!==Node.ELEMENT_NODE||"MX-REPLY"===e.nodeName}function ak(e,t,a){const n=(new DOMParser).parseFromString(e,"text/html").body,s=[];let i,o=a;const r={listIndex:[]};return jR(n,(function(e){if(tk(e))return!1;"BLOCKQUOTE"===e.nodeName&&(o=!0);const a=[];if(i&&(Object(tS.c)(i)||Object(tS.c)(e))&&a.push(t.newline()),e.nodeType===Node.TEXT_NODE)a.push(...XR(e.nodeValue,t));else if(e.nodeType===Node.ELEMENT_NODE){const n=ZR(e,t,i,r);n&&(Array.isArray(n)?a.push(...n):a.push(n))}if(a.length&&o){!function(e,t,a){e&&t.splice(0,0,a.plain("> "));for(let e=0;e<t.length;e+=1)"newline"===t[e].type&&(t.splice(e+1,0,a.plain("> ")),e+=1)}(0===s.length,a,t)}s.push(...a);const n=ek(e);return i=n?null:e,n}),(function(e){if(!tk(e)){switch(e.nodeName){case"BLOCKQUOTE":o=!1;break;case"OL":r.listIndex.pop();case"UL":r.listDepth-=1}i=e}})),s}function nk(e,t,a){const n=e.split(/\r\n|\r|\n/g);return n.reduce((e,s,i)=>{a&&e.push(t.plain("> ")),e.push(...XR(s,t));return i===n.length-1||e.push(t.newline()),e},[])}function sk(e,t){let{isQuotedMessage:a=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=e.getContent();let s;return s="org.matrix.custom.html"===n.format?ak(n.formatted_body||"",t,a):nk(n.body||"",t,a),"m.emote"===n.msgtype&&s.unshift(t.plain("/me ")),s}var ik,ok,rk=a(1377);let lk=Object(os.a)("views.rooms.MessageComposerFormatBar")((ok=class extends i.a.PureComponent{constructor(e){super(e),this.state={visible:!1}}render(){const e=Hn()("mx_MessageComposerFormatBar",{mx_MessageComposerFormatBar_shown:this.state.visible});return i.a.createElement("div",{className:e,ref:e=>this._formatBarRef=e},i.a.createElement(ck,{label:Object(ts.a)("Bold"),onClick:()=>this.props.onAction("bold"),icon:"Bold",shortcut:this.props.shortcuts.bold,visible:this.state.visible}),i.a.createElement(ck,{label:Object(ts.a)("Italics"),onClick:()=>this.props.onAction("italics"),icon:"Italic",shortcut:this.props.shortcuts.italics,visible:this.state.visible}),i.a.createElement(ck,{label:Object(ts.a)("Strikethrough"),onClick:()=>this.props.onAction("strikethrough"),icon:"Strikethrough",visible:this.state.visible}),i.a.createElement(ck,{label:Object(ts.a)("Code block"),onClick:()=>this.props.onAction("code"),icon:"Code",visible:this.state.visible}),i.a.createElement(ck,{label:Object(ts.a)("Quote"),onClick:()=>this.props.onAction("quote"),icon:"Quote",shortcut:this.props.shortcuts.quote,visible:this.state.visible}))}showAt(e){this.setState({visible:!0});const t=this._formatBarRef.parentElement.getBoundingClientRect();this._formatBarRef.style.left=e.left-t.left+"px",this._formatBarRef.style.top=e.top-t.top-16-12+"px"}hide(){this.setState({visible:!1})}},Fe()(ok,"propTypes",{onAction:At.a.func.isRequired,shortcuts:At.a.object.isRequired}),ik=ok))||ik;class ck extends i.a.PureComponent{render(){const e="mx_MessageComposerFormatBar_button mx_MessageComposerFormatBar_buttonIcon"+this.props.icon;let t;this.props.shortcut&&(t=i.a.createElement("div",{className:"mx_MessageComposerFormatBar_tooltipShortcut"},this.props.shortcut));const a=i.a.createElement("div",null,i.a.createElement("div",{className:"mx_Tooltip_title"},this.props.label),i.a.createElement("div",{className:"mx_Tooltip_sub"},t));return i.a.createElement(is.a,{element:"button",type:"button",onClick:this.props.onClick,title:this.props.label,tooltip:a,className:e})}}var dk;Fe()(ck,"propTypes",{label:At.a.string.isRequired,onClick:At.a.func.isRequired,icon:At.a.string.isRequired,shortcut:At.a.string,visible:At.a.bool});const mk=new RegExp("(?:^|\\s)("+tR.a.source+")\\s$"),uk=-1!==navigator.platform.indexOf("Mac");function hk(e){return(uk?"⌘":"Ctrl")+"+"+e}function pk(e){return{anchorNode:e.anchorNode,anchorOffset:e.anchorOffset,focusNode:e.focusNode,focusOffset:e.focusOffset,isCollapsed:e.isCollapsed,rangeCount:e.rangeCount,type:e.type}}var gk;!function(e){e.Bold="bold",e.Italics="italics",e.Strikethrough="strikethrough",e.Code="code",e.Quote="quote"}(gk||(gk={}));let fk=Object(os.a)("views.rooms.BasicMessageEditor")(dk=class extends i.a.Component{constructor(e){super(e),Fe()(this,"editorRef",Object(s.createRef)()),Fe()(this,"autocompleteRef",Object(s.createRef)()),Fe()(this,"formatBarRef",Object(s.createRef)()),Fe()(this,"modifiedFlag",!1),Fe()(this,"isIMEComposing",!1),Fe()(this,"hasTextSelected",!1),Fe()(this,"_isCaretAtEnd",void 0),Fe()(this,"lastCaret",void 0),Fe()(this,"lastSelection",void 0),Fe()(this,"emoticonSettingHandle",void 0),Fe()(this,"shouldShowPillAvatarSettingHandle",void 0),Fe()(this,"historyManager",new hR),Fe()(this,"replaceEmoticon",e=>{const{model:t}=this.props,a=t.startRange(e);let n=8;a.expandBackwardsWhile((e,a)=>{const s=t.parts[e];return n-=1,n>=0&&("plain"===s.type||"pill-candidate"===s.type)});const s=mk.exec(a.text);if(s){const e=s[1].replace("-",""),n=Qw.c.get(e)||Qw.c.get(e.toLowerCase());if(n){const{partCreator:e}=t,i=" "===s[0][0];return a.moveStart(s.index+(i?1:0)),a.replace([e.plain(n.unicode+" ")])}}}),Fe()(this,"updateEditorState",(e,t,a)=>{if(_R(this.editorRef.current,this.props.model),e){try{wR(this.editorRef.current,this.props.model,e)}catch(e){console.error(e)}const t=e instanceof CR?e.end:e;this.setLastCaretFromPosition(t)}const{isEmpty:n}=this.props.model;this.props.placeholder&&(n?this.showPlaceholder():this.hidePlaceholder()),n&&this.formatBarRef.current.hide(),this.setState({autoComplete:this.props.model.autoComplete}),this.historyManager.tryPush(this.props.model,e,t,a);let s=!this.props.model.isEmpty;if(s&&"command"===this.props.model.parts[0].type){const{cmd:e}=zx(this.props.model.parts[0].text),t=Gx.get(e);t&&t.isEnabled()&&t.category===Ux.messages||(s=!1)}rk.a.sharedInstance().setSelfTyping(this.props.room.roomId,s),this.props.onChange&&this.props.onChange()}),Fe()(this,"onCompositionStart",()=>{this.isIMEComposing=!0,this.hidePlaceholder()}),Fe()(this,"onCompositionEnd",()=>{this.isIMEComposing=!1;const e=navigator.userAgent.toLowerCase();e.includes("safari/")&&!e.includes("chrome/")?this.onInput({inputType:"insertCompositionText"}):Promise.resolve().then(()=>{this.onInput({inputType:"insertCompositionText"})})}),Fe()(this,"onCutCopy",(e,t)=>{const a=document.getSelection(),n=a.toString();if(n){const{model:s}=this.props,i=UR(this.editorRef.current,s,a),o=i.parts.map(e=>e.serialize());e.clipboardData.setData("application/x-element-composer",JSON.stringify(o)),e.clipboardData.setData("text/plain",n),"cut"===t&&(this.modifiedFlag=!0,RR(i,[])),e.preventDefault()}}),Fe()(this,"onCopy",e=>{this.onCutCopy(e,"copy")}),Fe()(this,"onCut",e=>{this.onCutCopy(e,"cut")}),Fe()(this,"onPaste",e=>{if(e.preventDefault(),this.props.onPaste&&this.props.onPaste(e,this.props.model))return!0;const{model:t}=this.props,{partCreator:a}=t,n=e.clipboardData.getData("application/x-element-composer");let s;if(n){s=JSON.parse(n).map(e=>a.deserializePart(e))}else{s=nk(e.clipboardData.getData("text/plain"),a)}this.modifiedFlag=!0;RR(UR(this.editorRef.current,t,document.getSelection()),s)}),Fe()(this,"onInput",e=>{if(this.isIMEComposing)return;this.modifiedFlag=!0;const t=document.getSelection(),{caret:a,text:n}=AR(this.editorRef.current,t);this.props.model.update(n,e.inputType,a)}),Fe()(this,"onBlur",()=>{document.removeEventListener("selectionchange",this.onSelectionChange)}),Fe()(this,"onFocus",()=>{document.addEventListener("selectionchange",this.onSelectionChange),this.lastSelection=null,this.refreshLastCaretIfNeeded()}),Fe()(this,"onSelectionChange",()=>{const{isEmpty:e}=this.props.model;this.refreshLastCaretIfNeeded();const t=document.getSelection();if(this.hasTextSelected&&t.isCollapsed)this.hasTextSelected=!1,this.formatBarRef.current&&this.formatBarRef.current.hide();else if(!t.isCollapsed&&!e&&(this.hasTextSelected=!0,this.formatBarRef.current)){const e=t.getRangeAt(0).getBoundingClientRect();this.formatBarRef.current.showAt(e)}}),Fe()(this,"onKeyDown",e=>{const t=this.props.model;let a=!1;switch(Object(Li.f)().getMessageComposerAction(e)){case Li.b.FormatBold:this.onFormatAction(gk.Bold),a=!0;break;case Li.b.FormatItalics:this.onFormatAction(gk.Italics),a=!0;break;case Li.b.FormatQuote:this.onFormatAction(gk.Quote),a=!0;break;case Li.b.EditRedo:if(this.historyManager.canRedo()){const{parts:e,caret:a}=this.historyManager.redo();t.reset(e,a,"historyRedo")}a=!0;break;case Li.b.EditUndo:if(this.historyManager.canUndo()){const{parts:e,caret:a}=this.historyManager.undo(this.props.model);t.reset(e,a,"historyUndo")}a=!0;break;case Li.b.NewLine:this.insertText("\n"),a=!0;break;case Li.b.MoveCursorToStart:wR(this.editorRef.current,t,{index:0,offset:0}),a=!0;break;case Li.b.MoveCursorToEnd:wR(this.editorRef.current,t,{index:t.parts.length-1,offset:t.parts[t.parts.length-1].text.length}),a=!0}if(a)return e.preventDefault(),void e.stopPropagation();const n=Object(Li.f)().getAutocompleteAction(e);if(t.autoComplete&&t.autoComplete.hasCompletions()){const s=t.autoComplete;switch(n){case Li.a.CompleteOrPrevSelection:case Li.a.PrevSelection:s.selectPreviousSelection(),a=!0;break;case Li.a.CompleteOrNextSelection:case Li.a.NextSelection:s.selectNextSelection(),a=!0;break;case Li.a.Cancel:s.onEscape(e),a=!0;break;default:return}}else n===Li.a.CompleteOrPrevSelection||n===Li.a.CompleteOrNextSelection?(this.tabCompleteName(),a=!0):e.key!==vi.a.BACKSPACE&&e.key!==vi.a.DELETE||this.formatBarRef.current.hide();a&&(e.preventDefault(),e.stopPropagation())}),Fe()(this,"onAutoCompleteConfirm",e=>{this.modifiedFlag=!0,this.props.model.autoComplete.onComponentConfirm(e)}),Fe()(this,"onAutoCompleteSelectionChange",(e,t)=>{this.modifiedFlag=!0,this.props.model.autoComplete.onComponentSelectionChange(e),this.setState({completionIndex:t})}),Fe()(this,"configureEmoticonAutoReplace",()=>{const e=ss.b.getValue("MessageComposerInput.autoReplaceEmoji");this.props.model.setTransformCallback(e?this.replaceEmoticon:null)}),Fe()(this,"configureShouldShowPillAvatar",()=>{const e=ss.b.getValue("Pill.shouldShowPillAvatar");this.setState({showPillAvatar:e})}),Fe()(this,"onFormatAction",e=>{const t=UR(this.editorRef.current,this.props.model,document.getSelection());if(t.trim(),0!==t.length)switch(this.historyManager.ensureLastChangesPushed(this.props.model),this.modifiedFlag=!0,e){case gk.Bold:NR(t,"**");break;case gk.Italics:NR(t,"_");break;case gk.Strikethrough:NR(t,"<del>","</del>");break;case gk.Code:!function(e){const{model:t,parts:a}=e,{partCreator:n}=t;a.some(e=>"newline"===e.type)?(a.unshift(n.plain("```"),n.newline()),kR(e)||a.unshift(n.newline()),a.push(n.newline(),n.plain("```")),IR(e)||a.push(n.newline())):(a.unshift(n.plain("`")),a.push(n.plain("`"))),xR(e,a)}(t);break;case gk.Quote:!function(e){const{model:t,parts:a}=e,{partCreator:n}=t;for(let e=0;e<a.length;++e){"newline"===a[e].type&&a.splice(e+1,0,n.plain("> "))}a.unshift(n.plain("> ")),kR(e)||a.unshift(n.newline()),IR(e)||a.push(n.newline()),a.push(n.newline()),xR(e,a)}(t)}}),this.state={showPillAvatar:ss.b.getValue("Pill.shouldShowPillAvatar")},this.emoticonSettingHandle=ss.b.watchSetting("MessageComposerInput.autoReplaceEmoji",null,this.configureEmoticonAutoReplace),this.configureEmoticonAutoReplace(),this.shouldShowPillAvatarSettingHandle=ss.b.watchSetting("Pill.shouldShowPillAvatar",null,this.configureShouldShowPillAvatar)}componentDidUpdate(e){const t=this.props.disabled!==e.disabled,a=this.props.placeholder!==e.placeholder;if(this.props.placeholder&&(a||t)){const{isEmpty:e}=this.props.model;e?this.showPlaceholder():this.hidePlaceholder()}}showPlaceholder(){const e=this.props.placeholder.replace(/'/g,"\\'");this.editorRef.current.style.setProperty("--placeholder",`'${e}'`),this.editorRef.current.classList.add("mx_BasicMessageComposer_inputEmpty")}hidePlaceholder(){this.editorRef.current.classList.remove("mx_BasicMessageComposer_inputEmpty"),this.editorRef.current.style.removeProperty("--placeholder")}isComposing(e){return!!(this.isIMEComposing||e.nativeEvent&&e.nativeEvent.isComposing)}insertText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"insertText";const a=document.getSelection(),{caret:n,text:s}=AR(this.editorRef.current,a),i=s.substr(0,n.offset)+e+s.substr(n.offset);n.offset+=e.length,this.modifiedFlag=!0,this.props.model.update(i,t,n)}setLastCaretFromPosition(e){const{model:t}=this.props;this._isCaretAtEnd=e.isAtEnd(t),this.lastCaret=e.asOffset(t),this.lastSelection=pk(document.getSelection())}refreshLastCaretIfNeeded(){if(!this.editorRef.current)return;const e=document.getSelection();if(!this.lastSelection||(t=this.lastSelection,a=e,t.anchorNode!==a.anchorNode||t.anchorOffset!==a.anchorOffset||t.focusNode!==a.focusNode||t.focusOffset!==a.focusOffset||t.isCollapsed!==a.isCollapsed||t.rangeCount!==a.rangeCount||t.type!==a.type)){this.lastSelection=pk(e);const{caret:t,text:a}=AR(this.editorRef.current,e);this.lastCaret=t,this._isCaretAtEnd=t.offset===a.length}var t,a;return this.lastCaret}clearUndoHistory(){this.historyManager.clear()}getCaret(){return this.lastCaret}isSelectionCollapsed(){return!this.lastSelection||this.lastSelection.isCollapsed}isCaretAtStart(){return 0===this.getCaret().offset}isCaretAtEnd(){return this._isCaretAtEnd}async tabCompleteName(){try{await new Promise(e=>this.setState({showVisualBell:!1},e));const{model:e}=this.props,t=this.getCaret(),a=e.positionForOffset(t.offset,t.atNodeEnd),n=e.startRange(a);n.expandBackwardsWhile((e,t,a)=>" "!==a.text[t]&&"+"!==a.text[t]&&("plain"===a.type||"pill-candidate"===a.type||"command"===a.type));const{partCreator:s}=e;await e.transform(()=>{const a=n.replace([s.pillCandidate(n.text)]);return e.positionForOffset(t.offset+a,!0)}),e.autoComplete&&(await e.autoComplete.startSelection(),e.autoComplete.hasSelection()||(this.setState({showVisualBell:!0}),e.autoComplete.close()))}catch(e){console.error(e)}}isModified(){return this.modifiedFlag}componentWillUnmount(){document.removeEventListener("selectionchange",this.onSelectionChange),this.editorRef.current.removeEventListener("input",this.onInput,!0),this.editorRef.current.removeEventListener("compositionstart",this.onCompositionStart,!0),this.editorRef.current.removeEventListener("compositionend",this.onCompositionEnd,!0),ss.b.unwatchSetting(this.emoticonSettingHandle),ss.b.unwatchSetting(this.shouldShowPillAvatarSettingHandle)}componentDidMount(){const e=this.props.model;e.setUpdateCallback(this.updateEditorState);var t,a;e.partCreator.setAutoCompleteCreator((t=()=>this.autocompleteRef.current,a=e=>new Promise(t=>this.setState({query:e},t)),e=>n=>new LR(n,t,a,e))),this.updateEditorState(this.getInitialCaretPosition()),this.editorRef.current.addEventListener("input",this.onInput,!0),this.editorRef.current.addEventListener("compositionstart",this.onCompositionStart,!0),this.editorRef.current.addEventListener("compositionend",this.onCompositionEnd,!0),this.editorRef.current.focus()}getInitialCaretPosition(){let e;if(this.props.initialCaret){const t=this.props.initialCaret;e=this.props.model.positionForOffset(t.offset,t.atNodeEnd)}else e=this.props.model.getPositionAtEnd();return e}render(){let e;if(this.state.autoComplete){const t=this.state.query,a=t.length;e=i.a.createElement("div",{className:"mx_BasicMessageComposer_AutoCompleteWrapper"},i.a.createElement(mR,{ref:this.autocompleteRef,query:t,onConfirm:this.onAutoCompleteConfirm,onSelectionChange:this.onAutoCompleteSelectionChange,selection:{beginning:!0,end:a,start:a},room:this.props.room}))}const t=Hn()("mx_BasicMessageComposer",{mx_BasicMessageComposer_input_error:this.state.showVisualBell}),a=Hn()("mx_BasicMessageComposer_input",{mx_BasicMessageComposer_input_shouldShowPillAvatar:this.state.showPillAvatar,mx_BasicMessageComposer_input_disabled:this.props.disabled}),n={bold:hk("B"),italics:hk("I"),quote:hk(">")},{completionIndex:s}=this.state;return i.a.createElement("div",{className:t},e,i.a.createElement(lk,{ref:this.formatBarRef,onAction:this.onFormatAction,shortcuts:n}),i.a.createElement("div",{className:a,contentEditable:"true",tabIndex:0,onBlur:this.onBlur,onFocus:this.onFocus,onCopy:this.onCopy,onCut:this.onCut,onPaste:this.onPaste,onKeyDown:this.onKeyDown,ref:this.editorRef,"aria-label":this.props.label,role:"textbox","aria-multiline":"true","aria-autocomplete":"both","aria-haspopup":"listbox","aria-expanded":Boolean(this.state.autoComplete),"aria-activedescendant":s>=0?dR(s):void 0,dir:"auto","aria-disabled":this.props.disabled}))}focus(){this.editorRef.current.focus()}})||dk;var vk,bk=a(296);const yk=[_s.a.Invite,_s.a.Favourite,_s.a.DM,_s.a.Untagged,_s.a.LowPriority,_s.a.ServerNotice,_s.a.Suggested,_s.a.Archived],Ek=_s.a.LowPriority,_k=[_s.a.DM,_s.a.Untagged],Sk=e=>{(e||gn.a).dispatch({action:"view_create_chat"})},Ck=e=>i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Start a Conversation"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_chat"})}}),i.a.createElement(Ls.b,{label:Object(ts.a)("Open dial pad"),iconClassName:"mx_RoomList_iconDialpad",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.OpenDialPad)}})),wk={[_s.a.Invite]:{sectionLabel:Object(ts.b)("Invites"),isInvite:!0,defaultHidden:!1},[_s.a.Favourite]:{sectionLabel:Object(ts.b)("Favourites"),isInvite:!1,defaultHidden:!1},[_s.a.DM]:{sectionLabel:Object(ts.b)("Patient Management"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Start chat")},[_s.a.Untagged]:{sectionLabel:Object(ts.b)("Category Management"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Add room"),addRoomContextMenu:e=>{if(Gs.e.instance.activeSpace){const t=Gs.e.instance.activeSpace.currentState.maySendStateEvent(vs.a.SpaceChild,Cs.a.get().getUserId());return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.d)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to create new rooms in this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Add existing room"),iconClassName:"mx_RoomList_iconHash",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.c)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to add rooms to this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Explore rooms"),iconClassName:"mx_RoomList_iconBrowse",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_room"})}}),i.a.createElement(Ls.b,{label:Bs.a.instance.getSelectedCommunityId()?Object(ts.a)("Explore community rooms"):Object(ts.a)("Explore public rooms"),iconClassName:"mx_RoomList_iconExplore",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}},[_s.a.LowPriority]:{sectionLabel:Object(ts.b)("Low priority"),isInvite:!1,defaultHidden:!1},[_s.a.ServerNotice]:{sectionLabel:Object(ts.b)("System Alerts"),isInvite:!1,defaultHidden:!1},[_s.a.Archived]:{sectionLabel:Object(ts.b)("Historical"),isInvite:!1,defaultHidden:!0},[_s.a.Suggested]:{sectionLabel:Object(ts.b)("Suggested Rooms"),isInvite:!1,defaultHidden:!1}};let Ok=Object(os.a)("views.rooms.GlobitsMenuList")(vk=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"customTagStoreRef",void 0),Fe()(this,"tagAesthetics",void 0),Fe()(this,"roomStoreToken",void 0),Fe()(this,"onRoomViewStoreUpdate",()=>{this.setState({currentRoomId:Es.a.getRoomId()})}),Fe()(this,"onAction",e=>{if(e.action===js.a.ViewRoomDelta){const t=e,a=Es.a.getRoomId(),n=this.getRoomDelta(a,t.delta,t.unread);n&&gn.a.dispatch({action:"view_room",room_id:n.roomId,show_room_tile:!0})}else e.action===js.a.PstnSupportUpdated&&(this.updateDmAddRoomAction(),this.updateLists())}),Fe()(this,"getRoomDelta",(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=ys.b.instance.orderedLists,s=[];yk.forEach(t=>{let i=n[t];a&&(i=i.filter(t=>{const a=As.a.instance.getRoomState(t);return a.room.roomId===e||a.isUnread})),s.push(...i)});const i=s.findIndex(t=>t.roomId===e),[o]=s.slice((i+t)%s.length);return o})),Fe()(this,"updateSuggestedRooms",e=>{this.setState({suggestedRooms:e})}),Fe()(this,"updateLists",()=>{const e=ys.b.instance.orderedLists;ss.b.getValue("advancedRoomListLogging")&&console.log("new lists",e);const t=Object.keys(this.state.sublists),a=Object.keys(e).filter(e=>!Object(_s.d)(e)||us.a.getTags()[e]),n=!!ys.b.instance.getFirstNameFilterCondition();let s=this.state.isNameFiltering!==n||Object(Ms.d)(t,a);if(!s)for(const t of a){const a=this.state.sublists[t],n=e[t];if(a.length!==n.length){s=!0;break}}if(s){const t=Object(Us.f)(e,a),s=Object(Us.e)(t,(e,t)=>Object(Ms.b)(t));this.setState({sublists:s,isNameFiltering:n})}}),Fe()(this,"onStartChat",()=>{ei.getTest()}),Fe()(this,"onExplore",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;gn.a.dispatch({action:js.a.ViewRoomDirectory,initialText:t})}),Fe()(this,"onSpaceInviteClick",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;Object(zs.e)(this.props.activeSpace,t)}),this.state={sublists:{},isNameFiltering:!!ys.b.instance.getFirstNameFilterCondition(),suggestedRooms:Gs.e.instance.suggestedRooms},this.tagAesthetics=Object(Us.e)(wk),this.updateDmAddRoomAction()}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),this.roomStoreToken=Es.a.addListener(this.onRoomViewStoreUpdate),Gs.e.instance.on(Gs.a,this.updateSuggestedRooms),ys.b.instance.on(ys.a,this.updateLists),this.customTagStoreRef=us.a.addListener(this.updateLists),this.updateLists()}componentWillUnmount(){Gs.e.instance.off(Gs.a,this.updateSuggestedRooms),ys.b.instance.off(ys.a,this.updateLists),gn.a.unregister(this.dispatcherRef),this.customTagStoreRef&&this.customTagStoreRef.remove(),this.roomStoreToken&&this.roomStoreToken.remove()}updateDmAddRoomAction(){const e=Object(Us.e)(wk[_s.a.DM]);Vs.d.sharedInstance().getSupportsPstnProtocol()?e.addRoomContextMenu=Ck:e.onAddRoom=Sk,this.tagAesthetics[_s.a.DM]=e}renderSuggestedRooms(){return this.state.suggestedRooms.map(e=>{var t;const a=e.name||e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0])||Object(ts.a)("Empty room"),n=i.a.createElement(Ws.a,{oobData:{name:a,avatarUrl:e.avatar_url},width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:this.state.currentRoomId===e.room_id,displayName:a,avatar:n,onClick:()=>{var t;gn.a.dispatch({action:"view_room",room_alias:e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0]),room_id:e.room_id,via_servers:e.viaServers,oobData:{avatarUrl:e.avatar_url,name:a}})},key:"suggestedRoomTile_"+e.room_id})})}renderCommunityInvites(){return Cs.a.get().getGroups().filter(e=>"invite"===e.myMembership).map(e=>{const t=i.a.createElement(Is,{groupId:e.groupId,groupName:e.name,groupAvatarUrl:e.avatarUrl,width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:!1,displayName:e.name,avatar:t,notificationState:Ds.a.RED_EXCLAMATION,onClick:()=>{gn.a.dispatch({action:"view_group",group_id:e.groupId})},key:"temporaryGroupTile_"+e.groupId})})}renderSublists(){const e=!this.state.isNameFiltering&&Object.values(ys.b.instance.unfilteredLists).every(e=>!(null!=e&&e.length));return yk.reduce((e,t)=>{if(t===Ek){const t=Object.keys(this.state.sublists).filter(e=>Object(_s.d)(e));e.push(...t)}return e.push(t),e},[]).map(t=>{let a=null;t===_s.a.Invite?a=this.renderCommunityInvites():t===_s.a.Suggested&&(a=this.renderSuggestedRooms());const n=Object(_s.d)(t)?((s=t).startsWith("u.")&&(s=s.substring(2)),{sectionLabel:Object(ts.b)("Custom Tag"),sectionLabelRaw:s,isInvite:!1,defaultHidden:!1}):this.tagAesthetics[t];var s;if(!n)throw new Error(`Tag ${t} does not have aesthetics`);return i.a.createElement(Xs.a,{key:"sublist-"+t,tagId:t,forRooms:!0,startAsHidden:n.defaultHidden,label:n.sectionLabelRaw?n.sectionLabelRaw:Object(ts.a)(n.sectionLabel),onAddRoom:n.onAddRoom,addRoomLabel:n.addRoomLabel?Object(ts.a)(n.addRoomLabel):n.addRoomLabel,addRoomContextMenu:n.addRoomContextMenu,isMinimized:this.props.isMinimized,showSkeleton:e,extraTiles:a,resizeNotifier:this.props.resizeNotifier,alwaysVisible:_k.includes(t),onListCollapse:this.props.onListCollapse})})}render(){const e=Cs.a.get().getUserId();let t;var a,n;if(!this.props.isMinimized)if(this.state.isNameFiltering)t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Can't see what you’re looking for?")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Start a new chat")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_explore",kind:"link",onClick:this.onExplore},this.props.activeSpace?Object(ts.a)("Explore rooms"):Object(ts.a)("Explore all public rooms")));else if(null!==(a=this.props.activeSpace)&&void 0!==a&&a.canInvite(e)||"join"===(null===(n=this.props.activeSpace)||void 0===n?void 0:n.getMyMembership()))t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Quick actions")),this.props.activeSpace.canInvite(e)&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceInvite",onClick:this.onSpaceInviteClick},Object(ts.a)("Invite people")),"join"===this.props.activeSpace.getMyMembership()&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceExplore",onClick:this.onExplore},Object(ts.a)("Explore rooms")));else if(Object.values(this.state.sublists).some(e=>e.length>0)){const e=ys.b.instance.unfilteredLists,a=e[_s.a.Untagged]||[],n=e[_s.a.Archived]||[],s=e[_s.a.Favourite]||[];a.length<1&&n<1&&s<1&&(t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Add a new Patient"))))}const s=this.renderSublists();return i.a.createElement(bs.c,{handleHomeEnd:!0,onKeyDown:this.props.onKeyDown},e=>{let{onKeyDownHandler:a}=e;return i.a.createElement("div",{onFocus:this.props.onFocus,onBlur:this.props.onBlur,onKeyDown:a,className:"mx_RoomList",role:"tree","aria-label":Object(ts.a)("List of Patient")},s,t)})}})||vk;var xk;const Rk=[_s.a.Invite,_s.a.Favourite,_s.a.DM,_s.a.Untagged,_s.a.LowPriority,_s.a.ServerNotice,_s.a.Suggested,_s.a.Archived],kk=_s.a.LowPriority,Ik=[_s.a.DM,_s.a.Untagged],Tk=e=>{(e||gn.a).dispatch({action:"view_create_chat"})},Pk=e=>i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Start a Conversation"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_chat"})}}),i.a.createElement(Ls.b,{label:Object(ts.a)("Open dial pad"),iconClassName:"mx_RoomList_iconDialpad",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.OpenDialPad)}})),Nk={[_s.a.Invite]:{sectionLabel:Object(ts.b)("Invites"),isInvite:!0,defaultHidden:!1},[_s.a.Favourite]:{sectionLabel:Object(ts.b)("Favourites"),isInvite:!1,defaultHidden:!1},[_s.a.DM]:{sectionLabel:Object(ts.b)("People"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Start chat")},[_s.a.Untagged]:{sectionLabel:Object(ts.b)("Rooms"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Add room"),addRoomContextMenu:e=>{if(Gs.e.instance.activeSpace){const t=Gs.e.instance.activeSpace.currentState.maySendStateEvent(vs.a.SpaceChild,Cs.a.get().getUserId());return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.d)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to create new rooms in this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Add existing room"),iconClassName:"mx_RoomList_iconHash",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.c)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to add rooms to this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Explore rooms"),iconClassName:"mx_RoomList_iconBrowse",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_room"})}}),i.a.createElement(Ls.b,{label:Bs.a.instance.getSelectedCommunityId()?Object(ts.a)("Explore community rooms"):Object(ts.a)("Explore public rooms"),iconClassName:"mx_RoomList_iconExplore",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}},[_s.a.LowPriority]:{sectionLabel:Object(ts.b)("Low priority"),isInvite:!1,defaultHidden:!1},[_s.a.ServerNotice]:{sectionLabel:Object(ts.b)("System Alerts"),isInvite:!1,defaultHidden:!1},[_s.a.Archived]:{sectionLabel:Object(ts.b)("Historical"),isInvite:!1,defaultHidden:!0},[_s.a.Suggested]:{sectionLabel:Object(ts.b)("Suggested Rooms"),isInvite:!1,defaultHidden:!1}};let Dk=Object(os.a)("views.rooms.GlobitsRoomList")(xk=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"customTagStoreRef",void 0),Fe()(this,"tagAesthetics",void 0),Fe()(this,"roomStoreToken",void 0),Fe()(this,"onRoomViewStoreUpdate",()=>{this.setState({currentRoomId:Es.a.getRoomId()})}),Fe()(this,"onAction",e=>{if(e.action===js.a.ViewRoomDelta){const t=e,a=Es.a.getRoomId(),n=this.getRoomDelta(a,t.delta,t.unread);n&&gn.a.dispatch({action:"view_room",room_id:n.roomId,show_room_tile:!0})}else e.action===js.a.PstnSupportUpdated&&(this.updateDmAddRoomAction(),this.updateLists())}),Fe()(this,"getRoomDelta",(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=ys.b.instance.orderedLists,s=[];Rk.forEach(t=>{let i=n[t];a&&(i=i.filter(t=>{const a=As.a.instance.getRoomState(t);return a.room.roomId===e||a.isUnread})),s.push(...i)});const i=s.findIndex(t=>t.roomId===e),[o]=s.slice((i+t)%s.length);return o})),Fe()(this,"updateSuggestedRooms",e=>{this.setState({suggestedRooms:e})}),Fe()(this,"updateLists",()=>{const e=ys.b.instance.orderedLists;ss.b.getValue("advancedRoomListLogging")&&console.log("new lists",e);const t=Object.keys(this.state.sublists),a=Object.keys(e).filter(e=>!Object(_s.d)(e)||us.a.getTags()[e]),n=!!ys.b.instance.getFirstNameFilterCondition();let s=this.state.isNameFiltering!==n||Object(Ms.d)(t,a);if(!s)for(const t of a){const a=this.state.sublists[t],n=e[t];if(a.length!==n.length){s=!0;break}}if(s){const t=Object(Us.f)(e,a),s=Object(Us.e)(t,(e,t)=>Object(Ms.b)(t));this.setState({sublists:s,isNameFiltering:n})}}),Fe()(this,"onStartChat",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;gn.a.dispatch({action:"view_create_chat",initialText:t})}),Fe()(this,"onExplore",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;gn.a.dispatch({action:js.a.ViewRoomDirectory,initialText:t})}),Fe()(this,"onSpaceInviteClick",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;Object(zs.e)(this.props.activeSpace,t)}),this.state={sublists:{},isNameFiltering:!!ys.b.instance.getFirstNameFilterCondition(),suggestedRooms:Gs.e.instance.suggestedRooms},this.tagAesthetics=Object(Us.e)(Nk),this.updateDmAddRoomAction()}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),this.roomStoreToken=Es.a.addListener(this.onRoomViewStoreUpdate),Gs.e.instance.on(Gs.a,this.updateSuggestedRooms),ys.b.instance.on(ys.a,this.updateLists),this.customTagStoreRef=us.a.addListener(this.updateLists),this.updateLists()}componentWillUnmount(){Gs.e.instance.off(Gs.a,this.updateSuggestedRooms),ys.b.instance.off(ys.a,this.updateLists),gn.a.unregister(this.dispatcherRef),this.customTagStoreRef&&this.customTagStoreRef.remove(),this.roomStoreToken&&this.roomStoreToken.remove()}updateDmAddRoomAction(){const e=Object(Us.e)(Nk[_s.a.DM]);Vs.d.sharedInstance().getSupportsPstnProtocol()?e.addRoomContextMenu=Pk:e.onAddRoom=Tk,this.tagAesthetics[_s.a.DM]=e}renderSuggestedRooms(){return this.state.suggestedRooms.map(e=>{var t;const a=e.name||e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0])||Object(ts.a)("Empty room"),n=i.a.createElement(Ws.a,{oobData:{name:a,avatarUrl:e.avatar_url},width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:this.state.currentRoomId===e.room_id,displayName:a,avatar:n,onClick:()=>{var t;gn.a.dispatch({action:"view_room",room_alias:e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0]),room_id:e.room_id,via_servers:e.viaServers,oobData:{avatarUrl:e.avatar_url,name:a}})},key:"suggestedRoomTile_"+e.room_id})})}renderCommunityInvites(){return Cs.a.get().getGroups().filter(e=>"invite"===e.myMembership).map(e=>{const t=i.a.createElement(Is,{groupId:e.groupId,groupName:e.name,groupAvatarUrl:e.avatarUrl,width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:!1,displayName:e.name,avatar:t,notificationState:Ds.a.RED_EXCLAMATION,onClick:()=>{gn.a.dispatch({action:"view_group",group_id:e.groupId})},key:"temporaryGroupTile_"+e.groupId})})}renderSublists(){const e=!this.state.isNameFiltering&&Object.values(ys.b.instance.unfilteredLists).every(e=>!(null!=e&&e.length));return Rk.reduce((e,t)=>{if(t===kk){const t=Object.keys(this.state.sublists).filter(e=>Object(_s.d)(e));e.push(...t)}return e.push(t),e},[]).map(t=>{let a=null;t===_s.a.Invite?a=this.renderCommunityInvites():t===_s.a.Suggested&&(a=this.renderSuggestedRooms());const n=Object(_s.d)(t)?((s=t).startsWith("u.")&&(s=s.substring(2)),{sectionLabel:Object(ts.b)("Custom Tag"),sectionLabelRaw:s,isInvite:!1,defaultHidden:!1}):this.tagAesthetics[t];var s;if(!n)throw new Error(`Tag ${t} does not have aesthetics`);return i.a.createElement(Ss.a,{key:"sublist-"+t,tagId:t,forRooms:!0,startAsHidden:n.defaultHidden,label:n.sectionLabelRaw?n.sectionLabelRaw:Object(ts.a)(n.sectionLabel),onAddRoom:n.onAddRoom,addRoomLabel:n.addRoomLabel?Object(ts.a)(n.addRoomLabel):n.addRoomLabel,addRoomContextMenu:n.addRoomContextMenu,isMinimized:this.props.isMinimized,showSkeleton:e,extraTiles:a,resizeNotifier:this.props.resizeNotifier,alwaysVisible:Ik.includes(t),onListCollapse:this.props.onListCollapse})})}render(){const e=Cs.a.get().getUserId();let t;var a,n;if(!this.props.isMinimized)if(this.state.isNameFiltering)t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Can't see what you’re looking for?")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Start a new chat")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_explore",kind:"link",onClick:this.onExplore},this.props.activeSpace?Object(ts.a)("Explore rooms"):Object(ts.a)("Explore all public rooms")));else if(null!==(a=this.props.activeSpace)&&void 0!==a&&a.canInvite(e)||"join"===(null===(n=this.props.activeSpace)||void 0===n?void 0:n.getMyMembership()))t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Quick actions")),this.props.activeSpace.canInvite(e)&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceInvite",onClick:this.onSpaceInviteClick},Object(ts.a)("Invite people")),"join"===this.props.activeSpace.getMyMembership()&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceExplore",onClick:this.onExplore},Object(ts.a)("Explore rooms")));else if(Object.values(this.state.sublists).some(e=>e.length>0)){const e=ys.b.instance.unfilteredLists,a=e[_s.a.Untagged]||[],n=e[_s.a.Archived]||[],s=e[_s.a.Favourite]||[];a.length<1&&n<1&&s<1&&(t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Use the + to make a new room or explore existing ones below")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Start a new chat")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_explore",kind:"link",onClick:this.onExplore},"List Page")))}const s=this.renderSublists();return i.a.createElement(bs.c,{handleHomeEnd:!0,onKeyDown:this.props.onKeyDown},e=>{let{onKeyDownHandler:a}=e;return i.a.createElement("div",{onFocus:this.props.onFocus,onBlur:this.props.onBlur,onKeyDown:a,className:"mx_RoomList",role:"tree","aria-label":Object(ts.a)("Rooms")},s,t)})}})||xk;var jk,Ak=a(1435),Mk=a(853),Uk=a(280),Lk=a(854),Fk=a(855),Bk=a(858),Vk=a(441);function Gk(e){const t=On.getComponent("avatars.MemberStatusMessageAvatar");return i.a.createElement("div",{className:"mx_MessageComposer_avatar"},i.a.createElement(t,{member:e.me,width:24,height:24}))}function zk(e){return i.a.createElement(is.a,{className:"mx_MessageComposer_sendMessage",onClick:e.onClick,title:Object(ts.a)("Send message")})}const Wk=e=>{let{addEmoji:t}=e;const[a,n,s,o]=Object(Kr.q)();let r;if(a){const e=n.current.getBoundingClientRect(),a=On.getComponent("emojipicker.EmojiPicker");r=i.a.createElement(Kr.b,u()({},Object(Kr.k)(e),{onFinished:o,managed:!1}),i.a.createElement(a,{onChoose:t,showQuickReactions:!0}))}const l=Hn()("mx_MessageComposer_button","mx_MessageComposer_emoji",{mx_MessageComposer_button_highlight:a});return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kr.d,{className:l,onClick:s,isExpanded:a,title:Object(ts.a)("Emoji picker"),inputRef:n}),r)};class Hk extends i.a.Component{constructor(e){super(e),Fe()(this,"uploadInput",i.a.createRef()),Fe()(this,"dispatcherRef",void 0),Fe()(this,"onAction",e=>{"upload_file"===e.action&&this.onUploadClick()}),Fe()(this,"onUploadClick",()=>{Cs.a.get().isGuest()?gn.a.dispatch({action:"require_registration"}):this.uploadInput.current.click()}),Fe()(this,"onUploadFileInputChange",e=>{if(0===e.target.files.length)return;const t=[];for(let a=0;a<e.target.files.length;++a)t.push(e.target.files[a]);BS.a.sharedInstance().sendContentListToRoom(t,this.props.roomId,Cs.a.get()),e.target.value=""}),this.dispatcherRef=gn.a.register(this.onAction)}componentWillUnmount(){gn.a.unregister(this.dispatcherRef)}render(){return i.a.createElement(is.a,{className:"mx_MessageComposer_button mx_MessageComposer_upload",onClick:this.onUploadClick,title:Object(ts.a)("Upload file")},i.a.createElement("input",{ref:this.uploadInput,type:"file",style:{display:"none"},multiple:!0,onChange:this.onUploadFileInputChange}))}}let Kk=Object(os.a)("views.rooms.MessageComposer")(jk=class extends i.a.Component{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"messageComposerInput",void 0),Fe()(this,"voiceRecordingButton",void 0),Fe()(this,"onAction",e=>{"reply_to_event"===e.action&&setTimeout(()=>{this.props.resizeNotifier.notifyTimelineHeightChanged()},100)}),Fe()(this,"onRoomStateEvents",(e,t)=>{e.getRoomId()===this.props.room.roomId&&("m.room.tombstone"===e.getType()&&this.setState({tombstone:this.getRoomTombstone()}),"m.room.power_levels"===e.getType()&&this.setState({canSendMessages:this.props.room.maySendMessage()}))}),Fe()(this,"onTombstoneClick",e=>{e.preventDefault();const t=this.state.tombstone.getContent().replacement_room,a=Cs.a.get().getRoom(t);let n=null;if(a){const e=a.currentState.getStateEvents("m.room.create","");e&&e.getId()&&(n=e.getId())}const s=[this.state.tombstone.getSender().split(":").splice(1).join(":")];gn.a.dispatch({action:"view_room",highlighted:!0,event_id:n,room_id:t,auto_join:!0,_type:"tombstone",via_servers:s,opts:{viaServers:s}})}),Fe()(this,"renderPlaceholderText",()=>this.props.replyToEvent?this.props.e2eStatus?Object(ts.a)("Send an encrypted reply…"):Object(ts.a)("Send a reply…"):this.props.e2eStatus?Object(ts.a)("Send an encrypted message…"):Object(ts.a)("Send a message…")),Fe()(this,"sendMessage",async()=>{this.state.haveRecording&&this.voiceRecordingButton?await this.voiceRecordingButton.send():this.messageComposerInput._sendMessage()}),Fe()(this,"onChange",e=>{this.setState({isComposerEmpty:e.isEmpty})}),Fe()(this,"onVoiceStoreUpdate",()=>{const e=Bk.a.instance.activeRecording;this.setState({haveRecording:!!e}),e&&e.on(Vk.b.EndingSoon,e=>{let{secondsLeft:t}=e;this.setState({recordingTimeLeftSeconds:t}),setTimeout(()=>this.setState({recordingTimeLeftSeconds:null}),3e3)})}),Bk.a.instance.on(gi.b,this.onVoiceStoreUpdate),this.state={tombstone:this.getRoomTombstone(),canSendMessages:this.props.room.maySendMessage(),isComposerEmpty:!0,haveRecording:!1,recordingTimeLeftSeconds:null}}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),Cs.a.get().on("RoomState.events",this.onRoomStateEvents),this.waitForOwnMember()}waitForOwnMember(){const e=this.props.room.getMember(Cs.a.get().getUserId());e?this.setState({me:e}):this.props.room.loadMembersIfNeeded().then(()=>{const e=this.props.room.getMember(Cs.a.get().getUserId());this.setState({me:e})})}componentWillUnmount(){Cs.a.get()&&Cs.a.get().removeListener("RoomState.events",this.onRoomStateEvents),Bk.a.instance.off(gi.b,this.onVoiceStoreUpdate),gn.a.unregister(this.dispatcherRef)}getRoomTombstone(){return this.props.room.currentState.getStateEvents("m.room.tombstone","")}addEmoji(e){gn.a.dispatch({action:"insert_emoji",emoji:e})}render(){const e=[this.state.me?i.a.createElement(Gk,{key:"controls_avatar",me:this.state.me}):null,this.props.e2eStatus?i.a.createElement(Uk.b,{key:"e2eIcon",status:this.props.e2eStatus,className:"mx_MessageComposer_e2eIcon"}):null];if(!this.state.tombstone&&this.state.canSendMessages){const t=On.getComponent("rooms.SendMessageComposer");e.push(i.a.createElement(t,{ref:e=>this.messageComposerInput=e,key:"controls_input",room:this.props.room,placeholder:this.renderPlaceholderText(),resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.props.permalinkCreator,replyToEvent:this.props.replyToEvent,onChange:this.onChange,disabled:this.state.haveRecording})),this.state.haveRecording||e.push(i.a.createElement(Hk,{key:"controls_upload",roomId:this.props.room.roomId}),i.a.createElement(Wk,{key:"emoji_button",addEmoji:this.addEmoji})),ss.b.getValue(vu.a.Widgets)&&ss.b.getValue("MessageComposerInput.showStickersButton")&&!this.state.haveRecording&&e.push(i.a.createElement(Mk.a,{key:"stickerpicker_controls_button",room:this.props.room})),ss.b.getValue("feature_voice_messages")&&e.push(i.a.createElement(Fk.a,{key:"controls_voice_record",ref:e=>this.voiceRecordingButton=e,room:this.props.room})),this.state.isComposerEmpty&&!this.state.haveRecording||e.push(i.a.createElement(zk,{key:"controls_send",onClick:this.sendMessage}))}else if(this.state.tombstone){const t=this.state.tombstone.getContent().replacement_room,n=t?i.a.createElement("a",{href:Object(Ix.g)(t),className:"mx_MessageComposer_roomReplaced_link",onClick:this.onTombstoneClick},Object(ts.a)("The conversation continues here.")):"";e.push(i.a.createElement("div",{className:"mx_MessageComposer_replaced_wrapper",key:"room_replaced"},i.a.createElement("div",{className:"mx_MessageComposer_replaced_valign"},i.a.createElement("img",{className:"mx_MessageComposer_roomReplaced_icon",src:a(1445)}),i.a.createElement("span",{className:"mx_MessageComposer_roomReplaced_header"},Object(ts.a)("This room has been replaced and is no longer active.")),i.a.createElement("br",null),n)))}else e.push(i.a.createElement("div",{key:"controls_error",className:"mx_MessageComposer_noperm_error"},Object(ts.a)("You do not have permission to post to this room")));let t;const n=Math.round(this.state.recordingTimeLeftSeconds);return n&&(t=i.a.createElement(qw.b,{label:Object(ts.a)("%(seconds)ss left",{seconds:n}),alignment:qw.a.Top,yOffset:-50})),i.a.createElement("div",{className:"mx_MessageComposer mx_GroupLayout"},t,i.a.createElement(Lk.a,{permalinkCreator:this.props.permalinkCreator}),i.a.createElement("div",{className:"mx_MessageComposer_wrapper"},i.a.createElement("div",{className:"mx_MessageComposer_row"},e)))}})||jk;var qk,Yk=()=>{const e=Object(s.useContext)(ns.a),{room:t,roomId:a}=Object(s.useContext)(Zc.a),n=aE.a.shared().getUserIdForRoomId(a);let o;if(n){let e;t.getJoinedMemberCount()+t.getInvitedMemberCount()===2&&(e=Object(ts.a)("Only the two of you are in this conversation, unless either of you invites anyone to join."));const a=null==t?void 0:t.getMember(n);null==a||a.rawDisplayName;o=i.a.createElement(i.a.Fragment,null,i.a.createElement(Ws.a,{room:t,width:52,height:52,onClick:()=>{gn.a.dispatch({action:js.a.ViewUser,member:a||{userId:n}})}}),i.a.createElement("h2",null,t.name))}else{var r,l;const n=null===(r=t.currentState.getStateEvents(vs.a.RoomAvatar,""))||void 0===r||null===(l=r.getContent())||void 0===l?void 0:l.url;o=i.a.createElement(i.a.Fragment,null,i.a.createElement(ad,{hasAvatar:!!n,noAvatarLabel:"",setAvatarUrl:t=>e.sendStateEvent(a,vs.a.RoomAvatar,{url:t},"")},i.a.createElement(Ws.a,{room:t,width:52,height:52})),i.a.createElement("h2",null,t.name))}return i.a.createElement("div",{className:"mx_NewRoomIntro"},o)},$k=a(1338);const Jk=[_s.a.Invite,_s.a.Favourite,_s.a.DM,_s.a.Untagged,_s.a.LowPriority,_s.a.ServerNotice,_s.a.Suggested,_s.a.Archived],Qk=_s.a.LowPriority,Xk=[_s.a.DM,_s.a.Untagged],Zk=e=>{(e||gn.a).dispatch({action:"view_create_chat"})},eI=e=>i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Start a Conversation"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_chat"})}}),i.a.createElement(Ls.b,{label:Object(ts.a)("Open dial pad"),iconClassName:"mx_RoomList_iconDialpad",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.OpenDialPad)}})),tI={[_s.a.Invite]:{sectionLabel:Object(ts.b)("Invites"),isInvite:!0,defaultHidden:!1},[_s.a.Favourite]:{sectionLabel:Object(ts.b)("Favourites"),isInvite:!1,defaultHidden:!1},[_s.a.DM]:{sectionLabel:Object(ts.b)("People"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Start chat")},[_s.a.Untagged]:{sectionLabel:Object(ts.b)("Rooms"),isInvite:!1,defaultHidden:!1,addRoomLabel:Object(ts.b)("Add room"),addRoomContextMenu:e=>{if(Gs.e.instance.activeSpace){const t=Gs.e.instance.activeSpace.currentState.maySendStateEvent(vs.a.SpaceChild,Cs.a.get().getUserId());return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.d)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to create new rooms in this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Add existing room"),iconClassName:"mx_RoomList_iconHash",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),Object(zs.c)(Cs.a.get(),Gs.e.instance.activeSpace)},disabled:!t,tooltip:t?void 0:Object(ts.a)("You do not have permissions to add rooms to this space")}),i.a.createElement(Ls.b,{label:Object(ts.a)("Explore rooms"),iconClassName:"mx_RoomList_iconBrowse",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}return i.a.createElement(Ls.c,{first:!0},i.a.createElement(Ls.b,{label:Object(ts.a)("Create new room"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.dispatch({action:"view_create_room"})}}),i.a.createElement(Ls.b,{label:Bs.a.instance.getSelectedCommunityId()?Object(ts.a)("Explore community rooms"):Object(ts.a)("Explore public rooms"),iconClassName:"mx_RoomList_iconExplore",onClick:t=>{t.preventDefault(),t.stopPropagation(),e(),gn.a.fire(js.a.ViewRoomDirectory)}}))}},[_s.a.LowPriority]:{sectionLabel:Object(ts.b)("Low priority"),isInvite:!1,defaultHidden:!1},[_s.a.ServerNotice]:{sectionLabel:Object(ts.b)("System Alerts"),isInvite:!1,defaultHidden:!1},[_s.a.Archived]:{sectionLabel:Object(ts.b)("Historical"),isInvite:!1,defaultHidden:!0},[_s.a.Suggested]:{sectionLabel:Object(ts.b)("Suggested Rooms"),isInvite:!1,defaultHidden:!1}};let aI=Object(os.a)("views.rooms.RoomList")(qk=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"customTagStoreRef",void 0),Fe()(this,"tagAesthetics",void 0),Fe()(this,"roomStoreToken",void 0),Fe()(this,"onRoomViewStoreUpdate",()=>{this.setState({currentRoomId:Es.a.getRoomId()})}),Fe()(this,"onAction",e=>{if(e.action===js.a.ViewRoomDelta){const t=e,a=Es.a.getRoomId(),n=this.getRoomDelta(a,t.delta,t.unread);n&&gn.a.dispatch({action:"view_room",room_id:n.roomId,show_room_tile:!0})}else e.action===js.a.PstnSupportUpdated&&(this.updateDmAddRoomAction(),this.updateLists())}),Fe()(this,"getRoomDelta",(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=ys.b.instance.orderedLists,s=[];Jk.forEach(t=>{let i=n[t];a&&(i=i.filter(t=>{const a=As.a.instance.getRoomState(t);return a.room.roomId===e||a.isUnread})),s.push(...i)});const i=s.findIndex(t=>t.roomId===e),[o]=s.slice((i+t)%s.length);return o})),Fe()(this,"updateSuggestedRooms",e=>{this.setState({suggestedRooms:e})}),Fe()(this,"updateLists",()=>{const e=ys.b.instance.orderedLists;ss.b.getValue("advancedRoomListLogging")&&console.log("new lists",e);const t=Object.keys(this.state.sublists),a=Object.keys(e).filter(e=>!Object(_s.d)(e)||us.a.getTags()[e]),n=!!ys.b.instance.getFirstNameFilterCondition();let s=this.state.isNameFiltering!==n||Object(Ms.d)(t,a);if(!s)for(const t of a){const a=this.state.sublists[t],n=e[t];if(a.length!==n.length){s=!0;break}}if(s){const t=Object(Us.f)(e,a),s=Object(Us.e)(t,(e,t)=>Object(Ms.b)(t));this.setState({sublists:s,isNameFiltering:n})}}),Fe()(this,"onStartChat",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;gn.a.dispatch({action:"view_create_chat",initialText:t})}),Fe()(this,"onExplore",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;gn.a.dispatch({action:js.a.ViewRoomDirectory,initialText:t})}),Fe()(this,"onSpaceInviteClick",()=>{var e;const t=null===(e=ys.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;Object(zs.e)(this.props.activeSpace,t)}),this.state={sublists:{},isNameFiltering:!!ys.b.instance.getFirstNameFilterCondition(),suggestedRooms:Gs.e.instance.suggestedRooms},this.tagAesthetics=Object(Us.e)(tI),this.updateDmAddRoomAction()}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction),this.roomStoreToken=Es.a.addListener(this.onRoomViewStoreUpdate),Gs.e.instance.on(Gs.a,this.updateSuggestedRooms),ys.b.instance.on(ys.a,this.updateLists),this.customTagStoreRef=us.a.addListener(this.updateLists),this.updateLists()}componentWillUnmount(){Gs.e.instance.off(Gs.a,this.updateSuggestedRooms),ys.b.instance.off(ys.a,this.updateLists),gn.a.unregister(this.dispatcherRef),this.customTagStoreRef&&this.customTagStoreRef.remove(),this.roomStoreToken&&this.roomStoreToken.remove()}updateDmAddRoomAction(){const e=Object(Us.e)(tI[_s.a.DM]);Vs.d.sharedInstance().getSupportsPstnProtocol()?e.addRoomContextMenu=eI:e.onAddRoom=Zk,this.tagAesthetics[_s.a.DM]=e}renderSuggestedRooms(){return this.state.suggestedRooms.map(e=>{var t;const a=e.name||e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0])||Object(ts.a)("Empty room"),n=i.a.createElement(Ws.a,{oobData:{name:a,avatarUrl:e.avatar_url},width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:this.state.currentRoomId===e.room_id,displayName:a,avatar:n,onClick:()=>{var t;gn.a.dispatch({action:"view_room",room_alias:e.canonical_alias||(null===(t=e.aliases)||void 0===t?void 0:t[0]),room_id:e.room_id,via_servers:e.viaServers,oobData:{avatarUrl:e.avatar_url,name:a}})},key:"suggestedRoomTile_"+e.room_id})})}renderCommunityInvites(){return Cs.a.get().getGroups().filter(e=>"invite"===e.myMembership).map(e=>{const t=i.a.createElement(Is,{groupId:e.groupId,groupName:e.name,groupAvatarUrl:e.avatarUrl,width:32,height:32,resizeMethod:"crop"});return i.a.createElement(Ps,{isMinimized:this.props.isMinimized,isSelected:!1,displayName:e.name,avatar:t,notificationState:Ds.a.RED_EXCLAMATION,onClick:()=>{gn.a.dispatch({action:"view_group",group_id:e.groupId})},key:"temporaryGroupTile_"+e.groupId})})}renderSublists(){const e=!this.state.isNameFiltering&&Object.values(ys.b.instance.unfilteredLists).every(e=>!(null!=e&&e.length));return Jk.reduce((e,t)=>{if(t===Qk){const t=Object.keys(this.state.sublists).filter(e=>Object(_s.d)(e));e.push(...t)}return e.push(t),e},[]).map(t=>{let a=null;t===_s.a.Invite?a=this.renderCommunityInvites():t===_s.a.Suggested&&(a=this.renderSuggestedRooms());const n=Object(_s.d)(t)?((s=t).startsWith("u.")&&(s=s.substring(2)),{sectionLabel:Object(ts.b)("Custom Tag"),sectionLabelRaw:s,isInvite:!1,defaultHidden:!1}):this.tagAesthetics[t];var s;if(!n)throw new Error(`Tag ${t} does not have aesthetics`);return i.a.createElement(ri.b,{key:"sublist-"+t,tagId:t,forRooms:!0,startAsHidden:n.defaultHidden,label:n.sectionLabelRaw?n.sectionLabelRaw:Object(ts.a)(n.sectionLabel),onAddRoom:n.onAddRoom,addRoomLabel:n.addRoomLabel?Object(ts.a)(n.addRoomLabel):n.addRoomLabel,addRoomContextMenu:n.addRoomContextMenu,isMinimized:this.props.isMinimized,showSkeleton:e,extraTiles:a,resizeNotifier:this.props.resizeNotifier,alwaysVisible:Xk.includes(t),onListCollapse:this.props.onListCollapse})})}render(){const e=Cs.a.get().getUserId();let t;var a,n;if(!this.props.isMinimized)if(this.state.isNameFiltering)t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Can't see what you’re looking for?")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Start a new chat")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_explore",kind:"link",onClick:this.onExplore},this.props.activeSpace?Object(ts.a)("Explore rooms"):Object(ts.a)("Explore all public rooms1")));else if(null!==(a=this.props.activeSpace)&&void 0!==a&&a.canInvite(e)||"join"===(null===(n=this.props.activeSpace)||void 0===n?void 0:n.getMyMembership()))t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Quick actions")),this.props.activeSpace.canInvite(e)&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceInvite",onClick:this.onSpaceInviteClick},Object(ts.a)("Invite people")),"join"===this.props.activeSpace.getMyMembership()&&i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_spaceExplore",onClick:this.onExplore},Object(ts.a)("Explore rooms")));else if(Object.values(this.state.sublists).some(e=>e.length>0)){const e=ys.b.instance.unfilteredLists,a=e[_s.a.Untagged]||[],n=e[_s.a.Archived]||[],s=e[_s.a.Favourite]||[];a.length<1&&n<1&&s<1&&(t=i.a.createElement("div",{className:"mx_RoomList_explorePrompt"},i.a.createElement("div",null,Object(ts.a)("Use the + to make a new room or explore existing ones below")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_startChat",kind:"link",onClick:this.onStartChat},Object(ts.a)("Start a new chat")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_explore",kind:"link",onClick:this.onExplore},Object(ts.a)("Explore all public rooms")),i.a.createElement(Fs.a,{className:"mx_RoomList_explorePrompt_explore",kind:"link",onClick:this.onExplore},"List Page")))}const s=this.renderSublists();return i.a.createElement(bs.c,{handleHomeEnd:!0,onKeyDown:this.props.onKeyDown},e=>{let{onKeyDownHandler:a}=e;return i.a.createElement("div",{onFocus:this.props.onFocus,onBlur:this.props.onBlur,onKeyDown:a,className:"mx_RoomList",role:"tree","aria-label":Object(ts.a)("Rooms")},s,t)})}})||qk;var nI=a(845),sI=a(1415);function iI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const a=[],n=Object.keys(e.currentState.members);for(let s=0;s<n.length;++s){const i=n[s];e.currentState.members[i].typing&&-1===t.indexOf(i)&&a.push(e.currentState.members[i])}return a}var oI,rI,lI=a(422);let cI=Object(os.a)("views.rooms.WhoIsTypingTile")((rI=class extends i.a.Component{constructor(){var e;super(...arguments),Fe()(this,"state",{usersTyping:(e=this.props.room,iI(e,[Cs.a.get().getUserId()])),delayedStopTypingTimers:{}}),Fe()(this,"isVisible",()=>this._isVisible(this.state)),Fe()(this,"onRoomTimeline",(e,t)=>{var a;if((null==t?void 0:t.roomId)===(null===(a=this.props.room)||void 0===a?void 0:a.roomId)){const t=e.getSender(),a=this.state.usersTyping.filter(e=>e.userId!==t);a.length!==this.state.usersTyping.length&&this.setState({usersTyping:a}),this.abortUserTimer(t)}}),Fe()(this,"onRoomMemberTyping",()=>{const e=function(e){return iI(e,[Cs.a.get().getUserId()].concat(Cs.a.get().getIgnoredUsers()))}(this.props.room);this.setState({delayedStopTypingTimers:this.updateDelayedStopTypingTimers(e),usersTyping:e})})}componentDidMount(){Cs.a.get().on("RoomMember.typing",this.onRoomMemberTyping),Cs.a.get().on("Room.timeline",this.onRoomTimeline)}componentDidUpdate(e,t){const a=this._isVisible(t),n=this._isVisible(this.state);this.props.onShown&&!a&&n?this.props.onShown():this.props.onHidden&&a&&!n&&this.props.onHidden()}componentWillUnmount(){const e=Cs.a.get();e&&(e.removeListener("RoomMember.typing",this.onRoomMemberTyping),e.removeListener("Room.timeline",this.onRoomTimeline)),Object.values(this.state.delayedStopTypingTimers).forEach(e=>e.abort())}_isVisible(e){return 0!==e.usersTyping.length||0!==Object.keys(e.delayedStopTypingTimers).length}updateDelayedStopTypingTimers(e){const t=this.state.usersTyping.filter(t=>!e.some(e=>t.userId===e.userId)),a=e.filter(e=>!this.state.usersTyping.some(t=>e.userId===t.userId));a.forEach(e=>{const t=this.state.delayedStopTypingTimers[e.userId];t&&t.abort()});let n=Object.assign({},this.state.delayedStopTypingTimers);return n=a.reduce((e,t)=>(delete e[t.userId],e),n),n=t.reduce((e,t)=>{if(!e[t.userId]){const a=new lI.a(5e3);e[t.userId]=a,a.start(),a.finished().then(()=>this.removeUserTimer(t.userId),()=>{})}return e},n),n}abortUserTimer(e){const t=this.state.delayedStopTypingTimers[e];t&&(t.abort(),this.removeUserTimer(e))}removeUserTimer(e){if(this.state.delayedStopTypingTimers[e]){const t=Object.assign({},this.state.delayedStopTypingTimers);delete t[e],this.setState({delayedStopTypingTimers:t})}}renderTypingIndicatorAvatars(e,t){let a=0;e.length>t&&(a=e.length-t+1,e=e.slice(0,t-1));const n=e.map(e=>i.a.createElement(XC.a,{key:e.userId,member:e,width:24,height:24,resizeMethod:"crop",viewUserOnClick:!0}));return a>0&&n.push(i.a.createElement("span",{className:"mx_WhoIsTypingTile_remainingAvatarPlaceholder",key:"others"},"+",a)),n}render(){let e=this.state.usersTyping;const t=Object.keys(this.state.delayedStopTypingTimers).map(e=>this.props.room.getMember(e));e=e.concat(t),e.sort((e,t)=>Object(iS.a)(e.name,t.name));const a=function(e,t){let a=0;if(e.length>t&&(a=e.length-t+1),0===e.length)return"";if(1===e.length)return Object(ts.a)("%(displayName)s is typing …",{displayName:e[0].name});const n=e.map(e=>e.name);if(a>=1)return Object(ts.a)("%(names)s and %(count)s others are typing …",{names:n.slice(0,t-1).join(", "),count:a});{const e=n.pop();return Object(ts.a)("%(names)s and %(lastPerson)s are typing …",{names:n.join(", "),lastPerson:e})}}(e,this.props.whoIsTypingLimit);return a?i.a.createElement("li",{className:"mx_WhoIsTypingTile","aria-atomic":"true"},i.a.createElement("div",{className:"mx_WhoIsTypingTile_avatars"},this.renderTypingIndicatorAvatars(e,this.props.whoIsTypingLimit)),i.a.createElement("div",{className:"mx_WhoIsTypingTile_label"},a)):null}},Fe()(rI,"defaultProps",{whoIsTypingLimit:3}),oI=rI))||oI;var dI,mI,uI=a(899);let hI=Object(os.a)("views.settings.BridgeTile")((mI=class extends i.a.PureComponent{render(){var e,t;const a=this.props.ev.getContent();if(null===(e=a.channel)||void 0===e||!e.id||null===(t=a.protocol)||void 0===t||!t.id)return console.warn(`Bridge info event ${this.props.ev.getId()} has missing content. Tile will not render`),null;a.bridgebot||(console.warn(`Bridge info event ${this.props.ev.getId()} does not provide a 'bridgebot' key whichis deprecated behaviour. Using sender for now.`),a.bridgebot=this.props.ev.getSender());const{channel:n,network:s,protocol:o}=a,r=o.displayname||o.id,l=n.displayname||n.id;let c=null;a.creator&&(c=i.a.createElement("li",null,Object(ts.a)("This bridge was provisioned by <user />.",{},{user:()=>i.a.createElement(uI.a,{type:uI.a.TYPE_USER_MENTION,room:this.props.room,url:Object(Ix.h)(a.creator),shouldShowPillAvatar:ss.b.getValue("Pill.shouldShowPillAvatar")})})));const d=i.a.createElement("li",null,Object(ts.a)("This bridge is managed by <user />.",{},{user:()=>i.a.createElement(uI.a,{type:uI.a.TYPE_USER_MENTION,room:this.props.room,url:Object(Ix.h)(a.bridgebot),shouldShowPillAvatar:ss.b.getValue("Pill.shouldShowPillAvatar")})}));let m;if(o.avatar_url){const e=Object(Os.b)(o.avatar_url).getSquareThumbnailHttp(64);m=i.a.createElement(ws.a,{className:"protocol-icon",width:48,height:48,resizeMethod:"crop",name:r,idName:r,url:e})}else m=i.a.createElement("div",{className:"noProtocolIcon"});let u=null;if(s){const e=s.displayname||s.id;let t=i.a.createElement("span",null,e);"string"==typeof s.external_url&&Object(tS.e)(s.external_url)&&(t=i.a.createElement("a",{href:s.external_url,target:"_blank",rel:"noreferrer noopener"},e)),u=Object(ts.a)("Workspace: <networkLink/>",{},{networkLink:()=>t})}let h=i.a.createElement("span",null,l);"string"==typeof n.external_url&&Object(tS.e)(n.external_url)&&(h=i.a.createElement("a",{href:n.external_url,target:"_blank",rel:"noreferrer noopener"},l));const p=this.props.ev.getId();return i.a.createElement("li",{key:p},i.a.createElement("div",{className:"column-icon"},m),i.a.createElement("div",{className:"column-data"},i.a.createElement("h3",null,r),i.a.createElement("p",{className:"workspace-channel-details"},u,i.a.createElement("span",{className:"channel"},Object(ts.a)("Channel: <channelLink/>",{},{channelLink:()=>h}))),i.a.createElement("ul",{className:"metadata"},c," ",d)))}},Fe()(mI,"propTypes",{ev:At.a.object.isRequired,room:At.a.object.isRequired}),dI=mI))||dI;var pI,gI=a(1403),fI=a(383);let vI=Object(os.a)("views.settings.EventIndexPanel")(pI=class extends i.a.Component{constructor(e){super(e),Fe()(this,"updateCurrentRoom",async e=>{const t=fI.a.get();let a;try{a=await t.getStats()}catch{return}this.setState({eventIndexSize:a.size,roomCount:a.roomCount})}),Fe()(this,"onManage",async()=>{qd.a.createTrackedDialogAsync("Message search","Message search",a.e(32).then(a.bind(null,8480)),{onFinished:()=>{}},null,!1,!0)}),Fe()(this,"onEnable",async()=>{this.setState({enabling:!0}),await fI.a.initEventIndex(),await fI.a.get().addInitialCheckpoints(),await fI.a.get().startCrawler(),await ss.b.setValue("enableEventIndexing",null,mi.a.DEVICE,!0),await this.updateState()}),Fe()(this,"confirmEventStoreReset",()=>{const{close:e}=qd.a.createDialog(mw,{onFinished:async t=>{t&&(await ss.b.setValue("enableEventIndexing",null,mi.a.DEVICE,!1),await fI.a.deleteEventIndex(),await this.onEnable(),e())}})}),this.state={enabling:!1,eventIndexSize:0,roomCount:0,eventIndexingEnabled:ss.b.getValueAt(mi.a.DEVICE,"enableEventIndexing")}}componentWillUnmount(){const e=fI.a.get();null!==e&&e.removeListener("changedCheckpoint",this.updateCurrentRoom)}componentDidMount(){this.updateState()}async updateState(){const e=fI.a.get(),t=ss.b.getValueAt(mi.a.DEVICE,"enableEventIndexing");let a=0,n=0;if(null!==e){e.on("changedCheckpoint",this.updateCurrentRoom);try{const t=await e.getStats();a=t.size,n=t.roomCount}catch{}}this.setState({enabling:!1,eventIndexSize:a,roomCount:n,eventIndexingEnabled:t})}render(){let e=null;const t=On.getComponent("elements.InlineSpinner"),a=$c.a.get().brand;if(null!==fI.a.get())e=i.a.createElement("div",null,i.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(ts.a)("Securely cache encrypted messages locally for them to appear in search results, using %(size)s to store messages from %(rooms)s rooms.",{size:Object(hs.a)(this.state.eventIndexSize,0),count:this.state.roomCount,rooms:Object(hs.d)(this.state.roomCount)})),i.a.createElement("div",null,i.a.createElement(Fs.a,{kind:"primary",onClick:this.onManage},Object(ts.a)("Manage"))));else if(!this.state.eventIndexingEnabled&&fI.a.supportIsInstalled())e=i.a.createElement("div",null,i.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(ts.a)("Securely cache encrypted messages locally for them to appear in search results.")),i.a.createElement("div",null,i.a.createElement(Fs.a,{kind:"primary",disabled:this.state.enabling,onClick:this.onEnable},Object(ts.a)("Enable")),this.state.enabling?i.a.createElement(t,null):i.a.createElement("div",null)));else if(fI.a.platformHasSupport()&&!fI.a.supportIsInstalled()){const t="https://github.com/vector-im/element-desktop/blob/develop/docs/native-node-modules.md#adding-seshat-for-search-in-e2e-encrypted-rooms";e=i.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(ts.a)("%(brand)s is missing some components required for securely caching encrypted messages locally. If you'd like to experiment with this feature, build a custom %(brand)s Desktop with <nativeLink>search components added</nativeLink>.",{brand:a},{nativeLink:e=>i.a.createElement("a",{href:t,target:"_blank",rel:"noreferrer noopener"},e)}))}else e=fI.a.platformHasSupport()?i.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},i.a.createElement("p",null,this.state.enabling?i.a.createElement(t,null):Object(ts.a)("Message search initialisation failed")),fI.a.error&&i.a.createElement("details",null,i.a.createElement("summary",null,Object(ts.a)("Advanced")),i.a.createElement("code",null,fI.a.error.message),i.a.createElement("p",null,i.a.createElement(Fs.a,{key:"delete",kind:"danger",onClick:this.confirmEventStoreReset},Object(ts.a)("Reset"))))):i.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(ts.a)("%(brand)s can't securely cache encrypted messages locally while running in a web browser. Use <desktopLink>%(brand)s Desktop</desktopLink> for encrypted messages to appear in search results.",{brand:a},{desktopLink:e=>i.a.createElement("a",{href:"https://element.io/get-started",target:"_blank",rel:"noreferrer noopener"},e)}));return e}})||pI;var bI,yI=a(223),EI=a.n(yI),_I=a(1388),SI=a(330);let CI=Object(os.a)("views.settings.SetIdServer")(bI=class extends i.a.Component{constructor(e){super(e),Fe()(this,"dispatcherRef",void 0),Fe()(this,"onAction",e=>{"id_server_changed"===e.action&&this.setState({currentClientIdServer:Cs.a.get().getIdentityServerUrl()})}),Fe()(this,"onIdentityServerChanged",e=>{const t=e.target.value;this.setState({idServer:t})}),Fe()(this,"getTooltip",()=>{if(this.state.checking){const e=On.getComponent("views.elements.InlineSpinner");return i.a.createElement("div",null,i.a.createElement(e,null),Object(ts.a)("Checking server"))}return this.state.error?i.a.createElement("span",{className:"warning"},this.state.error):null}),Fe()(this,"idServerChangeEnabled",()=>!!this.state.idServer&&!this.state.busy),Fe()(this,"saveIdServer",e=>{Cs.a.get().setAccountData("m.identity_server",{base_url:e}),this.setState({busy:!1,error:null,currentClientIdServer:e,idServer:""})}),Fe()(this,"checkIdServer",async e=>{e.preventDefault();const{idServer:t,currentClientIdServer:a}=this.state;this.setState({busy:!0,checking:!0,error:null});const n=Object(Rx.b)(t);let s=await async function(e){if("https:"!==EI.a.parse(e).protocol)return Object(ts.a)("Identity Server URL must be HTTPS");try{const t=await fetch(e+"/_matrix/identity/api/v1");return t.ok?null:t.status<200||t.status>=300?Object(ts.a)("Not a valid Identity Server (status code %(code)s)",{code:t.status}):Object(ts.a)("Could not connect to Identity Server")}catch(e){return Object(ts.a)("Could not connect to Identity Server")}}(n);if(!s)try{this.setState({checking:!1});const e=new SI.a(n);await e.getAccessToken();let s=!0;if(!await Object(kx.b)(n)){const[e]=await this.showNoTermsWarning(n);s=e}if(s&&a&&n!==a){const[e]=await this.showServerChangeWarning({title:Object(ts.a)("Change identity server"),unboundMessage:Object(ts.a)("Disconnect from the identity server <current /> and connect to <new /> instead?",{},{current:e=>i.a.createElement("b",null,Object(Rx.a)(a)),new:e=>i.a.createElement("b",null,Object(Rx.a)(t))}),button:Object(ts.a)("Continue")});s=e}s&&this.saveIdServer(n)}catch(e){console.error(e),s=Object(ts.a)("Terms of service not accepted or the identity server is invalid.")}this.setState({busy:!1,checking:!1,error:s,currentClientIdServer:Cs.a.get().getIdentityServerUrl()})}),Fe()(this,"onDisconnectClicked",async()=>{this.setState({disconnectBusy:!0});try{const[e]=await this.showServerChangeWarning({title:Object(ts.a)("Disconnect identity server"),unboundMessage:Object(ts.a)("Disconnect from the identity server <idserver />?",{},{idserver:e=>i.a.createElement("b",null,Object(Rx.a)(this.state.currentClientIdServer))}),button:Object(ts.a)("Disconnect")});e&&this.disconnectIdServer()}finally{this.setState({disconnectBusy:!1})}}),Fe()(this,"disconnectIdServer",()=>{Cs.a.get().setAccountData("m.identity_server",{base_url:null});let e="";Object(kx.c)()&&(e=Object(Rx.a)(Object(kx.c)())),this.setState({busy:!1,error:null,currentClientIdServer:Cs.a.get().getIdentityServerUrl(),idServer:e})});let t="";!Cs.a.get().getIdentityServerUrl()&&Object(kx.c)()&&(t=Object(Rx.a)(Object(kx.c)())),this.state={defaultIdServer:t,currentClientIdServer:Cs.a.get().getIdentityServerUrl(),idServer:"",error:null,busy:!1,disconnectBusy:!1,checking:!1}}componentDidMount(){this.dispatcherRef=gn.a.register(this.onAction)}componentWillUnmount(){gn.a.unregister(this.dispatcherRef)}showNoTermsWarning(e){const t=On.getComponent("views.dialogs.QuestionDialog"),{finished:a}=qd.a.createTrackedDialog("No Terms Warning","",t,{title:Object(ts.a)("Identity server has no terms of service"),description:i.a.createElement("div",null,i.a.createElement("span",{className:"warning"},Object(ts.a)("The identity server you have chosen does not have any terms of service.")),i.a.createElement("span",null," ",Object(ts.a)("Only continue if you trust the owner of the server."))),button:Object(ts.a)("Continue")});return a}async showServerChangeWarning(e){let{title:t,unboundMessage:a,button:n}=e;const{currentClientIdServer:s}=this.state;let o=[],r=!0;try{o=await Object(oE.d)(Object(_I.a)(Cs.a.get()),Promise.reject(new Error("Timeout attempting to reach identity server")),1e4)}catch(e){r=!1,console.warn(`Unable to reach identity server at ${s} to check for 3PIDs during IS change flow`),console.warn(e)}const l=o.filter(e=>e.bound);let c,d=!1;const m={idserver:e=>i.a.createElement("b",null,Object(Rx.a)(s)),b:e=>i.a.createElement("b",null,e)};r?l.length?(c=i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("You are still <b>sharing your personal data</b> on the identity server <idserver />.",{},m)),i.a.createElement("p",null,Object(ts.a)("We recommend that you remove your email addresses and phone numbers from the identity server before disconnecting."))),d=!0,n=Object(ts.a)("Disconnect anyway")):c=a:(c=i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("You should <b>remove your personal data</b> from identity server <idserver /> before disconnecting. Unfortunately, identity server <idserver /> is currently offline or cannot be reached.",{},m)),i.a.createElement("p",null,Object(ts.a)("You should:")),i.a.createElement("ul",null,i.a.createElement("li",null,Object(ts.a)("check your browser plugins for anything that might block the identity server (such as Privacy Badger)")),i.a.createElement("li",null,Object(ts.a)("contact the administrators of identity server <idserver />",{},{idserver:m.idserver})),i.a.createElement("li",null,Object(ts.a)("wait and try again later")))),d=!0,n=Object(ts.a)("Disconnect anyway"));const u=On.getComponent("dialogs.QuestionDialog"),{finished:h}=qd.a.createTrackedDialog("Identity Server Bound Warning","",u,{title:t,description:c,button:n,cancelButton:Object(ts.a)("Go back"),danger:d});return h}render(){const e=On.getComponent("views.elements.AccessibleButton"),t=On.getComponent("elements.Field"),a=this.state.currentClientIdServer;let n,s,o;if(a?(n=Object(ts.a)("Identity Server (%(server)s)",{server:Object(Rx.a)(a)}),s=Object(ts.a)("You are currently using <server></server> to discover and be discoverable by existing contacts you know. You can change your identity server below.",{},{server:e=>i.a.createElement("b",null,Object(Rx.a)(a))}),this.props.missingTerms&&(s=Object(ts.a)("If you don't want to use <server /> to discover and be discoverable by existing contacts you know, enter another identity server below.",{},{server:e=>i.a.createElement("b",null,Object(Rx.a)(a))}))):(n=Object(ts.a)("Identity Server"),s=Object(ts.a)("You are not currently using an identity server. To discover and be discoverable by existing contacts you know, add one below.")),a){let t=Object(ts.a)("Disconnect"),a=Object(ts.a)("Disconnecting from your identity server will mean you won't be discoverable by other users and you won't be able to invite others by email or phone.");if(this.props.missingTerms&&(a=Object(ts.a)("Using an identity server is optional. If you choose not to use an identity server, you won't be discoverable by other users and you won't be able to invite others by email or phone."),t=Object(ts.a)("Do not use an identity server")),this.state.disconnectBusy){const e=On.getComponent("views.elements.InlineSpinner");t=i.a.createElement(e,null)}o=i.a.createElement("div",null,i.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},a),i.a.createElement(e,{onClick:this.onDisconnectClicked,kind:"danger_sm"},t))}return i.a.createElement("form",{className:"mx_SettingsTab_section mx_SetIdServer",onSubmit:this.checkIdServer},i.a.createElement("span",{className:"mx_SettingsTab_subheading"},n),i.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},s),i.a.createElement(t,{label:Object(ts.a)("Enter a new identity server"),type:"text",autoComplete:"off",placeholder:this.state.defaultIdServer,value:this.state.idServer,onChange:this.onIdentityServerChanged,tooltipContent:this.getTooltip(),tooltipClassName:"mx_SetIdServer_tooltip",disabled:this.state.busy,forceValidity:!this.state.error&&null}),i.a.createElement(e,{type:"submit",kind:"primary_sm",onClick:this.checkIdServer,disabled:!this.idServerChangeEnabled()},Object(ts.a)("Change")),o)}})||bI;var wI,OI=a(1373),xI=a(1408);const RI=["uk.half-shot.bridge"];let kI=Object(os.a)("views.settings.tabs.room.BridgeSettingsTab")(wI=class e extends i.a.Component{renderBridgeCard(e,t){const a=e.getContent();return a&&a.channel&&a.protocol?i.a.createElement(hI,{key:e.getId(),room:t,ev:e}):null}static getBridgeStateEvents(e){const t=Cs.a.get().getRoom(e).currentState;return RI.map(e=>{const a=t.events.get(e);return a?Array.from(a.values()):[]}).flat(1)}render(){const t=e.getBridgeStateEvents(this.props.roomId),a=Cs.a.get().getRoom(this.props.roomId);let n;return n=t.length>0?i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("This room is bridging messages to the following platforms. <a>Learn more.</a>",{},{a:e=>i.a.createElement("a",{href:"https://matrix.org/bridges/",target:"_blank",rel:"noreferrer noopener"},e)})),i.a.createElement("ul",{className:"mx_RoomSettingsDialog_BridgeList"},t.map(e=>this.renderBridgeCard(e,a)))):i.a.createElement("p",null,Object(ts.a)("This room isn’t bridging messages to any platforms. <a>Learn more.</a>",{},{a:e=>i.a.createElement("a",{href:"https://matrix.org/bridges/",target:"_blank",rel:"noreferrer noopener"},e)})),i.a.createElement("div",{className:"mx_SettingsTab"},i.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(ts.a)("Bridges")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},n))}})||wI;var II;const TI={[vs.a.RoomAvatar]:Object(ts.b)("Change room avatar"),[vs.a.RoomName]:Object(ts.b)("Change room name"),[vs.a.RoomCanonicalAlias]:Object(ts.b)("Change main address for the room"),[vs.a.RoomHistoryVisibility]:Object(ts.b)("Change history visibility"),[vs.a.RoomPowerLevels]:Object(ts.b)("Change permissions"),[vs.a.RoomTopic]:Object(ts.b)("Change topic"),[vs.a.RoomTombstone]:Object(ts.b)("Upgrade the room"),[vs.a.RoomEncryption]:Object(ts.b)("Enable room encryption"),[vs.a.RoomServerAcl]:Object(ts.b)("Change server ACLs"),"im.vector.modular.widgets":Object(ts.b)("Modify widgets")},PI={[vs.a.RoomAvatar]:{isState:!0},[vs.a.RoomName]:{isState:!0},[vs.a.RoomCanonicalAlias]:{isState:!0},[vs.a.RoomHistoryVisibility]:{isState:!0},[vs.a.RoomPowerLevels]:{isState:!0},[vs.a.RoomTopic]:{isState:!0},[vs.a.RoomTombstone]:{isState:!0},[vs.a.RoomEncryption]:{isState:!0},[vs.a.RoomServerAcl]:{isState:!0},"im.vector.modular.widgets":{isState:!0}};function NI(e,t){const a=parseInt(e);return isNaN(a)?t:a}class DI extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onUnbanClick",e=>{Cs.a.get().unban(this.props.member.roomId,this.props.member.userId).catch(e=>{const t=On.getComponent("dialogs.ErrorDialog");console.error("Failed to unban: "+e),qd.a.createTrackedDialog("Failed to unban","",t,{title:Object(ts.a)("Error"),description:Object(ts.a)("Failed to unban")})})})}render(){let e;this.props.canUnban&&(e=i.a.createElement(Fs.a,{className:"mx_RolesRoomSettingsTab_unbanBtn",kind:"danger_sm",onClick:this.onUnbanClick},Object(ts.a)("Unban")));const t=this.props.member.name===this.props.member.userId?null:this.props.member.userId;return i.a.createElement("li",null,e,i.a.createElement("span",{title:Object(ts.a)("Banned by %(displayName)s",{displayName:this.props.by})},i.a.createElement("strong",null,this.props.member.name)," ",t,this.props.reason?" "+Object(ts.a)("Reason")+": "+this.props.reason:""))}}let jI=Object(os.a)("views.settings.tabs.room.RolesRoomSettingsTab")(II=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onRoomMembership",(e,t,a)=>{t.roomId===this.props.roomId&&this.forceUpdate()}),Fe()(this,"onPowerLevelsChanged",(e,t)=>{const a=Cs.a.get(),n=a.getRoom(this.props.roomId).currentState.getStateEvents("m.room.power_levels","");let s=n&&n.getContent()||{};s=Object.assign({},s);const i=parseInt(e);if(t.startsWith("event_levels_"))s.events=Object.assign({},s.events||{}),s.events[t.slice("event_levels_".length)]=i;else{const e=t.split(".");let a,n=s;for(const t of e)n[t]||(n[t]={}),a=n,n=n[t];a[e[e.length-1]]=i}a.sendStateEvent(this.props.roomId,"m.room.power_levels",s).catch(e=>{console.error(e);const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Power level requirement change failed","",t,{title:Object(ts.a)("Error changing power level requirement"),description:Object(ts.a)("An error occurred changing the room's power level requirements. Ensure you have sufficient permissions and try again.")})})}),Fe()(this,"onUserPowerLevelChanged",(e,t)=>{const a=Cs.a.get(),n=a.getRoom(this.props.roomId).currentState.getStateEvents("m.room.power_levels","");let s=n&&n.getContent()||{};s=Object.assign({},s),s.users||(s.users={}),s.users[t]=e,a.sendStateEvent(this.props.roomId,"m.room.power_levels",s).catch(e=>{console.error(e);const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Power level change failed","",t,{title:Object(ts.a)("Error changing power level"),description:Object(ts.a)("An error occurred changing the user's power level. Ensure you have sufficient permissions and try again.")})})})}componentDidMount(){Cs.a.get().on("RoomState.members",this.onRoomMembership)}componentWillUnmount(){const e=Cs.a.get();e&&e.removeListener("RoomState.members",this.onRoomMembership)}populateDefaultPlEvents(e,t,a){for(const n of Object.keys(PI))n in e||(e[n]=PI[n].isState?t:a)}render(){const e=On.getComponent("elements.PowerSelector"),t=Cs.a.get(),a=t.getRoom(this.props.roomId),n=a.currentState.getStateEvents("m.room.power_levels",""),s=n&&n.getContent()||{},o=a.currentState.mayClientSendStateEvent("m.room.power_levels",t),r={users_default:{desc:Object(ts.a)("Default role"),defaultValue:0},events_default:{desc:Object(ts.a)("Send messages"),defaultValue:0},invite:{desc:Object(ts.a)("Invite users"),defaultValue:50},state_default:{desc:Object(ts.a)("Change settings"),defaultValue:50},kick:{desc:Object(ts.a)("Kick users"),defaultValue:50},ban:{desc:Object(ts.a)("Ban users"),defaultValue:50},redact:{desc:Object(ts.a)("Remove messages sent by others"),defaultValue:50},"notifications.room":{desc:Object(ts.a)("Notify everyone"),defaultValue:50}},l=s.events||{},c=s.users||{},d=NI(s.ban,r.ban.defaultValue),m=NI(s.users_default,r.users_default.defaultValue);let u=c[t.getUserId()];void 0===u&&(u=m),this.populateDefaultPlEvents(l,NI(s.state_default,r.state_default.defaultValue),NI(s.events_default,r.events_default.defaultValue));let h,p=i.a.createElement("div",null,Object(ts.a)("No users have specific privileges in this room"));if(Object.keys(c).length){const t=[],a=[];Object.keys(c).forEach(n=>{const s=c[n]<u&&o;c[n]>m?t.push(i.a.createElement(e,{value:c[n],disabled:!s,label:n,key:n,powerLevelKey:n,onChange:this.onUserPowerLevelChanged})):c[n]<m&&a.push(i.a.createElement(e,{value:c[n],disabled:!s,label:n,key:n,powerLevelKey:n,onChange:this.onUserPowerLevelChanged}))});const n=(e,t)=>{const a=c[t.key]-c[e.key];return 0!==a?a:Object(iS.a)(e.key.toLocaleLowerCase(),t.key.toLocaleLowerCase())};t.sort(n),a.sort(n),t.length&&(p=i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement("div",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Privileged Users")),t)),a.length&&(h=i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement("div",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Muted Users")),a))}const g=a.getMembersWithMembership("ban");let f;if(g.length){const e=u>=d;f=i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement("div",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Banned users")),i.a.createElement("ul",null,g.map(t=>{const n=t.events.member.getContent(),s=a.getMember(t.events.member.getSender());let o=t.events.member.getSender();return s&&(o=s.name),i.a.createElement(DI,{key:t.userId,canUnban:e,member:t,reason:n.reason,by:o})})))}const v=Object.keys(r).map((t,a)=>{const n=r[t],l=t.split(".");let c=s;for(const e of l){if(void 0===c)break;c=c[e]}const d=NI(c,n.defaultValue);return i.a.createElement("div",{key:a,className:""},i.a.createElement(e,{label:n.desc,value:d,usersDefault:m,disabled:!o||u<d,powerLevelKey:t,onChange:this.onPowerLevelsChanged}))});t.isRoomEncrypted(this.props.roomId)&&delete l["m.room.encryption"];const b=Object.keys(l).map((t,a)=>{let n=TI[t];return n=n?Object(ts.a)(n):Object(ts.a)("Send %(eventType)s events",{eventType:t}),i.a.createElement("div",{className:"",key:t},i.a.createElement(e,{label:n,value:l[t],usersDefault:m,disabled:!o||u<l[t],powerLevelKey:"event_levels_"+t,onChange:this.onPowerLevelsChanged}))});return i.a.createElement("div",{className:"mx_SettingsTab mx_RolesRoomSettingsTab"},i.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(ts.a)("Roles & Permissions")),p,h,f,i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Permissions")),i.a.createElement("p",null,Object(ts.a)("Select the roles required to change various parts of the room")),v,b))}})||II;var AI,MI,UI,LI,FI=a(281);!function(e){e.Public="public",e.Knock="knock",e.Invite="invite",e.Private="private"}(MI||(MI={})),function(e){e.CanJoin="can_join",e.Forbidden="forbidden"}(UI||(UI={})),function(e){e.Invited="invited",e.Joined="joined",e.Shared="shared",e.WorldReadable="world_readable"}(LI||(LI={}));let BI=Object(os.a)("views.settings.tabs.room.SecurityRoomSettingsTab")(AI=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onStateEvent",e=>{["m.room.join_rules","m.room.guest_access","m.room.history_visibility","m.room.encryption"].includes(e.getType())&&this.forceUpdate()}),Fe()(this,"onEncryptionChange",e=>{qd.a.createTrackedDialog("Enable encryption","",$d.a,{title:Object(ts.a)("Enable encryption?"),description:Object(ts.a)("Once enabled, encryption for a room cannot be disabled. Messages sent in an encrypted room cannot be seen by the server, only by the participants of the room. Enabling encryption may prevent many bots and bridges from working correctly. <a>Learn more about encryption.</a>",{},{a:e=>i.a.createElement("a",{href:"https://element.io/help#encryption",rel:"noreferrer noopener",target:"_blank"},e)}),onFinished:e=>{if(!e)return void this.setState({encrypted:!1});const t=this.state.encrypted;this.setState({encrypted:!0}),Cs.a.get().sendStateEvent(this.props.roomId,"m.room.encryption",{algorithm:"m.megolm.v1.aes-sha2"}).catch(e=>{console.error(e),this.setState({encrypted:t})})}})}),Fe()(this,"fixGuestAccess",e=>{e.preventDefault(),e.stopPropagation();const t=MI.Invite,a=UI.CanJoin,n=this.state.joinRule,s=this.state.guestAccess;this.setState({joinRule:t,guestAccess:a});const i=Cs.a.get();i.sendStateEvent(this.props.roomId,"m.room.join_rules",{join_rule:t},"").catch(e=>{console.error(e),this.setState({joinRule:n})}),i.sendStateEvent(this.props.roomId,"m.room.guest_access",{guest_access:a},"").catch(e=>{console.error(e),this.setState({guestAccess:s})})}),Fe()(this,"onRoomAccessRadioToggle",e=>{let t=MI.Invite,a=UI.CanJoin;switch(e){case"invite_only":break;case"public_no_guests":t=MI.Public,a=UI.Forbidden;break;case"public_with_guests":t=MI.Public,a=UI.CanJoin}const n=this.state.joinRule,s=this.state.guestAccess;this.setState({joinRule:t,guestAccess:a});const i=Cs.a.get();i.sendStateEvent(this.props.roomId,"m.room.join_rules",{join_rule:t},"").catch(e=>{console.error(e),this.setState({joinRule:n})}),i.sendStateEvent(this.props.roomId,"m.room.guest_access",{guest_access:a},"").catch(e=>{console.error(e),this.setState({guestAccess:s})})}),Fe()(this,"onHistoryRadioToggle",e=>{const t=this.state.history;this.setState({history:e}),Cs.a.get().sendStateEvent(this.props.roomId,"m.room.history_visibility",{history_visibility:e},"").catch(e=>{console.error(e),this.setState({history:t})})}),Fe()(this,"updateBlacklistDevicesFlag",e=>{Cs.a.get().getRoom(this.props.roomId).setBlacklistUnverifiedDevices(e)}),this.state={joinRule:MI.Invite,guestAccess:UI.CanJoin,history:LI.Shared,hasAliases:!1,encrypted:!1}}async UNSAFE_componentWillMount(){Cs.a.get().on("RoomState.events",this.onStateEvent);const e=Cs.a.get().getRoom(this.props.roomId).currentState,t=this.pullContentPropertyFromEvent(e.getStateEvents("m.room.join_rules",""),"join_rule",MI.Invite),a=this.pullContentPropertyFromEvent(e.getStateEvents("m.room.guest_access",""),"guest_access",UI.Forbidden),n=this.pullContentPropertyFromEvent(e.getStateEvents("m.room.history_visibility",""),"history_visibility",LI.Shared),s=Cs.a.get().isRoomEncrypted(this.props.roomId);this.setState({joinRule:t,guestAccess:a,history:n,encrypted:s});const i=await this.hasAliases();this.setState({hasAliases:i})}pullContentPropertyFromEvent(e,t,a){return e&&e.getContent()&&e.getContent()[t]||a}componentWillUnmount(){Cs.a.get().removeListener("RoomState.events",this.onStateEvent)}async hasAliases(){const e=Cs.a.get();if(await e.doesServerSupportUnstableFeature("org.matrix.msc2432")){const t=(await e.unstableGetLocalAliases(this.props.roomId)).aliases;return Array.isArray(t)&&0!==t.length}return!!(e.getRoom(this.props.roomId).currentState.getStateEvents("m.room.aliases")||[]).find(e=>(e.getContent().aliases||[]).length>0)}renderRoomAccess(){const e=Cs.a.get(),t=e.getRoom(this.props.roomId),n=this.state.joinRule,s=this.state.guestAccess,o=t.currentState.mayClientSendStateEvent("m.room.join_rules",e)&&t.currentState.mayClientSendStateEvent("m.room.guest_access",e);let r=null;"public"!==n&&"forbidden"===s&&(r=i.a.createElement("div",{className:"mx_SecurityRoomSettingsTab_warning"},i.a.createElement("img",{src:a(373),width:15,height:15}),i.a.createElement("span",null,Object(ts.a)("Guests cannot join this room even if explicitly invited.")," ",i.a.createElement("a",{href:"",onClick:this.fixGuestAccess},Object(ts.a)("Click here to fix")))));let l=null;return"public"!==n||this.state.hasAliases||(l=i.a.createElement("div",{className:"mx_SecurityRoomSettingsTab_warning"},i.a.createElement("img",{src:a(373),width:15,height:15}),i.a.createElement("span",null,Object(ts.a)("To link to this room, please add an address.")))),i.a.createElement("div",null,r,l,i.a.createElement(su.a,{name:"roomVis",value:n,onChange:this.onRoomAccessRadioToggle,definitions:[{value:"invite_only",disabled:!o,label:Object(ts.a)("Only people who have been invited"),checked:"public"!==n},{value:"public_no_guests",disabled:!o,label:Object(ts.a)("Anyone who knows the room's link, apart from guests"),checked:"public"===n&&"can_join"!==s},{value:"public_with_guests",disabled:!o,label:Object(ts.a)("Anyone who knows the room's link, including guests"),checked:"public"===n&&"can_join"===s}]}))}renderHistory(){const e=Cs.a.get(),t=this.state.history,a=e.getRoom(this.props.roomId).currentState.mayClientSendStateEvent("m.room.history_visibility",e);return i.a.createElement("div",null,i.a.createElement("div",null,Object(ts.a)("Changes to who can read history will only apply to future messages in this room. The visibility of existing history will be unchanged.")),i.a.createElement(su.a,{name:"historyVis",value:t,onChange:this.onHistoryRadioToggle,definitions:[{value:LI.WorldReadable,disabled:!a,label:Object(ts.a)("Anyone")},{value:LI.Shared,disabled:!a,label:Object(ts.a)("Members only (since the point in time of selecting this option)")},{value:LI.Invited,disabled:!a,label:Object(ts.a)("Members only (since they were invited)")},{value:LI.Joined,disabled:!a,label:Object(ts.a)("Members only (since they joined)")}]}))}render(){const e=On.getComponent("elements.SettingsFlag"),t=Cs.a.get(),a=t.getRoom(this.props.roomId),n=this.state.encrypted,s=a.currentState.mayClientSendStateEvent("m.room.encryption",t),o=!n&&s;let r=null;n&&ss.b.isEnabled("blacklistUnverifiedDevices")&&(r=i.a.createElement(e,{name:"blacklistUnverifiedDevices",level:mi.a.ROOM_DEVICE,onChange:this.updateBlacklistDevicesFlag,roomId:this.props.roomId}));let l=i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Who can read history?")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},this.renderHistory()));return ss.b.getValue(vu.a.RoomHistorySettings)||(l=null),i.a.createElement("div",{className:"mx_SettingsTab mx_SecurityRoomSettingsTab"},i.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(ts.a)("Security & Privacy")),i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Encryption")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SecurityRoomSettingsTab_encryptionSection"},i.a.createElement("div",null,i.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},i.a.createElement("span",null,Object(ts.a)("Once enabled, encryption cannot be disabled."))),i.a.createElement(FI.a,{value:n,onChange:this.onEncryptionChange,label:Object(ts.a)("Encrypted"),disabled:!o})),r),i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Who can access this room?")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},this.renderRoomAccess()),l)}})||AI;var VI,GI=a(1397),zI=a(1407),WI=a(1411),HI=a(1405),KI=a(837),qI=a(1530),YI=a(1432);function $I(e,t){const a=Cs.a.get().getRoom(t),n=a&&a.getMember(e);return n?n.name:e}function JI(e,t){const a=$I(e,t);return a!==e?Object(ts.a)("%(name)s (%(userId)s)",{name:a,userId:e}):e}let QI=Object(os.a)("views.toasts.VerificationRequestToast")(VI=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"intervalHandle",void 0),Fe()(this,"_checkRequestIsPending",()=>{const{request:e}=this.props;e.canAccept||Id.a.sharedInstance().dismissToast(this.props.toastKey)}),Fe()(this,"cancel",()=>{Id.a.sharedInstance().dismissToast(this.props.toastKey);try{this.props.request.cancel()}catch(e){console.error("Error while cancelling verification request",e)}}),Fe()(this,"accept",async()=>{Id.a.sharedInstance().dismissToast(this.props.toastKey);const{request:e}=this.props,t=Cs.a.get();try{if(e.channel.roomId)gn.a.dispatch({action:"view_room",room_id:e.channel.roomId,should_peek:!1}),gn.a.dispatch({action:js.a.SetRightPanelPhase,phase:_m.c.EncryptionPanel,refireParams:{verificationRequest:e,member:t.getUser(e.otherUserId)}});else{const t=On.getComponent("views.dialogs.VerificationRequestDialog");qd.a.createTrackedDialog("Incoming Verification","",t,{verificationRequest:e,onFinished:()=>{e.cancel()}},null,!1,!0)}await e.accept()}catch(e){console.error(e.message)}}),this.state={counter:Math.ceil(e.request.timeout/1e3)}}async componentDidMount(){const{request:e}=this.props;if(e.timeout&&e.timeout>0&&(this.intervalHandle=setInterval(()=>{let{counter:e}=this.state;e=Math.max(0,e-1),this.setState({counter:e})},1e3)),e.on("change",this._checkRequestIsPending),this._checkRequestIsPending(),e.isSelfVerification){const t=Cs.a.get(),a=(await t.getDevice(e.channel.deviceId)).last_seen_ip;this.setState({device:t.getStoredDevice(t.getUserId(),e.channel.deviceId),ip:a})}}componentWillUnmount(){clearInterval(this.intervalHandle);const{request:e}=this.props;e.off("change",this._checkRequestIsPending)}render(){const{request:e}=this.props;let t,a;if(e.isSelfVerification)this.state.device&&(t=this.state.device.getDisplayName(),a=Object(ts.a)("%(deviceId)s from %(ip)s",{deviceId:this.state.device.deviceId,ip:this.state.ip}));else{const a=e.otherUserId,n=e.channel.roomId;if(t=n?JI(a,n):a,t===a){const e=Cs.a.get().getUser(a);e&&e.displayName&&(t=Object(ts.a)("%(name)s (%(userId)s)",{name:e.displayName,userId:a}))}}const n=0===this.state.counter?Object(ts.a)("Decline"):Object(ts.a)("Decline (%(counter)s)",{counter:this.state.counter});return i.a.createElement(kd.a,{description:t,detail:a,acceptLabel:Object(ts.a)("Accept"),onAccept:this.accept,rejectLabel:n,onReject:this.cancel})}})||VI;var XI,ZI,eT=a(857),tT=a(1441),aT=a(1440),nT=a(1443),sT=a(1444),iT=a(1442),oT=a(856),rT=a(1450),lT=a(829),cT=a(1451),dT=a(1531),mT=a(1416);let uT=Object(os.a)("structures.GenericErrorPage")((ZI=class extends i.a.PureComponent{render(){return i.a.createElement("div",{className:"mx_GenericErrorPage"},i.a.createElement("div",{className:"mx_GenericErrorPage_box"},i.a.createElement("h1",null,this.props.title),i.a.createElement("p",null,this.props.message)))}},Fe()(ZI,"propTypes",{title:At.a.object.isRequired,message:At.a.object.isRequired}),XI=ZI))||XI;var hT,pT,gT=a(1369),fT=a(424),vT=a(810),bT=a(417),yT=a(337);const ET=Object(ts.b)('<h1>HTML for your community\'s page</h1>\n<p>\n    Use the long description to introduce new members to the community, or distribute\n    some important <a href="foo">links</a>\n</p>\n<p>\n    You can even add images with Matrix URLs <img src="mxc://url" />\n</p>\n'),_T=At.a.shape({room_id:At.a.string.isRequired,profile:At.a.shape({name:At.a.string,avatar_url:At.a.string,canonical_alias:At.a.string}).isRequired}),ST=At.a.shape({summaryInfo:At.a.shape({user_id:At.a.string.isRequired,role_id:At.a.string,avatar_url:At.a.string,displayname:At.a.string}).isRequired});class CT extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onAddRoomsToSummaryClicked",e=>{e.preventDefault();const t=On.getComponent("dialogs.AddressPickerDialog");qd.a.createTrackedDialog("Add Rooms to Group Summary","",t,{title:Object(ts.a)("Add rooms to the community summary"),description:Object(ts.a)("Which rooms would you like to add to this summary?"),placeholder:Object(ts.a)("Room name or address"),button:Object(ts.a)("Add to summary"),pickerType:"room",validAddressTypes:["mx-room-id"],groupId:this.props.groupId,onFinished:(e,t)=>{if(!e)return;const a=[];Promise.allSettled(t.map(e=>dS.a.addRoomToGroupSummary(this.props.groupId,e.address).catch(()=>{a.push(e.address)}))).then(()=>{if(0===a.length)return;const e=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Failed to add the following room to the group summary","",e,{title:Object(ts.a)("Failed to add the following rooms to the summary of %(groupId)s:",{groupId:this.props.groupId}),description:a.join(", ")})})}},null,!1,!0)})}render(){const e=On.getComponent("elements.TintableSvg"),t=this.props.editing?i.a.createElement(Fs.a,{className:"mx_GroupView_featuredThings_addButton",onClick:this.onAddRoomsToSummaryClicked},i.a.createElement(e,{src:a(1532),width:"64",height:"64"}),i.a.createElement("div",{className:"mx_GroupView_featuredThings_addButton_label"},Object(ts.a)("Add a Room"))):i.a.createElement("div",null),n=this.props.rooms.map(e=>i.a.createElement(wT,{key:e.room_id,groupId:this.props.groupId,editing:this.props.editing,summaryInfo:e}));let s=i.a.createElement("div",null);return this.props.category&&this.props.category.profile&&(s=i.a.createElement("div",{className:"mx_GroupView_featuredThings_category"},this.props.category.profile.name)),i.a.createElement("div",{className:"mx_GroupView_featuredThings_container"},s,n,t)}}Fe()(CT,"propTypes",{rooms:At.a.arrayOf(_T).isRequired,category:At.a.shape({profile:At.a.shape({name:At.a.string}).isRequired}),groupId:At.a.string.isRequired,editing:At.a.bool.isRequired});class wT extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onClick",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"view_room",room_alias:this.props.summaryInfo.profile.canonical_alias,room_id:this.props.summaryInfo.room_id})}),Fe()(this,"onDeleteClicked",e=>{e.preventDefault(),e.stopPropagation(),dS.a.removeRoomFromGroupSummary(this.props.groupId,this.props.summaryInfo.room_id).catch(e=>{console.error("Error whilst removing room from group summary",e);const t=this.props.summaryInfo.name||this.props.summaryInfo.canonical_alias||this.props.summaryInfo.room_id,a=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Failed to remove room from group summary","",a,{title:Object(ts.a)("Failed to remove the room from the summary of %(groupId)s",{groupId:this.props.groupId}),description:Object(ts.a)("The room '%(roomName)s' could not be removed from the summary.",{roomName:t})})})})}render(){const e=On.getComponent("avatars.RoomAvatar"),t=this.props.summaryInfo.profile.name||this.props.summaryInfo.profile.canonical_alias||Object(ts.a)("Unnamed Room"),n={roomId:this.props.summaryInfo.room_id,avatarUrl:this.props.summaryInfo.profile.avatar_url,name:t};let s=null;this.props.summaryInfo.profile&&this.props.summaryInfo.profile.canonical_alias&&(s=Object(Ix.f)(this.props.summaryInfo.profile.canonical_alias));let o=null;o=s?i.a.createElement("a",{href:s,onClick:this.onClick},t):i.a.createElement("span",null,t);const r=this.props.editing?i.a.createElement("img",{className:"mx_GroupView_featuredThing_deleteButton",src:a(1533),width:"14",height:"14",alt:"Delete",onClick:this.onDeleteClicked}):i.a.createElement("div",null);return i.a.createElement(Fs.a,{className:"mx_GroupView_featuredThing",onClick:this.onClick},i.a.createElement(e,{oobData:n,width:64,height:64}),i.a.createElement("div",{className:"mx_GroupView_featuredThing_name"},o),r)}}Fe()(wT,"propTypes",{summaryInfo:_T.isRequired,editing:At.a.bool.isRequired,groupId:At.a.string.isRequired});class OT extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onAddUsersClicked",e=>{e.preventDefault();const t=On.getComponent("dialogs.AddressPickerDialog");qd.a.createTrackedDialog("Add Users to Group Summary","",t,{title:Object(ts.a)("Add users to the community summary"),description:Object(ts.a)("Who would you like to add to this summary?"),placeholder:Object(ts.a)("Name or Matrix ID"),button:Object(ts.a)("Add to summary"),validAddressTypes:["mx-user-id"],groupId:this.props.groupId,shouldOmitSelf:!1,onFinished:(e,t)=>{if(!e)return;const a=[];Promise.allSettled(t.map(e=>dS.a.addUserToGroupSummary(e.address).catch(()=>{a.push(e.address)}))).then(()=>{if(0===a.length)return;const e=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Failed to add the following users to the community summary","",e,{title:Object(ts.a)("Failed to add the following users to the summary of %(groupId)s:",{groupId:this.props.groupId}),description:a.join(", ")})})}},null,!1,!0)})}render(){const e=On.getComponent("elements.TintableSvg"),t=this.props.editing?i.a.createElement(Fs.a,{className:"mx_GroupView_featuredThings_addButton",onClick:this.onAddUsersClicked},i.a.createElement(e,{src:a(1532),width:"64",height:"64"}),i.a.createElement("div",{className:"mx_GroupView_featuredThings_addButton_label"},Object(ts.a)("Add a User"))):i.a.createElement("div",null),n=this.props.users.map(e=>i.a.createElement(xT,{key:e.user_id,summaryInfo:e,editing:this.props.editing,groupId:this.props.groupId}));let s=i.a.createElement("div",null);return this.props.role&&this.props.role.profile&&(s=i.a.createElement("div",{className:"mx_GroupView_featuredThings_category"},this.props.role.profile.name)),i.a.createElement("div",{className:"mx_GroupView_featuredThings_container"},s,n,t)}}Fe()(OT,"propTypes",{users:At.a.arrayOf(ST).isRequired,role:At.a.shape({profile:At.a.shape({name:At.a.string}).isRequired}),groupId:At.a.string.isRequired,editing:At.a.bool.isRequired});class xT extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onClick",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"view_start_chat_or_reuse",user_id:this.props.summaryInfo.user_id})}),Fe()(this,"onDeleteClicked",e=>{e.preventDefault(),e.stopPropagation(),dS.a.removeUserFromGroupSummary(this.props.groupId,this.props.summaryInfo.user_id).catch(e=>{console.error("Error whilst removing user from group summary",e);const t=this.props.summaryInfo.displayname||this.props.summaryInfo.user_id,a=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Failed to remove user from community summary","",a,{title:Object(ts.a)("Failed to remove a user from the summary of %(groupId)s",{groupId:this.props.groupId}),description:Object(ts.a)("The user '%(displayName)s' could not be removed from the summary.",{displayName:t})})})})}render(){const e=On.getComponent("avatars.BaseAvatar"),t=this.props.summaryInfo.displayname||this.props.summaryInfo.user_id,n=Object(Ix.h)(this.props.summaryInfo.user_id),s=i.a.createElement("a",{href:n,onClick:this.onClick},t),o=Object(Os.b)(this.props.summaryInfo.avatar_url).getSquareThumbnailHttp(64),r=this.props.editing?i.a.createElement("img",{className:"mx_GroupView_featuredThing_deleteButton",src:a(1533),width:"14",height:"14",alt:"Delete",onClick:this.onDeleteClicked}):i.a.createElement("div",null);return i.a.createElement(Fs.a,{className:"mx_GroupView_featuredThing",onClick:this.onClick},i.a.createElement(e,{name:t,url:o,width:64,height:64}),i.a.createElement("div",{className:"mx_GroupView_featuredThing_name"},s),r)}}Fe()(xT,"propTypes",{summaryInfo:ST.isRequired,editing:At.a.bool.isRequired,groupId:At.a.string.isRequired});let RT=Object(os.a)("structures.GroupView")((pT=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{summary:null,isGroupPublicised:null,isUserPrivileged:null,groupRooms:null,groupRoomsLoading:null,error:null,editing:!1,saving:!1,uploadingAvatar:!1,avatarChanged:!1,membershipBusy:!1,publicityBusy:!1,inviterProfile:null,showRightPanel:yT.a.getSharedInstance().isOpenForGroup}),Fe()(this,"_onRightPanelStoreUpdate",()=>{this.setState({showRightPanel:yT.a.getSharedInstance().isOpenForGroup})}),Fe()(this,"_onGroupMyMembership",e=>{this._unmounted||e.groupId!==this.props.groupId||("leave"===e.myMembership&&this._closeSettings(),this.setState({membershipBusy:!1}))}),Fe()(this,"onGroupStoreUpdated",e=>{if(this._unmounted)return;const t=dS.a.getSummary(this.props.groupId);t.profile&&["avatar_url","long_description","name","short_description"].forEach(e=>{t.profile[e]=t.profile[e]||""}),this.setState({summary:t,summaryLoading:!dS.a.isStateReady(this.props.groupId,dS.a.STATE_KEY.Summary),isGroupPublicised:dS.a.getGroupPublicity(this.props.groupId),isUserPrivileged:dS.a.isUserPrivileged(this.props.groupId),groupRooms:dS.a.getGroupRooms(this.props.groupId),groupRoomsLoading:!dS.a.isStateReady(this.props.groupId,dS.a.STATE_KEY.GroupRooms),isUserMember:dS.a.getGroupMembers(this.props.groupId).some(e=>e.userId===this._matrixClient.credentials.userId)}),this.props.groupIsNew&&e&&this._onEditClick()}),Fe()(this,"_onEditClick",()=>{this.setState({editing:!0,profileForm:Object.assign({},this.state.summary.profile),joinableForm:{policyType:this.state.summary.profile.is_openly_joinable?"open":"invite"}})}),Fe()(this,"_onShareClick",()=>{const e=On.getComponent("dialogs.ShareDialog");qd.a.createTrackedDialog("share community dialog","",e,{target:this._matrixClient.getGroup(this.props.groupId)||new bT.a(this.props.groupId)})}),Fe()(this,"_onCancelClick",()=>{this._closeSettings()}),Fe()(this,"_onAction",e=>{switch(e.action){case"close_settings":this.setState({editing:!1,profileForm:null})}}),Fe()(this,"_closeSettings",()=>{gn.a.dispatch({action:"close_settings"})}),Fe()(this,"_onNameChange",e=>{const t=Object.assign(this.state.profileForm,{name:e});this.setState({profileForm:t})}),Fe()(this,"_onShortDescChange",e=>{const t=Object.assign(this.state.profileForm,{short_description:e});this.setState({profileForm:t})}),Fe()(this,"_onLongDescChange",e=>{const t=Object.assign(this.state.profileForm,{long_description:e.target.value});this.setState({profileForm:t})}),Fe()(this,"_onAvatarSelected",e=>{const t=e.target.files[0];t&&(this.setState({uploadingAvatar:!0}),this._matrixClient.uploadContent(t).then(e=>{const t=Object.assign(this.state.profileForm,{avatar_url:e});this.setState({uploadingAvatar:!1,profileForm:t,avatarChanged:!0})}).catch(e=>{this.setState({uploadingAvatar:!1});const t=On.getComponent("dialogs.ErrorDialog");console.error("Failed to upload avatar image",e),qd.a.createTrackedDialog("Failed to upload image","",t,{title:Object(ts.a)("Error"),description:Object(ts.a)("Failed to upload image")})}))}),Fe()(this,"_onJoinableChange",e=>{this.setState({joinableForm:{policyType:e.target.value}})}),Fe()(this,"_onSaveClick",()=>{this.setState({saving:!0});(this.state.isUserPrivileged?this._saveGroup():Promise.resolve()).then(e=>{this.setState({saving:!1,editing:!1,summary:null}),this._initGroupStore(this.props.groupId),this.state.avatarChanged&&pu.a.refreshGroupProfile(this._matrixClient,this.props.groupId)}).catch(e=>{this.setState({saving:!1});const t=On.getComponent("dialogs.ErrorDialog");console.error("Failed to save community profile",e),qd.a.createTrackedDialog("Failed to update group","",t,{title:Object(ts.a)("Error"),description:Object(ts.a)("Failed to update community")})}).finally(()=>{this.setState({avatarChanged:!1})})}),Fe()(this,"_onAcceptInviteClick",async()=>{this.setState({membershipBusy:!0}),await Object(oE.c)(500),dS.a.acceptGroupInvite(this.props.groupId).then(()=>{}).catch(e=>{this.setState({membershipBusy:!1});const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Error accepting invite","",t,{title:Object(ts.a)("Error"),description:Object(ts.a)("Unable to accept invite")})})}),Fe()(this,"_onRejectInviteClick",async()=>{this.setState({membershipBusy:!0}),await Object(oE.c)(500),dS.a.leaveGroup(this.props.groupId).then(()=>{}).catch(e=>{this.setState({membershipBusy:!1});const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Error rejecting invite","",t,{title:Object(ts.a)("Error"),description:Object(ts.a)("Unable to reject invite")})})}),Fe()(this,"_onJoinClick",async()=>{this._matrixClient.isGuest()?gn.a.dispatch({action:"require_registration",screen_after:{screen:"group/"+this.props.groupId}}):(this.setState({membershipBusy:!0}),await Object(oE.c)(500),dS.a.joinGroup(this.props.groupId).then(()=>{}).catch(e=>{this.setState({membershipBusy:!1});const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Error joining room","",t,{title:Object(ts.a)("Error"),description:Object(ts.a)("Unable to join community")})}))}),Fe()(this,"_onLeaveClick",()=>{const e=On.getComponent("dialogs.QuestionDialog"),t=this._leaveGroupWarnings();qd.a.createTrackedDialog("Leave Group","",e,{title:Object(ts.a)("Leave Community"),description:i.a.createElement("span",null,Object(ts.a)("Leave %(groupName)s?",{groupName:this.props.groupId}),t),button:Object(ts.a)("Leave"),danger:this.state.isUserPrivileged,onFinished:async e=>{e&&(this.setState({membershipBusy:!0}),await Object(oE.c)(500),dS.a.leaveGroup(this.props.groupId).then(()=>{}).catch(e=>{this.setState({membershipBusy:!1});const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Error leaving community","",t,{title:Object(ts.a)("Error"),description:Object(ts.a)("Unable to leave community")})}))}})}),Fe()(this,"_onAddRoomsClick",()=>{Object(vT.a)(this.props.groupId)})}componentDidMount(){this._unmounted=!1,this._matrixClient=Cs.a.get(),this._matrixClient.on("Group.myMembership",this._onGroupMyMembership),this._initGroupStore(this.props.groupId,!0),this._dispatcherRef=gn.a.register(this._onAction),this._rightPanelStoreToken=yT.a.getSharedInstance().addListener(this._onRightPanelStoreUpdate)}componentWillUnmount(){this._unmounted=!0,this._matrixClient.removeListener("Group.myMembership",this._onGroupMyMembership),gn.a.unregister(this._dispatcherRef),this._rightPanelStoreToken&&this._rightPanelStoreToken.remove()}UNSAFE_componentWillReceiveProps(e){this.props.groupId!==e.groupId&&this.setState({summary:null,error:null},()=>{this._initGroupStore(e.groupId)})}_initGroupStore(e,t){const a=this._matrixClient.getGroup(e);a&&a.inviter&&a.inviter.userId&&this._fetchInviterProfile(a.inviter.userId),dS.a.registerListener(e,this.onGroupStoreUpdated.bind(this,t));let n=!1;dS.a.on("error",(t,a,s)=>{this._unmounted||e!==a||("M_GUEST_ACCESS_FORBIDDEN"!==t.errcode||n||(gn.a.dispatch({action:"do_after_sync_prepared",deferred_action:{action:"view_group",group_id:e}}),gn.a.dispatch({action:"require_registration",screen_after:{screen:"group/"+e}}),n=!0),s===dS.a.STATE_KEY.Summary&&this.setState({summary:null,error:t,editing:!1}))})}_fetchInviterProfile(e){this.setState({inviterProfileBusy:!0}),this._matrixClient.getProfileInfo(e).then(e=>{this._unmounted||this.setState({inviterProfile:{avatarUrl:e.avatar_url,displayName:e.displayname}})}).catch(e=>{console.error("Error getting group inviter profile",e)}).finally(()=>{this._unmounted||this.setState({inviterProfileBusy:!1})})}async _saveGroup(){await this._matrixClient.setGroupProfile(this.props.groupId,this.state.profileForm),await this._matrixClient.setGroupJoinPolicy(this.props.groupId,{type:this.state.joinableForm.policyType})}_leaveGroupWarnings(){const e=[];return this.state.isUserPrivileged&&e.push(i.a.createElement("span",{className:"warning"}," ",Object(ts.a)("You are an administrator of this community. You will not be able to rejoin without an invite from another administrator."))),e}_getGroupSection(){const e=Hn()({mx_GroupView_group:this.state.editing,mx_GroupView_group_disabled:this.state.editing&&!this.state.isUserPrivileged}),t=this.state.editing?i.a.createElement("h2",null," ",Object(ts.a)("Community Settings")," "):i.a.createElement("div",null),n=Object(gT.a)("community-settings");let s=null;n&&this.state.isUserPrivileged&&(s=i.a.createElement("div",{className:"mx_GroupView_hostingSignup"},Object(ts.a)("Want more than a community? <a>Get your own server</a>",{},{a:e=>i.a.createElement("a",{href:n,target:"_blank",rel:"noreferrer noopener"},e)}),i.a.createElement("a",{href:n,target:"_blank",rel:"noreferrer noopener"},i.a.createElement("img",{src:a(1371),width:"11",height:"10",alt:""}))));const o=this.state.editing&&this.state.isUserPrivileged?i.a.createElement("div",{className:"mx_GroupView_changeDelayWarning"},Object(ts.a)("Changes made to your community <bold1>name</bold1> and <bold2>avatar</bold2> might not be seen by other users for up to 30 minutes.",{},{bold1:e=>i.a.createElement("b",null," ",e," "),bold2:e=>i.a.createElement("b",null," ",e," ")})):i.a.createElement("div",null);return i.a.createElement("div",{className:e},t,s,o,this._getJoinableNode(),this._getLongDescriptionNode(),this._getRoomsNode())}_getRoomsNode(){const e=On.getComponent("rooms.RoomDetailList"),t=On.getComponent("elements.AccessibleButton"),n=On.getComponent("elements.TintableSvg"),s=On.getComponent("elements.Spinner"),o=On.getComponent("elements.TooltipButton"),r=this.state.editing?i.a.createElement(o,{helpText:Object(ts.a)("These rooms are displayed to community members on the community page. Community members can join the rooms by clicking on them.")}):i.a.createElement("div",null),l=this.state.editing?i.a.createElement(t,{className:"mx_GroupView_rooms_header_addRow",onClick:this._onAddRoomsClick},i.a.createElement("div",{className:"mx_GroupView_rooms_header_addRow_button"},i.a.createElement(n,{src:a(8427),width:"24",height:"24"})),i.a.createElement("div",{className:"mx_GroupView_rooms_header_addRow_label"},Object(ts.a)("Add rooms to this community"))):i.a.createElement("div",null);return i.a.createElement("div",{className:"mx_GroupView_rooms"},i.a.createElement("div",{className:"mx_GroupView_rooms_header"},i.a.createElement("h3",null,Object(ts.a)("Rooms"),r),l),this.state.groupRoomsLoading?i.a.createElement(s,null):i.a.createElement(e,{rooms:this.state.groupRooms}))}_getFeaturedRoomsNode(){const e=this.state.summary,t=[],a={};e.rooms_section.rooms.forEach(e=>{if(null===e.category_id)t.push(e);else{let t=a[e.category_id];void 0===t&&(t=[],a[e.category_id]=t),t.push(e)}});const n=i.a.createElement(CT,{rooms:t,groupId:this.props.groupId,editing:this.state.editing}),s=Object.keys(a).map(t=>{const n=e.rooms_section.categories[t];return i.a.createElement(CT,{key:t,rooms:a[t],category:n,groupId:this.props.groupId,editing:this.state.editing})});return i.a.createElement("div",{className:"mx_GroupView_featuredThings"},i.a.createElement("div",{className:"mx_GroupView_featuredThings_header"},Object(ts.a)("Featured Rooms:")),n,s)}_getFeaturedUsersNode(){const e=this.state.summary,t=[],a={};e.users_section.users.forEach(e=>{if(null===e.role_id)t.push(e);else{let t=a[e.role_id];void 0===t&&(t=[],a[e.role_id]=t),t.push(e)}});const n=i.a.createElement(OT,{users:t,groupId:this.props.groupId,editing:this.state.editing}),s=Object.keys(a).map(t=>{const n=e.users_section.roles[t];return i.a.createElement(OT,{key:t,users:a[t],role:n,groupId:this.props.groupId,editing:this.state.editing})});return i.a.createElement("div",{className:"mx_GroupView_featuredThings"},i.a.createElement("div",{className:"mx_GroupView_featuredThings_header"},Object(ts.a)("Featured Users:")),n,s)}_getMembershipSection(){const e=On.getComponent("elements.Spinner"),t=On.getComponent("avatars.BaseAvatar"),a=this._matrixClient.getGroup(this.props.groupId);if(a&&"invite"===a.myMembership){if(this.state.membershipBusy||this.state.inviterProfileBusy)return i.a.createElement("div",{className:"mx_GroupView_membershipSection"},i.a.createElement(e,null));const n=this.state.inviterProfile&&this.state.inviterProfile.avatarUrl?Object(Os.b)(this.state.inviterProfile.avatarUrl).getSquareThumbnailHttp(36):null,s=a.inviter||{};let o=s.userId;return this.state.inviterProfile&&(o=this.state.inviterProfile.displayName||s.userId),i.a.createElement("div",{className:"mx_GroupView_membershipSection mx_GroupView_membershipSection_invited"},i.a.createElement("div",{className:"mx_GroupView_membershipSubSection"},i.a.createElement("div",{className:"mx_GroupView_membershipSection_description"},i.a.createElement(t,{url:n,name:o,width:36,height:36}),Object(ts.a)("%(inviter)s has invited you to join this community",{inviter:o||Object(ts.a)("Someone")})),i.a.createElement("div",{className:"mx_GroupView_membership_buttonContainer"},i.a.createElement(Fs.a,{className:"mx_GroupView_textButton mx_RoomHeader_textButton",onClick:this._onAcceptInviteClick},Object(ts.a)("Accept")),i.a.createElement(Fs.a,{className:"mx_GroupView_textButton mx_RoomHeader_textButton",onClick:this._onRejectInviteClick},Object(ts.a)("Decline")))))}let n,s,o,r,l;if((!a||"leave"===a.myMembership)&&this.state.summary&&this.state.summary.profile&&Boolean(this.state.summary.profile.is_openly_joinable))r=Object(ts.a)("Join this community"),l=this._onJoinClick,s="mx_GroupView_joinButton",n="mx_GroupView_membershipSection_leave";else{if(!a||"join"!==a.myMembership||!this.state.editing)return null;r=Object(ts.a)("Leave this community"),l=this._onLeaveClick,o=this.state.isUserPrivileged?Object(ts.a)("You are an administrator of this community"):Object(ts.a)("You are a member of this community"),s={mx_GroupView_leaveButton:!0,mx_RoomHeader_textButton_danger:this.state.isUserPrivileged},n="mx_GroupView_membershipSection_joined"}const c=Hn()(["mx_RoomHeader_textButton","mx_GroupView_textButton"],s),d=Hn()("mx_GroupView_membershipSection",n);return i.a.createElement("div",{className:d},i.a.createElement("div",{className:"mx_GroupView_membershipSubSection"},this.state.membershipBusy?i.a.createElement(e,null):i.a.createElement("div",null),i.a.createElement("div",{className:"mx_GroupView_membership_buttonContainer"},i.a.createElement(Fs.a,{className:c,onClick:l,title:o},r))))}_getJoinableNode(){const e=On.getComponent("elements.InlineSpinner");return this.state.editing?i.a.createElement("div",null,i.a.createElement("h3",null,Object(ts.a)("Who can join this community?"),this.state.groupJoinableLoading?i.a.createElement(e,null):i.a.createElement("div",null)),i.a.createElement("div",null,i.a.createElement("label",null,i.a.createElement("input",{type:"radio",value:"invite",checked:"invite"===this.state.joinableForm.policyType,onChange:this._onJoinableChange}),i.a.createElement("div",{className:"mx_GroupView_label_text"},Object(ts.a)("Only people who have been invited")))),i.a.createElement("div",null,i.a.createElement("label",null,i.a.createElement("input",{type:"radio",value:"open",checked:"open"===this.state.joinableForm.policyType,onChange:this._onJoinableChange}),i.a.createElement("div",{className:"mx_GroupView_label_text"},Object(ts.a)("Everyone"))))):null}_getLongDescriptionNode(){const e=this.state.summary;let t=null;e.profile&&e.profile.long_description?t=Object(tS.h)(e.profile.long_description):this.state.isUserPrivileged&&(t=i.a.createElement("div",{className:"mx_GroupView_groupDesc_placeholder",onClick:this._onEditClick},Object(ts.a)("Your community hasn't got a Long Description, a HTML page to show to community members.<br />Click here to open settings and give it one!",{},{br:i.a.createElement("br",null)})));const a=Hn()({mx_GroupView_groupDesc:!0,mx_GroupView_groupDesc_disabled:!this.state.isUserPrivileged});return this.state.editing?i.a.createElement("div",{className:a},i.a.createElement("h3",null," ",Object(ts.a)("Long Description (HTML)")," "),i.a.createElement("textarea",{value:this.state.profileForm.long_description,placeholder:Object(ts.a)(ET),onChange:this._onLongDescChange,tabIndex:"4",key:"editLongDesc"})):i.a.createElement("div",{className:"mx_GroupView_groupDesc"},t)}render(){const e=On.getComponent("avatars.GroupAvatar"),t=On.getComponent("elements.Spinner");if(this.state.summaryLoading&&null===this.state.error||this.state.saving)return i.a.createElement(t,null);if(this.state.summary&&!this.state.error){const n=this.state.summary;let s,o,r;const l=[];if(this.state.editing&&this.state.isUserPrivileged){let e;if(this.state.uploadingAvatar)e=i.a.createElement(t,null);else{const t=On.getComponent("avatars.GroupAvatar");e=i.a.createElement(t,{groupId:this.props.groupId,groupName:this.state.profileForm.name,groupAvatarUrl:this.state.profileForm.avatar_url,width:28,height:28,resizeMethod:"crop"})}s=i.a.createElement("div",{className:"mx_GroupView_avatarPicker"},i.a.createElement("label",{htmlFor:"avatarInput",className:"mx_GroupView_avatarPicker_label"},e),i.a.createElement("div",{className:"mx_GroupView_avatarPicker_edit"},i.a.createElement("label",{htmlFor:"avatarInput",className:"mx_GroupView_avatarPicker_label"},i.a.createElement("img",{src:a(8428),alt:Object(ts.a)("Upload avatar"),title:Object(ts.a)("Upload avatar"),width:"17",height:"15"})),i.a.createElement("input",{id:"avatarInput",className:"mx_GroupView_uploadInput",type:"file",onChange:this._onAvatarSelected})));const n=On.getComponent("elements.EditableText");o=i.a.createElement(n,{className:"mx_GroupView_editable",placeholderClassName:"mx_GroupView_placeholder",placeholder:Object(ts.a)("Community Name"),blurToCancel:!1,initialValue:this.state.profileForm.name,onValueChanged:this._onNameChange,tabIndex:"0",dir:"auto"}),r=i.a.createElement(n,{className:"mx_GroupView_editable",placeholderClassName:"mx_GroupView_placeholder",placeholder:Object(ts.a)("Description"),blurToCancel:!1,initialValue:this.state.profileForm.short_description,onValueChanged:this._onShortDescChange,tabIndex:"0",dir:"auto"})}else{const t=this.state.isUserMember?this._onEditClick:null,a=n.profile?n.profile.avatar_url:null,l=n.profile?n.profile.name:null;s=i.a.createElement(e,{groupId:this.props.groupId,groupAvatarUrl:a,groupName:l,onClick:t,width:28,height:28}),o=n.profile&&n.profile.name?i.a.createElement("div",{onClick:t},i.a.createElement("span",null,n.profile.name),i.a.createElement("span",{className:"mx_GroupView_header_groupid"},"(",this.props.groupId,")")):i.a.createElement("span",{onClick:t},this.props.groupId),n.profile&&n.profile.short_description&&(r=i.a.createElement("span",{onClick:t},n.profile.short_description))}this.state.editing?(l.push(i.a.createElement(Fs.a,{className:"mx_GroupView_textButton mx_RoomHeader_textButton",key:"_saveButton",onClick:this._onSaveClick},Object(ts.a)("Save"))),l.push(i.a.createElement(Fs.a,{className:"mx_RoomHeader_cancelButton",key:"_cancelButton",onClick:this._onCancelClick},i.a.createElement("img",{src:a(502),className:"mx_filterFlipColor",width:"18",height:"18",alt:Object(ts.a)("Cancel")})))):(n.user&&"join"===n.user.membership&&l.push(i.a.createElement(Fs.a,{className:"mx_GroupHeader_button mx_GroupHeader_editButton",key:"_editButton",onClick:this._onEditClick,title:Object(ts.a)("Community Settings")})),l.push(i.a.createElement(Fs.a,{className:"mx_GroupHeader_button mx_GroupHeader_shareButton",key:"_shareButton",onClick:this._onShareClick,title:Object(ts.a)("Share Community")})));const c=this.state.showRightPanel?i.a.createElement(q_.a,{groupId:this.props.groupId}):void 0,d={mx_GroupView_header:!0,"light-panel":!0,mx_GroupView_header_view:!this.state.editing,mx_GroupView_header_isUserMember:this.state.isUserMember};return i.a.createElement("main",{className:"mx_GroupView"},i.a.createElement("div",{className:Hn()(d)},i.a.createElement("div",{className:"mx_GroupView_header_leftCol"},i.a.createElement("div",{className:"mx_GroupView_header_avatar"},s),i.a.createElement("div",{className:"mx_GroupView_header_info"},i.a.createElement("div",{className:"mx_GroupView_header_name"},o),i.a.createElement("div",{className:"mx_GroupView_header_shortDesc"},r))),i.a.createElement("div",{className:"mx_GroupView_header_rightCol"},l),i.a.createElement(lx,null)),i.a.createElement(fT.a,{panel:c,resizeNotifier:this.props.resizeNotifier},i.a.createElement(Jn.a,{className:"mx_GroupView_body"},this._getMembershipSection(),this._getGroupSection())))}if(this.state.error){if(404===this.state.error.httpStatus)return i.a.createElement("div",{className:"mx_GroupView_error"},Object(ts.a)("Community %(groupId)s not found",{groupId:this.props.groupId}));{let e;return"M_UNRECOGNIZED"===this.state.error.errcode&&(e=i.a.createElement("div",null,Object(ts.a)("This homeserver does not support communities"))),i.a.createElement("div",{className:"mx_GroupView_error"},Object(ts.a)("Failed to load %(groupId)s",{groupId:this.props.groupId}),e)}}return console.error("Invalid state for GroupView"),i.a.createElement("div",null)}},Fe()(pT,"propTypes",{groupId:At.a.string.isRequired,groupIsNew:At.a.bool}),hT=pT))||hT;var kT=a(831);var IT,TT,PT=new class{async searchByPage(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestOrderItem/searchByDto";return v.a.post(a,e)}async getLabTestOrderItemByIdLabTestOrder(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestOrderItem/getLabTestOrderItemByIdLabTestOrder";return v.a.post(a,e)}async updateResultLabTestOrderItem(e){var t=localStorage.getItem("globits_oauth2_access_token");v.a.defaults.headers.common.Authorization="Bearer "+t;let a=y.a.API_ENPOINT+"/api/labTestOrderItem/updateResultLabTestOrderItem";return v.a.post(a,e)}},NT=a(129),DT=a.n(NT),jT=a(360),AT=a(222),MT=a(245),UT=a(581);const LT=["m.sticker","m.room.message"];const FT=e=>"m.room.member"===e.getType()||"m.room.third_party_invite"===e.getType();let BT=Object(os.a)("structures.MessagePanel")((TT=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onShowTypingNotificationsChange",()=>{this.setState({showTypingNotifications:ss.b.getValue("showTypingNotifications")})}),Fe()(this,"_isUnmounting",()=>!this._isMounted),Fe()(this,"_collectGhostReadMarker",e=>{e&&requestAnimationFrame(()=>{e.style.width="10%",e.style.opacity="0"})}),Fe()(this,"_onGhostTransitionEnd",e=>{const t=e.target.dataset.eventid;this.setState({ghostReadMarkers:this.state.ghostReadMarkers.filter(e=>e!==t)})}),Fe()(this,"_collectEventNode",(e,t)=>{var a;this.eventNodes[e]=null==t||null===(a=t.ref)||void 0===a?void 0:a.current}),Fe()(this,"_onHeightChanged",()=>{const e=this._scrollPanel.current;e&&e.checkScroll()}),Fe()(this,"_onTypingShown",()=>{const e=this._scrollPanel.current;e.checkScroll(),e&&e.getScrollState().stuckAtBottom&&e.preventShrinking()}),Fe()(this,"_onTypingHidden",()=>{const e=this._scrollPanel.current;e&&(e.updatePreventShrinking(),e.checkScroll())}),this.state={ghostReadMarkers:[],showTypingNotifications:ss.b.getValue("showTypingNotifications")},this._readReceiptMap={},this._readReceiptsByEvent={},this._readReceiptsByUserId={},this._showHiddenEventsInTimeline=ss.b.getValue("showHiddenEventsInTimeline"),this._isMounted=!1,this._readMarkerNode=Object(s.createRef)(),this._whoIsTyping=Object(s.createRef)(),this._scrollPanel=Object(s.createRef)(),this._showTypingNotificationsWatcherRef=ss.b.watchSetting("showTypingNotifications",null,this.onShowTypingNotificationsChange)}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1,ss.b.unwatchSetting(this._showTypingNotificationsWatcherRef)}componentDidUpdate(e,t){if(e.readMarkerVisible&&this.props.readMarkerEventId!==e.readMarkerEventId){const t=this.state.ghostReadMarkers;t.push(e.readMarkerEventId),this.setState({ghostReadMarkers:t})}}getNodeForEventId(e){if(this.eventNodes)return this.eventNodes[e]}isAtBottom(){return this._scrollPanel.current&&this._scrollPanel.current.isAtBottom()}getScrollState(){return this._scrollPanel.current?this._scrollPanel.current.getScrollState():null}getReadMarkerPosition(){const e=this._readMarkerNode.current,t=this._scrollPanel.current;if(!e||!t)return null;const a=DT.a.findDOMNode(t).getBoundingClientRect(),n=e.getBoundingClientRect();return n.bottom+2<a.top?-1:n.top<a.bottom?0:1}scrollToTop(){this._scrollPanel.current&&this._scrollPanel.current.scrollToTop()}scrollToBottom(){this._scrollPanel.current&&this._scrollPanel.current.scrollToBottom()}scrollRelative(e){this._scrollPanel.current&&this._scrollPanel.current.scrollRelative(e)}handleScrollKey(e){this._scrollPanel.current&&this._scrollPanel.current.handleScrollKey(e)}scrollToEvent(e,t,a){this._scrollPanel.current&&this._scrollPanel.current.scrollToToken(e,t,a)}scrollToEventIfNeeded(e){const t=this.eventNodes[e];t&&t.scrollIntoView({block:"nearest",behavior:"instant"})}checkFillState(){this._scrollPanel.current&&this._scrollPanel.current.checkFillState()}_shouldShowEvent(e){return(!e.sender||!Cs.a.get().isUserIgnored(e.sender.userId))&&(!!this._showHiddenEventsInTimeline||!!Object(bk.b)(e)&&(this.props.highlightedEventId===e.getId()||!Object(jT.a)(e)))}_readMarkerForEvent(e,t){const a=!t&&this.props.readMarkerVisible;if(this.props.readMarkerEventId===e){let t;return a&&(t=i.a.createElement("hr",{className:"mx_RoomView_myReadMarker",style:{opacity:1,width:"99%"}})),i.a.createElement("li",{key:"readMarker_"+e,ref:this._readMarkerNode,className:"mx_RoomView_myReadMarker_container","data-scroll-tokens":e},t)}if(this.state.ghostReadMarkers.includes(e)){const t=i.a.createElement("hr",{className:"mx_RoomView_myReadMarker",ref:this._collectGhostReadMarker,onTransitionEnd:this._onGhostTransitionEnd,"data-eventid":e});return i.a.createElement("li",{key:"_readuptoghost_"+e,className:"mx_RoomView_myReadMarker_container"},t)}return null}_getNextEventInfo(e,t){return{nextEvent:t<e.length-1?e[t+1]:null,nextTile:e.slice(t+1).find(e=>this._shouldShowEvent(e))}}get _roomHasPendingEdit(){return this.props.room&&localStorage.getItem("mx_edit_room_"+this.props.room.roomId)}_getEventTiles(){let e,t;this.eventNodes={};let a=-1;for(e=this.props.events.length-1;e>=0;e--){const n=this.props.events[e];if(this._shouldShowEvent(n)&&(void 0===t&&(t=n),!n.status)){a=e;break}}const n=[];let s=null;this._readReceiptsByEvent={},this.props.showReadReceipts&&(this._readReceiptsByEvent=this._getReadReceiptsByShownEvent());let i=null;for(e=0;e<this.props.events.length;e++){const o=this.props.events[e],r=o.getId(),l=o===t,{nextEvent:c,nextTile:d}=this._getNextEventInfo(this.props.events,e);if(i){if(i.shouldGroup(o)){i.add(o);continue}n.push(...i.getTiles()),s=i.getNewPrevEvent(),i=null}for(const e of WT)e.canStartGroup(this,o)&&(i=new e(this,o,s,t,c,d));if(!i){const t=!1;this._shouldShowEvent(o)&&(n.push(...this._getTilesForEvent(s,o,l,t,c,d)),s=o);const i=this._readMarkerForEvent(r,e>=a);i&&n.push(i)}}return!this.props.editState&&this._roomHasPendingEdit&&gn.a.dispatch({action:"edit_event",event:this.props.room.findEventById(this._roomHasPendingEdit)}),i&&n.push(...i.getTiles()),n}_getTilesForEvent(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;const r=On.getComponent("messages.TileErrorBoundary"),l=On.getComponent("rooms.EventTile"),c=On.getComponent("messages.DateSeparator"),d=[],m=this.props.editState&&this.props.editState.getEvent().getId()===t.getId();let u=t.getTs(),h=t.getDate();t.status&&(h=new Date,u=h.getTime());const p=this._wantsDateSeparator(e,h);if(p&&!n){const e=i.a.createElement("li",{key:u},i.a.createElement(c,{key:u,ts:u}));d.push(e)}let g=!1;s&&(g=this._wantsDateSeparator(t,s.getDate()||new Date));const f=!p&&function(e,t){return!!(e&&e.sender&&t.sender)&&(!(t.getTs()-e.getTs()>3e5)&&(t.isRedacted()===e.isRedacted()&&(!!(t.getType()===e.getType()||LT.includes(t.getType())&&LT.includes(e.getType()))&&(t.sender.userId===e.sender.userId&&t.sender.name===e.sender.name&&t.sender.getMxcAvatarUrl()===e.sender.getMxcAvatarUrl()&&!!Object(bk.b)(e)))))}(e,t),v=t.getId(),b=v===this.props.highlightedEventId,y=t.status?void 0:v,E=this._readReceiptsByEvent[v];let _=!1;const S=e=>!e||"sent"===e,C=S(t.getAssociatedStatus()),w=s&&this._shouldShowEvent(s);return(!w&&C||w&&C&&!S(s.getAssociatedStatus()))&&(_=!0),o&&o!==s&&S(o.getAssociatedStatus())&&(_=!1),_=_&&t.getSender()===Cs.a.get().getUserId(),d.push(i.a.createElement(r,{key:t.getTxnId()||v,mxEvent:t},i.a.createElement(l,{as:"li","data-scroll-tokens":y,ref:this._collectEventNode.bind(this,v),alwaysShowTimestamps:this.props.alwaysShowTimestamps,mxEvent:t,continuation:f,isRedacted:t.isRedacted(),replacingEventId:t.replacingEventId(),editState:m&&this.props.editState,onHeightChanged:this._onHeightChanged,readReceipts:E,readReceiptMap:this._readReceiptMap,showUrlPreview:this.props.showUrlPreview,checkUnmounting:this._isUnmounting,eventSendStatus:t.getAssociatedStatus(),tileShape:this.props.tileShape,isTwelveHour:this.props.isTwelveHour,permalinkCreator:this.props.permalinkCreator,last:a,lastInSection:g,lastSuccessful:_,isSelectedEvent:b,getRelationsForEvent:this.props.getRelationsForEvent,showReactions:this.props.showReactions,layout:this.props.layout,enableFlair:this.props.enableFlair,showReadReceipts:this.props.showReadReceipts}))),d}_wantsDateSeparator(e,t){return null==e?!this.props.suppressFirstDateSeparator:Object(AT.f)(e.getDate(),t)}_getReadReceiptsForEvent(e){const t=Cs.a.get().credentials.userId,{room:a}=this.props;if(!a)return null;const n=[];return a.getReceiptsForEvent(e).forEach(e=>{if(!e.userId||"m.read"!==e.type||e.userId===t)return;if(Cs.a.get().isUserIgnored(e.userId))return;const s=a.getMember(e.userId);n.push({userId:e.userId,roomMember:s,ts:e.data?e.data.ts:0})}),n}_getReadReceiptsByShownEvent(){const e={},t={};let a;for(const n of this.props.events){if(this._shouldShowEvent(n)&&(a=n.getId()),!a)continue;const s=e[a]||[],i=this._getReadReceiptsForEvent(n);e[a]=s.concat(i);for(const e of i)t[e.userId]={lastShownEventId:a,receipt:e}}for(const a in this._readReceiptsByUserId){if(t[a])continue;const{lastShownEventId:n,receipt:s}=this._readReceiptsByUserId[a],i=e[n]||[];e[n]=i.concat(s),t[a]={lastShownEventId:n,receipt:s}}this._readReceiptsByUserId=t;for(const t in e)e[t].sort((e,t)=>t.ts-e.ts);return e}updateTimelineMinHeight(){const e=this._scrollPanel.current;if(e){const t=e.isAtBottom(),a=this._whoIsTyping.current,n=a&&a.isVisible();t&&n&&e.preventShrinking()}}onTimelineReset(){const e=this._scrollPanel.current;e&&e.clearPreventShrinking()}render(){const e=On.getComponent("elements.ErrorBoundary"),t=On.getComponent("structures.ScrollPanel"),a=On.getComponent("rooms.WhoIsTypingTile"),n=On.getComponent("elements.Spinner");let s,o;this.props.backPaginating&&(s=i.a.createElement("li",{key:"_topSpinner"},i.a.createElement(n,null))),this.props.forwardPaginating&&(o=i.a.createElement("li",{key:"_bottomSpinner"},i.a.createElement(n,null)));const r=this.props.hidden?{display:"none"}:{},l=Hn()(this.props.className,{mx_MessagePanel_alwaysShowTimestamps:this.props.alwaysShowTimestamps});let c;this.props.room&&!this.props.tileShape&&this.state.showTypingNotifications&&(c=i.a.createElement(a,{room:this.props.room,onShown:this._onTypingShown,onHidden:this._onTypingHidden,ref:this._whoIsTyping}));let d=null;return this.props.layout==MT.a.IRC&&(d=i.a.createElement(Nw,{minWidth:20,maxWidth:600,roomId:this.props.room?this.props.room.roomId:null})),i.a.createElement(e,null,i.a.createElement(t,{ref:this._scrollPanel,className:l,onScroll:this.props.onScroll,onUserScroll:this.props.onUserScroll,onResize:this.onResize,onFillRequest:this.props.onFillRequest,onUnfillRequest:this.props.onUnfillRequest,style:r,stickyBottom:this.props.stickyBottom,resizeNotifier:this.props.resizeNotifier,fixedChildren:d},s,this._getEventTiles(),c,o))}},Fe()(TT,"propTypes",{hidden:At.a.bool,backPaginating:At.a.bool,forwardPaginating:At.a.bool,events:At.a.array.isRequired,highlightedEventId:At.a.string,room:At.a.object,showUrlPreview:At.a.bool,readMarkerEventId:At.a.string,readMarkerVisible:At.a.bool,ourUserId:At.a.string,suppressFirstDateSeparator:At.a.bool,showReadReceipts:At.a.bool,stickyBottom:At.a.bool,onScroll:At.a.func,onUserScroll:At.a.func,onFillRequest:At.a.func,className:At.a.string.isRequired,tileShape:At.a.string,isTwelveHour:At.a.bool,alwaysShowTimestamps:At.a.bool,getRelationsForEvent:At.a.func,showReactions:At.a.bool,layout:MT.b,enableFlair:At.a.bool}),IT=TT))||IT;class VT{constructor(e,t,a,n){this.panel=e,this.createEvent=t,this.prevEvent=a,this.lastShownEvent=n,this.events=[],this.ejectedEvents=[],this.readMarker=e._readMarkerForEvent(t.getId(),t===n)}shouldGroup(e){const t=this.panel,a=this.createEvent;return!t._shouldShowEvent(e)||!t._wantsDateSeparator(this.createEvent,e.getDate())&&(("m.room.member"!==e.getType()||e.getStateKey()===a.getSender()&&"join"===e.getContent().membership)&&!(!e.isState()||e.getSender()!==a.getSender()))}add(e){const t=this.panel;this.readMarker=this.readMarker||t._readMarkerForEvent(e.getId(),e===this.lastShownEvent),t._shouldShowEvent(e)&&("m.room.encryption"===e.getType()?this.ejectedEvents.push(e):this.events.push(e))}getTiles(){if(!this.events||!this.events.length)return[];const e=On.getComponent("messages.DateSeparator"),t=On.getComponent("views.elements.EventListSummary"),a=this.panel,n=[],s=this.createEvent,o=this.lastShownEvent;if(a._wantsDateSeparator(this.prevEvent,s.getDate())){const t=s.getTs();n.push(i.a.createElement("li",{key:t+"~"},i.a.createElement(e,{key:t+"~",ts:t})))}a._shouldShowEvent(s)&&n.push(...a._getTilesForEvent(s,s));for(const e of this.ejectedEvents)n.push(...a._getTilesForEvent(s,e,s===o,!0));const r=this.events.map(e=>a._getTilesForEvent(e,e,e===o,!0)).reduce((e,t)=>e.concat(t),[]),l=this.events[this.events.length-1];let c;const d=l.getRoomId(),m=l.sender?l.sender.name:l.getSender();return c=aE.a.shared().getUserIdForRoomId(d)?Object(ts.a)("%(creator)s created this DM.",{creator:m}):Object(ts.a)("%(creator)s created and configured the room.",{creator:m}),n.push(i.a.createElement(Yk,{key:"newroomintro"})),n.push(i.a.createElement(t,{key:"roomcreationsummary",events:this.events,onToggle:a._onHeightChanged,summaryMembers:[l.sender],summaryText:c},r)),this.readMarker&&n.push(this.readMarker),n}getNewPrevEvent(){return this.createEvent}}Fe()(VT,"canStartGroup",(function(e,t){return"m.room.create"===t.getType()}));class GT{constructor(e,t,a,n,s,i){this.panel=e,this.readMarker=e._readMarkerForEvent(t.getId(),t===n),this.events=[t],this.prevEvent=a,this.lastShownEvent=n,this.nextEvent=s,this.nextEventTile=i}shouldGroup(e){return!this.panel._shouldShowEvent(e)||!this.panel._wantsDateSeparator(this.events[0],e.getDate())&&e.isRedacted()}add(e){this.readMarker=this.readMarker||this.panel._readMarkerForEvent(e.getId(),e===this.lastShownEvent),this.panel._shouldShowEvent(e)&&this.events.push(e)}getTiles(){if(!this.events||!this.events.length)return[];const e=On.getComponent("messages.DateSeparator"),t=On.getComponent("views.elements.EventListSummary"),a=this.panel,n=[],s=this.lastShownEvent;if(a._wantsDateSeparator(this.prevEvent,this.events[0].getDate())){const t=this.events[0].getTs();n.push(i.a.createElement("li",{key:t+"~"},i.a.createElement(e,{key:t+"~",ts:t})))}const o="redactioneventlistsummary-"+(this.prevEvent?this.events[0].getId():"initial"),r=new Set;let l=this.events.map((e,t)=>{r.add(e.sender);const n=0===t?this.prevEvent:this.events[t-1];return a._getTilesForEvent(n,e,e===s,!0,this.nextEvent,this.nextEventTile)}).reduce((e,t)=>e.concat(t),[]);return 0===l.length&&(l=null),n.push(i.a.createElement(t,{key:o,threshold:2,events:this.events,onToggle:a._onHeightChanged,summaryMembers:Array.from(r),summaryText:Object(ts.a)("%(count)s messages deleted.",{count:l.length})},l)),this.readMarker&&n.push(this.readMarker),n}getNewPrevEvent(){return this.events[this.events.length-1]}}Fe()(GT,"canStartGroup",(function(e,t){return e._shouldShowEvent(t)&&t.isRedacted()}));class zT{constructor(e,t,a,n){this.panel=e,this.readMarker=e._readMarkerForEvent(t.getId(),t===n),this.events=[t],this.prevEvent=a,this.lastShownEvent=n}shouldGroup(e){return!this.panel._wantsDateSeparator(this.events[0],e.getDate())&&FT(e)}add(e){if("m.room.member"===e.getType()){const t=Object(UT.a)(e);if(!t||0===t.trim().length)return}this.readMarker=this.readMarker||this.panel._readMarkerForEvent(e.getId(),e===this.lastShownEvent),this.events.push(e)}getTiles(){if(!this.events||!this.events.length)return[];const e=On.getComponent("messages.DateSeparator"),t=On.getComponent("views.elements.MemberEventListSummary"),a=this.panel,n=this.lastShownEvent,s=[];if(a._wantsDateSeparator(this.prevEvent,this.events[0].getDate())){const t=this.events[0].getTs();s.push(i.a.createElement("li",{key:t+"~"},i.a.createElement(e,{key:t+"~",ts:t})))}const o="membereventlistsummary-"+(this.prevEvent?this.events[0].getId():"initial");let r,l=this.events.map(e=>(e.getId()===a.props.highlightedEventId&&(r=!0),a._getTilesForEvent(e,e,e===n,!0))).reduce((e,t)=>e.concat(t),[]);return 0===l.length&&(l=null),s.push(i.a.createElement(t,{key:o,events:this.events,onToggle:a._onHeightChanged,startExpanded:r},l)),this.readMarker&&s.push(this.readMarker),s}getNewPrevEvent(){return this.events[0]}}Fe()(zT,"canStartGroup",(function(e,t){return e._shouldShowEvent(t)&&FT(t)}));const WT=[VT,zT,GT];var HT,KT;let qT=Object(os.a)("structures.MyGroups")((KT=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{groups:null,error:null}),Fe()(this,"_onCreateGroupClick",()=>{gn.a.dispatch({action:"view_create_group"})})}componentDidMount(){this._fetch()}_fetch(){this.context.getJoinedGroups().then(e=>{this.setState({groups:e.groups,error:null})},e=>{"M_GUEST_ACCESS_FORBIDDEN"!==e.errcode?this.setState({groups:null,error:e}):this.setState({groups:[],error:null})})}render(){const e=$c.a.get().brand,t=On.getComponent("elements.Spinner"),n=On.getComponent("rooms.SimpleRoomHeader"),s=On.getComponent("groups.GroupTile");let o,r;if(this.state.groups){const t=[];this.state.groups.forEach(e=>{t.push(i.a.createElement(s,{key:e,groupId:e}))}),r=t.length>0?i.a.createElement("h3",null,Object(ts.a)("Your Communities")):i.a.createElement("div",null),o=t.length>0?i.a.createElement(Jn.a,{className:"mx_MyGroups_scrollable"},i.a.createElement("div",{className:"mx_MyGroups_microcopy"},i.a.createElement("p",null,Object(ts.a)("Did you know: you can use communities to filter your %(brand)s experience!",{brand:e})),i.a.createElement("p",null,Object(ts.a)("To set up a filter, drag a community avatar over to the filter panel on the far left hand side of the screen. You can click on an avatar in the filter panel at any time to see only the rooms and people associated with that community."))),i.a.createElement("div",{className:"mx_MyGroups_joinedGroups"},t)):i.a.createElement("div",{className:"mx_MyGroups_placeholder"},Object(ts.a)("You're not currently a member of any communities."))}else o=this.state.error?i.a.createElement("div",{className:"mx_MyGroups_error"},Object(ts.a)("Error whilst fetching joined communities")):i.a.createElement(t,null);return i.a.createElement("div",{className:"mx_MyGroups"},i.a.createElement(n,{title:Object(ts.a)("Communities"),icon:a(8429)}),i.a.createElement("div",{className:"mx_MyGroups_header"},i.a.createElement("div",{className:"mx_MyGroups_headerCard"},i.a.createElement(Fs.a,{className:"mx_MyGroups_headerCard_button",onClick:this._onCreateGroupClick}),i.a.createElement("div",{className:"mx_MyGroups_headerCard_content"},i.a.createElement("div",{className:"mx_MyGroups_headerCard_header"},Object(ts.a)("Create a new community")),Object(ts.a)("Create a community to group together users and rooms! Build a custom homepage to mark out your space in the Matrix universe.")))),i.a.createElement(im.b,{featureId:"feature_spaces",title:Object(ts.a)("Communities are changing to Spaces")}),i.a.createElement("div",{className:"mx_MyGroups_content"},r,o))}},Fe()(KT,"contextType",ns.a),HT=KT))||HT;var YT,$T=a(1434),JT=a(838),QT=a(506),XT=a(146);let ZT=Object(os.a)("structures.UserView")(YT=class extends i.a.Component{static get propTypes(){return{userId:At.a.string}}constructor(e){super(e),this.state={}}componentDidMount(){this.props.userId&&this._loadProfileInfo()}componentDidUpdate(e){e.userId!==this.props.userId&&this.props.userId&&this._loadProfileInfo()}async _loadProfileInfo(){const e=Cs.a.get();let t;this.setState({loading:!0});try{t=await e.getProfileInfo(this.props.userId)}catch(e){const t=On.getComponent("dialogs.ErrorDialog");return qd.a.createTrackedDialog(Object(ts.a)("Could not load user profile"),"",t,{title:Object(ts.a)("Could not load user profile"),description:e&&e.message?e.message:Object(ts.a)("Operation failed")}),void this.setState({loading:!1})}const a=new XT.b({type:"m.room.member",content:t}),n=new Wy.a(null,this.props.userId);n.setMembershipEvent(a),this.setState({member:n,loading:!1})}render(){if(this.state.loading){const e=On.getComponent("elements.Spinner");return i.a.createElement(e,null)}if(this.state.member){const e=On.getComponent("structures.RightPanel"),t=On.getComponent("structures.MainSplit"),a=i.a.createElement(e,{user:this.state.member});return i.a.createElement(t,{panel:a,resizeNotifier:this.props.resizeNotifier},i.a.createElement(IE,null))}return i.a.createElement("div",null)}})||YT;var eP,tP,aP=a(794);let nP=Object(os.a)("structures.ViewSource")((tP=class extends i.a.Component{constructor(e){super(e),this.state={isEditing:!1}}onBack(){this.setState({isEditing:!1})}onEdit(){this.setState({isEditing:!0})}viewSourceContent(){const e=this.props.mxEvent.replacingEvent()||this.props.mxEvent,t=e.isEncrypted(),a=e._clearEvent,n=e.event;return t?i.a.createElement(i.a.Fragment,null,i.a.createElement("details",{open:!0,className:"mx_ViewSource_details"},i.a.createElement("summary",null,i.a.createElement("span",{className:"mx_ViewSource_heading"},Object(ts.a)("Decrypted event source"))),i.a.createElement(aP.a,{className:"json"},JSON.stringify(a,null,2))),i.a.createElement("details",{className:"mx_ViewSource_details"},i.a.createElement("summary",null,i.a.createElement("span",{className:"mx_ViewSource_heading"},Object(ts.a)("Original event source"))),i.a.createElement(aP.a,{className:"json"},JSON.stringify(n,null,2)))):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"mx_ViewSource_heading"},Object(ts.a)("Original event source")),i.a.createElement(aP.a,{className:"json"},JSON.stringify(n,null,2)))}getBaseEventId(){const e=this.props.mxEvent.replacingEvent()||this.props.mxEvent,t=e.isEncrypted(),a=this.props.mxEvent;var n,s,i,o;return t?null!==(n=null===(s=e.event.content["m.relates_to"])||void 0===s?void 0:s.event_id)&&void 0!==n?n:a.getId():null!==(i=null===(o=e.getContent()["m.relates_to"])||void 0===o?void 0:o.event_id)&&void 0!==i?i:a.getId()}editSourceContent(){const e=this.props.mxEvent.replacingEvent()||this.props.mxEvent,t=e.isState(),a=e.getRoomId(),n=e.getContent();if(t)return i.a.createElement(ns.a.Consumer,null,t=>i.a.createElement(rw.a,{room:t.getRoom(a),forceStateEvent:!0,onBack:()=>this.onBack(),inputs:{eventType:e.getType(),evContent:JSON.stringify(n,null,"\t"),stateKey:e.getStateKey()}}));{var s,o;const t=null!==(s=null===(o=n["m.new_content"])||void 0===o?void 0:o.body)&&void 0!==s?s:n.body,r={body:" * "+t,msgtype:n.msgtype,"m.new_content":{body:t,msgtype:n.msgtype},"m.relates_to":{rel_type:"m.replace",event_id:this.getBaseEventId()}};return i.a.createElement(ns.a.Consumer,null,t=>i.a.createElement(rw.a,{room:t.getRoom(a),forceStateEvent:!1,forceGeneralEvent:!0,onBack:()=>this.onBack(),inputs:{eventType:e.getType(),evContent:JSON.stringify(r,null,"\t")}}))}}canSendStateEvent(e){const t=Cs.a.get();return t.getRoom(e.getRoomId()).currentState.mayClientSendStateEvent(e.getType(),t)}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=this.props.mxEvent.replacingEvent()||this.props.mxEvent,a=this.state.isEditing,n=t.getRoomId(),s=t.getId(),o=t.isState()?this.canSendStateEvent(t):Object(WO.a)(this.props.mxEvent);return i.a.createElement(e,{className:"mx_ViewSource",onFinished:this.props.onFinished,title:Object(ts.a)("View Source")},i.a.createElement("div",null,i.a.createElement("div",null,"Room ID: ",n),i.a.createElement("div",null,"Event ID: ",s),i.a.createElement("div",{className:"mx_ViewSource_separator"}),a?this.editSourceContent():this.viewSourceContent()),!a&&o&&i.a.createElement("div",{className:"mx_Dialog_buttons"},i.a.createElement("button",{onClick:()=>this.onEdit()},Object(ts.a)("Edit"))))}},Fe()(tP,"propTypes",{onFinished:At.a.func.isRequired,mxEvent:At.a.object.isRequired}),eP=tP))||eP;var sP,iP,oP=a(821),rP=a(819);let lP=Object(os.a)("structures.auth.CompleteSecurity")((iP=class extends i.a.Component{constructor(){super(),Fe()(this,"_onStoreUpdate",()=>{const e=oP.g.sharedInstance();this.setState({phase:e.phase})});const e=oP.g.sharedInstance();e.on("update",this._onStoreUpdate),e.start(),this.state={phase:e.phase}}componentWillUnmount(){const e=oP.g.sharedInstance();e.off("update",this._onStoreUpdate),e.stop()}render(){const e=On.getComponent("auth.AuthPage"),t=On.getComponent("auth.CompleteSecurityBody"),{phase:a}=this.state;let n,s;if(a===oP.f)return null;if(a===oP.e)n=i.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),s=Object(ts.a)("Verify this login");else if(a===oP.c)n=i.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_verified"}),s=Object(ts.a)("Session verified");else if(a===oP.b)n=i.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),s=Object(ts.a)("Are you sure?");else{if(a!==oP.a)throw new Error("Unknown phase "+a);n=i.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),s=Object(ts.a)("Verify this login")}return i.a.createElement(e,null,i.a.createElement(t,null,i.a.createElement("h2",{className:"mx_CompleteSecurity_header"},n,s),i.a.createElement("div",{className:"mx_CompleteSecurity_body"},i.a.createElement(rP.a,{onFinished:this.props.onFinished}))))}},Fe()(iP,"propTypes",{onFinished:At.a.func.isRequired}),sP=iP))||sP;var cP;let dP=Object(os.a)("views.auth.CompleteSecurityBody")(cP=class extends i.a.PureComponent{render(){return i.a.createElement("div",{className:"mx_CompleteSecurityBody"},this.props.children)}})||cP;var mP,uP;let hP=Object(os.a)("views.dialogs.InteractiveAuthDialog")((uP=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{authError:null,uiaStage:null,uiaStagePhase:null}),Fe()(this,"_onAuthFinished",(e,t)=>{e?this.props.onFinished(!0,t):t===kT.a?this.props.onFinished(!1,null):this.setState({authError:t})}),Fe()(this,"_onUpdateStagePhase",(e,t)=>{this.setState({uiaStage:e,uiaStagePhase:t})}),Fe()(this,"_onDismissClick",()=>{this.props.onFinished(!1)})}_getDefaultDialogAesthetics(){const e={[GC.c.PHASE_PREAUTH]:{title:Object(ts.a)("Use Single Sign On to continue"),body:Object(ts.a)("To continue, use Single Sign On to prove your identity."),continueText:Object(ts.a)("Single Sign On"),continueKind:"primary"},[GC.c.PHASE_POSTAUTH]:{title:Object(ts.a)("Confirm to continue"),body:Object(ts.a)("Click the button below to confirm your identity."),continueText:Object(ts.a)("Confirm"),continueKind:"primary"}};return{[GC.c.LOGIN_TYPE]:e,[GC.c.UNSTABLE_LOGIN_TYPE]:e}}render(){const e=On.getComponent("structures.InteractiveAuth"),t=On.getComponent("views.dialogs.BaseDialog");let a=this.state.authError?"Error":this.props.title||Object(ts.a)("Authentication"),n=this.state.authError?null:this.props.body,s=null,o=null;const r=this.props.aestheticsForStagePhases||this._getDefaultDialogAesthetics();if(!this.state.authError&&r&&r[this.state.uiaStage]){const e=r[this.state.uiaStage][this.state.uiaStagePhase];e&&e.title&&(a=e.title),e&&e.body&&(n=e.body),e&&e.continueText&&(s=e.continueText),e&&e.continueKind&&(o=e.continueKind)}let l;return l=this.state.authError?i.a.createElement("div",{id:"mx_Dialog_content"},i.a.createElement("div",{role:"alert"},this.state.authError.message||this.state.authError.toString()),i.a.createElement("br",null),i.a.createElement(Fs.a,{onClick:this._onDismissClick,className:"mx_GeneralButton",autoFocus:"true"},Object(ts.a)("Dismiss"))):i.a.createElement("div",{id:"mx_Dialog_content"},n,i.a.createElement(e,{ref:this._collectInteractiveAuth,matrixClient:this.props.matrixClient,authData:this.props.authData,makeRequest:this.props.makeRequest,onAuthFinished:this._onAuthFinished,onStagePhaseChange:this._onUpdateStagePhase,continueText:s,continueKind:o})),i.a.createElement(t,{className:"mx_InteractiveAuthDialog",onFinished:this.props.onFinished,title:a,contentId:"mx_Dialog_content"},l)}},Fe()(uP,"propTypes",{matrixClient:At.a.object.isRequired,authData:At.a.shape({flows:At.a.array,params:At.a.object,session:At.a.string}),makeRequest:At.a.func.isRequired,onFinished:At.a.func.isRequired,title:At.a.string,body:At.a.string,aestheticsForStagePhases:At.a.object}),mP=uP))||mP;var pP,gP;let fP=Object(os.a)("views.dialogs.security.CreateCrossSigningDialog")((gP=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"_doBootstrapUIAuth",async e=>{if(this.state.canUploadKeysWithPasswordOnly&&this.state.accountPassword)await e({type:"m.login.password",identifier:{type:"m.id.user",user:Cs.a.get().getUserId()},user:Cs.a.get().getUserId(),password:this.state.accountPassword});else if(this.props.tokenLogin)await e({});else{const t={[GC.c.PHASE_PREAUTH]:{title:Object(ts.a)("Use Single Sign On to continue"),body:Object(ts.a)("To continue, use Single Sign On to prove your identity."),continueText:Object(ts.a)("Single Sign On"),continueKind:"primary"},[GC.c.PHASE_POSTAUTH]:{title:Object(ts.a)("Confirm encryption setup"),body:Object(ts.a)("Click the button below to confirm setting up encryption."),continueText:Object(ts.a)("Confirm"),continueKind:"primary"}},{finished:a}=qd.a.createTrackedDialog("Cross-signing keys dialog","",hP,{title:Object(ts.a)("Setting up keys"),matrixClient:Cs.a.get(),makeRequest:e,aestheticsForStagePhases:{[GC.c.LOGIN_TYPE]:t,[GC.c.UNSTABLE_LOGIN_TYPE]:t}}),[n]=await a;if(!n)throw new Error("Cross-signing key upload auth canceled")}}),Fe()(this,"_bootstrapCrossSigning",async()=>{this.setState({error:null});const e=Cs.a.get();try{await e.bootstrapCrossSigning({authUploadDeviceSigningKeys:this._doBootstrapUIAuth}),this.props.onFinished(!0)}catch(e){if(this.props.tokenLogin)return void this.props.onFinished();this.setState({error:e}),console.error("Error bootstrapping cross-signing",e)}}),Fe()(this,"_onCancel",()=>{this.props.onFinished(!1)}),this.state={error:null,canUploadKeysWithPasswordOnly:null,accountPassword:e.accountPassword||""},this.state.accountPassword?this.state.canUploadKeysWithPasswordOnly=!0:this._queryKeyUploadAuth()}componentDidMount(){this._bootstrapCrossSigning()}async _queryKeyUploadAuth(){try{await Cs.a.get().uploadDeviceSigningKeys(null,{}),console.log("uploadDeviceSigningKeys unexpectedly succeeded without UI auth!")}catch(e){if(!e.data||!e.data.flows)return void console.log("uploadDeviceSigningKeys advertised no flows!");const t=e.data.flows.some(e=>1===e.stages.length&&"m.login.password"===e.stages[0]);this.setState({canUploadKeysWithPasswordOnly:t})}}render(){return i.a.createElement(hu.a,{className:"mx_CreateCrossSigningDialog",onFinished:this.props.onFinished,title:Object(ts.a)("Setting up keys"),hasCancel:!1,fixedWidth:!1},i.a.createElement("div",null,i.a.createElement(Jc.a,null)))}},Fe()(gP,"propTypes",{accountPassword:At.a.string,tokenLogin:At.a.bool}),pP=gP))||pP;var vP,bP;let yP=Object(os.a)("structures.auth.E2eSetup")((bP=class extends i.a.Component{render(){return i.a.createElement(qS,null,i.a.createElement(dP,null,i.a.createElement(fP,{onFinished:this.props.onFinished,accountPassword:this.props.accountPassword,tokenLogin:this.props.tokenLogin})))}},Fe()(bP,"propTypes",{onFinished:At.a.func.isRequired,accountPassword:At.a.string,tokenLogin:At.a.bool}),vP=bP))||vP;class EP{constructor(e,t){this.client=Object(Gy.createClient)({baseUrl:e,idBaseUrl:t}),this.clientSecret=this.client.generateClientSecret(),this.identityServerDomain=t?t.split("://")[1]:null}resetPassword(e,t){return this.password=t,this.client.requestPasswordEmailToken(e,this.clientSecret,1).then(e=>(this.sessionId=e.sid,e),(function(e){throw"M_THREEPID_NOT_FOUND"===e.errcode?e.message=Object(ts.a)("This email address was not found"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}async checkEmailLinkClicked(){const e={sid:this.sessionId,client_secret:this.clientSecret};try{await this.client.setPassword({type:"m.login.email.identity",threepid_creds:e,threepidCreds:e},this.password)}catch(e){throw 401===e.httpStatus?e.message=Object(ts.a)("Failed to verify email address: make sure you clicked the link in the email"):404===e.httpStatus?e.message=Object(ts.a)("Your email address does not appear to be associated with a Matrix ID on this Homeserver."):e.httpStatus&&(e.message+=` (Status ${e.httpStatus})`),e}}}var _P,SP;let CP=Object(os.a)("structures.auth.ForgotPassword")((SP=class extends i.a.Component{constructor(e){super(e),Fe()(this,"state",{phase:1,email:"",password:"",password2:"",errorText:null,serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:""}),Fe()(this,"onVerify",async e=>{if(e.preventDefault(),this.reset)try{await this.reset.checkEmailLinkClicked(),this.setState({phase:4})}catch(e){this.showErrorDialog(e.message)}else console.error("onVerify called before submitPasswordReset!")}),Fe()(this,"onSubmitForm",async e=>{if(e.preventDefault(),await this._checkServerLiveliness(this.props.serverConfig),await this.password_field.validate({allowEmpty:!1}),this.state.email)if(this.state.password&&this.state.password2)if(this.state.passwordFieldValid)if(this.state.password!==this.state.password2)this.showErrorDialog(Object(ts.a)("New passwords must match each other."));else{const e=On.getComponent("dialogs.QuestionDialog");qd.a.createTrackedDialog("Forgot Password Warning","",e,{title:Object(ts.a)("Warning!"),description:i.a.createElement("div",null,Object(ts.a)("Changing your password will reset any end-to-end encryption keys on all of your sessions, making encrypted chat history unreadable. Set up Key Backup or export your room keys from another session before resetting your password.")),button:Object(ts.a)("Continue"),onFinished:e=>{e&&this.submitPasswordReset(this.state.email,this.state.password)}})}else this.showErrorDialog(Object(ts.a)("Please choose a strong password"));else this.showErrorDialog(Object(ts.a)("A new password must be entered."));else this.showErrorDialog(Object(ts.a)("The email address linked to your account must be entered."))}),Fe()(this,"onInputChanged",(e,t)=>{this.setState({[e]:t.target.value})}),Fe()(this,"onLoginClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onLoginClick()}),Xc.a.instance.track("onboarding_forgot_password_begin")}componentDidMount(){this.reset=null,this._checkServerLiveliness(this.props.serverConfig)}UNSAFE_componentWillReceiveProps(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||this._checkServerLiveliness(e.serverConfig)}async _checkServerLiveliness(e){try{await tE.b.validateServerConfigWithStaticUrls(e.hsUrl,e.isUrl),this.setState({serverIsAlive:!0})}catch(e){this.setState(tE.b.authComponentStateForError(e,"forgot_password"))}}submitPasswordReset(e,t){this.setState({phase:2}),this.reset=new EP(this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl),this.reset.resetPassword(e,t).then(()=>{this.setState({phase:3})},e=>{this.showErrorDialog(Object(ts.a)("Failed to send email")+": "+e.message),this.setState({phase:1})})}showErrorDialog(e,t){const a=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Forgot Password Error","",a,{title:t,description:e})}onPasswordValidate(e){this.setState({passwordFieldValid:e.valid})}renderForgot(){const e=On.getComponent("elements.Field");let t=null;const a=this.state.errorText;let n;if(a&&(t=i.a.createElement("div",{className:"mx_Login_error"},a)),!this.state.serverIsAlive){const e=Hn()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});n=i.a.createElement("div",{className:e},this.state.serverDeadError)}return i.a.createElement("div",null,t,n,i.a.createElement(_C,{serverConfig:this.props.serverConfig,onServerConfigChange:this.props.onServerConfigChange}),i.a.createElement("form",{onSubmit:this.onSubmitForm},i.a.createElement("div",{className:"mx_AuthBody_fieldRow"},i.a.createElement(e,{name:"reset_email",type:"text",label:Object(ts.a)("Email"),value:this.state.email,onChange:this.onInputChanged.bind(this,"email"),autoFocus:!0,onFocus:()=>Xc.a.instance.track("onboarding_forgot_password_email_focus"),onBlur:()=>Xc.a.instance.track("onboarding_forgot_password_email_blur")})),i.a.createElement("div",{className:"mx_AuthBody_fieldRow"},i.a.createElement(zC.a,{name:"reset_password",type:"password",label:Object(ts.b)("New Password"),value:this.state.password,minScore:3,onChange:this.onInputChanged.bind(this,"password"),fieldRef:e=>this.password_field=e,onValidate:e=>this.onPasswordValidate(e),onFocus:()=>Xc.a.instance.track("onboarding_forgot_password_newPassword_focus"),onBlur:()=>Xc.a.instance.track("onboarding_forgot_password_newPassword_blur"),autoComplete:"new-password"}),i.a.createElement(e,{name:"reset_password_confirm",type:"password",label:Object(ts.a)("Confirm"),value:this.state.password2,onChange:this.onInputChanged.bind(this,"password2"),onFocus:()=>Xc.a.instance.track("onboarding_forgot_password_newPassword2_focus"),onBlur:()=>Xc.a.instance.track("onboarding_forgot_password_newPassword2_blur"),autoComplete:"new-password"})),i.a.createElement("span",null,Object(ts.a)("A verification email will be sent to your inbox to confirm setting your new password.")),i.a.createElement("input",{className:"mx_Login_submit",type:"submit",value:Object(ts.a)("Send Reset Email")})),i.a.createElement("a",{className:"mx_AuthBody_changeFlow",onClick:this.onLoginClick,href:"#"},Object(ts.a)("Sign in instead")))}renderSendingEmail(){const e=On.getComponent("elements.Spinner");return i.a.createElement(e,null)}renderEmailSent(){return i.a.createElement("div",null,Object(ts.a)("An email has been sent to %(emailAddress)s. Once you've followed the link it contains, click below.",{emailAddress:this.state.email}),i.a.createElement("br",null),i.a.createElement("input",{className:"mx_Login_submit",type:"button",onClick:this.onVerify,value:Object(ts.a)("I have verified my email address")}))}renderDone(){return i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("Your password has been reset.")),i.a.createElement("p",null,Object(ts.a)("You have been logged out of all sessions and will no longer receive push notifications. To re-enable notifications, sign in again on each device.")),i.a.createElement("input",{className:"mx_Login_submit",type:"button",onClick:this.props.onComplete,value:Object(ts.a)("Return to login screen")}))}render(){const e=On.getComponent("auth.AuthHeader"),t=On.getComponent("auth.AuthBody");let a;switch(this.state.phase){case 1:a=this.renderForgot();break;case 2:a=this.renderSendingEmail();break;case 3:a=this.renderEmailSent();break;case 4:a=this.renderDone()}return i.a.createElement(qS,null,i.a.createElement(e,null),i.a.createElement(t,null,i.a.createElement("h2",null," ",Object(ts.a)("Set a new password")," "),a))}},Fe()(SP,"propTypes",{serverConfig:At.a.instanceOf(tE.a).isRequired,onServerConfigChange:At.a.func.isRequired,onLoginClick:At.a.func,onComplete:At.a.func.isRequired}),_P=SP))||_P;var wP;let OP=Object(os.a)("views.auth.AuthBody")(wP=class extends i.a.PureComponent{render(){return i.a.createElement("div",{className:"mx_AuthBody"},this.props.children)}})||wP;var xP;let RP=Object(os.a)("views.auth.AuthFooter")(xP=class extends i.a.Component{render(){return i.a.createElement("div",{className:"mx_AuthFooter"},i.a.createElement("a",{href:"https://matrix.org",target:"_blank",rel:"noreferrer noopener"},Object(ts.a)("powered by Matrix")))}})||xP;var kP,IP;let TP=Object(os.a)("views.auth.AuthHeader")((IP=class extends i.a.Component{render(){On.getComponent("auth.AuthHeaderLogo"),On.getComponent("views.auth.LanguageSelector");return i.a.createElement(i.a.Fragment,null)}},Fe()(IP,"propTypes",{disableLanguageSelector:At.a.bool}),kP=IP))||kP;var PP;let NP=Object(os.a)("views.auth.AuthHeaderLogo")(PP=class extends i.a.PureComponent{render(){return i.a.createElement("div",{className:"mx_AuthHeaderLogo"},"Matrix")}})||PP;var DP,jP=a(8430);function AP(e){Object(ts.d)()!==e&&(ss.b.setValue("language",null,mi.a.DEVICE,e),Rd.a.get().reload())}function MP(e){let{disabled:t}=e;if($c.a.get().disable_login_language_selector)return i.a.createElement("div",null);const a=On.getComponent("views.elements.LanguageDropdown");return i.a.createElement(a,{className:"mx_AuthBody_language",onOptionChange:AP,value:Object(ts.d)(),disabled:t})}Object(ts.b)("Sign in with SSO");let UP=Object(os.a)("views.auth.Welcome")(DP=class extends i.a.PureComponent{constructor(e){super(e),Xc.a.instance.track("onboarding_welcome")}render(){const e=On.getComponent("structures.EmbeddedPage"),t=On.getComponent("auth.LanguageSelector"),a=$c.a.get().embeddedPages;let n=null;return a&&(n=a.welcomeUrl),n||(n="welcome.html"),i.a.createElement(qS,null,i.a.createElement("div",{className:Hn()("mx_Welcome",{mx_WelcomePage_registrationDisabled:!ss.b.getValue(vu.a.Registration)})},i.a.createElement(e,{className:"mx_WelcomePage",url:n,replaceMap:{"$riot:ssoUrl":"#/start_sso","$riot:casUrl":"#/start_cas"}}),i.a.createElement(t,null)))}})||DP;var LP,FP;let BP=Object(os.a)("views.context_menus.StatusMessageContextMenu")((FP=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_onStatusMessageCommitted",()=>{this.setState({message:this.comittedStatusMessage,waiting:!1})}),Fe()(this,"_onClearClick",e=>{Cs.a.get()._unstable_setStatusMessage(""),this.setState({waiting:!0})}),Fe()(this,"_onSubmit",e=>{e.preventDefault(),Cs.a.get()._unstable_setStatusMessage(this.state.message),this.setState({waiting:!0})}),Fe()(this,"_onStatusChange",e=>{this.setState({message:e.target.value})}),this.state={message:this.comittedStatusMessage}}componentDidMount(){const{user:e}=this.props;e&&e.on("User._unstable_statusMessage",this._onStatusMessageCommitted)}componentWillUnmount(){const{user:e}=this.props;e&&e.removeListener("User._unstable_statusMessage",this._onStatusMessageCommitted)}get comittedStatusMessage(){return this.props.user?this.props.user._unstable_statusMessage:""}render(){const e=On.getComponent("views.elements.Spinner");let t;t=this.comittedStatusMessage?this.state.message===this.comittedStatusMessage?i.a.createElement(Fs.a,{className:"mx_StatusMessageContextMenu_clear",onClick:this._onClearClick},i.a.createElement("span",null,Object(ts.a)("Clear status"))):i.a.createElement(Fs.a,{className:"mx_StatusMessageContextMenu_submit",onClick:this._onSubmit},i.a.createElement("span",null,Object(ts.a)("Update status"))):i.a.createElement(Fs.a,{className:"mx_StatusMessageContextMenu_submit",disabled:!this.state.message,onClick:this._onSubmit},i.a.createElement("span",null,Object(ts.a)("Set status")));let a=null;this.state.waiting&&(a=i.a.createElement(e,{w:"24",h:"24"}));const n=i.a.createElement("form",{className:"mx_StatusMessageContextMenu_form",autoComplete:"off",onSubmit:this._onSubmit},i.a.createElement("input",{type:"text",className:"mx_StatusMessageContextMenu_message",key:"message",placeholder:Object(ts.a)("Set a new status..."),autoFocus:!0,maxLength:"60",value:this.state.message,onChange:this._onStatusChange}),i.a.createElement("div",{className:"mx_StatusMessageContextMenu_actionContainer"},t,a));return i.a.createElement("div",{className:"mx_StatusMessageContextMenu"},n)}},Fe()(FP,"propTypes",{user:At.a.object}),LP=FP))||LP;var VP,GP;let zP=Object(os.a)("views.avatars.MemberStatusMessageAvatar")((GP=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_onStatusMessageCommitted",()=>{this.setState({hasStatus:this.hasStatus})}),Fe()(this,"openMenu",()=>{this.setState({menuDisplayed:!0})}),Fe()(this,"closeMenu",()=>{this.setState({menuDisplayed:!1})}),this.state={hasStatus:this.hasStatus,menuDisplayed:!1},this._button=Object(s.createRef)()}componentDidMount(){if(this.props.member.userId!==Cs.a.get().getUserId())throw new Error("Cannot use MemberStatusMessageAvatar on anyone but the logged in user");if(!ss.b.getValue("feature_custom_status"))return;const{user:e}=this.props.member;e&&e.on("User._unstable_statusMessage",this._onStatusMessageCommitted)}componentWillUnmount(){const{user:e}=this.props.member;e&&e.removeListener("User._unstable_statusMessage",this._onStatusMessageCommitted)}get hasStatus(){const{user:e}=this.props.member;return!!e&&!!e._unstable_statusMessage}render(){const e=i.a.createElement(XC.a,{member:this.props.member,width:this.props.width,height:this.props.height,resizeMethod:this.props.resizeMethod});if(!ss.b.getValue("feature_custom_status"))return e;const t=Hn()({mx_MemberStatusMessageAvatar:!0,mx_MemberStatusMessageAvatar_hasStatus:this.state.hasStatus});let a;if(this.state.menuDisplayed){const e=this._button.current.getBoundingClientRect(),t=16,n=1;a=i.a.createElement(Kr.b,{chevronOffset:(e.width-t)/2,chevronFace:"bottom",left:e.left+window.pageXOffset,top:e.top+window.pageYOffset-n,menuWidth:226,onFinished:this.closeMenu},i.a.createElement(BP,{user:this.props.member.user,onFinished:this.closeMenu}))}return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kr.c,{className:t,inputRef:this._button,onClick:this.openMenu,isExpanded:this.state.menuDisplayed,label:Object(ts.a)("User Status")},e),a)}},Fe()(GP,"propTypes",{member:At.a.object.isRequired,width:At.a.number,height:At.a.number,resizeMethod:At.a.string}),Fe()(GP,"defaultProps",{width:40,height:40,resizeMethod:"crop"}),VP=GP))||VP;var WP,HP;let KP=Object(os.a)("views.context_menus.GenericElementContextMenu")((HP=class extends i.a.Component{constructor(e){super(e),this.resize=this.resize.bind(this)}componentDidMount(){this.resize=this.resize.bind(this),window.addEventListener("resize",this.resize)}componentWillUnmount(){window.removeEventListener("resize",this.resize)}resize(){this.props.onResize&&this.props.onResize()}render(){return i.a.createElement("div",null,this.props.element)}},Fe()(HP,"propTypes",{element:At.a.element.isRequired,onResize:At.a.func}),WP=HP))||WP;var qP,YP;let $P=Object(os.a)("views.context_menus.GenericTextContextMenu")((YP=class extends i.a.Component{render(){return i.a.createElement("div",null,this.props.message)}},Fe()(YP,"propTypes",{message:At.a.string.isRequired}),qP=YP))||qP;var JP,QP;let XP=Object(os.a)("views.context_menus.GroupInviteTileContextMenu")((QP=class extends i.a.Component{constructor(e){super(e),this._onClickReject=this._onClickReject.bind(this)}componentDidMount(){this._unmounted=!1}componentWillUnmount(){this._unmounted=!0}_onClickReject(){const e=On.getComponent("dialogs.QuestionDialog");qd.a.createTrackedDialog("Reject community invite","",e,{title:Object(ts.a)("Reject invitation"),description:Object(ts.a)("Are you sure you want to reject the invitation?"),onFinished:async e=>{if(!e)return;const t=On.getComponent("elements.Spinner"),a=qd.a.createDialog(t,null,"mx_Dialog_spinner");try{await dS.a.leaveGroup(this.props.group.groupId)}catch(e){console.error("Error rejecting community invite: ",e);const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Error rejecting invite","",t,{title:Object(ts.a)("Error"),description:Object(ts.a)("Unable to reject invite")})}finally{a.close()}}}),this.props.onFinished&&this.props.onFinished()}render(){return i.a.createElement("div",null,i.a.createElement(Kr.f,{className:"mx_RoomTileContextMenu_leave",onClick:this._onClickReject},i.a.createElement("img",{className:"mx_RoomTileContextMenu_tag_icon",src:a(8431),width:"15",height:"15",alt:""}),Object(ts.a)("Reject")))}},Fe()(QP,"propTypes",{group:At.a.instanceOf(bT.a).isRequired,onFinished:At.a.func}),JP=QP))||JP;var ZP,eN,tN=a(798);let aN=Object(os.a)("views.context_menus.TagTileContextMenu")((eN=class extends i.a.Component{constructor(){super(),this._onViewCommunityClick=this._onViewCommunityClick.bind(this),this._onRemoveClick=this._onRemoveClick.bind(this)}_onViewCommunityClick(){gn.a.dispatch({action:"view_group",group_id:this.props.tag}),this.props.onFinished()}_onRemoveClick(){gn.a.dispatch(yd.removeTag(this.context,this.props.tag)),this.props.onFinished()}render(){return i.a.createElement("div",null,i.a.createElement(Kr.f,{className:"mx_TagTileContextMenu_item mx_TagTileContextMenu_viewCommunity",onClick:this._onViewCommunityClick},Object(ts.a)("View Community")),i.a.createElement("hr",{className:"mx_TagTileContextMenu_separator",role:"separator"}),i.a.createElement(Kr.f,{className:"mx_TagTileContextMenu_item mx_TagTileContextMenu_hideCommunity",onClick:this._onRemoveClick},Object(ts.a)("Hide")))}},Fe()(eN,"propTypes",{tag:At.a.string.isRequired,onFinished:At.a.func.isRequired}),Fe()(eN,"contextType",ns.a),ZP=eN))||ZP;var nN,sN;const iN={"mx-user-id":Object(ts.b)("Matrix ID"),"mx-room-id":Object(ts.b)("Matrix Room ID"),email:Object(ts.b)("email address")};let oN=Object(os.a)("views.dialogs.AddressPickerDialog")((sN=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onButtonClick",()=>{let e=this.state.selectedList.slice();""!==this._textinput.current.value&&(e=this._addAddressesToList([this._textinput.current.value]),null===e)||this.props.onFinished(!0,e)}),Fe()(this,"onCancel",()=>{this.props.onFinished(!1)}),Fe()(this,"onKeyDown",e=>{const t=this._textinput.current?this._textinput.current.value:void 0;e.key===vi.a.ESCAPE?(e.stopPropagation(),e.preventDefault(),this.props.onFinished(!1)):e.key===vi.a.ARROW_UP?(e.stopPropagation(),e.preventDefault(),this.addressSelector&&this.addressSelector.moveSelectionUp()):e.key===vi.a.ARROW_DOWN?(e.stopPropagation(),e.preventDefault(),this.addressSelector&&this.addressSelector.moveSelectionDown()):this.state.suggestedList.length>0&&[vi.a.COMMA,vi.a.ENTER,vi.a.TAB].includes(e.key)?(e.stopPropagation(),e.preventDefault(),this.addressSelector&&this.addressSelector.chooseSelection()):0===t.length&&this.state.selectedList.length&&e.key===vi.a.BACKSPACE?(e.stopPropagation(),e.preventDefault(),this.onDismissed(this.state.selectedList.length-1)()):e.key===vi.a.ENTER?(e.stopPropagation(),e.preventDefault(),""===t?this.onButtonClick():this._addAddressesToList([t])):!t||e.key!==vi.a.COMMA&&e.key!==vi.a.TAB||(e.stopPropagation(),e.preventDefault(),this._addAddressesToList([t]))}),Fe()(this,"onQueryChanged",e=>{const t=e.target.value;this.queryChangedDebouncer&&clearTimeout(this.queryChangedDebouncer),t.length>0&&"@"!==t&&t.length>=2?this.queryChangedDebouncer=setTimeout(()=>{"user"===this.props.pickerType?this.props.groupId?this._doNaiveGroupSearch(t):this.state.serverSupportsUserDirectory?this._doUserDirectorySearch(t):this._doLocalSearch(t):"room"===this.props.pickerType?this.props.groupId?this._doNaiveGroupRoomSearch(t):this._doRoomSearch(t):console.error("Unknown pickerType",this.props.pickerType)},200):this.setState({suggestedList:[],query:"",searchError:null})}),Fe()(this,"onDismissed",e=>()=>{const t=this.state.selectedList.slice();t.splice(e,1),this.setState({selectedList:t,suggestedList:[],query:""}),this._cancelThreepidLookup&&this._cancelThreepidLookup()}),Fe()(this,"onClick",e=>()=>{this.onSelected(e)}),Fe()(this,"onSelected",e=>{const t=this.state.selectedList.slice();t.push(this._getFilteredSuggestions()[e]),this.setState({selectedList:t,suggestedList:[],query:""}),this._cancelThreepidLookup&&this._cancelThreepidLookup()}),Fe()(this,"_onPaste",e=>{e.preventDefault();const t=e.clipboardData.getData("text");this._addAddressesToList(t.split(/[\s,]+/))}),Fe()(this,"onUseDefaultIdentityServerClick",e=>{e.preventDefault(),Object(kx.d)();const{validAddressTypes:t}=this.state;t.push("email"),this.setState({validAddressTypes:t})}),Fe()(this,"onManageSettingsClick",e=>{e.preventDefault(),gn.a.fire(js.a.ViewUserSettings),this.onCancel()}),this._textinput=Object(s.createRef)();let t=this.props.validAddressTypes;!Cs.a.get().getIdentityServerUrl()&&t.includes("email")&&(t=t.filter(e=>"email"!==e)),this.state={invalidAddressError:!1,selectedList:[],busy:!1,searchError:null,serverSupportsUserDirectory:!0,query:"",suggestedList:[],validAddressTypes:t}}componentDidMount(){this.props.focus&&(this._textinput.current.value=this.props.value)}getPlaceholder(){const{placeholder:e}=this.props;return"string"==typeof e?e:e(this.state.validAddressTypes)}_doNaiveGroupSearch(e){const t=e.toLowerCase();this.setState({busy:!0,query:e,searchError:null}),Cs.a.get().getGroupUsers(this.props.groupId).then(a=>{const n=[];a.chunk.forEach(e=>{const a=e.user_id.toLowerCase().includes(t),s=(e.displayname||"").toLowerCase().includes(t);(a||s)&&n.push({user_id:e.user_id,avatar_url:e.avatar_url,display_name:e.displayname})}),this._processResults(n,e)}).catch(e=>{console.error("Error whilst searching group rooms: ",e),this.setState({searchError:e.errcode?e.message:Object(ts.a)("Something went wrong!")})}).then(()=>{this.setState({busy:!1})})}_doNaiveGroupRoomSearch(e){const t=e.toLowerCase(),a=[];dS.a.getGroupRooms(this.props.groupId).forEach(e=>{const n=(e.name||"").toLowerCase().includes(t),s=(e.topic||"").toLowerCase().includes(t),i=(e.canonical_alias||"").toLowerCase().includes(t);(n||s||i)&&a.push({room_id:e.room_id,avatar_url:e.avatar_url,name:e.name||e.canonical_alias})}),this._processResults(a,e),this.setState({busy:!1})}_doRoomSearch(e){const t=e.toLowerCase(),a=Cs.a.get().getRooms(),n=[];a.forEach(e=>{let a=1/0;const s=e.currentState.getStateEvents("m.room.name",""),i=s?s.getContent().name:"",o=e.getCanonicalAlias(),r=e.currentState.getStateEvents("m.room.aliases").map(e=>e.getContent().aliases).reduce((e,t)=>e.concat(t),[]),l=(i||"").toLowerCase().includes(t);let c=!1,d=1/0;if(r.forEach(e=>{(e||"").toLowerCase().includes(t)&&(c=!0,d>e.length&&(d=e.length))}),!l&&!c)return;c&&(a=d);const m=e.currentState.getStateEvents("m.room.avatar",""),u=m?m.getContent().url:void 0;n.push({rank:a,room_id:e.roomId,avatar_url:u,name:i||o||r[0]||Object(ts.a)("Unnamed Room")})});const s=n.sort((e,t)=>e.rank-t.rank);this._processResults(s,e),this.setState({busy:!1})}_doUserDirectorySearch(e){this.setState({busy:!0,query:e,searchError:null}),Cs.a.get().searchUserDirectory({term:e}).then(t=>{this.state.query===e&&this._processResults(t.results,e)}).catch(t=>{console.error("Error whilst searching user directory: ",t),this.setState({searchError:t.errcode?t.message:Object(ts.a)("Something went wrong!")}),"M_UNRECOGNIZED"===t.errcode&&(this.setState({serverSupportsUserDirectory:!1}),this._doLocalSearch(e))}).then(()=>{this.setState({busy:!1})})}_doLocalSearch(e){this.setState({query:e,searchError:null});const t=e.toLowerCase(),a=[];Cs.a.get().getUsers().forEach(e=>{-1===e.userId.toLowerCase().indexOf(t)&&-1===e.displayName.toLowerCase().indexOf(t)||a.push({user_id:e.userId,display_name:e.displayName,avatar_url:e.avatarUrl})}),this._processResults(a,e)}_processResults(e,t){const a=[];e.forEach(e=>{if(e.room_id){const t=Cs.a.get(),n=t.getRoom(e.room_id);if(n){const e=n.currentState.getStateEvents("m.room.tombstone","");if(e&&e.getContent()&&e.getContent().replacement_room){if(t.getRoom(e.getContent().replacement_room))return}}a.push({addressType:"mx-room-id",address:e.room_id,displayName:e.name,avatarMxc:e.avatar_url,isKnown:!0})}else(this.props.includeSelf||e.user_id!==Cs.a.get().credentials.userId)&&a.push({addressType:"mx-user-id",address:e.user_id,displayName:e.display_name,avatarMxc:e.avatar_url,isKnown:!0})});const n=Object(xx.c)(t);if(this.state.validAddressTypes.includes(n)){if("email"===n&&!YS.a(t))return void this.setState({searchError:Object(ts.a)("That doesn't look like a valid email address")});a.unshift({addressType:n,address:t,isKnown:!1}),this._cancelThreepidLookup&&this._cancelThreepidLookup(),"email"===n&&this._lookupThreepid(n,t)}this.setState({suggestedList:a,invalidAddressError:!1},()=>{this.addressSelector&&this.addressSelector.moveSelectionTop()})}_addAddressesToList(e){const t=this.state.selectedList.slice();let a=!1;return e.forEach(e=>{e=e.trim();const n=Object(xx.c)(e),s={addressType:n,address:e,isKnown:!1};if(this.state.validAddressTypes.includes(n)){if("mx-user-id"===n){const e=Cs.a.get().getUser(s.address);e&&(s.displayName=e.displayName,s.avatarMxc=e.avatarUrl,s.isKnown=!0)}else if("mx-room-id"===n){const e=Cs.a.get().getRoom(s.address);e&&(s.displayName=e.name,s.avatarMxc=e.avatarUrl,s.isKnown=!0)}}else a=!0;t.push(s)}),this.setState({selectedList:t,suggestedList:[],query:"",invalidAddressError:!!a||this.state.invalidAddressError}),this._cancelThreepidLookup&&this._cancelThreepidLookup(),a?null:t}async _lookupThreepid(e,t){let a=!1;if(this._cancelThreepidLookup=function(){a=!0},await Object(oE.c)(500),a)return null;try{const n=new SI.a,s=await n.getAccessToken();if(a)return null;const i=await Cs.a.get().lookupThreePid(e,t,void 0,s);if(a||null===i||!i.mxid)return null;const o=await Cs.a.get().getProfileInfo(i.mxid);if(a||null===o)return null;this.setState({suggestedList:[{addressType:e,address:t,displayName:o.displayname,avatarMxc:o.avatar_url,isKnown:!0}]})}catch(e){console.error(e),this.setState({searchError:Object(ts.a)("Something went wrong!")})}}_getFilteredSuggestions(){const e={};return this.state.selectedList.forEach(t=>{let{address:a,addressType:n}=t;e[n]||(e[n]=new Set),e[n].add(a)}),this.state.suggestedList.filter(t=>{let{address:a,addressType:n}=t;return!(e[n]&&e[n].has(a))})}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons"),a=On.getComponent("elements.AddressSelector");let n;this.scrollElement=null,this.props.description&&(n=i.a.createElement("div",{className:"mx_AddressPickerDialog_label"},i.a.createElement("label",{htmlFor:"textinput"},this.props.description)));const s=[];if(this.state.selectedList.length>0){const e=On.getComponent("elements.AddressTile");for(let t=0;t<this.state.selectedList.length;t++)s.push(i.a.createElement(e,{key:t,address:this.state.selectedList[t],canDismiss:!0,onDismissed:this.onDismissed(t),showAddress:"user"===this.props.pickerType}))}s.push(i.a.createElement("textarea",{key:this.state.selectedList.length,onPaste:this._onPaste,rows:"1",id:"textinput",ref:this._textinput,className:"mx_AddressPickerDialog_input",onChange:this.onQueryChanged,placeholder:this.getPlaceholder(),defaultValue:this.props.value,autoFocus:this.props.focus}));const o=this._getFilteredSuggestions();let r,l,c;if(this.state.invalidAddressError){const e=this.state.validAddressTypes.map(e=>Object(ts.a)(iN[e]));r=i.a.createElement("div",{className:"mx_AddressPickerDialog_error"},Object(ts.a)("You have entered an invalid address."),i.a.createElement("br",null),Object(ts.a)("Try using one of the following valid address types: %(validTypesList)s.",{validTypesList:e.join(", ")}))}else this.state.searchError?r=i.a.createElement("div",{className:"mx_AddressPickerDialog_error"},this.state.searchError):this.state.query.length>0&&0===o.length&&!this.state.busy?r=i.a.createElement("div",{className:"mx_AddressPickerDialog_error"},Object(ts.a)("No results")):l=i.a.createElement(a,{ref:e=>{this.addressSelector=e},addressList:o,showAddress:"user"===this.props.pickerType,onSelected:this.onSelected,truncateAt:40});if("user"===this.props.pickerType&&!this.state.validAddressTypes.includes("email")&&this.props.validAddressTypes.includes("email")){const e=Object(kx.c)();c=e?i.a.createElement("div",{className:"mx_AddressPickerDialog_identityServer"},Object(ts.a)("Use an identity server to invite by email. <default>Use the default (%(defaultIdentityServerName)s)</default> or manage in <settings>Settings</settings>.",{defaultIdentityServerName:Object(Rx.a)(e)},{default:e=>i.a.createElement("a",{href:"#",onClick:this.onUseDefaultIdentityServerClick},e),settings:e=>i.a.createElement("a",{href:"#",onClick:this.onManageSettingsClick},e)})):i.a.createElement("div",{className:"mx_AddressPickerDialog_identityServer"},Object(ts.a)("Use an identity server to invite by email. Manage in <settings>Settings</settings>.",{},{settings:e=>i.a.createElement("a",{href:"#",onClick:this.onManageSettingsClick},e)}))}return i.a.createElement(e,{className:"mx_AddressPickerDialog",onKeyDown:this.onKeyDown,onFinished:this.props.onFinished,title:this.props.title},n,i.a.createElement("div",{className:"mx_Dialog_content"},i.a.createElement("div",{className:"mx_AddressPickerDialog_inputContainer"},s),r,l,this.props.extraNode,c),i.a.createElement(t,{primaryButton:this.props.button,onPrimaryButtonClick:this.onButtonClick,onCancel:this.onCancel}))}},Fe()(sN,"propTypes",{title:At.a.string.isRequired,description:At.a.node,extraNode:At.a.node,value:At.a.string,placeholder:At.a.oneOfType([At.a.string,At.a.func]),roomId:At.a.string,button:At.a.string,focus:At.a.bool,validAddressTypes:At.a.arrayOf(At.a.oneOf(xx.b)),onFinished:At.a.func.isRequired,groupId:At.a.string,pickerType:At.a.oneOf(["user","room"]),includeSelf:At.a.bool}),Fe()(sN,"defaultProps",{value:"",focus:!0,validAddressTypes:xx.b,pickerType:"user",includeSelf:!1}),nN=sN))||nN;var rN,lN;let cN=Object(os.a)("views.dialogs.AskInviteAnywayDialog")((lN=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_onInviteClicked",()=>{this.props.onInviteAnyways(),this.props.onFinished(!0)}),Fe()(this,"_onInviteNeverWarnClicked",()=>{ss.b.setValue("promptBeforeInviteUnknownUsers",null,mi.a.ACCOUNT,!1),this.props.onInviteAnyways(),this.props.onFinished(!0)}),Fe()(this,"_onGiveUpClicked",()=>{this.props.onGiveUp(),this.props.onFinished(!1)})}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=this.props.unknownProfileUsers.map(e=>i.a.createElement("li",{key:e.userId},e.userId,": ",e.errorText));return i.a.createElement(e,{className:"mx_RetryInvitesDialog",onFinished:this._onGiveUpClicked,title:Object(ts.a)("The following users may not exist"),contentId:"mx_Dialog_content"},i.a.createElement("div",{id:"mx_Dialog_content"},i.a.createElement("p",null,Object(ts.a)("Unable to find profiles for the Matrix IDs listed below - would you like to invite them anyway?")),i.a.createElement("ul",null,t)),i.a.createElement("div",{className:"mx_Dialog_buttons"},i.a.createElement("button",{onClick:this._onGiveUpClicked},Object(ts.a)("Close")),i.a.createElement("button",{onClick:this._onInviteNeverWarnClicked},Object(ts.a)("Invite anyway and never warn me again")),i.a.createElement("button",{onClick:this._onInviteClicked,autoFocus:!0},Object(ts.a)("Invite anyway"))))}},Fe()(lN,"propTypes",{unknownProfileUsers:At.a.array.isRequired,onInviteAnyways:At.a.func.isRequired,onGiveUp:At.a.func.isRequired,onFinished:At.a.func.isRequired}),rN=lN))||rN;var dN,mN=a(1387);let uN=Object(os.a)("views.dialogs.ConfirmAndWaitRedactDialog")(dN=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"onParentFinished",async e=>{if(e){this.setState({isRedacting:!0});try{await this.props.redact(),this.props.onFinished(!0)}catch(e){const t=e.errcode||e.statusCode;void 0!==t?this.setState({redactionErrorCode:t}):this.props.onFinished(!0)}}else this.props.onFinished(!1)}),this.state={isRedacting:!1,redactionErrorCode:null}}render(){if(this.state.isRedacting){if(this.state.redactionErrorCode){const e=On.getComponent("dialogs.ErrorDialog"),t=this.state.redactionErrorCode;return i.a.createElement(e,{onFinished:this.props.onFinished,title:Object(ts.a)("Error"),description:Object(ts.a)("You cannot delete this message. (%(code)s)",{code:t})})}{const e=On.getComponent("dialogs.BaseDialog"),t=On.getComponent("elements.Spinner");return i.a.createElement(e,{onFinished:this.props.onFinished,hasCancel:!1,title:Object(ts.a)("Removing…")},i.a.createElement(t,null))}}{const e=On.getComponent("dialogs.ConfirmRedactDialog");return i.a.createElement(e,{onFinished:this.onParentFinished})}}})||dN;var hN;let pN=Object(os.a)("views.dialogs.ConfirmRedactDialog")(hN=class extends i.a.Component{render(){const e=On.getComponent("views.dialogs.TextInputDialog");return i.a.createElement(e,{onFinished:this.props.onFinished,title:Object(ts.a)("Confirm Removal"),description:Object(ts.a)("Are you sure you wish to remove (delete) this event? Note that if you delete a room name or topic change, it could undo the change."),placeholder:Object(ts.a)("Reason (optional)"),focus:!0,button:Object(ts.a)("Remove")})}})||hN;var gN,fN,vN=a(1414);let bN=Object(os.a)("views.dialogs.ConfirmWipeDeviceDialog")((fN=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_onConfirm",()=>{this.props.onFinished(!0)}),Fe()(this,"_onDecline",()=>{this.props.onFinished(!1)})}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons");return i.a.createElement(e,{className:"mx_ConfirmWipeDeviceDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(ts.a)("Clear all data in this session?")},i.a.createElement("div",{className:"mx_ConfirmWipeDeviceDialog_content"},i.a.createElement("p",null,Object(ts.a)("Clearing all data from this session is permanent. Encrypted messages will be lost unless their keys have been backed up."))),i.a.createElement(t,{primaryButton:Object(ts.a)("Clear all data"),onPrimaryButtonClick:this._onConfirm,primaryButtonClass:"danger",cancelButton:Object(ts.a)("Cancel"),onCancel:this._onDecline}))}},Fe()(fN,"propTypes",{onFinished:At.a.func.isRequired}),gN=fN))||gN;var yN,EN;let _N=Object(os.a)("views.dialogs.CreateGroupDialog")((EN=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{groupName:"",groupId:"",groupError:null,creating:!1,createError:null}),Fe()(this,"_onGroupNameChange",e=>{this.setState({groupName:e.target.value})}),Fe()(this,"_onGroupIdChange",e=>{this.setState({groupId:e.target.value})}),Fe()(this,"_onGroupIdBlur",e=>{this._checkGroupId()}),Fe()(this,"_onFormSubmit",e=>{if(e.preventDefault(),this._checkGroupId())return;const t={};""!==this.state.groupName&&(t.name=this.state.groupName),this.setState({creating:!0}),Cs.a.get().createGroup({localpart:this.state.groupId,profile:t}).then(e=>{gn.a.dispatch({action:"view_group",group_id:e.group_id,group_is_new:!0}),this.props.onFinished(!0)}).catch(e=>{this.setState({createError:e})}).finally(()=>{this.setState({creating:!1})})}),Fe()(this,"_onCancel",()=>{this.props.onFinished(!1)})}_checkGroupId(e){let t=null;return this.state.groupId?/^[a-z0-9=_\-./]*$/.test(this.state.groupId)||(t=Object(ts.a)("Community IDs may only contain characters a-z, 0-9, or '=_-./'")):t=Object(ts.a)("Community IDs cannot be empty."),this.setState({groupIdError:t,createError:null}),t}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("elements.Spinner");if(this.state.creating)return i.a.createElement(t,null);let a;return this.state.createError&&(a=i.a.createElement("div",{className:"error",role:"alert"},i.a.createElement("div",null,Object(ts.a)("Something went wrong whilst creating your community")),i.a.createElement("div",null,this.state.createError.message))),i.a.createElement(e,{className:"mx_CreateGroupDialog",onFinished:this.props.onFinished,title:Object(ts.a)("Create Community")},i.a.createElement("form",{onSubmit:this._onFormSubmit},i.a.createElement("div",{className:"mx_Dialog_content"},i.a.createElement("div",{className:"mx_CreateGroupDialog_inputRow"},i.a.createElement("div",{className:"mx_CreateGroupDialog_label"},i.a.createElement("label",{htmlFor:"groupname"},Object(ts.a)("Community Name"))),i.a.createElement("div",null,i.a.createElement("input",{id:"groupname",className:"mx_CreateGroupDialog_input",autoFocus:!0,size:"64",placeholder:Object(ts.a)("Example"),onChange:this._onGroupNameChange,value:this.state.groupName}))),i.a.createElement("div",{className:"mx_CreateGroupDialog_inputRow"},i.a.createElement("div",{className:"mx_CreateGroupDialog_label"},i.a.createElement("label",{htmlFor:"groupid"},Object(ts.a)("Community ID"))),i.a.createElement("div",{className:"mx_CreateGroupDialog_input_group"},i.a.createElement("span",{className:"mx_CreateGroupDialog_prefix"},"+"),i.a.createElement("input",{id:"groupid",className:"mx_CreateGroupDialog_input mx_CreateGroupDialog_input_hasPrefixAndSuffix",size:"32",placeholder:Object(ts.a)("example"),onChange:this._onGroupIdChange,onBlur:this._onGroupIdBlur,value:this.state.groupId}),i.a.createElement("span",{className:"mx_CreateGroupDialog_suffix"},":",Cs.a.get().getDomain()))),i.a.createElement("div",{className:"error"},this.state.groupIdError),a),i.a.createElement("div",{className:"mx_Dialog_buttons"},i.a.createElement("input",{type:"submit",value:Object(ts.a)("Create"),className:"mx_Dialog_primary"}),i.a.createElement("button",{onClick:this._onCancel},Object(ts.a)("Cancel")))))}},Fe()(EN,"propTypes",{onFinished:At.a.func.isRequired}),yN=EN))||yN;var SN,CN,wN=e=>{const t=$c.a.get().brand,a=Object(ts.a)("You've previously used a newer version of %(brand)s with this session. To use this version again with end to end encryption, you will need to sign out and back in again.",{brand:t}),n=On.getComponent("views.dialogs.BaseDialog"),s=On.getComponent("views.elements.DialogButtons");return i.a.createElement(n,{className:"mx_CryptoStoreTooNewDialog",contentId:"mx_Dialog_content",title:Object(ts.a)("Incompatible Database"),hasCancel:!1,onFinished:e.onFinished},i.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},a),i.a.createElement(s,{primaryButton:Object(ts.a)("Continue With Encryption Disabled"),hasCancel:!1,onPrimaryButtonClick:e.onFinished},i.a.createElement("button",{onClick:()=>{const a=On.getComponent("dialogs.QuestionDialog");qd.a.createTrackedDialog("Logout e2e db too new","",a,{title:Object(ts.a)("Sign out"),description:Object(ts.a)("To avoid losing your chat history, you must export your room keys before logging out. You will need to go back to the newer version of %(brand)s to do this",{brand:t}),button:Object(ts.a)("Sign out"),focus:!1,onFinished:t=>{t&&(gn.a.dispatch({action:"logout"}),e.onFinished())}})}},Object(ts.a)("Sign out"))))},ON=a(1375);let xN=Object(os.a)("views.dialogs.IncomingSasDialog")((CN=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_onFinished",()=>{this.props.onFinished(3===this.state.phase)}),Fe()(this,"_onCancelClick",()=>{this.props.onFinished(3===this.state.phase)}),Fe()(this,"_onContinueClick",()=>{this.setState({phase:2}),this.props.verifier.verify().then(()=>{this.setState({phase:3})}).catch(e=>{console.log("Verification failed",e)})}),Fe()(this,"_onVerifierShowSas",e=>{this._showSasEvent=e,this.setState({phase:1,sas:e.sas})}),Fe()(this,"_onVerifierCancel",e=>{this.setState({phase:4})}),Fe()(this,"_onSasMatchesClick",()=>{this._showSasEvent.confirm(),this.setState({phase:2})}),Fe()(this,"_onVerifiedDoneClick",()=>{this.props.onFinished(!0)});let t=0;this.props.verifier.cancelled&&(console.log("Verifier was cancelled in the background."),t=4),this._showSasEvent=null,this.state={phase:t,sasVerified:!1,opponentProfile:null,opponentProfileError:null},this.props.verifier.on("show_sas",this._onVerifierShowSas),this.props.verifier.on("cancel",this._onVerifierCancel),this._fetchOpponentProfile()}componentWillUnmount(){4!==this.state.phase&&3!==this.state.phase&&this.props.verifier.cancel("User cancel"),this.props.verifier.removeListener("show_sas",this._onVerifierShowSas)}async _fetchOpponentProfile(){try{const e=await Cs.a.get().getProfileInfo(this.props.verifier.userId);this.setState({opponentProfile:e})}catch(e){this.setState({opponentProfileError:e})}}_renderPhaseStart(){const e=On.getComponent("views.elements.DialogButtons"),t=On.getComponent("views.elements.Spinner"),a=On.getComponent("avatars.BaseAvatar"),n=this.props.verifier.userId===Cs.a.get().getUserId();let s;const o=this.state.opponentProfile;if(o){const e=o.avatar_url?Object(Os.b)(o.avatar_url).getSquareThumbnailHttp(48):null;s=i.a.createElement("div",{className:"mx_IncomingSasDialog_opponentProfile"},i.a.createElement(a,{name:o.displayname,idName:this.props.verifier.userId,url:e,width:48,height:48,resizeMethod:"crop"}),i.a.createElement("h2",null,o.displayname))}else s=this.state.opponentProfileError?i.a.createElement("div",null,i.a.createElement(a,{name:this.props.verifier.userId.slice(1),idName:this.props.verifier.userId,width:48,height:48}),i.a.createElement("h2",null,this.props.verifier.userId)):i.a.createElement(t,null);const r=[i.a.createElement("p",{key:"p1"},Object(ts.a)("Verify this user to mark them as trusted. Trusting users gives you extra peace of mind when using end-to-end encrypted messages.")),i.a.createElement("p",{key:"p2"},Object(ts.a)("Verifying this user will mark their session as trusted, and also mark your session as trusted to them."))],l=[i.a.createElement("p",{key:"p1"},Object(ts.a)("Verify this device to mark it as trusted. Trusting this device gives you and other users extra peace of mind when using end-to-end encrypted messages.")),i.a.createElement("p",{key:"p2"},Object(ts.a)("Verifying this device will mark it as trusted, and users who have verified with you will trust this device."))];return i.a.createElement("div",null,s,n?l:r,i.a.createElement(e,{primaryButton:Object(ts.a)("Continue"),hasCancel:!0,onPrimaryButtonClick:this._onContinueClick,onCancel:this._onCancelClick}))}_renderPhaseShowSas(){const e=On.getComponent("views.verification.VerificationShowSas");return i.a.createElement(e,{sas:this._showSasEvent.sas,onCancel:this._onCancelClick,onDone:this._onSasMatchesClick,isSelf:this.props.verifier.userId===Cs.a.get().getUserId(),inDialog:!0})}_renderPhaseWaitForPartnerToConfirm(){const e=On.getComponent("views.elements.Spinner");return i.a.createElement("div",null,i.a.createElement(e,null),i.a.createElement("p",null,Object(ts.a)("Waiting for partner to confirm...")))}_renderPhaseVerified(){const e=On.getComponent("views.verification.VerificationComplete");return i.a.createElement(e,{onDone:this._onVerifiedDoneClick})}_renderPhaseCancelled(){const e=On.getComponent("views.verification.VerificationCancelled");return i.a.createElement(e,{onDone:this._onCancelClick})}render(){let e;switch(this.state.phase){case 0:e=this._renderPhaseStart();break;case 1:e=this._renderPhaseShowSas();break;case 2:e=this._renderPhaseWaitForPartnerToConfirm();break;case 3:e=this._renderPhaseVerified();break;case 4:e=this._renderPhaseCancelled()}const t=On.getComponent("dialogs.BaseDialog");return i.a.createElement(t,{title:Object(ts.a)("Incoming Verification Request"),onFinished:this._onFinished,fixedWidth:!1},e)}},Fe()(CN,"propTypes",{verifier:At.a.object.isRequired}),SN=CN))||SN;var RN=a(1306),kN=a(1303);function IN(e){let{failures:t,source:a,continuation:n,onFinished:o}=e;const r=On.getComponent("dialogs.BaseDialog"),l=On.getComponent("views.elements.DialogButtons"),c=On.getComponent("elements.Spinner"),[d,m]=Object(s.useState)(2),[u,h]=Object(s.useState)(!1),[p,g]=Object(s.useState)(!1),[f,v]=Object(s.useState)(!1),b=Object(s.useRef)(o),y=new Map([["_afterCrossSigningLocalKeyChange",Object(ts.a)("a new master key signature")],["checkOwnCrossSigningTrust",Object(ts.a)("a new cross-signing key signature")],["setDeviceVerification",Object(ts.a)("a device cross-signing signature")]]),E=Object(ts.a)("a key signature"),_=Object(s.useCallback)(async()=>{try{g(!0);const e=new Promise((e,t)=>{b.current=t}).finally(()=>{h(!0)});await Promise.race([n(),e]),v(!0)}catch(e){m(e=>e-1)}finally{b.current=o,g(!1)}},[n,o]);let S;if(!f&&!u&&n&&d>0){const e=y.get(a)||E,n=$c.a.get().brand;S=i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("%(brand)s encountered an error during upload of:",{brand:n})),i.a.createElement("p",null,e),p&&i.a.createElement(c,null),i.a.createElement("pre",null,JSON.stringify(t,null,2)),i.a.createElement(l,{primaryButton:"Retry",hasCancel:!0,onPrimaryButtonClick:_,onCancel:b.current,primaryDisabled:p}))}else S=i.a.createElement("div",null,f?i.a.createElement("span",null,Object(ts.a)("Upload completed")):u?i.a.createElement("span",null,Object(ts.a)("Cancelled signature upload")):i.a.createElement("span",null,Object(ts.a)("Unable to upload")),i.a.createElement(l,{primaryButton:Object(ts.a)("OK"),hasCancel:!1,onPrimaryButtonClick:o}));return i.a.createElement(r,{title:f?Object(ts.a)("Signature upload success"):Object(ts.a)("Signature upload failed"),fixedWidth:!1,onFinished:()=>{}},S)}var TN,PN,NN=e=>{const t=$c.a.get().brand,a=Object(ts.a)("You've previously used %(brand)s on %(host)s with lazy loading of members enabled. In this version lazy loading is disabled. As the local cache is not compatible between these two settings, %(brand)s needs to resync your account.",{brand:t,host:e.host}),n=Object(ts.a)("If the other version of %(brand)s is still open in another tab, please close it as using %(brand)s on the same host with both lazy loading enabled and disabled simultaneously will cause issues.",{brand:t});return i.a.createElement($d.a,{hasCancelButton:!1,title:Object(ts.a)("Incompatible local cache"),description:i.a.createElement("div",null,i.a.createElement("p",null,a),i.a.createElement("p",null,n)),button:Object(ts.a)("Clear cache and resync"),onFinished:e.onFinished})},DN=e=>{const t=$c.a.get().brand,a=Object(ts.a)("%(brand)s now uses 3-5x less memory, by only loading information about other users when needed. Please wait whilst we resynchronise with the server!",{brand:t});return i.a.createElement($d.a,{hasCancelButton:!1,title:Object(ts.a)("Updating %(brand)s",{brand:t}),description:i.a.createElement("div",null,a),button:Object(ts.a)("OK"),onFinished:e.onFinished})};let jN=Object(os.a)("views.dialogs.ManualDeviceKeyVerificationDialog")((PN=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_onCancelClick",()=>{this.props.onFinished(!1)}),Fe()(this,"_onLegacyFinished",e=>{e&&Cs.a.get().setDeviceVerified(this.props.userId,this.props.device.deviceId,!0),this.props.onFinished(e)})}render(){const e=On.getComponent("dialogs.QuestionDialog");let t;t=Cs.a.get().getUserId()===this.props.userId?Object(ts.a)("Confirm by comparing the following with the User Settings in your other session:"):Object(ts.a)("Confirm this user's session by comparing the following with their User Settings:");const a=hs.e(this.props.device.getFingerprint()),n=i.a.createElement("div",null,i.a.createElement("p",null,t),i.a.createElement("div",{className:"mx_DeviceVerifyDialog_cryptoSection"},i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("label",null,Object(ts.a)("Session name"),":")," ",i.a.createElement("span",null,this.props.device.getDisplayName())),i.a.createElement("li",null,i.a.createElement("label",null,Object(ts.a)("Session ID"),":")," ",i.a.createElement("span",null,i.a.createElement("code",null,this.props.device.deviceId))),i.a.createElement("li",null,i.a.createElement("label",null,Object(ts.a)("Session key"),":")," ",i.a.createElement("span",null,i.a.createElement("code",null,i.a.createElement("b",null,a)))))),i.a.createElement("p",null,Object(ts.a)("If they don't match, the security of your communication may be compromised.")));return i.a.createElement(e,{title:Object(ts.a)("Verify session"),description:n,button:Object(ts.a)("Verify session"),onFinished:this._onLegacyFinished})}},Fe()(PN,"propTypes",{userId:At.a.string.isRequired,device:At.a.object.isRequired,onFinished:At.a.func.isRequired}),TN=PN))||TN;var AN,MN;let UN=Object(os.a)("views.dialogs.MessageEditHistoryDialog")((MN=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"loadMoreEdits",async e=>{if(e||!this.state.nextBatch&&!this.state.isLoading)return!1;const t={from:this.state.nextBatch},a=this.props.mxEvent.getRoomId(),n=this.props.mxEvent.getId(),s=Cs.a.get();let i,o,r;const l=new Promise((e,t)=>{o=e,r=t});try{i=await s.relations(a,n,"m.replace","m.room.message",t)}catch(e){return e.errcode&&console.error("fetching /relations failed with error",e),this.setState({error:e},()=>r(e)),l}const c=i.events;return this._locallyRedactEventsIfNeeded(c),this.setState({originalEvent:this.state.originalEvent||i.originalEvent,events:this.state.events.concat(c),nextBatch:i.nextBatch,isLoading:!1},()=>{const e=!!this.state.nextBatch;o(e)}),l}),this.state={originalEvent:null,error:null,events:[],nextBatch:null,isLoading:!0,isTwelveHour:ss.b.getValue("showTwelveHourTimestamps")}}_locallyRedactEventsIfNeeded(e){const t=this.props.mxEvent.getRoomId(),a=Cs.a.get().getRoom(t).getPendingEvents();for(const t of e){const e=a.find(e=>"m.room.redaction"===e.getType()&&e.getAssociatedId()===t.getId());e&&t.markLocallyRedacted(e)}}componentDidMount(){this.loadMoreEdits()}_renderEdits(){const e=On.getComponent("messages.EditHistoryMessage"),t=On.getComponent("messages.DateSeparator"),a=[];let n,s=this.state.events;this.state.originalEvent&&!this.state.nextBatch&&(s=s.concat(this.state.originalEvent));const o=this.props.mxEvent.getId();return s.forEach((r,l)=>{n&&!Object(AT.f)(n.getDate(),r.getDate())||a.push(i.a.createElement("li",{key:r.getTs()+"~"},i.a.createElement(t,{ts:r.getTs()})));const c=r.getId()===o;a.push(i.a.createElement(e,{key:r.getId(),previousEdit:c?null:s[l+1],isBaseEvent:c,mxEvent:r,isTwelveHour:this.state.isTwelveHour})),n=r}),a}render(){let e;if(this.state.error){const{error:t}=this.state;e="M_UNRECOGNIZED"===t.errcode?i.a.createElement("p",{className:"mx_MessageEditHistoryDialog_error"},Object(ts.a)("Your homeserver doesn't seem to support this feature.")):t.errcode?i.a.createElement("p",{className:"mx_MessageEditHistoryDialog_error"},Object(ts.a)("Something went wrong!")):i.a.createElement("p",{className:"mx_MessageEditHistoryDialog_error"},Object(ts.a)("Cannot reach homeserver"),i.a.createElement("br",null),Object(ts.a)("Ensure you have a stable internet connection, or get in touch with the server admin"))}else if(this.state.isLoading){const t=On.getComponent("elements.Spinner");e=i.a.createElement(t,null)}else{const t=On.getComponent("structures.ScrollPanel");e=i.a.createElement(t,{className:"mx_MessageEditHistoryDialog_scrollPanel",onFillRequest:this.loadMoreEdits,stickyBottom:!1,startAtBottom:!1},i.a.createElement("ul",{className:"mx_MessageEditHistoryDialog_edits mx_MessagePanel_alwaysShowTimestamps"},this._renderEdits()))}const t=On.getComponent("views.dialogs.BaseDialog");return i.a.createElement(t,{className:"mx_MessageEditHistoryDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(ts.a)("Message edits")},e)}},Fe()(MN,"propTypes",{mxEvent:At.a.object.isRequired}),AN=MN))||AN;var LN,FN,BN=a(820);let VN=Object(os.a)("views.dialogs.NewSessionReviewDialog")((FN=class extends i.a.PureComponent{constructor(){super(...arguments),Fe()(this,"onCancelClick",()=>{const e=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Verification failed","insecure",e,{headerImage:a(813),title:Object(ts.a)("Your account is not secure"),description:i.a.createElement("div",null,Object(ts.a)("One of the following may be compromised:"),i.a.createElement("ul",null,i.a.createElement("li",null,Object(ts.a)("Your password")),i.a.createElement("li",null,Object(ts.a)("Your homeserver")),i.a.createElement("li",null,Object(ts.a)("This session, or the other session")),i.a.createElement("li",null,Object(ts.a)("The internet connection either session is using"))),i.a.createElement("div",null,Object(ts.a)("We recommend you change your password and Security Key in Settings immediately"))),onFinished:()=>this.props.onFinished(!1)})}),Fe()(this,"onContinueClick",()=>{const{userId:e,device:t}=this.props,a=Cs.a.get(),n=a.requestVerification(e,[t.deviceId]);this.props.onFinished(!0),qd.a.createTrackedDialog("New Session Verification","Starting dialog",BN.a,{verificationRequestPromise:n,member:a.getUser(e),onFinished:async()=>{(await n).cancel()}})})}render(){const{device:e}=this.props,t=i.a.createElement("span",{className:"mx_NewSessionReviewDialog_headerIcon mx_E2EIcon_warning"}),a=Object(ts.a)("New session"),n=i.a.createElement("h2",{className:"mx_NewSessionReviewDialog_header"},t,a);return i.a.createElement(hu.a,{title:n,onFinished:this.props.onFinished},i.a.createElement("div",{className:"mx_NewSessionReviewDialog_body"},i.a.createElement("p",null,Object(ts.a)("Use this session to verify your new one, granting it access to encrypted messages:")),i.a.createElement("div",{className:"mx_NewSessionReviewDialog_deviceInfo"},i.a.createElement("div",null,i.a.createElement("span",{className:"mx_NewSessionReviewDialog_deviceName"},e.getDisplayName())," ",i.a.createElement("span",{className:"mx_NewSessionReviewDialog_deviceID"},"(",e.deviceId,")"))),i.a.createElement("p",null,Object(ts.a)("If you didn’t sign in to this session, your account may be compromised.")),i.a.createElement(WC.a,{cancelButton:Object(ts.a)("This wasn't me"),cancelButtonClass:"danger",primaryButton:Object(ts.a)("Continue"),onCancel:this.onCancelClick,onPrimaryButtonClick:this.onContinueClick})))}},Fe()(FN,"propTypes",{userId:At.a.string.isRequired,device:At.a.object.isRequired,onFinished:At.a.func.isRequired}),LN=FN))||LN;var GN=a(8432);const zN=["sub","sup","del","u"],WN=["text","softbreak","linebreak","paragraph","document"];function HN(e){if(null!=e.literal&&null!=e.literal.match('^<((div|span) data-mx-maths="[^"]*"|/(div|span))>$'))return!0;const t=/^<\/?(.*)>$/.exec(e.literal);if(t&&2==t.length){const e=t[1];return zN.indexOf(e)>-1}return!1}function KN(e){HN(e)?this.lit(e.literal):this.lit(Object(dC.escape)(e.literal))}function qN(e){let t=e;for(;t.parent;)t=t.parent;return t.firstChild!=t.lastChild}class YN{constructor(e){this.input=e;const t=new GN.Parser;this.parsed=t.parse(this.input)}isPlainText(){const e=this.parsed.walker();let t;for(;t=e.next();){const e=t.node;if(!(WN.indexOf(e.type)>-1)){if("html_inline"!=e.type&&"html_block"!=e.type)return!1;if(HN(e))return!1}}return!0}toHTML(){let{externalLinks:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new GN.HtmlRenderer({safe:!1,softbreak:"<br />"}),a=t.paragraph;return t.paragraph=function(e,t){qN(e)&&a.call(this,e,t)},t.link=function(t,a){const n=this.attrs(t);a?(n.push(["href",this.esc(t.destination)]),t.title&&n.push(["title",this.esc(t.title)]),e&&(n.push(["target","_blank"]),n.push(["rel","noreferrer noopener"])),this.tag("a",n)):this.tag("/a")},t.html_inline=KN,t.html_block=function(e){KN.call(this,e)},t.render(this.parsed)}toPlaintext(){const e=new GN.HtmlRenderer({safe:!1});e.paragraph;return e.paragraph=function(e,t){qN(e)&&!t&&e.next&&this.lit("\n\n")},e.html_block=function(e){this.lit(e.literal),qN(e)&&e.next&&this.lit("\n\n")},e.render(this.parsed)}}var $N,JN;let QN=Object(os.a)("views.dialogs.ReportEventDialog")((JN=class extends s.PureComponent{constructor(e){super(e),Fe()(this,"_onReasonChange",e=>{let{target:{value:t}}=e;this.setState({reason:t})}),Fe()(this,"_onCancel",()=>{this.props.onFinished(!1)}),Fe()(this,"_onSubmit",async()=>{if(this.state.reason&&this.state.reason.trim()){this.setState({busy:!0,err:null});try{const e=this.props.mxEvent;await Cs.a.get().reportEvent(e.getRoomId(),e.getId(),-100,this.state.reason.trim()),this.props.onFinished(!0)}catch(e){this.setState({busy:!1,err:e.message})}}else this.setState({err:Object(ts.a)("Please fill why you're reporting.")})}),this.state={reason:"",busy:!1,err:null}}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons"),a=On.getComponent("elements.Spinner"),n=On.getComponent("elements.Field");let s=null;this.state.err&&(s=i.a.createElement("div",{className:"error"},this.state.err));let o=null;this.state.busy&&(o=i.a.createElement("div",{className:"progress"},i.a.createElement(a,null)));const r=$c.a.get().reportEvent&&$c.a.get().reportEvent.adminMessageMD;let l;if(r){const e=new YN(r).toHTML({externalLinks:!0});l=i.a.createElement("p",{dangerouslySetInnerHTML:{__html:e}})}return i.a.createElement(e,{className:"mx_BugReportDialog",onFinished:this.props.onFinished,title:Object(ts.a)("Report Content to Your Homeserver Administrator"),contentId:"mx_ReportEventDialog"},i.a.createElement("div",{className:"mx_ReportEventDialog",id:"mx_ReportEventDialog"},i.a.createElement("p",null,Object(ts.a)("Reporting this message will send its unique 'event ID' to the administrator of your homeserver. If messages in this room are encrypted, your homeserver administrator will not be able to read the message text or view any files or images.")),l,i.a.createElement(n,{className:"mx_ReportEventDialog_reason",element:"textarea",label:Object(ts.a)("Reason"),rows:5,onChange:this._onReasonChange,value:this.state.reason,disabled:this.state.busy}),o,s),i.a.createElement(t,{primaryButton:Object(ts.a)("Send report"),onPrimaryButtonClick:this._onSubmit,focus:!0,onCancel:this._onCancel,disabled:this.state.busy}))}},Fe()(JN,"propTypes",{mxEvent:At.a.instanceOf(XT.b).isRequired,onFinished:At.a.func.isRequired}),$N=JN))||$N;var XN,ZN;function eD(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}let tD=Object(os.a)("views.settings.tabs.room.AdvancedRoomSettingsTab")((ZN=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_upgradeRoom",e=>{const t=On.getComponent("dialogs.RoomUpgradeDialog"),a=Cs.a.get().getRoom(this.props.roomId);qd.a.createTrackedDialog("Upgrade Room Version","",t,{room:a})}),Fe()(this,"_openDevtools",e=>{const t=On.getComponent("dialogs.DevtoolsDialog");qd.a.createDialog(t,{roomId:this.props.roomId})}),Fe()(this,"_onOldRoomClicked",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"view_room",room_id:this.state.oldRoomId,event_id:this.state.oldEventId}),this.props.closeSettingsFn()}),this.state={upgradeRecommendation:null}}UNSAFE_componentWillMount(){const e=Cs.a.get().getRoom(this.props.roomId);e.getRecommendedVersion().then(t=>{const a=e.currentState.getStateEvents("m.room.tombstone",""),n={},s=e.currentState.getStateEvents("m.room.create",""),i=s?s.getContent().predecessor:null;i&&i.room_id&&(n.oldRoomId=i.room_id,n.oldEventId=i.event_id,n.hasPreviousRoom=!0),this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?eD(Object(a),!0).forEach((function(t){Fe()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):eD(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({upgraded:a&&a.getContent().replacement_room,upgradeRecommendation:t},n))})}render(){const e=Cs.a.get().getRoom(this.props.roomId);let t;const a=e.currentState.getStateEvents("m.room.create","");let n,s;if(a&&!1===a.getContent()["m.federate"]&&(t=i.a.createElement("div",null,Object(ts.a)("This room is not accessible by remote Matrix servers"))),this.state.upgradeRecommendation&&this.state.upgradeRecommendation.needsUpgrade&&!this.state.upgraded&&(n=i.a.createElement("div",null,i.a.createElement("p",{className:"mx_SettingsTab_warningText"},Object(ts.a)("<b>Warning</b>: Upgrading a room will <i>not automatically migrate room members to the new version of the room.</i> We'll post a link to the new room in the old version of the room - room members will have to click this link to join the new room.",{},{b:e=>i.a.createElement("b",null,e),i:e=>i.a.createElement("i",null,e)})),i.a.createElement(Fs.a,{onClick:this._upgradeRoom,kind:"primary"},Object(ts.a)("Upgrade this room to the recommended room version")))),this.state.hasPreviousRoom){let e=Object(ts.a)("this room");const t=Cs.a.get().getRoom(this.props.roomId);t&&t.name&&(e=t.name),s=i.a.createElement(Fs.a,{element:"a",onClick:this._onOldRoomClicked},Object(ts.a)("View older messages in %(roomName)s.",{roomName:e}))}return i.a.createElement("div",{className:"mx_SettingsTab"},i.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(ts.a)("Advanced")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Room information")),i.a.createElement("div",null,i.a.createElement("span",null,Object(ts.a)("Internal room ID:"))," ",this.props.roomId),t),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Room version")),i.a.createElement("div",null,i.a.createElement("span",null,Object(ts.a)("Room version:"))," ",e.getVersion()),s,n),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Developer options")),i.a.createElement(Fs.a,{onClick:this._openDevtools,kind:"primary"},Object(ts.a)("Open Devtools"))))}},Fe()(ZN,"propTypes",{roomId:At.a.string.isRequired,closeSettingsFn:At.a.func.isRequired}),XN=ZN))||XN;var aD,nD;let sD=Object(os.a)("views.room_settings.RoomProfileSettings")((nD=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_uploadAvatar",()=>{this._avatarUpload.current.click()}),Fe()(this,"_removeAvatar",()=>{this._avatarUpload.current.value="",this.setState({avatarUrl:null,avatarFile:null,enableProfileSave:!0})}),Fe()(this,"_cancelProfileChanges",async e=>{e.stopPropagation(),e.preventDefault(),this.state.enableProfileSave&&this.setState({enableProfileSave:!1,displayName:this.state.originalDisplayName,topic:this.state.originalTopic,avatarUrl:this.state.originalAvatarUrl,avatarFile:null})}),Fe()(this,"_saveProfile",async e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.enableProfileSave)return;this.setState({enableProfileSave:!1});const t=Cs.a.get(),a={},n=this.state.displayName.trim();if(this.state.originalDisplayName!==this.state.displayName&&(await t.setRoomName(this.props.roomId,n),a.originalDisplayName=n,a.displayName=n),this.state.avatarFile){const e=await t.uploadContent(this.state.avatarFile);await t.sendStateEvent(this.props.roomId,"m.room.avatar",{url:e},""),a.avatarUrl=Object(Os.b)(e).getSquareThumbnailHttp(96),a.originalAvatarUrl=a.avatarUrl,a.avatarFile=null}else this.state.originalAvatarUrl!==this.state.avatarUrl&&await t.sendStateEvent(this.props.roomId,"m.room.avatar",{},"");this.state.originalTopic!==this.state.topic&&(await t.setRoomTopic(this.props.roomId,this.state.topic),a.originalTopic=this.state.topic),this.setState(a)}),Fe()(this,"_onDisplayNameChanged",e=>{this.setState({displayName:e.target.value}),this.state.originalDisplayName===e.target.value?this.setState({enableProfileSave:!1}):this.setState({enableProfileSave:!0})}),Fe()(this,"_onTopicChanged",e=>{this.setState({topic:e.target.value}),this.state.originalTopic===e.target.value?this.setState({enableProfileSave:!1}):this.setState({enableProfileSave:!0})}),Fe()(this,"_onAvatarChanged",e=>{if(!e.target.files||!e.target.files.length)return void this.setState({avatarUrl:this.state.originalAvatarUrl,avatarFile:null,enableProfileSave:!1});const t=e.target.files[0],a=new FileReader;a.onload=e=>{this.setState({avatarUrl:e.target.result,avatarFile:t,enableProfileSave:!0})},a.readAsDataURL(t)});const t=Cs.a.get(),a=t.getRoom(e.roomId);if(!a)throw new Error("Expected a room for ID: ",e.roomId);const n=a.currentState.getStateEvents("m.room.avatar","");let i=n&&n.getContent()?n.getContent().url:null;i&&(i=Object(Os.b)(i).getSquareThumbnailHttp(96));const o=a.currentState.getStateEvents("m.room.topic",""),r=o&&o.getContent()?o.getContent().topic:"",l=a.currentState.getStateEvents("m.room.name",""),c=l&&l.getContent()?l.getContent().name:"";this.state={originalDisplayName:c,displayName:c,originalAvatarUrl:i,avatarUrl:i,avatarFile:null,originalTopic:r,topic:r,enableProfileSave:!1,canSetName:a.currentState.maySendStateEvent("m.room.name",t.getUserId()),canSetTopic:a.currentState.maySendStateEvent("m.room.topic",t.getUserId()),canSetAvatar:a.currentState.maySendStateEvent("m.room.avatar",t.getUserId())},this._avatarUpload=Object(s.createRef)()}render(){const e=On.getComponent("elements.AccessibleButton"),t=On.getComponent("settings.AvatarSetting");let a;return(this.state.canSetName||this.state.canSetTopic||this.state.canSetAvatar)&&(a=i.a.createElement("div",{className:"mx_ProfileSettings_buttons"},i.a.createElement(e,{onClick:this._cancelProfileChanges,kind:"link",disabled:!this.state.enableProfileSave},Object(ts.a)("Cancel")),i.a.createElement(e,{onClick:this._saveProfile,kind:"primary",disabled:!this.state.enableProfileSave},Object(ts.a)("Save")))),i.a.createElement("form",{onSubmit:this._saveProfile,autoComplete:"off",noValidate:!0,className:"mx_ProfileSettings_profileForm"},i.a.createElement("input",{type:"file",ref:this._avatarUpload,className:"mx_ProfileSettings_avatarUpload",onChange:this._onAvatarChanged,accept:"image/*"}),i.a.createElement("div",{className:"mx_ProfileSettings_profile"},i.a.createElement("div",{className:"mx_ProfileSettings_controls"},i.a.createElement(rm.a,{label:Object(ts.a)("Room Name"),type:"text",value:this.state.displayName,autoComplete:"off",onChange:this._onDisplayNameChanged,disabled:!this.state.canSetName}),i.a.createElement(rm.a,{className:"mx_ProfileSettings_controls_topic",id:"profileTopic",label:Object(ts.a)("Room Topic"),disabled:!this.state.canSetTopic,type:"text",value:this.state.topic,autoComplete:"off",onChange:this._onTopicChanged,element:"textarea"})),i.a.createElement(t,{avatarUrl:this.state.avatarUrl,avatarName:this.state.displayName||this.props.roomId,avatarAltText:Object(ts.a)("Room avatar"),uploadAvatar:this.state.canSetAvatar?this._uploadAvatar:void 0,removeAvatar:this.state.canSetAvatar?this._removeAvatar:void 0})),a)}},Fe()(nD,"propTypes",{roomId:At.a.string.isRequired}),aD=nD))||aD;var iD,oD;let rD=Object(os.a)("views.settings.tabs.room.GeneralRoomSettingsTab")((oD=class extends i.a.Component{constructor(){super(),Fe()(this,"_onLeaveClick",()=>{gn.a.dispatch({action:"leave_room",room_id:this.props.roomId})}),this.state={isRoomPublished:!1}}render(){const e=On.getComponent("room_settings.AliasSettings"),t=On.getComponent("room_settings.RelatedGroupSettings"),a=On.getComponent("room_settings.UrlPreviewSettings"),n=this.context,s=n.getRoom(this.props.roomId),o=s.currentState.mayClientSendStateEvent("m.room.canonical_alias",n),r=s.currentState.getStateEvents("m.room.canonical_alias",""),l=s.currentState.getStateEvents("m.room.aliases"),c=s.currentState.mayClientSendStateEvent("m.room.related_groups",n),d=s.currentState.getStateEvents("m.room.related_groups","");let m,u=i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("URL Previews")),i.a.createElement("div",{className:"mx_SettingsTab_section"},i.a.createElement(a,{room:s})));return ss.b.getValue(vu.a.URLPreviews)||(u=null),ss.b.getValue(vu.a.Flair)&&(m=i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Flair")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement(t,{roomId:s.roomId,canSetRelatedGroups:c,relatedGroupsEvent:d})))),i.a.createElement("div",{className:"mx_SettingsTab mx_GeneralRoomSettingsTab"},i.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(ts.a)("General")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_GeneralRoomSettingsTab_profileSection"},i.a.createElement(sD,{roomId:this.props.roomId})),i.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(ts.a)("Room Addresses")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement(e,{roomId:this.props.roomId,canSetCanonicalAlias:o,canSetAliases:!0,canonicalAliasEvent:r,aliasEvents:l})),i.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(ts.a)("Other")),m,u,i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Leave room")),i.a.createElement("div",{className:"mx_SettingsTab_section"},i.a.createElement(Fs.a,{kind:"danger",onClick:this._onLeaveClick},Object(ts.a)("Leave room"))))}},Fe()(oD,"propTypes",{roomId:At.a.string.isRequired}),Fe()(oD,"contextType",ns.a),iD=oD))||iD;var lD,cD;let dD=Object(os.a)("views.settings.tabs.room.NotificationsSettingsTab")((cD=class extends i.a.Component{constructor(){super(),Fe()(this,"_soundUpload",Object(s.createRef)()),this.state={currentSound:"default",uploadedFile:null}}UNSAFE_componentWillMount(){const e=Ky.default.getSoundForRoom(this.props.roomId);e&&this.setState({currentSound:e.name||e.url})}async _triggerUploader(e){e.stopPropagation(),e.preventDefault(),this._soundUpload.current.click()}async _onSoundUploadChanged(e){if(!e.target.files||!e.target.files.length)return void this.setState({uploadedFile:null});const t=e.target.files[0];this.setState({uploadedFile:t})}async _onClickSaveSound(e){e.stopPropagation(),e.preventDefault();try{await this._saveSound()}catch(e){console.error("Unable to save notification sound for "+this.props.roomId),console.error(e)}}async _saveSound(){if(!this.state.uploadedFile)return;let e=this.state.uploadedFile.type;"video/ogg"===e&&(e="audio/ogg");const t=await Cs.a.get().uploadContent(this.state.uploadedFile,{type:e});await ss.b.setValue("notificationSound",this.props.roomId,mi.a.ROOM_ACCOUNT,{name:this.state.uploadedFile.name,type:e,size:this.state.uploadedFile.size,url:t}),this.setState({uploadedFile:null,currentSound:this.state.uploadedFile.name})}_clearSound(e){e.stopPropagation(),e.preventDefault(),ss.b.setValue("notificationSound",this.props.roomId,mi.a.ROOM_ACCOUNT,null),this.setState({currentSound:"default"})}render(){let e=null;return this.state.uploadedFile&&(e=i.a.createElement("div",null,i.a.createElement("span",null,Object(ts.a)("Uploaded sound"),": ",i.a.createElement("code",null,this.state.uploadedFile.name)))),i.a.createElement("div",{className:"mx_SettingsTab"},i.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(ts.a)("Notifications")),i.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Sounds")),i.a.createElement("div",null,i.a.createElement("span",null,Object(ts.a)("Notification sound"),": ",i.a.createElement("code",null,this.state.currentSound)),i.a.createElement("br",null),i.a.createElement(Fs.a,{className:"mx_NotificationSound_resetSound",disabled:"default"==this.state.currentSound,onClick:this._clearSound.bind(this),kind:"primary"},Object(ts.a)("Reset"))),i.a.createElement("div",null,i.a.createElement("h3",null,Object(ts.a)("Set a new custom sound")),i.a.createElement("form",{autoComplete:"off",noValidate:!0},i.a.createElement("input",{ref:this._soundUpload,className:"mx_NotificationSound_soundUpload",type:"file",onChange:this._onSoundUploadChanged.bind(this),accept:"audio/*"})),e,i.a.createElement(Fs.a,{className:"mx_NotificationSound_browse",onClick:this._triggerUploader.bind(this),kind:"primary"},Object(ts.a)("Browse")),i.a.createElement(Fs.a,{className:"mx_NotificationSound_save",disabled:null==this.state.uploadedFile,onClick:this._onClickSaveSound.bind(this),kind:"primary"},Object(ts.a)("Save")),i.a.createElement("br",null))))}},Fe()(cD,"propTypes",{roomId:At.a.string.isRequired}),lD=cD))||lD;var mD,uD;let hD=Object(os.a)("views.dialogs.RoomSettingsDialog")((uD=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_onAction",e=>{"view_home_page"===e.action&&this.props.onFinished()})}componentDidMount(){this._dispatcherRef=gn.a.register(this._onAction)}componentWillUnmount(){this._dispatcherRef&&gn.a.unregister(this._dispatcherRef)}_getTabs(){const e=[];return e.push(new TS.a("ROOM_GENERAL_TAB",Object(ts.b)("General"),"mx_RoomSettingsDialog_settingsIcon",i.a.createElement(rD,{roomId:this.props.roomId}))),e.push(new TS.a("ROOM_SECURITY_TAB",Object(ts.b)("Security & Privacy"),"mx_RoomSettingsDialog_securityIcon",i.a.createElement(BI,{roomId:this.props.roomId}))),e.push(new TS.a("ROOM_ROLES_TAB",Object(ts.b)("Roles & Permissions"),"mx_RoomSettingsDialog_rolesIcon",i.a.createElement(jI,{roomId:this.props.roomId}))),e.push(new TS.a("ROOM_NOTIFICATIONS_TAB",Object(ts.b)("Notifications"),"mx_RoomSettingsDialog_notificationsIcon",i.a.createElement(dD,{roomId:this.props.roomId}))),ss.b.getValue("feature_bridge_state")&&e.push(new TS.a("ROOM_BRIDGES_TAB",Object(ts.b)("Bridges"),"mx_RoomSettingsDialog_bridgesIcon",i.a.createElement(kI,{roomId:this.props.roomId}))),ss.b.getValue(vu.a.AdvancedSettings)&&e.push(new TS.a("ROOM_ADVANCED_TAB",Object(ts.b)("Advanced"),"mx_RoomSettingsDialog_warningIcon",i.a.createElement(tD,{roomId:this.props.roomId,closeSettingsFn:this.props.onFinished}))),e}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=Cs.a.get().getRoom(this.props.roomId).name;return i.a.createElement(e,{className:"mx_RoomSettingsDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(ts.a)("Room Settings - %(roomName)s",{roomName:t})},i.a.createElement("div",{className:"mx_SettingsDialog_content"},i.a.createElement(TS.b,{tabs:this._getTabs()})))}},Fe()(uD,"propTypes",{roomId:At.a.string.isRequired,onFinished:At.a.func.isRequired}),mD=uD))||mD;var pD,gD;let fD=Object(os.a)("views.dialogs.RoomUpgradeDialog")((gD=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{busy:!0}),Fe()(this,"_onCancelClick",()=>{this.props.onFinished(!1)}),Fe()(this,"_onUpgradeClick",()=>{this.setState({busy:!0}),Cs.a.get().upgradeRoom(this.props.room.roomId,this._targetVersion).then(()=>{this.props.onFinished(!0)}).catch(e=>{const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Failed to upgrade room","",t,{title:Object(ts.a)("Failed to upgrade room"),description:e&&e.message?e.message:Object(ts.a)("The room upgrade could not be completed")})}).finally(()=>{this.setState({busy:!1})})})}async componentDidMount(){const e=await this.props.room.getRecommendedVersion();this._targetVersion=e.version,this.setState({busy:!1})}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons"),a=On.getComponent("views.elements.Spinner");let n;return n=this.state.busy?i.a.createElement(a,null):i.a.createElement(t,{primaryButton:Object(ts.a)("Upgrade this room to version %(version)s",{version:this._targetVersion}),primaryButtonClass:"danger",hasCancel:!0,onPrimaryButtonClick:this._onUpgradeClick,focus:this.props.focus,onCancel:this._onCancelClick}),i.a.createElement(e,{className:"mx_RoomUpgradeDialog",onFinished:this.props.onFinished,title:Object(ts.a)("Upgrade Room Version"),contentId:"mx_Dialog_content",hasCancel:!0},i.a.createElement("p",null,Object(ts.a)("Upgrading this room requires closing down the current instance of the room and creating a new room in its place. To give room members the best possible experience, we will:")),i.a.createElement("ol",null,i.a.createElement("li",null,Object(ts.a)("Create a new room with the same name, description and avatar")),i.a.createElement("li",null,Object(ts.a)("Update any local room aliases to point to the new room")),i.a.createElement("li",null,Object(ts.a)("Stop users from speaking in the old version of the room, and post a message advising users to move to the new room")),i.a.createElement("li",null,Object(ts.a)("Put a link back to the old room at the start of the new room so people can see old messages"))),n)}},Fe()(gD,"propTypes",{room:At.a.object.isRequired,onFinished:At.a.func.isRequired}),pD=gD))||pD;var vD,bD;let yD=Object(os.a)("views.dialogs.RoomUpgradeWarningDialog")((bD=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_onContinue",()=>{this.props.onFinished({continue:!0,invite:this.state.isPrivate&&this.state.inviteUsersToNewRoom})}),Fe()(this,"_onCancel",()=>{this.props.onFinished({continue:!1,invite:!1})}),Fe()(this,"_onInviteUsersToggle",e=>{this.setState({inviteUsersToNewRoom:e})}),Fe()(this,"_openBugReportDialog",e=>{e.preventDefault(),e.stopPropagation();const t=On.getComponent("dialogs.BugReportDialog");qd.a.createTrackedDialog("Bug Report Dialog","",t,{})});const t=Cs.a.get().getRoom(this.props.roomId),a=t?t.currentState.getStateEvents("m.room.join_rules",""):null,n=!a||"public"!==a.getContent().join_rule;this.state={currentVersion:t?t.getVersion():"1",isPrivate:n,inviteUsersToNewRoom:!0}}render(){const e=$c.a.get().brand,t=On.getComponent("views.dialogs.BaseDialog"),a=On.getComponent("views.elements.DialogButtons");let n=null;this.state.isPrivate&&(n=i.a.createElement(FI.a,{value:this.state.inviteUsersToNewRoom,onChange:this._onInviteUsersToggle,label:Object(ts.a)("Automatically invite users")}));const s=this.state.isPrivate?Object(ts.a)("Upgrade private room"):Object(ts.a)("Upgrade public room");let o=i.a.createElement("p",null,Object(ts.a)("This usually only affects how the room is processed on the server. If you're having problems with your %(brand)s, please report a bug.",{brand:e}));return $c.a.get().bug_report_endpoint_url&&(o=i.a.createElement("p",null,Object(ts.a)("This usually only affects how the room is processed on the server. If you're having problems with your %(brand)s, please <a>report a bug</a>.",{brand:e},{a:e=>i.a.createElement("a",{href:"#",onClick:this._openBugReportDialog},e)}))),i.a.createElement(t,{className:"mx_RoomUpgradeWarningDialog",hasCancel:!0,fixedWidth:!1,onFinished:this.props.onFinished,title:s},i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("Upgrading a room is an advanced action and is usually recommended when a room is unstable due to bugs, missing features or security vulnerabilities.")),o,i.a.createElement("p",null,Object(ts.a)("You'll upgrade this room from <oldVersion /> to <newVersion />.",{},{oldVersion:()=>i.a.createElement("code",null,this.state.currentVersion),newVersion:()=>i.a.createElement("code",null,this.props.targetVersion)})),n),i.a.createElement(a,{primaryButton:Object(ts.a)("Upgrade"),onPrimaryButtonClick:this._onContinue,cancelButton:Object(ts.a)("Cancel"),onCancel:this._onCancel}))}},Fe()(bD,"propTypes",{onFinished:At.a.func.isRequired,roomId:At.a.string.isRequired,targetVersion:At.a.string.isRequired}),vD=bD))||vD;var ED,_D;let SD=Object(os.a)("views.dialogs.SessionRestoreErrorDialog")((_D=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_sendBugReport",()=>{const e=On.getComponent("dialogs.BugReportDialog");qd.a.createTrackedDialog("Session Restore Error","Send Bug Report Dialog",e,{})}),Fe()(this,"_onClearStorageClick",()=>{const e=On.getComponent("dialogs.QuestionDialog");qd.a.createTrackedDialog("Session Restore Confirm Logout","",e,{title:Object(ts.a)("Sign out"),description:i.a.createElement("div",null,Object(ts.a)("Sign out and remove encryption keys?")),button:Object(ts.a)("Sign out"),danger:!0,onFinished:this.props.onFinished})}),Fe()(this,"_onRefreshClick",()=>{window.location.reload(!0)})}render(){const e=$c.a.get().brand,t=On.getComponent("views.dialogs.BaseDialog"),a=On.getComponent("views.elements.DialogButtons"),n=i.a.createElement("button",{onClick:this._onClearStorageClick,className:"danger"},Object(ts.a)("Clear Storage and Sign Out"));let s;return s=$c.a.get().bug_report_endpoint_url?i.a.createElement(a,{primaryButton:Object(ts.a)("Send Logs"),onPrimaryButtonClick:this._sendBugReport,focus:!0,hasCancel:!1},n):i.a.createElement(a,{primaryButton:Object(ts.a)("Refresh"),onPrimaryButtonClick:this._onRefreshClick,focus:!0,hasCancel:!1},n),i.a.createElement(t,{className:"mx_ErrorDialog",onFinished:this.props.onFinished,title:Object(ts.a)("Unable to restore session"),contentId:"mx_Dialog_content",hasCancel:!1},i.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},i.a.createElement("p",null,Object(ts.a)("We encountered an error trying to restore your previous session.")),i.a.createElement("p",null,Object(ts.a)("If you have previously used a more recent version of %(brand)s, your session may be incompatible with this version. Close this window and return to the more recent version.",{brand:e})),i.a.createElement("p",null,Object(ts.a)("Clearing your browser's storage may fix the problem, but will sign you out and cause any encrypted chat history to become unreadable."))),s)}},Fe()(_D,"propTypes",{error:At.a.string.isRequired,onFinished:At.a.func.isRequired}),ED=_D))||ED;function CD(){return Cs.a.get().idBaseUrl.split("://")[1]}class wD{constructor(){Fe()(this,"_makeAddThreepidOnlyRequest",e=>Cs.a.get().addThreePidOnly({sid:this.sessionId,client_secret:this.clientSecret,auth:e})),this.clientSecret=Cs.a.get().generateClientSecret(),this.sessionId=null,this.submitUrl=null}addEmailAddress(e){return Cs.a.get().requestAdd3pidEmailToken(e,this.clientSecret,1).then(e=>(this.sessionId=e.sid,e),(function(e){throw"M_THREEPID_IN_USE"===e.errcode?e.message=Object(ts.a)("This email address is already in use"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}async bindEmailAddress(e){if(this.bind=!0,await Cs.a.get().doesServerSupportSeparateAddAndBind()){const t=new SI.a,a=await t.getAccessToken();return Cs.a.get().requestEmailToken(e,this.clientSecret,1,void 0,void 0,a).then(e=>(this.sessionId=e.sid,e),(function(e){throw"M_THREEPID_IN_USE"===e.errcode?e.message=Object(ts.a)("This email address is already in use"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}return this.addEmailAddress(e)}addMsisdn(e,t){return Cs.a.get().requestAdd3pidMsisdnToken(e,t,this.clientSecret,1).then(e=>(this.sessionId=e.sid,this.submitUrl=e.submit_url,e),(function(e){throw"M_THREEPID_IN_USE"===e.errcode?e.message=Object(ts.a)("This phone number is already in use"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}async bindMsisdn(e,t){if(this.bind=!0,await Cs.a.get().doesServerSupportSeparateAddAndBind()){const a=new SI.a,n=await a.getAccessToken();return Cs.a.get().requestMsisdnToken(e,t,this.clientSecret,1,void 0,void 0,n).then(e=>(this.sessionId=e.sid,e),(function(e){throw"M_THREEPID_IN_USE"===e.errcode?e.message=Object(ts.a)("This phone number is already in use"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}return this.addMsisdn(e,t)}async checkEmailLinkClicked(){try{if(await Cs.a.get().doesServerSupportSeparateAddAndBind())if(this.bind){const e=new SI.a,t=await e.getAccessToken();await Cs.a.get().bindThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:CD(),id_access_token:t})}else try{return void await this._makeAddThreepidOnlyRequest()}catch(e){if(401!==e.httpStatus||!e.data||!e.data.flows)throw e;const t=On.getComponent("dialogs.InteractiveAuthDialog"),a={[GC.c.PHASE_PREAUTH]:{title:Object(ts.a)("Use Single Sign On to continue"),body:Object(ts.a)("Confirm adding this email address by using Single Sign On to prove your identity."),continueText:Object(ts.a)("Single Sign On"),continueKind:"primary"},[GC.c.PHASE_POSTAUTH]:{title:Object(ts.a)("Confirm adding email"),body:Object(ts.a)("Click the button below to confirm adding this email address."),continueText:Object(ts.a)("Confirm"),continueKind:"primary"}},{finished:n}=qd.a.createTrackedDialog("Add Email","",t,{title:Object(ts.a)("Add Email Address"),matrixClient:Cs.a.get(),authData:e.data,makeRequest:this._makeAddThreepidOnlyRequest,aestheticsForStagePhases:{[GC.c.LOGIN_TYPE]:a,[GC.c.UNSTABLE_LOGIN_TYPE]:a}});return n}else await Cs.a.get().addThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:CD()},this.bind)}catch(e){throw 401===e.httpStatus?e.message=Object(ts.a)("Failed to verify email address: make sure you clicked the link in the email"):e.httpStatus&&(e.message+=` (Status ${e.httpStatus})`),e}}async haveMsisdnToken(e){const t=new SI.a,a=await Cs.a.get().doesServerSupportSeparateAddAndBind();let n;if(this.submitUrl)n=await Cs.a.get().submitMsisdnTokenOtherUrl(this.submitUrl,this.sessionId,this.clientSecret,e);else{if(!this.bind&&a)throw new Error("The add / bind with MSISDN flow is misconfigured");n=await Cs.a.get().submitMsisdnToken(this.sessionId,this.clientSecret,e,await t.getAccessToken())}if(n.errcode)throw n;if(a)if(this.bind)await Cs.a.get().bindThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:CD(),id_access_token:await t.getAccessToken()});else try{return void await this._makeAddThreepidOnlyRequest()}catch(e){if(401!==e.httpStatus||!e.data||!e.data.flows)throw e;const t=On.getComponent("dialogs.InteractiveAuthDialog"),a={[GC.c.PHASE_PREAUTH]:{title:Object(ts.a)("Use Single Sign On to continue"),body:Object(ts.a)("Confirm adding this phone number by using Single Sign On to prove your identity."),continueText:Object(ts.a)("Single Sign On"),continueKind:"primary"},[GC.c.PHASE_POSTAUTH]:{title:Object(ts.a)("Confirm adding phone number"),body:Object(ts.a)("Click the button below to confirm adding this phone number."),continueText:Object(ts.a)("Confirm"),continueKind:"primary"}},{finished:n}=qd.a.createTrackedDialog("Add MSISDN","",t,{title:Object(ts.a)("Add Phone Number"),matrixClient:Cs.a.get(),authData:e.data,makeRequest:this._makeAddThreepidOnlyRequest,aestheticsForStagePhases:{[GC.c.LOGIN_TYPE]:a,[GC.c.UNSTABLE_LOGIN_TYPE]:a}});return n}else await Cs.a.get().addThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:CD()},this.bind)}}var OD,xD;let RD=Object(os.a)("views.dialogs.SetEmailDialog")((xD=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{emailAddress:"",emailBusy:!1}),Fe()(this,"onEmailAddressChanged",e=>{this.setState({emailAddress:e})}),Fe()(this,"onSubmit",()=>{const e=On.getComponent("dialogs.ErrorDialog"),t=On.getComponent("dialogs.QuestionDialog"),a=this.state.emailAddress;YS.a(a)?(this._addThreepid=new wD,this._addThreepid.addEmailAddress(a).then(()=>{qd.a.createTrackedDialog("Verification Pending","",t,{title:Object(ts.a)("Verification Pending"),description:Object(ts.a)("Please check your email and click on the link it contains. Once this is done, click continue."),button:Object(ts.a)("Continue"),onFinished:this.onEmailDialogFinished})},t=>{this.setState({emailBusy:!1}),console.error("Unable to add email address "+a+" "+t),qd.a.createTrackedDialog("Unable to add email address","",e,{title:Object(ts.a)("Unable to add email address"),description:t&&t.message?t.message:Object(ts.a)("Operation failed")})}),this.setState({emailBusy:!0})):qd.a.createTrackedDialog("Invalid Email Address","",e,{title:Object(ts.a)("Invalid Email Address"),description:Object(ts.a)("This doesn't appear to be a valid email address")})}),Fe()(this,"onCancelled",()=>{this.props.onFinished(!1)}),Fe()(this,"onEmailDialogFinished",e=>{e?this.verifyEmailAddress():this.setState({emailBusy:!1})})}verifyEmailAddress(){this._addThreepid.checkEmailLinkClicked().then(()=>{this.props.onFinished(!0)},e=>{if(this.setState({emailBusy:!1}),"M_THREEPID_AUTH_FAILED"==e.errcode){const e=On.getComponent("dialogs.QuestionDialog"),t=Object(ts.a)("Unable to verify email address.")+" "+Object(ts.a)("Please check your email and click on the link it contains. Once this is done, click continue.");qd.a.createTrackedDialog("Verification Pending","3pid Auth Failed",e,{title:Object(ts.a)("Verification Pending"),description:t,button:Object(ts.a)("Continue"),onFinished:this.onEmailDialogFinished})}else{const t=On.getComponent("dialogs.ErrorDialog");console.error("Unable to verify email address: "+e),qd.a.createTrackedDialog("Unable to verify email address","",t,{title:Object(ts.a)("Unable to verify email address."),description:e&&e.message?e.message:Object(ts.a)("Operation failed")})}})}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("elements.Spinner"),a=On.getComponent("elements.EditableText"),n=this.state.emailBusy?i.a.createElement(t,null):i.a.createElement(a,{initialValue:this.state.emailAddress,className:"mx_SetEmailDialog_email_input",autoFocus:"true",placeholder:Object(ts.a)("Email address"),placeholderClassName:"mx_SetEmailDialog_email_input_placeholder",blurToCancel:!1,onValueChanged:this.onEmailAddressChanged});return i.a.createElement(e,{className:"mx_SetEmailDialog",onFinished:this.onCancelled,title:this.props.title,contentId:"mx_Dialog_content"},i.a.createElement("div",{className:"mx_Dialog_content"},i.a.createElement("p",{id:"mx_Dialog_content"},Object(ts.a)("This will allow you to reset your password and receive notifications.")),n),i.a.createElement("div",{className:"mx_Dialog_buttons"},i.a.createElement("input",{className:"mx_Dialog_primary",type:"submit",value:Object(ts.a)("Continue"),onClick:this.onSubmit}),i.a.createElement("input",{type:"submit",value:Object(ts.a)("Skip"),onClick:this.onCancelled})))}},Fe()(xD,"propTypes",{onFinished:At.a.func.isRequired}),OD=xD))||OD;var kD,ID,TD=e=>{let{onFinished:t}=e;const a=On.getComponent("dialogs.InfoDialog"),n={};Vx.forEach(e=>{e.isEnabled()&&(n[e.category]||(n[e.category]=[]),n[e.category].push(e))});const s=Object.values(Ux).filter(e=>n[e]).map(e=>{const t=[i.a.createElement("tr",{key:"_category_"+e,className:"mx_SlashCommandHelpDialog_headerRow"},i.a.createElement("td",{colSpan:3},i.a.createElement("h2",null,Object(ts.a)(e))))];return n[e].forEach(e=>{t.push(i.a.createElement("tr",{key:e.command},i.a.createElement("td",null,i.a.createElement("strong",null,e.getCommand())),i.a.createElement("td",null,e.args),i.a.createElement("td",null,e.description)))}),t});return i.a.createElement(a,{className:"mx_SlashCommandHelpDialog",title:Object(ts.a)("Command Help"),description:i.a.createElement("table",null,i.a.createElement("tbody",null,s)),hasCloseButton:!0,onFinished:t})};let PD=Object(os.a)("views.dialogs.StorageEvictedDialog")((ID=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_sendBugReport",e=>{e.preventDefault();const t=On.getComponent("dialogs.BugReportDialog");qd.a.createTrackedDialog("Storage evicted","Send Bug Report Dialog",t,{})}),Fe()(this,"_onSignOutClick",()=>{this.props.onFinished(!0)})}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons");let a;return $c.a.get().bug_report_endpoint_url&&(a=Object(ts.a)("To help us prevent this in future, please <a>send us logs</a>.",{},{a:e=>i.a.createElement("a",{href:"#",onClick:this._sendBugReport},e)})),i.a.createElement(e,{className:"mx_ErrorDialog",onFinished:this.props.onFinished,title:Object(ts.a)("Missing session data"),contentId:"mx_Dialog_content",hasCancel:!1},i.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},i.a.createElement("p",null,Object(ts.a)("Some session data, including encrypted message keys, is missing. Sign out and sign in to fix this, restoring keys from backup.")),i.a.createElement("p",null,Object(ts.a)("Your browser likely removed this data when running low on disk space.")," ",a)),i.a.createElement(t,{primaryButton:Object(ts.a)("Sign out"),onPrimaryButtonClick:this._onSignOutClick,focus:!0,hasCancel:!1}))}},Fe()(ID,"propTypes",{onFinished:At.a.func.isRequired}),kD=ID))||kD;var ND,DD,jD=a(1304),AD=a(329);class MD extends i.a.PureComponent{constructor(){super(...arguments),Fe()(this,"onChange",e=>{this.props.onChange(this.props.url,e.target.checked)})}render(){return i.a.createElement("input",{type:"checkbox",onChange:this.onChange,checked:this.props.checked})}}Fe()(MD,"propTypes",{onChange:At.a.func.isRequired,url:At.a.string.isRequired,checked:At.a.bool.isRequired});let UD=Object(os.a)("views.dialogs.TermsDialog")((DD=class extends i.a.PureComponent{constructor(e){super(),Fe()(this,"_onCancelClick",()=>{this.props.onFinished(!1)}),Fe()(this,"_onNextClick",()=>{this.props.onFinished(!0,Object.keys(this.state.agreedUrls).filter(e=>this.state.agreedUrls[e]))}),Fe()(this,"_onTermsCheckboxChange",(e,t)=>{this.setState({agreedUrls:Object.assign({},this.state.agreedUrls,{[e]:t})})}),this.state={agreedUrls:{}};for(const t of e.agreedUrls)this.state.agreedUrls[t]=!0}_nameForServiceType(e,t){switch(e){case AD.a.IS:return i.a.createElement("div",null,Object(ts.a)("Identity Server"),i.a.createElement("br",null),"(",t,")");case AD.a.IM:return i.a.createElement("div",null,Object(ts.a)("Integration Manager"),i.a.createElement("br",null),"(",t,")")}}_summaryForServiceType(e){switch(e){case AD.a.IS:return i.a.createElement("div",null,Object(ts.a)("Find others by phone or email"),i.a.createElement("br",null),Object(ts.a)("Be found by phone or email"));case AD.a.IM:return i.a.createElement("div",null,Object(ts.a)("Use bots, bridges, widgets and sticker packs"))}}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons"),a=[];for(const e of this.props.policiesAndServicePairs){const t=EI.a.parse(e.service.baseUrl),n=Object.values(e.policies);for(let s=0;s<n.length;++s){const o=n[s],r=Object(ts.i)(Object.keys(o).filter(e=>"version"!==e));let l,c;0===s&&(l=this._nameForServiceType(e.service.serviceType,t.host),c=this._summaryForServiceType(e.service.serviceType)),a.push(i.a.createElement("tr",{key:o[r].url},i.a.createElement("td",{className:"mx_TermsDialog_service"},l),i.a.createElement("td",{className:"mx_TermsDialog_summary"},c),i.a.createElement("td",null,o[r].name," ",i.a.createElement("a",{rel:"noreferrer noopener",target:"_blank",href:o[r].url},i.a.createElement("span",{className:"mx_TermsDialog_link"}))),i.a.createElement("td",null,i.a.createElement(MD,{url:o[r].url,onChange:this._onTermsCheckboxChange,checked:Boolean(this.state.agreedUrls[o[r].url])}))))}}let n=!1;for(const e of this.props.policiesAndServicePairs){let t=0;for(const a of Object.values(e.policies)){let e=!1;for(const t of Object.keys(a))if("version"!==t&&this.state.agreedUrls[a[t].url]){e=!0;break}e&&++t}if(t===Object.keys(e.policies).length){n=!0;break}}return i.a.createElement(e,{fixedWidth:!1,onFinished:this._onCancelClick,title:Object(ts.a)("Terms of Service"),contentId:"mx_Dialog_content",hasCancel:!1},i.a.createElement("div",{id:"mx_Dialog_content"},i.a.createElement("p",null,Object(ts.a)("To continue you need to accept the terms of this service.")),i.a.createElement("table",{className:"mx_TermsDialog_termsTable"},i.a.createElement("tbody",null,i.a.createElement("tr",{className:"mx_TermsDialog_termsTableHeader"},i.a.createElement("th",null,Object(ts.a)("Service")),i.a.createElement("th",null,Object(ts.a)("Summary")),i.a.createElement("th",null,Object(ts.a)("Document")),i.a.createElement("th",null,Object(ts.a)("Accept"))),a))),i.a.createElement(t,{primaryButton:Object(ts.a)("Next"),hasCancel:!0,onCancel:this._onCancelClick,onPrimaryButtonClick:this._onNextClick,primaryDisabled:!n}))}},Fe()(DD,"propTypes",{policiesAndServicePairs:At.a.array.isRequired,agreedUrls:At.a.arrayOf(At.a.string),onFinished:At.a.func.isRequired}),ND=DD))||ND;var LD,FD;let BD=Object(os.a)("views.dialogs.UploadFailureDialog")((FD=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_onCancelClick",()=>{this.props.onFinished(!1)}),Fe()(this,"_onUploadClick",()=>{this.props.onFinished(!0)})}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons");let a,n;if(1===this.props.totalFiles&&1===this.props.badFiles.length)a=Object(ts.a)("This file is <b>too large</b> to upload. The file size limit is %(limit)s but this file is %(sizeOfThisFile)s.",{limit:GS()(this.props.contentMessages.getUploadLimit()),sizeOfThisFile:GS()(this.props.badFiles[0].size)},{b:e=>i.a.createElement("b",null,e)}),n=i.a.createElement(t,{primaryButton:Object(ts.a)("OK"),hasCancel:!1,onPrimaryButtonClick:this._onCancelClick,focus:!0});else if(this.props.totalFiles===this.props.badFiles.length)a=Object(ts.a)("These files are <b>too large</b> to upload. The file size limit is %(limit)s.",{limit:GS()(this.props.contentMessages.getUploadLimit())},{b:e=>i.a.createElement("b",null,e)}),n=i.a.createElement(t,{primaryButton:Object(ts.a)("OK"),hasCancel:!1,onPrimaryButtonClick:this._onCancelClick,focus:!0});else{a=Object(ts.a)("Some files are <b>too large</b> to be uploaded. The file size limit is %(limit)s.",{limit:GS()(this.props.contentMessages.getUploadLimit())},{b:e=>i.a.createElement("b",null,e)});const e=this.props.totalFiles-this.props.badFiles.length;n=i.a.createElement(t,{primaryButton:Object(ts.a)("Upload %(count)s other files",{count:e}),onPrimaryButtonClick:this._onUploadClick,hasCancel:!0,cancelButton:Object(ts.a)("Cancel All"),onCancel:this._onCancelClick,focus:!0})}return i.a.createElement(e,{className:"mx_UploadFailureDialog",onFinished:this._onCancelClick,title:Object(ts.a)("Upload Error"),contentId:"mx_Dialog_content"},i.a.createElement("div",{id:"mx_Dialog_content"},a,void 0),n)}},Fe()(FD,"propTypes",{badFiles:At.a.arrayOf(At.a.object).isRequired,totalFiles:At.a.number.isRequired,contentMessages:At.a.instanceOf(BS.a).isRequired,onFinished:At.a.func.isRequired}),LD=FD))||LD;var VD,GD,zD=a(1354);let WD=Object(os.a)("views.dialogs.security.ConfirmDestroyCrossSigningDialog")((GD=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_onConfirm",()=>{this.props.onFinished(!0)}),Fe()(this,"_onDecline",()=>{this.props.onFinished(!1)})}render(){const e=On.getComponent("views.dialogs.BaseDialog"),t=On.getComponent("views.elements.DialogButtons");return i.a.createElement(e,{className:"mx_ConfirmDestroyCrossSigningDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(ts.a)("Destroy cross-signing keys?")},i.a.createElement("div",{className:"mx_ConfirmDestroyCrossSigningDialog_content"},i.a.createElement("p",null,Object(ts.a)("Deleting cross-signing keys is permanent. Anyone you have verified with will see security alerts. You almost certainly don't want to do this, unless you've lost every device you can cross-sign from."))),i.a.createElement(t,{primaryButton:Object(ts.a)("Clear cross-signing keys"),onPrimaryButtonClick:this._onConfirm,primaryButtonClass:"danger",cancelButton:Object(ts.a)("Cancel"),onCancel:this._onDecline}))}},Fe()(GD,"propTypes",{onFinished:At.a.func.isRequired}),VD=GD))||VD;var HD,KD,qD=a(1378);let YD=Object(os.a)("views.elements.AddressSelector")((KD=class extends i.a.Component{constructor(e){super(e),Fe()(this,"moveSelectionTop",()=>{this.state.selected>0&&this.setState({selected:0,hover:!1})}),Fe()(this,"moveSelectionUp",()=>{this.state.selected>0&&this.setState({selected:this.state.selected-1,hover:!1})}),Fe()(this,"moveSelectionDown",()=>{this.state.selected<this._maxSelected(this.props.addressList)&&this.setState({selected:this.state.selected+1,hover:!1})}),Fe()(this,"chooseSelection",()=>{this.selectAddress(this.state.selected)}),Fe()(this,"onClick",e=>{this.selectAddress(e)}),Fe()(this,"onMouseEnter",e=>{this.setState({selected:e,hover:!0})}),Fe()(this,"onMouseLeave",()=>{this.setState({hover:!1})}),Fe()(this,"selectAddress",e=>{0!==this.props.addressList.length&&(this.props.onSelected(e),this.setState({hover:!1}))}),this.state={selected:void 0===this.props.selected?0:this.props.selected,hover:!1}}UNSAFE_componentWillReceiveProps(e){const t=this.state.selected,a=this._maxSelected(e.addressList);t>a&&this.setState({selected:a})}componentDidUpdate(){if(this.scrollElement&&this.props.addressList.length>0&&!this.state.hover){const e=this.addressListElement.getBoundingClientRect().height;this.scrollElement.scrollTop=this.state.selected*e-e}}createAddressListTiles(){const e=On.getComponent("elements.AddressTile"),t=this._maxSelected(this.props.addressList),n=[];if(this.props.addressList.length>0)for(let s=0;s<=t;s++){const t=Hn()({mx_AddressSelector_addressListElement:!0,mx_AddressSelector_selected:this.state.selected===s});n.push(i.a.createElement("div",{className:t,onClick:this.onClick.bind(this,s),onMouseEnter:this.onMouseEnter.bind(this,s),onMouseLeave:this.onMouseLeave,key:this.props.addressList[s].addressType+"/"+this.props.addressList[s].address,ref:e=>{this.addressListElement=e}},i.a.createElement(e,{address:this.props.addressList[s],showAddress:this.props.showAddress,justified:!0,networkName:"vector",networkUrl:a(8433)})))}return n}_maxSelected(e){const t=0===e.length?0:e.length-1;return t>this.props.truncateAt-1?this.props.truncateAt-1:t}render(){const e=Hn()({mx_AddressSelector:!0,mx_AddressSelector_empty:0===this.props.addressList.length});return i.a.createElement("div",{className:e,ref:e=>{this.scrollElement=e}},this.props.header,this.createAddressListTiles())}},Fe()(KD,"propTypes",{onSelected:At.a.func.isRequired,addressList:At.a.arrayOf(xx.a).isRequired,showAddress:At.a.bool,truncateAt:At.a.number.isRequired,selected:At.a.number,header:At.a.node}),HD=KD))||HD;var $D,JD;let QD=Object(os.a)("views.elements.AddressTile")((JD=class extends i.a.Component{render(){const e=this.props.address,t=e.displayName||e.address,n=[],s=["mx-user-id","mx-room-id"].includes(e.addressType);s&&e.avatarMxc?n.push(Object(Os.b)(e.avatarMxc).getSquareThumbnailHttp(25)):"email"===e.addressType&&n.push(a(8434));const o=On.getComponent("avatars.BaseAvatar"),r=On.getComponent("elements.TintableSvg"),l=Hn()({mx_AddressTile_name:!0,mx_AddressTile_justified:this.props.justified});let c,d=!1;if(s&&e.isKnown){const a=Hn()({mx_AddressTile_id:!0,mx_AddressTile_justified:this.props.justified});c=i.a.createElement("div",{className:"mx_AddressTile_mx"},i.a.createElement("div",{className:l},t),this.props.showAddress?i.a.createElement("div",{className:a},e.address):i.a.createElement("div",null))}else if(s){const e=Hn()({mx_AddressTile_unknownMx:!0,mx_AddressTile_justified:this.props.justified});c=i.a.createElement("div",{className:e},this.props.address.address)}else if("email"===e.addressType){const t=Hn()({mx_AddressTile_email:!0,mx_AddressTile_justified:this.props.justified});let a=null;e.displayName&&(a=i.a.createElement("div",{className:l},e.displayName)),c=i.a.createElement("div",{className:"mx_AddressTile_mx"},i.a.createElement("div",{className:t},e.address),a)}else{d=!0;const e=Hn()({mx_AddressTile_unknown:!0,mx_AddressTile_justified:this.props.justified});c=i.a.createElement("div",{className:e},Object(ts.a)("Unknown Address"))}const m=Hn()({mx_AddressTile:!0,mx_AddressTile_error:d});let u;return this.props.canDismiss&&(u=i.a.createElement("div",{className:"mx_AddressTile_dismiss",onClick:this.props.onDismissed},i.a.createElement(r,{src:a(8435),width:"9",height:"9"}))),i.a.createElement("div",{className:m},i.a.createElement("div",{className:"mx_AddressTile_avatar"},i.a.createElement(o,{defaultToInitialLetter:!0,width:25,height:25,name:t,title:t,urls:n})),c,u)}},Fe()(JD,"propTypes",{address:xx.a.isRequired,canDismiss:At.a.bool,onDismissed:At.a.func,justified:At.a.bool}),Fe()(JD,"defaultProps",{canDismiss:!1,onDismissed:function(){},justified:!1}),$D=JD))||$D;var XD,ZD,ej=a(1351),tj=a(1352);let aj=Object(os.a)("views.elements.TagTile")((ZD=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{hover:!1,profile:null}),Fe()(this,"_onFlairStoreUpdated",()=>{this.unmounted||pu.a.getGroupProfileCached(this.context,this.props.tag).then(e=>{this.unmounted||this.setState({profile:e})}).catch(e=>{console.warn("Could not fetch group profile for "+this.props.tag,e)})}),Fe()(this,"onClick",e=>{e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"select_tag",tag:this.props.tag,ctrlOrCmdKey:Object(vi.c)(e),shiftKey:e.shiftKey}),"+"===this.props.tag[0]&&this._refreshGroup(this.props.tag)}),Fe()(this,"onMouseOver",()=>{ss.b.getValue("feature_communities_v2_prototypes")||this.setState({hover:!0})}),Fe()(this,"onMouseLeave",()=>{this.setState({hover:!1})}),Fe()(this,"openMenu",e=>{e.stopPropagation(),e.preventDefault(),ss.b.getValue("feature_communities_v2_prototypes")||(this.setState({hover:!1}),this.props.openMenu())})}componentDidMount(){this.unmounted=!1,"+"===this.props.tag[0]&&(pu.a.addListener("updateGroupProfile",this._onFlairStoreUpdated),this._onFlairStoreUpdated(),this._refreshGroup(this.props.tag))}componentWillUnmount(){this.unmounted=!0,"+"===this.props.tag[0]&&pu.a.removeListener("updateGroupProfile",this._onFlairStoreUpdated)}_refreshGroup(e){dS.a.refreshGroupRooms(e),dS.a.refreshGroupMembers(e)}render(){const e=On.getComponent("avatars.BaseAvatar"),t=this.state.profile||{},a=t.name||this.props.tag,n=t.avatarUrl?Object(Os.b)(t.avatarUrl).getSquareThumbnailHttp(32):null,s=ss.b.getValue("feature_communities_v2_prototypes"),o=Hn()({mx_TagTile:!0,mx_TagTile_prototype:s,mx_TagTile_selected:this.props.selected&&!s,mx_TagTile_selected_prototype:this.props.selected&&s}),r=Qn.a.getGroupBadge(this.props.tag);let l;if(r&&!this.state.hover&&!this.props.menuDisplayed){const e=Hn()({mx_TagTile_badge:!0,mx_TagTile_badgeHighlight:r.highlight});l=i.a.createElement("div",{className:e},hs.c(r.count))}const c=this.state.hover||this.props.menuDisplayed?i.a.createElement(Fs.a,{className:"mx_TagTile_context_button",onClick:this.openMenu,inputRef:this.props.contextMenuButtonRef},"···"):i.a.createElement("div",{ref:this.props.contextMenuButtonRef}),d=On.getComponent("elements.AccessibleTooltipButton");return i.a.createElement(d,{className:o,onClick:this.onClick,onContextMenu:this.openMenu,title:a},i.a.createElement("div",{className:"mx_TagTile_avatar",onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave},i.a.createElement(e,{name:a,idName:this.props.tag,url:n,width:32,height:32}),c,l))}},Fe()(ZD,"propTypes",{tag:At.a.string,contextMenuButtonRef:At.a.object,openMenu:At.a.func,menuDisplayed:At.a.bool,selected:At.a.bool}),Fe()(ZD,"contextType",ns.a),XD=ZD))||XD;function nj(e){const[t,a,n,s]=Object(Kr.q)();let o=null;if(t&&a.current){const t=a.current.getBoundingClientRect(),n=On.getComponent("context_menus.TagTileContextMenu");o=i.a.createElement(Kr.b,u()({},Object(Kr.p)(t),{onFinished:s}),i.a.createElement(n,{tag:e.tag,onFinished:s}))}return i.a.createElement("div",null,i.a.createElement(as.Draggable,{key:e.tag,draggableId:e.tag,index:e.index,type:"draggable-TagTile"},(s,o)=>i.a.createElement("div",u()({ref:s.innerRef},s.draggableProps,s.dragHandleProps),i.a.createElement(aj,u()({},e,{contextMenuButtonRef:a,menuDisplayed:t,openMenu:n})))),o)}var sj,ij,oj=a(818);class rj extends i.a.Component{constructor(){super(),Fe()(this,"_onRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!0})}),Fe()(this,"_onDontRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!1})}),Fe()(this,"_onActuallyRemove",e=>{e.stopPropagation(),e.preventDefault(),this.props.onRemove&&this.props.onRemove(this.props.index),this.setState({verifyRemove:!1})}),this.state={verifyRemove:!1}}render(){return this.state.verifyRemove?i.a.createElement("div",{className:"mx_EditableItem"},i.a.createElement("span",{className:"mx_EditableItem_promptText"},Object(ts.a)("Are you sure?")),i.a.createElement(Fs.a,{onClick:this._onActuallyRemove,kind:"primary_sm",className:"mx_EditableItem_confirmBtn"},Object(ts.a)("Yes")),i.a.createElement(Fs.a,{onClick:this._onDontRemove,kind:"danger_sm",className:"mx_EditableItem_confirmBtn"},Object(ts.a)("No"))):i.a.createElement("div",{className:"mx_EditableItem"},i.a.createElement("div",{onClick:this._onRemove,className:"mx_EditableItem_delete",title:Object(ts.a)("Remove"),role:"button"}),i.a.createElement("span",{className:"mx_EditableItem_item"},this.props.value))}}Fe()(rj,"propTypes",{index:At.a.number,value:At.a.string,onRemove:At.a.func});let lj=Object(os.a)("views.elements.EditableItemList")((ij=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_onItemAdded",e=>{e.stopPropagation(),e.preventDefault(),this.props.onItemAdded&&this.props.onItemAdded(this.props.newItem)}),Fe()(this,"_onItemRemoved",e=>{this.props.onItemRemoved&&this.props.onItemRemoved(e)}),Fe()(this,"_onNewItemChanged",e=>{this.props.onNewItemChanged&&this.props.onNewItemChanged(e.target.value)})}_renderNewItemField(){return i.a.createElement("form",{onSubmit:this._onItemAdded,autoComplete:"off",noValidate:!0,className:"mx_EditableItemList_newItem"},i.a.createElement(rm.a,{label:this.props.placeholder,type:"text",autoComplete:"off",value:this.props.newItem||"",onChange:this._onNewItemChanged,list:this.props.suggestionsListId}),i.a.createElement(Fs.a,{onClick:this._onItemAdded,kind:"primary",type:"submit",disabled:!this.props.newItem},Object(ts.a)("Add")))}render(){const e=this.props.items.map((e,t)=>this.props.canRemove?i.a.createElement(rj,{key:e,index:t,value:e,onRemove:this._onItemRemoved}):i.a.createElement("li",{key:e},e)),t=this.props.canRemove?e:i.a.createElement("ul",null,e),a=this.props.items.length>0?this.props.itemsLabel:this.props.noItemsLabel;return i.a.createElement("div",{className:"mx_EditableItemList"},i.a.createElement("div",{className:"mx_EditableItemList_label"},a),t,this.props.canEdit?this._renderNewItemField():i.a.createElement("div",null))}},Fe()(ij,"propTypes",{id:At.a.string.isRequired,items:At.a.arrayOf(At.a.string).isRequired,itemsLabel:At.a.string,noItemsLabel:At.a.string,placeholder:At.a.string,newItem:At.a.string,onItemAdded:At.a.func,onItemRemoved:At.a.func,onNewItemChanged:At.a.func,canEdit:At.a.bool,canRemove:At.a.bool}),sj=ij))||sj;var cj,dj;let mj=Object(os.a)("views.elements.EditableText")((dj=class e extends i.a.Component{constructor(t){super(t),Fe()(this,"state",{phase:e.Phases.Display}),Fe()(this,"showPlaceholder",e=>{e?(this._editable_div.current.textContent=this.props.placeholder,this._editable_div.current.setAttribute("class",this.props.className+" "+this.props.placeholderClassName),this.placeholder=!0,this.value=""):(this._editable_div.current.textContent=this.value,this._editable_div.current.setAttribute("class",this.props.className),this.placeholder=!1)}),Fe()(this,"getValue",()=>this.value),Fe()(this,"setValue",e=>{this.value=e,this.showPlaceholder(!this.value)}),Fe()(this,"edit",()=>{this.setState({phase:e.Phases.Edit})}),Fe()(this,"cancelEdit",()=>{this.setState({phase:e.Phases.Display}),this.value=this.props.initialValue,this.showPlaceholder(!this.value),this.onValueChanged(!1),this._editable_div.current.blur()}),Fe()(this,"onValueChanged",e=>{this.props.onValueChanged(this.value,e)}),Fe()(this,"onKeyDown",e=>{this.placeholder&&this.showPlaceholder(!1),e.key===vi.a.ENTER&&(e.stopPropagation(),e.preventDefault())}),Fe()(this,"onKeyUp",e=>{e.target.textContent?this.placeholder||(this.value=e.target.textContent):this.showPlaceholder(!0),e.key===vi.a.ENTER?this.onFinish(e):e.key===vi.a.ESCAPE&&this.cancelEdit()}),Fe()(this,"onClickDiv",t=>{this.props.editable&&this.setState({phase:e.Phases.Edit})}),Fe()(this,"onFocus",e=>{const t=e.target.childNodes[0];if(t){const e=document.createRange();e.setStart(t,0),e.setEnd(t,t.length);const a=window.getSelection();a.removeAllRanges(),a.addRange(e)}}),Fe()(this,"onFinish",(t,a)=>{const n=this,s=t.key===vi.a.ENTER||a;this.setState({phase:e.Phases.Display},()=>{this.value!==this.props.initialValue&&n.onValueChanged(s)})}),Fe()(this,"onBlur",e=>{window.getSelection().removeAllRanges(),this.props.blurToCancel?this.cancelEdit():this.onFinish(e,this.props.blurToSubmit),this.showPlaceholder(!this.value)}),this.value="",this.placeholder=!1,this._editable_div=Object(s.createRef)()}UNSAFE_componentWillReceiveProps(e){e.initialValue!==this.props.initialValue&&(this.value=e.initialValue,this._editable_div.current&&this.showPlaceholder(!this.value))}componentDidMount(){this.value=this.props.initialValue,this._editable_div.current&&this.showPlaceholder(!this.value)}render(){const{className:t,editable:a,initialValue:n,label:s,labelClassName:o}=this.props;let r;return r=!a||this.state.phase===e.Phases.Display&&(s||o)&&!this.value?i.a.createElement("div",{className:t+" "+o,onClick:this.onClickDiv},s||n):i.a.createElement("div",{ref:this._editable_div,contentEditable:!0,className:t,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onFocus:this.onFocus,onBlur:this.onBlur}),r}},Fe()(dj,"propTypes",{onValueChanged:At.a.func,initialValue:At.a.string,label:At.a.string,placeholder:At.a.string,className:At.a.string,labelClassName:At.a.string,placeholderClassName:At.a.string,blurToCancel:At.a.bool,blurToSubmit:At.a.bool,editable:At.a.bool}),Fe()(dj,"Phases",{Display:"display",Edit:"edit"}),Fe()(dj,"defaultProps",{onValueChanged(){},initialValue:"",label:"",placeholder:"",editable:!0,className:"mx_EditableText",placeholderClassName:"mx_EditableText_placeholder",blurToSubmit:!1}),cj=dj))||cj;var uj;let hj=Object(os.a)("views.elements.EditableTextContainer")(uj=class extends i.a.Component{constructor(e){super(e),this._unmounted=!1,this.state={busy:!1,errorString:null,value:e.initialValue},this._onValueChanged=this._onValueChanged.bind(this)}componentDidMount(){void 0!==this.props.getInitialValue&&(this.setState({busy:!0}),this.props.getInitialValue().then(e=>{this._unmounted||this.setState({busy:!1,value:e})},e=>{this._unmounted||this.setState({errorString:e.toString(),busy:!1})}))}componentWillUnmount(){this._unmounted=!0}_onValueChanged(e,t){t&&(this.setState({busy:!0,errorString:null}),this.props.onSubmit(e).then(()=>{this._unmounted||this.setState({busy:!1,value:e})},e=>{this._unmounted||this.setState({errorString:e.toString(),busy:!1})}))}render(){if(this.state.busy){const e=On.getComponent("elements.Spinner");return i.a.createElement(e,null)}if(this.state.errorString)return i.a.createElement("div",{className:"error"},this.state.errorString);{const e=On.getComponent("elements.EditableText");return i.a.createElement(e,{initialValue:this.state.value,placeholder:this.props.placeholder,onValueChanged:this._onValueChanged,blurToSubmit:this.props.blurToSubmit})}}})||uj;hj.propTypes={getInitialValue:At.a.func,initialValue:At.a.string,placeholder:At.a.string,onSubmit:At.a.func,blurToSubmit:At.a.bool},hj.defaultProps={initialValue:"",placeholder:"",blurToSubmit:!1,onSubmit:function(e){return Promise.resolve()}};var pj,gj=a(499);class fj extends i.a.Component{constructor(){super(),this.onClick=this.onClick.bind(this)}onClick(e){e.preventDefault(),e.stopPropagation(),gn.a.dispatch({action:"view_group",group_id:this.props.groupProfile.groupId})}render(){const e=Object(Os.b)(this.props.groupProfile.avatarUrl).getSquareThumbnailHttp(16),t=this.props.groupProfile.name?`${this.props.groupProfile.name} (${this.props.groupProfile.groupId})`:this.props.groupProfile.groupId;return i.a.createElement("img",{src:e,width:"16",height:"16",onClick:this.onClick,title:t})}}fj.propTypes={groupProfile:At.a.shape({groupId:At.a.string.isRequired,name:At.a.string,avatarUrl:At.a.string.isRequired})},fj.contextType=ns.a;let vj=Object(os.a)("views.elements.Flair")(pj=class extends i.a.Component{constructor(){super(),this.state={profiles:[]}}componentDidMount(){this._unmounted=!1,this._generateAvatars(this.props.groups)}componentWillUnmount(){this._unmounted=!0}UNSAFE_componentWillReceiveProps(e){this._generateAvatars(e.groups)}async _getGroupProfiles(e){const t=[];for(const a of e){let e=null;try{e=await pu.a.getGroupProfileCached(this.context,a)}catch(e){console.error("Could not get profile for group",a,e)}t.push(e)}return t.filter(e=>null!==e)}async _generateAvatars(e){if(!e||0===e.length)return;const t=await this._getGroupProfiles(e);this.unmounted||this.setState({profiles:t.filter(e=>!!e&&e.avatarUrl)})}render(){if(0===this.state.profiles.length)return null;const e=this.state.profiles.map((e,t)=>i.a.createElement(fj,{key:t,groupProfile:e}));return i.a.createElement("span",{className:"mx_Flair"},e)}})||pj;vj.propTypes={groups:At.a.arrayOf(At.a.string)},vj.contextType=ns.a;var bj=a(1372),yj=a(1412),Ej=a(413);const _j=[{field:"id",headerName:"ID",width:90},{field:"firstName",headerName:"First name",width:150,editable:!0},{field:"lastName",headerName:"Last name",width:150,editable:!0},{field:"age",headerName:"Age",type:"number",width:110,editable:!0},{field:"fullName",headerName:"Full name",description:"This column has a value getter and is not sortable.",sortable:!1,width:160,valueGetter:e=>`${e.getValue(e.id,"firstName")||""} ${e.getValue(e.id,"lastName")||""}`}],Sj=[{id:1,lastName:"Snow",firstName:"Jon",age:35},{id:2,lastName:"Lannister",firstName:"Cersei",age:42},{id:3,lastName:"Lannister",firstName:"Jaime",age:45},{id:4,lastName:"Stark",firstName:"Arya",age:16},{id:5,lastName:"Targaryen",firstName:"Daenerys",age:null},{id:6,lastName:"Melisandre",firstName:null,age:150},{id:7,lastName:"Clifford",firstName:"Ferrara",age:44},{id:8,lastName:"Frances",firstName:"Rossini",age:36},{id:9,lastName:"Roxie",firstName:"Harvey",age:65}];class Cj extends s.Component{render(){return s.createElement("div",{style:{height:400,width:"100%"}},s.createElement(T_.DataGrid,{rows:Sj,columns:_j,pageSize:5,checkboxSelection:!0,disableSelectionOnClick:!0}))}}var wj,Oj=a(1422);let xj=Object(os.a)("views.elements.Spoiler")(wj=class extends i.a.Component{constructor(e){super(e),this.state={visible:!1}}toggleVisible(e){this.state.visible||(e.preventDefault(),e.stopPropagation()),this.setState({visible:!this.state.visible})}render(){const e=this.props.reason?i.a.createElement("span",{className:"mx_EventTile_spoiler_reason"},"("+this.props.reason+")"):null;return i.a.createElement("span",{className:"mx_EventTile_spoiler"+(this.state.visible?" visible":""),onClick:this.toggleVisible.bind(this)},e," ",i.a.createElement("span",{className:"mx_EventTile_spoiler_content",dangerouslySetInnerHTML:{__html:this.props.contentHtml}}))}})||wj;var Rj,kj;let Ij=Object(os.a)("views.elements.TintableSvg")((kj=class e extends i.a.Component{constructor(){super(...arguments),Fe()(this,"tint",()=>{qy.a.applySvgFixups(this.fixups)}),Fe()(this,"onLoad",e=>{this.fixups=qy.a.calcSvgFixups([e.target]),qy.a.applySvgFixups(this.fixups)})}componentDidMount(){this.fixups=[],this.id=e.idSequence++,e.mounts[this.id]=this}componentWillUnmount(){delete e.mounts[this.id]}render(){return i.a.createElement("object",{className:"mx_TintableSvg "+(this.props.className?this.props.className:""),type:"image/svg+xml",data:this.props.src,width:this.props.width,height:this.props.height,onLoad:this.onLoad,tabIndex:"-1"})}},Fe()(kj,"propTypes",{src:At.a.string.isRequired,width:At.a.string.isRequired,height:At.a.string.isRequired,className:At.a.string}),Fe()(kj,"mounts",{}),Fe()(kj,"idSequence",0),Rj=kj))||Rj;qy.a.registerTintable((function(){Ij.mounts&&Object.keys(Ij.mounts).forEach(e=>{Ij.mounts[e].tint()})}));var Tj,Pj,Nj=Ij;let Dj=Object(os.a)("views.elements.TruncatedList")((Pj=class extends i.a.Component{_getChildren(e,t){return this.props.getChildren&&this.props.getChildCount?this.props.getChildren(e,t):i.a.Children.toArray(this.props.children).filter(e=>null!=e).slice(e,t)}_getChildCount(){return this.props.getChildren&&this.props.getChildCount?this.props.getChildCount():i.a.Children.toArray(this.props.children).filter(e=>null!=e).length}render(){let e=null;const t=this._getChildCount();let a=t;if(this.props.truncateAt>=0){const n=t-this.props.truncateAt;n>1&&(e=this.props.createOverflowElement(n,t),a=this.props.truncateAt)}const n=this._getChildren(0,a);return i.a.createElement("div",{className:this.props.className},n,e)}},Fe()(Pj,"propTypes",{truncateAt:At.a.number,className:At.a.string,getChildren:At.a.func,getChildCount:At.a.func,createOverflowElement:At.a.func}),Fe()(Pj,"defaultProps",{truncateAt:2,createOverflowElement:(e,t)=>i.a.createElement("div",null,Object(ts.a)("And %(count)s more...",{count:e}))}),Tj=Pj))||Tj;var jj,Aj,Mj=a(812);let Uj=Object(os.a)("views.groups.GroupInviteTile")((Aj=class extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"onClick",e=>{gn.a.dispatch({action:"view_group",group_id:this.props.group.groupId})}),Fe()(this,"onMouseEnter",()=>{const e={hover:!0};this.context.isGuest()||(e.badgeHover=!0),this.setState(e)}),Fe()(this,"onMouseLeave",()=>{this.setState({badgeHover:!1,hover:!1})}),Fe()(this,"onContextMenuButtonClick",e=>{e.stopPropagation(),e.preventDefault(),this._showContextMenu(e.target.getBoundingClientRect())}),Fe()(this,"onContextMenu",e=>{e.preventDefault(),this._showContextMenu({right:e.clientX,top:e.clientY,height:0})}),Fe()(this,"closeMenu",()=>{this.setState({contextMenuPosition:null})}),this.state={hover:!1,badgeHover:!1,menuDisplayed:!1,selected:null===this.props.group.groupId}}_showContextMenu(e){if(Cs.a.get().isGuest())return;const t={contextMenuPosition:e};this.props.collapsed&&(t.hover=!1),this.setState(t)}render(){const e=On.getComponent("elements.AccessibleButton"),t=On.getComponent("avatars.BaseAvatar"),a=this.props.group.name||this.props.group.groupId,n=this.props.group.avatarUrl?Object(Os.b)(this.props.group.avatarUrl).getSquareThumbnailHttp(24):null,s=i.a.createElement(t,{name:a,width:24,height:24,url:n}),o=Boolean(this.state.contextMenuPosition),r=Hn()("mx_RoomTile_name mx_RoomTile_invite mx_RoomTile_badgeShown",{mx_RoomTile_badgeShown:this.state.badgeHover||o}),l=i.a.createElement("div",{title:this.props.group.groupId,className:r,tabIndex:-1,dir:"auto"},a),c=this.state.badgeHover||o,d=Hn()("mx_RoomTile_badge mx_RoomTile_highlight",{mx_RoomTile_badgeButton:c}),m=c?"···":"!";let h;if(this.props.collapsed&&this.state.hover){const e=On.getComponent("elements.Tooltip");h=i.a.createElement(e,{className:"mx_RoomTile_tooltip",label:a,dir:"auto"})}const p=Hn()("mx_RoomTile mx_RoomTile_highlight",{mx_RoomTile_menuDisplayed:o,mx_RoomTile_selected:this.state.selected,mx_GroupInviteTile:!0});let g;if(o){const e=On.getComponent("context_menus.GroupInviteTileContextMenu");g=i.a.createElement(Kr.b,u()({},Object(Kr.p)(this.state.contextMenuPosition),{onFinished:this.closeMenu}),i.a.createElement(e,{group:this.props.group,onFinished:this.closeMenu}))}return i.a.createElement(i.a.Fragment,null,i.a.createElement(bs.d,null,t=>{let{onFocus:a,isActive:n,ref:r}=t;return i.a.createElement(e,{onFocus:a,tabIndex:n?0:-1,inputRef:r,className:p,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onContextMenu:this.onContextMenu},i.a.createElement("div",{className:"mx_RoomTile_avatar"},s),i.a.createElement("div",{className:"mx_RoomTile_nameContainer"},l,i.a.createElement(Kr.c,{className:d,onClick:this.onContextMenuButtonClick,label:Object(ts.a)("Options"),isExpanded:o,tabIndex:n?0:-1},m)),h)}),g)}},Fe()(Aj,"propTypes",void 0),Fe()(Aj,"contextType",ns.a),jj=Aj))||jj;var Lj,Fj,Bj=a(1361),Vj=a(570);let Gj=Object(os.a)("views.groups.GroupMemberTile")((Fj=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onClick",e=>{gn.a.dispatch({action:"view_group_user",member:this.props.member,groupId:this.props.groupId})})}render(){const e=On.getComponent("avatars.BaseAvatar"),t=On.getComponent("rooms.EntityTile"),a=this.props.member.displayname||this.props.member.userId,n=this.props.member.avatarUrl?Object(Os.b)(this.props.member.avatarUrl).getSquareThumbnailHttp(36):null,s=i.a.createElement(e,{"aria-hidden":"true",name:this.props.member.displayname||this.props.member.userId,idName:this.props.member.userId,width:36,height:36,url:n});return i.a.createElement(t,{name:a,avatarJsx:s,onClick:this.onClick,suppressOnHover:!0,presenceState:"online",powerStatus:this.props.member.isPrivileged?t.POWER_STATUS_ADMIN:null})}},Fe()(Fj,"propTypes",{groupId:At.a.string.isRequired,member:Vj.a.isRequired}),Fe()(Fj,"contextType",ns.a),Lj=Fj))||Lj;var zj,Wj;let Hj=Object(os.a)("views.groups.GroupPublicityTile")((Wj=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{busy:!1,ready:!1,isGroupPublicised:!1}),Fe()(this,"_onPublicityToggle",()=>{this.setState({busy:!0,isGroupPublicised:!this.state.isGroupPublicised}),dS.a.setGroupPublicity(this.props.groupId,!this.state.isGroupPublicised).then(()=>{this.setState({busy:!1})})})}componentDidMount(){this._initGroupStore(this.props.groupId)}_initGroupStore(e){this._groupStoreToken=dS.a.registerListener(e,()=>{this.setState({isGroupPublicised:Boolean(dS.a.getGroupPublicity(e)),ready:dS.a.isStateReady(e,dS.a.STATE_KEY.Summary)})})}componentWillUnmount(){this._groupStoreToken&&this._groupStoreToken.unregister()}render(){const e=On.getComponent("groups.GroupTile");return i.a.createElement("div",{className:"mx_GroupPublicity_toggle"},i.a.createElement(e,{groupId:this.props.groupId,showDescription:!1,avatarHeight:40,draggable:!1}),i.a.createElement(Kw.a,{checked:this.state.isGroupPublicised,disabled:!this.state.ready||this.state.busy,onChange:this._onPublicityToggle}))}},Fe()(Wj,"propTypes",{groupId:At.a.string.isRequired}),zj=Wj))||zj;var Kj,qj,Yj=a(1363),$j=a(1362);var Jj,Qj,Xj=Object(os.a)("views.groups.GroupRoomTile")((qj=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onClick",e=>{gn.a.dispatch({action:"view_group_room",groupId:this.props.groupId,groupRoomId:this.props.groupRoom.roomId})})}render(){const e=On.getComponent("avatars.BaseAvatar"),t=On.getComponent("elements.AccessibleButton"),a=this.props.groupRoom.avatarUrl?Object(Os.b)(this.props.groupRoom.avatarUrl).getSquareThumbnailHttp(36):null,n=i.a.createElement(e,{name:this.props.groupRoom.displayname,width:36,height:36,url:a});return i.a.createElement(t,{className:"mx_GroupRoomTile",onClick:this.onClick},i.a.createElement("div",{className:"mx_GroupRoomTile_avatar"},n),i.a.createElement("div",{className:"mx_GroupRoomTile_name"},this.props.groupRoom.displayname))}},Fe()(qj,"propTypes",{groupId:At.a.string.isRequired,groupRoom:Vj.b.isRequired}),Fe()(qj,"contextType",ns.a),Kj=qj))||Kj;function Zj(){}var eA,tA,aA=Object(os.a)("views.groups.GroupTile")((Qj=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{profile:null}),Fe()(this,"onMouseDown",e=>{e.preventDefault(),gn.a.dispatch({action:"view_group",group_id:this.props.groupId})})}componentDidMount(){pu.a.getGroupProfileCached(this.context,this.props.groupId).then(e=>{this.setState({profile:e})}).catch(e=>{console.error("Error whilst getting cached profile for GroupTile",e)})}render(){const e=On.getComponent("avatars.BaseAvatar"),t=On.getComponent("elements.AccessibleButton"),a=this.state.profile||{},n=a.name||this.props.groupId,s=this.props.avatarHeight,o=this.props.showDescription?i.a.createElement("div",{className:"mx_GroupTile_desc"},a.shortDescription):i.a.createElement("div",null),r=a.avatarUrl?Object(Os.b)(a.avatarUrl).getSquareThumbnailHttp(s):null;let l=i.a.createElement("div",{className:"mx_GroupTile_avatar"},i.a.createElement(e,{name:n,idName:this.props.groupId,url:r,width:s,height:s}));if(this.props.draggable){const e=l;l=i.a.createElement(as.Droppable,{droppableId:"my-groups-droppable",type:"draggable-TagTile"},(t,a)=>i.a.createElement("div",{ref:t.innerRef},i.a.createElement(as.Draggable,{key:"GroupTile "+this.props.groupId,draggableId:"GroupTile "+this.props.groupId,index:this.props.groupId,type:"draggable-TagTile"},(t,a)=>i.a.createElement("div",null,i.a.createElement("div",u()({ref:t.innerRef},t.draggableProps,t.dragHandleProps),e),t.placeholder?e:i.a.createElement("div",null)))))}return i.a.createElement(t,{className:"mx_GroupTile",onMouseDown:this.onMouseDown,onClick:Zj},l,i.a.createElement("div",{className:"mx_GroupTile_profile"},i.a.createElement("div",{className:"mx_GroupTile_name"},n),o,i.a.createElement("div",{className:"mx_GroupTile_groupId"},this.props.groupId)))}},Fe()(Qj,"propTypes",{groupId:At.a.string.isRequired,showDescription:At.a.bool,avatarHeight:At.a.number,draggable:At.a.bool}),Fe()(Qj,"contextType",ns.a),Fe()(Qj,"defaultProps",{showDescription:!0,avatarHeight:50,draggable:!0}),Jj=Qj))||Jj,nA=a(1410);let sA=Object(os.a)("views.messages.DateSeparator")((tA=class extends i.a.Component{getLabel(){const e=new Date(this.props.ts),t=new Date,a=new Date,n=[Object(ts.a)("Sunday"),Object(ts.a)("Monday"),Object(ts.a)("Tuesday"),Object(ts.a)("Wednesday"),Object(ts.a)("Thursday"),Object(ts.a)("Friday"),Object(ts.a)("Saturday")];return a.setDate(t.getDate()-1),e.toDateString()===t.toDateString()?Object(ts.a)("Today"):e.toDateString()===a.toDateString()?Object(ts.a)("Yesterday"):t.getTime()-e.getTime()<5184e5?n[e.getDay()]:Object(AT.c)(e)}render(){return i.a.createElement("h2",{className:"mx_DateSeparator",role:"separator",tabIndex:-1},i.a.createElement("hr",{role:"none"}),i.a.createElement("div",null,this.getLabel()),i.a.createElement("hr",{role:"none"}))}},Fe()(tA,"propTypes",{ts:At.a.number.isRequired}),eA=tA))||eA;var iA=a(8436),oA=a.n(iA),rA=a(8437);const lA=function(){let e=null;return function(t){return e||(e=document.createElement("textarea")),e.innerHTML=t,e.value}}();function cA(e){const t={stripReplyFallback:!0,returnString:!0};return"org.matrix.custom.html"===e.format?Object(tS.b)(e,null,t):function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}(Object(tS.b)(e,null,t))}function dA(e){const t=document.createElement(Object(tS.c)(e)?"div":"span");return t.className="mx_EditHistoryMessage_insertion",t.appendChild(e),t}function mA(e){const t=document.createElement(Object(tS.c)(e)?"div":"span");return t.className="mx_EditHistoryMessage_deletion",t.appendChild(e),t}function uA(e){if("#text"===e.nodeName)return fA(e.data);{const t=document.createElement(e.nodeName);if(e.attributes)for(const[a,n]of Object.entries(e.attributes))t.setAttribute(a,n);if(e.childNodes)for(const a of e.childNodes)t.appendChild(uA(a));return t}}function hA(e,t,a){t?e.insertBefore(a,t):e.appendChild(a)}function pA(e,t){for(let a=0;a<e.length-1;++a)if(e[a]!==t[a])return!1;const a=e.length-1;return t[a]>=e[a]}function gA(e,t){if("removeTextElement"===e.action||"removeElement"===e.action){const a=1;for(const n of t)pA(e.route,n.route)&&(n.route[e.route.length-1]+=a)}}function fA(e){return document.createTextNode(lA(e))}function vA(e,t,a){const{refNode:n,refParentNode:s}=function(e,t,a){let n,s=e;const i=a?t.length-1:t.length;for(let e=0;e<i;++e)n=s,s=s.childNodes[t[e]];return{refNode:s,refParentNode:n}}(e,t.route);switch(t.action){case"replaceElement":{const e=document.createElement("span"),a=mA(uA(t.oldValue)),s=dA(uA(t.newValue));e.appendChild(a),e.appendChild(s),n.parentNode.replaceChild(e,n);break}case"removeTextElement":{const e=mA(fA(t.value));n.parentNode.replaceChild(e,n);break}case"removeElement":{const e=mA(uA(t.element));n.parentNode.replaceChild(e,n);break}case"modifyTextElement":{const e=a.diff_main(t.oldValue,t.newValue);a.diff_cleanupSemantic(e);const s=document.createElement("span");for(const[t,a]of e){let e=fA(a);t<0?e=mA(e):t>0&&(e=dA(e)),s.appendChild(e)}n.parentNode.replaceChild(s,n);break}case"addElement":hA(s,n,dA(uA(t.element)));break;case"addTextElement":hA(s,n,dA(fA("\n"!==t.value?t.value:"")));break;case"removeAttribute":case"addAttribute":case"modifyAttribute":{const e=mA(n.cloneNode(!0)),a=n.cloneNode(!0);"addAttribute"===t.action||"modifyAttribute"===t.action?a.setAttribute(t.name,t.newValue):a.removeAttribute(t.name);const s=dA(a),i=document.createElement(Object(tS.c)(n)?"div":"span");i.appendChild(e),i.appendChild(s),n.parentNode.replaceChild(i,n);break}default:console.warn("MessageDiffUtils::editBodyDiffToHtml: diff action not supported atm",t)}}function bA(e,t){return e.length===t.length&&!e.some((e,a)=>e!==t[a])}function yA(e,t){const a=`<div>${cA(e)}</div>`,n=`<div>${cA(t)}</div>`,s=function(e){const t=e.slice();for(let e=0;e<t.length;++e){const a=t[e];if("removeTextElement"===a.action){const n=t[e+1];n&&"addTextElement"===n.action&&n.text===a.text&&bA(n.route,a.route)&&t.splice(e,2)}}return t}((new rA.DiffDOM).diff(a,n)),o=new oA.a,r=(new DOMParser).parseFromString(a,"text/html").body.children[0];for(let e=0;e<s.length;++e){const t=s[e];vA(r,t,o),gA(t,s.slice(e+1))}const l=r.innerHTML,c=Hn()({mx_EventTile_body:!0,"markdown-body":!0});return i.a.createElement("span",{key:"body",className:c,dangerouslySetInnerHTML:{__html:l},dir:"auto"})}var EA,_A,SA=a(1534);function CA(e){const t=e.getOriginalContent();return t["m.new_content"]||t}let wA=Object(os.a)("views.messages.EditHistoryMessage")((_A=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"_onAssociatedStatusChanged",()=>{this.setState({sendStatus:this.props.mxEvent.getAssociatedStatus()})}),Fe()(this,"_onRedactClick",async()=>{const e=this.props.mxEvent,t=Cs.a.get(),a=On.getComponent("dialogs.ConfirmAndWaitRedactDialog");qd.a.createTrackedDialog("Confirm Redact Dialog","Edit history",a,{redact:()=>t.redactEvent(e.getRoomId(),e.getId())},"mx_Dialog_confirmredact")}),Fe()(this,"_onViewSourceClick",()=>{const e=On.getComponent("structures.ViewSource");qd.a.createTrackedDialog("View Event Source","Edit history",e,{mxEvent:this.props.mxEvent},"mx_Dialog_viewsource")});const t=Cs.a.get(),{userId:a}=t.credentials,n=this.props.mxEvent,i=t.getRoom(n.getRoomId());n.localRedactionEvent()&&n.localRedactionEvent().on("status",this._onAssociatedStatusChanged);const o=i.currentState.maySendRedactionForEvent(n,a);this.state={canRedact:o,sendStatus:n.getAssociatedStatus()},this._content=Object(s.createRef)(),this._pills=[]}pillifyLinks(){this._content.current&&Object(SA.a)(this._content.current.children,this.props.mxEvent,this._pills)}componentDidMount(){this.pillifyLinks()}componentWillUnmount(){Object(SA.b)(this._pills);const e=this.props.mxEvent;e.localRedactionEvent()&&e.localRedactionEvent().off("status",this._onAssociatedStatusChanged)}componentDidUpdate(){this.pillifyLinks()}_renderActionBar(){const e=On.getComponent("elements.AccessibleButton");let t;this.props.mxEvent.isRedacted()||this.props.isBaseEvent||!this.state.canRedact||(t=i.a.createElement(e,{onClick:this._onRedactClick},Object(ts.a)("Remove")));const a=i.a.createElement(e,{onClick:this._onViewSourceClick},Object(ts.a)("View Source"));return i.a.createElement("div",{className:"mx_MessageActionBar"},t,a)}render(){const{mxEvent:e}=this.props,t=CA(e);let a;if(e.isRedacted())a=i.a.createElement(ex.a,{mxEvent:this.props.mxEvent});else{let n;if(n=this.props.previousEdit?yA(CA(this.props.previousEdit),t):tS.b(t,null,{stripReplyFallback:!0}),"m.emote"===e.getContent().msgtype){const t=e.sender?e.sender.name:e.getSender();a=i.a.createElement("div",{className:"mx_EventTile_content",ref:this._content},"* ",i.a.createElement("span",{className:"mx_MEmoteBody_sender"},t)," ",n)}else a=i.a.createElement("div",{className:"mx_EventTile_content",ref:this._content},n)}const n=Object(AT.e)(new Date(e.getTs()),this.props.isTwelveHour),s=-1!==["sending","queued","encrypting"].indexOf(this.state.sendStatus),o=Hn()({mx_EventTile:!0,mx_EventTile_sending:s});return i.a.createElement("li",null,i.a.createElement("div",{className:o},i.a.createElement("div",{className:"mx_EventTile_line"},i.a.createElement("span",{className:"mx_MessageTimestamp"},n),a,this._renderActionBar())))}},Fe()(_A,"propTypes",{mxEvent:At.a.instanceOf(XT.b).isRequired,previousEdit:At.a.instanceOf(XT.b),isBaseEvent:At.a.bool}),EA=_A))||EA;var OA,xA;let RA=Object(os.a)("views.messages.MImageBody")((xA=class extends i.a.Component{constructor(e){super(e),this.onImageError=this.onImageError.bind(this),this.onImageLoad=this.onImageLoad.bind(this),this.onImageEnter=this.onImageEnter.bind(this),this.onImageLeave=this.onImageLeave.bind(this),this.onClientSync=this.onClientSync.bind(this),this.onClick=this.onClick.bind(this),this._isGif=this._isGif.bind(this),this.state={decryptedUrl:null,decryptedThumbnailUrl:null,decryptedBlob:null,error:null,imgError:!1,imgLoaded:!1,loadedImageDimensions:null,hover:!1,showImage:ss.b.getValue("showImages")},this._image=Object(s.createRef)()}onClientSync(e,t){if(this.unmounted)return;"ERROR"!==e&&t!==e&&this.state.imgError&&this.setState({imgError:!1})}showImage(){localStorage.setItem("mx_ShowImage_"+this.props.mxEvent.getId(),"true"),this.setState({showImage:!0}),this._downloadImage()}onClick(e){if(0===e.button&&!e.metaKey){if(e.preventDefault(),!this.state.showImage)return void this.showImage();const t=this.props.mxEvent.getContent(),a=this._getContentUrl(),n=On.getComponent("elements.ImageView"),s={src:a,name:t.body&&t.body.length>0?t.body:Object(ts.a)("Attachment"),mxEvent:this.props.mxEvent,permalinkCreator:this.props.permalinkCreator};t.info&&(s.width=t.info.w,s.height=t.info.h,s.fileSize=t.info.size),qd.a.createDialog(n,s,"mx_Dialog_lightbox",null,!0)}}_isGif(){const e=this.props.mxEvent.getContent();return e&&e.info&&"image/gif"===e.info.mimetype}onImageEnter(e){if(this.setState({hover:!0}),!this.state.showImage||!this._isGif()||ss.b.getValue("autoplayGifsAndVideos"))return;e.target.src=this._getContentUrl()}onImageLeave(e){if(this.setState({hover:!1}),!this.state.showImage||!this._isGif()||ss.b.getValue("autoplayGifsAndVideos"))return;e.target.src=this._getThumbUrl()}onImageError(){this.setState({imgError:!0})}onImageLoad(){let e;if(this.props.onHeightChanged(),this._image.current){const{naturalWidth:t,naturalHeight:a}=this._image.current;e={naturalWidth:t,naturalHeight:a}}this.setState({imgLoaded:!0,loadedImageDimensions:e})}_getContentUrl(){const e=Object(Os.a)(this.props.mxEvent.getContent());return e.isEncrypted?this.state.decryptedUrl:e.srcHttp}_getThumbUrl(){const e=this.props.mxEvent.getContent(),t=Object(Os.a)(e);if(t.isEncrypted)return this.state.decryptedThumbnailUrl?this.state.decryptedThumbnailUrl:this.state.decryptedUrl;if(e.info&&"image/svg+xml"===e.info.mimetype&&t.hasThumbnail)return t.getThumbnailHttp(800,600,"scale");{const a=e.info;if(!this._isGif()&&1!==window.devicePixelRatio&&a&&a.w&&a.h&&a.size){const e=a.w>800||a.h>600;return a.size>1048576&&e?t.getThumbnailOfSourceHttp(800,600):t.srcHttp}return t.getThumbnailOfSourceHttp(800,600)}}_downloadImage(){const e=this.props.mxEvent.getContent();if(void 0!==e.file&&null===this.state.decryptedUrl){let t,a=Promise.resolve(null);e.info&&e.info.thumbnail_file&&(a=kO(e.info.thumbnail_file).then((function(e){return URL.createObjectURL(e)}))),a.then(a=>kO(e.file).then((function(e){return t=e,URL.createObjectURL(e)})).then(e=>{this.unmounted||this.setState({decryptedUrl:e,decryptedThumbnailUrl:a,decryptedBlob:t})})).catch(e=>{this.unmounted||(console.warn("Unable to decrypt attachment: ",e),this.setState({error:e}))})}}componentDidMount(){this.unmounted=!1,this.context.on("sync",this.onClientSync);(this.state.showImage||"true"===localStorage.getItem("mx_ShowImage_"+this.props.mxEvent.getId()))&&(this._downloadImage(),this.setState({showImage:!0})),this._afterComponentDidMount()}_afterComponentDidMount(){}componentWillUnmount(){this.unmounted=!0,this.context.removeListener("sync",this.onClientSync),this._afterComponentWillUnmount(),this.state.decryptedUrl&&URL.revokeObjectURL(this.state.decryptedUrl),this.state.decryptedThumbnailUrl&&URL.revokeObjectURL(this.state.decryptedThumbnailUrl)}_afterComponentWillUnmount(){}_messageContent(e,t,a){let n,s;if(a&&a.info&&a.info.w&&a.info.h)n=a.info.w,s=a.info.h;else{if(!this.state.loadedImageDimensions){let n;return n=this.state.showImage?i.a.createElement("img",{style:{display:"none"},src:t,ref:this._image,alt:a.body,onError:this.onImageError,onLoad:this.onImageLoad}):i.a.createElement(kA,null),this.wrapImage(e,n)}n=this.state.loadedImageDimensions.naturalWidth,s=this.state.loadedImageDimensions.naturalHeight}const o=Math.min(this.props.maxImageHeight||600,s),r=n*o/s;let l=null,c=null,d=null;void 0!==a.file&&null===this.state.decryptedUrl?c=i.a.createElement(Cu.a,{w:32,h:32}):this.state.imgLoaded||(c=this.getPlaceholder());let m=Boolean(c);t&&!this.state.imgError&&(l=i.a.createElement("img",{className:"mx_MImageBody_thumbnail",src:t,ref:this._image,style:{maxWidth:r+"px"},alt:a.body,onError:this.onImageError,onLoad:this.onImageLoad,onMouseEnter:this.onImageEnter,onMouseLeave:this.onImageLeave})),this.state.showImage||(l=i.a.createElement(kA,{style:{maxWidth:r+"px"}}),m=!1),!this._isGif()||ss.b.getValue("autoplayGifsAndVideos")||this.state.hover||(d=i.a.createElement("p",{className:"mx_MImageBody_gifLabel"},"GIF"));const u=i.a.createElement("div",{className:"mx_MImageBody_thumbnail_container",style:{maxHeight:o+"px"}},i.a.createElement("div",{style:{paddingBottom:100*s/n+"%"}}),m&&i.a.createElement("div",{className:"mx_MImageBody_thumbnail",style:{maxWidth:n+"px"}},i.a.createElement("div",{className:"mx_MImageBody_thumbnail_spinner"},c)),i.a.createElement("div",{style:{display:m?"none":void 0}},l,d),this.state.hover&&this.getTooltip());return this.wrapImage(e,u)}wrapImage(e,t){return i.a.createElement("a",{href:e,onClick:this.onClick},t)}getPlaceholder(){return null}getTooltip(){return null}getFileBody(){return i.a.createElement(PO,u()({},this.props,{decryptedBlob:this.state.decryptedBlob,showGenericPlaceholder:!1}))}render(){const e=this.props.mxEvent.getContent();if(null!==this.state.error)return i.a.createElement("span",{className:"mx_MImageBody"},i.a.createElement("img",{src:a(373),width:"16",height:"16"}),Object(ts.a)("Error decrypting image"));const t=this._getContentUrl();let n;n=this._isGif()&&ss.b.getValue("autoplayGifsAndVideos")?t:this._getThumbUrl();const s=this._messageContent(t,n,e),o=this.getFileBody();return i.a.createElement("span",{className:"mx_MImageBody"},s,o)}},Fe()(xA,"propTypes",{mxEvent:At.a.object.isRequired,onHeightChanged:At.a.func.isRequired,maxImageHeight:At.a.number,permalinkCreator:At.a.object}),Fe()(xA,"contextType",ns.a),OA=xA))||OA;class kA extends i.a.PureComponent{render(){let e="mx_HiddenImagePlaceholder";return this.props.hover&&(e+=" mx_HiddenImagePlaceholder_hover"),i.a.createElement("div",{className:e},i.a.createElement("div",{className:"mx_HiddenImagePlaceholder_button"},i.a.createElement("span",{className:"mx_HiddenImagePlaceholder_eye"}),i.a.createElement("span",null,Object(ts.a)("Show image"))))}}var IA;Fe()(kA,"propTypes",{hover:At.a.bool});let TA=Object(os.a)("views.messages.MKeyVerificationConclusion")(IA=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_onRequestChanged",()=>{this.forceUpdate()}),Fe()(this,"_onTrustChanged",(e,t)=>{const{mxEvent:a}=this.props,n=a.verificationRequest;n&&n.otherUserId===e&&this.forceUpdate()})}componentDidMount(){const e=this.props.mxEvent.verificationRequest;e&&e.on("change",this._onRequestChanged),Cs.a.get().on("userTrustStatusChanged",this._onTrustChanged)}componentWillUnmount(){const e=this.props.mxEvent.verificationRequest;e&&e.off("change",this._onRequestChanged);const t=Cs.a.get();t&&t.removeListener("userTrustStatusChanged",this._onTrustChanged)}_shouldRender(e,t){return!!t&&(!("m.key.verification.cancel"===e.getType()&&!t.cancelled)&&(!("m.key.verification.done"===e.getType()&&!t.done)&&(!t.pending&&!!Cs.a.get().checkUserTrust(t.otherUserId).isCrossSigningVerified())))}render(){const{mxEvent:e}=this.props,t=e.verificationRequest;if(!this._shouldRender(e,t))return null;const a=Cs.a.get().getUserId();let n;if(t.done)n=Object(ts.a)("You verified %(name)s",{name:$I(t.otherUserId,e)});else if(t.cancelled){const s=t.cancellingUserId;n=s===a?Object(ts.a)("You cancelled verifying %(name)s",{name:$I(t.otherUserId,e)}):Object(ts.a)("%(name)s cancelled verifying",{name:$I(s,e)})}if(n){const a=Hn()("mx_cryptoEvent mx_cryptoEvent_icon",{mx_cryptoEvent_icon_verified:t.done});return i.a.createElement(bO,{className:a,title:n,subtitle:JI(t.otherUserId,e.getRoomId())})}return null}})||IA;var PA;TA.propTypes={mxEvent:At.a.object.isRequired};let NA=Object(os.a)("views.messages.MKeyVerificationRequest")(PA=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_openRequest",()=>{const{verificationRequest:e}=this.props.mxEvent,t=Cs.a.get().getUser(e.otherUserId);gn.a.dispatch({action:js.a.SetRightPanelPhase,phase:_m.c.EncryptionPanel,refireParams:{verificationRequest:e,member:t}})}),Fe()(this,"_onRequestChanged",()=>{this.forceUpdate()}),Fe()(this,"_onAcceptClicked",async()=>{const e=this.props.mxEvent.verificationRequest;if(e)try{this._openRequest(),await e.accept()}catch(e){console.error(e.message)}}),Fe()(this,"_onRejectClicked",async()=>{const e=this.props.mxEvent.verificationRequest;if(e)try{await e.cancel()}catch(e){console.error(e.message)}}),this.state={}}componentDidMount(){const e=this.props.mxEvent.verificationRequest;e&&e.on("change",this._onRequestChanged)}componentWillUnmount(){const e=this.props.mxEvent.verificationRequest;e&&e.off("change",this._onRequestChanged)}_acceptedLabel(e){return e===Cs.a.get().getUserId()?Object(ts.a)("You accepted"):Object(ts.a)("%(name)s accepted",{name:$I(e,this.props.mxEvent.getRoomId())})}_cancelledLabel(e){const t=Cs.a.get().getUserId(),{cancellationCode:a}=this.props.mxEvent.verificationRequest,n="m.user"===a;return e===t?n?Object(ts.a)("You declined"):Object(ts.a)("You cancelled"):n?Object(ts.a)("%(name)s declined",{name:$I(e,this.props.mxEvent.getRoomId())}):Object(ts.a)("%(name)s cancelled",{name:$I(e,this.props.mxEvent.getRoomId())})}render(){const e=On.getComponent("elements.AccessibleButton"),t=On.getComponent("elements.FormButton"),{mxEvent:a}=this.props,n=a.verificationRequest;if(!n||n.invalid)return null;let s,o,r;if(!n.canAccept){let t;n.ready||n.started||n.done?t=i.a.createElement(e,{onClick:this._openRequest},this._acceptedLabel(n.receivingUserId)):n.cancelled?t=this._cancelledLabel(n.cancellingUserId):n.accepting?t=Object(ts.a)("Accepting …"):n.declining&&(t=Object(ts.a)("Declining …")),r=i.a.createElement("div",{className:"mx_cryptoEvent_state"},t)}if(n.initiatedByMe)s=Object(ts.a)("You sent a verification request"),o=JI(n.receivingUserId,a.getRoomId());else{const e=$I(n.requestingUserId,a.getRoomId());s=Object(ts.a)("%(name)s wants to verify",{name:e}),o=JI(n.requestingUserId,a.getRoomId()),n.canAccept&&(r=i.a.createElement("div",{className:"mx_cryptoEvent_buttons"},i.a.createElement(t,{kind:"danger",onClick:this._onRejectClicked,label:Object(ts.a)("Decline")}),i.a.createElement(t,{onClick:this._onAcceptClicked,label:Object(ts.a)("Accept")})))}return s?i.a.createElement(bO,{className:"mx_cryptoEvent mx_cryptoEvent_icon",title:s,subtitle:o},r):null}})||PA;var DA;NA.propTypes={mxEvent:At.a.object.isRequired};let jA=Object(os.a)("views.messages.MStickerBody")(DA=class extends RA{onClick(e){e.preventDefault(),this.state.showImage||this.showImage()}wrapImage(e,t){let a=null;return this.state.showImage||(a=this.onClick),i.a.createElement("div",{className:"mx_MStickerBody_wrapper",onClick:a}," ",t," ")}getPlaceholder(){const e=On.getComponent("elements.TintableSvg");return i.a.createElement(e,{src:a(8438),width:"75",height:"75"})}getTooltip(){const e=this.props.mxEvent&&this.props.mxEvent.getContent();if(!(e&&e.body&&e.info&&e.info.w))return null;const t=On.getComponent("elements.Tooltip");return i.a.createElement("div",{style:{left:e.info.w+"px"},className:"mx_MStickerBody_tooltip"},i.a.createElement(t,{label:e.body}))}getFileBody(){return null}})||DA;var AA,MA,UA=a(799);const LA=e=>{let{mxEvent:t,getTile:a,getReplyThread:n,permalinkCreator:o,onFocusChange:r}=e;const[l,c,d,m]=Object(Kr.q)(),[h,p,g]=Object(bs.e)(c);let f;if(Object(s.useEffect)(()=>{r(l)},[r,l]),l){const e=On.getComponent("context_menus.MessageContextMenu"),s=a&&a(),r=n&&n(),l=c.current.getBoundingClientRect();f=i.a.createElement(Kr.b,u()({},Object(Kr.k)(l),{onFinished:m}),i.a.createElement(e,{mxEvent:t,permalinkCreator:o,eventTileOps:s&&s.getEventTileOps?s.getEventTileOps():void 0,collapseReplyThread:r&&r.canCollapse()?r.collapse:void 0,onFinished:m}))}return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kr.d,{className:"mx_MessageActionBar_maskButton mx_MessageActionBar_optionsButton",title:Object(ts.a)("Options"),onClick:d,isExpanded:l,inputRef:g,onFocus:h,tabIndex:p?0:-1}),f)},FA=e=>{let{mxEvent:t,reactions:a,onFocusChange:n}=e;const[o,r,l,c]=Object(Kr.q)(),[d,m,h]=Object(bs.e)(r);let p;if(Object(s.useEffect)(()=>{n(o)},[n,o]),o){const e=r.current.getBoundingClientRect(),n=On.getComponent("emojipicker.ReactionPicker");p=i.a.createElement(Kr.b,u()({},Object(Kr.k)(e),{onFinished:c,managed:!1}),i.a.createElement(n,{mxEvent:t,reactions:a,onFinished:c}))}return i.a.createElement(i.a.Fragment,null,i.a.createElement(Kr.d,{className:"mx_MessageActionBar_maskButton mx_MessageActionBar_reactButton",title:Object(ts.a)("React"),onClick:l,isExpanded:o,inputRef:h,onFocus:d,tabIndex:m?0:-1}),p)};let BA=Object(os.a)("views.messages.MessageActionBar")((MA=class extends i.a.PureComponent{constructor(){super(...arguments),Fe()(this,"onDecrypted",()=>{this.forceUpdate()}),Fe()(this,"onBeforeRedaction",()=>{this.forceUpdate()}),Fe()(this,"onSent",()=>{this.forceUpdate()}),Fe()(this,"onFocusChange",e=>{this.props.onFocusChange&&this.props.onFocusChange(e)}),Fe()(this,"onReplyClick",e=>{gn.a.dispatch({action:"reply_to_event",event:this.props.mxEvent})}),Fe()(this,"onEditClick",e=>{gn.a.dispatch({action:"edit_event",event:this.props.mxEvent})}),Fe()(this,"onResendClick",e=>{this.runActionOnFailedEv(e=>UA.a.resend(e))}),Fe()(this,"onCancelClick",e=>{this.runActionOnFailedEv(e=>UA.a.removeFromQueue(e),e=>Object(tN.a)(e.status))})}componentDidMount(){this.props.mxEvent.status&&this.props.mxEvent.status!==XT.a.SENT&&this.props.mxEvent.on("Event.status",this.onSent);Cs.a.get().decryptEventIfNeeded(this.props.mxEvent),this.props.mxEvent.isBeingDecrypted()&&this.props.mxEvent.once("Event.decrypted",this.onDecrypted),this.props.mxEvent.on("Event.beforeRedaction",this.onBeforeRedaction)}componentWillUnmount(){this.props.mxEvent.off("Event.status",this.onSent),this.props.mxEvent.off("Event.decrypted",this.onDecrypted),this.props.mxEvent.off("Event.beforeRedaction",this.onBeforeRedaction)}runActionOnFailedEv(e,t){t||(t=()=>!0);const a=this.props.mxEvent,n=a.replacingEvent(),s=[a.localRedactionEvent(),n,a];for(const a of s)if(a&&t(a)){e(a);break}}render(){const e=[];Object(WO.a)(this.props.mxEvent)&&e.push(i.a.createElement(bs.b,{className:"mx_MessageActionBar_maskButton mx_MessageActionBar_editButton",title:Object(ts.a)("Edit"),onClick:this.onEditClick,key:"edit"}));const t=i.a.createElement(bs.b,{className:"mx_MessageActionBar_maskButton mx_MessageActionBar_cancelButton",title:Object(ts.a)("Delete"),onClick:this.onCancelClick,key:"cancel"}),a=this.props.mxEvent,n=a.replacingEvent()&&a.replacingEvent().status,s=a.localRedactionEvent()&&a.localRedactionEvent().status,o=Object(tN.a)(a.status)||Object(tN.a)(n)||Object(tN.a)(s),r=[a.status,n,s].includes("not_sent");return o&&r?(e.splice(0,0,i.a.createElement(bs.b,{className:"mx_MessageActionBar_maskButton mx_MessageActionBar_resendButton",title:Object(ts.a)("Retry"),onClick:this.onResendClick,key:"resend"})),e.push(t)):(Object(WO.c)(this.props.mxEvent)&&(this.context.canReply&&e.splice(0,0,i.a.createElement(bs.b,{className:"mx_MessageActionBar_maskButton mx_MessageActionBar_replyButton",title:Object(ts.a)("Reply"),onClick:this.onReplyClick,key:"reply"})),this.context.canReact&&e.splice(0,0,i.a.createElement(FA,{mxEvent:this.props.mxEvent,reactions:this.props.reactions,onFocusChange:this.onFocusChange,key:"react"}))),o&&e.push(t),e.push(i.a.createElement(LA,{mxEvent:this.props.mxEvent,getReplyThread:this.props.getReplyThread,getTile:this.props.getTile,permalinkCreator:this.props.permalinkCreator,onFocusChange:this.onFocusChange,key:"menu"}))),i.a.createElement(Ei,{className:"mx_MessageActionBar","aria-label":Object(ts.a)("Message Actions"),"aria-live":"off"},e)}},Fe()(MA,"propTypes",{mxEvent:At.a.object.isRequired,reactions:At.a.object,permalinkCreator:At.a.object,getTile:At.a.func,getReplyThread:At.a.func,onFocusChange:At.a.func}),Fe()(MA,"contextType",Zc.a),AA=MA))||AA;var VA,GA,zA=a(1339),WA=a(1341);let HA=Object(os.a)("views.messages.MjolnirBody")((GA=class extends i.a.Component{constructor(){super(),Fe()(this,"_onAllowClick",e=>{e.preventDefault(),e.stopPropagation();const t=`mx_mjolnir_render_${this.props.mxEvent.getRoomId()}__${this.props.mxEvent.getId()}`;localStorage.setItem(t,"true"),this.props.onMessageAllowed()})}render(){return i.a.createElement("div",{className:"mx_MjolnirBody"},i.a.createElement("i",null,Object(ts.a)("You have ignored this user, so their message is hidden. <a>Show anyways.</a>",{},{a:e=>i.a.createElement("a",{href:"#",onClick:this._onAllowClick},e)})))}},Fe()(GA,"propTypes",{mxEvent:At.a.object.isRequired,onMessageAllowed:At.a.func.isRequired}),VA=GA))||VA;var KA,qA;let YA=Object(os.a)("views.messages.RoomAvatarEvent")((qA=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onAvatarClick",()=>{const e=Cs.a.get(),t=this.props.mxEvent,a=Object(Os.b)(t.getContent().url).srcHttp,n=e.getRoom(this.props.mxEvent.getRoomId()),s=Object(ts.a)("%(senderDisplayName)s changed the avatar for %(roomName)s",{senderDisplayName:t.sender&&t.sender.name?t.sender.name:t.getSender(),roomName:n?n.name:""}),i=On.getComponent("elements.ImageView"),o={src:a,name:s};qd.a.createDialog(i,o,"mx_Dialog_lightbox",null,!0)})}render(){const e=this.props.mxEvent,t=e.sender&&e.sender.name?e.sender.name:e.getSender(),a=On.getComponent("avatars.RoomAvatar");if(!e.getContent().url||0===e.getContent().url.trim().length)return i.a.createElement("div",{className:"mx_TextualEvent"},Object(ts.a)("%(senderDisplayName)s removed the room avatar.",{senderDisplayName:t}));const n=Cs.a.get().getRoom(e.getRoomId()),s={avatarUrl:e.getContent().url,name:n?n.name:""};return i.a.createElement("div",{className:"mx_RoomAvatarEvent"},Object(ts.a)("%(senderDisplayName)s changed the room avatar to <img/>",{senderDisplayName:t},{img:()=>i.a.createElement(Fs.a,{key:"avatar",className:"mx_RoomAvatarEvent_avatar",onClick:this.onAvatarClick},i.a.createElement(a,{width:14,height:14,oobData:s}))}))}},Fe()(qA,"propTypes",{mxEvent:At.a.object.isRequired}),KA=qA))||KA;var $A,JA;let QA=Object(os.a)("views.messages.RoomCreate")((JA=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_onLinkClicked",e=>{e.preventDefault();const t=this.props.mxEvent.getContent().predecessor;gn.a.dispatch({action:"view_room",event_id:t.event_id,highlighted:!0,room_id:t.room_id})})}render(){const e=this.props.mxEvent.getContent().predecessor;if(void 0===e)return i.a.createElement("div",null);const t=Cs.a.get().getRoom(e.room_id),a=new Ix.a(t,e.room_id);a.load();const n=a.forEvent(e.event_id),s=i.a.createElement("a",{href:n,onClick:this._onLinkClicked},Object(ts.a)("Click here to see older messages."));return i.a.createElement(bO,{className:"mx_CreateEvent",title:Object(ts.a)("This room is a continuation of another conversation."),subtitle:s})}},Fe()(JA,"propTypes",{mxEvent:At.a.object.isRequired}),$A=JA))||$A;var XA,ZA;let eM=Object(os.a)("views.messages.SenderProfile")((ZA=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onRoomStateEvents",e=>{"m.room.related_groups"===e.getType()&&e.getRoomId()===this.props.mxEvent.getRoomId()&&this._updateRelatedGroups()});const t=this.props.mxEvent.getSender();this.state={userGroups:pu.a.cachedPublicisedGroups(t)||[],relatedGroups:[]}}componentDidMount(){this.unmounted=!1,this._updateRelatedGroups(),0===this.state.userGroups.length&&this.getPublicisedGroups(),this.context.on("RoomState.events",this.onRoomStateEvents)}componentWillUnmount(){this.unmounted=!0,this.context.removeListener("RoomState.events",this.onRoomStateEvents)}async getPublicisedGroups(){if(!this.unmounted){const e=await pu.a.getPublicisedGroupsCached(this.context,this.props.mxEvent.getSender());this.setState({userGroups:e})}}_updateRelatedGroups(){if(this.unmounted)return;const e=this.context.getRoom(this.props.mxEvent.getRoomId());if(!e)return;const t=e.currentState.getStateEvents("m.room.related_groups","");this.setState({relatedGroups:t&&t.getContent().groups||[]})}_getDisplayedGroups(e,t){let a=e||[];return a=t&&t.length>0?t.filter(e=>a.includes(e)):[],a}render(){const{mxEvent:e}=this.props,t=Object(hs.f)(e.getSender()),a=e.sender?e.sender.name:e.getSender(),{msgtype:n}=e.getContent();if("m.emote"===n)return null;let s=null;if(this.props.enableFlair){const t=this._getDisplayedGroups(this.state.userGroups,this.state.relatedGroups);s=i.a.createElement(vj,{key:"flair",userId:e.getSender(),groups:t})}const o=a||"";return i.a.createElement("div",{className:"mx_SenderProfile mx_SenderProfile_hover",dir:"auto",onClick:this.props.onClick},i.a.createElement("span",{className:"mx_SenderProfile_name "+t},o),s)}},Fe()(ZA,"propTypes",{mxEvent:At.a.object.isRequired,onClick:At.a.func}),Fe()(ZA,"contextType",ns.a),XA=ZA))||XA;var tM,aM,nM=a(8439);let sM=Object(os.a)("views.messages.TextualEvent")((aM=class extends i.a.Component{render(){const e=UT.a(this.props.mxEvent);return null==e||0===e.length?null:i.a.createElement("div",{className:"mx_TextualEvent"},e)}},Fe()(aM,"propTypes",{mxEvent:At.a.object.isRequired}),tM=aM))||tM;var iM;let oM=Object(os.a)("views.messages.TileErrorBoundary")(iM=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_onBugReport",()=>{const e=On.getComponent("dialogs.BugReportDialog");e&&qd.a.createTrackedDialog("Bug Report Dialog","",e,{label:"react-soft-crash-tile"})}),this.state={error:null}}static getDerivedStateFromError(e){return{error:e}}render(){if(this.state.error){const{mxEvent:e}=this.props,t={mx_EventTile:!0,mx_EventTile_info:!0,mx_EventTile_content:!0,mx_EventTile_tileError:!0};let a;return $c.a.get().bug_report_endpoint_url&&(a=i.a.createElement("a",{onClick:this._onBugReport,href:"#"},Object(ts.a)("Submit logs"))),i.a.createElement("div",{className:Hn()(t)},i.a.createElement("div",{className:"mx_EventTile_line"},i.a.createElement("span",null,Object(ts.a)("Can't load this message"),e&&` (${e.getType()})`,a)))}return this.props.children}})||iM;var rM,lM,cM=a(1340);let dM=Object(os.a)("views.messages.ViewSourceEvent")((lM=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"onToggle",e=>{e.preventDefault();const{expanded:t}=this.state;this.setState({expanded:!t})}),this.state={expanded:!1}}componentDidMount(){const{mxEvent:e}=this.props;Cs.a.get().decryptEventIfNeeded(e),e.isBeingDecrypted()&&e.once("Event.decrypted",()=>this.forceUpdate())}render(){const{mxEvent:e}=this.props,{expanded:t}=this.state;let a;a=t?i.a.createElement("pre",null,JSON.stringify(e,null,4)):i.a.createElement("code",null,`{ "type": ${e.getType()} }`);const n=Hn()("mx_ViewSourceEvent mx_EventTile_content",{mx_ViewSourceEvent_expanded:t});return i.a.createElement("span",{className:n},a,i.a.createElement("a",{className:"mx_ViewSourceEvent_toggle",href:"#",onClick:this.onToggle}))}},Fe()(lM,"propTypes",{mxEvent:At.a.object.isRequired}),rM=lM))||rM;var mM;let uM=Object(os.a)("views.room_settings.RoomPublishSetting")(mM=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"onRoomPublishChange",e=>{const t=this.state.isRoomPublished,a=!t;this.setState({isRoomPublished:a});Cs.a.get().setRoomDirectoryVisibility(this.props.roomId,a?"public":"private").catch(()=>{this.setState({isRoomPublished:t})})}),this.state={isRoomPublished:!1}}componentDidMount(){Cs.a.get().getRoomDirectoryVisibility(this.props.roomId).then(e=>{this.setState({isRoomPublished:"public"===e.visibility})})}render(){const e=Cs.a.get();return i.a.createElement(FI.a,{value:this.state.isRoomPublished,onChange:this.onRoomPublishChange,disabled:!this.props.canSetCanonicalAlias,label:Object(ts.a)("Publish this room to the public in %(domain)s's room directory?",{domain:e.getDomain()})})}})||mM;var hM,pM;class gM extends lj{constructor(e){super(e),Fe()(this,"_onAliasAdded",async()=>{await this._aliasField.current.validate({allowEmpty:!1}),this._aliasField.current.isValid?this.props.onItemAdded&&this.props.onItemAdded(this.props.newItem):(this._aliasField.current.focus(),this._aliasField.current.validate({allowEmpty:!1,focused:!0}))}),this._aliasField=Object(s.createRef)()}_renderNewItemField(){if(!this.props.domain)return super._renderNewItemField();const e=On.getComponent("views.elements.RoomAliasField");return i.a.createElement("form",{onSubmit:this._onAliasAdded,autoComplete:"off",noValidate:!0,className:"mx_EditableItemList_newItem"},i.a.createElement(e,{ref:this._aliasField,onChange:e=>this._onNewItemChanged({target:{value:e}}),value:this.props.newItem||"",domain:this.props.domain}),i.a.createElement(Fs.a,{onClick:this._onAliasAdded,kind:"primary"},Object(ts.a)("Add")))}}let fM=Object(os.a)("views.room_settings.AliasSettings")((pM=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onNewAliasChanged",e=>{this.setState({newAlias:e})}),Fe()(this,"onLocalAliasAdded",e=>{if(!e||0===e.length)return;const t=Cs.a.get().getDomain();e.includes(":")||(e+=":"+t),Cs.a.get().createAlias(e,this.props.roomId).then(()=>{this.setState({localAliases:this.state.localAliases.concat(e),newAlias:null}),this.state.canonicalAlias||this.changeCanonicalAlias(e)}).catch(e=>{console.error(e),qd.a.createTrackedDialog("Error creating address","",uu.a,{title:Object(ts.a)("Error creating address"),description:Object(ts.a)("There was an error creating that address. It may not be allowed by the server or a temporary failure occurred.")})})}),Fe()(this,"onLocalAliasDeleted",e=>{const t=this.state.localAliases[e];Cs.a.get().deleteAlias(t).then(()=>{const e=this.state.localAliases.filter(e=>e!==t);this.setState({localAliases:e}),this.state.canonicalAlias===t&&this.changeCanonicalAlias(null)}).catch(e=>{let t;console.error(e),t="M_FORBIDDEN"===e.errcode?Object(ts.a)("You don't have permission to delete the address."):Object(ts.a)("There was an error removing that address. It may no longer exist or a temporary error occurred."),qd.a.createTrackedDialog("Error removing address","",uu.a,{title:Object(ts.a)("Error removing address"),description:t})})}),Fe()(this,"onLocalAliasesToggled",e=>{e.target.open&&(this.props.canSetCanonicalAlias||0!==this.state.localAliases.length||this.loadLocalAliases()),this.setState({detailsOpen:e.target.open})}),Fe()(this,"onCanonicalAliasChange",e=>{this.changeCanonicalAlias(e.target.value)}),Fe()(this,"onNewAltAliasChanged",e=>{this.setState({newAltAlias:e})}),Fe()(this,"onAltAliasAdded",e=>{const t=this.state.altAliases.slice();t.some(t=>t.trim()===e.trim())||(t.push(e.trim()),this.changeAltAliases(t),this.setState({newAltAlias:""}))}),Fe()(this,"onAltAliasDeleted",e=>{const t=this.state.altAliases.slice();t.splice(e,1),this.changeAltAliases(t)});const t={altAliases:[],localAliases:[],canonicalAlias:null,updatingCanonicalAlias:!1,localAliasesLoading:!1,detailsOpen:!1};if(e.canonicalAliasEvent){const a=e.canonicalAliasEvent.getContent(),n=a.alt_aliases;Array.isArray(n)&&(t.altAliases=n.slice()),t.canonicalAlias=a.alias}this.state=t}componentDidMount(){this.props.canSetCanonicalAlias&&this.loadLocalAliases()}async loadLocalAliases(){this.setState({localAliasesLoading:!0});try{const e=Cs.a.get();let t=[];if(await e.doesServerSupportUnstableFeature("org.matrix.msc2432")){const a=await e.unstableGetLocalAliases(this.props.roomId);Array.isArray(a.aliases)&&(t=a.aliases)}this.setState({localAliases:t})}finally{this.setState({localAliasesLoading:!1})}}changeCanonicalAlias(e){if(!this.props.canSetCanonicalAlias)return;const t=this.state.canonicalAlias;this.setState({canonicalAlias:e,updatingCanonicalAlias:!0});const a={alt_aliases:this.state.altAliases};e&&(a.alias=e),Cs.a.get().sendStateEvent(this.props.roomId,"m.room.canonical_alias",a,"").catch(e=>{console.error(e),qd.a.createTrackedDialog("Error updating main address","",uu.a,{title:Object(ts.a)("Error updating main address"),description:Object(ts.a)("There was an error updating the room's main address. It may not be allowed by the server or a temporary failure occurred.")}),this.setState({canonicalAlias:t})}).finally(()=>{this.setState({updatingCanonicalAlias:!1})})}changeAltAliases(e){if(!this.props.canSetCanonicalAlias)return;this.setState({updatingCanonicalAlias:!0,altAliases:e});const t={};this.state.canonicalAlias&&(t.alias=this.state.canonicalAlias),e&&(t.alt_aliases=e),Cs.a.get().sendStateEvent(this.props.roomId,"m.room.canonical_alias",t,"").catch(e=>{console.error(e),qd.a.createTrackedDialog("Error updating alternative addresses","",uu.a,{title:Object(ts.a)("Error updating main address"),description:Object(ts.a)("There was an error updating the room's alternative addresses. It may not be allowed by the server or a temporary failure occurred.")})}).finally(()=>{this.setState({updatingCanonicalAlias:!1})})}_getAliases(){return this.state.altAliases.concat(this._getLocalNonAltAliases())}_getLocalNonAltAliases(){const{altAliases:e}=this.state;return this.state.localAliases.filter(t=>!e.includes(t))}render(){const e=Cs.a.get().getDomain();let t=!1;const a=this.state.canonicalAlias||"",n=i.a.createElement(rm.a,{onChange:this.onCanonicalAliasChange,value:a,disabled:this.state.updatingCanonicalAlias||!this.props.canSetCanonicalAlias,element:"select",id:"canonicalAlias",label:Object(ts.a)("Main address")},i.a.createElement("option",{value:"",key:"unset"},Object(ts.a)("not specified")),this._getAliases().map((e,a)=>(e===this.state.canonicalAlias&&(t=!0),i.a.createElement("option",{value:e,key:a},e))),t||!this.state.canonicalAlias?"":i.a.createElement("option",{value:this.state.canonicalAlias,key:"arbitrary"},this.state.canonicalAlias));let s;if(this.state.localAliasesLoading){const e=On.getComponent("elements.Spinner");s=i.a.createElement(e,null)}else s=i.a.createElement(gM,{id:"roomAliases",className:"mx_RoomSettings_localAliases",items:this.state.localAliases,newItem:this.state.newAlias,onNewItemChanged:this.onNewAliasChanged,canRemove:this.props.canSetAliases,canEdit:this.props.canSetAliases,onItemAdded:this.onLocalAliasAdded,onItemRemoved:this.onLocalAliasDeleted,noItemsLabel:Object(ts.a)("This room has no local addresses"),placeholder:Object(ts.a)("Local address"),domain:e});return i.a.createElement("div",{className:"mx_AliasSettings"},i.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(ts.a)("Published Addresses")),i.a.createElement("p",null,Object(ts.a)("Published addresses can be used by anyone on any server to join your room. To publish an address, it needs to be set as a local address first.")),n,i.a.createElement(uM,{roomId:this.props.roomId,canSetCanonicalAlias:this.props.canSetCanonicalAlias}),i.a.createElement("datalist",{id:"mx_AliasSettings_altRecommendations"},this._getLocalNonAltAliases().map(e=>i.a.createElement("option",{value:e,key:e})),";"),i.a.createElement(gM,{id:"roomAltAliases",className:"mx_RoomSettings_altAliases",items:this.state.altAliases,newItem:this.state.newAltAlias,onNewItemChanged:this.onNewAltAliasChanged,canRemove:this.props.canSetCanonicalAlias,canEdit:this.props.canSetCanonicalAlias,onItemAdded:this.onAltAliasAdded,onItemRemoved:this.onAltAliasDeleted,suggestionsListId:"mx_AliasSettings_altRecommendations",itemsLabel:Object(ts.a)("Other published addresses:"),noItemsLabel:Object(ts.a)("No other published addresses yet, add one below"),placeholder:Object(ts.a)("New published address (e.g. #alias:server)")}),i.a.createElement("span",{className:"mx_SettingsTab_subheading mx_AliasSettings_localAliasHeader"},Object(ts.a)("Local Addresses")),i.a.createElement("p",null,Object(ts.a)("Set addresses for this room so users can find this room through your homeserver (%(localDomain)s)",{localDomain:e})),i.a.createElement("details",{onToggle:this.onLocalAliasesToggled},i.a.createElement("summary",null,this.state.detailsOpen?Object(ts.a)("Show less"):Object(ts.a)("Show more")),s))}},Fe()(pM,"propTypes",{roomId:At.a.string.isRequired,canSetCanonicalAlias:At.a.bool.isRequired,canSetAliases:At.a.bool.isRequired,canonicalAliasEvent:At.a.object}),Fe()(pM,"defaultProps",{canSetAliases:!1,canSetCanonicalAlias:!1,aliasEvents:[]}),hM=pM))||hM;var vM,bM;const yM=/\+\S+:\S+/;let EM=Object(os.a)("views.room_settings.RelatedGroupSettings")((bM=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onNewGroupChanged",e=>{this.setState({newGroupId:e})}),Fe()(this,"onGroupAdded",e=>{if(0===e.length||!this.validateGroupId(e))return;const t=[...this.state.newGroupsList,e];this.setState({newGroupsList:t,newGroupId:""}),this.updateGroups(t)}),Fe()(this,"onGroupDeleted",e=>{const t=this.state.newGroupsList[e],a=this.state.newGroupsList.filter(e=>e!==t);this.setState({newGroupsList:a}),this.updateGroups(a)}),this.state={newGroupId:"",newGroupsList:e.relatedGroupsEvent&&e.relatedGroupsEvent.getContent().groups||[]}}updateGroups(e){this.context.sendStateEvent(this.props.roomId,"m.room.related_groups",{groups:e},"").catch(e=>{console.error(e),qd.a.createTrackedDialog("Error updating flair","",uu.a,{title:Object(ts.a)("Error updating flair"),description:Object(ts.a)("There was an error updating the flair for this room. The server may not allow it or a temporary error occurred.")})})}validateGroupId(e){if(!yM.test(e)){const t=On.getComponent("dialogs.ErrorDialog");return qd.a.createTrackedDialog("Invalid related community ID","",t,{title:Object(ts.a)("Invalid community ID"),description:Object(ts.a)("'%(groupId)s' is not a valid community ID",{groupId:e})}),!1}return!0}render(){const e=this.context.getDomain(),t=On.getComponent("elements.EditableItemList");return i.a.createElement("div",null,i.a.createElement(t,{id:"relatedGroups",items:this.state.newGroupsList,className:"mx_RelatedGroupSettings",newItem:this.state.newGroupId,canRemove:this.props.canSetRelatedGroups,canEdit:this.props.canSetRelatedGroups,onNewItemChanged:this.onNewGroupChanged,onItemAdded:this.onGroupAdded,onItemRemoved:this.onGroupDeleted,itemsLabel:Object(ts.a)("Showing flair for these communities:"),noItemsLabel:Object(ts.a)("This room is not showing flair for any communities"),placeholder:Object(ts.a)("New community ID (e.g. +foo:%(localDomain)s)",{localDomain:e})}))}},Fe()(bM,"propTypes",{roomId:At.a.string.isRequired,canSetRelatedGroups:At.a.bool.isRequired,relatedGroupsEvent:At.a.instanceOf(XT.b)}),Fe()(bM,"contextType",ns.a),Fe()(bM,"defaultProps",{canSetRelatedGroups:!1}),vM=bM))||vM;var _M,SM;let CM=Object(os.a)("views.room_settings.UrlPreviewSettings")((SM=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_onClickUserSettings",e=>{e.preventDefault(),e.stopPropagation(),gn.a.fire(js.a.ViewUserSettings)})}render(){const e=On.getComponent("elements.SettingsFlag"),t=this.props.room.roomId,a=Cs.a.get().isRoomEncrypted(t);let n=null,s=null;if(a)n=Object(ts.a)("In encrypted rooms, like this one, URL previews are disabled by default to ensure that your homeserver (where the previews are generated) cannot gather information about links you see in this room.");else{if(n=ss.b.getValueAt(mi.a.ACCOUNT,"urlPreviewsEnabled")?Object(ts.a)("You have <a>enabled</a> URL previews by default.",{},{a:e=>i.a.createElement("a",{onClick:this._onClickUserSettings,href:""},e)}):Object(ts.a)("You have <a>disabled</a> URL previews by default.",{},{a:e=>i.a.createElement("a",{onClick:this._onClickUserSettings,href:""},e)}),ss.b.canSetValue("urlPreviewsEnabled",t,"room"))s=i.a.createElement("label",null,i.a.createElement(e,{name:"urlPreviewsEnabled",level:mi.a.ROOM,roomId:t,isExplicit:!0}));else{let e=Object(ts.b)("URL previews are enabled by default for participants in this room.");ss.b.getValueAt(mi.a.ROOM,"urlPreviewsEnabled",t,!0)||(e=Object(ts.b)("URL previews are disabled by default for participants in this room.")),s=i.a.createElement("label",null,Object(ts.a)(e))}}const o=i.a.createElement(e,{name:a?"urlPreviewsEnabled_e2ee":"urlPreviewsEnabled",level:mi.a.ROOM_ACCOUNT,roomId:t});return i.a.createElement("div",null,i.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(ts.a)("When someone puts a URL in their message, a URL preview can be shown to give more information about that link such as the title, description, and an image from the website.")),i.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},n),s,i.a.createElement("label",null,o))}},Fe()(SM,"propTypes",{room:At.a.object}),_M=SM))||_M;var wM=a(1544);function OM(e,t){const a=Math.min(e.length,t.length);for(let n=0;n<a;++n)if(e[n]!==t[n])return n;return a}function xM(e,t,a){const n=a-(t.length-e.length);return function(e,t){const a=Math.min(e.length,t.length),n=e.substr(0,a)===t.substr(0,a);if(n&&e.length>t.length)return{removed:e.substr(a),at:a};if(n&&e.length<t.length)return{added:t.substr(a),at:a};{const a=OM(e,t);return{removed:e.substr(a),added:t.substr(a),at:a}}}(e.substr(0,n),t.substr(0,a))}class RM{constructor(e,t){this.index=e,this.offset=t}compare(e){return this.index===e.index?this.offset-e.offset:this.index-e.index}iteratePartsBetween(e,t,a){if(-1===this.index||-1===e.index)return;const[n,s]=this.compare(e)<0?[this,e]:[e,this];if(n.index===s.index)a(t.parts[this.index],n.offset,s.offset);else{const e=t.parts[n.index];a(e,n.offset,e.text.length);for(let e=n.index+1;e<s.index;++e){const n=t.parts[e];a(n,0,n.text.length)}a(t.parts[s.index],0,s.offset)}}forwardsWhile(e,t){if(-1===this.index)return this;let{index:a,offset:n}=this;const{parts:s}=e;for(;a<s.length;){const e=s[a];for(;n<e.text.length;){if(!t(a,n,e))return new RM(a,n);n+=1}if(a===s.length-1)return new RM(a,n);a+=1,n=0}}backwardsWhile(e,t){if(-1===this.index)return this;let{index:a,offset:n}=this;const s=e.parts;for(;a>=0;){const e=s[a];for(;n>0;){if(!t(a,n-1,e))return new RM(a,n);n-=1}if(0===a)return new RM(a,n);a-=1,n=s[a].text.length}}asOffset(e){if(-1===this.index)return new DR(0,!0);let t=0;for(let a=0;a<this.index;++a)t+=e.parts[a].text.length;t+=this.offset;const a=e.parts[this.index],n=!a||t>=a.text.length;return new DR(t,n)}isAtEnd(e){if(0===e.parts.length)return!0;const t=e.parts.length-1,a=e.parts[t];return this.index===t&&this.offset===a.text.length}isAtStart(){return 0===this.index&&0===this.offset}}class kM{constructor(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.updateCallback=a,Fe()(this,"_parts",void 0),Fe()(this,"_partCreator",void 0),Fe()(this,"activePartIdx",null),Fe()(this,"_autoComplete",null),Fe()(this,"autoCompletePartIdx",null),Fe()(this,"autoCompletePartCount",0),Fe()(this,"transformCallback",null),Fe()(this,"onAutoComplete",e=>{let t,{replaceParts:a,close:n}=e;if(a){this._parts.splice(this.autoCompletePartIdx,this.autoCompletePartCount,...a),this.autoCompletePartCount=a.length;const e=a[a.length-1],n=this.autoCompletePartIdx+a.length-1;t=new RM(n,e.text.length)}n&&(this._autoComplete=null,this.autoCompletePartIdx=null,this.autoCompletePartCount=0),this.updateCallback(t)}),this._parts=e,this._partCreator=t,this.transformCallback=null}setTransformCallback(e){this.transformCallback=e}setUpdateCallback(e){this.updateCallback=e}get partCreator(){return this._partCreator}get isEmpty(){return 0===this._parts.reduce((e,t)=>e+t.text.length,0)}clone(){return new kM(this._parts,this._partCreator,this.updateCallback)}insertPart(e,t){this._parts.splice(e,0,t),this.activePartIdx>=e&&++this.activePartIdx,this.autoCompletePartIdx>=e&&++this.autoCompletePartIdx}removePart(e){this._parts.splice(e,1),e===this.activePartIdx?this.activePartIdx=null:this.activePartIdx>e&&--this.activePartIdx,e===this.autoCompletePartIdx?this.autoCompletePartIdx=null:this.autoCompletePartIdx>e&&--this.autoCompletePartIdx}replacePart(e,t){this._parts.splice(e,1,t)}get parts(){return this._parts}get autoComplete(){return this.activePartIdx===this.autoCompletePartIdx?this._autoComplete:null}getPositionAtEnd(){if(this._parts.length){const e=this._parts.length-1,t=this._parts[e];return new RM(e,t.text.length)}return new RM(-1,0)}serializeParts(){return this._parts.map(e=>e.serialize())}diff(e,t,a){const n=this.parts.reduce((e,t)=>e+t.text,"");return"deleteByDrag"===t?function(e,t){if(e===t)return{};const a=OM(e,t),n=e.length-t.length;return{at:a,removed:e.substr(a,n)}}(n,e):xM(n,e,a.offset)}reset(e,t,a){this._parts=e.map(e=>this._partCreator.deserializePart(e)),t||(t=this.getPositionAtEnd()),this._autoComplete&&(this._autoComplete=null,this.autoCompletePartIdx=null),this.updateCallback(t,a)}insert(e,t){const a=this.splitAt(t);let n=0;for(let t=0;t<e.length;++t){const s=e[t];n+=s.text.length,this.insertPart(a+t,s)}return n}update(e,t,a){const n=this.diff(e,t,a),s=this.positionForOffset(n.at,a.atNodeEnd);let i=0;n.removed&&(i=this.removeText(s,n.removed.length));let o=0;n.added&&(o=this.addText(s,n.added,t)),this.mergeAdjacentParts();const r=n.at-i+o;let l=this.positionForOffset(r,!0);const c="insertFromPaste"!==t&&"insertFromDrop"!==t,d=this.setActivePart(l,c);if(this.transformCallback){const e=this.getTransformAddedLen(l,t,n);l=this.positionForOffset(r+e,!0)}return this.updateCallback(l,t,n),d}getTransformAddedLen(e,t,a){const n=this.transformCallback(e,t,a);return Number.isFinite(n)?n:0}setActivePart(e,t){const{index:a}=e,n=this._parts[a];if(n){if(a!==this.activePartIdx&&(this.activePartIdx=a,t&&this.activePartIdx!==this.autoCompletePartIdx)){const e=n.createAutoComplete(this.onAutoComplete);e&&(this._autoComplete=e,this.autoCompletePartIdx=a,this.autoCompletePartCount=1)}if(this.autoComplete)return this.autoComplete.onPartUpdate(n,e)}else this.activePartIdx=null,this._autoComplete=null,this.autoCompletePartIdx=null,this.autoCompletePartCount=0;return Promise.resolve()}mergeAdjacentParts(){let e;for(let t=0;t<this._parts.length;++t){let a=this._parts[t];const n=!a.text.length,s=!n&&e&&e.merge(a);(n||s)&&(a=e,this.removePart(t),--t),e=a}}removeText(e,t){let{index:a,offset:n}=e,s=0;for(;t>0;){let e=this._parts[a];const i=Math.min(t,e.text.length-n);if(i)if(e.canEdit){const t=e.remove(n,i);"string"==typeof t&&this.replacePart(a,this._partCreator.createDefaultPart(t)),e=this._parts[a],e.text.length?a+=1:this.removePart(a)}else s+=n,this.removePart(a);else a+=1;t-=i,n=0}return s}splitAt(e){if(-1===e.index)return 0;if(0===e.offset)return e.index;const t=this._parts[e.index];if(e.offset>=t.text.length)return e.index+1;const a=t.split(e.offset);return this.insertPart(e.index+1,a),e.index+1}addText(e,t,a){let{index:n}=e;const{offset:s}=e;let i=t.length;const o=this._parts[n];if(o)if(o.canEdit)if(o.validateAndInsert(s,t,a))t=null;else{const e=o.split(s);n+=1,this.insertPart(n,e)}else 0!==s&&(i+=o.text.length-s,n+=1);else n<0&&(n=0);for(;t;){const e=this._partCreator.createPartForInput(t,n,a);t=e.appendUntilRejected(t,a),this.insertPart(n,e),n+=1}return i}positionForOffset(e,t){let a=0;const n=this._parts.findIndex(n=>{const s=n.text.length;return!!(t&&a+s>=e||!t&&a+s>e)||(a+=s,!1)});return-1===n?this.getPositionAtEnd():new RM(n,e-a)}startRange(e){return new CR(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e)}replaceRange(e,t,a){const n=t.asOffset(this),s=this.splitAt(e);t=n.asPosition(this);for(let e=this.splitAt(t)-1;e>=s;--e)this.removePart(e);let i=s;for(const e of a)this.insertPart(i,e),i+=1;this.mergeAdjacentParts()}transform(e){const t=e();let a=null;return a=t instanceof CR?Promise.resolve():this.setActivePart(t,!0),this.updateCallback(t),a}}var IM=a(748),TM=a(1252),PM=a.n(TM);function NM(e){return e.parts.reduce((e,t)=>{switch(t.type){case"newline":return e+"\n";case"plain":case"command":case"pill-candidate":case"at-room-pill":return e+t.text;case"room-pill":return e+`[${t.resourceId.replace(/[[\\\]]/g,e=>"\\"+e)}](${Object(Ix.e)(t.resourceId)})`;case"user-pill":return e+`[${t.text.replace(/[[\\\]]/g,e=>"\\"+e)}](${Object(Ix.e)(t.resourceId)})`}},"")}function DM(e){let{forceHTML:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=NM(e);const n=a;if(ss.b.getValue("feature_latex_maths")){const e=["display","inline"],t={tex:{display:"(^)\\$\\$(([^$]|\\\\\\$)+?)\\$\\$$",inline:"(^|\\s|[.,!?:;])(?!\\\\)\\$(?!\\s)(([^$\\n]|\\\\\\$)*([^\\\\\\s\\$]|\\\\\\$)(?:\\\\\\$)?)\\$"},latex:{display:"(^)\\\\\\[(?!\\\\\\])(.*?)\\\\\\]$",inline:"(^|[^\\\\])\\\\\\((?!\\\\\\))(.*?)\\\\\\)"}};["tex","latex"].forEach((function(n){e.forEach((function(e){const s=((($c.a.get().latex_maths_delims||{})[e]||{}).pattern||{})[n]||t[n][e];a=a.replace(RegExp(s,"gms"),(function(t,a,n){const s=IM.AllHtmlEntities.encode(n);switch(e){case"display":return`${a}<div data-mx-maths="${s}">\n\n</div>\n\n`;case"inline":return`${a}<span data-mx-maths="${s}"></span>`}}))}))})),a=a.replace(/(.)<div/g,(function(e,t){return t+"\n<div"}))}const s=new YN(a);if(!s.isPlainText()||t){const e=PM.a.load(s.toHTML(),{_useHtmlParser2:!0,decodeEntities:!1});if(ss.b.getValue("feature_latex_maths")){const t=new YN(n),a=PM.a.load(t.toHTML(),{_useHtmlParser2:!0,decodeEntities:!1});a("code").each((function(t){e("code").eq(t).text(a("code").eq(t).text())})),e("div, span").each((function(t,a){const n=e(a).attr("data-mx-maths");n&&e(a).html(`<code>${n}</code>`)}))}return e.html()}if(a.indexOf("\\")>-1)return s.toPlaintext()}function jM(e){return e.parts.reduce((e,t)=>{switch(t.type){case"newline":return e+"\n";case"plain":case"command":case"pill-candidate":case"at-room-pill":return e+t.text;case"room-pill":return e+""+t.resourceId;case"user-pill":return e+""+t.text}},"")}function AM(e){return MM(e,"/me ",!1)}function MM(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=e.parts[0];let s=n&&n.text;return a||(t=t.toLowerCase(),s=s.toLowerCase()),n&&("plain"===n.type||"command"===n.type)&&s.startsWith(t)}function UM(e){return LM(e,"/me ")}function LM(e,t){return(e=e.clone()).removeText({index:0,offset:0},t.length),e}var FM,BM,VM=a(1418);class GM{constructor(e,t){Fe()(this,"history",[]),Fe()(this,"prefix",void 0),Fe()(this,"lastIndex",0),Fe()(this,"currentIndex",0),this.prefix=t+e;let a,n=0;for(;a=sessionStorage.getItem(`${this.prefix}[${n}]`);){try{this.history.push(JSON.parse(a))}catch(e){console.warn("Throwing away unserialisable history",e);break}++n}this.lastIndex=this.history.length-1,this.currentIndex=this.lastIndex+1}static createItem(e,t){return{parts:e.serializeParts(),replyEventId:t?t.getId():void 0}}save(e,t){const a=GM.createItem(e,t);this.history.push(a),this.currentIndex=this.history.length,this.lastIndex+=1,sessionStorage.setItem(`${this.prefix}[${this.lastIndex}]`,JSON.stringify(a))}getItem(e){return this.currentIndex=Object(dC.clamp)(this.currentIndex+e,0,this.history.length-1),this.history[this.currentIndex]}}function zM(e,t){const a=AM(e);a&&(e=UM(e));const n=function(e){const t=e.getContent()["m.relates_to"];return!(!t||!t["m.in_reply_to"])}(t);let s="",i="";n&&(s=function(e){const t=e.getContent().body.split("\n").map(e=>e.trim());return t.length>2&&t[0].startsWith("> ")&&0===t[1].length?t[0]+"\n\n":""}(t),i=function(e){const t=e.getContent().formatted_body;if(!t)return"";const a=(new DOMParser).parseFromString(t,"text/html").body.querySelector("mx-reply");return a&&a.outerHTML||""}(t));const o=jM(e),r={msgtype:a?"m.emote":"m.text",body:o},l={msgtype:r.msgtype,body:`${s} * ${o}`},c=DM(e,{forceHTML:n});return c&&(r.format="org.matrix.custom.html",r.formatted_body=c,l.format=r.format,l.formatted_body=`${i} * ${c}`),Object.assign({"m.new_content":r,"m.relates_to":{rel_type:"m.replace",event_id:t.getId()}},l)}let WM=Object(os.a)("views.rooms.EditMessageComposer")((BM=class extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"_setEditorRef",e=>{this._editorRef=e}),Fe()(this,"_onKeyDown",e=>{if(this._editorRef.isComposing(e))return;switch(Object(Li.f)().getMessageComposerAction(e)){case Li.b.Send:this._sendEdit(),e.preventDefault();break;case Li.b.CancelEditing:this._cancelEdit();break;case Li.b.EditPrevMessage:{if(this._editorRef.isModified()||!this._editorRef.isCaretAtStart())return;const t=Object(WO.b)(this._getRoom(),!1,this.props.editState.getEvent().getId());t&&(gn.a.dispatch({action:"edit_event",event:t}),e.preventDefault());break}case Li.b.EditNextMessage:{if(this._editorRef.isModified()||!this._editorRef.isCaretAtEnd())return;const t=Object(WO.b)(this._getRoom(),!0,this.props.editState.getEvent().getId());t?gn.a.dispatch({action:"edit_event",event:t}):(this._clearStoredEditorState(),gn.a.dispatch({action:"edit_event",event:null}),gn.a.fire(js.a.FocusComposer)),e.preventDefault();break}}}),Fe()(this,"_cancelEdit",()=>{this._clearStoredEditorState(),gn.a.dispatch({action:"edit_event",event:null}),gn.a.fire(js.a.FocusComposer)}),Fe()(this,"_sendEdit",async()=>{const e=Xc.a.getTimestamp(),t=this.props.editState.getEvent(),a=zM(this.model,t),n=a["m.new_content"];let s=!0;if(this._isContentModified(n)){const n=t.getRoomId();if(!AM(this.model)&&this._isSlashCommand()){const[e,t,o]=this._getSlashCommand();if(e)e.category===Ux.messages?a["m.new_content"]=await this._runSlashCommand(e,t,n):(this._runSlashCommand(e,t,n),s=!1);else{const e=On.getComponent("dialogs.QuestionDialog"),{finished:t}=qd.a.createTrackedDialog("Unknown command","",e,{title:Object(ts.a)("Unknown Command"),description:i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("Unrecognised command: %(commandText)s",{commandText:o})),i.a.createElement("p",null,Object(ts.a)("You can use <code>/help</code> to list available commands. Did you mean to send this as a message?",{},{code:e=>i.a.createElement("code",null,e)})),i.a.createElement("p",null,Object(ts.a)("Hint: Begin your message with <code>//</code> to start it with a slash.",{},{code:e=>i.a.createElement("code",null,e)}))),button:Object(ts.a)("Send as message")}),[a]=await t;if(!a)return}}if(s){this._cancelPreviousPendingEdit();const t=this.context.sendMessage(n,a);this._clearStoredEditorState(),gn.a.dispatch({action:"message_sent"}),Xc.a.instance.trackSendMessage(e,t,n,!0,!1,a)}}gn.a.dispatch({action:"edit_event",event:null}),gn.a.fire(js.a.FocusComposer)}),Fe()(this,"_onChange",()=>{this.state.saveDisabled&&this._editorRef&&this._editorRef.isModified()&&this.setState({saveDisabled:!1})}),this.model=null,this._editorRef=null,this.state={saveDisabled:!0},this._createEditorModel(),window.addEventListener("beforeunload",this._saveStoredEditorState)}_getRoom(){return this.context.getRoom(this.props.editState.getEvent().getRoomId())}get _editorRoomKey(){return"mx_edit_room_"+this._getRoom().roomId}get _editorStateKey(){return"mx_edit_state_"+this.props.editState.getEvent().getId()}get _shouldSaveStoredEditorState(){return null!==localStorage.getItem(this._editorRoomKey)}_restoreStoredEditorState(e){const t=localStorage.getItem(this._editorStateKey);if(t)try{const{parts:a}=JSON.parse(t);return a.map(t=>e.deserializePart(t))}catch(e){console.error("Error parsing editing state: ",e)}}_clearStoredEditorState(){localStorage.removeItem(this._editorRoomKey),localStorage.removeItem(this._editorStateKey)}_clearPreviousEdit(){localStorage.getItem(this._editorRoomKey)&&localStorage.removeItem("mx_edit_state_"+localStorage.getItem(this._editorRoomKey))}_saveStoredEditorState(){const e=GM.createItem(this.model);this._clearPreviousEdit(),localStorage.setItem(this._editorRoomKey,this.props.editState.getEvent().getId()),localStorage.setItem(this._editorStateKey,JSON.stringify(e))}_isSlashCommand(){const e=this.model.parts[0];if(e){if("command"===e.type&&e.text.startsWith("/")&&!e.text.startsWith("//"))return!0;if(e.text.startsWith("/")&&!e.text.startsWith("//")&&("plain"===e.type||"pill-candidate"===e.type))return!0}return!1}_isContentModified(e){const t=this.props.editState.getEvent().getContent();return!(!this._editorRef.isModified()||t.msgtype===e.msgtype&&t.body===e.body&&t.format===e.format&&t.formatted_body===e.formatted_body)}_getSlashCommand(){const e=this.model.parts.reduce((e,t)=>"user-pill"===t.type?e+t.resourceId:e+t.text,""),{cmd:t,args:a}=Wx(e);return[t,a,e]}async _runSlashCommand(e,t,a){const n=e.run(a,t);let s,i=n.error;if(n.promise)try{e.category===Ux.messages?s=await n.promise:await n.promise}catch(e){i=e}if(i){console.error("Command failure: %s",i);const e=On.getComponent("dialogs.ErrorDialog"),t=!!n.promise?Object(ts.b)("Server error"):Object(ts.b)("Command error");let a;a="string"==typeof i?i:i.message?i.message:Object(ts.a)("Server unavailable, overloaded, or something else went wrong."),qd.a.createTrackedDialog(t,"",e,{title:Object(ts.a)(t),description:a})}else if(console.log("Command success."),s)return s}_cancelPreviousPendingEdit(){const e=this.props.editState.getEvent().replacingEvent();!e||e.status!==XT.a.QUEUED&&e.status!==XT.a.NOT_SENT||this.context.cancelPendingEvent(e)}componentWillUnmount(){const e=document.getSelection();let t;e.focusNode&&(t=AR(this._editorRef,e).caret);const a=this.model.serializeParts();this.props.editState.setEditorState(t,a),window.removeEventListener("beforeunload",this._saveStoredEditorState),this._shouldSaveStoredEditorState&&this._saveStoredEditorState()}_createEditorModel(){const{editState:e}=this.props,t=this._getRoom(),a=new JR(t,this.context);let n;n=e.hasEditorState()?e.getSerializedParts().map(e=>a.deserializePart(e)):this._restoreStoredEditorState(a)||sk(e.getEvent(),a),this.model=new kM(n,a),this._saveStoredEditorState()}_getInitialCaretPosition(){const{editState:e}=this.props;let t;if(e.hasEditorState()&&e.getCaret()){const a=e.getCaret();t=this.model.positionForOffset(a.offset,a.atNodeEnd)}else t=this.model.getPositionAtEnd();return t}render(){const e=On.getComponent("elements.AccessibleButton");return i.a.createElement("div",{className:Hn()("mx_EditMessageComposer",this.props.className),onKeyDown:this._onKeyDown},i.a.createElement(fk,{ref:this._setEditorRef,model:this.model,room:this._getRoom(),initialCaret:this.props.editState.getCaret(),label:Object(ts.a)("Edit message"),onChange:this._onChange}),i.a.createElement("div",{className:"mx_EditMessageComposer_buttons"},i.a.createElement(e,{kind:"secondary",onClick:this._cancelEdit},Object(ts.a)("Cancel")),i.a.createElement(e,{kind:"primary",onClick:this._sendEdit,disabled:this.state.saveDisabled},Object(ts.a)("Save"))))}},Fe()(BM,"propTypes",{editState:At.a.instanceOf(VM.a).isRequired}),Fe()(BM,"contextType",ns.a),FM=BM))||FM;var HM,KM;const qM={offline:"mx_EntityTile_offline",online:"mx_EntityTile_online",unavailable:"mx_EntityTile_unavailable"};let YM=Object(os.a)("views.rooms.EntityTile")((KM=class e extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{hover:!1})}shouldComponentUpdate(e,t){return this.state.hover!==t.hover||this.props.shouldComponentUpdate(e,t)}render(){const t={mx_EntityTile:!0,mx_EntityTile_noHover:this.props.suppressOnHover};this.props.className&&(t[this.props.className]=!0);var n,s;let o;t[(n=this.props.presenceState,s=this.props.presenceLastActiveAgo,!1===this.props.showPresence?"mx_EntityTile_online_beenactive":"offline"==n?s?qM.offline+"_beenactive":qM.offline+"_neveractive":n?qM[n]:qM.offline+"_neveractive")]=!0;const{name:r}=this.props;if(this.props.suppressOnHover)o=this.props.subtextLabel?i.a.createElement("div",{className:"mx_EntityTile_details"},i.a.createElement("div",{className:"mx_EntityTile_name",dir:"auto"},r),i.a.createElement("span",{className:"mx_EntityTile_subtext"},this.props.subtextLabel)):i.a.createElement("div",{className:"mx_EntityTile_name",dir:"auto"},r);else{const e=this.props.presenceLastActiveAgo?Date.now()-(this.props.presenceLastTs-this.props.presenceLastActiveAgo):-1,t=On.getComponent("rooms.PresenceLabel");let a=null;this.props.showPresence&&(a=i.a.createElement(t,{activeAgo:e,currentlyActive:this.props.presenceCurrentlyActive,presenceState:this.props.presenceState})),this.props.subtextLabel&&(a=i.a.createElement("span",{className:"mx_EntityTile_subtext"},this.props.subtextLabel)),o=i.a.createElement("div",{className:"mx_EntityTile_details"},i.a.createElement("div",{className:"mx_EntityTile_name",dir:"auto"},r),a)}let l,c;this.props.showInviteButton&&(l=i.a.createElement("div",{className:"mx_EntityTile_invite"},i.a.createElement("img",{src:a(8440),width:"16",height:"16"})));const d=this.props.powerStatus;if(d){const t={[e.POWER_STATUS_MODERATOR]:Object(ts.a)("Mod"),[e.POWER_STATUS_ADMIN]:Object(ts.a)("Admin")}[d];c=i.a.createElement("div",{className:"mx_EntityTile_power"},t)}let m;const{e2eStatus:u}=this.props;u&&(m=i.a.createElement(Uk.b,{status:u,isUser:!0,bordered:!0}));const h=On.getComponent("avatars.BaseAvatar"),p=this.props.avatarJsx||i.a.createElement(h,{name:this.props.name,width:36,height:36,"aria-hidden":"true"});return i.a.createElement("div",{ref:e=>this.container=e},i.a.createElement(Fs.a,{className:Hn()(t),title:this.props.title,onClick:this.props.onClick},i.a.createElement("div",{className:"mx_EntityTile_avatar"},p,m),o,c,l))}},Fe()(KM,"propTypes",{name:At.a.string,title:At.a.string,avatarJsx:At.a.any,className:At.a.string,presenceState:At.a.string,presenceLastActiveAgo:At.a.number,presenceLastTs:At.a.number,presenceCurrentlyActive:At.a.bool,showInviteButton:At.a.bool,shouldComponentUpdate:At.a.func,onClick:At.a.func,suppressOnHover:At.a.bool,showPresence:At.a.bool,subtextLabel:At.a.string,e2eStatus:At.a.string}),Fe()(KM,"defaultProps",{shouldComponentUpdate:function(e,t){return!0},onClick:function(){},presenceState:"offline",presenceLastActiveAgo:0,presenceLastTs:0,showInviteButton:!1,suppressOnHover:!1,showPresence:!0}),HM=KM))||HM;YM.POWER_STATUS_MODERATOR="moderator",YM.POWER_STATUS_ADMIN="admin";var $M,JM,QM=YM,XM=a(602),ZM=e=>{const t=Hn()({mx_JumpToBottomButton:!0,mx_JumpToBottomButton_highlight:e.highlight});let a;return e.numUnreadMessages&&(a=React.createElement("div",{className:"mx_JumpToBottomButton_badge"},e.numUnreadMessages)),React.createElement("div",{className:t},React.createElement(Fs.a,{className:"mx_JumpToBottomButton_scrollDown",title:Object(ts.a)("Scroll to most recent messages"),onClick:e.onScrollToBottomClick}),a)};let eU=Object(os.a)("views.rooms.LinkPreviewWidget")((JM=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onImageClick",e=>{const t=this.state.preview;if(0!=e.button||e.metaKey)return;e.preventDefault();const a=On.getComponent("elements.ImageView");let n=t["og:image"];n&&n.startsWith("mxc://")&&(n=Object(Os.b)(n).srcHttp);const s={src:n,width:t["og:image:width"],height:t["og:image:height"],name:t["og:title"]||t["og:description"]||this.props.link,fileSize:t["matrix:image:size"],link:this.props.link};qd.a.createDialog(a,s,"mx_Dialog_lightbox",null,!0)}),this.state={preview:null},this.unmounted=!1,Cs.a.get().getUrlPreview(this.props.link,this.props.mxEvent.getTs()).then(e=>{this.unmounted||this.setState({preview:e},this.props.onHeightChanged)},e=>{console.error("Failed to get URL preview: "+e)}),this._description=Object(s.createRef)()}componentDidMount(){this._description.current&&Object(tS.g)(this._description.current)}componentDidUpdate(){this._description.current&&Object(tS.g)(this._description.current)}componentWillUnmount(){this.unmounted=!0}render(){const e=this.state.preview;if(!e||0===Object.keys(e).length)return i.a.createElement("div",null);let t=e["og:image"];ss.b.getValue("showImages")||(t=null);t&&t.startsWith("mxc://")&&(t=Object(Os.b)(t).getThumbnailOfSourceHttp(100,100,"scale"));let n,s=100;e["og:image:width"]&&e["og:image:height"]&&(s=function(e,t,a,n){if(!e||!t)return null;if(e<a&&t<n)return t;const s=a/e,i=n/t;return s<i?Math.floor(s*t):Math.floor(i*t)}(e["og:image:width"],e["og:image:height"],100,100)),t&&(n=i.a.createElement("div",{className:"mx_LinkPreviewWidget_image",style:{height:s}},i.a.createElement("img",{style:{maxWidth:100,maxHeight:100},src:t,onClick:this.onImageClick})));const o=IM.AllHtmlEntities.decode(e["og:description"]||""),r=On.getComponent("elements.AccessibleButton");return i.a.createElement("div",{className:"mx_LinkPreviewWidget"},n,i.a.createElement("div",{className:"mx_LinkPreviewWidget_caption"},i.a.createElement("div",{className:"mx_LinkPreviewWidget_title"},i.a.createElement("a",{href:this.props.link,target:"_blank",rel:"noreferrer noopener"},e["og:title"])),i.a.createElement("div",{className:"mx_LinkPreviewWidget_siteName"},e["og:site_name"]?" - "+e["og:site_name"]:null),i.a.createElement("div",{className:"mx_LinkPreviewWidget_description",ref:this._description},o)),i.a.createElement(r,{className:"mx_LinkPreviewWidget_cancel",onClick:this.props.onCancelClick,"aria-label":Object(ts.a)("Close preview")},i.a.createElement("img",{className:"mx_filterFlipColor",alt:"",role:"presentation",src:a(502),width:"18",height:"18"})))}},Fe()(JM,"propTypes",{link:At.a.string.isRequired,mxEvent:At.a.object.isRequired,onCancelClick:At.a.func,onHeightChanged:At.a.func}),$M=JM))||$M;var tU,aU,nU=a(1360);let sU=Object(os.a)("views.rooms.MemberTile")((aU=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onRoomStateEvents",e=>{if("m.room.encryption"!==e.getType())return;const{roomId:t}=this.props.member;if(e.getRoomId()!==t)return;Cs.a.get().removeListener("RoomState.events",this.onRoomStateEvents),this.setState({isRoomEncrypted:!0}),this.updateE2EStatus()}),Fe()(this,"onUserTrustStatusChanged",(e,t)=>{e===this.props.member.userId&&this.updateE2EStatus()}),Fe()(this,"onDeviceVerificationChanged",(e,t,a)=>{e===this.props.member.userId&&this.updateE2EStatus()}),Fe()(this,"_onStatusMessageCommitted",()=>{this.setState({statusMessage:this.getStatusMessage()})}),Fe()(this,"onClick",e=>{gn.a.dispatch({action:js.a.ViewUser,member:this.props.member})}),this.state={statusMessage:this.getStatusMessage(),isRoomEncrypted:!1,e2eStatus:null}}componentDidMount(){const e=Cs.a.get();if(ss.b.getValue("feature_custom_status")){const{user:e}=this.props.member;e&&e.on("User._unstable_statusMessage",this._onStatusMessageCommitted)}const{roomId:t}=this.props.member;if(t){const a=e.isRoomEncrypted(t);this.setState({isRoomEncrypted:a}),a?(e.on("userTrustStatusChanged",this.onUserTrustStatusChanged),e.on("deviceVerificationChanged",this.onDeviceVerificationChanged),this.updateE2EStatus()):e.on("RoomState.events",this.onRoomStateEvents)}}componentWillUnmount(){const e=Cs.a.get(),{user:t}=this.props.member;t&&t.removeListener("User._unstable_statusMessage",this._onStatusMessageCommitted),e&&(e.removeListener("RoomState.events",this.onRoomStateEvents),e.removeListener("userTrustStatusChanged",this.onUserTrustStatusChanged),e.removeListener("deviceVerificationChanged",this.onDeviceVerificationChanged))}async updateE2EStatus(){const e=Cs.a.get(),{userId:t}=this.props.member,a=t===e.getUserId(),n=e.checkUserTrust(t);if(!n.isCrossSigningVerified())return void this.setState({e2eStatus:n.wasCrossSigningVerified()?"warning":"normal"});const s=e.getStoredDevicesForUser(t).some(n=>{const{deviceId:s}=n,i=e.checkDeviceTrust(t,s);return a?!i.isCrossSigningVerified():!i.isVerified()});this.setState({e2eStatus:s?"warning":"verified"})}getStatusMessage(){const{user:e}=this.props.member;return e?e._unstable_statusMessage:""}shouldComponentUpdate(e,t){return void 0===this.member_last_modified_time||this.member_last_modified_time<e.member.getLastModifiedTime()||(!(!e.member.user||!(void 0===this.user_last_modified_time||this.user_last_modified_time<e.member.user.getLastModifiedTime()))||(t.isRoomEncrypted!==this.state.isRoomEncrypted||t.e2eStatus!==this.state.e2eStatus))}_getDisplayName(){return this.props.member.name}getPowerLabel(){return Object(ts.a)("%(userName)s (power %(powerLevelNumber)s)",{userName:this.props.member.userId,powerLevelNumber:this.props.member.powerLevel})}render(){const e=On.getComponent("avatars.MemberAvatar"),t=On.getComponent("rooms.EntityTile"),a=this.props.member,n=this._getDisplayName(),s=a.user?a.user.presence:null;let o=null;a.user&&ss.b.getValue("feature_custom_status")&&(o=this.state.statusMessage);const r=i.a.createElement(e,{member:a,width:36,height:36,"aria-hidden":"true"});a.user&&(this.user_last_modified_time=a.user.getLastModifiedTime()),this.member_last_modified_time=a.getLastModifiedTime();const l=new Map([[100,t.POWER_STATUS_ADMIN],[50,t.POWER_STATUS_MODERATOR]]);let c=this.props.member.powerLevel;for(const[e]of l)if(this.props.member.powerLevel>=e){c=e;break}const d=l.get(c);let m;return this.state.isRoomEncrypted&&(m=this.state.e2eStatus),i.a.createElement(t,u()({},this.props,{presenceState:s,presenceLastActiveAgo:a.user?a.user.lastActiveAgo:0,presenceLastTs:a.user?a.user.lastPresenceTs:0,presenceCurrentlyActive:!!a.user&&a.user.currentlyActive,avatarJsx:r,title:this.getPowerLabel(),name:n,powerStatus:d,showPresence:this.props.showPresence,subtextLabel:o,e2eStatus:m,onClick:this.onClick}))}},Fe()(aU,"propTypes",{member:At.a.any.isRequired,showPresence:At.a.bool}),Fe()(aU,"defaultProps",{showPresence:!0}),tU=aU))||tU;var iU=a(1413);class oU extends i.a.Component{constructor(e){super(e),this.nodes={},this._updateChildren(this.props.children)}componentDidUpdate(){this._updateChildren(this.props.children)}_applyStyles(e,t){Object.entries(t).forEach(t=>{let[a,n]=t;e.style[a]=n})}_updateChildren(e){const t=this.children||{};this.children={},i.a.Children.toArray(e).forEach(e=>{if(t[e.key]){const a=t[e.key],n=DT.a.findDOMNode(this.nodes[a.key]);n&&n.style.left!==e.props.style.left&&this._applyStyles(n,{left:e.props.style.left}),this.children[e.key]=i.a.cloneElement(a,e.props,e.props.children)}else{const t={},a=e.props.style,n=this.props.startStyles;if(n.length>0){const e=n[0];t.style=e}t.ref=t=>this._collectNode(e.key,t,a),this.children[e.key]=i.a.cloneElement(e,t)}})}_collectNode(e,t,a){if(t&&void 0===this.nodes[e]&&this.props.startStyles.length>0){const e=this.props.startStyles,n=DT.a.findDOMNode(t);for(let t=1;t<e.length;++t)this._applyStyles(n,e[t]);setTimeout(()=>{this._applyStyles(n,a)},0)}this.nodes[e]=t}render(){return i.a.createElement(i.a.Fragment,null,Object.values(this.children))}}Fe()(oU,"propTypes",{children:At.a.any,transition:At.a.object,startStyles:At.a.array}),Fe()(oU,"defaultProps",{startStyles:[]});var rU,lU,cU=a(596);let dU=Object(os.a)("views.rooms.ReadReceiptMarker")((lU=class extends i.a.PureComponent{constructor(e){super(e),this._avatar=Object(s.createRef)(),this.state={suppressDisplay:!this.props.suppressAnimation}}componentWillUnmount(){const e=this.props.readReceiptInfo;if(!e)return;if(this.props.checkUnmounting&&this.props.checkUnmounting())return;const t=this._avatar.current;e.top=t.offsetTop,e.left=t.offsetLeft,e.parent=t.offsetParent}componentDidMount(){this.state.suppressDisplay&&this._animateMarker()}componentDidUpdate(e){const t=e.leftOffset!==this.props.leftOffset,a=e.hidden!==this.props.hidden;(t||a)&&this._animateMarker()}_animateMarker(){let e=-15;const t=this.props.readReceiptInfo;t&&t.parent&&(e=t.top+t.parent.getBoundingClientRect().top);const a=this._avatar.current;let n;a.offsetParent?n=e-a.offsetParent.getBoundingClientRect().top:(console.warn(`ReadReceiptMarker for ${this.props.fallbackUserId} in has no offsetParent`),n=0);const s=[];t&&t.left&&s.push({top:n+"px",left:Object(cU.a)(t.left)}),s.push({top:n+"px",left:"0"}),this.setState({suppressDisplay:!1,startStyles:s})}render(){const e=On.getComponent("avatars.MemberAvatar");if(this.state.suppressDisplay)return i.a.createElement("div",{ref:this._avatar});const t={left:Object(cU.a)(this.props.leftOffset),top:"0px"};let a;if(this.props.timestamp){const e=Object(AT.a)(new Date(this.props.timestamp),this.props.showTwelveHour);a=this.props.member&&this.props.fallbackUserId!==this.props.member.rawDisplayName?Object(ts.a)("Seen by %(displayName)s (%(userName)s) at %(dateTime)s",{displayName:this.props.member.rawDisplayName,userName:this.props.fallbackUserId,dateTime:e}):Object(ts.a)("Seen by %(userName)s at %(dateTime)s",{userName:this.props.fallbackUserId,dateTime:e})}return i.a.createElement(oU,{startStyles:this.state.startStyles},i.a.createElement(e,{member:this.props.member,fallbackUserId:this.props.fallbackUserId,"aria-hidden":"true",width:14,height:14,resizeMethod:"crop",style:t,title:a,onClick:this.props.onClick,inputRef:this._avatar}))}},Fe()(lU,"propTypes",{member:At.a.object,fallbackUserId:At.a.string.isRequired,leftOffset:At.a.number,hidden:At.a.bool,suppressAnimation:At.a.bool,readReceiptInfo:At.a.object,checkUnmounting:At.a.func,onClick:At.a.func,timestamp:At.a.number,showTwelveHour:At.a.bool}),Fe()(lU,"defaultProps",{leftOffset:0}),rU=lU))||rU;var mU,uU;function hU(e){return e.canonicalAlias||(e.aliases?e.aliases[0]:"")}const pU=At.a.shape({name:At.a.string,topic:At.a.string,roomId:At.a.string,avatarUrl:At.a.string,numJoinedMembers:At.a.number,canonicalAlias:At.a.string,aliases:At.a.arrayOf(At.a.string),worldReadable:At.a.bool,guestCanJoin:At.a.bool});let gU=Object(os.a)("views.rooms.RoomDetailRow")((uU=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onClick",e=>{e.preventDefault(),this.props.onClick&&this.props.onClick(e,this.props.room)}),Fe()(this,"onTopicClick",e=>{e.stopPropagation()}),this._topic=Object(s.createRef)()}componentDidMount(){this._linkifyTopic()}componentDidUpdate(){this._linkifyTopic()}_linkifyTopic(){this._topic.current&&Object(tS.g)(this._topic.current)}render(){const e=On.getComponent("avatars.BaseAvatar"),t=this.props.room,a=t.name||hU(t)||Object(ts.a)("Unnamed room"),n=t.worldReadable?i.a.createElement("div",{className:"mx_RoomDirectory_perm"},Object(ts.a)("World readable")):i.a.createElement("div",null),s=t.guestCanJoin?i.a.createElement("div",{className:"mx_RoomDirectory_perm"},Object(ts.a)("Guests can join")):i.a.createElement("div",null),o=n||s?i.a.createElement("div",{className:"mx_RoomDirectory_perms"},n," ",s):i.a.createElement("div",null);let r=null;return t.avatarUrl&&(r=Object(Os.b)(t.avatarUrl).getSquareThumbnailHttp(24)),i.a.createElement("tr",{key:t.roomId,onClick:this.onClick,onMouseDown:this.props.onMouseDown},i.a.createElement("td",{className:"mx_RoomDirectory_roomAvatar"},i.a.createElement(e,{width:24,height:24,resizeMethod:"crop",name:a,idName:a,url:r})),i.a.createElement("td",{className:"mx_RoomDirectory_roomDescription"},i.a.createElement("div",{className:"mx_RoomDirectory_name"},a)," ",o,i.a.createElement("div",{className:"mx_RoomDirectory_topic",ref:this._topic,onClick:this.onTopicClick},t.topic),i.a.createElement("div",{className:"mx_RoomDirectory_alias"},hU(t))),i.a.createElement("td",{className:"mx_RoomDirectory_roomMemberCount"},t.numJoinedMembers))}},Fe()(uU,"propTypes",{room:pU,onClick:At.a.func,onMouseDown:At.a.func}),mU=uU))||mU;var fU,vU;let bU=Object(os.a)("views.rooms.RoomDetailList")((vU=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"onDetailsClick",(e,t)=>{gn.a.dispatch({action:"view_room",room_id:t.roomId,room_alias:t.canonicalAlias||(t.aliases||[])[0]})})}getRows(){if(!this.props.rooms)return[];const e=On.getComponent("rooms.RoomDetailRow");return this.props.rooms.map((t,a)=>i.a.createElement(e,{key:a,room:t,onClick:this.onDetailsClick}))}render(){let e;return e=0===this.getRows().length?i.a.createElement("i",null,Object(ts.a)("No rooms to show")):i.a.createElement("table",{className:"mx_RoomDirectory_table"},i.a.createElement("tbody",null,this.getRows())),i.a.createElement("div",{className:Hn()("mx_RoomDetailList",this.props.className)},e)}},Fe()(vU,"propTypes",{rooms:At.a.arrayOf(pU),className:At.a.string}),fU=vU))||fU;var yU,EU,_U=a(881),SU=a(601),CU=a(604),wU=a(603);let OU=Object(os.a)("views.rooms.SearchResultTile")((EU=class extends i.a.Component{render(){const e=On.getComponent("messages.DateSeparator"),t=On.getComponent("rooms.EventTile"),a=this.props.searchResult,n=a.context.getEvent(),s=n.getId(),o=n.getTs(),r=[i.a.createElement(e,{key:o+"-search",ts:o})],l=a.context.getTimeline();for(let e=0;e<l.length;e++){const n=l[e];let o;const c=e!=a.context.getOurEventIndex();c||(o=this.props.searchHighlights),Object(bk.b)(n)&&r.push(i.a.createElement(t,{key:`${s}+${e}`,mxEvent:n,contextual:c,highlights:o,permalinkCreator:this.props.permalinkCreator,highlightLink:this.props.resultLink,onHeightChanged:this.props.onHeightChanged,isTwelveHour:ss.b.getValue("showTwelveHourTimestamps"),enableFlair:ss.b.getValue(vu.a.Flair)}))}return i.a.createElement("li",{"data-scroll-tokens":s},r)}},Fe()(EU,"propTypes",{searchResult:At.a.object.isRequired,searchHighlights:At.a.array,resultLink:At.a.string,onHeightChanged:At.a.func}),yU=EU))||yU;var xU,RU,kU=a(302),IU=a(374),TU=a(1276),PU=a.n(TU);function NU(e,t,a){const n=Ej.a.makeReplyMixIn(t);Object.assign(e,n);const s=Ej.a.getNestedReplyText(t,a);s&&(e.formatted_body&&(e.formatted_body=s.html+e.formatted_body),e.body=s.body+e.body)}let DU=Object(os.a)("views.rooms.SendMessageComposer")((RU=class extends i.a.Component{constructor(e,t){super(e,t),Fe()(this,"_setEditorRef",e=>{this._editorRef=e}),Fe()(this,"_onKeyDown",e=>{if(this._editorRef.isComposing(e))return;const t=Object(Li.f)().getMessageComposerAction(e);switch(t){case Li.b.Send:this._sendMessage(),e.preventDefault();break;case Li.b.SelectPrevSendHistory:case Li.b.SelectNextSendHistory:this.selectSendHistory(t===Li.b.SelectPrevSendHistory)&&e.preventDefault();break;case Li.b.EditPrevMessage:if(this._editorRef.isSelectionCollapsed()&&this._editorRef.isCaretAtStart()){const t=Object(WO.b)(this.props.room,!1);t&&(e.preventDefault(),gn.a.dispatch({action:"edit_event",event:t}))}break;case Li.b.CancelEditing:gn.a.dispatch({action:"reply_to_event",event:null});break;default:this._prepareToEncrypt&&this._prepareToEncrypt()}}),Fe()(this,"_shouldSaveStoredEditorState",()=>!this.model.isEmpty||this.props.replyToEvent),Fe()(this,"_saveStoredEditorState",()=>{if(this._shouldSaveStoredEditorState()){const e=GM.createItem(this.model,this.props.replyToEvent);localStorage.setItem(this._editorStateKey,JSON.stringify(e))}else this._clearStoredEditorState()}),Fe()(this,"onAction",e=>{if(!this.props.disabled)switch(e.action){case"reply_to_event":case js.a.FocusComposer:this._editorRef&&this._editorRef.focus();break;case"insert_mention":this._insertMention(e.user_id);break;case"quote":this._insertQuotedMessage(e.event);break;case"insert_emoji":this._insertEmoji(e.emoji)}}),Fe()(this,"_insertEmoji",e=>{const{model:t}=this,{partCreator:a}=t,n=this._editorRef.getCaret(),s=t.positionForOffset(n.offset,n.atNodeEnd);t.transform(()=>{const i=t.insert([a.plain(e)],s);return t.positionForOffset(n.offset+i,!0)})}),Fe()(this,"_onPaste",e=>{const{clipboardData:t}=e;if(t.files.length&&!t.types.some(e=>"text/plain"===e))return BS.a.sharedInstance().sendContentListToRoom(Array.from(t.files),this.props.room.roomId,this.context),!0}),Fe()(this,"onChange",()=>{this.props.onChange&&this.props.onChange(this.model)}),this.model=null,this._editorRef=null,this.currentlyComposedEditorState=null,this.context.isCryptoEnabled()&&this.context.isRoomEncrypted(this.props.room.roomId)&&(this._prepareToEncrypt=new kU.a(()=>{this.context.prepareToEncrypt(this.props.room)},6e4)),window.addEventListener("beforeunload",this._saveStoredEditorState)}selectSendHistory(e){const t=e?-1:1;if(this.sendHistoryManager.currentIndex===this.sendHistoryManager.history.length){if(!e)return;this.currentlyComposedEditorState=this.model.serializeParts()}else if(this.sendHistoryManager.currentIndex+t===this.sendHistoryManager.history.length)return this.model.reset(this.currentlyComposedEditorState),void(this.sendHistoryManager.currentIndex=this.sendHistoryManager.history.length);const{parts:a,replyEventId:n}=this.sendHistoryManager.getItem(t);gn.a.dispatch({action:"reply_to_event",event:n?this.props.room.findEventById(n):null}),a&&(this.model.reset(a),this._editorRef.focus())}_isSlashCommand(){const e=this.model.parts[0];if(e){if("command"===e.type&&e.text.startsWith("/")&&!e.text.startsWith("//"))return!0;if(e.text.startsWith("/")&&!e.text.startsWith("//")&&("plain"===e.type||"pill-candidate"===e.type))return!0}return!1}_sendQuickReaction(){const e=this.props.room.getLiveTimeline().getEvents(),t=this.model.parts[1].text;for(let a=e.length-1;a>=0;a--)if("m.room.message"===e[a].getType()){let n=!0;const s=e[a],i=Cs.a.get().getUserId(),o=this.props.room.getUnfilteredTimelineSet().getRelationsForEvent(s.getId(),"m.annotation","m.reaction");if(o){n=![...o.getAnnotationsBySender()[i]||[]].filter(e=>!e.isRedacted()).map(e=>e.getRelation().key).includes(t)}n&&(Cs.a.get().sendEvent(s.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:s.getId(),key:t}}),gn.a.dispatch({action:"message_sent"}));break}}_getSlashCommand(){const e=this.model.parts.reduce((e,t)=>"user-pill"===t.type?e+t.resourceId:e+t.text,""),{cmd:t,args:a}=Wx(e);return[t,a,e]}async _runSlashCommand(e,t){const a=e.run(this.props.room.roomId,t);let n,s=a.error;if(a.promise)try{e.category===Ux.messages?n=await a.promise:await a.promise}catch(e){s=e}if(s){console.error("Command failure: %s",s);const e=On.getComponent("dialogs.ErrorDialog"),t=!!a.promise?Object(ts.b)("Server error"):Object(ts.b)("Command error");let n;n="string"==typeof s?s:s.message?s.message:Object(ts.a)("Server unavailable, overloaded, or something else went wrong."),qd.a.createTrackedDialog(t,"",e,{title:Object(ts.a)(t),description:n})}else if(console.log("Command success."),n)return n}async _sendMessage(){if(this.model.isEmpty)return;const e=this.props.replyToEvent;let t,a=!0;if(!AM(this.model)&&this._isSlashCommand()){const[n,s,o]=this._getSlashCommand();if(n)n.category===Ux.messages?(t=await this._runSlashCommand(n,s),e&&NU(t,e,this.props.permalinkCreator)):(this._runSlashCommand(n,s),a=!1);else{const e=On.getComponent("dialogs.QuestionDialog"),{finished:t}=qd.a.createTrackedDialog("Unknown command","",e,{title:Object(ts.a)("Unknown Command"),description:i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("Unrecognised command: %(commandText)s",{commandText:o})),i.a.createElement("p",null,Object(ts.a)("You can use <code>/help</code> to list available commands. Did you mean to send this as a message?",{},{code:e=>i.a.createElement("code",null,e)})),i.a.createElement("p",null,Object(ts.a)("Hint: Begin your message with <code>//</code> to start it with a slash.",{},{code:e=>i.a.createElement("code",null,e)}))),button:Object(ts.a)("Send as message")}),[a]=await t;if(!a)return}}if(function(e){const t=e.parts;if(0==t.length)return!1;const a=jM(e);if(t.length<=2){const e=a.startsWith("+")||a.startsWith("+ "),t=a.match(PU.a);if(e&&t&&1==t.length)return t[0]===a.substring(1)||t[0]===a.substring(2)}return!1}(this.model)&&(a=!1,this._sendQuickReaction()),a){const a=Xc.a.getTimestamp(),{roomId:n}=this.props.room;if(t||(t=function(e,t,a){const n=AM(e);n&&(e=UM(e)),MM(e,"//")&&(e=LM(e,"/"));const s={msgtype:n?"m.emote":"m.text",body:jM(e=function(e){const{parts:t}=e;if(t.length){const a=t[0];"plain"===a.type&&a.text.startsWith("\\/")&&(e=e.clone()).removeText({index:0,offset:0},1)}return e}(e))},i=DM(e,{forceHTML:!!a});return i&&(s.format="org.matrix.custom.html",s.formatted_body=i),a&&NU(s,a,t),s}(this.model,this.props.permalinkCreator,e)),!t.body.trim())return;const s=this.context.sendMessage(n,t);e&&gn.a.dispatch({action:"reply_to_event",event:null}),gn.a.dispatch({action:"message_sent"}),Dx.CHAT_EFFECTS.forEach(e=>{Object(IU.containsEmoji)(t,e.emojis)&&gn.a.dispatch({action:"effects."+e.command})}),Xc.a.instance.trackSendMessage(a,s,n,!1,!!e,t)}this.sendHistoryManager.save(this.model,e),this.model.reset([]),this._editorRef.clearUndoHistory(),this._editorRef.focus(),this._clearStoredEditorState(),ss.b.getValue("scrollToBottomOnMessageSent")&&gn.a.dispatch({action:"scroll_to_bottom"})}componentWillUnmount(){gn.a.unregister(this.dispatcherRef),window.removeEventListener("beforeunload",this._saveStoredEditorState),this._saveStoredEditorState()}UNSAFE_componentWillMount(){const e=new JR(this.props.room,this.context),t=this._restoreStoredEditorState(e)||[];this.model=new kM(t,e),this.dispatcherRef=gn.a.register(this.onAction),this.sendHistoryManager=new GM(this.props.room.roomId,"mx_cider_history_")}get _editorStateKey(){return"mx_cider_state_"+this.props.room.roomId}_clearStoredEditorState(){localStorage.removeItem(this._editorStateKey)}_restoreStoredEditorState(e){const t=localStorage.getItem(this._editorStateKey);if(t)try{const{parts:a,replyEventId:n}=JSON.parse(t),s=a.map(t=>e.deserializePart(t));return n&&gn.a.dispatch({action:"reply_to_event",event:this.props.room.findEventById(n)}),s}catch(e){console.error(e)}}_insertMention(e){const{model:t}=this,{partCreator:a}=t,n=this.props.room.getMember(e),s=n?n.rawDisplayName:e,i=this._editorRef.getCaret(),o=t.positionForOffset(i.offset,i.atNodeEnd),r=a.createMentionParts(0===i.offset,s,e);t.transform(()=>{const e=t.insert(r,o);return t.positionForOffset(i.offset+e,!0)}),this._editorRef&&this._editorRef.focus()}_insertQuotedMessage(e){const{model:t}=this,{partCreator:a}=t,n=sk(e,a,{isQuotedMessage:!0});n.push(a.newline()),n.push(a.newline()),t.transform(()=>{const e=t.insert(n,t.positionForOffset(0));return t.positionForOffset(e,!0)}),this._editorRef&&this._editorRef.focus()}render(){return i.a.createElement("div",{className:"mx_SendMessageComposer",onClick:this.focusComposer,onKeyDown:this._onKeyDown},i.a.createElement(fk,{onChange:this.onChange,ref:this._setEditorRef,model:this.model,room:this.props.room,label:this.props.placeholder,placeholder:this.props.placeholder,onPaste:this._onPaste,disabled:this.props.disabled}))}},Fe()(RU,"propTypes",{room:At.a.object.isRequired,placeholder:At.a.string,permalinkCreator:At.a.object.isRequired,replyToEvent:At.a.object,onChange:At.a.func,disabled:At.a.bool}),Fe()(RU,"contextType",ns.a),xU=RU))||xU;var jU,AU,MU=a(860);let UU=Object(os.a)("views.rooms.TopUnreadMessagesBar")((AU=class extends i.a.Component{render(){return i.a.createElement("div",{className:"mx_TopUnreadMessagesBar"},i.a.createElement(Fs.a,{className:"mx_TopUnreadMessagesBar_scrollUp",title:Object(ts.a)("Jump to first unread message."),onClick:this.props.onScrollUpClick}),i.a.createElement(Fs.a,{className:"mx_TopUnreadMessagesBar_markAsRead",title:Object(ts.a)("Mark all as read"),onClick:this.props.onCloseClick}))}},Fe()(AU,"propTypes",{onScrollUpClick:At.a.func,onCloseClick:At.a.func}),jU=AU))||jU;const LU=e=>{let{avatarUrl:t,avatarAltText:a,avatarName:n,uploadAvatar:o,removeAvatar:r}=e;const[l,c]=Object(s.useState)(!1),d={onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1)};let m,h,p=i.a.createElement(Fs.a,u()({element:"div",onClick:o,className:"mx_AvatarSetting_avatarPlaceholder"},d));t&&(p=i.a.createElement(Fs.a,u()({element:"img",src:t,alt:a,"aria-label":a,onClick:o},d))),o&&(m=i.a.createElement(Fs.a,u()({onClick:o,className:"mx_AvatarSetting_uploadButton"},d))),t&&r&&(h=i.a.createElement(Fs.a,{onClick:r,kind:"link_sm"},Object(ts.a)("Remove")));const g=Hn()({mx_AvatarSetting_avatar:!0,mx_AvatarSetting_avatar_hovering:l&&o});return i.a.createElement("div",{className:g},p,i.a.createElement("div",{className:"mx_AvatarSetting_hover"},i.a.createElement("div",{className:"mx_AvatarSetting_hoverBg"}),i.a.createElement("span",null,Object(ts.a)("Upload"))),m,h)};LU.propTypes={avatarUrl:At.a.string,avatarName:At.a.string.isRequired,uploadAvatar:At.a.func,removeAvatar:At.a.func,avatarAltText:At.a.string.isRequired};var FU,BU,VU=LU;let GU=Object(os.a)("views.settings.ChangeAvatar")((BU=class e extends i.a.Component{constructor(t){super(t),Fe()(this,"onRoomStateEvents",e=>{this.props.room&&e.getRoomId()===this.props.room.roomId&&"m.room.avatar"===e.getType()&&e.getSender()===Cs.a.get().getUserId()&&(e.getContent().url||(this.avatarSet=!1,this.setState({})))}),Fe()(this,"onFileSelected",e=>(this.avatarSet=!0,this.setAvatarFromFile(e.target.files[0]))),Fe()(this,"onError",e=>{this.setState({errorText:Object(ts.a)("Failed to upload profile picture!")})}),this.state={avatarUrl:this.props.initialAvatarUrl,phase:e.Phases.Display}}componentDidMount(){Cs.a.get().on("RoomState.events",this.onRoomStateEvents)}UNSAFE_componentWillReceiveProps(e){this.avatarSet||this.setState({avatarUrl:e.initialAvatarUrl})}componentWillUnmount(){Cs.a.get()&&Cs.a.get().removeListener("RoomState.events",this.onRoomStateEvents)}setAvatarFromFile(t){let a=null;this.setState({phase:e.Phases.Uploading});const n=this,s=Cs.a.get().uploadContent(t).then((function(e){return a=e,n.props.room?Cs.a.get().sendStateEvent(n.props.room.roomId,"m.room.avatar",{url:e},""):Cs.a.get().setAvatarUrl(e)}));return s.then((function(){n.setState({phase:e.Phases.Display,avatarUrl:Object(Os.b)(a).srcHttp})}),(function(t){n.setState({phase:e.Phases.Error}),n.onError(t)})),s}render(){let t,a;if(this.props.room&&!this.avatarSet){const e=On.getComponent("avatars.RoomAvatar");t=i.a.createElement(e,{room:this.props.room,width:this.props.width,height:this.props.height,resizeMethod:"crop"})}else{const e=On.getComponent("avatars.BaseAvatar");t=i.a.createElement(e,{width:this.props.width,height:this.props.height,resizeMethod:"crop",name:"?",idName:Cs.a.get().getUserIdLocalpart(),url:this.state.avatarUrl})}switch(this.props.showUploadSection&&(a=i.a.createElement("div",{className:this.props.className},Object(ts.a)("Upload new:"),i.a.createElement("input",{type:"file",accept:"image/*",onChange:this.onFileSelected}),this.state.errorText)),this.state.phase){case e.Phases.Display:case e.Phases.Error:return i.a.createElement("div",null,i.a.createElement("div",{className:this.props.className},t),a);case e.Phases.Uploading:return i.a.createElement(Jc.a,null)}}},Fe()(BU,"propTypes",{initialAvatarUrl:At.a.string,room:At.a.object,showUploadSection:At.a.bool,width:At.a.number,height:At.a.number,className:At.a.string}),Fe()(BU,"Phases",{Display:"display",Uploading:"uploading",Error:"error"}),Fe()(BU,"defaultProps",{showUploadSection:!0,className:"",width:80,height:80}),FU=BU))||FU;var zU;let WU=Object(os.a)("views.settings.ChangeDisplayName")(zU=class extends i.a.Component{constructor(){super(...arguments),Fe()(this,"_getDisplayName",async()=>{const e=Cs.a.get();try{return(await e.getProfileInfo(e.getUserId())).displayname}catch(e){throw new Error("Failed to fetch display name")}}),Fe()(this,"_changeDisplayName",e=>Cs.a.get().setDisplayName(e).catch((function(e){throw new Error("Failed to set display name",e)})))}render(){const e=On.getComponent("elements.EditableTextContainer");return i.a.createElement(e,{getInitialValue:this._getDisplayName,placeholder:Object(ts.a)("No display name"),blurToSubmit:!0,onSubmit:this._changeDisplayName})}})||zU;var HU,KU;let qU=Object(os.a)("views.settings.ChangePassword")((KU=class e extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{fieldValid:{},phase:e.Phases.Edit,oldPassword:"",newPassword:"",newPasswordConfirm:""}),Fe()(this,"_onExportE2eKeysClicked",()=>{qd.a.createTrackedDialogAsync("Export E2E Keys","Change Password",a.e(4).then(a.bind(null,8461)),{matrixClient:Cs.a.get()})}),Fe()(this,"onChangeOldPassword",e=>{this.setState({oldPassword:e.target.value})}),Fe()(this,"onOldPasswordValidate",async e=>{const t=await this.validateOldPasswordRules(e);return this.markFieldValid("field_old_password",t.valid),t}),Fe()(this,"validateOldPasswordRules",Object(lm.a)({rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(ts.a)("Passwords can't be empty")}]})),Fe()(this,"onChangeNewPassword",e=>{this.setState({newPassword:e.target.value})}),Fe()(this,"onNewPasswordValidate",e=>{this.markFieldValid("field_new_password",e.valid)}),Fe()(this,"onChangeNewPasswordConfirm",e=>{this.setState({newPasswordConfirm:e.target.value})}),Fe()(this,"onNewPasswordConfirmValidate",async e=>{const t=await this.validatePasswordConfirmRules(e);return this.markFieldValid("field_new_password_confirm",t.valid),t}),Fe()(this,"validatePasswordConfirmRules",Object(lm.a)({rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(ts.a)("Confirm password")},{key:"match",test(e){let{value:t}=e;return!t||t===this.state.newPassword},invalid:()=>Object(ts.a)("Passwords don't match")}]})),Fe()(this,"onClickChange",async e=>{e.preventDefault();if(!await this.verifyFieldsBeforeSubmit())return void Xc.a.instance.track("onboarding_registration_submit_failed");const t=this.state.oldPassword,a=this.state.newPassword,n=this.state.newPasswordConfirm,s=this.props.onCheckPassword(t,a,n);s?this.props.onError(s):this.changePassword(t,a)})}changePassword(e,t){const a=Cs.a.get();if(!this.props.confirm)return void this._changePassword(a,e,t);const n=On.getComponent("dialogs.QuestionDialog");qd.a.createTrackedDialog("Change Password","",n,{title:Object(ts.a)("Warning!"),description:i.a.createElement("div",null,Object(ts.a)("Changing password will currently reset any end-to-end encryption keys on all sessions, making encrypted chat history unreadable, unless you first export your room keys and re-import them afterwards. In future this will be improved.")," ",i.a.createElement("a",{href:"https://github.com/vector-im/element-web/issues/2671",target:"_blank",rel:"noreferrer noopener"},"https://github.com/vector-im/element-web/issues/2671")),button:Object(ts.a)("Continue"),extraButtons:[i.a.createElement("button",{key:"exportRoomKeys",className:"mx_Dialog_primary",onClick:this._onExportE2eKeysClicked},Object(ts.a)("Export E2E room keys"))],onFinished:n=>{n&&this._changePassword(a,e,t)}})}_changePassword(t,a,n){const s={type:"m.login.password",identifier:{type:"m.id.user",user:t.credentials.userId},user:t.credentials.userId,password:a};this.setState({phase:e.Phases.Uploading}),t.setPassword(s,n).then(()=>{if(this.props.shouldAskForEmail)return this._optionallySetEmail().then(e=>{this.props.onFinished({didSetEmail:e})});this.props.onFinished()},e=>{this.props.onError(e)}).finally(()=>{this.setState({phase:e.Phases.Edit,oldPassword:"",newPassword:"",newPasswordConfirm:""})})}_optionallySetEmail(){const e=On.getComponent("dialogs.SetEmailDialog");return qd.a.createTrackedDialog("Do you want to set an email address?","",e,{title:Object(ts.a)("Do you want to set an email address?")}).finished.then(e=>{let[t]=e;return t})}markFieldValid(e,t){const{fieldValid:a}=this.state;a[e]=t,this.setState({fieldValid:a})}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=["field_old_password","field_new_password","field_new_password_confirm"];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise(e=>this.setState({},e)),this.allFieldsValid())return!0;const a=this.findFirstInvalidField(t);return!a||(a.focus(),a.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){const e=Object.keys(this.state.fieldValid);for(let t=0;t<e.length;++t)if(!this.state.fieldValid[e[t]])return!1;return!0}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}render(){const t=this.props.rowClassName,a=this.props.buttonClassName;switch(this.state.phase){case e.Phases.Edit:return i.a.createElement("form",{className:this.props.className,onSubmit:this.onClickChange},i.a.createElement("div",{className:t},i.a.createElement(rm.a,{ref:e=>this.field_old_password=e,type:"password",label:Object(ts.a)("Current password"),value:this.state.oldPassword,onChange:this.onChangeOldPassword,onValidate:this.onOldPasswordValidate})),i.a.createElement("div",{className:t},i.a.createElement(zC.a,{fieldRef:e=>this.field_new_password=e,type:"password",label:"New Password",minScore:3,value:this.state.newPassword,autoFocus:this.props.autoFocusNewPasswordInput,onChange:this.onChangeNewPassword,onValidate:this.onNewPasswordValidate,autoComplete:"new-password"})),i.a.createElement("div",{className:t},i.a.createElement(rm.a,{ref:e=>this.field_new_password_confirm=e,type:"password",label:Object(ts.a)("Confirm password"),value:this.state.newPasswordConfirm,onChange:this.onChangeNewPasswordConfirm,onValidate:this.onNewPasswordConfirmValidate,autoComplete:"new-password"})),i.a.createElement(Fs.a,{className:a,kind:this.props.buttonKind,onClick:this.onClickChange},this.props.buttonLabel||Object(ts.a)("Change Password")));case e.Phases.Uploading:return i.a.createElement("div",{className:"mx_Dialog_content"},i.a.createElement(Jc.a,null))}}},Fe()(KU,"propTypes",{onFinished:At.a.func,onError:At.a.func,onCheckPassword:At.a.func,rowClassName:At.a.string,buttonClassName:At.a.string,buttonKind:At.a.string,buttonLabel:At.a.string,confirm:At.a.bool,autoFocusNewPasswordInput:At.a.bool}),Fe()(KU,"Phases",{Edit:"edit",Uploading:"uploading",Error:"error"}),Fe()(KU,"defaultProps",{onFinished(){},onError(){},onCheckPassword:(e,t,a)=>t!==a?{error:Object(ts.a)("New passwords don't match")}:t&&0!==t.length?void 0:{error:Object(ts.a)("Passwords can't be empty")},confirm:!0}),HU=KU))||HU;var YU;let $U=Object(os.a)("views.settings.CrossSigningPanel")(YU=class extends i.a.PureComponent{constructor(e){super(e),Fe()(this,"onAccountData",e=>{const t=e.getType();(t.startsWith("m.cross_signing")||t.startsWith("m.secret_storage"))&&this._getUpdatedStatus()}),Fe()(this,"_onBootstrapClick",()=>{this._bootstrapCrossSigning({forceReset:!1})}),Fe()(this,"onStatusChanged",()=>{this._getUpdatedStatus()}),Fe()(this,"_bootstrapCrossSigning",async e=>{let{forceReset:t=!1}=e;this.setState({error:null});try{const e=Cs.a.get();await e.bootstrapCrossSigning({authUploadDeviceSigningKeys:async t=>{const{finished:a}=qd.a.createTrackedDialog("Cross-signing keys dialog","",hP,{title:Object(ts.a)("Setting up keys"),matrixClient:e,makeRequest:t}),[n]=await a;if(!n)throw new Error("Cross-signing key upload auth canceled")},setupNewCrossSigning:t})}catch(e){this.setState({error:e}),console.error("Error bootstrapping cross-signing",e)}this._unmounted||this._getUpdatedStatus()}),Fe()(this,"_resetCrossSigning",()=>{qd.a.createDialog(WD,{onFinished:e=>{e&&this._bootstrapCrossSigning({forceReset:!0})}})}),this._unmounted=!1,this.state={error:null,crossSigningPublicKeysOnDevice:null,crossSigningPrivateKeysInStorage:null,masterPrivateKeyCached:null,selfSigningPrivateKeyCached:null,userSigningPrivateKeyCached:null,homeserverSupportsCrossSigning:null,crossSigningReady:null}}componentDidMount(){const e=Cs.a.get();e.on("accountData",this.onAccountData),e.on("userTrustStatusChanged",this.onStatusChanged),e.on("crossSigning.keysChanged",this.onStatusChanged),this._getUpdatedStatus()}componentWillUnmount(){this._unmounted=!0;const e=Cs.a.get();e&&(e.removeListener("accountData",this.onAccountData),e.removeListener("userTrustStatusChanged",this.onStatusChanged),e.removeListener("crossSigning.keysChanged",this.onStatusChanged))}async _getUpdatedStatus(){const e=Cs.a.get(),t=e.getCrossSigningCacheCallbacks(),a=e.crypto._crossSigningInfo,n=e.crypto._secretStorage,s=a.getId(),i=await a.isStoredInSecretStorage(n),o=!(!t||!await t.getCrossSigningKeyCache("master")),r=!(!t||!await t.getCrossSigningKeyCache("self_signing")),l=!(!t||!await t.getCrossSigningKeyCache("user_signing")),c=await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing"),d=await e.isCrossSigningReady();this.setState({crossSigningPublicKeysOnDevice:s,crossSigningPrivateKeysInStorage:i,masterPrivateKeyCached:o,selfSigningPrivateKeyCached:r,userSigningPrivateKeyCached:l,homeserverSupportsCrossSigning:c,crossSigningReady:d})}render(){const e=On.getComponent("elements.AccessibleButton"),{error:t,crossSigningPublicKeysOnDevice:a,crossSigningPrivateKeysInStorage:n,masterPrivateKeyCached:s,selfSigningPrivateKeyCached:o,userSigningPrivateKeyCached:r,homeserverSupportsCrossSigning:l,crossSigningReady:c}=this.state;let d,m;t&&(d=i.a.createElement("div",{className:"error"},t.toString())),m=void 0===l?i.a.createElement(Jc.a,null):l?c?i.a.createElement("p",null,"✅ ",Object(ts.a)("Cross-signing is ready for use.")):n?i.a.createElement("p",null,Object(ts.a)("Your account has a cross-signing identity in secret storage, but it is not yet trusted by this session.")):i.a.createElement("p",null,Object(ts.a)("Cross-signing is not set up.")):i.a.createElement("p",null,Object(ts.a)("Your homeserver does not support cross-signing."));const u=a||n||s||o||r,h=[];let p;return!(a&&n&&s&&o&&r)&&l&&h.push(i.a.createElement(e,{key:"setup",kind:"primary",onClick:this._onBootstrapClick},Object(ts.a)("Set up"))),u&&h.push(i.a.createElement(e,{key:"reset",kind:"danger",onClick:this._resetCrossSigning},Object(ts.a)("Reset"))),h.length&&(p=i.a.createElement("div",{className:"mx_CrossSigningPanel_buttonRow"},h)),i.a.createElement("div",null,m,i.a.createElement("details",null,i.a.createElement("summary",null,Object(ts.a)("Advanced")),i.a.createElement("table",{className:"mx_CrossSigningPanel_statusList"},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,Object(ts.a)("Cross-signing public keys:")),i.a.createElement("td",null,a?Object(ts.a)("in memory"):Object(ts.a)("not found"))),i.a.createElement("tr",null,i.a.createElement("td",null,Object(ts.a)("Cross-signing private keys:")),i.a.createElement("td",null,n?Object(ts.a)("in secret storage"):Object(ts.a)("not found in storage"))),i.a.createElement("tr",null,i.a.createElement("td",null,Object(ts.a)("Master private key:")),i.a.createElement("td",null,s?Object(ts.a)("cached locally"):Object(ts.a)("not found locally"))),i.a.createElement("tr",null,i.a.createElement("td",null,Object(ts.a)("Self signing private key:")),i.a.createElement("td",null,o?Object(ts.a)("cached locally"):Object(ts.a)("not found locally"))),i.a.createElement("tr",null,i.a.createElement("td",null,Object(ts.a)("User signing private key:")),i.a.createElement("td",null,r?Object(ts.a)("cached locally"):Object(ts.a)("not found locally"))),i.a.createElement("tr",null,i.a.createElement("td",null,Object(ts.a)("Homeserver feature support:")),i.a.createElement("td",null,l?Object(ts.a)("exists"):Object(ts.a)("not found")))))),d,p)}})||YU;var JU;let QU=Object(os.a)("views.settings.DevicesPanel")(JU=class extends i.a.Component{constructor(e){super(e),this.state={devices:void 0,deviceLoadError:void 0,selectedDevices:[],deleting:!1},this._unmounted=!1,this._renderDevice=this._renderDevice.bind(this),this._onDeviceSelectionToggled=this._onDeviceSelectionToggled.bind(this),this._onDeleteClick=this._onDeleteClick.bind(this)}componentDidMount(){this._loadDevices()}componentWillUnmount(){this._unmounted=!0}_loadDevices(){Cs.a.get().getDevices().then(e=>{this._unmounted||this.setState({devices:e.devices||[]})},e=>{if(this._unmounted)return;let t;404==e.httpStatus?t=Object(ts.a)("Your homeserver does not support session management."):(console.error("Error loading sessions:",e),t=Object(ts.a)("Unable to load session list")),this.setState({deviceLoadError:t})})}_deviceCompare(e,t){const a=(t.last_seen_ts||0)-(e.last_seen_ts||0);if(0!==a)return a;const n=e.device_id,s=t.device_id;return n<s?-1:n>s?1:0}_onDeviceSelectionToggled(e){if(this._unmounted)return;const t=e.device_id;this.setState((e,a)=>{const n=e.selectedDevices.slice(),s=n.indexOf(t);return-1===s?n.push(t):n.splice(s,1),{selectedDevices:n}})}_onDeleteClick(){this.setState({deleting:!0}),this._makeDeleteRequest(null).catch(e=>{if(this._unmounted)return;if(401!==e.httpStatus||!e.data||!e.data.flows)throw e;const t=On.getComponent("dialogs.InteractiveAuthDialog"),a=this.state.selectedDevices.length,n={[GC.c.PHASE_PREAUTH]:{title:Object(ts.a)("Use Single Sign On to continue"),body:Object(ts.a)("Confirm deleting these sessions by using Single Sign On to prove your identity.",{count:a}),continueText:Object(ts.a)("Single Sign On"),continueKind:"primary"},[GC.c.PHASE_POSTAUTH]:{title:Object(ts.a)("Confirm deleting these sessions"),body:Object(ts.a)("Click the button below to confirm deleting these sessions.",{count:a}),continueText:Object(ts.a)("Delete sessions",{count:a}),continueKind:"danger"}};qd.a.createTrackedDialog("Delete Device Dialog","",t,{title:Object(ts.a)("Authentication"),matrixClient:Cs.a.get(),authData:e.data,makeRequest:this._makeDeleteRequest.bind(this),aestheticsForStagePhases:{[GC.c.LOGIN_TYPE]:n,[GC.c.UNSTABLE_LOGIN_TYPE]:n}})}).catch(e=>{console.error("Error deleting sessions",e),this._unmounted}).finally(()=>{this.setState({deleting:!1})})}_makeDeleteRequest(e){return Cs.a.get().deleteMultipleDevices(this.state.selectedDevices,e).then(()=>{this.setState({devices:this.state.devices.filter(e=>!this.state.selectedDevices.includes(e.device_id)),selectedDevices:[]})})}_renderDevice(e){const t=On.getComponent("settings.DevicesPanelEntry");return i.a.createElement(t,{key:e.device_id,device:e,selected:this.state.selectedDevices.includes(e.device_id),onDeviceToggled:this._onDeviceSelectionToggled})}render(){const e=On.getComponent("elements.Spinner"),t=On.getComponent("elements.AccessibleButton");if(void 0!==this.state.deviceLoadError){const e=Hn()(this.props.className,"error");return i.a.createElement("div",{className:e},this.state.deviceLoadError)}const a=this.state.devices;if(void 0===a){const t=this.props.className;return i.a.createElement(e,{className:t})}a.sort(this._deviceCompare);const n=this.state.deleting?i.a.createElement(e,{w:22,h:22}):i.a.createElement(t,{onClick:this._onDeleteClick,kind:"danger_sm"},Object(ts.a)("Delete %(count)s sessions",{count:this.state.selectedDevices.length})),s=Hn()(this.props.className,"mx_DevicesPanel");return i.a.createElement("div",{className:s},i.a.createElement("div",{className:"mx_DevicesPanel_header"},i.a.createElement("div",{className:"mx_DevicesPanel_deviceId"},Object(ts.a)("ID")),i.a.createElement("div",{className:"mx_DevicesPanel_deviceName"},Object(ts.a)("Public Name")),i.a.createElement("div",{className:"mx_DevicesPanel_deviceLastSeen"},Object(ts.a)("Last seen")),i.a.createElement("div",{className:"mx_DevicesPanel_deviceButtons"},this.state.selectedDevices.length>0?n:null)),a.map(this._renderDevice))}})||JU;var XU;QU.propTypes={className:At.a.string};let ZU=Object(os.a)("views.settings.DevicesPanelEntry")(XU=class extends i.a.Component{constructor(e){super(e),this._unmounted=!1,this.onDeviceToggled=this.onDeviceToggled.bind(this),this._onDisplayNameChanged=this._onDisplayNameChanged.bind(this)}componentWillUnmount(){this._unmounted=!0}_onDisplayNameChanged(e){const t=this.props.device;return Cs.a.get().setDeviceDetails(t.device_id,{display_name:e}).catch(e=>{throw console.error("Error setting session display name",e),new Error(Object(ts.a)("Failed to set display name"))})}onDeviceToggled(){this.props.onDeviceToggled(this.props.device)}render(){const e=On.getComponent("elements.EditableTextContainer"),t=this.props.device;let a="";if(t.last_seen_ts){const e=Object(AT.a)(new Date(t.last_seen_ts));a=t.last_seen_ip+" @ "+e.toLocaleString()}let n="";return t.device_id===Cs.a.get().getDeviceId()&&(n=" mx_DevicesPanel_myDevice"),i.a.createElement("div",{className:"mx_DevicesPanel_device"+n},i.a.createElement("div",{className:"mx_DevicesPanel_deviceId"},t.device_id),i.a.createElement("div",{className:"mx_DevicesPanel_deviceName"},i.a.createElement(e,{initialValue:t.display_name,onSubmit:this._onDisplayNameChanged,placeholder:t.device_id})),i.a.createElement("div",{className:"mx_DevicesPanel_lastSeen"},a),i.a.createElement("div",{className:"mx_DevicesPanel_deviceButtons"},i.a.createElement(Hw.a,{onChange:this.onDeviceToggled,checked:this.props.selected})))}})||XU;ZU.propTypes={device:At.a.object.isRequired,onDeviceToggled:At.a.func},ZU.defaultProps={onDeviceToggled:function(){}};var eL=a(1302);let tL,aL,nL,sL;!function(e){e.AllMessages="all_messages",e.DirectMessagesMentionsKeywords="dm_mentions_keywords",e.MentionsKeywordsOnly="mentions_keywords",e.Never="never"}(tL||(tL={})),function(e){e.Notify="notify",e.DontNotify="dont_notify",e.Coalesce="coalesce",e.MarkUnread="mark_unread"}(aL||(aL={})),function(e){e.Override="override",e.ContentSpecific="content",e.RoomSpecific="room",e.SenderSpecific="sender",e.Underride="underride"}(nL||(nL={})),function(e){e.MasterRule=".m.rule.master",e.MessageRule=".m.rule.message",e.EncryptedMessageRule=".m.rule.encrypted",e.RoomOneToOneRule=".m.rule.room_one_to_one",e.EncryptedRoomOneToOneRule=".m.rule.room_one_to_one"}(sL||(sL={}));class iL{static encodeActions(e){const t=e.notify,a=e.sound,n=e.highlight;if(t){const e=[aL.Notify];return a&&e.push({set_tweak:"sound",value:a}),n?e.push({set_tweak:"highlight"}):e.push({set_tweak:"highlight",value:!1}),e}return[aL.DontNotify]}static decodeActions(e){let t=!1,a=null,n=!1;for(let s=0;s<e.length;++s){const i=e[s];if(i===aL.Notify)t=!0;else if(i===aL.DontNotify)t=!1;else{if("object"!=typeof i)return null;if("sound"===i.set_tweak)a=i.value;else{if("highlight"!==i.set_tweak)return null;n=i.value}}}void 0===n&&(n=!0);const s={notify:t,highlight:n};return null!==a&&(s.sound=a),s}}const oL=iL.encodeActions;class rL{}let lL;Fe()(rL,"ACTION_NOTIFY",oL({notify:!0})),Fe()(rL,"ACTION_NOTIFY_DEFAULT_SOUND",oL({notify:!0,sound:"default"})),Fe()(rL,"ACTION_NOTIFY_RING_SOUND",oL({notify:!0,sound:"ring"})),Fe()(rL,"ACTION_HIGHLIGHT",oL({notify:!0,highlight:!0})),Fe()(rL,"ACTION_HIGHLIGHT_DEFAULT_SOUND",oL({notify:!0,sound:"default",highlight:!0})),Fe()(rL,"ACTION_DONT_NOTIFY",oL({notify:!1})),Fe()(rL,"ACTION_DISABLED",null),function(e){e.Off="off",e.On="on",e.Loud="loud"}(lL||(lL={}));class cL{static actionsFor(e){return e===lL.On?rL.ACTION_NOTIFY:e===lL.Loud?rL.ACTION_HIGHLIGHT_DEFAULT_SOUND:void 0}static contentRuleVectorStateKind(e){const t=iL.decodeActions(e.actions);if(!t)return null;let a=0;t.sound&&a++,t.highlight&&a++;let n=null;switch(a){case 0:n=lL.On;break;case 2:n=lL.Loud}return n}}Fe()(cL,"OFF",lL.Off),Fe()(cL,"ON",lL.On),Fe()(cL,"LOUD",lL.Loud),Fe()(cL,"states",lL);class dL{constructor(e){this.kind=e.kind,this.description=e.description,this.vectorStateToActions=e.vectorStateToActions}ruleToVectorState(e){let t=!1;e&&(t=e.enabled);for(const a in cL.states){const n=cL.states[a],s=this.vectorStateToActions[n];if(s){if(t&&JSON.stringify(iL.decodeActions(e.actions))===JSON.stringify(iL.decodeActions(s)))return n}else if(!t)return n}console.error(`Cannot translate rule actions into Vector rule state. Rule: ${JSON.stringify(e)}, Expected: `+JSON.stringify(this.vectorStateToActions))}}const mL={".m.rule.contains_display_name":new dL({kind:"override",description:Object(ts.b)("Messages containing my display name"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_HIGHLIGHT_DEFAULT_SOUND,off:rL.ACTION_DISABLED}}),".m.rule.contains_user_name":new dL({kind:"override",description:Object(ts.b)("Messages containing my username"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_HIGHLIGHT_DEFAULT_SOUND,off:rL.ACTION_DISABLED}}),".m.rule.roomnotif":new dL({kind:"override",description:Object(ts.b)("Messages containing @room"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_HIGHLIGHT,off:rL.ACTION_DISABLED}}),".m.rule.room_one_to_one":new dL({kind:"underride",description:Object(ts.b)("Messages in one-to-one chats"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_NOTIFY_DEFAULT_SOUND,off:rL.ACTION_DONT_NOTIFY}}),".m.rule.encrypted_room_one_to_one":new dL({kind:"underride",description:Object(ts.b)("Encrypted messages in one-to-one chats"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_NOTIFY_DEFAULT_SOUND,off:rL.ACTION_DONT_NOTIFY}}),".m.rule.message":new dL({kind:"underride",description:Object(ts.b)("Messages in group chats"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_NOTIFY_DEFAULT_SOUND,off:rL.ACTION_DONT_NOTIFY}}),".m.rule.encrypted":new dL({kind:"underride",description:Object(ts.b)("Encrypted messages in group chats"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_NOTIFY_DEFAULT_SOUND,off:rL.ACTION_DONT_NOTIFY}}),".m.rule.invite_for_me":new dL({kind:"underride",description:Object(ts.b)("When I'm invited to a room"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_NOTIFY_DEFAULT_SOUND,off:rL.ACTION_DISABLED}}),".m.rule.call":new dL({kind:"underride",description:Object(ts.b)("Call invitation"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_NOTIFY_RING_SOUND,off:rL.ACTION_DISABLED}}),".m.rule.suppress_notices":new dL({kind:"override",description:Object(ts.b)("Messages sent by bot"),vectorStateToActions:{on:rL.ACTION_DISABLED,loud:rL.ACTION_NOTIFY_DEFAULT_SOUND,off:rL.ACTION_DONT_NOTIFY}}),".m.rule.tombstone":new dL({kind:"override",description:Object(ts.b)("When rooms are upgraded"),vectorStateToActions:{on:rL.ACTION_NOTIFY,loud:rL.ACTION_HIGHLIGHT,off:rL.ACTION_DISABLED}})};var uL,hL;const pL={"im.vector.rule.contains_display_name":".m.rule.contains_display_name","im.vector.rule.room_one_to_one":".m.rule.room_one_to_one","im.vector.rule.room_message":".m.rule.message","im.vector.rule.invite_for_me":".m.rule.invite_for_me","im.vector.rule.call":".m.rule.call","im.vector.rule.notices":".m.rule.suppress_notices"};function gL(e){const t=iL.decodeActions(e);return null!==t?iL.encodeActions(t):e}let fL=Object(os.a)("views.settings.Notifications")((hL=class e extends i.a.Component{constructor(){super(...arguments),Fe()(this,"state",{phase:e.phases.LOADING,masterPushRule:void 0,vectorPushRules:[],vectorContentRules:{vectorState:cL.ON,rules:[]},externalPushRules:[],externalContentRules:[],threepids:[]}),Fe()(this,"onEnableNotificationsChange",t=>{const a=this;this.setState({phase:e.phases.LOADING}),Cs.a.get().setPushRuleEnabled("global",a.state.masterPushRule.kind,a.state.masterPushRule.rule_id,!t).then((function(){a._refreshFromServer()}))}),Fe()(this,"onEnableDesktopNotificationsChange",e=>{ss.b.setValue("notificationsEnabled",null,mi.a.DEVICE,e).finally(()=>{this.forceUpdate()})}),Fe()(this,"onEnableDesktopNotificationBodyChange",e=>{ss.b.setValue("notificationBodyEnabled",null,mi.a.DEVICE,e).finally(()=>{this.forceUpdate()})}),Fe()(this,"onEnableAudioNotificationsChange",e=>{ss.b.setValue("audioNotificationsEnabled",null,mi.a.DEVICE,e).finally(()=>{this.forceUpdate()})}),Fe()(this,"onEnableEmailNotificationsChange",(e,t)=>{let a;if(t){const t={};t.brand=$c.a.get().brand,a=Cs.a.get().setPusher({kind:"email",app_id:"m.email",pushkey:e,app_display_name:"Email Notifications",device_display_name:e,lang:navigator.language,data:t,append:!0})}else{const t=this.getEmailPusher(this.state.pushers,e);t.kind=null,a=Cs.a.get().setPusher(t)}a.then(()=>{this._refreshFromServer()},e=>{const t=On.getComponent("dialogs.ErrorDialog");qd.a.createTrackedDialog("Error saving email notification preferences","",t,{title:Object(ts.a)("Error saving email notification preferences"),description:Object(ts.a)("An error occurred whilst saving your email notification preferences.")})})}),Fe()(this,"onNotifStateButtonClicked",e=>{const t=e.target.className.split("-")[0],a=e.target.className.split("-")[1];if("_keywords"===t)this._setKeywordsPushRuleVectorState(a);else{const e=this.getRule(t);e&&this._setPushRuleVectorState(e,a)}}),Fe()(this,"onKeywordsClicked",e=>{let t=[];for(const e in this.state.vectorContentRules.rules){const a=this.state.vectorContentRules.rules[e];t.push(a.pattern)}t.length?(t.sort(),t=t.join(", ")):t="";const a=On.getComponent("dialogs.TextInputDialog");qd.a.createTrackedDialog("Keywords Dialog","",a,{title:Object(ts.a)("Keywords"),description:Object(ts.a)("Enter keywords separated by a comma:"),button:Object(ts.a)("OK"),value:t,onFinished:(e,a)=>{if(e&&a!==t){let e=a.split(",");for(const t in e)e[t]=e[t].trim();e=e.reduce((function(e,t){return""!==t&&e.indexOf(t)<0&&e.push(t),e}),[]),this._setKeywords(e)}}})}),Fe()(this,"_refreshFromServer",()=>{const t=this,a=Cs.a.get().getPushRules().then(t._portRulesToNewAPI).then((function(e){Cs.a.get().pushRules=e;const a={".m.rule.master":"master",".m.rule.contains_display_name":"vector",".m.rule.contains_user_name":"vector",".m.rule.roomnotif":"vector",".m.rule.room_one_to_one":"vector",".m.rule.encrypted_room_one_to_one":"vector",".m.rule.message":"vector",".m.rule.encrypted":"vector",".m.rule.invite_for_me":"vector",".m.rule.call":"vector",".m.rule.suppress_notices":"vector",".m.rule.tombstone":"vector"},n={master:[],vector:{},others:[]};for(const t in e.global)for(let s=0;s<Object.keys(e.global[t]).length;++s){const i=e.global[t][s],o=a[i.rule_id];i.kind=t,"."===i.rule_id[0]&&("vector"===o?n.vector[i.rule_id]=i:"master"===o?n.master.push(i):n.others.push(i))}n.master.length>0&&(t.state.masterPushRule=n.master[0]);const s=class{static parseContentRules(e){const t=this._categoriseContentRules(e);return t.loud.length?{vectorState:lL.Loud,rules:t.loud,externalRules:[...t.loud_but_disabled,...t.on,...t.on_but_disabled,...t.other]}:t.loud_but_disabled.length?{vectorState:lL.Off,rules:t.loud_but_disabled,externalRules:[...t.on,...t.on_but_disabled,...t.other]}:t.on.length?{vectorState:lL.On,rules:t.on,externalRules:[...t.on_but_disabled,...t.other]}:t.on_but_disabled.length?{vectorState:lL.Off,rules:t.on_but_disabled,externalRules:t.other}:{vectorState:lL.On,rules:[],externalRules:t.other}}static _categoriseContentRules(e){const t={on:[],on_but_disabled:[],loud:[],loud_but_disabled:[],other:[]};for(const a in e.global)for(let n=0;n<Object.keys(e.global[a]).length;++n){const s=e.global[a][n];if("."!==s.rule_id[0]&&"content"===a)switch(s.kind=a,cL.contentRuleVectorStateKind(s)){case lL.On:s.enabled?t.on.push(s):t.on_but_disabled.push(s);break;case lL.Loud:s.enabled?t.loud.push(s):t.loud_but_disabled.push(s);break;default:t.other.push(s)}}return t}}.parseContentRules(e);t.state.vectorContentRules={vectorState:s.vectorState,rules:s.rules},t.state.externalContentRules=s.externalRules,t.state.vectorPushRules=[],t.state.externalPushRules=[];const o=[".m.rule.contains_display_name",".m.rule.contains_user_name",".m.rule.roomnotif","_keywords",".m.rule.room_one_to_one",".m.rule.encrypted_room_one_to_one",".m.rule.message",".m.rule.encrypted",".m.rule.invite_for_me",".m.rule.call",".m.rule.suppress_notices",".m.rule.tombstone"];for(const e in o){const a=o[e];if("_keywords"===a)t.state.vectorPushRules.push({vectorRuleId:"_keywords",description:i.a.createElement("span",null,Object(ts.a)("Messages containing <span>keywords</span>",{},{span:e=>i.a.createElement("span",{className:"mx_UserNotifSettings_keywords",onClick:t.onKeywordsClicked},e)})),vectorState:t.state.vectorContentRules.vectorState});else{const e=mL[a],s=n.vector[a],i=e.ruleToVectorState(s);t.state.vectorPushRules.push({vectorRuleId:a,description:Object(ts.a)(e.description),rule:s,vectorState:i}),s&&!i&&(s.description=e.description,t.state.externalPushRules.push(s))}}const r={".m.rule.message":Object(ts.a)("Notify for all other messages/rooms"),".m.rule.fallback":Object(ts.a)("Notify me for anything else")};for(const e in n.others){const a=n.others[e],s=r[a.rule_id];s&&a.enabled&&!a.default&&(a.description=s,t.state.externalPushRules.push(a))}})),n=Cs.a.get().getPushers().then((function(e){t.setState({pushers:e.pushers})}));Promise.all([a,n]).then((function(){t.setState({phase:e.phases.DISPLAY})}),(function(a){console.error(a),t.setState({phase:e.phases.ERROR})})).finally(()=>{t.setState({masterPushRule:t.state.masterPushRule,vectorContentRules:t.state.vectorContentRules,vectorPushRules:t.state.vectorPushRules,externalContentRules:t.state.externalContentRules,externalPushRules:t.state.externalPushRules})}),Cs.a.get().getThreePids().then(e=>this.setState({threepids:e.threepids}))}),Fe()(this,"_onClearNotifications",()=>{const e=Cs.a.get();e.getRooms().forEach(t=>{if(t.getUnreadNotificationCount()>0){const a=t.getLiveTimeline().getEvents();a.length&&e.sendReadReceipt(a.pop())}})})}componentDidMount(){this._refreshFromServer()}getEmailPusher(e,t){if(void 0!==e)for(let a=0;a<e.length;++a)if("email"===e[a].kind&&e[a].pushkey===t)return e[a]}getRule(e){for(const t in this.state.vectorPushRules){const a=this.state.vectorPushRules[t];if(a.vectorRuleId===e)return a}}_setPushRuleVectorState(t,a){if(t&&t.vectorState!==a){this.setState({phase:e.phases.LOADING});const n=this,s=Cs.a.get(),i=[],o=mL[t.vectorRuleId];if(t.rule){const e=o.vectorStateToActions[a];e?i.push(this._updatePushRuleActions(t.rule,e,!0)):i.push(s.setPushRuleEnabled("global",t.rule.kind,t.rule.rule_id,!1))}Promise.all(i).then((function(){n._refreshFromServer()}),(function(e){const t=On.getComponent("dialogs.ErrorDialog");console.error("Failed to change settings: "+e),qd.a.createTrackedDialog("Failed to change settings","",t,{title:Object(ts.a)("Failed to change settings"),description:e&&e.message?e.message:Object(ts.a)("Operation failed"),onFinished:n._refreshFromServer})}))}}_setKeywordsPushRuleVectorState(t){if(this.state.vectorContentRules.vectorState===t||0===this.state.vectorContentRules.rules.length)return;const a=this,n=Cs.a.get();this.setState({phase:e.phases.LOADING});const s=[];for(const e in this.state.vectorContentRules.rules){const a=this.state.vectorContentRules.rules[e];let i,o;switch(t){case cL.ON:1!==a.actions.length&&(o=cL.actionsFor(cL.ON)),this.state.vectorContentRules.vectorState===cL.OFF&&(i=!0);break;case cL.LOUD:3!==a.actions.length&&(o=cL.actionsFor(cL.LOUD)),this.state.vectorContentRules.vectorState===cL.OFF&&(i=!0);break;case cL.OFF:i=!1}o?s.push(this._updatePushRuleActions(a,o,i)):null!=i&&s.push(n.setPushRuleEnabled("global",a.kind,a.rule_id,i))}Promise.all(s).then((function(e){a._refreshFromServer()}),(function(e){const t=On.getComponent("dialogs.ErrorDialog");console.error("Can't update user notification settings: "+e),qd.a.createTrackedDialog("Can't update user notifcation settings","",t,{title:Object(ts.a)("Can't update user notification settings"),description:e&&e.message?e.message:Object(ts.a)("Operation failed"),onFinished:a._refreshFromServer})}))}_setKeywords(t){this.setState({phase:e.phases.LOADING});const a=this,n=Cs.a.get(),s=[],i=[];for(const e in a.state.vectorContentRules.rules){const o=a.state.vectorContentRules.rules[e];i.push(o.pattern),t.indexOf(o.pattern)<0&&s.push(n.deletePushRule("global",o.kind,o.rule_id))}for(const e in a.state.externalContentRules){const i=a.state.externalContentRules[e];t.indexOf(i.pattern)>=0&&s.push(n.deletePushRule("global",i.kind,i.rule_id))}const o=function(e){const t=On.getComponent("dialogs.ErrorDialog");console.error("Failed to update keywords: "+e),qd.a.createTrackedDialog("Failed to update keywords","",t,{title:Object(ts.a)("Failed to update keywords"),description:e&&e.message?e.message:Object(ts.a)("Operation failed"),onFinished:a._refreshFromServer})};Promise.all(s).then((function(e){const s=[];let r=a.state.vectorContentRules.vectorState;r===cL.OFF&&(r=a.state.vectorContentRules.rules.length?cL.contentRuleVectorStateKind(a.state.vectorContentRules.rules[0]):cL.ON);for(const e in t){const o=t[e];i.indexOf(o)<0&&(a.state.vectorContentRules.vectorState!==cL.OFF?s.push(n.addPushRule("global","content",o,{actions:cL.actionsFor(r),pattern:o})):s.push(a._addDisabledPushRule("global","content",o,{actions:cL.actionsFor(r),pattern:o})))}Promise.all(s).then((function(e){a._refreshFromServer()}),o)}),o)}_addDisabledPushRule(e,t,a,n){const s=Cs.a.get();return s.addPushRule(e,t,a,n).then(()=>s.setPushRuleEnabled(e,t,a,!1))}_portRulesToNewAPI(e){const t=[],a=Cs.a.get();for(const n in e.global){const s=e.global[n];for(let e=0;e<s.length;++e){const i=s[e];i.rule_id in pL&&(console.log("Porting legacy rule",i),t.push(function(e,t){return a.setPushRuleActions("global",e,pL[t.rule_id],gL(t.actions)).then(()=>a.deletePushRule("global",e,t.rule_id)).catch(e=>{console.warn("Error when porting legacy rule: "+e)})}(n,i)))}}return t.length>0?Promise.all(t).then(()=>a.getPushRules()):e}_updatePushRuleActions(e,t,a){const n=Cs.a.get();return n.setPushRuleActions("global",e.kind,e.rule_id,t).then((function(){if(null!=a)return n.setPushRuleEnabled("global",e.kind,e.rule_id,a)}))}renderNotifRulesTableRow(e,t,a){return i.a.createElement("tr",{key:t},i.a.createElement("th",null,e),i.a.createElement("th",null,i.a.createElement("input",{className:t+"-"+cL.OFF,type:"radio",checked:a===cL.OFF,onChange:this.onNotifStateButtonClicked})),i.a.createElement("th",null,i.a.createElement("input",{className:t+"-"+cL.ON,type:"radio",checked:a===cL.ON,onChange:this.onNotifStateButtonClicked})),i.a.createElement("th",null,i.a.createElement("input",{className:t+"-"+cL.LOUD,type:"radio",checked:a===cL.LOUD,onChange:this.onNotifStateButtonClicked})))}renderNotifRulesTableRows(){const e=[];for(const t in this.state.vectorPushRules){const a=this.state.vectorPushRules[t];void 0===a.rule&&a.vectorRuleId.startsWith(".m.")?console.warn(`Skipping render of rule ${a.vectorRuleId} due to no underlying rule`):e.push(this.renderNotifRulesTableRow(a.description,a.vectorRuleId,a.vectorState))}return e}hasEmailPusher(e,t){if(void 0===e)return!1;for(let a=0;a<e.length;++a)if("email"===e[a].kind&&e[a].pushkey===t)return!0;return!1}emailNotificationsRow(e,t){return i.a.createElement(FI.a,{value:this.hasEmailPusher(this.state.pushers,e),onChange:this.onEnableEmailNotificationsChange.bind(this,e),label:t,key:"emailNotif_"+t})}render(){let t,a,n;if(this.state.phase===e.phases.LOADING){const e=On.getComponent("elements.Spinner");t=i.a.createElement(e,null)}if(this.state.masterPushRule&&(a=i.a.createElement(FI.a,{value:!this.state.masterPushRule.enabled,onChange:this.onEnableNotificationsChange,label:Object(ts.a)("Enable notifications for this account")})),Cs.a.get().getRooms().some(e=>e.getUnreadNotificationCount()>0)&&(n=i.a.createElement(Fs.a,{onClick:this._onClearNotifications,kind:"danger"},Object(ts.a)("Clear notifications"))),this.state.masterPushRule&&this.state.masterPushRule.enabled)return i.a.createElement("div",null,a,i.a.createElement("div",{className:"mx_UserNotifSettings_notifTable"},Object(ts.a)("All notifications are currently disabled for all targets.")),n);const s=this.state.threepids.filter(e=>"email"===e.medium);let o;s.length>0?o=s.map(e=>this.emailNotificationsRow(e.address,`${Object(ts.a)("Enable email notifications")} (${e.address})`)):ss.b.getValue(vu.a.ThirdPartyID)&&(o=i.a.createElement("div",null,Object(ts.a)("Add an email address to configure email notifications")));const r=[];for(const e in this.state.externalPushRules){const t=this.state.externalPushRules[e];r.push(i.a.createElement("li",null,Object(ts.a)(t.description)))}let l,c,d=[];for(const e in this.state.externalContentRules){const t=this.state.externalContentRules[e];d.push(t.pattern)}if(d.length&&(d=d.join(", "),r.push(i.a.createElement("li",null,Object(ts.a)("Notifications on the following keywords follow rules which can’t be displayed here:"),d))),void 0===this.state.pushers)l=i.a.createElement("div",{className:"error"},Object(ts.a)("Unable to fetch notification target list"));else if(0===this.state.pushers.length)l=null;else{const e=[];for(let t=0;t<this.state.pushers.length;++t)e.push(i.a.createElement("tr",{key:t},i.a.createElement("td",null,this.state.pushers[t].app_display_name),i.a.createElement("td",null,this.state.pushers[t].device_display_name)));l=i.a.createElement("table",{className:"mx_UserNotifSettings_devicesTable"},i.a.createElement("tbody",null,e))}if(l&&(l=i.a.createElement("div",null,i.a.createElement("h3",null,Object(ts.a)("Notification targets")),l)),r.length){const e=$c.a.get().brand;c=i.a.createElement("div",null,i.a.createElement("h3",null,Object(ts.a)("Advanced notification settings")),Object(ts.a)("There are advanced notifications which are not shown here."),i.a.createElement("br",null),Object(ts.a)("You might have configured them in a client other than %(brand)s. You cannot tune them in %(brand)s but they still apply.",{brand:e}),i.a.createElement("ul",null,r))}return i.a.createElement("div",null,a,i.a.createElement("div",{className:"mx_UserNotifSettings_notifTable"},t,i.a.createElement(FI.a,{value:ss.b.getValue("notificationsEnabled"),onChange:this.onEnableDesktopNotificationsChange,label:Object(ts.a)("Enable desktop notifications for this session")}),i.a.createElement(FI.a,{value:ss.b.getValue("notificationBodyEnabled"),onChange:this.onEnableDesktopNotificationBodyChange,label:Object(ts.a)("Show message in desktop notification")}),i.a.createElement(FI.a,{value:ss.b.getValue("audioNotificationsEnabled"),onChange:this.onEnableAudioNotificationsChange,label:Object(ts.a)("Enable audible notifications for this session")}),o,i.a.createElement("div",{className:"mx_UserNotifSettings_pushRulesTableWrapper"},i.a.createElement("table",{className:"mx_UserNotifSettings_pushRulesTable"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",{width:"55%"}),i.a.createElement("th",{width:"15%"},Object(ts.a)("Off")),i.a.createElement("th",{width:"15%"},Object(ts.a)("On")),i.a.createElement("th",{width:"15%"},Object(ts.a)("Noisy")))),i.a.createElement("tbody",null,this.renderNotifRulesTableRows()))),c,l,n))}},Fe()(hL,"phases",{LOADING:"LOADING",DISPLAY:"DISPLAY",ERROR:"ERROR"}),uL=hL))||uL;var vL,bL=a(1368),yL=a(1402),EL=a(283);let _L=Object(os.a)("views.settings.SetIntegrationManager")(vL=class extends i.a.Component{constructor(){super(),Fe()(this,"onProvisioningToggled",()=>{const e=this.state.provisioningEnabled;ss.b.setValue("integrationProvisioning",null,mi.a.ACCOUNT,!e).catch(t=>{console.error("Error changing integration manager provisioning"),console.error(t),this.setState({provisioningEnabled:e})}),this.setState({provisioningEnabled:!e})});const e=EL.a.sharedInstance().getPrimaryManager();this.state={currentManager:e,provisioningEnabled:ss.b.getValue("integrationProvisioning")}}render(){const e=On.getComponent("views.elements.ToggleSwitch"),t=this.state.currentManager;let a,n;return t?(a=`(${t.name})`,n=Object(ts.a)("Use an Integration Manager <b>(%(serverName)s)</b> to manage bots, widgets, and sticker packs.",{serverName:t.name},{b:e=>i.a.createElement("b",null,e)})):n=Object(ts.a)("Use an Integration Manager to manage bots, widgets, and sticker packs."),i.a.createElement("div",{className:"mx_SetIntegrationManager"},i.a.createElement("div",{className:"mx_SettingsTab_heading"},i.a.createElement("span",null,Object(ts.a)("Manage integrations")),i.a.createElement("span",{className:"mx_SettingsTab_subheading"},a),i.a.createElement(e,{checked:this.state.provisioningEnabled,onChange:this.onProvisioningToggled})),i.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},n,i.a.createElement("br",null),i.a.createElement("br",null),Object(ts.a)("Integration Managers receive configuration data, and can modify widgets, send room invites, and set power levels on your behalf.")))}})||vL;var SL,CL;class wL extends i.a.Component{constructor(){super(),Fe()(this,"_onRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!0})}),Fe()(this,"_onDontRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!1})}),Fe()(this,"_onActuallyRemove",e=>{e.stopPropagation(),e.preventDefault(),Cs.a.get().deleteThreePid(this.props.email.medium,this.props.email.address).then(()=>this.props.onRemoved(this.props.email)).catch(e=>{const t=On.getComponent("dialogs.ErrorDialog");console.error("Unable to remove contact information: "+e),qd.a.createTrackedDialog("Remove 3pid failed","",t,{title:Object(ts.a)("Unable to remove contact information"),description:e&&e.message?e.message:Object(ts.a)("Operation failed")})})}),this.state={verifyRemove:!1}}render(){return this.state.verifyRemove?i.a.createElement("div",{className:"mx_ExistingEmailAddress"},i.a.createElement("span",{className:"mx_ExistingEmailAddress_promptText"},Object(ts.a)("Remove %(email)s?",{email:this.props.email.address})),i.a.createElement(Fs.a,{onClick:this._onActuallyRemove,kind:"danger_sm",className:"mx_ExistingEmailAddress_confirmBtn"},Object(ts.a)("Remove")),i.a.createElement(Fs.a,{onClick:this._onDontRemove,kind:"link_sm",className:"mx_ExistingEmailAddress_confirmBtn"},Object(ts.a)("Cancel"))):i.a.createElement("div",{className:"mx_ExistingEmailAddress"},i.a.createElement("span",{className:"mx_ExistingEmailAddress_email"},this.props.email.address),i.a.createElement(Fs.a,{onClick:this._onRemove,kind:"danger_sm"},Object(ts.a)("Remove")))}}Fe()(wL,"propTypes",{email:At.a.object.isRequired,onRemoved:At.a.func.isRequired});let OL=Object(os.a)("views.settings.account.EmailAddresses")((CL=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_onRemoved",e=>{const t=this.props.emails.filter(t=>t!==e);this.props.onEmailsChange(t)}),Fe()(this,"_onChangeNewEmailAddress",e=>{this.setState({newEmailAddress:e.target.value})}),Fe()(this,"_onAddClick",e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.newEmailAddress)return;const t=On.getComponent("dialogs.ErrorDialog"),a=this.state.newEmailAddress;if(!YS.a(a))return void qd.a.createTrackedDialog("Invalid email address","",t,{title:Object(ts.a)("Invalid Email Address"),description:Object(ts.a)("This doesn't appear to be a valid email address")});const n=new wD;this.setState({verifying:!0,continueDisabled:!0,addTask:n}),n.addEmailAddress(a).then(()=>{this.setState({continueDisabled:!1})}).catch(e=>{console.error("Unable to add email address "+a+" "+e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),qd.a.createTrackedDialog("Unable to add email address","",t,{title:Object(ts.a)("Unable to add email address"),description:e&&e.message?e.message:Object(ts.a)("Operation failed")})})}),Fe()(this,"_onContinueClick",e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0}),this.state.addTask.checkEmailLinkClicked().then(e=>{let[t]=e,a=this.state.newEmailAddress;if(t){const e=this.state.newEmailAddress,t=[...this.props.emails,{address:e,medium:"email"}];this.props.onEmailsChange(t),a=""}this.setState({addTask:null,continueDisabled:!1,verifying:!1,newEmailAddress:a})}).catch(e=>{this.setState({continueDisabled:!1});const t=On.getComponent("dialogs.ErrorDialog");"M_THREEPID_AUTH_FAILED"===e.errcode?qd.a.createTrackedDialog("Email hasn't been verified yet","",t,{title:Object(ts.a)("Your email address hasn't been verified yet"),description:Object(ts.a)("Click the link in the email you received to verify and then click continue again.")}):(console.error("Unable to verify email address: ",e),qd.a.createTrackedDialog("Unable to verify email address","",t,{title:Object(ts.a)("Unable to verify email address."),description:e&&e.message?e.message:Object(ts.a)("Operation failed")}))})}),this.state={verifying:!1,addTask:null,continueDisabled:!1,newEmailAddress:""}}render(){const e=this.props.emails.map(e=>i.a.createElement(wL,{email:e,onRemoved:this._onRemoved,key:e.address}));let t=i.a.createElement(Fs.a,{onClick:this._onAddClick,kind:"primary"},Object(ts.a)("Add"));return this.state.verifying&&(t=i.a.createElement("div",null,i.a.createElement("div",null,Object(ts.a)("We've sent you an email to verify your address. Please follow the instructions there and then click the button below.")),i.a.createElement(Fs.a,{onClick:this._onContinueClick,kind:"primary",disabled:this.state.continueDisabled},Object(ts.a)("Continue")))),i.a.createElement("div",{className:"mx_EmailAddresses"},e,i.a.createElement("form",{onSubmit:this._onAddClick,autoComplete:"off",noValidate:!0,className:"mx_EmailAddresses_new"},i.a.createElement(rm.a,{type:"text",label:Object(ts.a)("Email Address"),autoComplete:"off",disabled:this.state.verifying,value:this.state.newEmailAddress,onChange:this._onChangeNewEmailAddress}),t))}},Fe()(CL,"propTypes",{emails:At.a.array.isRequired,onEmailsChange:At.a.func.isRequired}),SL=CL))||SL;var xL,RL;class kL extends i.a.Component{constructor(){super(),Fe()(this,"_onRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!0})}),Fe()(this,"_onDontRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!1})}),Fe()(this,"_onActuallyRemove",e=>{e.stopPropagation(),e.preventDefault(),Cs.a.get().deleteThreePid(this.props.msisdn.medium,this.props.msisdn.address).then(()=>this.props.onRemoved(this.props.msisdn)).catch(e=>{const t=On.getComponent("dialogs.ErrorDialog");console.error("Unable to remove contact information: "+e),qd.a.createTrackedDialog("Remove 3pid failed","",t,{title:Object(ts.a)("Unable to remove contact information"),description:e&&e.message?e.message:Object(ts.a)("Operation failed")})})}),this.state={verifyRemove:!1}}render(){return this.state.verifyRemove?i.a.createElement("div",{className:"mx_ExistingPhoneNumber"},i.a.createElement("span",{className:"mx_ExistingPhoneNumber_promptText"},Object(ts.a)("Remove %(phone)s?",{phone:this.props.msisdn.address})),i.a.createElement(Fs.a,{onClick:this._onActuallyRemove,kind:"danger_sm",className:"mx_ExistingPhoneNumber_confirmBtn"},Object(ts.a)("Remove")),i.a.createElement(Fs.a,{onClick:this._onDontRemove,kind:"link_sm",className:"mx_ExistingPhoneNumber_confirmBtn"},Object(ts.a)("Cancel"))):i.a.createElement("div",{className:"mx_ExistingPhoneNumber"},i.a.createElement("span",{className:"mx_ExistingPhoneNumber_address"},"+",this.props.msisdn.address),i.a.createElement(Fs.a,{onClick:this._onRemove,kind:"danger_sm"},Object(ts.a)("Remove")))}}Fe()(kL,"propTypes",{msisdn:At.a.object.isRequired,onRemoved:At.a.func.isRequired});let IL=Object(os.a)("views.settings.account.PhoneNumbers")((RL=class extends i.a.Component{constructor(e){super(e),Fe()(this,"_onRemoved",e=>{const t=this.props.msisdns.filter(t=>t!==e);this.props.onMsisdnsChange(t)}),Fe()(this,"_onChangeNewPhoneNumber",e=>{this.setState({newPhoneNumber:e.target.value})}),Fe()(this,"_onChangeNewPhoneNumberCode",e=>{this.setState({newPhoneNumberCode:e.target.value})}),Fe()(this,"_onAddClick",e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.newPhoneNumber)return;const t=On.getComponent("dialogs.ErrorDialog"),a=this.state.newPhoneNumber,n=this.state.phoneCountry,s=new wD;this.setState({verifying:!0,continueDisabled:!0,addTask:s}),s.addMsisdn(n,a).then(e=>{this.setState({continueDisabled:!1,verifyMsisdn:e.msisdn})}).catch(e=>{console.error("Unable to add phone number "+a+" "+e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),qd.a.createTrackedDialog("Add Phone Number Error","",t,{title:Object(ts.a)("Error"),description:e&&e.message?e.message:Object(ts.a)("Operation failed")})})}),Fe()(this,"_onContinueClick",e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0});const t=this.state.newPhoneNumberCode,a=this.state.verifyMsisdn;this.state.addTask.haveMsisdnToken(t).then(e=>{let[t]=e,n=this.state.newPhoneNumber;if(t){const e=[...this.props.msisdns,{address:a,medium:"msisdn"}];this.props.onMsisdnsChange(e),n=""}this.setState({addTask:null,continueDisabled:!1,verifying:!1,verifyMsisdn:"",verifyError:null,newPhoneNumber:n,newPhoneNumberCode:""})}).catch(e=>{if(this.setState({continueDisabled:!1}),"M_THREEPID_AUTH_FAILED"!==e.errcode){const t=On.getComponent("dialogs.ErrorDialog");console.error("Unable to verify phone number: "+e),qd.a.createTrackedDialog("Unable to verify phone number","",t,{title:Object(ts.a)("Unable to verify phone number."),description:e&&e.message?e.message:Object(ts.a)("Operation failed")})}else this.setState({verifyError:Object(ts.a)("Incorrect verification code")})})}),Fe()(this,"_onCountryChanged",e=>{this.setState({phoneCountry:e.iso2})}),this.state={verifying:!1,verifyError:!1,verifyMsisdn:"",addTask:null,continueDisabled:!1,phoneCountry:"",newPhoneNumber:"",newPhoneNumberCode:""}}render(){const e=this.props.msisdns.map(e=>i.a.createElement(kL,{msisdn:e,onRemoved:this._onRemoved,key:e.address}));let t=i.a.createElement(Fs.a,{onClick:this._onAddClick,kind:"primary"},Object(ts.a)("Add"));if(this.state.verifying){const e=this.state.verifyMsisdn;t=i.a.createElement("div",null,i.a.createElement("div",null,Object(ts.a)("A text message has been sent to +%(msisdn)s. Please enter the verification code it contains.",{msisdn:e}),i.a.createElement("br",null),this.state.verifyError),i.a.createElement("form",{onSubmit:this._onContinueClick,autoComplete:"off",noValidate:!0},i.a.createElement(rm.a,{type:"text",label:Object(ts.a)("Verification code"),autoComplete:"off",disabled:this.state.continueDisabled,value:this.state.newPhoneNumberCode,onChange:this._onChangeNewPhoneNumberCode}),i.a.createElement(Fs.a,{onClick:this._onContinueClick,kind:"primary",disabled:this.state.continueDisabled},Object(ts.a)("Continue"))))}const a=i.a.createElement(aC,{onOptionChange:this._onCountryChanged,className:"mx_PhoneNumbers_country",value:this.state.phoneCountry,disabled:this.state.verifying,isSmall:!0,showPrefix:!0});return i.a.createElement("div",{className:"mx_PhoneNumbers"},e,i.a.createElement("form",{onSubmit:this._onAddClick,autoComplete:"off",noValidate:!0,className:"mx_PhoneNumbers_new"},i.a.createElement("div",{className:"mx_PhoneNumbers_input"},i.a.createElement(rm.a,{type:"text",label:Object(ts.a)("Phone Number"),autoComplete:"off",disabled:this.state.verifying,prefixComponent:a,value:this.state.newPhoneNumber,onChange:this._onChangeNewPhoneNumber}))),t)}},Fe()(RL,"propTypes",{msisdns:At.a.array.isRequired,onMsisdnsChange:At.a.func.isRequired}),xL=RL))||xL;var TL,PL;class NL extends i.a.Component{constructor(e){super(e),Fe()(this,"onRevokeClick",e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!1,label:"revoke",errorTitle:Object(ts.a)("Unable to revoke sharing for email address")})}),Fe()(this,"onShareClick",e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!0,label:"share",errorTitle:Object(ts.a)("Unable to share email address")})}),Fe()(this,"onContinueClick",async e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0});try{await this.state.addTask.checkEmailLinkClicked(),this.setState({addTask:null,continueDisabled:!1,verifying:!1})}catch(e){this.setState({continueDisabled:!1});const t=On.getComponent("dialogs.ErrorDialog");"M_THREEPID_AUTH_FAILED"===e.errcode?qd.a.createTrackedDialog("E-mail hasn't been verified yet","",t,{title:Object(ts.a)("Your email address hasn't been verified yet"),description:Object(ts.a)("Click the link in the email you received to verify and then click continue again.")}):(console.error("Unable to verify email address: "+e),qd.a.createTrackedDialog("Unable to verify email address","",t,{title:Object(ts.a)("Unable to verify email address."),description:e&&e.message?e.message:Object(ts.a)("Operation failed")}))}});const{bound:t}=e.email;this.state={verifying:!1,addTask:null,continueDisabled:!1,bound:t}}UNSAFE_componentWillReceiveProps(e){const{bound:t}=e.email;this.setState({bound:t})}async changeBinding(e){let{bind:t,label:a,errorTitle:n}=e;if(!await Cs.a.get().doesServerSupportSeparateAddAndBind())return this.changeBindingTangledAddBind({bind:t,label:a,errorTitle:n});const s=On.getComponent("dialogs.ErrorDialog"),{medium:i,address:o}=this.props.email;try{if(t){const e=new wD;this.setState({verifying:!0,continueDisabled:!0,addTask:e}),await e.bindEmailAddress(o),this.setState({continueDisabled:!1})}else await Cs.a.get().unbindThreePid(i,o);this.setState({bound:t})}catch(e){console.error(`Unable to ${a} email address ${o} ${e}`),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),qd.a.createTrackedDialog(`Unable to ${a} email address`,"",s,{title:n,description:e&&e.message?e.message:Object(ts.a)("Operation failed")})}}async changeBindingTangledAddBind(e){let{bind:t,label:a,errorTitle:n}=e;const s=On.getComponent("dialogs.ErrorDialog"),{medium:i,address:o}=this.props.email,r=new wD;this.setState({verifying:!0,continueDisabled:!0,addTask:r});try{await Cs.a.get().deleteThreePid(i,o),t?await r.bindEmailAddress(o):await r.addEmailAddress(o),this.setState({continueDisabled:!1,bound:t})}catch(e){console.error(`Unable to ${a} email address ${o} ${e}`),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),qd.a.createTrackedDialog(`Unable to ${a} email address`,"",s,{title:n,description:e&&e.message?e.message:Object(ts.a)("Operation failed")})}}render(){const e=On.getComponent("elements.AccessibleButton"),{address:t}=this.props.email,{verifying:a,bound:n}=this.state;let s;return s=a?i.a.createElement("span",null,Object(ts.a)("Verify the link in your inbox"),i.a.createElement(e,{className:"mx_ExistingEmailAddress_confirmBtn",kind:"primary_sm",onClick:this.onContinueClick,disabled:this.state.continueDisabled},Object(ts.a)("Complete"))):n?i.a.createElement(e,{className:"mx_ExistingEmailAddress_confirmBtn",kind:"danger_sm",onClick:this.onRevokeClick},Object(ts.a)("Revoke")):i.a.createElement(e,{className:"mx_ExistingEmailAddress_confirmBtn",kind:"primary_sm",onClick:this.onShareClick},Object(ts.a)("Share")),i.a.createElement("div",{className:"mx_ExistingEmailAddress"},i.a.createElement("span",{className:"mx_ExistingEmailAddress_email"},t),s)}}Fe()(NL,"propTypes",{email:At.a.object.isRequired});let DL=Object(os.a)("views.settings.discovery.EmailAddresses")((PL=class extends i.a.Component{render(){let e;return e=this.props.emails.length>0?this.props.emails.map(e=>i.a.createElement(NL,{email:e,key:e.address})):i.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(ts.a)("Discovery options will appear once you have added an email above.")),i.a.createElement("div",{className:"mx_EmailAddresses"},e)}},Fe()(PL,"propTypes",{emails:At.a.array.isRequired}),TL=PL))||TL;var jL,AL;class ML extends i.a.Component{constructor(e){super(e),Fe()(this,"onRevokeClick",e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!1,label:"revoke",errorTitle:Object(ts.a)("Unable to revoke sharing for phone number")})}),Fe()(this,"onShareClick",e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!0,label:"share",errorTitle:Object(ts.a)("Unable to share phone number")})}),Fe()(this,"onVerificationCodeChange",e=>{this.setState({verificationCode:e.target.value})}),Fe()(this,"onContinueClick",async e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0});const t=this.state.verificationCode;try{await this.state.addTask.haveMsisdnToken(t),this.setState({addTask:null,continueDisabled:!1,verifying:!1,verifyError:null,verificationCode:""})}catch(e){if(this.setState({continueDisabled:!1}),"M_THREEPID_AUTH_FAILED"!==e.errcode){const t=On.getComponent("dialogs.ErrorDialog");console.error("Unable to verify phone number: "+e),qd.a.createTrackedDialog("Unable to verify phone number","",t,{title:Object(ts.a)("Unable to verify phone number."),description:e&&e.message?e.message:Object(ts.a)("Operation failed")})}else this.setState({verifyError:Object(ts.a)("Incorrect verification code")})}});const{bound:t}=e.msisdn;this.state={verifying:!1,verificationCode:"",addTask:null,continueDisabled:!1,bound:t}}UNSAFE_componentWillReceiveProps(e){const{bound:t}=e.msisdn;this.setState({bound:t})}async changeBinding(e){let{bind:t,label:a,errorTitle:n}=e;if(!await Cs.a.get().doesServerSupportSeparateAddAndBind())return this.changeBindingTangledAddBind({bind:t,label:a,errorTitle:n});const s=On.getComponent("dialogs.ErrorDialog"),{medium:i,address:o}=this.props.msisdn;try{if(t){const e=new wD;this.setState({verifying:!0,continueDisabled:!0,addTask:e}),await e.bindMsisdn(null,"+"+o),this.setState({continueDisabled:!1})}else await Cs.a.get().unbindThreePid(i,o);this.setState({bound:t})}catch(e){console.error(`Unable to ${a} phone number ${o} ${e}`),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),qd.a.createTrackedDialog(`Unable to ${a} phone number`,"",s,{title:n,description:e&&e.message?e.message:Object(ts.a)("Operation failed")})}}async changeBindingTangledAddBind(e){let{bind:t,label:a,errorTitle:n}=e;const s=On.getComponent("dialogs.ErrorDialog"),{medium:i,address:o}=this.props.msisdn,r=new wD;this.setState({verifying:!0,continueDisabled:!0,addTask:r});try{await Cs.a.get().deleteThreePid(i,o),t?await r.bindMsisdn(null,"+"+o):await r.addMsisdn(null,"+"+o),this.setState({continueDisabled:!1,bound:t})}catch(e){console.error(`Unable to ${a} phone number ${o} ${e}`),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),qd.a.createTrackedDialog(`Unable to ${a} phone number`,"",s,{title:n,description:e&&e.message?e.message:Object(ts.a)("Operation failed")})}}render(){const e=On.getComponent("elements.AccessibleButton"),t=On.getComponent("elements.Field"),{address:a}=this.props.msisdn,{verifying:n,bound:s}=this.state;let o;return o=n?i.a.createElement("span",{className:"mx_ExistingPhoneNumber_verification"},i.a.createElement("span",null,Object(ts.a)("Please enter verification code sent via text."),i.a.createElement("br",null),this.state.verifyError),i.a.createElement("form",{onSubmit:this.onContinueClick,autoComplete:"off",noValidate:!0},i.a.createElement(t,{type:"text",label:Object(ts.a)("Verification code"),autoComplete:"off",disabled:this.state.continueDisabled,value:this.state.verificationCode,onChange:this.onVerificationCodeChange}))):s?i.a.createElement(e,{className:"mx_ExistingPhoneNumber_confirmBtn",kind:"danger_sm",onClick:this.onRevokeClick},Object(ts.a)("Revoke")):i.a.createElement(e,{className:"mx_ExistingPhoneNumber_confirmBtn",kind:"primary_sm",onClick:this.onShareClick},Object(ts.a)("Share")),i.a.createElement("div",{className:"mx_ExistingPhoneNumber"},i.a.createElement("span",{className:"mx_ExistingPhoneNumber_address"},"+",a),o)}}Fe()(ML,"propTypes",{msisdn:At.a.object.isRequired});let UL=Object(os.a)("views.settings.discovery.PhoneNumbers")((AL=class extends i.a.Component{render(){let e;return e=this.props.msisdns.length>0?this.props.msisdns.map(e=>i.a.createElement(ML,{msisdn:e,key:e.address})):i.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(ts.a)("Discovery options will appear once you have added a phone number above.")),i.a.createElement("div",{className:"mx_PhoneNumbers"},e)}},Fe()(AL,"propTypes",{msisdns:At.a.array.isRequired}),jL=AL))||jL;var LL,FL,BL=a(1409),VL=a(1367),GL=a(1390),zL=a(1404),WL=a(1401),HL=a(1406);let KL=Object(os.a)("views.terms.InlineTermsAgreement")((FL=class extends i.a.Component{constructor(){super(),Fe()(this,"_togglePolicy",e=>{const t=Object(Us.a)(this.state.policies);t[e].checked=!t[e].checked,this.setState({policies:t})}),Fe()(this,"_onContinue",()=>{!!this.state.policies.some(e=>!e.checked)||(this.setState({busy:!0}),this.props.onFinished(this.state.policies.map(e=>e.url)))}),this.state={policies:[],busy:!1}}componentDidMount(){const e=[];for(const t of this.props.policiesAndServicePairs){const a=Object.values(t.policies);for(const t of a){const a=Object(ts.i)(Object.keys(t).filter(e=>"version"!==e)),n={checked:!1,url:t[a].url,name:t[a].name};e.push(n)}}this.setState({policies:e})}_renderCheckboxes(){const e=[];for(let t=0;t<this.state.policies.length;t++){const a=this.state.policies[t],n=Object(ts.a)("Accept <policyLink /> to continue:",{},{policyLink:()=>i.a.createElement("a",{href:a.url,rel:"noreferrer noopener",target:"_blank"},a.name,i.a.createElement("span",{className:"mx_InlineTermsAgreement_link"}))});e.push(i.a.createElement("div",{key:t,className:"mx_InlineTermsAgreement_cbContainer"},i.a.createElement("div",null,n),i.a.createElement("div",{className:"mx_InlineTermsAgreement_checkbox"},i.a.createElement(Hw.a,{onChange:()=>this._togglePolicy(t),checked:a.checked},Object(ts.a)("Accept")))))}return e}render(){const e=On.getComponent("views.elements.AccessibleButton"),t=!!this.state.policies.some(e=>!e.checked);return i.a.createElement("div",null,this.props.introElement,this._renderCheckboxes(),i.a.createElement(e,{onClick:this._onContinue,disabled:t||this.state.busy,kind:"primary_sm"},Object(ts.a)("Continue")))}},Fe()(FL,"propTypes",{policiesAndServicePairs:At.a.array.isRequired,agreedUrls:At.a.array.isRequired,onFinished:At.a.func.isRequired,introElement:At.a.node}),LL=FL))||LL;var qL,YL;let $L=Object(os.a)("views.verification.VerificationCancelled")((YL=class extends i.a.Component{render(){const e=On.getComponent("views.elements.DialogButtons");return i.a.createElement("div",null,i.a.createElement("p",null,Object(ts.a)("The other party cancelled the verification.")),i.a.createElement(e,{primaryButton:Object(ts.a)("OK"),hasCancel:!1,onPrimaryButtonClick:this.props.onDone}))}},Fe()(YL,"propTypes",{onDone:At.a.func.isRequired}),qL=YL))||qL;var JL,QL;let XL=Object(os.a)("views.verification.VerificationComplete")((QL=class extends i.a.Component{render(){const e=On.getComponent("views.elements.DialogButtons");return i.a.createElement("div",null,i.a.createElement("h2",null,Object(ts.a)("Verified!")),i.a.createElement("p",null,Object(ts.a)("You've successfully verified this user.")),i.a.createElement("p",null,Object(ts.a)("Secure messages with this user are end-to-end encrypted and not able to be read by third parties.")),i.a.createElement(e,{onPrimaryButtonClick:this.props.onDone,primaryButton:Object(ts.a)("Got It"),hasCancel:!1}))}},Fe()(QL,"propTypes",{onDone:At.a.func.isRequired}),JL=QL))||JL;var ZL,eF,tF=a(487);let aF=Object(os.a)("views.verification.VerificationQREmojiOptions")((eF=class extends i.a.Component{render(){const{request:e}=this.props;let t;return t=e.otherPartySupportsMethod(tF.c)?i.a.createElement(Mj.a,{qrCodeData:e.qrCodeData}):i.a.createElement("div",{className:"mx_VerificationQREmojiOptions_noQR"},i.a.createElement(Jc.a,null)),i.a.createElement("div",null,Object(ts.a)("Verify this session by completing one of the following:"),i.a.createElement("div",{className:"mx_IncomingSasDialog_startOptions"},i.a.createElement("div",{className:"mx_IncomingSasDialog_startOption"},i.a.createElement("p",null,Object(ts.a)("Scan this unique code")),t),i.a.createElement("div",{className:"mx_IncomingSasDialog_betweenText"},Object(ts.a)("or")),i.a.createElement("div",{className:"mx_IncomingSasDialog_startOption"},i.a.createElement("p",null,Object(ts.a)("Compare unique emoji")),i.a.createElement("span",{className:"mx_IncomingSasDialog_helpText"},Object(ts.a)("Compare a unique set of emoji if you don't have a camera on either device")),i.a.createElement(Fs.a,{onClick:this.props.onStartEmoji,kind:"primary"},Object(ts.a)("Start")))),i.a.createElement(Fs.a,{onClick:this.props.onCancel,kind:"danger"},Object(ts.a)("Cancel")))}},Fe()(eF,"propTypes",{request:At.a.object.isRequired,onCancel:At.a.func.isRequired,onStartEmoji:At.a.func.isRequired}),ZL=eF))||ZL;var nF,sF;let iF=Object(os.a)("views.verification.VerificationShowSas")((sF=class extends i.a.Component{constructor(e){super(e),Fe()(this,"onMatchClick",()=>{this.setState({pending:!0}),this.props.onDone()}),Fe()(this,"onDontMatchClick",()=>{this.setState({cancelling:!0}),this.props.onCancel()}),this.state={pending:!1}}componentWillMount(){vd()}render(){let e,t,a;if(this.props.sas.emoji){const a=this.props.sas.emoji.map((e,t)=>{return i.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas_block",key:t},i.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas_emoji"},e[0]),i.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas_label"},Object(ts.a)((a=e[1]).charAt(0).toUpperCase()+a.slice(1))));var a});e=i.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas"},a.slice(0,4),i.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas_break"}),a.slice(4)),t=this.props.isSelf?Object(ts.a)("Confirm the emoji below are displayed on both sessions, in the same order:"):Object(ts.a)("Verify this user by confirming the following emoji appear on their screen.")}else{if(!this.props.sas.decimal)return i.a.createElement("div",null,Object(ts.a)("Unable to find a supported verification method."),i.a.createElement(Fs.a,{kind:"primary",onClick:this.props.onCancel,className:"mx_UserInfo_wideButton"},Object(ts.a)("Cancel")));{const a=this.props.sas.decimal.map((e,t)=>i.a.createElement("span",{key:t},e));e=i.a.createElement("div",{className:"mx_VerificationShowSas_decimalSas"},a),t=this.props.isSelf?Object(ts.a)("Verify this session by confirming the following number appears on its screen."):Object(ts.a)("Verify this user by confirming the following number appears on their screen.")}}if(this.state.pending||this.state.cancelling){let e;if(this.state.pending)if(this.props.isSelf)e=this.props.device?Object(ts.a)("Waiting for your other session, %(deviceName)s (%(deviceId)s), to verify…",{deviceName:this.props.device?this.props.device.getDisplayName():"",deviceId:this.props.device?this.props.device.deviceId:""}):Object(ts.a)("Waiting for your other session to verify…");else{const{displayName:t}=this.props;e=Object(ts.a)("Waiting for %(displayName)s to verify…",{displayName:t})}else e=Object(ts.a)("Cancelling…");a=i.a.createElement(ax.a,{text:e})}else a=this.props.inDialog?i.a.createElement(WC.a,{primaryButton:Object(ts.a)("They match"),onPrimaryButtonClick:this.onMatchClick,primaryButtonClass:"mx_UserInfo_wideButton mx_VerificationShowSas_matchButton",cancelButton:Object(ts.a)("They don't match"),onCancel:this.onDontMatchClick,cancelButtonClass:"mx_UserInfo_wideButton mx_VerificationShowSas_noMatchButton"}):i.a.createElement(i.a.Fragment,null,i.a.createElement(Fs.a,{onClick:this.onDontMatchClick,kind:"danger"},Object(ts.a)("They don't match")),i.a.createElement(Fs.a,{onClick:this.onMatchClick,kind:"primary"},Object(ts.a)("They match")));return i.a.createElement("div",{className:"mx_VerificationShowSas"},i.a.createElement("p",null,t),e,i.a.createElement("p",null,this.props.isSelf?"":Object(ts.a)("To be secure, do this in person or use a trusted way to communicate.")),a)}},Fe()(sF,"propTypes",{pending:At.a.bool,displayName:At.a.string,device:At.a.object,onDone:At.a.func.isRequired,onCancel:At.a.func.isRequired,sas:At.a.object.isRequired,isSelf:At.a.bool,inDialog:At.a.bool}),nF=sF))||nF;Object(ts.b)("Dog"),Object(ts.b)("Cat"),Object(ts.b)("Lion"),Object(ts.b)("Horse"),Object(ts.b)("Unicorn"),Object(ts.b)("Pig"),Object(ts.b)("Elephant"),Object(ts.b)("Rabbit"),Object(ts.b)("Panda"),Object(ts.b)("Rooster"),Object(ts.b)("Penguin"),Object(ts.b)("Turtle"),Object(ts.b)("Fish"),Object(ts.b)("Octopus"),Object(ts.b)("Butterfly"),Object(ts.b)("Flower"),Object(ts.b)("Tree"),Object(ts.b)("Cactus"),Object(ts.b)("Mushroom"),Object(ts.b)("Globe"),Object(ts.b)("Moon"),Object(ts.b)("Cloud"),Object(ts.b)("Fire"),Object(ts.b)("Banana"),Object(ts.b)("Apple"),Object(ts.b)("Strawberry"),Object(ts.b)("Corn"),Object(ts.b)("Pizza"),Object(ts.b)("Cake"),Object(ts.b)("Heart"),Object(ts.b)("Smiley"),Object(ts.b)("Robot"),Object(ts.b)("Hat"),Object(ts.b)("Glasses"),Object(ts.b)("Spanner"),Object(ts.b)("Santa"),Object(ts.b)("Thumbs up"),Object(ts.b)("Umbrella"),Object(ts.b)("Hourglass"),Object(ts.b)("Clock"),Object(ts.b)("Gift"),Object(ts.b)("Light bulb"),Object(ts.b)("Book"),Object(ts.b)("Pencil"),Object(ts.b)("Paperclip"),Object(ts.b)("Scissors"),Object(ts.b)("Lock"),Object(ts.b)("Key"),Object(ts.b)("Hammer"),Object(ts.b)("Telephone"),Object(ts.b)("Flag"),Object(ts.b)("Train"),Object(ts.b)("Bicycle"),Object(ts.b)("Aeroplane"),Object(ts.b)("Rocket"),Object(ts.b)("Trophy"),Object(ts.b)("Ball"),Object(ts.b)("Guitar"),Object(ts.b)("Trumpet"),Object(ts.b)("Bell"),Object(ts.b)("Anchor"),Object(ts.b)("Headphones"),Object(ts.b)("Folder"),Object(ts.b)("Pin");let oF={};o&&(oF["Common.BaseTextField"]=o),l&&(oF["Common.ConfirmationDialog"]=l),d&&(oF["Common.ConsentForm"]=d),w&&(oF["Common.Form.AddressSelect"]=w),g&&(oF["Common.Form.NiceAutocomplete"]=g),R&&(oF["Common.Form.NiceCheckbox"]=R),P&&(oF["Common.Form.NiceDatePicker"]=P),U&&(oF["Common.Form.NiceDoctorNote"]=U),V&&(oF["Common.Form.NicePractitionerSelect"]=V),z&&(oF["Common.Form.NiceSelect"]=z),S&&(oF["Common.Form.NiceTextField"]=S),W&&(oF["Common.Form.ObjectListDatePicker"]=W),H&&(oF["Common.Form.ObjectListDatePickerV2"]=H),K&&(oF["Common.Form.ObjectListTextField"]=K),q&&(oF["Common.Form.SyncAddress"]=q),$&&(oF["Common.FormFormik.FormikAutocomplete"]=$),J&&(oF["Common.FormFormik.FormikCheckbox"]=J),Q&&(oF["Common.FormFormik.FormikDatePicker"]=Q),X&&(oF["Common.FormFormik.FormikSelect"]=X),Z&&(oF["Common.FormFormik.FormikTextField"]=Z),ie&&(oF["Common.FormatField.NumberFormatField"]=ie),oe&&(oF["Common.FormatField.SelectField"]=oe),ce&&(oF["Common.FormikSelectAdministrativeUnit.SelectAdministrativeUnit"]=ce),de&&(oF["Common.FormikSelectAdministrativeUnit.SyncAdministrativeUnit"]=de),ue&&(oF["Common.MessageBox"]=ue),pe&&(oF["Common.NiceFilter.NiceFilter"]=pe),_e&&(oF["Common.NiceLoadingButton.NiceLoadingButton"]=_e),xe&&(oF["Common.Pagination.NicePagination"]=xe),Pe&&(oF["Common.PatientFile"]=Pe),Ue&&(oF["Common.Popup.BasePopup"]=Ue),wt&&(oF["Common.Popup.LabTestResultPopup.Form"]=wt),It&&(oF["Common.Popup.LabTestResultPopup.Popup"]=It),lt&&(oF["Common.Popup.LabTestResultPopup.SyncLabTestResultPopup.DescriptionView"]=lt),Je&&(oF["Common.Popup.LabTestResultPopup.SyncLabTestResultPopup.SyncLabTestForm"]=Je),Pt&&(oF["Common.Popup.Prompt.PromptDialog"]=Pt),Nt&&(oF["Common.PrescriptionForm"]=Nt),yt&&(oF["Common.PreviewImage"]=yt),Dt&&(oF["Common.ResultRiskAssesment"]=Dt),Ft&&(oF["Common.RichTextEditor"]=Ft),Gt&&(oF["Common.Search.Search"]=Gt),Kt&&(oF["Common.SelectAdministrativeUnit.InputPopup"]=Kt),Ht&&(oF["Common.SelectAdministrativeUnit.SelectAdministrativeUnitPopup"]=Ht),Yt.a&&(oF["Common.SelectButton.SelectBioProduct.Form"]=Yt.a),sa&&(oF["Common.SelectButton.SelectBioProduct.InputPopup"]=sa),aa&&(oF["Common.SelectButton.SelectBioProduct.SelectBioProduct"]=aa),ca&&(oF["Common.SelectDrugs.InputPopup"]=ca),ua&&(oF["Common.SelectDrugs.SelectDrugPopup"]=ua),la&&(oF["Common.SelectDrugs.SelectDrugsPopup"]=la),va&&(oF["Common.SelectEncounter.InputPopup"]=va),fa&&(oF["Common.SelectEncounter.SelectEncounterPopup"]=fa),Ca&&(oF["Common.SelectHealthOrganization.InputPopup"]=Ca),Sa&&(oF["Common.SelectHealthOrganization.SelectHealthOrganizationPopup"]=Sa),ka&&(oF["Common.SelectLabTestTemplate.FormikSelectLabTestTemplate"]=ka),Ia&&(oF["Common.SelectLabTestTemplate.InputPopup"]=Ia),Ra&&(oF["Common.SelectLabTestTemplate.SelectLabTestTemplatePopup"]=Ra),Ma&&(oF["Common.SelectPatient.InputPopup"]=Ma),Aa&&(oF["Common.SelectPatient.SelectPatient"]=Aa),Va&&(oF["Common.SelectPractitioner.InputPopup"]=Va),Ba&&(oF["Common.SelectPractitioner.SelectPractitionerPopup"]=Ba),qa&&(oF["Common.SelectRegimen.SelectRegimenPopup"]=qa),Qa&&(oF["Common.SelectTreatmentPeriod.InputPopup"]=Qa),Ja&&(oF["Common.SelectTreatmentPeriod.SelectTreatmentPeriodPopup"]=Ja),gt&&(oF["Common.Tooltip.NiceTooltip"]=gt),mt&&(oF["Common.WaitingLabTestForm"]=mt),an&&(oF["structures.AdministrativeUnit.EditDialog"]=an),Za&&(oF["structures.AdministrativeUnit.Form"]=Za),pn&&(oF["structures.AdministrativeUnit.Index"]=pn),hn&&(oF["structures.AdministrativeUnit.List"]=hn),$n&&(oF["structures.Appointment.Index"]=$n),qn&&(oF["structures.Appointment.List"]=qn),Jn.a&&(oF["structures.AutoHideScrollbar"]=Jn.a),wn&&(oF["structures.BookingPopup.BookingDialog"]=wn),yn&&(oF["structures.BookingPopup.BookingForm"]=yn),Fn&&(oF["structures.BookingPopup.Form"]=Fn),zn&&(oF["structures.BookingPopup.Popup"]=zn),Bi&&(oF["structures.ChatPannel.ChatPanel"]=Bi),Vi.a&&(oF["structures.ChatPannel.MessageComposer"]=Vi.a),Gi.a&&(oF["structures.ChatPannel.RoomHeader"]=Gi.a),zi.a&&(oF["structures.ChatPannel.RoomView"]=zi.a),Wi&&(oF["structures.ClinicInformation.ClinicInformation"]=Wi),qi&&(oF["structures.ClinicInformation.Dialog"]=qi),eo&&(oF["structures.ClinicInformation.ListClinicInformation"]=eo),lo&&(oF["structures.ConfirmLabTestOrder.Dialog"]=lo),io&&(oF["structures.ConfirmLabTestOrder.Form"]=io),Xo&&(oF["structures.ConfirmLabTestOrder.Index"]=Xo),Qo&&(oF["structures.ConfirmLabTestOrder.List"]=Qo),gr&&(oF["structures.ConfirmPayment.Dialog"]=gr),ur&&(oF["structures.ConfirmPayment.Form"]=ur),Mr&&(oF["structures.ConfirmPayment.Index"]=Mr),Tr&&(oF["structures.ConfirmPayment.List"]=Tr),Ar&&(oF["structures.ConfirmPayment.Tab"]=Ar),Gr&&(oF["structures.ConfirmScreening.Dialog"]=Gr),Fr&&(oF["structures.ConfirmScreening.Form"]=Fr),Hr&&(oF["structures.ConfirmScreening.Index"]=Hr),Wr&&(oF["structures.ConfirmScreening.List"]=Wr),Kr.o&&(oF["structures.ContextMenu"]=Kr.o),el&&(oF["structures.Customer.Dialog"]=el),Jr&&(oF["structures.Customer.Form"]=Jr),al&&(oF["structures.Customer.List"]=al),il&&(oF["structures.CustomerSupport.ChatDialog"]=il),ul&&(oF["structures.CustomerSupport.Index"]=ul),ml&&(oF["structures.CustomerSupport.List"]=ml),jl&&(oF["structures.Dashboard.Index"]=jl),Yo&&(oF["structures.Dashboard.SearchResultsDialog"]=Yo),Dl&&(oF["structures.Dashboard.Tab"]=Dl),Ml&&(oF["structures.Dashboard.Tabs.CompleteExamination"]=Ml),vl&&(oF["structures.Dashboard.Tabs.NotRegisteredTreatment"]=vl),Ll&&(oF["structures.Dashboard.Tabs.WaitingAppointment"]=Ll),wl&&(oF["structures.Dashboard.Tabs.WaitingExamination"]=wl),kl&&(oF["structures.Dashboard.Tabs.WaitingLabTestResult"]=kl),Yl&&(oF["structures.DispensateRating.List"]=Yl),Wl&&(oF["structures.DispensateRating.ServiceRatingRadioGroup"]=Wl),Kl&&(oF["structures.DispensateRating.ViewDialog"]=Kl),Zl&&(oF["structures.Drug.EditDialog"]=Zl),Jl&&(oF["structures.Drug.Form"]=Jl),tc&&(oF["structures.Drug.Index"]=tc),ec&&(oF["structures.Drug.List"]=ec),dc&&(oF["structures.DrugExportManagement.EditDialog"]=dc),fc&&(oF["structures.DrugExportManagement.Index"]=fc),rc&&(oF["structures.DrugExportManagement.ItemList"]=rc),gc&&(oF["structures.DrugExportManagement.ListDrugExportManagement"]=gc),vc&&(oF["structures.DrugExportManagement.QuantityField"]=vc),Sc&&(oF["structures.DrugManagement.Dialog"]=Sc),yc&&(oF["structures.DrugManagement.DrugManagementForm"]=yc),Oc&&(oF["structures.DrugManagement.Index"]=Oc),wc&&(oF["structures.DrugManagement.ListDrugManagement"]=wc),bc&&(oF["structures.DrugManagement.QuantityField"]=bc),Tc&&(oF["structures.Encounter.EditDialog"]=Tc),Rc&&(oF["structures.Encounter.Form"]=Rc),Nc&&(oF["structures.Encounter.Index"]=Nc),Pc&&(oF["structures.Encounter.List"]=Pc),Lc&&(oF["structures.EncounterSlot.Dialog"]=Lc),Ac&&(oF["structures.EncounterSlot.Form"]=Ac),Bc&&(oF["structures.EncounterSlot.Index"]=Bc),Fc&&(oF["structures.EncounterSlot.List"]=Fc),Hc&&(oF["structures.Ethnicity.EditDialog"]=Hc),Gc&&(oF["structures.Ethnicity.Form"]=Gc),qc&&(oF["structures.Ethnicity.Index"]=qc),Kc&&(oF["structures.Ethnicity.List"]=Kc),md&&(oF["structures.GlobitsHomePage"]=md),ud&&(oF["structures.GlobitsLeftPanel"]=ud),Vy&&(oF["structures.GlobitsLoggedInView"]=Vy),_E&&(oF["structures.GlobitsMatrixChat"]=_E),SE.a&&(oF["structures.GlobitsRoomView"]=SE.a),Qh&&(oF["structures.HealthOrganization.EditDialog"]=Qh),qh&&(oF["structures.HealthOrganization.Form"]=qh),tp&&(oF["structures.HealthOrganization.Index"]=tp),ep&&(oF["structures.HealthOrganization.List"]=ep),IE&&(oF["structures.HomePage"]=IE),bu&&(oF["structures.HostSignupAction"]=bu),sh&&(oF["structures.LabTest.Dialog"]=sh),th&&(oF["structures.LabTest.Form"]=th),oh&&(oF["structures.LabTest.Index"]=oh),ih&&(oF["structures.LabTest.List"]=ih),Sf&&(oF["structures.LabTestOrder.Index"]=Sf),_f&&(oF["structures.LabTestOrder.List"]=_f),Rh&&(oF["structures.LabTestTemplate.Dialog"]=Rh),wh&&(oF["structures.LabTestTemplate.Form"]=wh),Ih&&(oF["structures.LabTestTemplate.Index"]=Ih),kh&&(oF["structures.LabTestTemplate.List"]=kh),DE&&(oF["structures.LeftPanel"]=DE),Ui&&(oF["structures.LeftPanelWidget"]=Ui),UE&&(oF["structures.ListPage"]=UE),ov&&(oF["structures.ListResultWaiting.Index"]=ov),iv&&(oF["structures.ListResultWaiting.List"]=iv),WE&&(oF["structures.LoggedInView"]=WE),HE.a&&(oF["structures.MatrixChat"]=HE.a),yf&&(oF["structures.MedicalExamination.Create"]=yf),_g&&(oF["structures.MedicalExamination.DialogStopTreatmentPeriod"]=_g),pf&&(oF["structures.MedicalExamination.Form"]=pf),KE&&(oF["structures.MedicalExamination.Index"]=KE),mf&&(oF["structures.MedicalExamination.Tab"]=mf),Ug&&(oF["structures.MedicalExamination.Tabs.Body"]=Ug),qE&&(oF["structures.MedicalExamination.Tabs.ConsentForm"]=qE),YE&&(oF["structures.MedicalExamination.Tabs.Diagnose"]=YE),$E&&(oF["structures.MedicalExamination.Tabs.MedicalHistory"]=$E),Wg&&(oF["structures.MedicalExamination.Tabs.PrescriptionTab.NumberPerDayField"]=Wg),Yg&&(oF["structures.MedicalExamination.Tabs.PrescriptionTab.NumberPerDayFieldPrep"]=Yg),Xg&&(oF["structures.MedicalExamination.Tabs.PrescriptionTab.PrepTab"]=Xg),Fg&&(oF["structures.MedicalExamination.Tabs.PrescriptionTab.SelectNextLabTestOrderDialog"]=Fg),zg&&(oF["structures.MedicalExamination.Tabs.Subclinical"]=zg),ag&&(oF["structures.MyInfo.ChatDialog"]=ag),Zp&&(oF["structures.MyInfo.EditDialog"]=Zp),$p&&(oF["structures.MyInfo.Form"]=$p),og&&(oF["structures.MyInfo.Index"]=og),ZE&&(oF["structures.MyInfo.List"]=ZE),sg&&(oF["structures.MyInfo.ListUser"]=sg),kn&&(oF["structures.MyPatient.ChatDialog"]=kn),zp&&(oF["structures.MyPatient.EditDialog"]=zp),Fp&&(oF["structures.MyPatient.Form"]=Fp),Kp&&(oF["structures.MyPatient.Index"]=Kp),Hp&&(oF["structures.MyPatient.List"]=Hp),by&&(oF["structures.Navigation.HorizontalNavBar"]=by),p_&&(oF["structures.Navigation.Item"]=p_),E_&&(oF["structures.Navigation.LeftSideBar"]=E_),Wm&&(oF["structures.Navigation.MenuItems"]=Wm),_u&&(oF["structures.Navigation.NavUser"]=_u),ku&&(oF["structures.Navigation.NavUserHorizontal"]=ku),cy&&(oF["structures.Navigation.RootSwitcher"]=cy),Vm&&(oF["structures.Navigation.Submenu"]=Vm),BE&&(oF["structures.NonUrgentToastContainer"]=BE),py&&(oF["structures.Notification.NotificationBar"]=py),Tb&&(oF["structures.NotificationManager.Dialog"]=Tb),Rb&&(oF["structures.NotificationManager.Form"]=Rb),Nb&&(oF["structures.NotificationManager.Index"]=Nb),Pb&&(oF["structures.NotificationManager.List"]=Pb),__.a&&(oF["structures.NotificationPanel"]=__.a),R_&&(oF["structures.Observation.EditDialog"]=R_),w_&&(oF["structures.Observation.Form"]=w_),I_&&(oF["structures.Observation.Index"]=I_),k_&&(oF["structures.Observation.List"]=k_),Cp&&(oF["structures.Occupation.EditDialog"]=Cp),Ep&&(oF["structures.Occupation.Form"]=Ep),Op&&(oF["structures.Occupation.Index"]=Op),wp&&(oF["structures.Occupation.List"]=wp),Lu&&(oF["structures.Patient.ChatDialog"]=Lu),vp&&(oF["structures.Patient.CreatePatient"]=vp),hp&&(oF["structures.Patient.CreatePatientForm"]=hp),bp&&(oF["structures.Patient.CreatePatientIndex"]=bp),Au&&(oF["structures.Patient.EditDialog"]=Au),Nu&&(oF["structures.Patient.Form"]=Nu),zu&&(oF["structures.Patient.Index"]=zu),Gu&&(oF["structures.Patient.List"]=Gu),j_&&(oF["structures.Patient.ListPatientComponent"]=j_),Ig&&(oF["structures.Patient.MedicalRecord"]=Ig),Og&&(oF["structures.Patient.MedicalRecordForm"]=Og),A_&&(oF["structures.Patient.MedicalRecordIndex"]=A_),fg&&(oF["structures.Patient.MedicalRecordTab"]=fg),U_.a&&(oF["structures.Patient.MedicalRecordTabs.Chart"]=U_.a),ug&&(oF["structures.Patient.MedicalRecordTabs.Details"]=ug),F_&&(oF["structures.Patient.MedicalRecordTabs.PatientSummary"]=F_),Po&&(oF["structures.PatientBasicInfo.EditDialog"]=Po),B_&&(oF["structures.PatientBasicInfo.EditForm"]=B_),Pg&&(oF["structures.PatientMedicalRecord.ScreeningForm"]=Pg),Mg&&(oF["structures.PatientMedicalRecord.Tabs"]=Mg),wv&&(oF["structures.Policies.EditorDialog"]=wv),Ev&&(oF["structures.Policies.EditorForm"]=Ev),Pv&&(oF["structures.Policies.List"]=Pv),yv&&(oF["structures.Policies.RichText"]=yv),Iv&&(oF["structures.Policies.ViewDialog"]=Iv),Qu&&(oF["structures.Practitioner.ChatDialog"]=Qu),Yu&&(oF["structures.Practitioner.EditDialog"]=Yu),Hu&&(oF["structures.Practitioner.Form"]=Hu),Zu&&(oF["structures.Practitioner.Index"]=Zu),W_&&(oF["structures.Practitioner.InputPopup.InputPopup"]=W_),z_&&(oF["structures.Practitioner.InputPopup.SelectPopup"]=z_),Xu&&(oF["structures.Practitioner.List"]=Xu),uv&&(oF["structures.PractitionerSchedule.Dialog"]=uv),fv&&(oF["structures.PractitionerSchedule.Schedule"]=fv),kf&&(oF["structures.Prescription.EditDialog"]=kf),Nf&&(oF["structures.Prescription.Index"]=Nf),wf&&(oF["structures.Prescription.ItemList"]=wf),Pf&&(oF["structures.Prescription.List"]=Pf),If&&(oF["structures.Prescription.SelectStatus"]=If),jh&&(oF["structures.Regiment.EditDialog"]=jh),Ph&&(oF["structures.Regiment.Form"]=Ph),Mh&&(oF["structures.Regiment.Index"]=Mh),Ah&&(oF["structures.Regiment.List"]=Ah),ub&&(oF["structures.Report.ByAppointment.List"]=ub),_b&&(oF["structures.Report.ByAppointment.Tabs"]=_b),tb&&(oF["structures.Report.ByBeingTreatedCustomer.List"]=tb),db&&(oF["structures.Report.ByBeingTreatedCustomer.Tabs"]=db),Mf&&(oF["structures.Report.ByFirstTimeCustomer.List"]=Mf),Hf&&(oF["structures.Report.ByFirstTimeCustomer.Tabs"]=Hf),Gb&&(oF["structures.Report.ByProgramActivity.List"]=Gb),Qb&&(oF["structures.Report.ByProgramActivity.Tabs"]=Qb),Zb&&(oF["structures.Report.ByQualVaac.List"]=Zb),ly&&(oF["structures.Report.ByQualVaac.Tabs"]=ly),Dv&&(oF["structures.Report.ByServiceRating.List"]=Dv),Gv&&(oF["structures.Report.ByServiceRating.Tabs"]=Gv),Wv&&(oF["structures.Report.ByTreatmentStoppedCustomer.List"]=Wv),Zv&&(oF["structures.Report.ByTreatmentStoppedCustomer.Tabs"]=Zv),K_&&(oF["structures.Report.ReportChart"]=K_),qf&&(oF["structures.Report.ReportScreeningResults.List"]=qf),av&&(oF["structures.Report.ReportScreeningResults.Tabs"]=av),q_.a&&(oF["structures.RightPanel"]=q_.a),Co&&(oF["structures.RiskAssessment.Form"]=Co),Ro&&(oF["structures.RiskAssessment.Popup"]=Ro),vo&&(oF["structures.RiskAssessment.PrintRiskAssessment"]=vo),$_&&(oF["structures.RiskAssessment.Question"]=$_),Q_&&(oF["structures.RiskAssessment.RiskAssessmentCheckboxGroup"]=Q_),bo&&(oF["structures.RiskAssessment.RiskAssessmentRadioGroup"]=bo),X_&&(oF["structures.RiskAssessment.SourceRadioGroup"]=X_),ch&&(oF["structures.Role.Index"]=ch),lh&&(oF["structures.Role.List"]=lh),vS&&(oF["structures.RoomDirectory"]=vS),li.a&&(oF["structures.RoomSearch"]=li.a),yS.a&&(oF["structures.RoomView"]=yS.a),CS&&(oF["structures.ScreeningQuestion.Dialog"]=CS),ES&&(oF["structures.ScreeningQuestion.Form"]=ES),OS&&(oF["structures.ScreeningQuestion.Index"]=OS),wS&&(oF["structures.ScreeningQuestion.List"]=wS),Ao&&(oF["structures.SelectTest.Form"]=Ao),Go&&(oF["structures.SelectTest.Popup"]=Go),RS&&(oF["structures.SelectTest.ServiceFeePopup"]=RS),Dp&&(oF["structures.SendMail.EditDialog"]=Dp),Tp&&(oF["structures.SendMail.Form"]=Tp),Mp&&(oF["structures.SendMail.Index"]=Mp),Ap&&(oF["structures.SendMail.List"]=Ap),IS.b&&(oF["structures.SpaceRoomDirectory"]=IS.b),cm.b&&(oF["structures.SpaceRoomView"]=cm.b),Lb&&(oF["structures.SupporterManagement.Dialog"]=Lb),Ab&&(oF["structures.SupporterManagement.Form"]=Ab),Bb&&(oF["structures.SupporterManagement.List"]=Bb),TS.b&&(oF["structures.TabbedView"]=TS.b),PS&&(oF["structures.ToastContainer"]=PS),MS&&(oF["structures.TreatmentPeriod.EditDialog"]=MS),DS&&(oF["structures.TreatmentPeriod.Form"]=DS),FS&&(oF["structures.TreatmentPeriod.Index"]=FS),US&&(oF["structures.TreatmentPeriod.List"]=US),WS&&(oF["structures.UploadBar"]=WS),hh&&(oF["structures.User.ChangePassWordAccordion"]=hh),yh&&(oF["structures.User.EditDialog"]=yh),_h&&(oF["structures.User.Index"]=_h),Eh&&(oF["structures.User.List"]=Eh),gh&&(oF["structures.User.UserForm"]=gh),TE&&(oF["structures.UserMenu"]=TE),zh&&(oF["structures.ValueCode.Dialog"]=zh),Fh&&(oF["structures.ValueCode.Form"]=Fh),Hh&&(oF["structures.ValueCode.Index"]=Hh),Wh&&(oF["structures.ValueCode.List"]=Wh),wC&&(oF["structures.auth.Login"]=wC),RC&&(oF["structures.auth.Registration"]=RC),MC&&(oF["structures.auth.SoftLogout"]=MC),VC&&(oF["views.auth.GlobitsRegistrationForm"]=VC),GC.d&&(oF["views.auth.InteractiveAuthEntryComponents"]=GC.d),zC.a&&(oF["views.auth.PassphraseField"]=zC.a),cC&&(oF["views.auth.PasswordLogin"]=cC),BC&&(oF["views.auth.RegisterDialog"]=BC),JC&&(oF["views.auth.RegistrationForm"]=JC),ws.a&&(oF["views.avatars.BaseAvatar"]=ws.a),hi.a&&(oF["views.avatars.DecoratedRoomAvatar"]=hi.a),Is&&(oF["views.avatars.GroupAvatar"]=Is),XC.a&&(oF["views.avatars.MemberAvatar"]=XC.a),Ws.a&&(oF["views.avatars.RoomAvatar"]=Ws.a),ZC.a&&(oF["views.avatars.WidgetAvatar"]=ZC.a),im.b&&(oF["views.beta.BetaCard"]=im.b),ew.a&&(oF["views.context_menus.CallContextMenu"]=ew.a),tw.a&&(oF["views.context_menus.DialpadContextMenu"]=tw.a),Ls.e&&(oF["views.context_menus.IconizedContextMenu"]=Ls.e),aw.a&&(oF["views.context_menus.WidgetContextMenu"]=aw.a),nw.b&&(oF["views.dialogs.AddExistingToSpaceDialog"]=nw.b),sw.a&&(oF["views.dialogs.BetaFeedbackDialog"]=sw.a),iw.a&&(oF["views.dialogs.CommunityPrototypeInviteDialog"]=iw.a),mE.a&&(oF["views.dialogs.CreateCommunityPrototypeDialog"]=mE.a),ow.a&&(oF["views.dialogs.CreateRoomDialog"]=ow.a),rw.b&&(oF["views.dialogs.DevtoolsDialog"]=rw.b),gu&&(oF["views.dialogs.EditCommunityPrototypeDialog"]=gu),Zd&&(oF["views.dialogs.HostSignupDialog"]=Zd),lw.d&&(oF["views.dialogs.InviteDialog"]=lw.d),cw.a&&(oF["views.dialogs.ModalWidgetDialog"]=cw.a),$C&&(oF["views.dialogs.RegistrationEmailPromptDialog"]=$C),dw.a&&(oF["views.dialogs.ServerOfflineDialog"]=dw.a),bC&&(oF["views.dialogs.ServerPickerDialog"]=bC),mw&&(oF["views.dialogs.SeshatResetDialog"]=mw),uw.a&&(oF["views.dialogs.ShareDialog"]=uw.a),hw.a&&(oF["views.dialogs.SpaceSettingsDialog"]=hw.a),pw.a&&(oF["views.dialogs.UntrustedDeviceDialog"]=pw.a),yw&&(oF["views.dialogs.UploadConfirmDialog"]=yw),_w.a&&(oF["views.dialogs.WidgetCapabilitiesPromptDialog"]=_w.a),Sw.a&&(oF["views.dialogs.security.AccessSecretStorageDialog"]=Sw.a),cS&&(oF["views.directory.NetworkDropdown"]=cS),Fs.a&&(oF["views.elements.AccessibleButton"]=Fs.a),is.a&&(oF["views.elements.AccessibleTooltipButton"]=is.a),Cw.b&&(oF["views.elements.DesktopBuildsNotice"]=Cw.b),ww.a&&(oF["views.elements.DesktopCapturerSourcePicker"]=ww.a),Ow&&(oF["views.elements.Draggable"]=Ow),xw.a&&(oF["views.elements.EffectsOverlay"]=xw.a),Iw&&(oF["views.elements.EventListSummary"]=Iw),Tw.a&&(oF["views.elements.EventTilePreview"]=Tw.a),Pw.a&&(oF["views.elements.FacePile"]=Pw.a),rm.a&&(oF["views.elements.Field"]=rm.a),Nw&&(oF["views.elements.IRCTimelineProfileResizer"]=Nw),Mw.a&&(oF["views.elements.ImageView"]=Mw.a),Uw.a&&(oF["views.elements.InfoTooltip"]=Uw.a),Cu.a&&(oF["views.elements.InlineSpinner"]=Cu.a),Lw.a&&(oF["views.elements.InviteReason"]=Lw.a),Fw&&(oF["views.elements.MemberEventListSummary"]=Fw),ad&&(oF["views.elements.MiniAvatarUploader"]=ad),zS.a&&(oF["views.elements.ProgressBar"]=zS.a),Bw.a&&(oF["views.elements.QRCode"]=Bw.a),Eu.a&&(oF["views.elements.RoomName"]=Eu.a),Vw.a&&(oF["views.elements.RoomTopic"]=Vw.a),pC&&(oF["views.elements.SSOButtons"]=pC),_C&&(oF["views.elements.ServerPicker"]=_C),Gw.a&&(oF["views.elements.SettingsFlag"]=Gw.a),zw.a&&(oF["views.elements.Slider"]=zw.a),Ww.a&&(oF["views.elements.SpellCheckLanguagesDropdown"]=Ww.a),Hw.a&&(oF["views.elements.StyledCheckbox"]=Hw.a),vC.a&&(oF["views.elements.StyledRadioButton"]=vC.a),su.a&&(oF["views.elements.StyledRadioGroup"]=su.a),Kw.a&&(oF["views.elements.ToggleSwitch"]=Kw.a),qw.b&&(oF["views.elements.Tooltip"]=qw.b),wu&&(oF["views.elements.TooltipButton"]=wu),rs&&(oF["views.elements.UserTagTile"]=rs),lm.a&&(oF["views.elements.Validation"]=lm.a),fO&&(oF["views.emojipicker.Category"]=fO),iO&&(oF["views.emojipicker.Emoji"]=iO),mO&&(oF["views.emojipicker.EmojiPicker"]=mO),Zw&&(oF["views.emojipicker.Header"]=Zw),nO&&(oF["views.emojipicker.Preview"]=nO),lO&&(oF["views.emojipicker.QuickReactions"]=lO),vO&&(oF["views.emojipicker.ReactionPicker"]=vO),tO&&(oF["views.emojipicker.Search"]=tO),em&&(oF["views.host_signup.HostSignupContainer"]=em),EO&&(oF["views.messages.EncryptionEvent"]=EO),bO&&(oF["views.messages.EventTileBubble"]=bO),CO&&(oF["views.messages.MJitsiWidgetEvent"]=CO),DO&&(oF["views.messages.MVideoBody"]=DO),UO&&(oF["views.messages.MVoiceMessageBody"]=UO),VO&&(oF["views.messages.MVoiceOrAudioBody"]=VO),XO&&(oF["views.messages.ReactionsRow"]=XO),YO&&(oF["views.messages.ReactionsRowButton"]=YO),HO&&(oF["views.messages.ReactionsRowButtonTooltip"]=HO),ex.a&&(oF["views.messages.RedactedBody"]=ex.a),tx.b&&(oF["views.right_panel.BaseCard"]=tx.b),ax.b&&(oF["views.right_panel.EncryptionInfo"]=ax.b),nx.a&&(oF["views.right_panel.EncryptionPanel"]=nx.a),lx&&(oF["views.right_panel.GroupHeaderButtons"]=lx),sx.a&&(oF["views.right_panel.HeaderButton"]=sx.a),ix.b&&(oF["views.right_panel.HeaderButtons"]=ix.b),cx.b&&(oF["views.right_panel.PinnedMessagesCard"]=cx.b),dx.a&&(oF["views.right_panel.RoomHeaderButtons"]=dx.a),mx.a&&(oF["views.right_panel.RoomSummaryCard"]=mx.a),ux.a&&(oF["views.right_panel.UserInfo"]=ux.a),hx.a&&(oF["views.right_panel.VerificationPanel"]=hx.a),px.a&&(oF["views.right_panel.WidgetCard"]=px.a),mR&&(oF["views.rooms.Autocomplete"]=mR),uR.a&&(oF["views.rooms.AuxPanel"]=uR.a),fk&&(oF["views.rooms.BasicMessageComposer"]=fk),bk.a&&(oF["views.rooms.EventTile"]=bk.a),Ps&&(oF["views.rooms.ExtraTile"]=Ps),Ok&&(oF["views.rooms.GLobitsMenuList"]=Ok),Dk&&(oF["views.rooms.GLobitsRoomList"]=Dk),Xs.a&&(oF["views.rooms.GlobitsMenuSublist"]=Xs.a),Ss.a&&(oF["views.rooms.GlobitsRoomSublist"]=Ss.a),Ak.a&&(oF["views.rooms.MenuTile"]=Ak.a),Kk&&(oF["views.rooms.MessageComposer"]=Kk),Yk&&(oF["views.rooms.NewRoomIntro"]=Yk),Ts.a&&(oF["views.rooms.NotificationBadge"]=Ts.a),$k.a&&(oF["views.rooms.PinnedEventTile"]=$k.a),_i&&(oF["views.rooms.RoomBreadcrumbs"]=_i),aI&&(oF["views.rooms.RoomList"]=aI),Ri&&(oF["views.rooms.RoomListNumResults"]=Ri),ri.b&&(oF["views.rooms.RoomSublist"]=ri.b),nI.a&&(oF["views.rooms.RoomTile"]=nI.a),sI.a&&(oF["views.rooms.ThirdPartyMemberInfo"]=sI.a),Fk.a&&(oF["views.rooms.VoiceRecordComposerTile"]=Fk.a),cI&&(oF["views.rooms.WhoIsTypingTile"]=cI),hI&&(oF["views.settings.BridgeTile"]=hI),gI.a&&(oF["views.settings.E2eAdvancedPanel"]=gI.a),vI&&(oF["views.settings.EventIndexPanel"]=vI),CI&&(oF["views.settings.SetIdServer"]=CI),OI.a&&(oF["views.settings.SpellCheckSettings"]=OI.a),xI.a&&(oF["views.settings.UpdateCheckButton"]=xI.a),kI&&(oF["views.settings.tabs.room.BridgeSettingsTab"]=kI),jI&&(oF["views.settings.tabs.room.RolesRoomSettingsTab"]=jI),BI&&(oF["views.settings.tabs.room.SecurityRoomSettingsTab"]=BI),GI.a&&(oF["views.settings.tabs.user.AppearanceUserSettingsTab"]=GI.a),zI.a&&(oF["views.settings.tabs.user.HelpUserSettingsTab"]=zI.a),WI.a&&(oF["views.settings.tabs.user.MjolnirUserSettingsTab"]=WI.a),HI.a&&(oF["views.settings.tabs.user.PreferencesUserSettingsTab"]=HI.a),sm.b&&(oF["views.spaces.SpaceBasicSettings"]=sm.b),gm&&(oF["views.spaces.SpaceCreateMenu"]=gm),Rm&&(oF["views.spaces.SpacePanel"]=Rm),KI.a&&(oF["views.spaces.SpacePublicShare"]=KI.a),Om&&(oF["views.spaces.SpaceTreeLevel"]=Om),qI.a&&(oF["views.toasts.GenericExpiringToast"]=qI.a),kd.a&&(oF["views.toasts.GenericToast"]=kd.a),YI.a&&(oF["views.toasts.NonUrgentEchoFailureToast"]=YI.a),QI&&(oF["views.toasts.VerificationRequestToast"]=QI),eT.a&&(oF["views.voice_messages.Clock"]=eT.a),tT.a&&(oF["views.voice_messages.LiveRecordingClock"]=tT.a),aT.a&&(oF["views.voice_messages.LiveRecordingWaveform"]=aT.a),nT.a&&(oF["views.voice_messages.PlayPauseButton"]=nT.a),sT.a&&(oF["views.voice_messages.PlaybackClock"]=sT.a),iT.a&&(oF["views.voice_messages.PlaybackWaveform"]=iT.a),MO.a&&(oF["views.voice_messages.RecordingPlayback"]=MO.a),oT.a&&(oF["views.voice_messages.Waveform"]=oT.a),Tm&&(oF["views.voip.AudioFeed"]=Tm),Pm&&(oF["views.voip.AudioFeedArrayForCall"]=Pm),Kd&&(oF["views.voip.CallContainer"]=Kd),Wd&&(oF["views.voip.CallPreview"]=Wd),Ld.a&&(oF["views.voip.CallView"]=Ld.a),rT.a&&(oF["views.voip.CallViewForRoom"]=rT.a),lT.a&&(oF["views.voip.DialPad"]=lT.a),hE.a&&(oF["views.voip.DialPadModal"]=hE.a),Md&&(oF["views.voip.IncomingCallBox"]=Md),cT.a&&(oF["views.voip.VideoFeed"]=cT.a),le&&(oF["Common.FormikSelectAdministrativeUnit.PublicService"]=le),$e&&(oF["Common.Popup.LabTestResultPopup.Service"]=$e),$t&&(oF["Common.SelectButton.SelectBioProduct.Service"]=$t),_&&(oF["structures.AdministrativeUnit.Service"]=_),Pn&&(oF["structures.Appointment.Service"]=Pn),En&&(oF["structures.BookingPopup.Service"]=En),Hi&&(oF["structures.ClinicInformation.Service"]=Hi),to&&(oF["structures.ConfirmLabTestOrder.Service"]=to),Zo&&(oF["structures.ConfirmPayment.Service"]=Zo),Ur&&(oF["structures.ConfirmScreening.Service"]=Ur),fs&&(oF["structures.CustomRoomTagPanel"]=fs),qr&&(oF["structures.Customer.Service"]=qr),ol&&(oF["structures.CustomerSupport.Service"]=ol),Ko&&(oF["structures.Dashboard.Service"]=Ko),zl&&(oF["structures.DispensateRating.Service"]=zl),ia&&(oF["structures.Drug.Service"]=ia),mc&&(oF["structures.DrugExportManagement.Service"]=mc),Ec&&(oF["structures.DrugManagement.Service"]=Ec),dT.a&&(oF["structures.EmbeddedPage"]=dT.a),ha&&(oF["structures.Encounter.Service"]=ha),Dc&&(oF["structures.EncounterSlot.Service"]=Dc),Yr&&(oF["structures.Ethnicity.Service"]=Yr),mp&&(oF["structures.File.Service"]=mp),mT.a&&(oF["structures.FilePanel"]=mT.a),uT&&(oF["structures.GenericErrorPage"]=uT),ms&&(oF["structures.GroupFilterPanel"]=ms),RT&&(oF["structures.GroupView"]=RT),ya&&(oF["structures.HealthOrganization.Service"]=ya),wi&&(oF["structures.IndicatorScrollbar"]=wi),kT.b&&(oF["structures.InteractiveAuth"]=kT.b),wa&&(oF["structures.LabTest.Service"]=wa),Ol&&(oF["structures.LabTestOrder.Service"]=Ol),PT&&(oF["structures.LabTestOrderItem.Service"]=PT),Sh&&(oF["structures.LabTestTemplate.Service"]=Sh),nv&&(oF["structures.ListResultWaiting.Service"]=nv),fT.a&&(oF["structures.MainSplit"]=fT.a),cg&&(oF["structures.MedicalExamination.Service"]=cg),BT&&(oF["structures.MessagePanel"]=BT),qT&&(oF["structures.MyGroups"]=qT),qp&&(oF["structures.MyInfo.Service"]=qp),Up&&(oF["structures.MyPatient.Service"]=Up),gf&&(oF["structures.Notification.Service"]=gf),Ta&&(oF["structures.NotificationManager.Service"]=Ta),S_&&(oF["structures.Observation.Service"]=S_),$r&&(oF["structures.Occupation.Service"]=$r),Tn&&(oF["structures.Patient.Service"]=Tn),lp&&(oF["structures.PatientMedicalRecordFile.Service"]=lp),vv&&(oF["structures.Policies.Service"]=vv),Ua&&(oF["structures.Practitioner.Service"]=Ua),Bg&&(oF["structures.PractitionerMedicalRecordFile.Service"]=Bg),lv&&(oF["structures.PractitionerSchedule.Service"]=lv),ic&&(oF["structures.Prescription.Service"]=ic),Ga&&(oF["structures.Regiment.Service"]=Ga),jf&&(oF["structures.Report.Service"]=jf),yo&&(oF["structures.RiskAssessment.Service"]=yo),rh&&(oF["structures.Role.Service"]=rh),$T.a&&(oF["structures.RoomStatusBar"]=$T.a),_S&&(oF["structures.ScreeningQuestion.Service"]=_S),hS.a&&(oF["structures.ScrollPanel"]=hS.a),JT.a&&(oF["structures.SearchBox"]=JT.a),Mo&&(oF["structures.SelectTest.Service"]=Mo),jp&&(oF["structures.SendMail.Service"]=jp),Db&&(oF["structures.SupporterManagement.Service"]=Db),QT.a&&(oF["structures.TimelinePanel"]=QT.a),ke&&(oF["structures.TreatmentPeriod.Service"]=ke),Ot&&(oF["structures.User.Service"]=Ot),ZT&&(oF["structures.UserView"]=ZT),Uh&&(oF["structures.ValueCode.Service"]=Uh),nP&&(oF["structures.ViewSource"]=nP),lP&&(oF["structures.auth.CompleteSecurity"]=lP),yP&&(oF["structures.auth.E2eSetup"]=yP),CP&&(oF["structures.auth.ForgotPassword"]=CP),rP.a&&(oF["structures.auth.SetupEncryptionBody"]=rP.a),OP&&(oF["views.auth.AuthBody"]=OP),RP&&(oF["views.auth.AuthFooter"]=RP),TP&&(oF["views.auth.AuthHeader"]=TP),NP&&(oF["views.auth.AuthHeaderLogo"]=NP),qS&&(oF["views.auth.AuthPage"]=qS),jP.a&&(oF["views.auth.CaptchaForm"]=jP.a),dP&&(oF["views.auth.CompleteSecurityBody"]=dP),aC&&(oF["views.auth.CountryDropdown"]=aC),MP&&(oF["views.auth.LanguageSelector"]=MP),UC&&(oF["views.auth.Service"]=UC),UP&&(oF["views.auth.Welcome"]=UP),zP&&(oF["views.avatars.MemberStatusMessageAvatar"]=zP),KP&&(oF["views.context_menus.GenericElementContextMenu"]=KP),$P&&(oF["views.context_menus.GenericTextContextMenu"]=$P),XP&&(oF["views.context_menus.GroupInviteTileContextMenu"]=XP),tN.b&&(oF["views.context_menus.MessageContextMenu"]=tN.b),BP&&(oF["views.context_menus.StatusMessageContextMenu"]=BP),aN&&(oF["views.context_menus.TagTileContextMenu"]=aN),oN&&(oF["views.dialogs.AddressPickerDialog"]=oN),cN&&(oF["views.dialogs.AskInviteAnywayDialog"]=cN),hu.a&&(oF["views.dialogs.BaseDialog"]=hu.a),au&&(oF["views.dialogs.BugReportDialog"]=au),mN.a&&(oF["views.dialogs.ChangelogDialog"]=mN.a),uN&&(oF["views.dialogs.ConfirmAndWaitRedactDialog"]=uN),pN&&(oF["views.dialogs.ConfirmRedactDialog"]=pN),vN.a&&(oF["views.dialogs.ConfirmUserActionDialog"]=vN.a),bN&&(oF["views.dialogs.ConfirmWipeDeviceDialog"]=bN),_N&&(oF["views.dialogs.CreateGroupDialog"]=_N),wN&&(oF["views.dialogs.CryptoStoreTooNewDialog"]=wN),ON.a&&(oF["views.dialogs.DeactivateAccountDialog"]=ON.a),uu.a&&(oF["views.dialogs.ErrorDialog"]=uu.a),ou&&(oF["views.dialogs.FeedbackDialog"]=ou),xN&&(oF["views.dialogs.IncomingSasDialog"]=xN),nu.a&&(oF["views.dialogs.InfoDialog"]=nu.a),RN.a&&(oF["views.dialogs.IntegrationsDisabledDialog"]=RN.a),kN.a&&(oF["views.dialogs.IntegrationsImpossibleDialog"]=kN.a),hP&&(oF["views.dialogs.InteractiveAuthDialog"]=hP),IN&&(oF["views.dialogs.KeySignatureUploadFailedDialog"]=IN),NN&&(oF["views.dialogs.LazyLoadingDisabledDialog"]=NN),DN&&(oF["views.dialogs.LazyLoadingResyncDialog"]=DN),lu&&(oF["views.dialogs.LogoutDialog"]=lu),jN&&(oF["views.dialogs.ManualDeviceKeyVerificationDialog"]=jN),UN&&(oF["views.dialogs.MessageEditHistoryDialog"]=UN),VN&&(oF["views.dialogs.NewSessionReviewDialog"]=VN),$d.a&&(oF["views.dialogs.QuestionDialog"]=$d.a),QN&&(oF["views.dialogs.ReportEventDialog"]=QN),hD&&(oF["views.dialogs.RoomSettingsDialog"]=hD),fD&&(oF["views.dialogs.RoomUpgradeDialog"]=fD),yD&&(oF["views.dialogs.RoomUpgradeWarningDialog"]=yD),SD&&(oF["views.dialogs.SessionRestoreErrorDialog"]=SD),RD&&(oF["views.dialogs.SetEmailDialog"]=RD),TD&&(oF["views.dialogs.SlashCommandHelpDialog"]=TD),PD&&(oF["views.dialogs.StorageEvictedDialog"]=PD),jD.a&&(oF["views.dialogs.TabbedIntegrationManagerDialog"]=jD.a),UD&&(oF["views.dialogs.TermsDialog"]=UD),sS&&(oF["views.dialogs.TextInputDialog"]=sS),BD&&(oF["views.dialogs.UploadFailureDialog"]=BD),om.d&&(oF["views.dialogs.UserSettingsDialog"]=om.d),BN.a&&(oF["views.dialogs.VerificationRequestDialog"]=BN.a),zD.a&&(oF["views.dialogs.WidgetOpenIDPermissionsDialog"]=zD.a),WD&&(oF["views.dialogs.security.ConfirmDestroyCrossSigningDialog"]=WD),fP&&(oF["views.dialogs.security.CreateCrossSigningDialog"]=fP),ru.a&&(oF["views.dialogs.security.RestoreKeyBackupDialog"]=ru.a),qD.a&&(oF["views.dialogs.security.SetupEncryptionDialog"]=qD.a),nd&&(oF["views.elements.ActionButton"]=nd),YD&&(oF["views.elements.AddressSelector"]=YD),QD&&(oF["views.elements.AddressTile"]=QD),ej.a&&(oF["views.elements.AppPermission"]=ej.a),Di.a&&(oF["views.elements.AppTile"]=Di.a),tj.a&&(oF["views.elements.AppWarning"]=tj.a),nj&&(oF["views.elements.DNDTagTile"]=nj),WC.a&&(oF["views.elements.DialogButtons"]=WC.a),mS&&(oF["views.elements.DirectorySearchBox"]=mS),oj.a&&(oF["views.elements.Dropdown"]=oj.a),lj&&(oF["views.elements.EditableItemList"]=lj),mj&&(oF["views.elements.EditableText"]=mj),hj&&(oF["views.elements.EditableTextContainer"]=hj),gj.a&&(oF["views.elements.ErrorBoundary"]=gj.a),vj&&(oF["views.elements.Flair"]=vj),jd.a&&(oF["views.elements.FormButton"]=jd.a),FI.a&&(oF["views.elements.LabelledToggleSwitch"]=FI.a),bj.a&&(oF["views.elements.LanguageDropdown"]=bj.a),hO&&(oF["views.elements.LazyRenderList"]=hO),Yd.a&&(oF["views.elements.PersistedElement"]=Yd.a),Bd&&(oF["views.elements.PersistentApp"]=Bd),uI.a&&(oF["views.elements.Pill"]=uI.a),yj.a&&(oF["views.elements.PowerSelector"]=yj.a),Ej.a&&(oF["views.elements.ReplyThread"]=Ej.a),LE.a&&(oF["views.elements.ResizeHandle"]=LE.a),Cj&&(oF["views.elements.RoleDemo"]=Cj),Oj.a&&(oF["views.elements.RoomAliasField"]=Oj.a),Jc.a&&(oF["views.elements.Spinner"]=Jc.a),xj&&(oF["views.elements.Spoiler"]=xj),aP.a&&(oF["views.elements.SyntaxHighlight"]=aP.a),aj&&(oF["views.elements.TagTile"]=aj),gC.a&&(oF["views.elements.TextWithTooltip"]=gC.a),Nj&&(oF["views.elements.TintableSvg"]=Nj),Dj&&(oF["views.elements.TruncatedList"]=Dj),Mj.a&&(oF["views.elements.crypto.VerificationQRCode"]=Mj.a),D_&&(oF["views.elements.demo"]=D_),Uj&&(oF["views.groups.GroupInviteTile"]=Uj),Bj.a&&(oF["views.groups.GroupMemberList"]=Bj.a),Gj&&(oF["views.groups.GroupMemberTile"]=Gj),Hj&&(oF["views.groups.GroupPublicityToggle"]=Hj),Yj.a&&(oF["views.groups.GroupRoomInfo"]=Yj.a),$j.a&&(oF["views.groups.GroupRoomList"]=$j.a),Xj&&(oF["views.groups.GroupRoomTile"]=Xj),aA&&(oF["views.groups.GroupTile"]=aA),nA.a&&(oF["views.groups.GroupUserSettings"]=nA.a),sA&&(oF["views.messages.DateSeparator"]=sA),wA&&(oF["views.messages.EditHistoryMessage"]=wA),FO&&(oF["views.messages.MAudioBody"]=FO),PO&&(oF["views.messages.MFileBody"]=PO),RA&&(oF["views.messages.MImageBody"]=RA),TA&&(oF["views.messages.MKeyVerificationConclusion"]=TA),NA&&(oF["views.messages.MKeyVerificationRequest"]=NA),jA&&(oF["views.messages.MStickerBody"]=jA),BA&&(oF["views.messages.MessageActionBar"]=BA),zA.a&&(oF["views.messages.MessageEvent"]=zA.a),WA.a&&(oF["views.messages.MessageTimestamp"]=WA.a),HA&&(oF["views.messages.MjolnirBody"]=HA),YA&&(oF["views.messages.RoomAvatarEvent"]=YA),QA&&(oF["views.messages.RoomCreate"]=QA),eM&&(oF["views.messages.SenderProfile"]=eM),nM.a&&(oF["views.messages.TextualBody"]=nM.a),sM&&(oF["views.messages.TextualEvent"]=sM),oM&&(oF["views.messages.TileErrorBoundary"]=oM),cM.a&&(oF["views.messages.UnknownBody"]=cM.a),dM&&(oF["views.messages.ViewSourceEvent"]=dM),fM&&(oF["views.room_settings.AliasSettings"]=fM),EM&&(oF["views.room_settings.RelatedGroupSettings"]=EM),sD&&(oF["views.room_settings.RoomProfileSettings"]=sD),uM&&(oF["views.room_settings.RoomPublishSetting"]=uM),CM&&(oF["views.room_settings.UrlPreviewSettings"]=CM),wM.a&&(oF["views.rooms.AppsDrawer"]=wM.a),Uk.b&&(oF["views.rooms.E2EIcon"]=Uk.b),WM&&(oF["views.rooms.EditMessageComposer"]=WM),QM&&(oF["views.rooms.EntityTile"]=QM),XM.a&&(oF["views.rooms.ForwardMessage"]=XM.a),ZM&&(oF["views.rooms.JumpToBottomButton"]=ZM),eU&&(oF["views.rooms.LinkPreviewWidget"]=eU),nU.a&&(oF["views.rooms.MemberList"]=nU.a),sU&&(oF["views.rooms.MemberTile"]=sU),lk&&(oF["views.rooms.MessageComposerFormatBar"]=lk),iU.a&&(oF["views.rooms.PresenceLabel"]=iU.a),dU&&(oF["views.rooms.ReadReceiptMarker"]=dU),Lk.a&&(oF["views.rooms.ReplyPreview"]=Lk.a),bU&&(oF["views.rooms.RoomDetailList"]=bU),gU&&(oF["views.rooms.RoomDetailRow"]=gU),_U.a&&(oF["views.rooms.RoomHeader"]=_U.a),SU.a&&(oF["views.rooms.RoomPreviewBar"]=SU.a),CU.a&&(oF["views.rooms.RoomUpgradeWarningBar"]=CU.a),wU.a&&(oF["views.rooms.SearchBar"]=wU.a),OU&&(oF["views.rooms.SearchResultTile"]=OU),DU&&(oF["views.rooms.SendMessageComposer"]=DU),MU.b&&(oF["views.rooms.SimpleRoomHeader"]=MU.b),Mk.a&&(oF["views.rooms.Stickerpicker"]=Mk.a),UU&&(oF["views.rooms.TopUnreadMessagesBar"]=UU),VU&&(oF["views.settings.AvatarSetting"]=VU),GU&&(oF["views.settings.ChangeAvatar"]=GU),WU&&(oF["views.settings.ChangeDisplayName"]=WU),qU&&(oF["views.settings.ChangePassword"]=qU),$U&&(oF["views.settings.CrossSigningPanel"]=$U),QU&&(oF["views.settings.DevicesPanel"]=QU),ZU&&(oF["views.settings.DevicesPanelEntry"]=ZU),eL.a&&(oF["views.settings.IntegrationManager"]=eL.a),fL&&(oF["views.settings.Notifications"]=fL),bL.a&&(oF["views.settings.ProfileSettings"]=bL.a),yL.a&&(oF["views.settings.SecureBackupPanel"]=yL.a),_L&&(oF["views.settings.SetIntegrationManager"]=_L),OL&&(oF["views.settings.account.EmailAddresses"]=OL),IL&&(oF["views.settings.account.PhoneNumbers"]=IL),DL&&(oF["views.settings.discovery.EmailAddresses"]=DL),UL&&(oF["views.settings.discovery.PhoneNumbers"]=UL),tD&&(oF["views.settings.tabs.room.AdvancedRoomSettingsTab"]=tD),rD&&(oF["views.settings.tabs.room.GeneralRoomSettingsTab"]=rD),dD&&(oF["views.settings.tabs.room.NotificationSettingsTab"]=dD),BL.a&&(oF["views.settings.tabs.user.FlairUserSettingsTab"]=BL.a),VL.a&&(oF["views.settings.tabs.user.GeneralUserSettingsTab"]=VL.a),GL.a&&(oF["views.settings.tabs.user.LabsUserSettingsTab"]=GL.a),zL.a&&(oF["views.settings.tabs.user.NotificationUserSettingsTab"]=zL.a),WL.a&&(oF["views.settings.tabs.user.SecurityUserSettingsTab"]=WL.a),HL.a&&(oF["views.settings.tabs.user.VoiceUserSettingsTab"]=HL.a),KL&&(oF["views.terms.InlineTermsAgreement"]=KL),$L&&(oF["views.verification.VerificationCancelled"]=$L),XL&&(oF["views.verification.VerificationComplete"]=XL),aF&&(oF["views.verification.VerificationQREmojiOptions"]=aF),iF&&(oF["views.verification.VerificationShowSas"]=iF)},8471:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n=a(19),s=a.n(n),i=a(237),o=a(100),r=a(93),l=a(99),c=a(161);function d(e){const t=l.a.get().getUserId();return"m.room.member"===e.getType()?e.getStateKey()===t:e.getSender()===t}function m(e,t){if(t!==c.a.DM)return!0;const a=l.a.get().getRoom(e);return!a||2!==a.currentState.getJoinedMemberCount()}function u(e){return e.sender?e.sender.name:e.getSender()}var h=a(413),p=a(201);var g=a(1);var f=a(103),v=a(185);var b=a(142);const y={"m.room.message":{isState:!1,previewer:new class{getTextFor(e,t){let a=e.getContent();if(e.isRelation("m.replace")&&(a=e.getContent()["m.new_content"]),!a||!a.body)return null;let n=(a.body||"").trim();const s=a.msgtype;if(!n||!s)return null;const i="org.matrix.custom.html"===a.format&&a.formatted_body;i&&(n=a.formatted_body);const o=e.getWireContent()["m.relates_to"];return o&&o["m.in_reply_to"]&&(n=i?(h.a.stripHTMLReply(n)||"").trim():(h.a.stripPlainReply(n)||"").trim(),!n)?null:(i&&(n=Object(p.d)(n)),"m.emote"===s?Object(r.a)("* %(senderName)s %(emote)s",{senderName:u(e),emote:n}):d(e)||!m(e.getRoomId(),t)?n:Object(r.a)("%(senderName)s: %(message)s",{senderName:u(e),message:n}))}}},"m.call.invite":{isState:!1,previewer:new class{getTextFor(e,t){return m(e.getRoomId(),t)?d(e)?Object(r.a)("You started a call"):Object(r.a)("%(senderName)s started a call",{senderName:u(e)}):d(e)?Object(r.a)("Waiting for answer"):Object(r.a)("%(senderName)s is calling",{senderName:u(e)})}}},"m.call.answer":{isState:!1,previewer:new class{getTextFor(e,t){return m(e.getRoomId(),t)?d(e)?Object(r.a)("You joined the call"):Object(r.a)("%(senderName)s joined the call",{senderName:u(e)}):Object(r.a)("Call in progress")}}},"m.call.hangup":{isState:!1,previewer:new class{getTextFor(e,t){return m(e.getRoomId(),t)?d(e)?Object(r.a)("You ended the call"):Object(r.a)("%(senderName)s ended the call",{senderName:u(e)}):Object(r.a)("Call ended")}}},"m.sticker":{isState:!1,previewer:new class{getTextFor(e,t){const a=e.getContent().body;return a?d(e)||!m(e.getRoomId(),t)?a:Object(r.a)("%(senderName)s: %(stickerName)s",{senderName:u(e),stickerName:a}):null}}},"m.reaction":{isState:!1,previewer:new class{getTextFor(e,t){const a=f.b.getValue("feature_roomlist_preview_reactions_dms");if(!(f.b.getValue("feature_roomlist_preview_reactions_all")||a&&v.a.shared().getUserIdForRoomId(e.getRoomId())))return null;const n=e.getRelation();if(!n)return null;const s=n.key;return s?d(e)||!m(e.getRoomId(),t)?s:Object(r.a)("%(senderName)s: %(reaction)s",{senderName:u(e),reaction:s}):null}}}},E="im.vector.any";class _ extends i.a{constructor(){super(o.a,{}),s()(this,"previews",new Map)}static get instance(){return _.internalInstance}static getPreviewChangedEventName(e){return"room_preview_changed:"+(null==e?void 0:e.roomId)}async getPreviewForRoom(e,t){if(!e)return null;this.previews.has(e.roomId)||await this.generatePreview(e,t);const a=this.previews.get(e.roomId);return a?a.has(t)?a.get(t):a.get(E):null}async generatePreview(e,t){const a=e.timeline;if(!a)return;let n=this.previews.get(e.roomId);n||(n=new Map,this.previews.set(e.roomId,n)),n.has(E)||n.set(E,null),t&&!n.has(t)&&n.set(t,null);let s=!1;for(let t=a.length-1;t>=0&&t!==a.length-50;t--){const i=a[t];await this.matrixClient.decryptEventIfNeeded(i);const o=y[i.getType()];if(!o)continue;if(o.isState&&Object(g.o)(i.getStateKey()))continue;const r=o.previewer.getTextFor(i,null);if(!r)continue;s=s||r!==n.get(E),n.set(E,r);const l=Array.from(n.keys()).filter(e=>e!==E);for(const e of l){const t=e===E?null:e,a=o.previewer.getTextFor(i,t);a===r?(s=s||r!==n.get(e),n.delete(e)):(s=s||a!==n.get(e),n.set(e,a))}return void(s&&(this.previews.set(e.roomId,n),this.emit(b.b,this),this.emit(_.getPreviewChangedEventName(e),e)))}this.previews.set(e.roomId,new Map),this.emit(b.b,this),this.emit(_.getPreviewChangedEventName(e),e)}async onAction(e){if(this.matrixClient&&("MatrixActions.Room.timeline"===e.action||"MatrixActions.Event.decrypted"===e.action)){const t=e.event,a=e.hasOwnProperty("isLiveEvent")&&!e.isLiveEvent;if(!this.previews.has(t.getRoomId())||a)return;await this.generatePreview(this.matrixClient.getRoom(t.getRoomId()),E)}}}s()(_,"internalInstance",new _)},8472:function(e,t,a){"use strict";a.d(t,"b",(function(){return I})),a.d(t,"a",(function(){return P}));var n=a(19),s=a.n(n),i=a(1),o=a(185),r=a(8),l=a(153),c=a(161),d=a(477),m=a(295),u=a(324);var h=a(1246),p=a(226);const g={[u.b.Recent]:new h.a,[u.b.Alphabetic]:new class{async sortRooms(e,t){return e.sort((e,t)=>Object(p.a)(e.name,t.name))}},[u.b.Manual]:new class{async sortRooms(e,t){const a=e=>e.tags[t].order||0;return e.sort((e,t)=>a(e)-a(t))}}};function f(e,t,a){return function(e){if(!g[e])throw new Error(e+" is not a known algorithm");return g[e]}(a).sortRooms(e,t)}var v=a(1315),b=a.n(v);class y{constructor(e,t){this.tagId=e,s()(this,"cachedOrderedRooms",void 0),s()(this,"sortingAlgorithm",void 0),s()(this,"updateLock",new b.a),this.setSortAlgorithm(t)}get orderedRooms(){return this.cachedOrderedRooms||[]}async setSortAlgorithm(e){if(!e)throw new Error("A sorting algorithm must be defined");this.sortingAlgorithm=e,await this.setRooms(this.orderedRooms)}getRoomIndex(e){let t=this.cachedOrderedRooms.indexOf(e);return-1===t&&(console.warn(`Degrading performance to find missing room in "${this.tagId}": ${e.roomId}`),t=this.cachedOrderedRooms.findIndex(t=>t.roomId===e.roomId)),t}}var E=a(333),_=a(184);const S=[E.a.Red,E.a.Grey,E.a.Bold,E.a.None];class C extends y{constructor(e,t){super(e,t),s()(this,"indices",{})}categorizeRooms(e){const t={[E.a.Red]:[],[E.a.Grey]:[],[E.a.Bold]:[],[E.a.None]:[]};for(const a of e){t[this.getRoomCategory(a)].push(a)}return t}getRoomCategory(e){return _.a.instance.getRoomState(e).color}async setRooms(e){if(this.sortingAlgorithm===u.b.Manual)this.cachedOrderedRooms=await f(e,this.tagId,this.sortingAlgorithm);else{const t=this.categorizeRooms(e);for(const e of Object.keys(t)){const a=t[e];t[e]=await f(a,this.tagId,this.sortingAlgorithm)}const a=[],n={};for(const e of S)n[e]=a.length,a.push(...t[e]);this.indices=n,this.cachedOrderedRooms=a}}async handleSplice(e,t){if(t===c.c.NewRoom){const t=this.getRoomCategory(e);this.alterCategoryPositionBy(t,1,this.indices),this.cachedOrderedRooms.splice(this.indices[t],0,e),await this.sortCategory(t)}else{if(t!==c.c.RoomRemoved)throw new Error("Unhandled splice: "+t);{const t=this.getRoomIndex(e);if(-1===t)return console.warn(`Tried to remove unknown room from ${this.tagId}: ${e.roomId}`),!1;const a=this.getCategoryFromIndices(t,this.indices);this.alterCategoryPositionBy(a,-1,this.indices),this.cachedOrderedRooms.splice(t,1)}}return!0}async handleRoomUpdate(e,t){try{if(await this.updateLock.acquireAsync(),t===c.c.NewRoom||t===c.c.RoomRemoved)return this.handleSplice(e,t);if(t!==c.c.Timeline&&t!==c.c.ReadReceipt)throw new Error("Unsupported update cause: "+t);const a=this.getRoomCategory(e);if(this.sortingAlgorithm===u.b.Manual)return;const n=this.getRoomIndex(e);if(-1===n)throw new Error(`Room ${e.roomId} has no index in ${this.tagId}`);const s=this.getCategoryFromIndices(n,this.indices);return s!==a&&(this.moveRoomIndexes(1,s,a,this.indices),this.cachedOrderedRooms.splice(n,1),this.cachedOrderedRooms.splice(this.indices[a],0,e)),await this.sortCategory(a),!0}finally{await this.updateLock.release()}}async sortCategory(e){const t=e===S[S.length-1]?Number.MAX_SAFE_INTEGER:this.indices[S[S.indexOf(e)+1]],a=this.indices[e],n=t-a,s=this.cachedOrderedRooms.splice(a,n),i=await f(s,this.tagId,this.sortingAlgorithm);this.cachedOrderedRooms.splice(a,0,...i)}getCategoryFromIndices(e,t){for(let a=0;a<S.length;a++){const n=S[a],s=a===S.length-1,i=t[n],o=s?Number.MAX_SAFE_INTEGER:t[S[a+1]];if(e>=i&&e<o)return n}throw new Error("Programming error: somehow you've ended up with an index that isn't in a category")}moveRoomIndexes(e,t,a,n){this.alterCategoryPositionBy(t,-e,n),this.alterCategoryPositionBy(a,+e,n)}alterCategoryPositionBy(e,t,a){const n=S.indexOf(e)+1;if(t>0)for(let e=n;e<S.length;e++){a[S[e]]+=Math.abs(t)}else if(t<0)for(let e=n;e<S.length;e++){a[S[e]]-=Math.abs(t)}for(let e=1;e<=S.length;e++){const t=S[e-1],n=S[e];a[t]>a[n]&&console.warn(`!! Room list index corruption: ${t} (i:${a[t]}) is greater than ${n} (i:${a[n]}) - category indices are likely desynced from reality`)}}}class w extends y{constructor(e,t){super(e,t)}async setRooms(e){this.cachedOrderedRooms=await f(e,this.tagId,this.sortingAlgorithm)}async handleRoomUpdate(e,t){try{await this.updateLock.acquireAsync();const a=t===c.c.NewRoom||t===c.c.RoomRemoved,n=t===c.c.Timeline||t===c.c.ReadReceipt;if(!a&&!n)throw new Error("Unsupported update cause: "+t);if(t===c.c.NewRoom)this.cachedOrderedRooms.push(e);else if(t===c.c.RoomRemoved){const t=this.getRoomIndex(e);t>=0?this.cachedOrderedRooms.splice(t,1):console.warn(`Tried to remove unknown room from ${this.tagId}: ${e.roomId}`)}return this.cachedOrderedRooms=await f(this.cachedOrderedRooms,this.tagId,this.sortingAlgorithm),!0}finally{await this.updateLock.release()}}}const O={[u.a.Natural]:(e,t)=>new w(e,t),[u.a.Importance]:(e,t)=>new C(e,t)};function x(e,t,a){if(!O[e])throw new Error(e+" is not a known algorithm");return O[e](t,a)}var R=a(103),k=a(907);const I="list_updated_event",T=[c.c.Timeline,c.c.ReadReceipt];class P extends r.EventEmitter{constructor(){super(),s()(this,"_cachedRooms",{}),s()(this,"_cachedStickyRooms",{}),s()(this,"filteredRooms",{}),s()(this,"_stickyRoom",null),s()(this,"_lastStickyRoom",null),s()(this,"sortAlgorithms",void 0),s()(this,"listAlgorithms",void 0),s()(this,"algorithms",void 0),s()(this,"rooms",[]),s()(this,"roomIdsToTags",{}),s()(this,"allowedByFilter",new Map),s()(this,"allowedRoomsByFilters",new Set),s()(this,"updatesInhibited",!1)}get stickyRoom(){return this._stickyRoom?this._stickyRoom.room:null}get knownRooms(){return this.rooms}get hasTagSortingMap(){return!!this.sortAlgorithms}get hasFilters(){return this.allowedByFilter.size>0}set cachedRooms(e){this._cachedRooms=e,this.recalculateFilteredRooms(),this.recalculateStickyRoom()}get cachedRooms(){return this._cachedRooms}async setStickyRoom(e){await this.updateStickyRoom(e)}getTagSorting(e){return this.sortAlgorithms?this.sortAlgorithms[e]:null}async setTagSorting(e,t){if(!e)throw new Error("Tag ID must be defined");if(!t)throw new Error("Algorithm must be defined");this.sortAlgorithms[e]=t;const a=this.algorithms[e];await a.setSortAlgorithm(t),this._cachedRooms[e]=a.orderedRooms,this.recalculateFilteredRoomsForTag(e),this.recalculateStickyRoom(e)}getListOrdering(e){return this.listAlgorithms?this.listAlgorithms[e]:null}async setListOrdering(e,t){if(!e)throw new Error("Tag ID must be defined");if(!t)throw new Error("Algorithm must be defined");this.listAlgorithms[e]=t;const a=x(t,e,this.sortAlgorithms[e]);this.algorithms[e]=a,await a.setRooms(this._cachedRooms[e]),this._cachedRooms[e]=a.orderedRooms,this.recalculateFilteredRoomsForTag(e),this.recalculateStickyRoom(e)}addFilterCondition(e){this.allowedByFilter.set(e,this.rooms.filter(t=>e.isVisible(t))),this.recalculateFilteredRooms(),e.on(d.a,this.handleFilterChange.bind(this))}removeFilterCondition(e){e.off(d.a,this.handleFilterChange.bind(this)),this.allowedByFilter.has(e)&&(this.allowedByFilter.delete(e),this.recalculateFilteredRooms(),this.hasFilters||this.updatesInhibited||this.emit(I))}async handleFilterChange(){await this.recalculateFilteredRooms(),this.updatesInhibited||this.emit(d.a)}async updateStickyRoom(e){try{return await this.doUpdateStickyRoom(e)}finally{this._lastStickyRoom=null}}async doUpdateStickyRoom(e){var t,a;if(R.b.getValue("feature_spaces")&&null!==(t=e)&&void 0!==t&&t.isSpaceRoom()&&"invite"!==e.getMyMembership()&&(e=null),e&&!k.a.instance.isRoomVisible(e)&&(e=null),this._lastStickyRoom=this._stickyRoom||{},!e){if(this._stickyRoom){const e=this._stickyRoom.room;return this._stickyRoom=null,void await this.handleRoomUpdate(e,c.c.NewRoom)}return}let n=null===(a=this.roomIdsToTags[e.roomId])||void 0===a?void 0:a[0];if(!n)throw new Error(e.roomId+" does not belong to a tag and cannot be sticky");let s=(this.getOrderedRoomsWithoutSticky()[n]||[]).indexOf(e);const i=!!this._lastStickyRoom.room&&this._lastStickyRoom.room.roomId===e.roomId;if(this._lastStickyRoom.tag&&n!==this._lastStickyRoom.tag&&i&&s<0&&(console.warn(`Sticky room ${e.roomId} changed tags during sticky room handling`),s=0),s<0)throw new Error(e.roomId+" does not appear to be known and cannot be sticky");const o=this._stickyRoom;if(this._stickyRoom=null,this.recalculateStickyRoom(),o&&o.room&&o.room.roomId!==e.roomId&&await this.handleRoomUpdate(o.room,c.c.NewRoom),await this.handleRoomUpdate(e,c.c.RoomRemoved),this._stickyRoom){if(this._stickyRoom.room!==e){if(this._stickyRoom.room.roomId!==e.roomId)throw new Error("Sticky room changed while the sticky room was changing");console.warn("Sticky room changed references")}console.warn(`Sticky room changed tag & position from ${n} / ${s} to ${this._stickyRoom.tag} / ${this._stickyRoom.position}`),n=this._stickyRoom.tag,s=this._stickyRoom.position}o&&o.tag===n&&o.position<=s&&s++,this._stickyRoom={room:e,position:s,tag:n},this.recalculateFilteredRoomsForTag(n),o&&o.tag!==n&&this.recalculateFilteredRoomsForTag(o.tag),this.recalculateStickyRoom(),this.updatesInhibited||this.emit(I)}recalculateFilteredRooms(){if(!this.hasFilters)return;console.warn("Recalculating filtered room list");const e=Array.from(this.allowedByFilter.keys()),t={};for(const a of Object.keys(this.cachedRooms)){const n=this.cachedRooms[a].map(e=>e);this.tryInsertStickyRoomToFilterSet(n,a);const s=n.map(e=>e),i=[];for(const t of e){const e=s.filter(e=>t.isVisible(e));for(const t of e){const e=s.indexOf(t);e>=0&&s.splice(e,1),i.push(t)}}t[a]=i,R.b.getValue("advancedRoomListLogging")&&console.log(`[DEBUG] ${t[a].length}/${n.length} rooms filtered into ${a}`)}const a=Object.values(t).reduce((e,t)=>(e.push(...t),e),[]);this.allowedRoomsByFilters=new Set(a),this.filteredRooms=t,this.updatesInhibited||this.emit(I)}recalculateFilteredRoomsForTag(e){if(!this.hasFilters)return;R.b.getValue("advancedRoomListLogging")&&console.log("Recalculating filtered rooms for "+e),delete this.filteredRooms[e];const t=this.cachedRooms[e].map(e=>e);this.tryInsertStickyRoomToFilterSet(t,e);const a=t.filter(e=>this.allowedRoomsByFilters.has(e));a.length>0&&(this.filteredRooms[e]=a),R.b.getValue("advancedRoomListLogging")&&console.log(`[DEBUG] ${a.length}/${t.length} rooms filtered into ${e}`)}tryInsertStickyRoomToFilterSet(e,t){if(!this._stickyRoom||!this._stickyRoom.room||this._stickyRoom.tag!==t)return;const a=this._stickyRoom.position;a>=e.length?e.push(this._stickyRoom.room):e.splice(a,0,this._stickyRoom.room)}recalculateStickyRoom(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._stickyRoom){if(this._cachedStickyRooms){if(this._cachedStickyRooms=null,this.updatesInhibited)return;this.emit(I)}return}if(!this._cachedStickyRooms||!e){R.b.getValue("advancedRoomListLogging")&&console.log("Generating clone of cached rooms for sticky room handling");const e={};for(const t of Object.keys(this.cachedRooms))e[t]=this.cachedRooms[t].map(e=>e);this._cachedStickyRooms=e}e&&(R.b.getValue("advancedRoomListLogging")&&console.log("Replacing cached sticky rooms for "+e),this._cachedStickyRooms[e]=this.cachedRooms[e].map(e=>e));const t=this._stickyRoom;e&&e!==t.tag||(R.b.getValue("advancedRoomListLogging")&&console.log(`Inserting sticky room ${t.room.roomId} at position ${t.position} in ${t.tag}`),this._cachedStickyRooms[t.tag].splice(t.position,0,t.room)),this.updatesInhibited||this.emit(I)}async populateTags(e,t){if(!e)throw new Error("Sorting map cannot be null or empty");if(!t)throw new Error("Ordering ma cannot be null or empty");if(Object(l.d)(Object.keys(e),Object.keys(t)))throw new Error("Both maps must contain the exact same tags");this.sortAlgorithms=e,this.listAlgorithms=t,this.algorithms={};for(const t of Object.keys(e))this.algorithms[t]=x(this.listAlgorithms[t],t,this.sortAlgorithms[t]);return this.setKnownRooms(this.rooms)}getOrderedRooms(){return this.hasFilters?this.filteredRooms:this._cachedStickyRooms||this.cachedRooms}getUnfilteredRooms(){return this._cachedStickyRooms||this.cachedRooms}getOrderedRoomsWithoutSticky(){return this.hasFilters?this.filteredRooms:this.cachedRooms}async setKnownRooms(e){if(Object(i.o)(e))throw new Error("Array of rooms cannot be null");if(!this.sortAlgorithms)throw new Error("Cannot set known rooms without a tag sorting map");this.updatesInhibited||console.warn("Resetting known rooms, initiating regeneration");const t=this._stickyRoom;await this.updateStickyRoom(null),this.rooms=e;const a={};for(const e in this.sortAlgorithms)a[e]=[];if(!e.length)return await this.generateFreshTags(a),void(this.cachedRooms=a);const n=Object(m.e)(e);for(const e of n[m.a.Invite])a[c.a.Invite].push(e);for(const e of n[m.a.Leave])a[c.a.Archived].push(e);for(const e of n[m.a.Join]){const t=this.getTagsOfJoinedRoom(e);let n=!1;if(t.length>0)for(const s of t)Object(i.o)(a[s])||(a[s].push(e),n=!0);n||(o.a.shared().getUserIdForRoomId(e.roomId)?a[c.a.DM].push(e):a[c.a.Untagged].push(e))}await this.generateFreshTags(a),this.cachedRooms=a,this.updateTagsFromCache(),t&&t.room&&(await this.updateStickyRoom(t.room),this._stickyRoom&&this._stickyRoom.room&&this._stickyRoom.tag!==t.tag&&(this._stickyRoom.position=0,this.recalculateStickyRoom(this._stickyRoom.tag)))}getTagsForRoom(e){const t=[],a=Object(m.b)(e.getMyMembership());return a===m.a.Invite?t.push(c.a.Invite):a===m.a.Leave?t.push(c.a.Archived):t.push(...this.getTagsOfJoinedRoom(e)),t.length||t.push(c.a.Untagged),t}getTagsOfJoinedRoom(e){let t=Object.keys(e.tags||{});return 0===t.length&&o.a.shared().getUserIdForRoomId(e.roomId)&&(t=[c.a.DM]),t}updateTagsFromCache(){const e={},t=Object.keys(this.cachedRooms);for(const a of t){const t=this.cachedRooms[a];for(const n of t)e[n.roomId]||(e[n.roomId]=[]),e[n.roomId].push(a)}this.roomIdsToTags=e}async generateFreshTags(e){if(!this.algorithms)throw new Error("Not ready: no algorithms to determine tags from");for(const t of Object.keys(e)){const a=this.algorithms[t];if(!a)throw new Error("No algorithm for "+t);await a.setRooms(e[t]),e[t]=a.orderedRooms}}async handleRoomUpdate(e,t){if(R.b.getValue("advancedRoomListLogging")&&console.log(`Handle room update for ${e.roomId} called with cause ${t}`),!this.algorithms)throw new Error("Not ready: no algorithms to determine tags from");const a=this._stickyRoom&&this._stickyRoom.room&&this._stickyRoom.room.roomId===e.roomId;if(t===c.c.NewRoom){const n=this._lastStickyRoom&&this._lastStickyRoom.room===e,s=this.roomIdsToTags[e.roomId],i=s&&s.length>0;i&&!n&&(console.warn(e.roomId+" is reportedly new but is already known - assuming TagChange instead"),t=c.c.PossibleTagChange);let o=this.rooms.includes(e);if(i&&!o&&(console.warn(e.roomId+" might be a reference change - attempting to update reference"),this.rooms=this.rooms.map(t=>t.roomId===e.roomId?e:t),o=this.rooms.includes(e),o||console.warn(e.roomId+" is still not referenced. It may be sticky.")),i&&!o&&!a)throw new Error(e.roomId+" is missing from room array but is known - trying to find duplicate");i&&a&&(this._stickyRoom.room=e),t!==c.c.NewRoom||a||o||this.rooms.push(e)}let n=!1;if(t===c.c.PossibleTagChange){const s=this.roomIdsToTags[e.roomId]||[],i=this.getTagsForRoom(e),o=Object(l.a)(s,i);if(o.removed.length>0||o.added.length>0){for(const t of o.removed){R.b.getValue("advancedRoomListLogging")&&console.log(`Removing ${e.roomId} from ${t}`);const a=this.algorithms[t];if(!a)throw new Error("No algorithm for "+t);await a.handleRoomUpdate(e,c.c.RoomRemoved),this._cachedRooms[t]=a.orderedRooms,this.recalculateFilteredRoomsForTag(t),this.recalculateStickyRoom(t)}for(const t of o.added){R.b.getValue("advancedRoomListLogging")&&console.log(`Adding ${e.roomId} to ${t}`);const a=this.algorithms[t];if(!a)throw new Error("No algorithm for "+t);await a.handleRoomUpdate(e,c.c.NewRoom),this._cachedRooms[t]=a.orderedRooms}this.roomIdsToTags[e.roomId]=i,R.b.getValue("advancedRoomListLogging")&&console.log(`Changing update cause for ${e.roomId} to Timeline to sort rooms`),t=c.c.Timeline,n=!0}else R.b.getValue("advancedRoomListLogging")&&console.log(`Received no-op update for ${e.roomId} - changing to Timeline update`),t=c.c.Timeline;n&&a&&(this._lastStickyRoom?this._stickyRoom={room:e,tag:this.roomIdsToTags[e.roomId][0],position:0}:await this.setStickyRoom(e))}if(t!==c.c.NewRoom&&t!==c.c.RoomRemoved&&this.stickyRoom===e)return R.b.getValue("advancedRoomListLogging")&&console.warn(`[RoomListDebug] Received ${t} update for sticky room ${e.roomId} - ignoring`),!1;if(!this.roomIdsToTags[e.roomId]){if(T.includes(t))return R.b.getValue("advancedRoomListLogging")&&console.warn(`Skipping tag update for ${e.roomId} because we don't know about the room`),!1;R.b.getValue("advancedRoomListLogging")&&console.log(`[RoomListDebug] Updating tags for room ${e.roomId} (${e.name})`);const a=this.getTagsForRoom(e).filter(e=>!Object(i.o)(this.cachedRooms[e]));if(!a.length)throw new Error("Tags cannot be determined for "+e.roomId);this.roomIdsToTags[e.roomId]=a,R.b.getValue("advancedRoomListLogging")&&console.log(`[RoomListDebug] Updated tags for ${e.roomId}:`,a)}R.b.getValue("advancedRoomListLogging")&&console.log(`[RoomListDebug] Reached algorithmic handling for ${e.roomId} and cause ${t}`);const s=this.roomIdsToTags[e.roomId];if(!s)return console.warn(`No tags known for "${e.name}" (${e.roomId})`),!1;let o=n;for(const a of s){const n=this.algorithms[a];if(!n)throw new Error("No algorithm for "+a);await n.handleRoomUpdate(e,t),this._cachedRooms[a]=n.orderedRooms,this.recalculateFilteredRoomsForTag(a),this.recalculateStickyRoom(a),o=!0}return R.b.getValue("advancedRoomListLogging")&&console.log(`[RoomListDebug] Finished handling ${e.roomId} with cause ${t} (changed=${o})`),o}}},8473:function(e,t,a){"use strict";a.d(t,"a",(function(){return T}));var n=a(19),s=a.n(n),i=a(99),o=a(100),r=a(93),l=a(268),c=a(217);var d=a(106),m=a(97),u=a(1378),h=a(279),p=a(338);const g=e=>{switch(e){case y.SET_UP_ENCRYPTION:return Object(r.a)("Set up Secure Backup");case y.UPGRADE_ENCRYPTION:return Object(r.a)("Encryption upgrade available");case y.VERIFY_THIS_SESSION:return Object(r.a)("Verify this session")}},f=e=>{switch(e){case y.SET_UP_ENCRYPTION:case y.UPGRADE_ENCRYPTION:return"secure_backup";case y.VERIFY_THIS_SESSION:return"verification_warning"}},v=e=>{switch(e){case y.SET_UP_ENCRYPTION:return Object(r.a)("Continue");case y.UPGRADE_ENCRYPTION:return Object(r.a)("Upgrade");case y.VERIFY_THIS_SESSION:return Object(r.a)("Verify")}},b=e=>{switch(e){case y.SET_UP_ENCRYPTION:case y.UPGRADE_ENCRYPTION:return Object(r.a)("Safeguard against losing access to encrypted messages & data");case y.VERIFY_THIS_SESSION:return Object(r.a)("Other users may not trust it")}};let y;!function(e){e.SET_UP_ENCRYPTION="set_up_encryption",e.UPGRADE_ENCRYPTION="upgrade_encryption",e.VERIFY_THIS_SESSION="verify_this_session"}(y||(y={}));const E=()=>{T.sharedInstance().dismissEncryptionSetup()},_=e=>{var t;if(null!==(t=p.a.setupEncryptionNeeded)&&void 0!==t&&t.call(p.a,e))return;c.a.sharedInstance().addOrReplaceToast({key:"setupencryption",title:g(e),icon:f(e),props:{description:b(e),acceptLabel:v(e),onAccept:async()=>{if(e===y.VERIFY_THIS_SESSION)d.a.createTrackedDialog("Verify session","Verify session",u.a,{},null,!1,!0);else{const e=m.getComponent("elements.Spinner"),t=d.a.createDialog(e,null,"mx_Dialog_spinner",!1,!0);try{await Object(h.b)()}finally{t.close()}}},rejectLabel:Object(r.a)("Later"),onReject:E},component:l.a,priority:e===y.VERIFY_THIS_SESSION?95:40})},S=()=>{c.a.sharedInstance().dismissToast("setupencryption")};var C=a(115),w=a(341);function O(e){return"unverified_session_"+e}const x=async e=>{const t=i.a.get(),a=await t.getDevice(e);c.a.sharedInstance().addOrReplaceToast({key:O(e),title:Object(r.a)("New login. Was this you?"),icon:"verification_warning",props:{description:a.display_name,detail:Object(r.a)("%(deviceId)s from %(ip)s",{deviceId:e,ip:a.last_seen_ip}),acceptLabel:Object(r.a)("Check your devices"),onAccept:()=>{T.sharedInstance().dismissUnverifiedSessions([e]),o.a.dispatch({action:C.a.ViewUserSettings,initialTabId:w.c})},rejectLabel:Object(r.a)("Later"),onReject:()=>{T.sharedInstance().dismissUnverifiedSessions([e])}},component:l.a,priority:80})},R=e=>{c.a.sharedInstance().dismissToast(O(e))};var k=a(419),I=a(1379);class T{constructor(){s()(this,"dispatcherRef",void 0),s()(this,"dismissed",new Set),s()(this,"dismissedThisDeviceToast",!1),s()(this,"keyBackupInfo",null),s()(this,"keyBackupFetchedAt",null),s()(this,"ourDeviceIdsAtStart",null),s()(this,"displayingToastsForDeviceIds",new Set),s()(this,"_onWillUpdateDevices",async(e,t)=>{if(t)return;const a=i.a.get().getUserId();e.includes(a)&&this._ensureDeviceIdsAtStartPopulated()}),s()(this,"_onDevicesUpdated",e=>{e.includes(i.a.get().getUserId())&&this._recheck()}),s()(this,"_onDeviceVerificationChanged",e=>{e===i.a.get().getUserId()&&this._recheck()}),s()(this,"_onUserTrustStatusChanged",e=>{e===i.a.get().getUserId()&&this._recheck()}),s()(this,"_onCrossSingingKeysChanged",()=>{this._recheck()}),s()(this,"_onAccountData",e=>{(e.getType().startsWith("m.secret_storage.")||e.getType().startsWith("m.cross_signing."))&&this._recheck()}),s()(this,"_onSync",(e,t)=>{"PREPARED"===e&&null===t&&this._recheck()}),s()(this,"_onRoomStateEvents",e=>{"m.room.encryption"===e.getType()&&this._recheck()}),s()(this,"_onAction",e=>{let{action:t}=e;"on_logged_in"===t&&this._recheck()})}static sharedInstance(){return window.mxDeviceListener||(window.mxDeviceListener=new T),window.mxDeviceListener}start(){i.a.get().on("crypto.willUpdateDevices",this._onWillUpdateDevices),i.a.get().on("crypto.devicesUpdated",this._onDevicesUpdated),i.a.get().on("deviceVerificationChanged",this._onDeviceVerificationChanged),i.a.get().on("userTrustStatusChanged",this._onUserTrustStatusChanged),i.a.get().on("crossSigning.keysChanged",this._onCrossSingingKeysChanged),i.a.get().on("accountData",this._onAccountData),i.a.get().on("sync",this._onSync),i.a.get().on("RoomState.events",this._onRoomStateEvents),this.dispatcherRef=o.a.register(this._onAction),this._recheck()}stop(){i.a.get()&&(i.a.get().removeListener("crypto.willUpdateDevices",this._onWillUpdateDevices),i.a.get().removeListener("crypto.devicesUpdated",this._onDevicesUpdated),i.a.get().removeListener("deviceVerificationChanged",this._onDeviceVerificationChanged),i.a.get().removeListener("userTrustStatusChanged",this._onUserTrustStatusChanged),i.a.get().removeListener("crossSigning.keysChanged",this._onCrossSingingKeysChanged),i.a.get().removeListener("accountData",this._onAccountData),i.a.get().removeListener("sync",this._onSync),i.a.get().removeListener("RoomState.events",this._onRoomStateEvents)),this.dispatcherRef&&(o.a.unregister(this.dispatcherRef),this.dispatcherRef=null),this.dismissed.clear(),this.dismissedThisDeviceToast=!1,this.keyBackupInfo=null,this.keyBackupFetchedAt=null,this.ourDeviceIdsAtStart=null,this.displayingToastsForDeviceIds=new Set}async dismissUnverifiedSessions(e){for(const t of e)this.dismissed.add(t);this._recheck()}dismissEncryptionSetup(){this.dismissedThisDeviceToast=!0,this._recheck()}_ensureDeviceIdsAtStartPopulated(){if(null===this.ourDeviceIdsAtStart){const e=i.a.get();this.ourDeviceIdsAtStart=new Set(e.getStoredDevicesForUser(e.getUserId()).map(e=>e.deviceId))}}async _getKeyBackupInfo(){const e=(new Date).getTime();return(!this.keyBackupInfo||this.keyBackupFetchedAt<e-3e5)&&(this.keyBackupInfo=await i.a.get().getKeyBackupVersion(),this.keyBackupFetchedAt=e),this.keyBackupInfo}shouldShowSetupEncryptionToast(){if(Object(h.d)())return!1;const e=i.a.get();return e&&e.getRooms().some(t=>e.isRoomEncrypted(t.roomId))}async _recheck(){const e=i.a.get();if(!await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing"))return;if(!e.isCryptoEnabled())return;if(!e.isInitialSyncComplete())return;const t=await e.isCrossSigningReady(),a=await e.isSecretStorageReady(),n=t&&a;if(this.dismissedThisDeviceToast||n)S();else if(this.shouldShowSetupEncryptionToast())if(await e.downloadKeys([e.getUserId()]),!e.getCrossSigningId()&&e.getStoredCrossSigningForUser(e.getUserId()));else{await this._getKeyBackupInfo()?_(y.UPGRADE_ENCRYPTION):(await e.waitForClientWellKnown(),Object(k.d)()&&Object(I.b)()?(S(),Object(h.b)()):_(y.SET_UP_ENCRYPTION))}this._ensureDeviceIdsAtStartPopulated();const s=new Set,d=new Set;if(t){const t=e.getStoredDevicesForUser(e.getUserId());for(const a of t){if(a.deviceId===e.deviceId)continue;(await e.checkDeviceTrust(e.getUserId(),a.deviceId)).isCrossSigningVerified()||this.dismissed.has(a.deviceId)||(this.ourDeviceIdsAtStart.has(a.deviceId)?s.add(a.deviceId):d.add(a.deviceId))}}var m;s.size>0?(m=s,c.a.sharedInstance().addOrReplaceToast({key:"reviewsessions",title:Object(r.a)("You have unverified logins"),icon:"verification_warning",props:{description:Object(r.a)("Review to ensure your account is safe"),acceptLabel:Object(r.a)("Review"),onAccept:()=>{T.sharedInstance().dismissUnverifiedSessions(m),o.a.dispatch({action:"view_user_info",userId:i.a.get().getUserId()})},rejectLabel:Object(r.a)("Later"),onReject:()=>{T.sharedInstance().dismissUnverifiedSessions(m)}},component:l.a,priority:50})):c.a.sharedInstance().dismissToast("reviewsessions");for(const e of d)x(e);for(const e of this.displayingToastsForDeviceIds)d.has(e)||R(e);this.displayingToastsForDeviceIds=d}}},8474:function(e,t,a){"use strict";function n(e){this._timeline=[e],this._ourEventIndex=0,this._paginateTokens={b:null,f:null},this._paginateRequests={b:null,f:null}}function s(e,t){this.rank=e,this.context=t}a.d(t,"a",(function(){return s})),n.prototype.getEvent=function(){return this._timeline[this._ourEventIndex]},n.prototype.getTimeline=function(){return this._timeline},n.prototype.getOurEventIndex=function(){return this._ourEventIndex},n.prototype.getPaginateToken=function(e){return this._paginateTokens[e?"b":"f"]},n.prototype.setPaginateToken=function(e,t){this._paginateTokens[t?"b":"f"]=e},n.prototype.addEvents=function(e,t){t?(this._timeline=e.concat(this._timeline),this._ourEventIndex+=e.length):this._timeline=this._timeline.concat(e)},s.fromJson=function(e,t){const a=e.context||{},i=a.events_before||[],o=a.events_after||[],r=new n(t(e.result));return r.setPaginateToken(a.start,!0),r.addEvents(i.map(t),!0),r.addEvents(o.map(t),!1),r.setPaginateToken(a.end,!1),new s(e.rank,r)}},8476:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(19),s=a.n(n),i=a(277),o=a(477),r=a(8),l=a(192),c=a(185),d=a(744);class m extends r.EventEmitter{constructor(e){super(),this.community=e,s()(this,"roomIds",new Set),s()(this,"userIds",new Set),s()(this,"onStoreUpdate",async()=>{const e=this.roomIds;this.roomIds=new Set((await l.a.getGroupRooms(this.community.groupId)).map(e=>e.roomId));const t=this.userIds;this.userIds=new Set((await l.a.getGroupMembers(this.community.groupId)).map(e=>e.userId)),(Object(d.a)(e,this.roomIds)||Object(d.a)(t,this.userIds))&&this.emit(o.a)}),l.a.on("update",this.onStoreUpdate),this.onStoreUpdate()}get kind(){return o.b.Prefilter}isVisible(e){return this.roomIds.has(e.roomId)||this.userIds.has(c.a.shared().getUserIdForRoomId(e.roomId))}destroy(){l.a.off("update",this.onStoreUpdate)}}var u=a(153);class h{constructor(e){this.store=e,s()(this,"filters",new Map),s()(this,"onTagsUpdated",()=>{const e=Array.from(this.filters.keys()),t=i.a.getSelectedTags();if(Object(u.d)(e,t)){if(!this.store.matrixClient)return void console.warn("Tag update without an associated matrix client - ignoring");const a=new Map,n=t.filter(e=>e.startsWith("+"));for(const e of n){const t=this.store.matrixClient.getGroup(e);if(!t){console.warn("Group selected with no group object available: "+e);continue}let n=this.filters.get(e);n||(n=new m(t)),a.set(e,n)}const s=Object(u.a)(e,t);for(const e of s.added){const t=a.get(e);t&&this.store.addFilter(t)}for(const e of s.removed){const t=this.filters.get(e);t&&(this.store.removeFilter(t),t.destroy())}this.filters=a}}),i.a.addListener(this.onTagsUpdated)}}},848:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return r}));var n=a(19),s=a.n(n),i=a(1428);let o;!function(e){e[e.Pending=0]="Pending",e[e.Success=1]="Success",e[e.Error=2]="Error"}(o||(o={}));class r extends i.a{constructor(e,t){super(),this.auditName=e,this.runFn=t,s()(this,"_status",o.Pending),s()(this,"didFail",!1),s()(this,"startTime",new Date)}get didPreviouslyFail(){return this.didFail}get status(){return this._status}run(){if(this.status===o.Success)throw new Error("Cannot re-run a successful echo transaction");this.setStatus(o.Pending),this.runFn().then(()=>this.setStatus(o.Success)).catch(()=>this.setStatus(o.Error))}cancel(){this.setStatus(o.Success)}setStatus(e){this._status=e,e===o.Error?this.didFail=!0:e===o.Success&&(this.didFail=!1),this.notifyCondition(e)}}},849:function(e,t,a){"use strict";function n(){window.TouchEvent||(window.TouchEvent=class extends UIEvent{get altKey(){return!1}get changedTouches(){return[]}get ctrlKey(){return!1}get metaKey(){return!1}get shiftKey(){return!1}get targetTouches(){return[]}get touches(){return[]}get rotation(){return 0}get scale(){return 0}constructor(e,t){super(e,t)}})}a.d(t,"a",(function(){return n}))},850:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return N}));var n,s=a(19),i=a.n(s),o=a(88),r=a(1),l=a(102),c=a.n(l),d=a(194),m=a(93),u=a(108),h=a(1435),p=a(127),g=a(174),f=a(324),v=a(161),b=a(100),y=a(269),E=a(135),_=a(131),S=a(370),C=a(849),w=a(184),O=a(637),x=a(153),R=a(166),k=a(202),I=a(220),T=a(94),P=a(115);Object(C.a)();let N=Object(T.a)("views.rooms.MenuSublist")(n=class t extends o.Component{constructor(t){super(t),i()(this,"headerButton",Object(o.createRef)()),i()(this,"sublistRef",Object(o.createRef)()),i()(this,"tilesRef",Object(o.createRef)()),i()(this,"dispatcherRef",void 0),i()(this,"layout",void 0),i()(this,"heightAtStart",void 0),i()(this,"isBeingFiltered",void 0),i()(this,"notificationState",void 0),i()(this,"onListsUpdated",()=>{const e={};if(this.props.extraTiles){const t=g.b.instance.getFirstNameFilterCondition();t?e.filteredExtraTiles=this.props.extraTiles.filter(e=>t.matches(Object(r.q)(e.props.displayName||""))):this.state.filteredExtraTiles&&(e.filteredExtraTiles=null)}const t=this.state.rooms,a=Object(x.b)(g.b.instance.orderedLists[this.props.tagId]||[]);Object(x.e)(t,a)&&(e.rooms=a);const n=!!g.b.instance.getFirstNameFilterCondition();n!==this.isBeingFiltered&&(this.isBeingFiltered=n,e.isExpanded=!!n||!this.layout.isCollapsed),Object.keys(e).length>0&&this.setState(e)}),i()(this,"onViewPage",()=>{var e;const t=null===(e=g.b.instance.getFirstNameFilterCondition())||void 0===e?void 0:e.search;b.a.dispatch({action:P.a.ViewRoomDirectory,initialText:t}),this.context.router.history.push("/HomePage")}),i()(this,"onAction",t=>{"view_room"===t.action&&t.show_room_tile&&this.state.rooms?e(()=>{const e=this.state.rooms.findIndex(e=>e.roomId===t.room_id);!this.state.isExpanded&&e>-1&&this.toggleCollapsed(),e>=this.numVisibleTiles&&(this.layout.visibleTiles=this.layout.tilesWithPadding(e+1,32),this.forceUpdate())}):"view_room_1"===t.action&&t.show_room_tile&&this.state.rooms&&this.onViewPage()}),i()(this,"onAddRoom",e=>{e.stopPropagation(),this.props.onAddRoom&&this.props.onAddRoom()}),i()(this,"onResize",(e,t,a,n)=>{const s=this.heightAtStart+n.height;this.applyHeightChange(s),this.setState({height:s})}),i()(this,"onResizeStart",()=>{this.heightAtStart=this.state.height,this.setState({isResizing:!0})}),i()(this,"onResizeStop",(e,t,a,n)=>{const s=this.heightAtStart+n.height;this.applyHeightChange(s),this.setState({isResizing:!1,height:s})}),i()(this,"onShowAllClick",()=>{const e=this.numVisibleTiles,t=this.layout.tilesToPixelsWithPadding(this.numTiles,this.padding);this.applyHeightChange(t),this.setState({height:t},()=>{this.focusRoomTile(e)})}),i()(this,"onShowLessClick",()=>{const e=this.layout.tilesToPixelsWithPadding(this.layout.defaultVisibleTiles,this.padding);this.applyHeightChange(e),this.setState({height:e})}),i()(this,"focusRoomTile",e=>{if(!this.sublistRef.current)return;const t=this.sublistRef.current.querySelectorAll(".mx_RoomTile"),a=t&&t[e];a&&a.focus()}),i()(this,"onOpenMenuClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})}),i()(this,"onContextMenu",e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{left:e.clientX,top:e.clientY,height:0}})}),i()(this,"onAddRoomContextMenu",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({addRoomContextMenuPosition:t.getBoundingClientRect()})}),i()(this,"onCloseMenu",()=>{this.setState({contextMenuPosition:null})}),i()(this,"onCloseAddRoomMenu",()=>{this.setState({addRoomContextMenuPosition:null})}),i()(this,"onUnreadFirstChanged",async()=>{const e=g.b.instance.getListOrder(this.props.tagId)===f.a.Importance?f.a.Natural:f.a.Importance;await g.b.instance.setListOrder(this.props.tagId,e),this.forceUpdate()}),i()(this,"onTagSortChanged",async e=>{await g.b.instance.setTagSorting(this.props.tagId,e)}),i()(this,"onMessagePreviewChanged",()=>{this.layout.showPreviews=!this.layout.showPreviews,this.forceUpdate()}),i()(this,"onBadgeClick",e=>{let t;e.preventDefault(),e.stopPropagation(),t=this.props.tagId===v.a.Invite?this.state.rooms&&this.state.rooms[0]:g.b.instance.unfilteredLists[this.props.tagId].find(e=>{const t=this.notificationState.getForRoom(e);return t.count>0&&t.color===this.notificationState.color}),t&&b.a.dispatch({action:"view_room",room_id:t.roomId,show_room_tile:!0})}),i()(this,"onHeaderClick",()=>{const t=this.headerButton.current.parentElement,a=t.parentElement.parentElement,n=a.parentElement.parentElement,s=n.scrollTop<=32,i=n.scrollTop>=n.scrollHeight-n.offsetHeight,o=t.classList.contains("mx_RoomSublist_headerContainer_stickyTop"),r=t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom");if(r&&!i||o&&!s)a.scrollIntoView({behavior:"smooth"});else{const t=this.state.isExpanded;this.toggleCollapsed(),!t&&r&&e(()=>{a.scrollIntoView({behavior:"smooth"})})}}),i()(this,"toggleCollapsed",()=>{this.layout.isCollapsed=this.state.isExpanded,this.setState({isExpanded:!this.layout.isCollapsed}),this.props.onListCollapse&&this.props.onListCollapse(!this.layout.isCollapsed)}),i()(this,"onHeaderKeyDown",e=>{switch(Object(I.f)().getRoomListAction(e)){case I.e.CollapseSection:e.stopPropagation(),this.state.isExpanded&&this.toggleCollapsed();break;case I.e.ExpandSection:if(e.stopPropagation(),this.state.isExpanded){if(this.sublistRef.current){const e=this.sublistRef.current.querySelector(".mx_RoomTile");e&&e.focus()}}else this.toggleCollapsed()}}),i()(this,"onKeyDown",e=>{switch(e.key){case _.a.ARROW_LEFT:e.stopPropagation(),this.headerButton.current.focus();break;case _.a.ARROW_RIGHT:e.stopPropagation()}}),this.layout=O.a.instance.getLayoutFor(this.props.tagId),this.heightAtStart=0,this.isBeingFiltered=!!g.b.instance.getFirstNameFilterCondition(),this.notificationState=w.a.instance.getListState(this.props.tagId),this.state={contextMenuPosition:null,addRoomContextMenuPosition:null,isResizing:!1,isExpanded:this.isBeingFiltered?this.isBeingFiltered:!this.layout.isCollapsed,height:0,rooms:Object(x.b)(g.b.instance.orderedLists[this.props.tagId]||[])},this.state=Object.assign(this.state,{height:this.calculateInitialHeight()})}calculateInitialHeight(){const e=Math.max(Math.floor(this.layout.visibleTiles),this.layout.minVisibleTiles),t=Math.min(this.numTiles,e);return this.layout.tilesToPixelsWithPadding(t,this.padding)}get padding(){let e=4;const t=this.numTiles>this.numVisibleTiles,a=this.numTiles>this.layout.defaultVisibleTiles;return(t||a)&&(e+=28),e}get extraTiles(){return this.state.filteredExtraTiles?this.state.filteredExtraTiles:this.props.extraTiles?this.props.extraTiles:null}get numTiles(){return t.calcNumTiles(this.state.rooms,this.extraTiles)}static calcNumTiles(e,t){return(e||[]).length+(t||[]).length}get numVisibleTiles(){const e=Math.ceil(this.layout.visibleTiles);return Math.min(e,this.numTiles)}componentDidUpdate(e,a){const n=a.filteredExtraTiles||e.extraTiles;t.calcNumTiles(a.rooms,n)!==this.numTiles&&this.setState({height:this.calculateInitialHeight()})}shouldComponentUpdate(e,a){if(Object(R.c)(this.props,e))return!0;const n=Object(R.b)(this.state,["rooms"]),s=Object(R.b)(a,["rooms"]);if(Object(R.c)(n,s))return!0;const i=this.props.extraTiles||[],o=a.filteredExtraTiles||e.extraTiles||[];if(i.length>0||o.length>0)return!0;if(t.calcNumTiles(a.rooms,o)!==this.numTiles)return!0;if(!a.isExpanded)return!1;if(this.state.rooms.length!==a.rooms.length)return!0;const r=this.state.rooms.slice(0,this.numVisibleTiles),l=a.rooms.slice(0,this.numVisibleTiles);return!!Object(x.e)(r,l)}componentDidMount(){var e;this.dispatcherRef=b.a.register(this.onAction),g.b.instance.on(g.a,this.onListsUpdated),null===(e=this.tilesRef.current)||void 0===e||e.addEventListener("scroll",this.onScrollPrevent,{passive:!0})}componentWillUnmount(){var e;b.a.unregister(this.dispatcherRef),g.b.instance.off(g.a,this.onListsUpdated),null===(e=this.tilesRef.current)||void 0===e||e.removeEventListener("scroll",this.onScrollPrevent)}applyHeightChange(e){const t=Math.ceil(this.layout.pixelsToTiles(e-this.padding));this.layout.visibleTiles=Math.min(this.numTiles,t)}renderVisibleTiles(){if(!this.state.isExpanded)return[];const e=[];return e.push(o.createElement(h.a,{title:"List Patient",path:"#/Patient",showMessagePreview:this.layout.showPreviews,isMinimized:this.props.isMinimized,tag:this.props.tagId})),e.push(o.createElement(h.a,{title:"List Page",path:"#/listpage",showMessagePreview:this.layout.showPreviews,isMinimized:this.props.isMinimized,tag:this.props.tagId})),e}renderMenu(){let e=null;if(this.state.contextMenuPosition){const t=g.b.instance.getTagSorting(this.props.tagId)===f.b.Alphabetic,a=g.b.instance.getListOrder(this.props.tagId)===f.a.Importance;let n=null;this.props.tagId!==v.a.Invite&&(n=o.createElement(o.Fragment,null,o.createElement("hr",null),o.createElement("div",null,o.createElement("div",{className:"mx_RoomSublist_contextMenu_title"},Object(m.a)("Appearance")),o.createElement(p.i,{onClose:this.onCloseMenu,onChange:this.onUnreadFirstChanged,checked:a},Object(m.a)("Show rooms with unread messages first")),o.createElement(p.i,{onClose:this.onCloseMenu,onChange:this.onMessagePreviewChanged,checked:this.layout.showPreviews},Object(m.a)("Show previews of messages"))))),e=o.createElement(p.b,{chevronFace:p.a.None,left:this.state.contextMenuPosition.left,top:this.state.contextMenuPosition.top+this.state.contextMenuPosition.height,onFinished:this.onCloseMenu},o.createElement("div",{className:"mx_RoomSublist_contextMenu"},o.createElement("div",null,o.createElement("div",{className:"mx_RoomSublist_contextMenu_title"},Object(m.a)("Sort by")),o.createElement(p.j,{onClose:this.onCloseMenu,onChange:()=>this.onTagSortChanged(f.b.Recent),checked:!t,name:`mx_${this.props.tagId}_sortBy`},Object(m.a)("Activity")),o.createElement(p.j,{onClose:this.onCloseMenu,onChange:()=>this.onTagSortChanged(f.b.Alphabetic),checked:t,name:`mx_${this.props.tagId}_sortBy`},Object(m.a)("A-Z"))),n))}else this.state.addRoomContextMenuPosition&&(e=o.createElement(k.e,{chevronFace:p.a.None,left:this.state.addRoomContextMenuPosition.left-7,top:this.state.addRoomContextMenuPosition.top+this.state.addRoomContextMenuPosition.height,onFinished:this.onCloseAddRoomMenu,compact:!0},this.props.addRoomContextMenu(this.onCloseAddRoomMenu)));return o.createElement(o.Fragment,null,o.createElement(p.d,{className:"mx_RoomSublist_menuButton",onClick:this.onOpenMenuClick,title:Object(m.a)("List options"),isExpanded:!!this.state.contextMenuPosition}),e)}renderHeader(){return o.createElement(d.d,{inputRef:this.headerButton},e=>{let{onFocus:t,isActive:a,ref:n}=e;const s=a?0:-1;let i=Object(m.a)("Jump to first unread room.");this.props.tagId===v.a.Invite&&(i=Object(m.a)("Jump to first invite."));const r=o.createElement(y.a,{forceCount:!0,notification:this.notificationState,onClick:this.onBadgeClick,tabIndex:s,"aria-label":i});let l=null;this.props.onAddRoom?l=o.createElement(E.a,{tabIndex:s,onClick:this.onAddRoom,className:"mx_RoomSublist_auxButton",tooltipClassName:"mx_RoomSublist_addRoomTooltip","aria-label":this.props.addRoomLabel||Object(m.a)("Add room"),title:this.props.addRoomLabel}):this.props.addRoomContextMenu&&(l=o.createElement(p.d,{tabIndex:s,onClick:this.onAddRoomContextMenu,className:"mx_RoomSublist_auxButton",tooltipClassName:"mx_RoomSublist_addRoomTooltip","aria-label":this.props.addRoomLabel||Object(m.a)("Add room"),title:this.props.addRoomLabel,isExpanded:!!this.state.addRoomContextMenuPosition}));const d=c()({mx_RoomSublist_collapseBtn:!0,mx_RoomSublist_collapseBtn_collapsed:!this.state.isExpanded}),h=c()({mx_RoomSublist_headerContainer:!0,mx_RoomSublist_headerContainer_withAux:!!l}),g=o.createElement("div",{className:"mx_RoomSublist_badgeContainer"},r);let f=u.a;return this.props.isMinimized&&(f=E.a),o.createElement("div",{className:h,onKeyDown:this.onHeaderKeyDown,onFocus:t,"aria-label":this.props.label},o.createElement("div",{className:"mx_RoomSublist_stickable"},o.createElement(f,{onFocus:t,inputRef:n,tabIndex:s,className:"mx_RoomSublist_headerText",role:"treeitem","aria-expanded":this.state.isExpanded,"aria-level":1,onClick:this.onHeaderClick,onContextMenu:this.onContextMenu,title:this.props.isMinimized?this.props.label:void 0},o.createElement("span",{className:d}),o.createElement("span",null,this.props.label)),this.renderMenu(),this.props.isMinimized?null:g,this.props.isMinimized?null:l),this.props.isMinimized?g:null,this.props.isMinimized?l:null)})}onScrollPrevent(e){e.target.scrollTop=0}render(){var e;const t=this.renderVisibleTiles(),a=c()({mx_RoomSublist:!0,mx_RoomSublist_hasMenuOpen:!!this.state.contextMenuPosition,mx_RoomSublist_minimized:this.props.isMinimized,mx_RoomSublist_hidden:!(this.state.rooms.length||null!==(e=this.props.extraTiles)&&void 0!==e&&e.length||!0===this.props.alwaysVisible)});let n=null;if(t.length>0){const e=this.layout,a=Math.min(e.minVisibleTiles,this.numTiles),s=4+(a<this.numTiles?28:0),i=e.tilesToPixelsWithPadding(a,s),r=e.tilesToPixelsWithPadding(this.numTiles,this.padding),l=c()({mx_RoomSublist_showNButton:!0});let u=null;if(r>this.state.height){const e=this.state.height-4-28,t=Math.floor(e/this.layout.tileHeight),a=this.numTiles-t,n=Object(m.a)("Show %(count)s more",{count:a});let s=o.createElement("span",{className:"mx_RoomSublist_showNButtonText"},n);this.props.isMinimized&&(s=null),u=o.createElement(d.a,{role:"treeitem",onClick:this.onShowAllClick,className:l,"aria-label":n},o.createElement("span",{className:"mx_RoomSublist_showMoreButtonChevron mx_RoomSublist_showNButtonChevron"}),s)}else if(this.numTiles>this.layout.defaultVisibleTiles){const e=Object(m.a)("Show less");let t=o.createElement("span",{className:"mx_RoomSublist_showNButtonText"},e);this.props.isMinimized&&(t=null),u=o.createElement(d.a,{role:"treeitem",onClick:this.onShowLessClick,className:l,"aria-label":e},o.createElement("span",{className:"mx_RoomSublist_showLessButtonChevron mx_RoomSublist_showNButtonChevron"}),t)}const h={bottom:!0,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1};e.visibleTiles>=this.numTiles&&this.numTiles<=e.minVisibleTiles&&(h.bottom=!1);const p=c()({mx_RoomSublist_resizerHandles:!0,mx_RoomSublist_resizerHandles_showNButton:!!u});n=o.createElement(o.Fragment,null,o.createElement(S.Resizable,{size:{height:this.state.height},minHeight:i,maxHeight:r,onResizeStart:this.onResizeStart,onResizeStop:this.onResizeStop,onResize:this.onResize,handleWrapperClass:p,handleClasses:{bottom:"mx_RoomSublist_resizerHandle"},className:"mx_RoomSublist_resizeBox",enable:h},o.createElement("div",{className:"mx_RoomSublist_tiles",ref:this.tilesRef},t),u))}else this.props.showSkeleton&&this.state.isExpanded&&(n=o.createElement("div",{className:"mx_RoomSublist_skeletonUI"}));return o.createElement("div",{ref:this.sublistRef,className:a,role:"group","aria-label":this.props.label,onKeyDown:this.onKeyDown},this.renderHeader(),n)}})||n}).call(this,a(212).setImmediate)},851:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return b}));var n,s=a(19),i=a.n(s),o=a(88),r=a(102),l=a.n(r),c=a(100),d=a(93),m=a(108),u=a(115),h=a(174),p=a(1425),g=a(220),f=a(94),v=a(175);let b=Object(f.a)("structures.RoomSearch")(n=class extends o.PureComponent{constructor(t){super(t),i()(this,"dispatcherRef",void 0),i()(this,"inputRef",Object(o.createRef)()),i()(this,"searchFilter",new p.a),i()(this,"onSpaces",e=>{this.setState({inSpaces:e.length>0})}),i()(this,"onAction",e=>{"view_room"===e.action&&e.clear_search?this.clearInput():"focus_room_filter"===e.action&&this.inputRef.current&&this.inputRef.current.focus()}),i()(this,"clearInput",()=>{this.inputRef.current&&(this.inputRef.current.value="",this.onChange())}),i()(this,"openSearch",()=>{c.a.dispatch({action:"show_left_panel"}),c.a.dispatch({action:"focus_room_filter"})}),i()(this,"onChange",()=>{this.inputRef.current&&this.setState({query:this.inputRef.current.value})}),i()(this,"onFocus",e=>{this.setState({focused:!0}),e.target.select()}),i()(this,"onBlur",e=>{this.setState({focused:!1})}),i()(this,"onKeyDown",t=>{switch(Object(g.f)().getRoomListAction(t)){case g.e.ClearSearch:this.clearInput(),c.a.fire(u.a.FocusComposer);break;case g.e.NextRoom:case g.e.PrevRoom:this.props.onKeyDown(t);break;case g.e.SelectRoom:this.props.onSelectRoom()&&e(()=>{this.clearInput()});break}}),this.state={query:"",focused:!1,inSpaces:!1},this.dispatcherRef=c.a.register(this.onAction),v.e.instance.on(v.c,this.clearInput),v.e.instance.on(v.d,this.onSpaces)}componentDidUpdate(e,t){if(t.query!==this.state.query){const e=!!this.searchFilter.search.trim(),t=!!this.state.query.trim();this.searchFilter.search=this.state.query,!e&&t?h.b.instance.addFilter(this.searchFilter):e&&!t&&h.b.instance.removeFilter(this.searchFilter)}}componentWillUnmount(){c.a.unregister(this.dispatcherRef),v.e.instance.off(v.c,this.clearInput),v.e.instance.off(v.d,this.onSpaces)}render(){const e=l()({mx_RoomSearch:!0,mx_RoomSearch_hasQuery:this.state.query,mx_RoomSearch_focused:this.state.focused,mx_RoomSearch_minimized:this.props.isMinimized}),t=l()({mx_RoomSearch_input:!0,mx_RoomSearch_inputExpanded:this.state.query||this.state.focused});let a=Object(d.a)("Filter");this.state.inSpaces&&(a=Object(d.a)("Filter all spaces"));let n=o.createElement("div",{className:"mx_RoomSearch_icon"}),s=o.createElement("input",{type:"text",ref:this.inputRef,className:t,value:this.state.query,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,onKeyDown:this.onKeyDown,placeholder:a,autoComplete:"off"}),i=o.createElement(m.a,{tabIndex:-1,title:Object(d.a)("Clear filter"),className:"mx_RoomSearch_clearButton",onClick:this.clearInput});return this.props.isMinimized&&(n=o.createElement(m.a,{title:Object(d.a)("Filter rooms and people"),className:"mx_RoomSearch_icon mx_RoomSearch_minimizedHandle",onClick:this.openSearch}),s=null,i=null),o.createElement("div",{className:e},n,s,i)}})||n}).call(this,a(212).setImmediate)},852:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(88),s=a(103);const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const[i,o]=Object(n.useState)(s.b.getValue(e,t,a));return Object(n.useEffect)(()=>{const n=s.b.watchSetting(e,t,()=>{o(s.b.getValue(e,t,a))});return()=>{s.b.unwatchSetting(n)}},[e,t,a]),i}},853:function(e,t,a){"use strict";a.d(t,"a",(function(){return R}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(102),d=a.n(c),m=a(93),u=a(501),h=a(99),p=a(97),g=a(100),f=a(108),v=a(215),b=a(597),y=a(283),E=a(103),_=a(127),S=a(247),C=a(135),w=a(115),O=a(420),x=a(94);let R=Object(x.a)("views.rooms.Stickerpicker")((s=class e extends l.a.PureComponent{constructor(e){super(e),this._onShowStickersClick=this._onShowStickersClick.bind(this),this._onHideStickersClick=this._onHideStickersClick.bind(this),this._launchManageIntegrations=this._launchManageIntegrations.bind(this),this._removeStickerpickerWidgets=this._removeStickerpickerWidgets.bind(this),this._updateWidget=this._updateWidget.bind(this),this._onWidgetAction=this._onWidgetAction.bind(this),this._onResize=this._onResize.bind(this),this._onFinished=this._onFinished.bind(this),this.popoverWidth=300,this.popoverHeight=300,this.scalarClient=null,this.state={showStickers:!1,imError:null,stickerpickerX:null,stickerpickerY:null,stickerpickerWidget:null,widgetId:null}}_acquireScalarClient(){return this.scalarClient?Promise.resolve(this.scalarClient):y.a.sharedInstance().hasManager()?(this.scalarClient=y.a.sharedInstance().getPrimaryManager().getScalarClient(),this.scalarClient.connect().then(()=>(this.forceUpdate(),this.scalarClient)).catch(e=>{this._imError(Object(m.b)("Failed to connect to integration manager"),e)})):void y.a.sharedInstance().openNoManagerDialog()}async _removeStickerpickerWidgets(){const e=await this._acquireScalarClient();console.log("Removing Stickerpicker widgets"),this.state.widgetId?e?e.disableWidgetAssets(S.a.STICKERPICKER,this.state.widgetId).then(()=>{console.log("Assets disabled")}).catch(e=>{console.error("Failed to disable assets")}):console.error("Cannot disable assets: no scalar client"):console.warn("No widget ID specified, not disabling assets"),this.setState({showStickers:!1}),v.a.removeStickerpickerWidgets().then(()=>{this.forceUpdate()}).catch(e=>{console.error("Failed to remove sticker picker widget",e)})}componentDidMount(){window.addEventListener("resize",this._onResize),this.dispatcherRef=g.a.register(this._onWidgetAction),h.a.get().on("accountData",this._updateWidget),this._updateWidget()}componentWillUnmount(){const e=h.a.get();e&&e.removeListener("accountData",this._updateWidget),window.removeEventListener("resize",this._onResize),this.dispatcherRef&&g.a.unregister(this.dispatcherRef)}componentDidUpdate(e,t){this._sendVisibilityToWidget(this.state.showStickers)}_imError(e,t){console.error(e,t),this.setState({showStickers:!1,imError:Object(m.a)(e)})}_updateWidget(){const t=v.a.getStickerpickerWidgets()[0];if(!t)return e.currentWidget=null,void this.setState({stickerpickerWidget:null,widgetId:null});const a=e.currentWidget;let n=null;a&&a.content&&a.content.url&&(n=a.content.url);let s=null;t&&t.content&&t.content.url&&(s=t.content.url),s!==n&&b.a.destroyElement("stickerPicker"),e.currentWidget=t,this.setState({stickerpickerWidget:t,widgetId:t?t.id:null})}_onWidgetAction(e){switch(e.action){case"user_widget_updated":this.forceUpdate();break;case"stickerpicker_close":this.setState({showStickers:!1});break;case w.a.AfterRightPanelPhaseChange:case"show_left_panel":case"hide_left_panel":this.setState({showStickers:!1})}}_defaultStickerpickerContent(){return l.a.createElement(f.a,{onClick:this._launchManageIntegrations,className:"mx_Stickers_contentPlaceholder"},l.a.createElement("p",null,Object(m.a)("You don't currently have any stickerpacks enabled")),l.a.createElement("p",{className:"mx_Stickers_addLink"},Object(m.a)("Add some now")),l.a.createElement("img",{src:a(2746),alt:""}))}_errorStickerpickerContent(){return l.a.createElement("div",{style:{"text-align":"center"},className:"error"},l.a.createElement("p",null," ",this.state.imError," "))}_sendVisibilityToWidget(e){if(!this.state.stickerpickerWidget)return;const t=O.a.instance.getMessagingForId(this.state.stickerpickerWidget.id);t&&e!==this._prevSentVisibility&&(t.updateVisibility(e).catch(e=>{console.error("Error updating widget visibility: ",e)}),this._prevSentVisibility=e)}_getStickerpickerContent(){if(this.state._imError)return this._errorStickerpickerContent();const e=this.state.stickerpickerWidget;let t;const a=p.getComponent("elements.PersistedElement");if(e&&e.content&&e.content.url){e.content.name=e.name||Object(m.a)("Stickerpack");const n={id:e.id,url:e.content.url,name:e.content.name,type:e.content.type,data:e.content.data};t=l.a.createElement("div",{className:"mx_Stickers_content_container"},l.a.createElement("div",{id:"stickersContent",className:"mx_Stickers_content",style:{border:"none",height:this.popoverHeight,width:this.popoverWidth}},l.a.createElement(a,{persistKey:"stickerPicker",zIndex:3500},l.a.createElement(u.a,{app:n,room:this.props.room,fullWidth:!0,userId:h.a.get().credentials.userId,creatorUserId:e.sender||h.a.get().credentials.userId,waitForIframeLoad:!0,showMenubar:!0,onEditClick:this._launchManageIntegrations,onDeleteClick:this._removeStickerpickerWidgets,showTitle:!1,showCancel:!1,showPopout:!1,onMinimiseClick:this._onHideStickersClick,handleMinimisePointerEvents:!0,userWidget:!0}))))}else t=this._defaultStickerpickerContent();return t}_onShowStickersClick(e){if(!E.b.getValue("integrationProvisioning"))return y.a.sharedInstance().showDisabledDialog();const t=e.target.getBoundingClientRect();let a=t.right+window.pageXOffset-41;a=Math.min(a,document.body.clientWidth-312);const n=Math.max(10,2+window.pageXOffset+t.left-a),s=t.top+t.height/2+window.pageYOffset-19;this.setState({showStickers:!0,stickerPickerX:a,stickerPickerY:s,stickerPickerChevronOffset:n})}_onHideStickersClick(e){this.state.showStickers&&this.setState({showStickers:!1})}_onResize(){this.state.showStickers&&this.setState({showStickers:!1})}_onFinished(){this.state.showStickers&&this.setState({showStickers:!1})}_launchManageIntegrations(){E.b.getValue("feature_many_integration_managers")?y.a.sharedInstance().openAll(this.props.room,"type_"+S.a.STICKERPICKER.preferred,this.state.widgetId):y.a.sharedInstance().getPrimaryManager().open(this.props.room,"type_"+S.a.STICKERPICKER.preferred,this.state.widgetId)}render(){let e,t;const a=d()("mx_MessageComposer_button","mx_MessageComposer_stickers","mx_Stickers_hideStickers","mx_MessageComposer_button_highlight");if(this.state.showStickers){t=l.a.createElement(f.a,{id:"stickersButton",key:"controls_hide_stickers",className:a,onClick:this._onHideStickersClick,active:this.state.showStickers,title:Object(m.a)("Hide Stickers")});const n=p.getComponent("context_menus.GenericElementContextMenu");e=l.a.createElement(_.b,{chevronOffset:this.state.stickerPickerChevronOffset,chevronFace:"bottom",left:this.state.stickerPickerX,top:this.state.stickerPickerY,menuWidth:this.popoverWidth,menuHeight:this.popoverHeight,onFinished:this._onFinished,menuPaddingTop:0,menuPaddingLeft:0,menuPaddingRight:0,zIndex:3500},l.a.createElement(n,{element:this._getStickerpickerContent(),onResize:this._onFinished}))}else t=l.a.createElement(C.a,{id:"stickersButton",key:"controls_show_stickers",className:"mx_MessageComposer_button mx_MessageComposer_stickers",onClick:this._onShowStickersClick,title:Object(m.a)("Show Stickers")});return l.a.createElement(l.a.Fragment,null,t,e)}},o()(s,"currentWidget",void 0),n=s))||n},854:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(100),d=a(97),m=a(93),u=a(165),h=a(103),p=a(92),g=a.n(p),f=a(155),v=a(147),b=a(94);function y(){c.a.dispatch({action:"reply_to_event",event:null})}let E=Object(b.a)("views.rooms.ReplyPreview")((s=class extends l.a.Component{constructor(e){super(e),this.unmounted=!1,this.state={event:u.a.getQuotingEvent()},this._onRoomViewStoreUpdate=this._onRoomViewStoreUpdate.bind(this),this._roomStoreToken=u.a.addListener(this._onRoomViewStoreUpdate)}componentWillUnmount(){this.unmounted=!0,this._roomStoreToken&&this._roomStoreToken.remove()}_onRoomViewStoreUpdate(){if(this.unmounted)return;const e=u.a.getQuotingEvent();this.state.event!==e&&this.setState({event:e})}render(){if(!this.state.event)return null;const e=d.getComponent("rooms.EventTile");return l.a.createElement("div",{className:"mx_ReplyPreview"},l.a.createElement("div",{className:"mx_ReplyPreview_section"},l.a.createElement("div",{className:"mx_ReplyPreview_header mx_ReplyPreview_title"},Object(m.a)("Replying")),l.a.createElement("div",{className:"mx_ReplyPreview_header mx_ReplyPreview_cancel"},l.a.createElement("img",{className:"mx_filterFlipColor",src:a(502),width:"18",height:"18",onClick:y})),l.a.createElement("div",{className:"mx_ReplyPreview_clear"}),l.a.createElement(e,{last:!0,tileShape:"reply_preview",mxEvent:this.state.event,permalinkCreator:this.props.permalinkCreator,isTwelveHour:h.b.getValue("showTwelveHourTimestamps"),enableFlair:h.b.getValue(v.a.Flair)})))}},o()(s,"propTypes",{permalinkCreator:g.a.instanceOf(f.a).isRequired}),n=s))||n},855:function(e,t,a){"use strict";a.d(t,"a",(function(){return w}));var n,s=a(19),i=a.n(s),o=a(135),r=a(93),l=a(88),c=a.n(l),d=a(441),m=a(99),u=a(102),h=a.n(u),p=a(1440),g=a(94),f=a(1441),v=a(858),b=a(142),y=a(859),E=a(140),_=a(106),S=a(186),C=a(430);let w=Object(g.a)("views.rooms.VoiceRecordComposerTile")(n=class extends c.a.PureComponent{constructor(e){super(e),i()(this,"onCancel",async()=>{await this.disposeRecording()}),i()(this,"onRecordStartEndClick",async()=>{if(this.state.recorder)return void await this.state.recorder.stop();const e=()=>{_.a.createTrackedDialog("Microphone Access Error","",S.a,{title:Object(r.a)("Unable to access your microphone"),description:c.a.createElement(c.a.Fragment,null,c.a.createElement("p",null,Object(r.a)("We were unable to access your microphone. Please check your browser settings and try again.")))})};try{var t;const e=await C.a.getDevices();if(null==e||null===(t=e.audioinput)||void 0===t||!t.length)return void _.a.createTrackedDialog("No Microphone Error","",S.a,{title:Object(r.a)("No microphone found"),description:c.a.createElement(c.a.Fragment,null,c.a.createElement("p",null,Object(r.a)("We didn't find a microphone on your device. Please check your settings and try again.")))})}catch(t){return console.error("Error getting devices: ",t),void e()}try{const e=v.a.instance.startRecording();await e.start(),e.on(b.b,e=>{e!==d.b.EndingSoon&&this.setState({recordingPhase:e})}),this.setState({recorder:e,recordingPhase:d.b.Started})}catch(t){console.error("Error starting recording: ",t),e(),v.a.instance.disposeRecording()}}),this.state={recorder:null}}async componentWillUnmount(){await v.a.instance.disposeRecording()}async send(){if(!this.state.recorder)throw new Error("No recording started - cannot send anything");await this.state.recorder.stop();const e=await this.state.recorder.upload();m.a.get().sendMessage(this.props.room.roomId,{body:"Voice message",msgtype:E.b.Audio,url:e,info:{duration:Math.round(1e3*this.state.recorder.durationSeconds),mimetype:this.state.recorder.contentType,size:this.state.recorder.contentLength},"org.matrix.msc1767.text":"Voice message","org.matrix.msc1767.file":{url:e,name:"Voice message.ogg",mimetype:this.state.recorder.contentType,size:this.state.recorder.contentLength},"org.matrix.msc1767.audio":{duration:Math.round(1e3*this.state.recorder.durationSeconds),waveform:this.state.recorder.getPlayback().waveform.map(e=>Math.round(1024*e))},"org.matrix.msc2516.voice":{}}),await this.disposeRecording()}async disposeRecording(){await v.a.instance.disposeRecording(),this.setState({recorder:null,recordingPhase:null})}renderWaveformArea(){return this.state.recorder?this.state.recordingPhase!==d.b.Started?c.a.createElement(y.a,{playback:this.state.recorder.getPlayback()}):c.a.createElement("div",{className:"mx_VoiceMessagePrimaryContainer mx_VoiceRecordComposerTile_recording"},c.a.createElement(f.a,{recorder:this.state.recorder}),c.a.createElement(p.a,{recorder:this.state.recorder})):null}render(){let e,t;if(!this.state.recordingPhase||this.state.recordingPhase===d.b.Started){var a,n;const t=h()({mx_MessageComposer_button:!this.state.recorder,mx_MessageComposer_voiceMessage:!this.state.recorder,mx_VoiceRecordComposerTile_stop:null===(a=this.state.recorder)||void 0===a?void 0:a.isRecording});let s=Object(r.a)("Record a voice message");this.state.recorder&&(s=Object(r.a)("Stop the recording"));let i=c.a.createElement(o.a,{className:t,onClick:this.onRecordStartEndClick,title:s});!this.state.recorder||null!==(n=this.state.recorder)&&void 0!==n&&n.isRecording||(i=null),e=i}return this.state.recorder&&this.state.recordingPhase!==d.b.Uploading&&(t=c.a.createElement(o.a,{className:"mx_VoiceRecordComposerTile_delete",title:Object(r.a)("Delete recording"),onClick:this.onCancel})),c.a.createElement(c.a.Fragment,null,t,this.renderWaveformArea(),e)}})||n},856:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(94),d=a(102),m=a.n(d);let u=Object(c.a)("views.voice_messages.Waveform")((s=class extends l.a.PureComponent{constructor(e){super(e)}render(){return l.a.createElement("div",{className:"mx_Waveform"},this.props.relHeights.map((e,t)=>{const a=this.props.progress,n=t/this.props.relHeights.length<=a&&a>0,s=m()({mx_Waveform_bar:!0,mx_Waveform_bar_100pct:n});return l.a.createElement("span",{key:t,style:{height:100*e+"%"},className:s})}))}},o()(s,"defaultProps",{progress:1}),n=s))||n},857:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n,s=a(88),i=a.n(s),o=a(94);let r=Object(o.a)("views.voice_messages.Clock")(n=class extends i.a.Component{constructor(e){super(e)}shouldComponentUpdate(e,t,a){return Math.floor(this.props.seconds)!==Math.floor(e.seconds)}render(){const e=Math.floor(this.props.seconds/60).toFixed(0).padStart(2,"0"),t=Math.floor(this.props.seconds%60).toFixed(0).padStart(2,"0");return i.a.createElement("span",{className:"mx_Clock"},e,":",t)}})||n},858:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(19),s=a.n(n),i=a(237),o=a(100),r=a(441);class l extends i.a{constructor(){super(o.a,{})}get activeRecording(){return this.state.recording}static get instance(){return l.internalInstance||(l.internalInstance=new l),l.internalInstance}async onAction(e){}startRecording(){if(!this.matrixClient)throw new Error("Cannot start a recording without a MatrixClient");if(this.state.recording)throw new Error("A recording is already in progress");const e=new r.d(this.matrixClient);return this.updateState({recording:e}),e}disposeRecording(){return this.state.recording&&this.state.recording.destroy(),this.updateState({recording:null})}}s()(l,"internalInstance",void 0),window.mxVoiceRecordingStore=l.instance},859:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(19),s=a.n(n),i=a(442),o=a(88),r=a.n(o),l=a(142),c=a(1442),d=a(1443),m=a(1444);class u extends r.a.PureComponent{constructor(e){super(e),s()(this,"onPlaybackUpdate",e=>{this.setState({playbackPhase:e})}),this.state={playbackPhase:i.c.Decoding},this.props.playback.on(l.b,this.onPlaybackUpdate),this.props.playback.prepare()}render(){return r.a.createElement("div",{className:"mx_VoiceMessagePrimaryContainer"},r.a.createElement(d.a,{playback:this.props.playback,playbackPhase:this.state.playbackPhase}),r.a.createElement(m.a,{playback:this.props.playback}),r.a.createElement(c.a,{playback:this.props.playback}))}}},860:function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"b",(function(){return f}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(108),u=a(97),h=a(93),p=a(94);function g(e){const{onClick:t}=e;return l.a.createElement(m.a,{className:"mx_RoomHeader_cancelButton",onClick:t},l.a.createElement("img",{src:a(502),className:"mx_filterFlipColor",width:"18",height:"18",alt:Object(h.a)("Cancel")}))}let f=Object(p.a)("views.rooms.SimpleRoomHeader")((s=class extends l.a.Component{render(){let e,t;if(this.props.onCancelClick&&(e=l.a.createElement(g,{onClick:this.props.onCancelClick})),this.props.icon){const e=u.getComponent("elements.TintableSvg");t=l.a.createElement(e,{className:"mx_RoomHeader_icon",src:this.props.icon,width:"25",height:"25"})}return l.a.createElement("div",{className:"mx_RoomHeader mx_RoomHeader_wrapper"},l.a.createElement("div",{className:"mx_RoomHeader_simpleHeader"},t,this.props.title,e))}},o()(s,"propTypes",{title:d.a.string,onCancelClick:d.a.func,icon:d.a.string}),n=s))||n},861:function(e,t,a){"use strict";a.d(t,"b",(function(){return b})),a.d(t,"a",(function(){return y}));var n=a(383),s=a(99);async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a=s.a.get(),n={limit:10};void 0!==t&&(n.rooms=[t]);const i={search_categories:{room_events:{search_term:e,filter:n,order_by:"recent",event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},o=await a.search({body:i}),r={response:o,query:i};return r}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a=s.a.get(),n=await i(e,t),o={_query:n.query,results:[],highlights:[]};return a.processRoomEventsSearch(o,n.response)}function r(e,t){const a=e.result,n=t.result;return a.origin_server_ts>n.origin_server_ts?-1:a.origin_server_ts<n.origin_server_ts?1:0}async function l(e){const t=s.a.get(),a=i(e),n=c(e);await Promise.all([a,n]);const o=await n,r=await a,l=r.query,d=r.response,m=o.query,u=o.response,h={seshatQuery:m,_query:l,serverSideNextBatch:d.next_batch,cachedEvents:[],oldestEventFrom:"server",results:[],highlights:[]},f={search_categories:{room_events:p(h,u,d.search_categories.room_events)}},v=t.processRoomEventsSearch(h,f);return g(v.results),v}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a=n.a.get(),s={search_term:e,before_limit:1,after_limit:1,limit:10,order_by_recency:!0,room_id:void 0};void 0!==t&&(s.room_id=t);const i=await a.search(s);s.next_batch=i.next_batch;const o={response:i,query:s};return o}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a={results:[],highlights:[]};if(""===e)return a;const n=await c(e,t);a.seshatQuery=n.query;const i={search_categories:{room_events:n.response}},o=s.a.get().processRoomEventsSearch(a,i);return g(o.results),o}function m(e,t){try{const a=e.results[e.results.length-1].result,n=t.results[t.results.length-1].result;return a.origin_server_ts<=n.origin_server_ts?-1:1}catch{return 0}}function u(e,t,a,n){const s=a.concat(n).sort(r);t.results=s.slice(0,10),e.cachedEvents=s.slice(10)}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const n={},s=e.cachedEvents;let i=e.oldestEventFrom;return n.highlights=e.highlights,t&&a&&a.results?(m(t,a)<0&&(i="local"),u(e,n,t.results,a.results),n.highlights=t.highlights.concat(a.highlights)):t?(m(t,s)<0&&(i="local"),u(e,n,t.results,s)):a&&a.results?(m(a,s)<0&&(i="server"),u(e,n,a.results,s)):(n.results=s,e.cachedEvents=[]),e.oldestEventFrom=i,n}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const n=h(e,t,a);return e.count?n.count=e.count:n.count=t.count+a.count,t&&(e.seshatQuery.next_batch=t.next_batch),a&&(e.serverSideNextBatch=a.next_batch),e.seshatQuery.next_batch?n.next_batch=e.seshatQuery.next_batch:e.serverSideNextBatch&&(n.next_batch=e.serverSideNextBatch),!n.next_batch&&e.cachedEvents.length>0&&(n.next_batch="cached"),n}function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<e.length;t++){const a=e[t].context.getTimeline();for(let e=0;e<a.length;e++){const t=a[e];t.event.curve25519Key&&(t.makeEncrypted("m.room.encrypted",{algorithm:t.event.algorithm},t.event.curve25519Key,t.event.ed25519Key),t._forwardingCurve25519KeyChain=t.event.forwardingCurve25519KeyChain,delete t.event.curve25519Key,delete t.event.ed25519Key,delete t.event.algorithm,delete t.event.forwardingCurve25519KeyChain)}}}function f(e){let t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return t=void 0!==a?s.a.get().isRoomEncrypted(a)?d(e,a):o(e,a):l(e),t}function v(e){const t=s.a.get(),a=e.seshatQuery,i=e._query;if(a){if(i){const t=async function(e){const t=n.a.get(),a=s.a.get(),i=e.seshatQuery,o=e.oldestEventFrom;let r,l,c;if(!i.next_batch||e.serverSideNextBatch&&"server"!==o||(r=await t.search(i)),e.serverSideNextBatch&&("local"===o||!i.next_batch)){const t={body:e._query,next_batch:e.serverSideNextBatch};l=await a.search(t)}l&&(c=l.search_categories.room_events);const d={search_categories:{room_events:p(e,r,c)}},m=e.results?e.results.length:0,u=a.processRoomEventsSearch(e,d),h=u.results.length-m;return g(u.results.slice(Math.max(u.results.length-h,0))),e.pendingRequest=null,u}(e);return e.pendingRequest=t,t}{const t=async function(e){const t=n.a.get(),a=e.seshatQuery,i=await t.search(a);e.seshatQuery.next_batch=i.next_batch;const o=i.results.length,r={search_categories:{room_events:i}},l=s.a.get().processRoomEventsSearch(e,r);return g(l.results.slice(Math.max(l.results.length-o,0))),e.pendingRequest=null,l}(e);return e.pendingRequest=t,t}}return t.backPaginateRoomEventsSearch(e)}function b(e){const t=n.a.get(),a=s.a.get();return e.pendingRequest?e.pendingRequest:null===t?a.backPaginateRoomEventsSearch(e):v(e)}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a=n.a.get();return null===a?o(e,t):f(e,t)}},862:function(e,t,a){"use strict";(function(e){class a{constructor(){this._scrollStateMap={}}getScrollState(e){return this._scrollStateMap[e]}setScrollState(e,t){this._scrollStateMap[e]=t}}void 0===e.mx_RoomScrollStateStore&&(e.mx_RoomScrollStateStore=new a),t.a=e.mx_RoomScrollStateStore}).call(this,a(7))},863:function(e,t,a){"use strict";var n=a(88),s=a.n(n),i=a(92),o=a.n(i);const r=e=>{const t=["mx_ResizeHandle"];return e.vertical?t.push("mx_ResizeHandle_vertical"):t.push("mx_ResizeHandle_horizontal"),e.reverse&&t.push("mx_ResizeHandle_reverse"),s.a.createElement("div",{className:t.join(" "),"data-id":e.id},s.a.createElement("div",null))};r.propTypes={vertical:o.a.bool,reverse:o.a.bool,id:o.a.string},t.a=r},864:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(19),s=a.n(n),i=a(150);class o{constructor(e,t,a){if(this.container=e,this.distributorCtor=t,this.config=a,s()(this,"classNames",void 0),s()(this,"onMouseDown",e=>{const t=e.target&&e.target.closest("."+this.classNames.handle);if(!t||t.parentElement!==this.container)return;e.preventDefault(),this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),this.config.onResizeStart&&this.config.onResizeStart();const{sizer:a,distributor:n}=this.createSizerAndDistributor(t);n.start();const s=e=>{const t=a.offsetFromEvent(e);n.resizeFromContainerOffset(t)},i=document.body,o=()=>{this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),n.finish(),this.config.onResizeStop&&this.config.onResizeStop(),i.removeEventListener("mouseup",o,!1),document.removeEventListener("mouseleave",o,!1),i.removeEventListener("mousemove",s,!1)};i.addEventListener("mouseup",o,!1),document.addEventListener("mouseleave",o,!1),i.addEventListener("mousemove",s,!1)}),s()(this,"onResize",Object(i.throttle)(()=>{const e=this.getDistributors();e.forEach(e=>e.start()),e.forEach(e=>e.finish())},100,{trailing:!0,leading:!0})),s()(this,"getDistributors",()=>this.getResizeHandles().map(e=>{const{distributor:t}=this.createSizerAndDistributor(e);return t})),!e)throw new Error("Resizer requires a non-null `container` arg");this.classNames={handle:"resizer-handle",reverse:"resizer-reverse",vertical:"resizer-vertical",resizing:"resizer-resizing"}}setClassNames(e){this.classNames=e}attach(){this.container.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("resize",this.onResize)}detach(){this.container.removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("resize",this.onResize)}forHandleAt(e){const t=this.getResizeHandles()[e];if(t){const{distributor:e}=this.createSizerAndDistributor(t);return e}}forHandleWithId(e){const t=this.getResizeHandles().find(t=>t.getAttribute("data-id")===e);if(t){const{distributor:e}=this.createSizerAndDistributor(t);return e}}isReverseResizeHandle(e){return e&&e.classList.contains(this.classNames.reverse)}isResizeHandle(e){return e&&e.classList.contains(this.classNames.handle)}createSizerAndDistributor(e){const t=e.classList.contains(this.classNames.vertical),a=this.isReverseResizeHandle(e),n=this.distributorCtor,s=n.createSizer(this.container,t,a),i=n.createItem(e,this,s);return{sizer:s,distributor:new n(i)}}getResizeHandles(){return this.container.children?Array.from(this.container.children).filter(e=>this.isResizeHandle(e)):[]}}},865:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(1448),s=a(606);class i extends n.a{start(e){this.vertical?e.style.minHeight=null:e.style.minWidth=null}finish(e){const t=e.offsetParent;if(t)if(this.vertical){const a=(e.offsetHeight/t.offsetHeight*100).toFixed(2)+"%";e.style.minHeight=a,e.style.height=a}else{const a=(e.offsetWidth/t.offsetWidth*100).toFixed(2)+"%";e.style.minWidth=a,e.style.width=a}}}class o extends s.a{static createSizer(e,t,a){return new i(e,t,a)}}},866:function(e,t,a){"use strict";a.d(t,"a",(function(){return k}));var n,s=a(95),i=a.n(s),o=a(19),r=a.n(o),l=a(88),c=a.n(l),d=a(100),m=a(158),u=a(99),h=a(93),p=a(1451),g=a(167),f=a(238),v=a(102),b=a.n(v),y=a(108),E=a(131),_=a(127),S=a(1452),C=a(368),w=a(1453),O=a(94);function x(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function R(){const e=document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen;e&&e.call(document)}let k=Object(O.a)("views.voip.CallView")(n=class extends c.a.Component{constructor(e){super(e),r()(this,"dispatcherRef",void 0),r()(this,"contentRef",Object(l.createRef)()),r()(this,"controlsHideTimer",null),r()(this,"dialpadButton",Object(l.createRef)()),r()(this,"contextMenuButton",Object(l.createRef)()),r()(this,"onAction",e=>{switch(e.action){case"video_fullscreen":if(!this.contentRef.current)return;e.fullscreen?function(e){const t=e.requestFullscreen||e.webkitRequestFullScreen||e.msRequestFullscreen;t&&t.call(e)}(this.contentRef.current):x()&&R()}}),r()(this,"onCallState",e=>{this.setState({callState:e})}),r()(this,"onFeedsChanged",e=>{this.setState({feeds:e})}),r()(this,"onCallLocalHoldUnhold",()=>{this.setState({isLocalOnHold:this.props.call.isLocalOnHold()})}),r()(this,"onCallRemoteHoldUnhold",()=>{this.setState({isRemoteOnHold:this.props.call.isRemoteOnHold(),isLocalOnHold:this.props.call.isLocalOnHold()})}),r()(this,"onFullscreenClick",()=>{d.a.dispatch({action:"video_fullscreen",fullscreen:!0})}),r()(this,"onExpandClick",()=>{const e=m.d.sharedInstance().roomIdForCall(this.props.call);d.a.dispatch({action:"view_room",room_id:e})}),r()(this,"onControlsHideTimer",()=>{this.controlsHideTimer=null,this.setState({controlsVisible:!1})}),r()(this,"onMouseMove",()=>{this.showControls()}),r()(this,"onDialpadClick",()=>{this.state.showDialpad?(null!==this.controlsHideTimer&&clearTimeout(this.controlsHideTimer),this.controlsHideTimer=window.setTimeout(this.onControlsHideTimer,1e3),this.setState({showDialpad:!1})):(this.controlsHideTimer&&(clearTimeout(this.controlsHideTimer),this.controlsHideTimer=null),this.setState({showDialpad:!0,controlsVisible:!0}))}),r()(this,"onMicMuteClick",()=>{const e=!this.state.micMuted;this.props.call.setMicrophoneMuted(e),this.setState({micMuted:e})}),r()(this,"onVidMuteClick",()=>{const e=!this.state.vidMuted;this.props.call.setLocalVideoMuted(e),this.setState({vidMuted:e})}),r()(this,"onMoreClick",()=>{this.controlsHideTimer&&(clearTimeout(this.controlsHideTimer),this.controlsHideTimer=null),this.setState({showMoreMenu:!0,controlsVisible:!0})}),r()(this,"closeDialpad",()=>{this.setState({showDialpad:!1}),this.controlsHideTimer=window.setTimeout(this.onControlsHideTimer,1e3)}),r()(this,"closeContextMenu",()=>{this.setState({showMoreMenu:!1}),this.controlsHideTimer=window.setTimeout(this.onControlsHideTimer,1e3)}),r()(this,"onNativeKeyDown",e=>{let t=!1;const a=Object(E.d)(e);switch(e.key){case E.a.D:a&&(this.onMicMuteClick(),this.showControls(),t=!0);break;case E.a.E:a&&(this.onVidMuteClick(),this.showControls(),t=!0)}t&&(e.stopPropagation(),e.preventDefault())}),r()(this,"onRoomAvatarClick",()=>{const e=m.d.sharedInstance().roomIdForCall(this.props.call);d.a.dispatch({action:"view_room",room_id:e})}),r()(this,"onSecondaryRoomAvatarClick",()=>{const e=m.d.sharedInstance().roomIdForCall(this.props.secondaryCall);d.a.dispatch({action:"view_room",room_id:e})}),r()(this,"onCallResumeClick",()=>{const e=m.d.sharedInstance().roomIdForCall(this.props.call);m.d.sharedInstance().setActiveCallRoomId(e)}),r()(this,"onTransferClick",()=>{const e=m.d.sharedInstance().getTransfereeForCallId(this.props.call.callId);this.props.call.transferToCall(e)}),this.state={isLocalOnHold:this.props.call.isLocalOnHold(),isRemoteOnHold:this.props.call.isRemoteOnHold(),micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted(),callState:this.props.call.state,controlsVisible:!0,showMoreMenu:!1,showDialpad:!1,feeds:this.props.call.getFeeds()},this.updateCallListeners(null,this.props.call)}componentDidMount(){this.dispatcherRef=d.a.register(this.onAction),document.addEventListener("keydown",this.onNativeKeyDown)}componentWillUnmount(){x()&&R(),document.removeEventListener("keydown",this.onNativeKeyDown),this.updateCallListeners(this.props.call,null),d.a.unregister(this.dispatcherRef)}componentDidUpdate(e){this.props.call!==e.call&&(this.setState({isLocalOnHold:this.props.call.isLocalOnHold(),isRemoteOnHold:this.props.call.isRemoteOnHold(),micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted(),callState:this.props.call.state}),this.updateCallListeners(null,this.props.call))}updateCallListeners(e,t){e!==t&&(e&&(e.removeListener(f.c.State,this.onCallState),e.removeListener(f.c.LocalHoldUnhold,this.onCallLocalHoldUnhold),e.removeListener(f.c.RemoteHoldUnhold,this.onCallRemoteHoldUnhold),e.removeListener(f.c.FeedsChanged,this.onFeedsChanged)),t&&(t.on(f.c.State,this.onCallState),t.on(f.c.LocalHoldUnhold,this.onCallLocalHoldUnhold),t.on(f.c.RemoteHoldUnhold,this.onCallRemoteHoldUnhold),t.on(f.c.FeedsChanged,this.onFeedsChanged)))}showControls(){this.state.showMoreMenu||this.state.showDialpad||(this.state.controlsVisible||this.setState({controlsVisible:!0}),null!==this.controlsHideTimer&&clearTimeout(this.controlsHideTimer),this.controlsHideTimer=window.setTimeout(this.onControlsHideTimer,1e3))}render(){const e=u.a.get(),t=m.d.sharedInstance().roomIdForCall(this.props.call),a=m.d.sharedInstance().roomIdForCall(this.props.secondaryCall),n=e.getRoom(t),s=this.props.secondaryCall?e.getRoom(a):null;let o,r;this.state.showDialpad&&(o=c.a.createElement(w.a,i()({},Object(_.m)(this.dialpadButton.current.getBoundingClientRect(),_.a.None,8),{onFinished:this.closeDialpad,call:this.props.call}))),this.state.showMoreMenu&&(r=c.a.createElement(S.a,i()({},Object(_.l)(this.contextMenuButton.current.getBoundingClientRect(),_.a.None,8),{onFinished:this.closeContextMenu,call:this.props.call})));const l=b()({mx_CallView_callControls_button:!0,mx_CallView_callControls_button_micOn:!this.state.micMuted,mx_CallView_callControls_button_micOff:this.state.micMuted}),v=b()({mx_CallView_callControls_button:!0,mx_CallView_callControls_button_vidOn:!this.state.vidMuted,mx_CallView_callControls_button_vidOff:this.state.vidMuted}),E=b()({mx_CallView_callControls_button:!0,mx_CallView_callControls_button_micOn:this.state.micMuted,mx_CallView_callControls_button_micOff:!this.state.micMuted,mx_CallView_callControls_button_invisible:!0}),O=b()({mx_CallView_callControls_button:!0,mx_CallView_callControls_button_vidOn:this.state.micMuted,mx_CallView_callControls_button_vidOff:!this.state.micMuted,mx_CallView_callControls_button_invisible:!0}),x=b()({mx_CallView_callControls:!0,mx_CallView_callControls_hidden:!this.state.controlsVisible}),R=this.props.call.type===f.f.Video?c.a.createElement(y.a,{className:v,onClick:this.onVidMuteClick}):null,k=this.state.callState===f.e.Connected?c.a.createElement(_.c,{className:"mx_CallView_callControls_button mx_CallView_callControls_dialpad",inputRef:this.dialpadButton,onClick:this.onDialpadClick,isExpanded:this.state.showDialpad}):c.a.createElement("div",{className:"mx_CallView_callControls_button mx_CallView_callControls_button_dialpad_hidden"}),I=this.state.callState===f.e.Connected?c.a.createElement(_.c,{className:"mx_CallView_callControls_button mx_CallView_callControls_button_more",onClick:this.onMoreClick,inputRef:this.contextMenuButton,isExpanded:this.state.showMoreMenu}):c.a.createElement("div",{className:"mx_CallView_callControls_button mx_CallView_callControls_button_more_hidden"}),T=c.a.createElement("div",{className:x},k,c.a.createElement(y.a,{className:l,onClick:this.onMicMuteClick}),c.a.createElement(y.a,{className:"mx_CallView_callControls_button mx_CallView_callControls_button_hangup",onClick:()=>{d.a.dispatch({action:"hangup",room_id:t})}}),R,c.a.createElement("div",{className:E}),c.a.createElement("div",{className:O}),I),P=this.props.pipMode?76:160;let N;const D=m.d.sharedInstance().getTransfereeForCallId(this.props.call.callId),j=this.state.isLocalOnHold||this.state.isRemoteOnHold;let A;if(D){const e=u.a.get().getRoom(m.d.sharedInstance().roomIdForCall(this.props.call)),t=e?e.name:Object(h.a)("unknown person"),a=u.a.get().getRoom(m.d.sharedInstance().roomIdForCall(D)),n=a?a.name:Object(h.a)("unknown person");A=c.a.createElement("div",{className:"mx_CallView_holdTransferContent"},Object(h.a)("Consulting with %(transferTarget)s. <a>Transfer to %(transferee)s</a>",{transferTarget:t,transferee:n},{a:e=>c.a.createElement(y.a,{kind:"link",onClick:this.onTransferClick},e)}))}else if(j){let e=null;if(this.state.isRemoteOnHold){const t=m.d.sharedInstance().hasAnyUnheldCall()?Object(h.b)("You held the call <a>Switch</a>"):Object(h.b)("You held the call <a>Resume</a>");e=Object(h.a)(t,{},{a:e=>c.a.createElement(y.a,{kind:"link",onClick:this.onCallResumeClick},e)})}else this.state.isLocalOnHold&&(e=Object(h.a)("%(peerName)s held the call",{peerName:this.props.call.getOpponentMember().name}));A=c.a.createElement("div",{className:"mx_CallView_holdTransferContent"},e)}if(j||D)if(this.props.call.type===f.f.Video){const e=b()({mx_CallView_content:!0,mx_CallView_video:!0,mx_CallView_video_hold:j});let t=null;const a={},n=Object(C.a)(this.props.call.getOpponentMember(),1024,1024,"crop");a.backgroundImage="url("+n+")",t=c.a.createElement("div",{className:"mx_CallView_video_holdBackground",style:a}),N=c.a.createElement("div",{className:e,ref:this.contentRef,onMouseMove:this.onMouseMove},t,A,T)}else{const e=b()({mx_CallView_content:!0,mx_CallView_voice:!0,mx_CallView_voice_hold:j});N=c.a.createElement("div",{className:e,onMouseMove:this.onMouseMove},c.a.createElement("div",{className:"mx_CallView_voice_avatarsContainer"},c.a.createElement("div",{className:"mx_CallView_voice_avatarContainer",style:{width:P,height:P}},c.a.createElement(g.a,{room:n,height:P,width:P}))),A,T)}else if(this.props.call.noIncomingFeeds()){const e=b()({mx_CallView_content:!0,mx_CallView_voice:!0}),t=this.props.call.getLocalFeeds().map((e,t)=>{if(!e.isVideoMuted())return c.a.createElement(p.a,{key:t,feed:e,call:this.props.call,pipMode:this.props.pipMode,onResize:this.props.onResize})});N=c.a.createElement("div",{className:e,onMouseMove:this.onMouseMove},t,c.a.createElement("div",{className:"mx_CallView_voice_avatarsContainer"},c.a.createElement("div",{className:"mx_CallView_voice_avatarContainer",style:{width:P,height:P}},c.a.createElement(g.a,{room:n,height:P,width:P}))),c.a.createElement("div",{className:"mx_CallView_holdTransferContent"},Object(h.a)("Connecting")),T)}else{const e=b()({mx_CallView_content:!0,mx_CallView_video:!0}),t=this.state.feeds.map((e,t)=>{if(!e.isVideoMuted()||!e.isLocal())return c.a.createElement(p.a,{key:t,feed:e,call:this.props.call,pipMode:this.props.pipMode,onResize:this.props.onResize})});N=c.a.createElement("div",{className:e,ref:this.contentRef,onMouseMove:this.onMouseMove},t,T)}const M=this.props.call.type===f.f.Video?Object(h.a)("Video Call"):Object(h.a)("Voice Call");let U,L,F;this.props.call.type!==f.f.Video||this.props.pipMode||(L=c.a.createElement("div",{className:"mx_CallView_header_button mx_CallView_header_button_fullscreen",onClick:this.onFullscreenClick,title:Object(h.a)("Fill Screen")})),this.props.pipMode&&(F=c.a.createElement("div",{className:"mx_CallView_header_button mx_CallView_header_button_expand",onClick:this.onExpandClick,title:Object(h.a)("Return to call")}));const B=c.a.createElement("div",{className:"mx_CallView_header_controls"},L);let V;if(this.props.pipMode){let e;this.props.secondaryCall&&(e=c.a.createElement("span",{className:"mx_CallView_header_secondaryCallInfo"},c.a.createElement(y.a,{element:"span",onClick:this.onSecondaryRoomAvatarClick},c.a.createElement(g.a,{room:s,height:16,width:16}),c.a.createElement("span",{className:"mx_CallView_secondaryCall_roomName"},Object(h.a)("%(name)s on hold",{name:s.name}))))),V=c.a.createElement("div",{className:"mx_CallView_header"},c.a.createElement(y.a,{onClick:this.onRoomAvatarClick},c.a.createElement(g.a,{room:n,height:32,width:32})),c.a.createElement("div",{className:"mx_CallView_header_callInfo"},c.a.createElement("div",{className:"mx_CallView_header_roomName"},n.name),c.a.createElement("div",{className:"mx_CallView_header_callTypeSmall"},M,e)),B),U="mx_CallView_pip"}else V=c.a.createElement("div",{className:"mx_CallView_header"},c.a.createElement("div",{className:"mx_CallView_header_phoneIcon"}),c.a.createElement("span",{className:"mx_CallView_header_callType"},M),B),U="mx_CallView_large";return c.a.createElement("div",{className:"mx_CallView "+U},V,N,o,r)}})||n},867:function(e,t){e.exports="img/upload-big.8d6a77d.svg"},87:function(e,t,a){"use strict";a.r(t),a.d(t,"rageshakePromise",(function(){return K})),a.d(t,"preparePlatform",(function(){return q})),a.d(t,"setupLogStorage",(function(){return Y})),a.d(t,"loadConfig",(function(){return $})),a.d(t,"loadOlm",(function(){return J})),a.d(t,"loadLanguage",(function(){return Q})),a.d(t,"loadSkin",(function(){return X})),a.d(t,"loadTheme",(function(){return Z})),a.d(t,"loadApp",(function(){return ee})),a.d(t,"showError",(function(){return te})),a.d(t,"showIncompatibleBrowser",(function(){return ae})),a.d(t,"_t",(function(){return ne}));var n=a(1547),s=a(1548),i=a.n(s),o=a(129),r=a(88),l=a.n(r),c=a(93),d=a(103),m=a(381),u=a.n(m),h=a(429),p=a(25),g=a(8455);class f extends h.e{constructor(){super(...arguments),u()(this,"_favicon",void 0)}async getConfig(){return Object(p.a)()}getHumanReadableName(){return"Vector Base Platform"}get favicon(){return this._favicon?this._favicon:this._favicon=new g.a}_updateFavicon(){let e="#d00",t=this.notificationCount;this.errorDidOccur&&(t=t||"×",e="#f00"),this.favicon.badge(t,{bgColor:e})}setNotificationCount(e){this.notificationCount!==e&&(super.setNotificationCount(e),this._updateFavicon())}setErrorStatus(e){this.errorDidOccur!==e&&(super.setErrorStatus(e),this._updateFavicon())}startUpdater(){}getDefaultDeviceDisplayName(){return Object(c.a)("Unknown device")}}var v=a(100),b=a(110),y=a(835),E=a(106),_=a(377),S=a(168),C=a(599),w=a(131),O=a(294),x=a(115),R=a(830),k=a(217),I=a(1530);function T(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}const P=window.electron,N=navigator.platform.toUpperCase().includes("MAC");function D(e){["call_state"].includes(e.action)&&P.send("app_onAction",e)}class j extends class{async supportsEventIndexing(){return!0}async initEventIndex(e,t){throw new Error("Unimplemented")}async addEventToIndex(e,t){throw new Error("Unimplemented")}async deleteEvent(e){throw new Error("Unimplemented")}async isEventIndexEmpty(){throw new Error("Unimplemented")}indexIsEmpty(){throw new Error("Unimplemented")}isRoomIndexed(e){throw new Error("Unimplemented")}async getStats(){throw new Error("Unimplemented")}async getUserVersion(){throw new Error("Unimplemented")}async setUserVersion(e){throw new Error("Unimplemented")}async commitLiveEvents(){throw new Error("Unimplemented")}async searchEventIndex(e){throw new Error("Unimplemented")}async addHistoricEvents(e,t,a){throw new Error("Unimplemented")}async addCrawlerCheckpoint(e){throw new Error("Unimplemented")}async removeCrawlerCheckpoint(e){throw new Error("Unimplemented")}async loadCheckpoints(){throw new Error("Unimplemented")}async loadFileEvents(e){throw new Error("Unimplemented")}async closeEventIndex(){throw new Error("Unimplemented")}async deleteEventIndex(){throw new Error("Unimplemented")}}{constructor(){super(),u()(this,"pendingIpcCalls",{}),u()(this,"nextIpcCallId",0),u()(this,"_onIpcReply",(e,t)=>{if(void 0===t.id)return void console.warn("Ignoring IPC reply with no ID");if(void 0===this.pendingIpcCalls[t.id])return void console.warn("Unknown IPC payload ID: "+t.id);const a=this.pendingIpcCalls[t.id];delete this.pendingIpcCalls[t.id],t.error?a.reject(t.error):a.resolve(t.reply)}),P.on("seshatReply",this._onIpcReply)}async _ipcCall(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];const s=++this.nextIpcCallId;return new Promise((t,n)=>{this.pendingIpcCalls[s]={resolve:t,reject:n},window.electron.send("seshat",{id:s,name:e,args:a})})}async supportsEventIndexing(){return this._ipcCall("supportsEventIndexing")}async initEventIndex(e,t){return this._ipcCall("initEventIndex",e,t)}async addEventToIndex(e,t){return this._ipcCall("addEventToIndex",e,t)}async deleteEvent(e){return this._ipcCall("deleteEvent",e)}async isEventIndexEmpty(){return this._ipcCall("isEventIndexEmpty")}async isRoomIndexed(e){return this._ipcCall("isRoomIndexed",e)}async commitLiveEvents(){return this._ipcCall("commitLiveEvents")}async searchEventIndex(e){return this._ipcCall("searchEventIndex",e)}async addHistoricEvents(e,t,a){return this._ipcCall("addHistoricEvents",e,t,a)}async addCrawlerCheckpoint(e){return this._ipcCall("addCrawlerCheckpoint",e)}async removeCrawlerCheckpoint(e){return this._ipcCall("removeCrawlerCheckpoint",e)}async loadFileEvents(e){return this._ipcCall("loadFileEvents",e)}async loadCheckpoints(){return this._ipcCall("loadCheckpoints")}async closeEventIndex(){return this._ipcCall("closeEventIndex")}async getStats(){return this._ipcCall("getStats")}async getUserVersion(){return this._ipcCall("getUserVersion")}async setUserVersion(e){return this._ipcCall("setUserVersion",e)}async deleteEventIndex(){return this._ipcCall("deleteEventIndex")}}class A extends f{constructor(){super(),u()(this,"eventIndexManager",new j),u()(this,"pendingIpcCalls",{}),u()(this,"nextIpcCallId",0),u()(this,"ssoID",Object(O.b)(32)),u()(this,"onUpdateDownloaded",async(e,t)=>{let{releaseNotes:a,releaseName:n}=t;v.a.dispatch({action:x.a.CheckUpdates,status:h.d.Ready}),this.shouldShowUpdate(n)&&Object(R.b)(await this.getAppVersion(),n,a)}),u()(this,"_onIpcReply",(e,t)=>{if(void 0===t.id)return void console.warn("Ignoring IPC reply with no ID");if(void 0===this.pendingIpcCalls[t.id])return void console.warn("Unknown IPC payload ID: "+t.id);const a=this.pendingIpcCalls[t.id];delete this.pendingIpcCalls[t.id],t.error?a.reject(t.error):a.resolve(t.reply)}),v.a.register(D),P.on("check_updates",(e,t)=>{v.a.dispatch(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?T(Object(a),!0).forEach((function(t){u()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({action:x.a.CheckUpdates},function(e){return!0===e?{status:h.d.Downloading}:!1===e?{status:h.d.NotAvailable}:{status:h.d.Error,detail:e}}(t)))}),P.on("before-quit",(function(){console.log("element-desktop closing"),y.b()})),P.on("ipcReply",this._onIpcReply),P.on("update-downloaded",this.onUpdateDownloaded),P.on("preferences",()=>{v.a.fire(x.a.ViewUserSettings)}),P.on("userDownloadCompleted",(e,t)=>{let{path:a,name:n}=t;k.a.sharedInstance().addOrReplaceToast({key:"DOWNLOAD_TOAST_"+a,title:Object(c.a)("Download Completed"),props:{description:n,acceptLabel:Object(c.a)("Open"),onAccept:()=>{P.send("userDownloadOpen",{path:a})},dismissLabel:Object(c.a)("Dismiss"),numSeconds:10},component:I.a,priority:99})}),N?(Object(C.c)(C.a.NAVIGATION,{keybinds:[{modifiers:[C.b.COMMAND],key:w.a.COMMA}],description:Object(c.b)("Open user settings")}),Object(C.c)(C.a.NAVIGATION,{keybinds:[{modifiers:[C.b.COMMAND],key:w.a.SQUARE_BRACKET_LEFT},{modifiers:[C.b.COMMAND],key:w.a.SQUARE_BRACKET_RIGHT}],description:Object(c.b)("Previous/next recently visited room or community")})):Object(C.c)(C.a.NAVIGATION,{keybinds:[{modifiers:[C.b.ALT],key:w.a.ARROW_LEFT},{modifiers:[C.b.ALT],key:w.a.ARROW_RIGHT}],description:Object(c.b)("Previous/next recently visited room or community")}),this._ipcCall("startSSOFlow",this.ssoID)}async getConfig(){return this._ipcCall("getConfig")}getHumanReadableName(){return"Electron Platform"}supportsMultiLanguageSpellCheck(){return!N}setNotificationCount(e){this.notificationCount!==e&&(super.setNotificationCount(e),P.send("setBadgeCount",e))}supportsNotifications(){return!0}maySendNotifications(){return!0}displayNotification(e,t,a,n){navigator.userAgent.includes("Linux")&&(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const s={body:t,silent:!0};a&&(s.icon=a);const i=new window.Notification(e,s);return i.onclick=()=>{v.a.dispatch({action:"view_room",room_id:n.roomId}),window.focus(),this._ipcCall("focusWindow")},i}loudNotification(e,t){P.send("loudNotification")}async getAppVersion(){return this._ipcCall("getAppVersion")}supportsAutoLaunch(){return!0}async getAutoLaunchEnabled(){return this._ipcCall("getAutoLaunchEnabled")}async setAutoLaunchEnabled(e){return this._ipcCall("setAutoLaunchEnabled",e)}supportsWarnBeforeExit(){return!0}async shouldWarnBeforeExit(){return this._ipcCall("shouldWarnBeforeExit")}async setWarnBeforeExit(e){return this._ipcCall("setWarnBeforeExit",e)}supportsAutoHideMenuBar(){return!N}async getAutoHideMenuBarEnabled(){return this._ipcCall("getAutoHideMenuBarEnabled")}async setAutoHideMenuBarEnabled(e){return this._ipcCall("setAutoHideMenuBarEnabled",e)}supportsMinimizeToTray(){return!N}async getMinimizeToTrayEnabled(){return this._ipcCall("getMinimizeToTrayEnabled")}async setMinimizeToTrayEnabled(e){return this._ipcCall("setMinimizeToTrayEnabled",e)}async canSelfUpdate(){const e=await this._ipcCall("getUpdateFeedUrl");return Boolean(e)}startUpdateCheck(){super.startUpdateCheck(),P.send("check_updates")}installUpdate(){P.send("install_update")}getDefaultDeviceDisplayName(){const e=b.a.get().brand;return Object(c.a)("%(brand)s Desktop (%(platformName)s)",{brand:e,platformName:navigator.userAgent.includes("Macintosh")?"macOS":navigator.userAgent.includes("FreeBSD")?"FreeBSD":navigator.userAgent.includes("OpenBSD")?"OpenBSD":navigator.userAgent.includes("SunOS")?"SunOS":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("Linux")?"Linux":"Unknown"})}screenCaptureErrorString(){return null}requestNotificationPermission(){return Promise.resolve("granted")}reload(){window.location.reload(!1)}async _ipcCall(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];const s=++this.nextIpcCallId;return new Promise((t,n)=>{this.pendingIpcCalls[s]={resolve:t,reject:n},window.electron.send("ipcCall",{id:s,name:e,args:a})})}getEventIndexingManager(){return this.eventIndexManager}async setLanguage(e){return this._ipcCall("setLanguage",e)}setSpellCheckLanguages(e){this._ipcCall("setSpellCheckLanguages",e).catch(e=>{console.log("Failed to send setSpellCheckLanguages IPC to Electron"),console.error(e)})}async getSpellCheckLanguages(){return this._ipcCall("getSpellCheckLanguages")}async getAvailableSpellCheckLanguages(){return this._ipcCall("getAvailableSpellCheckLanguages")}getSSOCallbackUrl(e){const t=super.getSSOCallbackUrl(e);return t.protocol="element",t.searchParams.set("element-desktop-ssoid",this.ssoID),t}startSingleSignOn(e,t,a,n){super.startSingleSignOn(e,t,a,n),E.a.createTrackedDialog("Electron","SSO",_.a,{title:Object(c.a)("Go to your browser to complete Sign In"),description:l.a.createElement(S.a,null)})}_navigateForwardBack(e){this._ipcCall(e?"navigateBack":"navigateForward")}onKeyDown(e){let t=!1;switch(e.key){case w.a.SQUARE_BRACKET_LEFT:case w.a.SQUARE_BRACKET_RIGHT:!N||!e.metaKey||e.altKey||e.ctrlKey||e.shiftKey||(this._navigateForwardBack(e.key===w.a.SQUARE_BRACKET_LEFT),t=!0);break;case w.a.ARROW_LEFT:case w.a.ARROW_RIGHT:N||!e.altKey||e.metaKey||e.ctrlKey||e.shiftKey||(this._navigateForwardBack(e.key===w.a.ARROW_LEFT),t=!0)}return t}async getPickleKey(e,t){try{return await this._ipcCall("getPickleKey",e,t)}catch(e){return null}}async createPickleKey(e,t){try{return await this._ipcCall("createPickleKey",e,t)}catch(e){return null}}async destroyPickleKey(e,t){try{await this._ipcCall("destroyPickleKey",e,t)}catch(e){}}}var M=a(22),U=a.n(M),L=a(8456),F=a.n(L);function B(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}class V extends f{constructor(){super(),u()(this,"runningVersion",null),u()(this,"pollForUpdate",()=>this._getVersion().then(e=>{if(null===this.runningVersion)this.runningVersion=e;else{if(this.runningVersion!==e)return this.shouldShowUpdate(e)&&Object(R.b)(this.runningVersion,e),{status:h.d.Ready};Object(R.a)()}return{status:h.d.NotAvailable}},e=>(console.error("Failed to poll for update",e),{status:h.d.Error,detail:e.message||e.status?e.status.toString():"Unknown Error"}))),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")}getHumanReadableName(){return"Web Platform"}supportsNotifications(){return Boolean(window.Notification)}maySendNotifications(){return"granted"===window.Notification.permission}requestNotificationPermission(){return new Promise((function(e,t){window.Notification.requestPermission(t=>{e(t)})}))}displayNotification(e,t,a,n){const s={body:t,tag:"vector",silent:!0};a&&(s.icon=a);const i=new window.Notification(e,s);return i.onclick=function(){v.a.dispatch({action:"view_room",room_id:n.roomId}),window.focus(),i.close()},i}_getVersion(){return new Promise((function(e,t){U()({method:"GET",url:"version",qs:{cachebuster:Date.now()}},(a,n,s)=>{if(a||n.status<200||n.status>=300)return null===a&&(a={status:n.status}),void t(a);const i=s.trim();e(i)})}))}getAppVersion(){return null!==this.runningVersion?Promise.resolve(this.runningVersion):this._getVersion()}startUpdater(){this.pollForUpdate(),setInterval(this.pollForUpdate,6e5)}async canSelfUpdate(){return!0}startUpdateCheck(){super.startUpdateCheck(),this.pollForUpdate().then(e=>{v.a.dispatch(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?B(Object(a),!0).forEach((function(t){u()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):B(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({action:x.a.CheckUpdates},e))})}installUpdate(){window.location.reload(!0)}getDefaultDeviceDisplayName(){const e=new URL(window.location.href),t=[e.host,e.pathname.replace(/\/$/,"")].join(""),a=new F.a,n=a.getBrowser().name||"unknown browser";let s=a.getOS().name||"unknown OS";return"Mac OS"===s&&(s="macOS"),Object(c.a)("%(appName)s (%(browserName)s, %(osName)s)",{appName:t,browserName:n,osName:s})}screenCaptureErrorString(){return"https:"!==window.location.protocol?Object(c.a)("You need to be using HTTPS to place a screen-sharing call."):null}reload(){window.location.reload(!1)}}class G extends V{setNotificationCount(e){if(!navigator.setAppBadge)return super.setNotificationCount(e);this.notificationCount!==e&&(this.notificationCount=e,navigator.setAppBadge(e).catch(e=>{console.error("Failed to update PWA app badge",e)}))}}var z=a(156),W=a(335),H=a(833);window.mxSendRageshake=function(e,t){const a=b.a.get().bug_report_endpoint_url;a?(void 0===t&&(t=!0),e&&e.trim()?Object(H.a)(a,{userText:e,sendLogs:t,progressCallback:console.log.bind(console)}).then(()=>{console.log("Bug report sent!")},e=>{console.error(e)}):console.error("Cannot send a rageshake without a message - please tell us what went wrong")):console.error("Cannot send a rageshake - no bug_report_endpoint_url configured")};const K=function(){const e=y.d(!1);return e.then(()=>{console.log("Initialised rageshake."),console.log("To fix line numbers in Chrome: Meatball menu → Settings → Ignore list → Add /rageshake\\.js$"),window.addEventListener("beforeunload",e=>{console.log("element-web closing"),y.b()}),y.a()},e=>{console.error("Failed to initialise rageshake: "+e)}),e}();function q(){window.electron?(console.log("Using Electron platform"),z.a.set(new A)):window.matchMedia("(display-mode: standalone)").matches?(console.log("Using PWA platform"),z.a.set(new G)):(console.log("Using Web platform"),z.a.set(new V))}function Y(){return b.a.get().bug_report_endpoint_url?y.e():(console.warn("No bug report endpoint set - logs will not be persisted"),Promise.resolve())}async function $(){b.a.put(await z.a.get().getConfig()||{})}function J(){return i.a.init({locateFile:()=>n.a}).then(()=>{console.log("Using WebAssembly Olm")}).catch(e=>(console.log("Failed to load Olm: trying legacy version",e),new Promise((e,t)=>{const a=document.createElement("script");a.src="olm_legacy.js",a.onload=e,a.onerror=t,document.body.appendChild(a)}).then(()=>window.Olm.init()).then(()=>{console.log("Using legacy Olm")}).catch(e=>{console.log("Both WebAssembly and asm.js Olm failed!",e)})))}async function Q(){const e=d.b.getValue("language",null,!0);let t=[];e?t=[e]:c.e().forEach(e=>{t.push(...c.f(e))});try{await c.j(t),document.documentElement.setAttribute("lang",c.d())}catch(e){console.error("Unable to set language",e)}}async function X(){console.log("Loading skin...");const[e,t]=await Promise.all([Promise.resolve().then(a.bind(null,97)),a.e(13).then(a.bind(null,8481))]);e.loadSkin(t),console.log("Skin loaded!")}async function Z(){Object(W.d)()}async function ee(e){const t=await a.e(12).then(a.bind(null,8477));window.matrixChat=o.render(await t.loadApp(e),document.getElementById("matrixchat"))}async function te(e,t){const n=(await a.e(14).then(a.bind(null,8478))).default;window.matrixChat=o.render(r.createElement(n,{title:e,messages:t}),document.getElementById("matrixchat"))}async function ae(e){const t=(await a.e(11).then(a.bind(null,8479))).default;window.matrixChat=o.render(r.createElement(t,{onAccept:e}),document.getElementById("matrixchat"))}const ne=c.a},879:function(e,t,a){},881:function(e,t,a){"use strict";a.d(t,"a",(function(){return x}));var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(92),d=a.n(c),m=a(102),u=a.n(m),h=a(93),p=a(99),g=a(302),f=a(860),v=a(103),b=a(1481),y=a(280),E=a(440),_=a(135),S=a(495),C=a(250),w=a(158),O=a(94);let x=Object(O.a)("views.rooms.RoomHeader")((s=class extends l.a.Component{constructor(){super(...arguments),o()(this,"_onRoomStateEvents",(e,t)=>{this.props.room&&e.getRoomId()===this.props.room.roomId&&this._rateLimitedUpdate()}),o()(this,"_rateLimitedUpdate",new g.a((function(){this.forceUpdate()}),500))}componentDidMount(){p.a.get().on("RoomState.events",this._onRoomStateEvents)}componentWillUnmount(){const e=p.a.get();e&&e.removeListener("RoomState.events",this._onRoomStateEvents)}render(){let e=null,t=null;this.props.onCancelClick&&(t=l.a.createElement(f.a,{onClick:this.props.onCancelClick})),this.props.searchInfo&&void 0!==this.props.searchInfo.searchCount&&null!==this.props.searchInfo.searchCount&&(e=l.a.createElement("div",{className:"mx_RoomHeader_searchStatus"}," ",Object(h.a)("(~%(count)s results)",{count:this.props.searchInfo.searchCount})));let a=!1;const n=this.props.room?this.props.room.getJoinedMembers():void 0;if(n&&1===n.length&&n[0].userId===p.a.get().credentials.userId){const e=this.props.room.currentState.getStateEvents("m.room.name","");e&&e.getContent().name||(a=!0)}this.props.oobData&&this.props.oobData.name&&(oobName=this.props.oobData.name);const s=u()("mx_RoomHeader_nametext",{mx_RoomHeader_settingsHint:a}),i=l.a.createElement("div",{className:"mx_RoomHeader_name",onClick:this.props.onSettingsClick},l.a.createElement(C.a,{room:this.props.room},e=>{console.log("name",e);const t=e||"Vào phòng";return l.a.createElement("div",{dir:"auto",className:s,title:t},t)}),e),o=l.a.createElement(S.a,{room:this.props.room},(e,t)=>l.a.createElement("div",{className:"mx_RoomHeader_topic",ref:t,title:e,dir:"auto"},e));let r,c,d,m,g,O;this.props.room&&(r=l.a.createElement(E.a,{room:this.props.room,avatarSize:32,oobData:this.props.oobData,viewAvatarOnClick:!0})),this.props.onForgetClick&&(c=l.a.createElement(_.a,{className:"mx_RoomHeader_button mx_RoomHeader_forgetButton",onClick:this.props.onForgetClick,title:Object(h.a)("Forget room")})),this.props.onAppsClick&&(d=l.a.createElement(_.a,{className:u()("mx_RoomHeader_button mx_RoomHeader_appsButton",{mx_RoomHeader_appsButton_highlight:this.props.appsShown}),onClick:this.props.onAppsClick,title:this.props.appsShown?Object(h.a)("Hide Widgets"):Object(h.a)("Show Widgets")})),this.props.onSearchClick&&this.props.inRoom&&(m=l.a.createElement(_.a,{className:"mx_RoomHeader_button mx_RoomHeader_searchButton",onClick:this.props.onSearchClick,title:Object(h.a)("Search")})),this.props.inRoom&&v.b.getValue("showCallButtonsInComposer")&&(g=l.a.createElement(_.a,{className:"mx_RoomHeader_button mx_RoomHeader_voiceCallButton",onClick:()=>this.props.onCallPlaced(w.b.Voice),title:Object(h.a)("Voice call")}),O=l.a.createElement(_.a,{className:"mx_RoomHeader_button mx_RoomHeader_videoCallButton",onClick:e=>this.props.onCallPlaced(e.shiftKey?w.b.ScreenSharing:w.b.Video),title:Object(h.a)("Video call")}));const x=l.a.createElement("div",{className:"mx_RoomHeader_buttons"},O,g,c,d,m),R=this.props.e2eStatus?l.a.createElement(y.b,{status:this.props.e2eStatus}):void 0;return l.a.createElement("div",{className:"mx_RoomHeader light-panel"},l.a.createElement("div",{className:"mx_RoomHeader_wrapper","aria-owns":"mx_RightPanel"},l.a.createElement("div",{className:"mx_RoomHeader_avatar"},r),l.a.createElement("div",{className:"mx_RoomHeader_e2eIcon"},R),i,o,t,x,l.a.createElement(b.a,{room:this.props.room})))}},o()(s,"propTypes",{room:d.a.object,oobData:d.a.object,inRoom:d.a.bool,onSettingsClick:d.a.func,onSearchClick:d.a.func,onLeaveClick:d.a.func,onCancelClick:d.a.func,e2eStatus:d.a.string,onAppsClick:d.a.func,appsShown:d.a.bool,onCallPlaced:d.a.func}),o()(s,"defaultProps",{editing:!1,inRoom:!1,onCancelClick:null}),n=s))||n},882:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n=a(95),s=a.n(n),i=a(98),o=a.n(i),r=a(19),l=a.n(r),c=a(88),d=a.n(c),m=a(102),u=a.n(m),h=a(181),p=a(135),g=a(94);const f=["isHighlighted","onClick","analytics","name","title"];var v;let b=Object(g.a)("views.right_panel.HeaderButton")(v=class extends d.a.Component{constructor(){super(...arguments),l()(this,"onClick",()=>{h.a.trackEvent(...this.props.analytics),this.props.onClick()})}render(){const e=this.props,{isHighlighted:t,onClick:a,analytics:n,name:i,title:r}=e,l=o()(e,f),c=u()({mx_RightPanel_headerButton:!0,mx_RightPanel_headerButton_highlight:t,["mx_RightPanel_"+i]:!0});return d.a.createElement(p.a,s()({},l,{"aria-selected":t,role:"tab",title:r,className:c,onClick:this.onClick}))}})||v},883:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return h}));var n,s=a(19),i=a.n(s),o=a(88),r=a.n(o),l=a(100),c=a(337),d=a(115),m=a(94);let u;!function(e){e.Room="room",e.Group="group"}(u||(u={}));let h=Object(m.a)("views.right_panel.HeaderButtons")(n=class extends r.a.Component{constructor(e,t){super(e),i()(this,"storeToken",void 0),i()(this,"dispatcherRef",void 0);const a=c.a.getSharedInstance();this.state={headerKind:t,phase:t===u.Room?a.visibleRoomPanelPhase:a.visibleGroupPanelPhase}}componentDidMount(){this.storeToken=c.a.getSharedInstance().addListener(this.onRightPanelUpdate.bind(this)),this.dispatcherRef=l.a.register(this.onAction.bind(this))}componentWillUnmount(){this.storeToken&&this.storeToken.remove(),this.dispatcherRef&&l.a.unregister(this.dispatcherRef)}setPhase(e,t){l.a.dispatch({action:d.a.SetRightPanelPhase,phase:e,refireParams:t})}isPhase(e){return Array.isArray(e)?e.includes(this.state.phase):e===this.state.phase}onRightPanelUpdate(){const e=c.a.getSharedInstance();this.state.headerKind===u.Room?this.setState({phase:e.visibleRoomPanelPhase}):this.state.headerKind===u.Group&&this.setState({phase:e.visibleGroupPanelPhase})}render(){return r.a.createElement("div",{className:"mx_HeaderButtons"},this.renderButtons())}})||n},899:function(e,t,a){"use strict";var n,s,i=a(19),o=a.n(i),r=a(88),l=a.n(r),c=a(97),d=a(100),m=a(102),u=a.n(m),h=a(439),p=a(257),g=a(92),f=a.n(g),v=a(99),b=a(265),y=a(155),E=a(119),_=a(115),S=a(126),C=a(293),w=a(94);let O=Object(w.a)("views.elements.Pill")((s=class e extends l.a.Component{constructor(){super(...arguments),o()(this,"state",{resourceId:null,pillType:null,member:null,group:null,room:null,hover:!1}),o()(this,"onMouseOver",()=>{this.setState({hover:!0})}),o()(this,"onMouseLeave",()=>{this.setState({hover:!1})}),o()(this,"onUserPillClicked",()=>{d.a.dispatch({action:_.a.ViewUser,member:this.state.member})})}static roomNotifPos(e){return e.indexOf("@room")}static roomNotifLen(){return"@room".length}async UNSAFE_componentWillReceiveProps(t){let a,n;if(t.url)if(t.inMessage){const e=Object(y.i)(t.url);a=e.primaryEntityId,n=e.sigil}else a=Object(y.c)(t.url),n=a?a[0]:void 0;const s=this.props.type||{"@":e.TYPE_USER_MENTION,"#":e.TYPE_ROOM_MENTION,"!":e.TYPE_ROOM_MENTION,"+":e.TYPE_GROUP_MENTION}[n];let i,o,r;switch(s){case e.TYPE_AT_ROOM_MENTION:r=t.room;break;case e.TYPE_USER_MENTION:{const e=t.room?t.room.getMember(a):void 0;i=e,e||(i=new p.a(null,a),this.doProfileLookup(a,i))}break;case e.TYPE_ROOM_MENTION:{const e="#"===a[0]?v.a.get().getRooms().find(e=>e.getCanonicalAlias()===a||e.getAltAliases().includes(a)):v.a.get().getRoom(a);r=e}break;case e.TYPE_GROUP_MENTION:{const e=v.a.get();try{o=await b.a.getGroupProfileCached(e,a)}catch(e){o={groupId:a,avatarUrl:null,name:null}}}}this.setState({resourceId:a,pillType:s,member:i,group:o,room:r})}componentDidMount(){this._unmounted=!1,this._matrixClient=v.a.get(),this.UNSAFE_componentWillReceiveProps(this.props)}componentWillUnmount(){this._unmounted=!0}doProfileLookup(e,t){v.a.get().getProfileInfo(e).then(e=>{this._unmounted||(t.name=e.displayname,t.rawDisplayName=e.displayname,t.events.member={getContent:()=>({avatar_url:e.avatar_url}),getDirectionalContent:function(){return this.getContent()}},this.setState({member:t}))}).catch(t=>{console.error("Could not retrieve profile data for "+e+":",t)})}render(){const t=c.getComponent("views.avatars.BaseAvatar"),a=c.getComponent("avatars.MemberAvatar"),n=c.getComponent("avatars.RoomAvatar"),s=this.state.resourceId;let i,o,r,d=null,m=s,h=this.props.url;switch(this.state.pillType){case e.TYPE_AT_ROOM_MENTION:{const e=this.props.room;e&&(m="@room",this.props.shouldShowPillAvatar&&(d=l.a.createElement(n,{room:e,width:16,height:16,"aria-hidden":"true"})),i="mx_AtRoomPill")}break;case e.TYPE_USER_MENTION:{const e=this.state.member;e&&(o=e.userId,e.rawDisplayName=e.rawDisplayName||"",m=e.rawDisplayName,this.props.shouldShowPillAvatar&&(d=l.a.createElement(a,{member:e,width:16,height:16,"aria-hidden":"true"})),i="mx_UserPill",h=null,r=this.onUserPillClicked)}break;case e.TYPE_ROOM_MENTION:{const e=this.state.room;e&&(m=e.name||s,this.props.shouldShowPillAvatar&&(d=l.a.createElement(n,{room:e,width:16,height:16,"aria-hidden":"true"}))),i="mx_RoomPill"}break;case e.TYPE_GROUP_MENTION:if(this.state.group){const{avatarUrl:e,groupId:a,name:n}=this.state.group;m=a,this.props.shouldShowPillAvatar&&(d=l.a.createElement(t,{name:n||a,width:16,height:16,"aria-hidden":"true",url:e?Object(S.b)(e).getSquareThumbnailHttp(16):null})),i="mx_GroupPill"}}const p=u()("mx_Pill",i,{mx_UserPill_me:o===v.a.get().getUserId(),mx_UserPill_selected:this.props.isSelected});if(this.state.pillType){const{yOffset:e}=this.props;let t;return this.state.hover&&s&&(t=l.a.createElement(C.b,{label:s,yOffset:e})),l.a.createElement(E.a.Provider,{value:this._matrixClient},this.props.inMessage?l.a.createElement("a",{className:p,href:h,onClick:r,"data-offset-key":this.props.offsetKey,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave},d,m,t):l.a.createElement("span",{className:p,"data-offset-key":this.props.offsetKey,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave},d,m,t))}return null}},o()(s,"TYPE_USER_MENTION","TYPE_USER_MENTION"),o()(s,"TYPE_ROOM_MENTION","TYPE_ROOM_MENTION"),o()(s,"TYPE_GROUP_MENTION","TYPE_GROUP_MENTION"),o()(s,"TYPE_AT_ROOM_MENTION","TYPE_AT_ROOM_MENTION"),o()(s,"propTypes",{type:f.a.string,url:f.a.string,inMessage:f.a.bool,room:f.a.instanceOf(h.a),shouldShowPillAvatar:f.a.bool,isSelected:f.a.bool}),n=s))||n;t.a=O},9:function(e,t,a){"use strict";function n(e,t){return Number.isFinite(e)?Number(e):t}function s(e,t,a){return Math.min(Math.max(e,t),a)}function i(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return[...t].reduce((e,t)=>t+e,0)}function o(e,t,a){return e*(a-t)+t}function r(e,t,a){return(e-t)/(a-t)}a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return s})),a.d(t,"e",(function(){return i})),a.d(t,"d",(function(){return o})),a.d(t,"c",(function(){return r}))},906:function(e,t,a){"use strict";a.d(t,"a",(function(){return x}));var n,s=a(95),i=a.n(s),o=a(19),r=a.n(o),l=a(88),c=a.n(l),d=a(93),m=a(135),u=a(131),h=a(789),p=a.n(h),g=a(278),f=a(497),v=a(798),b=a(127),y=a(1341),E=a(103),_=a(222),S=a(100),C=a(94);function w(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function O(e){let t,a,n;return 1===e.deltaMode?(t=18*e.deltaX,a=18*e.deltaY,n=18*e.deltaZ):(t=e.deltaX,a=e.deltaY,n=e.deltaZ),new WheelEvent("syntheticWheel",function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?w(Object(a),!0).forEach((function(t){r()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({deltaMode:0,deltaY:a,deltaX:t,deltaZ:n},e))}let x=Object(C.a)("views.elements.ImageView")(n=class extends c.a.Component{constructor(e){super(e),r()(this,"contextMenuButton",Object(l.createRef)()),r()(this,"focusLock",Object(l.createRef)()),r()(this,"imageWrapper",Object(l.createRef)()),r()(this,"image",Object(l.createRef)()),r()(this,"initX",0),r()(this,"initY",0),r()(this,"lastX",0),r()(this,"lastY",0),r()(this,"previousX",0),r()(this,"previousY",0),r()(this,"calculateZoom",()=>{const e=this.image.current,t=this.imageWrapper.current,a=t.clientWidth/e.naturalWidth,n=t.clientHeight/e.naturalHeight;if(a>=1&&n>=1)return void this.setState({zoom:1,minZoom:1,maxZoom:1});const s=.95*Math.min(a,n);this.state.zoom<=this.state.minZoom&&this.setState({zoom:s}),this.setState({minZoom:s,maxZoom:1})}),r()(this,"onWheel",e=>{e.stopPropagation(),e.preventDefault();const{deltaY:t}=O(e);this.zoom(-.0025*t)}),r()(this,"onZoomInClick",()=>{this.zoom(.1)}),r()(this,"onZoomOutClick",()=>{this.zoom(-.1)}),r()(this,"onKeyDown",e=>{e.key===u.a.ESCAPE&&(e.stopPropagation(),e.preventDefault(),this.props.onFinished())}),r()(this,"onRotateCounterClockwiseClick",()=>{const e=this.state.rotation-90;this.setState({rotation:e})}),r()(this,"onRotateClockwiseClick",()=>{const e=this.state.rotation+90;this.setState({rotation:e})}),r()(this,"onDownloadClick",()=>{const e=document.createElement("a");e.href=this.props.src,e.download=this.props.name,e.target="_blank",e.rel="noreferrer noopener",e.click()}),r()(this,"onOpenContextMenu",()=>{this.setState({contextMenuDisplayed:!0})}),r()(this,"onCloseContextMenu",()=>{this.setState({contextMenuDisplayed:!1})}),r()(this,"onPermalinkClicked",e=>{e.preventDefault(),S.a.dispatch({action:"view_room",event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId()}),this.props.onFinished()}),r()(this,"onStartMoving",e=>{e.stopPropagation(),e.preventDefault(),0===e.button&&(this.state.zoom!==this.state.minZoom?(this.setState({moving:!0}),this.previousX=this.state.translationX,this.previousY=this.state.translationY,this.initX=e.pageX-this.lastX,this.initY=e.pageY-this.lastY):this.setState({zoom:this.state.maxZoom}))}),r()(this,"onMoving",e=>{e.stopPropagation(),e.preventDefault(),this.state.moving&&(this.lastX=e.pageX-this.initX,this.lastY=e.pageY-this.initY,this.setState({translationX:this.lastX,translationY:this.lastY}))}),r()(this,"onEndMoving",()=>{!0===this.state.moving&&Math.abs(this.state.translationX-this.previousX)<10&&Math.abs(this.state.translationY-this.previousY)<10&&this.setState({zoom:this.state.minZoom,translationX:0,translationY:0}),this.setState({moving:!1})}),this.state={zoom:0,minZoom:.95,maxZoom:.95,rotation:0,translationX:0,translationY:0,moving:!1,contextMenuDisplayed:!1}}componentDidMount(){this.focusLock.current.addEventListener("wheel",this.onWheel,{passive:!1}),window.addEventListener("resize",this.calculateZoom),this.image.current.addEventListener("load",this.calculateZoom)}componentWillUnmount(){this.focusLock.current.removeEventListener("wheel",this.onWheel),window.removeEventListener("resize",this.calculateZoom),this.image.current.removeEventListener("load",this.calculateZoom)}zoom(e){const t=this.state.zoom+e;t<=this.state.minZoom?this.setState({zoom:this.state.minZoom,translationX:0,translationY:0}):t>=this.state.maxZoom?this.setState({zoom:this.state.maxZoom}):this.setState({zoom:t})}renderContextMenu(){let e=null;return this.state.contextMenuDisplayed&&(e=c.a.createElement(b.b,i()({},Object(b.k)(this.contextMenuButton.current.getBoundingClientRect()),{onFinished:this.onCloseContextMenu}),c.a.createElement(v.b,{mxEvent:this.props.mxEvent,permalinkCreator:this.props.permalinkCreator,onFinished:this.onCloseContextMenu,onCloseDialog:this.props.onFinished}))),c.a.createElement(c.a.Fragment,null,e)}render(){const e=!!this.props.mxEvent,t=this.state.maxZoom===this.state.minZoom;let a;a=this.state.moving?"grabbing":t?"default":this.state.zoom===this.state.minZoom?"zoom-in":"zoom-out";const n=this.state.rotation+"deg",s=this.state.zoom,i=this.state.translationX+"px",o=this.state.translationY+"px",r={cursor:a,transition:this.state.moving?null:"transform 200ms ease 0s",transform:`translateX(${i})\n                        translateY(${o})\n                        scale(${s})\n                        rotate(${n})`};let l,u,h,v;if(e){const e=this.props.mxEvent,t=E.b.getValue("showTwelveHourTimestamps");let a="#";this.props.permalinkCreator&&(a=this.props.permalinkCreator.forEvent(this.props.mxEvent.getId()));const n=e.sender?e.sender.name:e.getSender(),s=c.a.createElement("div",{className:"mx_ImageView_info_sender"},n),i=c.a.createElement("a",{href:a,onClick:this.onPermalinkClicked,"aria-label":Object(_.b)(new Date(this.props.mxEvent.getTs()),t,!1)},c.a.createElement(y.a,{showFullDate:!0,showTwelveHour:t,ts:e.getTs(),showSeconds:!1})),o=c.a.createElement(g.a,{member:e.sender,width:32,height:32,viewUserOnClick:!0});l=c.a.createElement("div",{className:"mx_ImageView_info_wrapper"},o,c.a.createElement("div",{className:"mx_ImageView_info"},s,i))}else l=c.a.createElement("div",null);return this.props.mxEvent&&(u=c.a.createElement(f.a,{className:"mx_ImageView_button mx_ImageView_button_more",title:Object(d.a)("Options"),onClick:this.onOpenContextMenu,inputRef:this.contextMenuButton,isExpanded:this.state.contextMenuDisplayed})),t||(h=c.a.createElement(m.a,{className:"mx_ImageView_button mx_ImageView_button_zoomOut",title:Object(d.a)("Zoom out"),onClick:this.onZoomOutClick}),v=c.a.createElement(m.a,{className:"mx_ImageView_button mx_ImageView_button_zoomIn",title:Object(d.a)("Zoom in"),onClick:this.onZoomInClick})),c.a.createElement(p.a,{returnFocus:!0,lockProps:{onKeyDown:this.onKeyDown,role:"dialog"},className:"mx_ImageView",ref:this.focusLock},c.a.createElement("div",{className:"mx_ImageView_panel"},l,c.a.createElement("div",{className:"mx_ImageView_toolbar"},c.a.createElement(m.a,{className:"mx_ImageView_button mx_ImageView_button_rotateCCW",title:Object(d.a)("Rotate Left"),onClick:this.onRotateCounterClockwiseClick}),c.a.createElement(m.a,{className:"mx_ImageView_button mx_ImageView_button_rotateCW",title:Object(d.a)("Rotate Right"),onClick:this.onRotateClockwiseClick}),h,v,c.a.createElement(m.a,{className:"mx_ImageView_button mx_ImageView_button_download",title:Object(d.a)("Download"),onClick:this.onDownloadClick}),u,c.a.createElement(m.a,{className:"mx_ImageView_button mx_ImageView_button_close",title:Object(d.a)("Close"),onClick:this.props.onFinished}),this.renderContextMenu())),c.a.createElement("div",{className:"mx_ImageView_image_wrapper",ref:this.imageWrapper},c.a.createElement("img",{src:this.props.src,title:this.props.name,style:r,ref:this.image,className:"mx_ImageView_image",draggable:!0,onMouseDown:this.onStartMoving,onMouseMove:this.onMoving,onMouseUp:this.onEndMoving,onMouseLeave:this.onEndMoving})))}})||n},907:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(19),s=a.n(n),i=a(158);const o={};var r=a(1326),l=a(103);class c{constructor(){}static get instance(){return c.internalInstance||(c.internalInstance=new c),c.internalInstance}async onNewInvitedRoom(e){await r.a.sharedInstance().onNewInvitedRoom(e)}isRoomVisible(e){if(!e)return!1;if(i.d.sharedInstance().getSupportsVirtualRooms()&&r.a.sharedInstance().isVirtualRoom(e))return!1;if(l.b.getValue("feature_spaces")&&e.isSpaceRoom())return!1;const t=o.isRoomVisible;return!t||t(e)}}s()(c,"internalInstance",void 0)},93:function(e,t,a){"use strict";a.d(t,"h",(function(){return p})),a.d(t,"g",(function(){return g})),a.d(t,"b",(function(){return f})),a.d(t,"a",(function(){return v})),a.d(t,"j",(function(){return y})),a.d(t,"c",(function(){return E})),a.d(t,"e",(function(){return _})),a.d(t,"f",(function(){return S})),a.d(t,"d",(function(){return w})),a.d(t,"i",(function(){return O}));var n=a(515),s=a.n(n),i=a(1553),o=a.n(i),r=a(88),l=a.n(r),c=a(103),d=a(156),m=a.p+"i18n/languages.1bd2852.json",u=a(123),h=a(211);function p(e){const t=new Error(e);return t.translatedMessage=v(e),t}function g(){const e=c.b.getValue("language",null,!0);return e||C(_()[0])}function f(e){return e}function v(e,t,a){const n=function(e,t,a){let n=e;if(void 0!==t){const e={};for(const a in t)e[`%\\(${a}\\)s`]=t[a];n=b(n,e)}if(void 0!==a){const e={};for(const t in a)e[`(<${t}>(.*?)<\\/${t}>|<${t}>|<${t}\\s*\\/>)`]=a[t];n=b(n,e)}return n}(function(e,t){let a;t&&"object"==typeof t&&(a=t.count,Object.keys(t).forEach(e=>{void 0===t[e]&&(console.warn("safeCounterpartTranslate called with undefined interpolation name: "+e),t[e]="undefined"),null===t[e]&&(console.warn("safeCounterpartTranslate called with null interpolation name: "+e),t[e]="null")}));let n=o.a.translate(e,t);return void 0===n&&void 0!==a&&(n=o.a.translate(e,Object.assign({},t,{locale:"en"}))),n}(e,Object.assign({interpolate:!1},t)),t,a);return n}function b(e,t){const a=[e];let n=!1;for(const s in t){const i=new RegExp(s,"g");let o=!1;for(let e=0;e<a.length;e++){const r=a[e];if("string"!=typeof r)continue;let l=i.exec(r);if(!l)continue;o=!0;const c=r.substr(0,l.index),d=[];let m;for(;l;){m=l;const e=l.slice(2);let a,o;if(a=t[s]instanceof Function?t[s](...e):t[s],"object"==typeof a&&(n=!0),"string"==typeof a&&""===a||d.push(a),l=i.exec(r),l){const e=m.index+m[0].length;o=r.substr(e,l.index-e)}else o=r.substr(m.index+m[0].length);o&&d.push(o)}a.splice(e,1,...d),""!==c&&a.splice(e,0,c)}o||"%\\(count\\)s"!==s&&console.log(`Could not find ${i} in ${e}`)}return n?l.a.createElement("span",null,...a):a.join("")}function y(e){Array.isArray(e)||(e=[e]);const t=d.a.get();let a,n;return t&&t.setLanguage(e),x().then(t=>{n=t;for(let t=0;t<e.length;++t)if(n.hasOwnProperty(e[t])){a=e[t];break}return a||(a="en",console.error("Unable to find an appropriate language")),R("i18n/"+n[a].fileName)}).then(e=>{if(o.a.registerTranslations(a,e),o.a.setLocale(a),c.b.setValue("language",null,u.a.DEVICE,a),console.log("set language to "+a),"en"!==a)return R("i18n/"+n.en.fileName)}).then(e=>{e&&o.a.registerTranslations("en",e)})}function E(){return x().then(e=>{const t=[];for(const a in e)e.hasOwnProperty(a)&&t.push({value:a,label:e[a].label});return t})}function _(){return navigator.languages&&navigator.languages.length?navigator.languages:navigator.language?[navigator.language]:[navigator.userLanguage||"en"]}function S(e){const t=[],a=C(e),n=a.split("-");return 2===n.length&&n[0]===n[1]?t.push(n[0]):(t.push(a),2===n.length&&t.push(n[0])),t}function C(e){return e.toLowerCase().replace("_","-")}function w(){return o.a.getLocale()}function O(e){const t=w(),a=e.map(C);{const n=a.indexOf(t);if(n>-1)return e[n]}{const n=a.findIndex(e=>e.substr(0,2)===t.substr(0,2));if(n>-1)return e[n]}{const t=a.findIndex(e=>e.startsWith("en"));if(t>-1)return e[t]}return e[0]}function x(){return new Promise((e,t)=>{let a;a="string"==typeof m?m:"i18n/languages.json",s()({method:"GET",url:a},(n,s,i)=>{n?t(n):s.status<200||s.status>=300?t(new Error(`Failed to load ${a}, got ${s.status}`)):e(JSON.parse(i))})})}async function R(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return Object(h.b)(()=>k(e),t,t=>(console.log("Failed to load i18n",e),console.error(t),!0))}function k(e){return new Promise((t,a)=>{s()({method:"GET",url:e},(n,s,i)=>{n?a(n):s.status<200||s.status>=300?a(new Error(`Failed to load ${e}, got ${s.status}`)):t(function(e){const t={};for(const a of Object.keys(e)){const n=a.split("|",2);if(2===n.length){let s=t[n[0]];void 0===s&&(s={},t[n[0]]=s),s[n[1]]=e[a]}else t[a]=e[a]}return t}(JSON.parse(i)))})})}o.a.setSeparator("|"),o.a.setFallbackLocale("en")},94:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(97);function s(e,t){return()=>n.getComponent(e)||t}},97:function(e,t,a){"use strict";a.r(t),a.d(t,"loadSkin",(function(){return s})),a.d(t,"resetSkin",(function(){return i})),a.d(t,"getComponent",(function(){return o}));var n=a(1564);a(8441);function s(e){n.a.load(e)}function i(){n.a.reset()}function o(e){return n.a.getComponent(e)}},99:function(e,t,a){"use strict";a.d(t,"a",(function(){return N}));var n=a(19),s=a.n(n),i=a(443),o=a(1),r=a(256),l=a(633),c=a(97),d=a(1376),m=a(103),u=a(100);function h(e,t,a){return{action:"MatrixActions.sync",state:t,prevState:a,matrixClient:e}}function p(e,t){return{action:"MatrixActions.accountData",event:t,event_type:t.getType(),event_content:t.getContent()}}function g(e,t,a){return{action:"MatrixActions.Room.accountData",event:t,event_type:t.getType(),event_content:t.getContent(),room:a}}function f(e,t){return{action:"MatrixActions.Room",room:t}}function v(e,t,a){return{action:"MatrixActions.Room.tags",room:a}}function b(e,t,a){return{action:"MatrixActions.Room.receipt",event:t,room:a,matrixClient:e}}function y(e,t,a,n,s,i){return{action:"MatrixActions.Room.timeline",event:t,isLiveEvent:i.liveEvent,isLiveUnfilteredRoomTimelineEvent:a&&i.timeline.getTimelineSet()===a.getUnfilteredTimelineSet()}}function E(e,t,a,n){return{action:"MatrixActions.Room.myMembership",room:t,membership:a,oldMembership:n}}function _(e,t){return{action:"MatrixActions.Event.decrypted",event:t}}var S={_matrixClientListenersStop:[],start(e){this._addMatrixClientListener(e,"sync",h),this._addMatrixClientListener(e,"accountData",p),this._addMatrixClientListener(e,"Room.accountData",g),this._addMatrixClientListener(e,"Room",f),this._addMatrixClientListener(e,"Room.tags",v),this._addMatrixClientListener(e,"Room.receipt",b),this._addMatrixClientListener(e,"Room.timeline",y),this._addMatrixClientListener(e,"Room.myMembership",E),this._addMatrixClientListener(e,"Event.decrypted",_)},_addMatrixClientListener(e,t,a){const n=function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];const i=a(e,...n);i&&u.a.dispatch(i,!0)};e.on(t,n),this._matrixClientListenersStop.push(()=>{e.removeListener(t,n)})},stop(){this._matrixClientListenersStop.forEach(e=>e())}},C=a(106),w=a(584),O=a(627),x=a(504),R=a(330),k=a(279),I=a(487),T=a(338);class P{constructor(){s()(this,"opts",{initialSyncLimit:20}),s()(this,"matrixClient",null),s()(this,"justRegisteredUserId",void 0),s()(this,"currentClientCreds",void 0)}setIndexedDbWorkerScript(e){d.a.indexedDbWorkerScript=e}get(){return this.matrixClient}unset(){this.matrixClient=null,S.stop()}setJustRegisteredUserId(e){this.justRegisteredUserId=e,e&&window.localStorage.setItem("mx_registration_time",String((new Date).getTime()))}currentUserIsJustRegistered(){return this.matrixClient&&this.matrixClient.credentials.userId===this.justRegisteredUserId}userRegisteredWithinLastHours(e){try{const t=new Date(window.localStorage.getItem("mx_registration_time"));return((new Date).getTime()-t.getTime())/36e5<=e}catch(e){return!1}}replaceUsingCreds(e){this.currentClientCreds=e,this.createClient(e)}async assign(){for(const e of["indexeddb","memory"])try{const e=this.matrixClient.store.startup();console.log("MatrixClientPeg: waiting for MatrixClient store to initialise"),await e;break}catch(t){if("indexeddb"!==e)throw console.error("Failed to start memory store!",t),t;console.error("Error starting matrixclient store - falling back to memory store",t),this.matrixClient.store=new i.a({localStorage:localStorage})}x.f(this.matrixClient);try{!m.b.getValue("lowBandwidth")&&this.matrixClient.initCrypto&&(await this.matrixClient.initCrypto(),this.matrixClient.setCryptoTrustCrossSignedDevices(!m.b.getValue("e2ee.manuallyVerifyAllSessions")),await Object(k.f)(this.matrixClient),x.e(!0))}catch(e){if(e&&"InvalidCryptoStoreError"===e.name){const e=c.getComponent("views.dialogs.CryptoStoreTooNewDialog");C.a.createDialog(e)}console.warn("Unable to initialise e2e",e)}const e=o.d(this.opts);return e.pendingEventOrdering="detached",e.lazyLoadMembers=!0,e.clientWellKnownPollPeriod=7200,S.start(this.matrixClient),O.a.matrixClient=this.matrixClient,e}async start(){const e=await this.assign();console.log("MatrixClientPeg: really starting MatrixClient"),await this.get().startClient(e),console.log("MatrixClientPeg: MatrixClient started")}getCredentials(){return{homeserverUrl:this.matrixClient.baseUrl,identityServerUrl:this.matrixClient.idBaseUrl,userId:this.matrixClient.credentials.userId,deviceId:this.matrixClient.getDeviceId(),accessToken:this.matrixClient.getAccessToken(),guest:this.matrixClient.isGuest()}}getHomeserverName(){const e=/^@[^:]+:(.+)$/.exec(this.matrixClient.credentials.userId);if(null===e||e.length<1)throw new Error("Failed to derive homeserver name from user ID!");return e[1]}createClient(e){const t={baseUrl:e.homeserverUrl,idBaseUrl:e.identityServerUrl,accessToken:e.accessToken,userId:e.userId,deviceId:e.deviceId,pickleKey:e.pickleKey,timelineSupport:!0,forceTURN:!m.b.getValue("webRtcAllowPeerToPeer"),fallbackICEServerAllowed:!!m.b.getValue("fallbackICEServerAllowed"),iceCandidatePoolSize:20,verificationMethods:[w.d.SAS,I.d,w.d.RECIPROCATE_QR_CODE],unstableClientRelationAggregation:!0,identityServer:new R.a,cryptoCallbacks:{}};Object.assign(t.cryptoCallbacks,k.c),T.a.getDehydrationKey&&(t.cryptoCallbacks.getDehydrationKey=T.a.getDehydrationKey),this.matrixClient=Object(d.a)(t),this.matrixClient.setMaxListeners(500),this.matrixClient.setGuest(Boolean(e.guest));const a=new l.a(null,{timelineSupport:!0});a.getLiveTimeline().setPaginationToken("",r.a.BACKWARDS),this.matrixClient.setNotifTimelineSet(a)}}window.mxMatrixClientPeg||(window.mxMatrixClientPeg=new P);const N=window.mxMatrixClientPeg}}]);
//# sourceMappingURL=init.js.map